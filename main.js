!function e(t,i,n){function r(s,a){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[s]={exports:{}};t[s][0].call(u.exports,(function(e){return r(t[s][1][e]||e)}),u,u.exports,e,t,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.pushNotificationMessage=i.Notification=void 0;const n=e("react"),r=e("react-dom");class o extends n.Component{constructor(e){super(e),this.state={notifications:{}}}push(e){const t=this.state.notifications,i=ts.pxtc.Util.guidGen();Object.keys(t).filter((i=>t[i].kind==e.kind)).forEach((e=>this.remove(e))),t[i]=e;const n=this;setTimeout((()=>{n.remove(i)}),3e3),this.setState({notifications:t})}remove(e){const t=this.state.notifications;t[e]&&(delete t[e],this.setState({notifications:t}))}render(){const{notifications:e}=this.state;return n.createElement("div",{id:"msg","aria-live":"polite"},Object.keys(e).map((t=>function(e,t){const{kind:i,text:r,hc:o}=t;let s="ignored info message";switch(i){case"err":s="red inverted segment";break;case"warn":s="orange inverted segment";break;case"info":s="teal inverted segment";break;case"compile":s="ignored info message"}return n.createElement("div",{key:`${e}`,id:`${i}msg`,className:`ui ${o} ${s}`},r)}(t,e[t]))))}}i.Notification=o;let s,a=!1;i.pushNotificationMessage=function(e){if(a)s&&s.push(e);else{a=!0;const t=document.body.appendChild(document.createElement("div"));(s=r.render(n.createElement(o,e),t)).push(e)}}},{react:335,"react-dom":291}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Button=void 0;const n=e("react"),r=e("../util");i.Button=e=>{const{id:t,className:i,ariaLabel:o,ariaHidden:s,ariaDescribedBy:a,ariaControls:l,ariaExpanded:c,ariaHasPopup:u,ariaPosInSet:d,ariaSetSize:p,role:h,onClick:f,onKeydown:m,buttonRef:g,title:b,label:v,leftIcon:y,rightIcon:k,disabled:w,href:x,target:E,tabIndex:C}=e,S=r.classList("common-button",i,w&&"disabled");return n.createElement("button",{id:t,className:S,title:b,ref:g,onClick:w?void 0:()=>{f&&f(),x&&window.open(x,E||"_blank","noopener,noreferrer")},onKeyDown:m||r.fireClickOnEnter,role:h||"button",tabIndex:C||(w?-1:0),"aria-label":o,"aria-hidden":s,"aria-controls":l,"aria-expanded":c,"aria-haspopup":u,"aria-posinset":d,"aria-setsize":p,"aria-describedby":a},n.createElement("span",{className:"common-button-flex"},y&&n.createElement("i",{className:y,"aria-hidden":!0}),n.createElement("span",{className:"common-button-label"},v),k&&n.createElement("i",{className:"right "+k,"aria-hidden":!0})))}},{"../util":13,react:335}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Checkbox=void 0;const n=e("react"),r=e("../util");i.Checkbox=e=>{const{id:t,className:i,ariaHidden:o,ariaLabel:s,role:a,isChecked:l,onChange:c,label:u}=e;return n.createElement("div",{className:r.classList("common-checkbox",i)},n.createElement("input",{id:t,tabIndex:0,type:"checkbox",checked:l,onClick:()=>{c(!l)},onKeyDown:r.fireClickOnEnter,role:a,"aria-hidden":o,"aria-label":s}),u&&n.createElement("label",{htmlFor:t},u))}},{"../util":13,react:335}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FocusTrap=void 0;const n=e("react"),r=e("../util");i.FocusTrap=e=>{const{children:t,id:i,className:o,onEscape:s,arrowKeyNavigation:a,dontStealFocus:l,includeOutsideTabOrder:c}=e;let u;const[d,p]=n.useState(!1),h=()=>r.nodeListToArray(c?u.querySelectorAll("[tabindex]"):u.querySelectorAll('[tabindex]:not([tabindex="-1"])'));return n.createElement("div",{id:i,className:r.classList("common-focus-trap",o),ref:e=>{e&&(u=e,l||d||e.contains(document.activeElement)||!h().length||(u.focus(),p(!0)))},onKeyDown:e=>{if(!u)return;const t=(t,i)=>{const n=h();if(!n.length)return;const r=n.indexOf(e.target);t?i?n[n.length-1].focus():r===n.length-1?n[0].focus():n[r+1].focus():i?n[0].focus():0===r?n[n.length-1].focus():n[Math.max(r-1,0)].focus(),e.preventDefault(),e.stopPropagation()};"Escape"===e.key?(s(),e.preventDefault(),e.stopPropagation()):"Tab"===e.key?e.shiftKey?t(!1,!1):t(!0,!1):a&&("ArrowDown"===e.key?t(!0,!1):"ArrowUp"===e.key?t(!1,!1):"Home"===e.key?t(!1,!0):"End"===e.key&&t(!0,!0))},tabIndex:-1},t)}},{"../util":13,react:335}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.List=void 0;const n=e("react"),r=e("../util");i.List=e=>{const{id:t,className:i,ariaHidden:o,ariaLabel:s,role:a}=e;return n.createElement("div",{id:t,"aria-hidden":o,"aria-label":s,role:a,className:r.classList("common-list",i)},n.Children.map(e.children,((e,t)=>n.createElement("div",{key:t,className:"common-list-item"},e))))}},{"../util":13,react:335}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Modal=void 0;const n=e("react"),r=e("react-dom"),o=e("../util"),s=e("./Button"),a=e("./FocusTrap");i.Modal=e=>{const{children:t,id:i,className:l,ariaLabel:c,ariaHidden:u,ariaDescribedBy:d,role:p,title:h,actions:f,onClose:m,parentElement:g,fullscreen:b}=e,v=e=>{m&&m()},y=o.classList("common-modal-container",b&&"fullscreen",l);return r.createPortal(n.createElement(a.FocusTrap,{className:y,onEscape:v},n.createElement("div",{id:i,className:"common-modal",role:p||"dialog","aria-hidden":u,"aria-label":c,"aria-describedby":d,"aria-labelledby":"modal-title"},n.createElement("div",{className:"common-modal-header"},b&&n.createElement("div",{className:"common-modal-back"},n.createElement(s.Button,{className:"menu-button",onClick:v,title:lf("Go Back"),label:lf("Go Back"),leftIcon:"fas fa-arrow-left"})),n.createElement("div",{id:"modal-title",className:"common-modal-title"},h),!b&&n.createElement("div",{className:"common-modal-close"},n.createElement(s.Button,{className:"menu-button",onClick:v,title:lf("Close"),rightIcon:"fas fa-times-circle"}))),n.createElement("div",{className:"common-modal-body"},t),(null==f?void 0:f.length)&&n.createElement("div",{className:"common-modal-footer"},f.map(((e,t)=>n.createElement(s.Button,{key:t,className:"primary inverted",disabled:e.disabled,onClick:e.onClick,href:e.url,label:e.label,title:e.label,rightIcon:(e.xicon?"xicon ":"")+e.icon})))))),g||document.body)}},{"../util":13,"./Button":2,"./FocusTrap":4,react:335,"react-dom":291}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Badge=void 0;const n=e("react"),r=e("../util");i.Badge=e=>{const{badge:t,disabled:i,isNew:o,onClick:s}=e,a=s&&(()=>{s(t)}),l=i&&t.lockedImage||t.image,c=i?pxt.U.lf("Locked '{0}' badge",t.title):t.title;return n.createElement("div",{className:"profile-badge "+(s?"clickable":""),role:s?"button":void 0,tabIndex:s?0:void 0,title:lf("{0} Badge",t.title),onClick:a,onKeyDown:r.fireClickOnEnter},o&&n.createElement("div",{className:"profile-badge-notification"},pxt.U.lf("New!")),n.createElement("img",{src:l,alt:c}))}},{"../util":13,react:335}],8:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.badgeDescription=i.BadgeInfo=void 0;const n=e("react"),r=e("../util"),o=e("./Badge");i.BadgeInfo=e=>{const{badge:t}=e,r=new Date(t.timestamp);return n.createElement("div",{className:"profile-badge-info"},n.createElement("div",{className:"profile-badge-info-image"},n.createElement(o.Badge,{badge:t,disabled:!t.timestamp})),n.createElement("div",{className:"profile-badge-info-item",id:"profile-badge-info-"+t.id},n.createElement("div",{className:"profile-badge-info-header"},lf("Awarded For:")),n.createElement("div",{className:"profile-badge-info-text"},i.badgeDescription(t))),t.timestamp?n.createElement("div",{className:"profile-badge-info-item"},n.createElement("div",{className:"profile-badge-info-header"},lf("Awarded On:")),n.createElement("div",{className:"profile-badge-info-text"},r.toLocaleDateString(pxt.U.userLanguage()))):void 0)};function s(e){var t;if(-1!==e.indexOf("/api/md/")){const i=e.split("/api/md/")[1].split("/").slice(1).join("/");return(null===(t=pxt.webConfig)||void 0===t?void 0:t.skillmapUrl)+"#docs:"+i}{const t=e.split("#");if(2==t.length)return pxt.webConfig.skillmapUrl+"#github:https://github.com/"+t[0]+"/"+t[1]}return pxt.BrowserUtils.isLocalHostDev()?"http://localhost:3000#local:"+e:e}i.badgeDescription=e=>{switch(e.type){case"skillmap-completion":return n.createElement("span",null,r.jsxLF(lf("Completing {0}"),n.createElement("a",{tabIndex:0,"aria-labelledby":"profile-badge-info-"+e.id,target:"_blank",rel:"noopener noreferrer",href:s(e.sourceURL)},pxt.U.rlf(e.title))))}}},{"../util":13,"./Badge":7,react:335}],9:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BadgeList=void 0;const n=e("react"),r=e("./Badge");i.BadgeList=e=>{const{onBadgeClick:t,availableBadges:i,userState:o}=e,s=i.slice();let a={};for(const e of o.badges){a[e.id]=!0;const t=s.findIndex((t=>t.id===e.id));t>-1?s[t]=Object.assign(Object.assign({},s[t]),{timestamp:s[t].timestamp||e.timestamp}):s.push(e)}const l=[];for(let e=0;e<Math.max(s.length+10,20);e++)l.push(n.createElement("div",{key:e,className:"placeholder-badge"}));return n.createElement("div",{className:"profile-badge-list"},n.createElement("div",{className:"profile-badge-header",id:"profile-badge-header"},n.createElement("span",{className:"profile-badge-title"},lf("Badges")),n.createElement("span",{className:"profile-badge-subtitle"},lf("Click each badge to see details"))),n.createElement("div",{className:"profile-badges-scroller"},n.createElement("div",{className:"profile-badges",role:"list","aria-labelledby":"profile-badge-header"},n.createElement("div",{className:"profile-badges-background-container","aria-hidden":"true"},n.createElement("div",{className:"profile-badges-background"},l)),s.map((e=>n.createElement("div",{className:"profile-badge-and-title",key:e.id,role:"listitem"},n.createElement(r.Badge,{onClick:t,badge:e,disabled:!a[e.id]}),n.createElement("div",{className:"profile-badge-name"},e.title)))))))}},{"./Badge":7,react:335}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Profile=void 0;const n=e("react"),r=e("./BadgeList"),o=e("./UserPane"),s=e("./BadgeInfo");i.Profile=e=>{var t;const{user:i,signOut:a,deleteProfile:l,onClickedEmail:c,notification:u,checkedEmail:d,showModalAsync:p}=e,h=(null==i?void 0:i.profile)||{idp:{}},f=(null===(t=null==i?void 0:i.preferences)||void 0===t?void 0:t.badges)||{badges:[]};return n.createElement("div",{className:"user-profile"},n.createElement(o.UserPane,{profile:h,onSignOutClick:a,onDeleteProfileClick:l,notification:u,emailChecked:d,onEmailCheckClick:c}),n.createElement(r.BadgeList,{availableBadges:pxt.appTarget.defaultBadges||[],userState:f,onBadgeClick:e=>{p({header:lf("{0} Badge",e.title),size:"tiny",hasCloseIcon:!0,onClose:()=>{const e=document.body.querySelector(".common-modal-container.fullscreen [tabindex]");e&&e.focus()},jsx:n.createElement(s.BadgeInfo,{badge:e})})}}))}},{"./BadgeInfo":8,"./BadgeList":9,"./UserPane":12,react:335}],11:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.UserNotification=void 0;const n=e("react");i.UserNotification=e=>{const{message:t,icon:i,actionText:r,link:o,xicon:s,title:a}=e.notification;return n.createElement("div",{className:"profile-notification"},n.createElement("div",{className:"profile-notification-icon"},n.createElement("i",{className:`${s?"xicon":"ui large circular icon "} ${i}`})),n.createElement("div",{className:"profile-notification-title"},a),n.createElement("div",{className:"profile-notification-message"},t),n.createElement("button",{className:"ui icon button profile-notification-button",onClick:()=>{window.open(o,"_blank")},role:"link"},n.createElement("i",{className:"icon external alternate"}),r))}},{react:335}],12:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.UserPane=void 0;const n=e("react"),r=e("../util"),o=e("./UserNotification"),s=e("../controls/Checkbox");i.UserPane=e=>{const{profile:t,onSignOutClick:i,onDeleteProfileClick:a,onEmailCheckClick:l,notification:c,emailChecked:u}=e,{username:d,displayName:p,picture:h}=t.idp,f=n.createElement(n.Fragment,null,u===r.CheckboxStatus.Waiting?n.createElement("div",{className:"common-spinner"}):void 0,lf("I would like to receive the MakeCode newsletter. "),n.createElement("a",{href:"https://makecode.com/privacy",target:"_blank",rel:"noopener noreferrer",tabIndex:0},lf("View Privacy Statement")));return n.createElement("div",{className:"profile-user-pane"},n.createElement("div",{className:"profile-portrait"},(null==h?void 0:h.dataUrl)?n.createElement("img",{src:null==h?void 0:h.dataUrl,alt:pxt.U.lf("Profile Picture")}):n.createElement("div",{className:"profile-initials-portrait"},pxt.auth.userInitials(t))),n.createElement("div",{className:"profile-user-details"},n.createElement("div",{className:"profile-display-name"},p),d&&n.createElement("div",{className:"profile-username"},d)),c&&n.createElement(o.UserNotification,{notification:c}),n.createElement("div",{className:"profile-spacer"}),n.createElement("div",{className:"profile-email"},n.createElement(s.Checkbox,{id:"profile-email-checkbox",className:u===r.CheckboxStatus.Waiting?"loading":"",isChecked:u===r.CheckboxStatus.Selected,onChange:l,label:f})),n.createElement("div",{className:"profile-actions"},n.createElement("a",{role:"button",tabIndex:0,onKeyPress:r.fireClickOnEnter,onClick:a},lf("Delete Profile")),n.createElement("button",{onClick:i,className:"ui icon button sign-out"},n.createElement("i",{className:"icon sign-out"}),lf("Sign Out"))))}},{"../controls/Checkbox":3,"../util":13,"./UserNotification":11,react:335}],13:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CheckboxStatus=i.nodeListToArray=i.classList=i.fireClickOnEnter=i.jsxLF=void 0;const n=e("react");var r;i.jsxLF=function(e,...t){const i=[];e.replace(/\{\d\}/g,(e=>(i.push(parseInt(e.substr(1,1))),e)));const r=[];let o,s=0;for(const a of i)o=e.split(`{${a}}`),pxt.U.assert(2===o.length),r.push(n.createElement("span",{key:s++},o[0])),r.push(n.createElement("span",{key:s++},t[a])),e=o[1];return r.push(n.createElement("span",{key:s++},e)),r},i.fireClickOnEnter=function(e){const t="number"==typeof e.which?e.which:e.keyCode;13!==t&&32!==t||(e.preventDefault(),e.currentTarget.click())},i.classList=function(...e){return e.filter((e=>"string"==typeof e)).reduce(((e,t)=>e.concat(t.split(" "))),[]).map((e=>e.trim())).filter((e=>!!e)).join(" ")},i.nodeListToArray=function(e){const t=[];for(const i of e)t.push(i);return t},(r=i.CheckboxStatus||(i.CheckboxStatus={}))[r.Selected=0]="Selected",r[r.Unselected=1]="Unselected",r[r.Waiting=2]="Waiting"},{react:335}],14:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.HomeAccessibilityMenu=i.EditorAccessibilityMenu=void 0;const n=e("react"),r=e("./auth"),o=e("./data"),s=e("./sui");class a extends o.Component{constructor(e){super(e),this.state={},this.openJavaScript=this.openJavaScript.bind(this),this.openPython=this.openPython.bind(this),this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this),this.goHome=this.goHome.bind(this)}openJavaScript(){pxt.tickEvent("accmenu.editor.openJS",void 0,{interactiveConsent:!0}),this.props.parent.openJavaScript()}openPython(){pxt.tickEvent("accmenu.editor.openPY",void 0,{interactiveConsent:!0}),this.props.parent.openPython()}showLanguagePicker(){pxt.tickEvent("accmenu.editor.importdialog",void 0,{interactiveConsent:!0}),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("accmenu.editor.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()}goHome(){pxt.tickEvent("accmenu.editor.home",void 0,{interactiveConsent:!0}),this.props.parent.showExitAndSaveDialog()}UNSAFE_componentWillReceiveProps(e){const t={};null!=e.highContrast&&(t.highContrast=e.highContrast),Object.keys(t).length>0&&this.setState(t)}shouldComponentUpdate(e,t,i){return this.state.highContrast!=t.highContrast}renderCore(){let e=this.getData(r.HIGHCONTRAST);const t=pxt.appTarget.appTheme,i=!pxt.shell.isControllerMode();return n.createElement("div",{className:"ui accessibleMenu borderless fixed menu",role:"menubar"},n.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon js",text:lf("Skip to JavaScript editor"),onClick:this.openJavaScript}),t.python?n.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon python",text:lf("Skip to Python editor"),onClick:this.openPython}):void 0,t.selectLanguage?n.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon globe",text:lf("Select Language"),onClick:this.showLanguagePicker}):void 0,t.highContrast?n.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",text:e?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0,i?n.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"home",text:lf("Go Home"),onClick:this.goHome}):void 0)}}i.EditorAccessibilityMenu=a;class l extends o.Component{constructor(e){super(e),this.state={},this.newProject=this.newProject.bind(this),this.importProjectDialog=this.importProjectDialog.bind(this),this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this)}newProject(){pxt.tickEvent("accmenu.home.new",void 0,{interactiveConsent:!0}),this.props.parent.newProject()}importProjectDialog(){pxt.tickEvent("accmenu.home.importdialog",void 0,{interactiveConsent:!0}),this.props.parent.importProjectDialog()}showLanguagePicker(){pxt.tickEvent("accmenu.home.langpicker"),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("accmenu.home.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()}UNSAFE_componentWillReceiveProps(e){const t={};null!=e.highContrast&&(t.highContrast=e.highContrast),Object.keys(t).length>0&&this.setState(t)}shouldComponentUpdate(e,t,i){return this.state.highContrast!=t.highContrast}renderCore(){const{highContrast:e}=this.state,t=pxt.appTarget.appTheme;return n.createElement("div",{className:"ui accessibleMenu borderless fixed menu",role:"menubar"},n.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"add circle",text:lf("New Project"),onClick:this.newProject}),n.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"upload",text:lf("Import Project"),onClick:this.importProjectDialog}),t.selectLanguage?n.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",icon:"xicon globe",text:lf("Select Language"),onClick:this.showLanguagePicker}):void 0,t.highContrast?n.createElement(s.Item,{className:(t.invertedMenu?"inverted":"")+" menu",role:"menuitem",text:e?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0)}}i.HomeAccessibilityMenu=l},{"./auth":20,"./data":81,"./sui":143,react:335}],15:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AccessibleBlocksInfo=void 0;const n=e("react"),r=e("./data"),o=e("./sui");class s extends r.Component{constructor(e){super(e),this.state={shown:!1},this.handleOnClose=this.handleOnClose.bind(this)}handleOnClose(){this.setState({shown:!0})}render(){return this.state.shown?n.createElement("div",null):n.createElement(o.Modal,{isOpen:!this.state.shown,onClose:this.handleOnClose,closeIcon:!0,dimmer:!0,header:lf("Move, edit, and insert blocks using your keyboard")},n.createElement("div",{className:"ui equal width grid"},n.createElement("div",{className:"column"},n.createElement("h3",null,lf("Navigate")),n.createElement("span",{className:"ui small"},lf("Use the WASD keys to move between blocks. Hold shift to move on the workspace."))),n.createElement("div",{className:"column"},n.createElement("h3",null,lf("Modify")),n.createElement("span",{className:"ui small"},lf("Press Enter to 'mark' a block, then X to disconnect, I to reconnect."))),n.createElement("div",{className:"column"},n.createElement("h3",null,lf("Insert")),n.createElement("span",{className:"ui small"},lf("Use T to open the toolbox. Inside the toolbox, use WASD to navigate, and Enter to insert.")))),n.createElement("div",{className:"ui grid"},n.createElement("strong",null,n.createElement("a",{href:"https://developers.google.com/blockly/guides/configure/web/keyboard-nav"},lf("See the official Blockly Documentation for additional detail")))))}}i.AccessibleBlocksInfo=s},{"./data":81,"./sui":143,react:335}],16:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ksVersion=i.ProjectView=i.getBlocksEditor=i.getEditorAsync=i.hasEditor=void 0;const n=e("react"),r=e("react-dom"),o=e("./workspace"),s=e("./cloudsync"),a=e("./data"),l=e("./package"),c=e("./core"),u=e("./sui"),d=e("./simulator"),p=e("./compiler"),h=e("./cmds"),f=e("./appcache"),m=e("./screenshot"),g=e("./hidbridge"),b=e("./share"),v=e("./lang"),y=e("./accessibility"),k=e("./tutorial"),w=e("./sidebarTutorial"),x=e("./editortoolbar"),E=e("./dialogs"),C=e("./identity"),S=e("./container"),_=e("./scriptsearch"),T=e("./projects"),A=e("./scriptmanager"),N=e("./extensions"),I=e("./sounds"),O=e("./make"),P=e("./blocksSnippets"),D=e("./monacoSnippets"),L=e("./greenscreen"),R=e("./accessibleblocks"),M=e("./socketbridge"),B=e("./auth"),j=e("./cloud"),U=e("./user"),F=e("./headerbar"),H=e("./sidepanel"),q=e("./monaco"),z=e("./pxtjson"),G=e("./serial"),$=e("./blocks"),V=e("./gitjson"),W=e("./components/assetEditor/editor"),K=e("./draganddrop"),J=e("./notification"),Y=e("./electron"),X=e("./blocklyFieldView");var Q=pxt.Cloud,Z=pxt.Util;const ee=e("./hinttooltip"),te=e("./mergeProjects");let ie,ne,re;function oe(){return ie?Promise.resolve(ie):(re||(re=[]),new Promise((e=>{re.push(e)})))}pxsim.util.injectPolyphils(),i.hasEditor=function(){return!!ie},i.getEditorAsync=oe,i.getBlocksEditor=function(){return ie?ie.blocksEditor:null};class se extends B.Component{constructor(e){var t,i;super(e),this.allEditors=[],this.screenshotHandlers=[],this.highContrastSubscriber={subscriptions:[],onDataChanged:()=>{this.onHighContrastChanged()}},this.cloudStatusSubscriber={subscriptions:[],onDataChanged:e=>this.onCloudStatusChanged(e)},this.autoRunSimulatorDebounced=pxtc.Util.debounce((()=>{Z.now()-this.lastChangeTime<1e3?pxt.debug("sim: skip auto, debounced"):this.state.active?this.blocksEditor&&this.blocksEditor.isDropdownDivVisible()?pxt.debug("sim: skip blocks auto, field editor is open"):this.editor!==this.serialEditor?this.state.debugging||this.state.tracing?pxt.debug("sim: don't restart when debugging or tracing"):this.state.collapseEditorTools?pxt.debug("sim: don't restart when simulator collapsed"):!pxt.BrowserUtils.isSkillmapEditor()||this.state.header?this.runSimulator({debug:!!this.state.debugging,background:!0}):pxt.debug("sim: don't restart when no project is open"):pxt.debug("sim: don't restart when entering console view"):pxt.debug("sim: skip blocks auto, !active")}),1e3,!0),this._slowTypeCheck=0,this.typecheckDebouncer=new pxtc.Util.AdaptiveDebouncer((()=>{if(this.editor.isIncomplete())return;const e=Z.now();this.saveFileAsync();const t=this.editor.snapshotState();p.typecheckAsync().then((i=>{const n=Z.now();if(!pxt.options.light&&n-e>1e4&&this._slowTypeCheck++>1&&(pxt.tickEvent("light.typecheck"),pxt.options.light=!0),pxt.tickEvent("typecheck.complete",{editor:this.getPreferredEditor()}),this.editor.setDiagnostics(this.editorFile,t),a.invalidate("open-pkg-meta:"+l.mainEditorPkg().getPkgId()),this.state.autoRun){const e=l.mainEditorPkg().outputPkg.files["output.txt"];e&&!e.numDiagnosticsOverride&&this.state.autoRun&&this.autoRunSimulatorDebounced()}this.maybeShowPackageErrors()}))})),this.markdownChangeHandler=Z.debounce((()=>{this.state.currFile&&/\.md$/i.test(this.state.currFile.name)&&this.setSideMarkdown(this.editor.getCurrentSource())}),3e3,!1),this.editorChangeHandler=Z.debounce((()=>{this.editor.isIncomplete()||(this.saveFileAsync(),this.typecheck(),this.isTutorial()&&pxt.appTarget.appTheme.tutorialCodeValidation&&this.editor.validateTutorialCode(this.state.tutorialOptions)),this.markdownChangeHandler()}),500,!1),this.hexFileImporters=[{id:"default",canImport:e=>e.meta.cloudId=="ks/"+pxt.appTarget.id||e.meta.cloudId==pxt.CLOUD_ID+pxt.appTarget.id||Z.startsWith(e.meta.cloudId,pxt.CLOUD_ID+pxt.appTarget.id),importAsync:(e,t)=>{let i={target:pxt.appTarget.id,targetVersion:t.meta.targetVersions?t.meta.targetVersions.target:void 0,editor:t.meta.editor,name:t.meta.name,meta:{},pubId:"",pubCurrent:!1};const n=JSON.parse(t.source);return o.installAsync(i,n).then((e=>this.loadHeaderAsync(e,null)))}}],this.resourceImporters=[new G.ResourceImporter],this.checkWebUSBVariant=!0,this.closeOnEscape=e=>{c.keyCodeFromEvent(e)===c.ESC_KEY&&(e.preventDefault(),this.toggleSimulatorFullscreen())},this.hintManager=new ee.HintManager,this.handleScriptManagerDialogClose=()=>{this.home.forceUpdate(),o.syncAsync()},this.handleHomeRef=e=>{this.home=e},this.handleScriptSearchRef=e=>{this.scriptSearch=e},this.handleExtensionRef=e=>{this.extensions=e},this.handleScriptManagerDialogRef=e=>{this.scriptManagerDialog=e},this.handleImportDialogRef=e=>{this.importDialog=e},this.handleExitAndSaveDialogRef=e=>{this.exitAndSaveDialog=e},this.handleNewProjectDialogRef=e=>{this.newProjectDialog=e},this.handleShareEditorRef=e=>{this.shareEditor=e},this.handleLanguagePickerRef=e=>{this.languagePicker=e},this.handleChooseHwDialogRef=e=>{this.chooseHwDialog=e},this.handleLoginDialogRef=e=>{this.loginDialog=e},this.handleProfileDialogRef=e=>{this.profileDialog=e},document.title=pxt.appTarget.title||pxt.appTarget.name,this.reload=!1,this.settings=JSON.parse(pxt.storage.getLocal("editorSettings")||"{}");const n=this.shouldShowHomeScreen();(/hc=(\w+)/.test(window.location.href)||(null===(i=null===(t=window.matchMedia)||void 0===t?void 0:t.call(window,"(forced-colors: active)"))||void 0===i?void 0:i.matches))&&c.setHighContrast(!0);const r=pxt.appTarget.simulator;this.state={showFiles:!1,home:n,active:"visible"==document.visibilityState||pxt.BrowserUtils.isElectron()||pxt.winrt.isWinRT()||pxt.appTarget.appTheme.dontSuspendOnVisibility,collapseEditorTools:r.headless,simState:pxt.editor.SimState.Stopped,autoRun:this.autoRunOnStart()},this.settings.editorFontSize||(this.settings.editorFontSize=/mobile/i.test(navigator.userAgent)?15:19),this.settings.fileHistory||(this.settings.fileHistory=[]),n&&this.homeLoaded(),this.hwDebug=this.hwDebug.bind(this),this.hideLightbox=this.hideLightbox.bind(this),this.openSimSerial=this.openSimSerial.bind(this),this.openDeviceSerial=this.openDeviceSerial.bind(this),this.openSerial=this.openSerial.bind(this),this.toggleGreenScreen=this.toggleGreenScreen.bind(this),this.toggleSimulatorFullscreen=this.toggleSimulatorFullscreen.bind(this),this.toggleSimulatorCollapse=this.toggleSimulatorCollapse.bind(this),this.showKeymap=this.showKeymap.bind(this),this.toggleKeymap=this.toggleKeymap.bind(this),this.showMiniSim=this.showMiniSim.bind(this),this.setTutorialStep=this.setTutorialStep.bind(this),this.completeTutorialAsync=this.completeTutorialAsync.bind(this),this.exitTutorial=this.exitTutorial.bind(this),this.setEditorOffset=this.setEditorOffset.bind(this),this.resetTutorialTemplateCode=this.resetTutorialTemplateCode.bind(this),this.initSimulatorMessageHandlers(),pxt.BrowserUtils.useOldTutorialLayout&&this.hintManager.addHint(se.tutorialCardId,this.tutorialCardHintCallback.bind(this))}autoRunOnStart(){return pxt.appTarget.simulator&&((pxt.options.light?!!pxt.appTarget.simulator.autoRunLight:!!pxt.appTarget.simulator.autoRun)||!!pxt.appTarget.simulator.emptyRunCode)}initSimulatorMessageHandlers(){window.addEventListener("message",(e=>{let t=e.data;if(t&&this.state.header)if("addextensions"===t.type){const e=t.extensions;this.addOrUpdateGithubExtensions(e)}else if("screenshot"===t.type){const e=t;if(!e.data)return;const i=this.screenshotHandlers[this.screenshotHandlers.length-1];if(i)i(e);else{const t=pxt.BrowserUtils.imageDataToPNG(e.data);pxt.appTarget.compile.saveAsPNG&&this.encodeProjectAsPNGAsync(t,!1),m.saveAsync(this.state.header,t).then((()=>{pxt.debug("screenshot saved")}))}}else if("recorder"===t.type){const e=t,i=this.screenshotHandlers[this.screenshotHandlers.length-1];i&&i({event:e.action})}}),!1)}async addOrUpdateGithubExtensions(e){pxt.tickEvent("package.addextensions");const t=l.mainEditorPkg(),i=await pxt.packagesConfigAsync(),r=null==e?void 0:e.map((e=>pxt.github.parseRepoId(e))).filter((e=>!!e)).filter((e=>pxt.github.repoStatus(e,i)!==pxt.github.GitRepoStatus.Banned));if(!t||!(null==r?void 0:r.length))return;const o=r.filter((e=>pxt.github.repoStatus(e,i)!==pxt.github.GitRepoStatus.Approved));if(!o.length||await c.confirmAsync({header:lf("Add extensions?"),jsx:n.createElement(n.Fragment,null,n.createElement("p",null,lf("Add or update these user-provided extensions to your project?")),n.createElement("ul",null,o.map((e=>n.createElement("li",{key:e.fullName},n.createElement("a",{href:`/pkg/${e.fullName}`},e.fullName))))),n.createElement("hr",null),n.createElement("p",null,lf("User-provided extension are not endorsed by Microsoft.")))})){pxt.debug(`adding extensions ${e}`);try{c.showLoading("addextensions",lf("adding extensions..."));for(const e of r){pxt.debug(`adding ${e.fullName}`);const{config:i,version:n}=await pxt.github.downloadLatestPackageAsync(e);await t.setDependencyAsync(i.name,n)}this.reloadHeaderAsync()}catch(e){c.handleNetworkError(e)}finally{c.hideLoading("addextensions")}}}shouldShowHomeScreen(){const e=ce(),t=pxt.shell.isSandboxMode()||pxt.shell.isReadOnly(),i=pxt.appTarget.appTheme.allowParentController||pxt.shell.isControllerMode()||/^#editor/.test(window.location.hash);return!t&&!i&&!de(e)}async updateVisibilityAsync(){var e;if(pxt.BrowserUtils.isElectron()||pxt.winrt.isWinRT()||pxt.appTarget.appTheme.dontSuspendOnVisibility)return;let t="visible"==document.visibilityState;if(pxt.debug(`page visibility: ${t}`),this.setState({active:t}),a.invalidate("pkg-git-pull-status"),a.invalidate("pkg-git-pr"),a.invalidate("pkg-git-pages"),t||(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||h.disconnectAsync(),!t&&this.state.autoRun)d.driver.state==pxsim.SimulatorState.Running&&(this.suspendSimulator(),this.setState({resumeOnVisibility:!0})),this.saveFileAsync();else if(t){a.invalidate("header:*");let e=this.state.header?this.state.header.id:"";const t=!this.state.home&&e;!t&&o.isHeadersSessionOutdated()||o.isHeaderSessionOutdated(this.state.header)?(pxt.debug("workspace: changed, reloading..."),await o.syncAsync(),t&&await this.loadHeaderAsync(o.getHeader(e),this.state.editorState)):this.state.resumeOnVisibility?(this.setState({resumeOnVisibility:!1}),this.runSimulator(),h.maybeReconnectAsync(!1,!0)):this.state.home||h.maybeReconnectAsync(!1,!0)}}saveSettings(){if(this.reload)return;let e=this.editorFile;e&&e.epkg.getTopHeader()&&this.editor.hasHistory()&&this.pushFileHistory(e.epkg.getTopHeader().id,e.getName(),this.editor.getViewState()),pxt.storage.setLocal("editorSettings",JSON.stringify(this.settings))}pushFileHistory(e,t,i){const n=this.settings;let r={id:e,name:t,pos:i};for(n.fileHistory=n.fileHistory.filter((e=>e.id!=r.id||e.name!=r.name));n.fileHistory.length>100;)n.fileHistory.pop();n.fileHistory.unshift(r)}popFileHistory(){this.settings.fileHistory.shift()}openProjectInLegacyEditor(e){if(!this.editorFile||!this.editorFile.epkg||!this.editorFile.epkg.getTopHeader())return Promise.resolve();const t=this.editorFile.epkg.getTopHeader();return pxt.tickEvent("update.openLegacyEditor",{version:t.targetVersion}),o.copyProjectToLegacyEditor(t,e).then((i=>{this.pushFileHistory(i.id,this.editorFile.getName(),this.editor.getViewState()),pxt.storage.setLocal("editorSettings",JSON.stringify(this.settings));const n=pxt.appTarget.appTheme;if(n&&n.editorVersionPaths&&n.editorVersionPaths[e]){const t=n.editorVersionPaths[e];window.location.href=pxt.Util.pathJoin(window.location.origin,t+"#editor")}else window.location.href=pxt.Util.pathJoin(window.location.origin,"v"+t.targetVersion+"#editor")})).catch((e=>{c.warningNotification(lf("Importing to older editor version only supported in web browsers"))}))}async componentDidUpdate(e,t){this.saveSettings(),this.editor.domUpdate(),d.setState(this.state.header?this.state.header.editor:"",this.state.tutorialOptions&&!!this.state.tutorialOptions.tutorial),this.editor.resize();let i=Promise.resolve();this.editor&&this.editor.isReady&&(i=i.then((()=>this.updateEditorFileAsync()))),this.editor&&(i=i.then((()=>{this.editor.updateBreakpoints(),this.editor.updateToolbox()})))}fireResize(){if(document.createEvent){let e=document.createEvent("Event");e.initEvent("resize",!0,!0),window.dispatchEvent(e)}else document.fireEvent("onresize")}updateEditorLogo(e,t){if(pxt.appTarget.appTheme.hideMenuBar){const i=document.getElementById("editorlogo");if(i)return i.style.left=`${e}px`,i.style.display="block",i.style.background=t||"",i.offsetHeight}return 0}saveFileAsync(){return!this.editorFile||this.loadingExample?Promise.resolve():this.saveTypeScriptAsync().then((()=>this.saveCurrentSourceAsync()))}saveProjectAsync(){return this.saveFileAsync().then((()=>l.mainEditorPkg().buildAssetsAsync())).then((()=>this.state.header&&o.saveAsync(this.state.header)))}saveCurrentSourceAsync(){let e=this.editor.getCurrentSource();return e!=this.editorFile.content&&d.setDirty(),this.editor.isIncomplete()?Promise.resolve():this.editorFile.setContentAsync(e)}isEmbedSimActive(){return this.state.embedSimView}isBlocksActive(){return!this.state.embedSimView&&this.editor==this.blocksEditor&&this.editorFile&&this.editorFile.name==pxt.MAIN_BLOCKS}isJavaScriptActive(){return!this.state.embedSimView&&this.editor==this.textEditor&&this.editorFile&&this.editorFile.name==pxt.MAIN_TS}isPythonActive(){return!this.state.embedSimView&&this.editor==this.textEditor&&this.editorFile&&this.editorFile.name==pxt.MAIN_PY}isAssetsActive(){return!this.state.embedSimView&&this.editor==this.assetEditor&&this.editorFile&&this.editorFile.name==pxt.ASSETS_FILE}isAnyEditeableJavaScriptOrPackageActive(){return this.editor==this.textEditor&&this.editorFile&&!this.editorFile.isReadonly()&&/(\.ts|pxt.json)$/.test(this.editorFile.name)}openPython(e=!0){if(!this.updatingEditorFile){if(this.setState({tracing:!1}),this.isPythonActive())return this.state.embedSimView&&this.setState({embedSimView:!1}),void(e&&this.textEditor.editor.focus());if(this.textEditor&&(this.textEditor.giveFocusOnLoading=e),this.isBlocksActive())this.blocksEditor.openPython();else if(this.isJavaScriptActive())this.openPythonAsync();else{const e=l.mainEditorPkg().files[pxt.MAIN_PY];e?this.setFile(e):this.updateFileAsync(pxt.MAIN_PY,"# ...",!1)}}}openJavaScript(e=!0){if(!this.updatingEditorFile){if(this.isJavaScriptActive())return this.state.embedSimView&&this.setState({embedSimView:!1}),void(e&&this.textEditor.editor.focus());if(this.textEditor&&(this.textEditor.giveFocusOnLoading=e),this.isBlocksActive())this.blocksEditor.openTypeScript();else if(this.isPythonActive())this.openTypeScriptAsync();else{const e=l.mainEditorPkg().files;let t=e[pxt.MAIN_TS];t||(t=e[Object.keys(e).find((e=>/\.ts$/.test(e)))]),this.setFile(t)}pxt.shell.setEditorLanguagePref("js")}}openBlocks(){if(this.updatingEditorFile)return;if(this.isBlocksActive())return void(this.state.embedSimView&&this.setState({embedSimView:!1}));const e=l.mainEditorPkg().files[pxt.MAIN_BLOCKS];if(this.isJavaScriptActive()||this.shouldTryDecompile&&!this.state.embedSimView)this.textEditor.openBlocks();else if(this.isAnyEditeableJavaScriptOrPackageActive()||!e.content)this.saveFileAsync().then((()=>this.textEditor.openBlocks()));else{const t=this.state.header;t&&t.editor!==pxt.BLOCKS_PROJECT_NAME?this.textEditor.openBlocks():this.setFile(e)}this.shouldTryDecompile=!1}async openBlocksAsync(){if(this.updatingEditorFile)return;if(this.isBlocksActive())return void(this.state.embedSimView&&this.setState({embedSimView:!1}));const e=l.mainEditorPkg();e.files[pxt.MAIN_BLOCKS]||e.setContentAsync(pxt.MAIN_BLOCKS,"");const t=e.files[pxt.MAIN_BLOCKS];if(this.isJavaScriptActive()||this.shouldTryDecompile&&!this.state.embedSimView)await this.textEditor.openBlocksAsync();else if(this.isAnyEditeableJavaScriptOrPackageActive()||!t.content)await this.saveFileAsync(),await this.textEditor.openBlocksAsync();else{const e=this.state.header;e&&e.editor!==pxt.BLOCKS_PROJECT_NAME?await this.textEditor.openBlocksAsync():this.setFile(t)}this.shouldTryDecompile=!1}openAssets(){const e=l.mainEditorPkg();e&&(e.lookupFile("this/"+pxt.ASSETS_FILE)||e.setFile(pxt.ASSETS_FILE,"\n",!0),this.saveFileAsync().then((()=>this.setFile(l.mainEditorPkg().lookupFile(`this/${pxt.ASSETS_FILE}`)))))}openSettings(){this.setFile(l.mainEditorPkg().lookupFile("this/pxt.json"))}openSimSerial(){this.openSerial(!0)}openDeviceSerial(){this.openSerial(!1)}openSerial(e){if(!pxt.appTarget.serial||!pxt.appTarget.serial.useEditor)return;if(this.editor==this.serialEditor&&this.serialEditor.isSim==e)return;const t=l.mainEditorPkg();if(!t)return;t.lookupFile("this/"+pxt.SERIAL_EDITOR_FILE)||t.setFile(pxt.SERIAL_EDITOR_FILE,"serial\n",!0),this.serialEditor.setSim(e);let i="serial."+(e?"simulator":"device")+"EditorOpened";pxt.tickEvent(i),this.setFile(t.lookupFile("this/"+pxt.SERIAL_EDITOR_FILE))}openPreviousEditor(){this.preserveUndoStack=!0;const e=this.state.header.id,t=this.settings.fileHistory[0];this.editorFile&&t.id==e&&t.name==this.editorFile.getName()&&this.popFileHistory();const i=this.settings.fileHistory.find((t=>t.id==e));if(i){const e=l.mainEditorPkg().lookupFile(i.name);if(e)return void this.setSideFile(e)}const n=!!l.mainEditorPkg().files[pxt.MAIN_BLOCKS];"monacoEditor"!=this.prevEditorId&&n?this.openBlocks():this.openJavaScript(!1)}openTypeScriptAsync(){return this.saveTypeScriptAsync(!0)}openPythonAsync(){const e=l.mainEditorPkg().files[pxt.MAIN_PY];if(e){const t=l.mainEditorPkg().files[pxt.MAIN_TS].content;return this.textEditor.convertPythonToTypeScriptAsync().then((i=>i==t?(pxt.debug("ts -> py shortcut"),this.setFile(e),Promise.resolve()):this.convertTypeScriptToPythonAsync()))}return this.convertTypeScriptToPythonAsync()}convertTypeScriptToPythonAsync(){this.editor.snapshotState();const e=this.isBlocksActive()?"blocks":"ts",t=this.editorFile.content,i=l.mainEditorPkg();let n;const r=i.getCachedTranspile(e,t,"py"),o=(n=r?this.saveVirtualFileAsync(pxt.PYTHON_PROJECT_NAME,r,!0):this.saveTypeScriptAsync(!1).then((()=>p.pyDecompileAsync(pxt.MAIN_TS))).then((n=>{if(n&&n.success){const r=n.outfiles[pxt.MAIN_PY];return i.cacheTranspile(e,t,"py",r),this.saveVirtualFileAsync(pxt.PYTHON_PROJECT_NAME,r,!0)}{const e=new Error("Failed to convert to Python.");return pxt.reportException(e),Promise.reject(e)}})).then((()=>(pxt.shell.setEditorLanguagePref("py"),Promise.resolve())))).then((()=>{}),(e=>c.confirmAsync({header:lf("Oops, there is a problem converting your code."),body:lf("We are unable to convert your code to Python."),agreeLbl:lf("Done"),agreeClass:"cancel",agreeIcon:"cancel",hasCloseIcon:!0}).then((()=>{}))));return c.showLoadingAsync("switchtopython",lf("switching to Python..."),n),o}openSimView(){this.state.embedSimView?this.startStopSimulator():(this.setState({embedSimView:!0}),this.startSimulator())}shouldPreserveUndoStack(){return this.preserveUndoStack}typecheckNow(){this.saveFileAsync(),this.typecheck()}showPackageErrorsOnNextTypecheck(){this.setState({suppressPackageWarning:!1})}maybeShowPackageErrors(e=!1){if(pxt.perf.measureStart("maybeShowPackageErrors"),this.state.currFile){const e=this.state.currFile;if(!pxt.editor.isBlocks(e)&&e.name!==pxt.MAIN_TS)return!1}if(!this.state.suppressPackageWarning||e){this.setState({suppressPackageWarning:!0});const t=p.getPackagesWithErrors();if(t.length){const i=this.state.header,n=pxt.semver.parse(pxt.appTarget.versions.target),r=pxt.semver.parse(i.targetVersion);let s;return o.isBrowserWorkspace()&&n.major!==r.major&&(s=()=>{this.openProjectInLegacyEditor(r.major)}),E.showPackageErrorDialogAsync(t,p.updatePackagesAsync,s).then((t=>{t?this.reloadHeaderAsync():e||this.openHome()})),pxt.perf.measureEnd("maybeShowPackageErrors"),!0}}return pxt.perf.measureEnd("maybeShowPackageErrors"),!1}typecheck(){this.typecheckDebouncer.trigger()}initEditors(){this.textEditor=new q.Editor(this),this.pxtJsonEditor=new z.Editor(this),this.serialEditor=new G.Editor(this),this.blocksEditor=new $.Editor(this),this.gitjsonEditor=new V.Editor(this),this.assetEditor=new W.AssetEditor(this);let e=()=>{this.editorFile&&(this.editorFile.inSyncWithEditor&&pxt.tickEvent("activity.edit",{editor:this.editor.getId().replace(/Editor$/,"")},{interactiveConsent:!0}),this.editorFile.markDirty()),this.lastChangeTime=Z.now(),this.state.simState!=pxt.editor.SimState.Stopped&&pxt.appTarget.simulator&&pxt.appTarget.simulator.stopOnChange&&this.stopSimulator(),this.editor.isIncomplete()||(this.editor==this.textEditor&&this.typecheckDebouncer.poke(),this.editorChangeHandler())};this.allEditors=[this.pxtJsonEditor,this.gitjsonEditor,this.blocksEditor,this.serialEditor,this.assetEditor,this.textEditor],this.allEditors.forEach((t=>t.changeCallback=e)),this.editor=this.allEditors[this.allEditors.length-1]}UNSAFE_componentWillMount(){this.initEditors(),this.initDragAndDrop()}componentDidMount(){this.allEditors.forEach((e=>e.prepare())),d.init(document.getElementById("boardview"),{orphanException:e=>{var t;null===(t=this.editor)||void 0===t||t.onExceptionDetected(e)},highlightStatement:(e,t)=>{if(this.state.debugging&&!d.driver.areBreakpointsSet()&&t&&!t.exceptionMessage){let e;if(this.isAnyEditeableJavaScriptOrPackageActive()||this.isPythonActive()?e=this.textEditor.getBreakpoints():this.isBlocksActive()&&(e=this.blocksEditor.getBreakpoints()),e=e||[],d.driver.setBreakpoints(e),-1===e.indexOf(t.breakpointId))return this.state.debugFirstRun?(this.dbgStepInto(),this.setState({debugFirstRun:!1})):this.dbgPauseResume(),!0}return!!this.editor&&this.editor.highlightStatement(e,t)},restartSimulator:()=>this.restartSimulator(),onStateChanged:e=>{const t=()=>this.allEditors.forEach((e=>e.simStateChanged()));switch(e){case pxsim.SimulatorState.Paused:case pxsim.SimulatorState.Unloaded:case pxsim.SimulatorState.Suspended:case pxsim.SimulatorState.Pending:case pxsim.SimulatorState.Stopped:this.setState({simState:pxt.editor.SimState.Stopped},t);break;case pxsim.SimulatorState.Running:this.setState({simState:pxt.editor.SimState.Running},t)}},onSimulatorReady:()=>{},setState:(e,t)=>{l.mainEditorPkg().setSimState(e,t)},editor:this.state.header?this.state.header.editor:""}),this.forceUpdate(),this.loadBlocklyAsync(),a.subscribe(this.highContrastSubscriber,B.HIGHCONTRAST),a.subscribe(this.cloudStatusSubscriber,`${j.HEADER_CLOUDSTATE}:*`)}componentWillUnmount(){a.unsubscribe(this.highContrastSubscriber),a.unsubscribe(this.cloudStatusSubscriber)}componentDidCatch(e,t){this.handleCriticalError(e,t)}handleCriticalError(e,t){try{c.killLoadingQueue(),pxsim.U.remove(document.getElementById("loading")),this.setState({hasError:!0}),pxt.tickEvent("pxt.criticalerror",{error:e||"",info:t||""});const i=pxt.storage.getLocal("lastcriticalerror")&&Date.parse(pxt.storage.getLocal("lastcriticalerror"));(!i||isNaN(i)||Date.now()-i>6e4)&&(pxt.storage.setLocal("lastcriticalerror",(new Date).toISOString()),setTimeout((()=>{this.reloadEditor()}),2e3))}catch(e){}}pickEditorFor(e){return this.allEditors.filter((t=>t.acceptsFile(e)))[0]}updateEditorFileAsync(e=null){if(!this.state.active||this.updatingEditorFile||this.state.currFile==this.editorFile&&!e)return void(this.state.editorPosition&&this.editorFile==this.state.editorPosition.file&&(this.editor.setViewState(this.state.editorPosition),this.setState({editorPosition:void 0})));let t=!1;return this.updatingEditorFile=!0,c.showLoadingAsync("updateeditorfile",lf("loading editor..."),Promise.resolve()).then((()=>(t=this.state.simState!=pxt.editor.SimState.Stopped,this.state.currFile.virtual||this.state.debugging||(this.stopSimulator(),(t||this.state.autoRun)&&(d.setPending(),this.setState({simState:pxt.editor.SimState.Pending}))),this.saveSettings(),this.openingTypeScript?Promise.resolve():this.saveFileAsync()))).then((()=>{this.editorFile=this.state.currFile;let t=this.editor;return this.prevEditorId=t.getId(),this.editor=e||this.pickEditorFor(this.editorFile),this.allEditors.forEach((e=>e.setVisible(e==this.editor))),t?t.unloadFileAsync():Promise.resolve()})).then((()=>{let e=this.getData(B.HIGHCONTRAST);return this.editor.loadFileAsync(this.editorFile,e)})).then((()=>{if(this.saveFileAsync(),this.editor!=this.textEditor&&this.editor!=this.blocksEditor||this.typecheck(),this.state.editorPosition)this.editor.setViewState(this.state.editorPosition),this.setState({editorPosition:void 0});else{const e=this.settings.fileHistory.find((e=>e.id==this.state.header.id&&e.name==this.editorFile.getName()));e&&this.editor.setViewState(e.pos)}S.SideDocs.notify({type:"fileloaded",name:this.editorFile.getName(),locale:pxt.Util.localeInfo()}),this.state.showBlocks&&this.editor==this.textEditor&&this.textEditor.openBlocks()})).finally((()=>{this.updatingEditorFile=!1,this.preserveUndoStack=!1,this.isJavaScriptActive()&&(this.openingTypeScript=!1),this.forceUpdate()})).then((()=>{this.state.currFile.virtual||!t||this.state.autoRun?this.typecheck():this.startSimulator()}))}setFile(e,t){if(!e)return;e.name===pxt.MAIN_TS&&(this.shouldTryDecompile=!0);const i=this.state.header;let n=!1;i&&"this"===(e.epkg&&e.epkg.getPkgId())&&(this.isBlocksFile(e.name)?(i.editor=pxt.BLOCKS_PROJECT_NAME,i.pubCurrent=!1,n=!0):this.isTypescriptFile(e.name)?(i.editor=pxt.JAVASCRIPT_PROJECT_NAME,i.pubCurrent=!1,n=!0):this.isPythonFile(e.name)&&(i.editor=pxt.PYTHON_PROJECT_NAME,i.pubCurrent=!1,n=!0),n&&l.mainPkg.setPreferredEditor(i.editor));const r={currFile:e,showBlocks:!1,embedSimView:!1,autoRun:this.autoRunOnStart()};void 0!==t&&(r.editorPosition={lineNumber:t,column:1,file:e}),this.setState(r)}setSideFile(e,t){e.name!=this.state.currFile.name&&pxt.editor.isBlocks(e)?(pxt.tickEvent("sidebar.showBlocks"),this.openBlocks()):((this.isTextEditor()||this.isPxtJsonEditor())&&(this.textEditor.giveFocusOnLoading=!1),this.setFile(e,t))}navigateToError(e){if(!e)return;let t=e.fileName;/^(pxt_modules|built)\//.test(t)||(t="this/"+t);let i=l.mainEditorPkg().lookupFile(t);i&&this.setSideFile(i,e.line+1)}removeFile(e,t=!1){const i=()=>{l.mainEditorPkg().removeFileAsync(e.name).then((()=>l.mainEditorPkg().saveFilesAsync())).then((()=>this.reloadHeaderAsync()))};t?i():c.confirmAsync({header:lf("Remove {0}",e.name),body:lf("You are about to remove a file from your project. You can't undo this. Are you sure?"),agreeClass:"red",agreeIcon:"trash",agreeLbl:lf("Remove it")}).then((e=>{e&&i()}))}updateFileAsync(e,t,i){const n=l.mainEditorPkg();return n.setContentAsync(e,t).then((()=>{i&&this.setFile(n.lookupFile("this/"+e))})).then((()=>this.reloadHeaderAsync()))}isSideDocExpanded(){const e=this.refs.sidedoc;return!!e&&!e.isCollapsed()}setSideMarkdown(e){let t=this.refs.sidedoc;t&&t.setMarkdown(e)}setSideDoc(e,t=!0){let i=this.refs.sidedoc;i&&(e?i.setPath(e,t):i.collapse())}setSideDocCollapsed(e=!0){let t=this.refs.sidedoc;t&&(e&&this.isSideDocExpanded()?t.collapse():e||this.isSideDocExpanded()||t.expand())}setTutorialInstructionsExpanded(e){const t=this.state.tutorialOptions;t.tutorialStepExpanded=e,t.autoexpandStep=e,this.setState({tutorialOptions:t},(()=>{this.editor==this.blocksEditor?this.blocksEditor.hideFlyout():this.editor==this.textEditor&&this.textEditor.hideFlyout()}))}setTutorialStep(e){var t;this.typecheckNow(),this.stopPokeUserActivity();let i=this.refs[se.tutorialCardId];if(this.isTutorial()&&e>-1){let n=this.state.tutorialOptions;n.tutorialStep=e,n.tutorialStepExpanded=!1,this.setState({tutorialOptions:n},(()=>{this.postTutorialProgress(),o.saveAsync(this.state.header)})),n.tutorialStepInfo[e].showHint&&i&&this.showTutorialHint(),n.tutorialStepInfo[e].tutorialCompleted&&pxt.commands.onTutorialCompleted&&pxt.commands.onTutorialCompleted(),this.editor.closeFlyout(),this.textEditor.giveFocusOnLoading&&this.isTextEditor()&&(null===(t=this.textEditor.editor)||void 0===t||t.focus()),pxt.appTarget.appTheme.tutorialCodeValidation&&this.editor.validateTutorialCode(this.state.tutorialOptions)}}setTutorialCodeStatus(e,t){const i=this.state.tutorialOptions,n=i.tutorialStepInfo[i.tutorialStep];i.metadata.tutorialCodeValidation&&(n.listOfValidationRules=t),this.setState({tutorialOptions:i})}postTutorialProgress(){var e,t,i,n,r,o,s,a,l,c,u;const d=(null===(e=this.state.tutorialOptions)||void 0===e?void 0:e.tutorialStep)||(null===(i=null===(t=this.state.header)||void 0===t?void 0:t.tutorialCompleted)||void 0===i?void 0:i.steps)||0,p=(null===(r=null===(n=this.state.tutorialOptions)||void 0===n?void 0:n.tutorialStepInfo)||void 0===r?void 0:r.length)||(null===(s=null===(o=this.state.header)||void 0===o?void 0:o.tutorialCompleted)||void 0===s?void 0:s.steps)||0,h=(null===(a=this.state.tutorialOptions)||void 0===a?void 0:a.tutorial)||(null===(l=this.state.header)||void 0===l?void 0:l.tutorialCompleted.id);pxt.editor.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"progress",currentStep:d,totalSteps:p,tutorialId:h,projectHeaderId:null===(c=this.state.header)||void 0===c?void 0:c.id,isCompleted:!!(null===(u=this.state.header)||void 0===u?void 0:u.tutorialCompleted)})}postTutorialLoaded(){var e,t;const i=(null===(e=this.state.tutorialOptions)||void 0===e?void 0:e.tutorial)||(null===(t=this.state.header)||void 0===t?void 0:t.tutorialCompleted.id);pxt.editor.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"loaded",tutorialId:i,projectHeaderId:this.state.header.id})}postTutorialCompleted(){var e,t;const i=(null===(e=this.state.tutorialOptions)||void 0===e?void 0:e.tutorial)||(null===(t=this.state.header)||void 0===t?void 0:t.tutorialCompleted.id);pxt.editor.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"completed",tutorialId:i,projectHeaderId:this.state.header.id})}postTutorialExit(){var e,t;const i=(null===(e=this.state.tutorialOptions)||void 0===e?void 0:e.tutorial)||(null===(t=this.state.header)||void 0===t?void 0:t.tutorialCompleted.id);pxt.editor.postHostMessageAsync({type:"pxthost",action:"tutorialevent",tutorialEvent:"exit",tutorialId:i,projectHeaderId:this.state.header.id})}handleMessage(e){switch(e.type){case"opendoc":window.open(e.url,"_blank"),this.setState({sideDocsCollapsed:!0,sideDocsLoadUrl:""});break;case"tutorial":switch(e.subtype){case"loaded":let t=e;t.toolboxSubset&&Object.keys(t.toolboxSubset).length>0&&(this.setState({editorState:{searchBar:!1,filters:{blocks:t.toolboxSubset,defaultState:pxt.editor.FilterState.Hidden}}}),this.editor.filterToolbox(t.showCategories));let i=this.state.tutorialOptions;i.tutorialReady=!0,i.tutorialStepInfo=t.stepInfo,this.setState({tutorialOptions:i},(()=>o.saveAsync(this.state.header))),i.tutorialStepInfo[0].showHint&&this.showTutorialHint(),c.hideLoading("tutorial");break;case"error":let n=e;pxt.reportException(n.message),c.errorNotification(lf("We're having trouble loading this tutorial, please try again later.")),this.setState({tutorialOptions:void 0});let r=l.mainEditorPkg().header;r.isDeleted=!0,r.tutorial=void 0,o.forceSaveAsync(r,{}).then((()=>{this.openHome()})).finally((()=>c.hideLoading("tutorial")))}}}reloadHeaderAsync(){return this.loadHeaderAsync(this.state.header,this.state.editorState)}tryCheckTargetVersionAsync(e){const t=e||"0.0.0";if(pxt.semver.majorCmp(t,pxt.appTarget.versions.target)<0&&pxt.tickEvent("patch.load.legacy",{targetVersion:t}),pxt.semver.majorCmp(t,pxt.appTarget.versions.target)>0){pxt.tickEvent("patch.load.future",{targetVersion:t});const e=[];return pxt.appTarget&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.homeUrl&&e.push({label:lf("Get latest"),icon:"external alternate",url:pxt.appTarget.appTheme.homeUrl}),c.dialogAsync({header:lf("Oops, this project is too new!"),body:lf("This project was created in a newer version of this editor. Please try again in that editor."),disagreeLbl:lf("Ok"),buttons:e}).then((()=>this.openHome()))}}async loadHeaderAsync(e,t,i=!0){if(!e)return Promise.resolve();const n=this.tryCheckTargetVersionAsync(e.targetVersion);if(n)return n.then((()=>this.openHome()));if(o.isHeadersSessionOutdated()&&(pxt.log("multi-tab sync before load"),await o.syncAsync()),i){const t=15e3,i=Z.nowSeconds();let n=!1;await Promise.race([pxt.U.delay(t).then((()=>{n=!0})),j.syncAsync({hdrs:[e],direction:"down"}).then((t=>{if(t.length){const r=Z.nowSeconds()-i;n?(pxt.tickEvent("identity.syncOnProjectOpen.timedout",{elapsedSec:r}),t.some((t=>t.id===e.id))&&j.forceReloadForCloudSync()):(pxt.tickEvent("identity.syncOnProjectOpen.syncSuccess",{elapsedSec:r}),e=o.getHeader(e.id))}}))])}e&&(o.acquireHeaderSession(e),await this.internalLoadHeaderAsync(e,t))}internalLoadHeaderAsync(e,t){var i;pxt.debug(`loading ${e.id} (pxt v${e.targetVersion})`),this.stopSimulator(!0),pxt.appTarget.simulator&&pxt.appTarget.simulator.aspectRatio&&d.driver.preload(pxt.appTarget.simulator.aspectRatio),this.clearSerial(),this.firstRun=!0,this.allEditors.forEach((e=>e.clearCaches())),this.setState({autoRun:this.autoRunOnStart(),tracing:void 0});const n=this.state.editorState;return n&&t&&(void 0===t.filters&&(t.filters=n.filters),void 0===t.hasCategories&&(t.hasCategories=n.hasCategories),void 0===t.searchBar&&(t.searchBar=n.searchBar)),this.hasCloudSync()&&(e.cloudUserId=null===(i=this.getUserProfile())||void 0===i?void 0:i.id),p.newProjectAsync().then((()=>e.backupRef?o.restoreFromBackupAsync(e):Promise.resolve())).then((()=>l.loadPkgAsync(e.id))).then((()=>(this.state&&this.state.header==e||this.showPackageErrorsOnNextTypecheck(),d.setDirty(),p.newProjectAsync()))).then((()=>p.applyUpgradesAsync())).then((()=>this.loadTutorialJresCodeAsync())).then((()=>this.loadTutorialCustomTsAsync())).then((()=>this.loadTutorialTemplateCodeAsync())).then((()=>{var i,n,r,s,a;const u=l.getEditorPkg(l.mainPkg);l.mainPkg.config.preferredEditor&&(e.editor=l.mainPkg.config.preferredEditor);let d=u.getMainFile();const p=e.editor!=pxt.BLOCKS_PROJECT_NAME&&this.settings.fileHistory.filter((t=>t.id==e.id))[0];if(p){const e=u.lookupFile(p.name);e?d=e:"ts"===l.getExtensionOfFileName(p.name)?d=u.lookupFile("this/"+d.getFileNameWithExtension("ts"))||d:"py"===l.getExtensionOfFileName(p.name)&&(d=u.lookupFile("this/"+d.getFileNameWithExtension("py"))||d)}const h=l.mainPkg.config.name;e.name=h||lf("Untitled"),!p&&e.editor&&d.getVirtualFileName(e.editor)&&(d=u.lookupFile("this/"+d.getVirtualFileName(e.editor))||d),pxt.editor.isBlocks(d)&&!d.content&&(d.content||(d=u.lookupFile("this/"+d.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME))||d));const f=null===(n=null===(i=e.tutorial)||void 0===i?void 0:i.metadata)||void 0===n?void 0:n.preferredEditor;f&&(d=u.lookupFile("this/"+be(f))||d),d.name===pxt.MAIN_TS&&(this.shouldTryDecompile=!0),this.setState({home:!1,showFiles:!!e.githubId,editorState:t,tutorialOptions:e.tutorial,header:e,projectName:e.name,currFile:d,sideDocsLoadUrl:"",debugging:!1}),l.getEditorPkg(l.mainPkg).onupdate=()=>{this.loadHeaderAsync(e,this.state.editorState)},l.mainPkg.getCompileOptionsAsync().catch((e=>{if(e instanceof pxt.cpp.PkgConflictError){const t=e,i=e=>({label:lf("Remove {0}",e.id),class:"pink",icon:"trash",onclick:()=>{c.showLoading("removedep",lf("Removing {0}...",e.id)),l.mainEditorPkg().removeDepAsync(e.id).then((()=>this.reloadHeaderAsync())).finally((()=>c.hideLoading("removedep")))}});c.dialogAsync({hideCancel:!0,buttons:[i(t.pkg1),i(t.pkg0)],header:lf("Extensions cannot be used together"),body:lf("Extensions '{0}' and '{1}' cannot be used together, because they use incompatible settings ({2}).",t.pkg1.id,t.pkg0.id,t.settingName)})}}));const m=this.pickEditorFor(d),g=null===(s=null===(r=null==l?void 0:l.mainPkg)||void 0===r?void 0:r.config)||void 0===s?void 0:s.documentation;if(g)this.setSideDoc(g,m==this.blocksEditor);else{const t=u.lookupFile("this/README.md"),i=null===(a=null==t?void 0:t.content)||void 0===a?void 0:a.trim();e.githubId||!i||/#{2,}\s+@autoOpen\s+false\s*/i.test(i)||this.setSideMarkdown(t.content)}return o.saveAsync(e)})).then((()=>this.loadTutorialFiltersAsync())).finally((()=>{pxt.BrowserUtils.changeHash("#editor",!0),document.getElementById("root").focus(),h.maybeReconnectAsync(!1,!0),this.editorLoaded()}))}loadTutorialFiltersAsync(){const e=l.mainEditorPkg().header;if(!e||!e.tutorial||!e.tutorial.tutorialMd)return Promise.resolve();pxt.perf.measureStart("loadTutorial loadBlockly");const t=e.tutorial;return"string"==typeof t.tutorialCode&&(t.tutorialCode=[t.tutorialCode]),this.loadBlocklyAsync().then((()=>k.getUsedBlocksAsync(t.tutorialCode,t.tutorial,t.language))).then((i=>{let n={searchBar:!1};(null==i?void 0:i.usedBlocks)&&Object.keys(i.usedBlocks).length>0&&(n.filters={blocks:i.usedBlocks,defaultState:pxt.editor.FilterState.Hidden},n.hasCategories=!(e.tutorial.metadata&&e.tutorial.metadata.flyoutOnly)),this.setState({editorState:n}),this.editor.filterToolbox(!0),t.tutorialStepInfo[e.tutorial.tutorialStep].showHint&&this.showTutorialHint()})).catch((e=>{pxt.tickEvent("tutorial.faileddecompile",{tutorial:t.tutorial}),this.setState({editorState:{searchBar:!1,filters:void 0}}),c.warningNotification(lf("Could not filter tutorial blocks, displaying full toolbox."))})).finally((()=>{pxt.perf.measureEnd("loadTutorial loadBlockly")}))}async loadTutorialTemplateCodeAsync(){var e;const t=l.mainEditorPkg().header;if(!t||!t.tutorial||!t.tutorial.templateCode||t.tutorial.templateLoaded)return;const i=t.tutorial.templateCode;t.tutorial.templateLoaded=!0;let n=await o.getTextAsync(t.id);const r=null===(e=t.tutorial.metadata)||void 0===e?void 0:e.preferredEditor;r&&be(r)===pxt.ASSETS_FILE&&(n[pxt.MAIN_TS]=i);const s=function(e){switch(e.toLowerCase()){case"javascript":case"js":case pxt.JAVASCRIPT_PROJECT_NAME:return pxt.JAVASCRIPT_PROJECT_NAME;case"python":case"py":case pxt.PYTHON_PROJECT_NAME:return pxt.PYTHON_PROJECT_NAME;case"blocks":case pxt.BLOCKS_PROJECT_NAME:default:return pxt.BLOCKS_PROJECT_NAME}}(r||t.editor);if(s===pxt.JAVASCRIPT_PROJECT_NAME)n[pxt.MAIN_TS]=i;else if(s===pxt.PYTHON_PROJECT_NAME){const e=await p.decompilePythonSnippetAsync(i);e&&(n[pxt.MAIN_PY]=e)}else{const e=(await p.decompileBlocksSnippetAsync(i)).outfiles[pxt.MAIN_BLOCKS];e&&(n[pxt.MAIN_BLOCKS]=e)}let a,c,u=n;if(t.tutorial.mergeHeaderId){const e=o.getHeader(t.tutorial.mergeHeaderId);if(e){const i=await o.getTextAsync(e.id);u=te.mergeProjectCode(i,n,!!t.tutorial.mergeCarryoverCode)}}for(const e of Object.keys(u))void 0!==u[e]&&l.mainEditorPkg().setFile(e,u[e]);await o.saveAsync(t);try{a=u[pxt.TILEMAP_JRES]?JSON.parse(u[pxt.TILEMAP_JRES]):null,c=u[pxt.IMAGES_JRES]?JSON.parse(u[pxt.IMAGES_JRES]):null}catch(e){return Promise.reject(e)}const d=pxt.react.getTilemapProject();a&&d.loadTilemapJRes(pxt.inflateJRes(a),!0),c&&d.loadAssetsJRes(pxt.inflateJRes(c)),await l.mainEditorPkg().buildAssetsAsync(),await l.mainEditorPkg().saveFilesAsync()}loadTutorialJresCodeAsync(){var e,t;const i=l.mainEditorPkg().header;if(!i||!i.tutorial||!i.tutorial.jres&&!i.tutorial.assetFiles)return Promise.resolve();const n=i.tutorial.jres||(null===(e=i.tutorial.assetFiles)||void 0===e?void 0:e[pxt.TILEMAP_JRES]),r=null===(t=i.tutorial.assetFiles)||void 0===t?void 0:t[pxt.IMAGES_JRES];let o,s;delete i.tutorial.jres,delete i.tutorial.assetFiles;try{o=n?JSON.parse(n):null,s=r?JSON.parse(r):null}catch(e){return Promise.reject(e)}const a=pxt.react.getTilemapProject();return o&&a.loadTilemapJRes(pxt.inflateJRes(o),!0),s&&a.loadAssetsJRes(pxt.inflateJRes(s)),l.mainEditorPkg().buildAssetsAsync()}async loadTutorialCustomTsAsync(){const e=l.mainEditorPkg(),t=e.header;if(!t||!t.tutorial||!t.tutorial.customTs)return Promise.resolve();const i=t.tutorial.customTs;return await e.setContentAsync(pxt.TUTORIAL_CUSTOM_TS,i),await e.saveFilesAsync(),Promise.resolve()}async resetTutorialTemplateCode(e){var t;const i=l.mainEditorPkg(),n=i.header;if(null===(t=null==n?void 0:n.tutorial)||void 0===t?void 0:t.templateCode){if(e){let e=await o.getTextAsync(n.id);const t=te.appendTemporaryAssets(e[pxt.MAIN_BLOCKS],e[pxt.IMAGES_JRES]);l.mainEditorPkg().setFile(pxt.IMAGES_JRES,t),await i.saveFilesAsync()}n.tutorial.templateLoaded=!1,delete n.tutorial.mergeHeaderId,await this.reloadHeaderAsync()}}removeProject(){l.mainEditorPkg().header&&c.confirmDelete(l.mainEditorPkg().header.name,(()=>{let e=l.mainEditorPkg().header;return e.isDeleted=!0,o.forceSaveAsync(e,{}).then((()=>this.openHome()))}))}isHexFile(e){return/\.(hex|uf2)$/i.test(e)}isBlocksFile(e){return/\.blocks$/i.test(e)}isTypescriptFile(e){return/\.ts$/i.test(e)}isPythonFile(e){return/\.py$/i.test(e)}isProjectFile(e){return/\.(pxt|mkcd|mkcd-\w+)$/i.test(e)}isPNGFile(e){return pxt.appTarget.compile.saveAsPNG&&/\.png$/i.test(e)}isAssetFile(e){let t=pxt.appTarget.runtime?pxt.appTarget.runtime.assetExtensions:null;if(t){let i=e.replace(/.*\./,"").toLowerCase();return t.indexOf(i)>=0}return!1}importProjectCoreAsync(e,t){return(e[0]=="{".charCodeAt(0)?Promise.resolve(pxt.U.uint8ArrayToString(e)):pxt.lzmaDecompressAsync(e)).then((e=>{let i=JSON.parse(e);if(i.target&&i.target==pxt.appTarget.id)i.xml.forEach((e=>{let t=pxt.Util.htmlUnescape(e.replace(/^"|"$/g,""));pxt.blocks.loadBlocksXml(this.blocksEditor.editor,t)}));else{let e=i;this.importHex(e,t)}})).catch((e=>{c.warningNotification(lf("Sorry, we could not import this project or block snippet.")),this.openHome()}))}importHexFile(e,t){e&&pxt.cpp.unpackSourceFromHexFileAsync(e).then((e=>this.importHex(e,t))).catch((e=>{pxt.reportException(e),c.warningNotification(lf("Sorry, we could not recognize this file."))}))}importBlocksFiles(e,t){e&&ts.pxtc.Util.fileReadAsTextAsync(e).then((t=>{this.newProject({filesOverride:{[pxt.MAIN_BLOCKS]:t,[pxt.MAIN_TS]:"  "},name:e.name.replace(/\.blocks$/i,"")||lf("Untitled")})}))}importTypescriptFile(e,t){e&&ts.pxtc.Util.fileReadAsTextAsync(e).then((t=>{this.newProject({filesOverride:{[pxt.MAIN_BLOCKS]:"",[pxt.MAIN_TS]:t||"  "},name:e.name.replace(/\.ts$/i,"")||lf("Untitled")})}))}importProjectFile(e,t){e&&ts.pxtc.Util.fileReadAsBufferAsync(e).then((e=>this.importProjectCoreAsync(e,t)))}importPNGFile(e,t){e&&ts.pxtc.Util.fileReadAsBufferAsync(e).then((e=>pxt.Util.decodeBlobAsync("data:image/png;base64,"+btoa(pxt.Util.uint8ArrayToString(e))))).then((e=>this.importProjectCoreAsync(e,t)))}importPNGBuffer(e){pxt.Util.decodeBlobAsync("data:image/png;base64,"+btoa(pxt.Util.uint8ArrayToString(new Uint8Array(e)))).then((e=>this.importProjectCoreAsync(e)))}importAssetFile(e){ts.pxtc.Util.fileReadAsBufferAsync(e).then((t=>{let i=e.name.replace(/.*[\/\\]/,"");return l.mainEditorPkg().saveAssetAsync(i,t)}))}importHex(e,t){if(!e||!e.meta){if(!e||!e[pxt.CONFIG_NAME])return c.warningNotification(lf("Sorry, we could not recognize this file.")),void(t&&t.openHomeIfFailed&&this.openHome());e=s.reconstructMeta(e)}if("object"==typeof e.source&&(e.source=JSON.stringify(e.source)),this.hexFileImporters.some((t=>"default"==t.id&&t.canImport(e)))){const i=this.tryCheckTargetVersionAsync(e.meta.targetVersions&&e.meta.targetVersions.target);if(i)return void i.then((()=>{t&&t.openHomeIfFailed&&this.newProject()}))}if(t&&t.extension){if(pxt.tickEvent("import.extension"),ts.pxtc.Util.jsonTryParse(e.source)){const t=e.meta.name,i=`${e.meta.name}.json`,n=l.mainEditorPkg();n&&(pxt.debug(`adding ${i} to package`),n.setContentAsync(i,e.source).then((()=>n.updateConfigAsync((e=>{e.dependencies||(e.dependencies={}),e.dependencies[t]=`pkg:${i}`})))).then((()=>this.reloadHeaderAsync())))}return}const i=this.hexFileImporters.filter((t=>t.canImport(e)))[0];i?(pxt.tickEvent("import",{id:i.id}),c.hideDialog(),c.showLoading("importhex",lf("loading project...")),pxt.editor.initEditorExtensionsAsync().then((()=>i.importAsync(this,e).then((()=>c.hideLoading("importhex")),(e=>{pxt.reportException(e,{importer:i.id}),c.hideLoading("importhex"),c.errorNotification(lf("Oops, something went wrong when importing your project")),t&&t.openHomeIfFailed&&this.openHome()}))))):(c.warningNotification(lf("Sorry, we could not import this project.")),pxt.tickEvent("warning.importfailed"),t&&t.openHomeIfFailed&&this.openHome())}importProjectAsync(e,t){let i=e.header;return i||(i={target:pxt.appTarget.id,targetVersion:void 0,editor:pxt.BLOCKS_PROJECT_NAME,name:lf("Untitled"),meta:{},pubId:"",pubCurrent:!1}),o.installAsync(i,e.text).then((e=>this.loadHeaderAsync(e,t)))}importTutorialAsync(e){try{const{options:t,editor:i}=pxt.tutorial.getTutorialOptions(e,"untitled","untitled","",!1),n=pxt.gallery.parsePackagesFromMarkdown(e);return this.hintManager.clearViewedHints(),this.createProjectAsync({name:"untitled",tutorial:t,preferredEditor:i,dependencies:n})}catch(e){return Z.userError(lf("Could not import tutorial")),Promise.reject(e)}}async importSkillmapProjectAsync(e){const t=new pxt.skillmap.IndexedDBWorkspace;await t.initAsync();const i=await t.getProjectAsync(e);if(i&&!i.deleted)return i.header.tutorial&&(i.header.tutorialCompleted={id:i.header.tutorial.tutorial,steps:i.header.tutorial.tutorialStepInfo.length},delete i.header.tutorial),this.importProjectAsync(i);const n=o.getHeader(e);if(!n)return void Z.userError(lf("Unable to import skillmap project"));const r=await o.duplicateAsync(n);r.tutorial&&(r.tutorialCompleted={id:r.tutorial.tutorial,steps:r.tutorial.tutorialStepInfo.length},delete r.tutorial),r.isSkillmapProject=!1,await o.saveAsync(r),a.invalidate("headers:"),await this.loadHeaderAsync(r)}openProjectByHeaderIdAsync(e){const t=o.getHeader(e);return this.loadHeaderAsync(t)}initDragAndDrop(){K.setupDragAndDrop(document.body,(e=>e.size<1e6&&this.isHexFile(e.name)||this.isBlocksFile(e.name)),(e=>{e&&(pxt.tickEvent("dragandrop.open"),this.importFile(e[0]))}),(e=>{this.isPNGFile(e)&&pxt.Util.httpRequestCoreAsync({url:e,method:"GET",responseArrayBuffer:!0}).then((t=>this.importUri(e,t.buffer))).catch((e=>c.handleNetworkError(e)))}))}importUri(e,t){this.isPNGFile(e)&&this.importPNGBuffer(t)}importFile(e,t){if(e&&!pxt.shell.isReadOnly())if(this.isHexFile(e.name))this.importHexFile(e,t);else if(this.isBlocksFile(e.name))this.importBlocksFiles(e,t);else if(this.isTypescriptFile(e.name))this.importTypescriptFile(e,t);else if(this.isProjectFile(e.name))this.importProjectFile(e,t);else if(this.isAssetFile(e.name))this.importAssetFile(e);else if(this.isPNGFile(e.name))this.importPNGFile(e,t);else{const t=this.resourceImporters.filter((t=>t.canImport(e)))[0];t?t.importAsync(this,e):c.warningNotification(lf("Oops, don't know how to load this file!"))}}importProjectFromFileAsync(e,t){return pxt.lzmaDecompressAsync(e).then((e=>{let i=JSON.parse(e);return this.importHex(i,t)})).catch((()=>this.newProject()))}syncPreferredEditor(){const e=this.getPreferredEditor();e&&l.mainPkg.setPreferredEditor(e)}exportProjectToFileAsync(){return this.syncPreferredEditor(),l.mainPkg.compressToFileAsync()}exportAsync(){return pxt.debug("exporting project"),this.exportProjectToFileAsync().then((e=>ts.pxtc.encodeBase64(Z.uint8ArrayToString(e))))}downloadScreenshotAsync(){return pxt.appTarget.compile.saveAsPNG?this.saveProjectAsPNGAsync(!1):this.requestScreenshotAsync().then((e=>pxt.BrowserUtils.browserDownloadDataUri(e,l.genFileName(".png"))))}pushScreenshotHandler(e){this.screenshotHandlers.push(e)}popScreenshotHandler(){this.screenshotHandlers.pop()}requestScreenshotAsync(){return this.requestScreenshotPromise?this.requestScreenshotPromise:(this.setState({screenshoting:!0}),d.driver.postMessage({type:"screenshot"}),Z.promiseTimeout(1e3,this.requestScreenshotPromise=new Promise(((e,t)=>{this.pushScreenshotHandler((t=>e(pxt.BrowserUtils.imageDataToPNG(t.data,3))))}))).catch((e=>{pxt.tickEvent("screenshot.timeout")})).finally((()=>{this.popScreenshotHandler(),this.requestScreenshotPromise=void 0,this.setState({screenshoting:!1})})))}encodeProjectAsPNGAsync(e,t){return this.exportProjectToFileAsync().then((t=>m.encodeBlobAsync(this.state.header.name,e,t))).then((e=>{const i=l.genFileName(".png");return pxt.BrowserUtils.browserDownloadDataUri(e,i),t?c.dialogAsync({header:lf("Project Saved!"),disagreeLbl:lf("Got it!"),disagreeClass:"green",hasCloseIcon:!1,jsx:n.createElement("div",{className:"ui items"},n.createElement("div",{className:"item"},n.createElement("div",{className:"ui small image"},n.createElement("a",{download:i,className:"ui link",href:e},n.createElement("img",{src:e,alt:lf("Project cartridge"),title:lf("Click to download again")}))),n.createElement("div",{className:"content"},n.createElement("div",{className:"description"},n.createElement("p",null,lf("Your project is saved in this image."),n.createElement("br",null),lf("Import or drag it into the editor to reload it."))))))}):Promise.resolve()}))}saveProjectAsPNGAsync(e){return this.requestScreenshotAsync().then((t=>this.encodeProjectAsPNGAsync(t,e)))}saveProjectToFileAsync(){const e=l.mainPkg;return me()?(pxt.BrowserUtils.browserDownloadText(e.readFile(pxt.MAIN_BLOCKS),l.genFileName(".blocks"),{contentType:"application/xml"}),Promise.resolve()):ge()?this.saveTutorialTemplateAsync():pxt.commands.saveProjectAsync?(c.infoNotification(lf("Saving...")),this.syncPreferredEditor(),e.saveToJsonAsync().then((e=>pxt.commands.saveProjectAsync(e)))):pxt.appTarget.compile.saveAsPNG?this.saveProjectAsPNGAsync(!0):this.exportProjectToFileAsync().then((e=>{const t=l.genFileName(".mkcd");pxt.BrowserUtils.browserDownloadUInt8Array(e,t,{contentType:"application/octet-stream"})}))}openHome(){!pxt.shell.isControllerMode()&&!pxt.appTarget.appTheme.lockedEditor&&this.unloadProjectAsync(!0)}homeLoaded(){pxt.tickEvent("app.home")}editorLoaded(){pxt.tickEvent("app.editor")}unloadProjectAsync(e){return this.stopSimulator(!0),this.showKeymap(!1),h.disconnectAsync(),this.editor&&this.editor.unloadFileAsync(),this.extensions.unload(),this.editorFile=void 0,e&&pxt.BrowserUtils.changeHash("",!0),this.setStateAsync({home:void 0!==e?e:this.state.home,tracing:void 0,fullscreen:void 0,tutorialOptions:void 0,editorState:void 0,debugging:void 0,header:void 0,currFile:void 0,fileState:void 0}).then((()=>(this.allEditors.forEach((e=>e.setVisible(!1))),e&&(this.homeLoaded(),this.showPackageErrorsOnNextTypecheck()),o.syncAsync()))).then((()=>{}))}reloadEditor(){try{window.removeEventListener("hashchange",fe),ne&&(pxt.BrowserUtils.isIFrame()&&("pub"===ne.cmd||"sandbox"===ne.cmd)||"tutorial"==ne.cmd)?location.hash=`#${ne.cmd}:${ne.arg}`:this.state&&this.state.home?location.hash="#reload":this.state&&this.state.header&&!this.state.header.isDeleted&&(location.hash="#editor"),location.reload()}catch(e){pxt.reportException(e),location.reload()}}getPreferredEditor(){if(this.editor==this.blocksEditor)return pxt.BLOCKS_PROJECT_NAME;if(this.editor==this.textEditor)switch(this.textEditor.fileType){case"python":return pxt.PYTHON_PROJECT_NAME;default:return pxt.JAVASCRIPT_PROJECT_NAME}}openExtension(e,t){pxt.tickEvent("app.openextension",{extension:e}),this.extensions.showExtensionAsync(e,t)}handleExtensionRequest(e){this.extensions.handleExtensionRequest(e)}newEmptyProject(e,t,i){this.newProject({filesOverride:{[pxt.MAIN_BLOCKS]:'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>'},name:e,documentation:t,preferredEditor:i,filters:{}})}newProject(e={}){return pxt.tickEvent("app.newproject"),c.showLoading("newproject",lf("creating new project...")),this.createProjectAsync(e).then((()=>this.autoChooseBoardAsync())).then((()=>Z.delay(500))).finally((()=>c.hideLoading("newproject")))}async createProjectAsync(e){var t;pxt.perf.measureStart("createProjectAsync"),this.setSideDoc(void 0),e.prj||(e.prj=pxt.appTarget.blocksprj);let i=pxt.U.clone(e.prj.config);i.name=e.name||lf("Untitled"),i.documentation=e.documentation;let n=Z.clone(e.prj.files);if(e.filesOverride&&(Z.jsonCopyFrom(n,e.filesOverride),Object.keys(e.filesOverride).forEach((e=>{-1===i.files.indexOf(e)&&i.files.push(e)}))),e.dependencies&&Z.jsonMergeFrom(i.dependencies,e.dependencies),e.extensionUnderTest){const t=o.getHeader(e.extensionUnderTest);t&&(i.dependencies[t.name]=`workspace:${t.id}`)}if(e.tsOnly&&(e.languageRestriction="no-blocks"),e.preferredEditor&&(i.preferredEditor=e.preferredEditor),e.languageRestriction){let t=/\.(blocks)$/;"javascript-only"===e.languageRestriction?(t=/\.(py|blocks)$/,i.preferredEditor=pxt.JAVASCRIPT_PROJECT_NAME):"python-only"===e.languageRestriction&&(i.preferredEditor=pxt.PYTHON_PROJECT_NAME),i.languageRestriction=e.languageRestriction,i.files=i.files.filter((e=>!t.test(e))),delete n[pxt.MAIN_BLOCKS]}i.preferredEditor==pxt.PYTHON_PROJECT_NAME&&i.files.indexOf(pxt.MAIN_PY)<0&&(i.files.push(pxt.MAIN_PY),n[pxt.MAIN_PY]||(n[pxt.MAIN_PY]="\n")),e.tutorial&&e.tutorial.metadata&&(e.tutorial.metadata.codeStart&&(n[pxt.TUTORIAL_CODE_START]=`control._onCodeStart('${pxt.U.htmlEscape(e.tutorial.metadata.codeStart)}')`,i.files.splice(i.files.indexOf(pxt.MAIN_TS),0,pxt.TUTORIAL_CODE_START)),e.tutorial.metadata.codeStop&&(n[pxt.TUTORIAL_CODE_STOP]=`control._onCodeStop('${pxt.U.htmlEscape(e.tutorial.metadata.codeStop)}')`,i.files.push(pxt.TUTORIAL_CODE_STOP))),n[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(i),await pxt.github.cacheProjectDependenciesAsync(i);const r=await o.installAsync({name:i.name,meta:{},editor:e.preferredEditor||e.prj.id,pubId:"",pubCurrent:!1,target:pxt.appTarget.id,targetVersion:pxt.appTarget.versions.target,cloudUserId:null===(t=this.getUserProfile())||void 0===t?void 0:t.id,temporary:e.temporary,tutorial:e.tutorial,extensionUnderTest:e.extensionUnderTest,isSkillmapProject:e.skillmapProject},n);await this.loadHeaderAsync(r,{filters:e.filters}),pxt.perf.measureEnd("createProjectAsync")}autoChooseBoardAsync(e){return pxt.appTarget.appTheme.chooseBoardOnNewProject&&pxt.appTarget.simulator&&pxt.appTarget.simulator.dynamicBoardDefinition?this.showBoardDialogAsync(e,!1):Promise.resolve()}importExampleAsync(e){const{name:t,path:i,loadBlocks:n,prj:r,preferredEditor:o}=e;return c.showLoading("changingcode",lf("loading...")),this.loadingExample=!0,this.loadActivityFromMarkdownAsync(i,t.toLowerCase(),o).then((e=>{const{filename:t,md:i,features:s,autoChooseBoard:a}=e||{},l=!r&&a,c=!!i&&pxt.gallery.parseExampleMarkdown(t,i);if(!c)throw new Error(lf("Example not found or invalid format"));const u=c;return r&&(u.prj=r),n&&o==pxt.BLOCKS_PROJECT_NAME?this.createProjectAsync(u).then((()=>this.loadBlocklyAsync().then(p.getBlocksAsync).then((e=>p.decompileAsync(pxt.MAIN_TS,e))).then((e=>{pxt.debug(`example decompilation: ${e.success}`),e.success&&this.overrideBlocksFile(e.outfiles[pxt.MAIN_BLOCKS])})).then((()=>l&&this.autoChooseBoardAsync(s))))):(n||(u.languageRestriction="no-blocks"),u.preferredEditor=o,this.createProjectAsync(u).then((()=>o==pxt.PYTHON_PROJECT_NAME&&"python"!==c.snippetType?p.getApisInfoAsync().then((()=>p.pyDecompileAsync(pxt.MAIN_TS))).then((e=>{pxt.debug(`example decompilation: ${e.success}`),e.success&&this.overrideTypescriptFile(e.outfiles[pxt.MAIN_PY])})).then((()=>l&&this.autoChooseBoardAsync(s))):Promise.resolve())))})).catch((e=>(c.warningNotification(lf("Please check your internet connection and check the example is valid.")),pxt.reportException(e),Promise.reject(e)))).finally((()=>{this.loadingExample=!1,c.hideLoading("changingcode")}))}switchTypeScript(){const e=l.mainEditorPkg(),t=this.editorFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),i=e.files[t];this.setFile(i)}saveBlocksToTypeScriptAsync(){return this.blocksEditor.saveToTypeScriptAsync()}saveVirtualFileAsync(e,t,i){t=t||"\n";const n=l.mainEditorPkg(),r=this.editorFile.getVirtualFileName(e);return Z.assert(r!=this.editorFile.name),n.setContentAsync(r,t).then((()=>{if(i){let e=n.files[r];this.setFile(e)}}))}saveTypeScriptAsync(e=!1){const t=l.mainEditorPkg();if(!this.editor||!this.state.currFile||this.editorFile.epkg!=t||this.reload)return Promise.resolve();const i=this.editorFile.getExtension(),n=this.editorFile.content;let r=e?this.textEditor.loadMonacoAsync():Promise.resolve();return"py"==i&&(r=r.then((()=>this.saveCurrentSourceAsync()))),r=r.then((()=>{if(e){this.openingTypeScript=!0;const e=t.getCachedTranspile(i,n,"ts");return e?Promise.resolve(e):this.editor.saveToTypeScriptAsync(!0).then((e=>(void 0!==e&&t.cacheTranspile(i,n,"ts",e),e)))}return this.editor.saveToTypeScriptAsync()})).then((t=>void 0===t&&e?c.confirmAsync({header:lf("Oops, there is a problem converting your code."),body:lf("We are unable to convert your code to JavaScript."),agreeLbl:lf("Done"),agreeClass:"cancel",agreeIcon:"cancel",hasCloseIcon:!0}).then((e=>{this.isPythonActive()&&pxt.shell.setEditorLanguagePref("py")})):void 0===t||this.editorFile&&this.editorFile.name==this.editorFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)?Promise.resolve():this.saveVirtualFileAsync(pxt.JAVASCRIPT_PROJECT_NAME,t,e))),e?c.showLoadingAsync("switchtojs",lf("switching to JavaScript..."),r,0):r}resetWorkspace(){return this.reload=!0,window.location.hash="#reload",o.resetAsync().then((()=>this.reloadEditor()),(()=>this.reloadEditor()))}pairAsync(){return h.pairAsync()}saveAndCompile(){if(this.state.header)return this.setState({isSaving:!0}),(this.state.projectName!==lf("Untitled")?Promise.resolve(!0):this.showRenameProjectDialogAsync()).then((e=>e?this.saveProjectNameAsync().then((()=>this.saveFileAsync())).then((()=>{!pxt.appTarget.compile.hasHex||pxt.appTarget.compile.useMkcd||pxt.appTarget.compile.saveAsPNG||me()||ge()?this.saveProjectToFileAsync().finally((()=>{this.setState({isSaving:!1})})):this.compile(!0)})):(this.setState({isSaving:!1}),Promise.resolve())))}checkForHwVariant(){if(pxt.hwVariant||!pxt.hasHwVariants())return!1;const e=pxt.getHwVariants();if(0==e.length)return!1;return pxt.usb.isEnabled&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.checkForHwVariantWebUSB&&this.checkWebUSBVariant?(pxt.packetio.initAsync(!0).then((t=>{if(t.familyID)for(let i of e){let e=pxt.U.clone(pxt.appTarget.compile);if(i.compileServiceVariant){let t=pxt.appTarget.variants[i.compileServiceVariant];t.compile&&pxt.U.jsonCopyFrom(e,t.compile)}if(parseInt(e.uf2Family)===t.familyID)return pxt.setHwVariant(i.name),pxt.tickEvent("projects.choosehwvariant",{hwid:pxt.hwVariant,card:"HID-"+pxt.hwVariant}),void this.reloadHeaderAsync().then((()=>this.compile()))}this.checkWebUSBVariant=!1,this.checkForHwVariant()}),(()=>h.pairAsync().then((()=>{this.checkForHwVariant()}),(e=>{this.checkWebUSBVariant=!1,this.checkForHwVariant()})))).then((()=>{pxt.perf.recordMilestone("HID bridge init finished")})),!0):(this.showChooseHwDialog(),!0)}beforeCompile(){}async compile(e=!1){var t;if(pxt.tickEvent("compile",{editor:this.getPreferredEditor()}),pxt.debug("compiling..."),this.checkForHwVariant())return;if(pxt.appTarget.compile.saveAsPNG&&pxt.hasHwVariants()&&!pxt.hwVariant)return void this.saveAndCompile();let i;if(this.beforeCompile(),pxt.appTarget.compile.useModulator||!pxt.BrowserUtils.isBrowserDownloadInSameWindow()||pxt.BrowserUtils.isBrowserDownloadWithinUserContext()||(i=window.open("")),this.state.compiling)return void pxt.tickEvent("compile.double");let n=this.state.simState!=pxt.editor.SimState.Stopped;n&&this.state.simState==pxt.editor.SimState.Pending&&pxt.appTarget.simulator.emptyRunCode&&!this.isBlocksEditor()&&(n=!1);try{this.setState({compiling:!0,cancelledDownload:!1}),this.clearSerial(),this.editor.beforeCompile(),n&&this.stopSimulator();let r=this.editor.snapshotState();this.syncPreferredEditor();try{const o=await p.compileAsync({native:!0,forceEmit:!0});if(!(this.editor.setDiagnostics(this.editorFile,r),e||await h.showUnsupportedHardwareMessageAsync(o)))return void this.setState({cancelledDownload:!0});let s=pxt.outputName();if(!o.outfiles[s]){pxt.tickEvent("compile.noemit");const e=null===(t=o.diagnostics)||void 0===t?void 0:t.find((e=>9043===e.code));return void(e?c.warningNotification(e.messageText):c.warningNotification(lf("Compilation failed, please check your code for errors.")))}o.saveOnly=e,o.userContextWindow=i,o.downloadFileBaseName=l.genFileName(""),o.confirmAsync=c.confirmAsync;let a=this.state.header;if(a&&(o.headerId=a.id),pxt.commands.patchCompileResultAsync&&await pxt.commands.patchCompileResultAsync(o),e)return void await pxt.commands.saveOnlyAsync(o);o.success||this.maybeShowPackageErrors(!0)||c.confirmAsync({header:lf("Compilation failed"),body:lf("Ooops, looks like there are errors in your program."),hideAgree:!0,disagreeLbl:lf("Close")}),n&&(this.runSimulator(),n=!1);let u=Date.now();pxt.tickEvent("deploy.start");try{await pxt.commands.deployAsync(o,{reportError:e=>{pxt.tickEvent("deploy.reporterror"),c.errorNotification(e)},showNotification:e=>c.infoNotification(e)});let e=Date.now()-u;pxt.tickEvent("deploy.finished",{elapsedMs:e})}catch(e){if(e.notifyUser)c.warningNotification(e.message);else{const e=pxt.appTarget.appTheme.useUploadMessage?lf("Upload failed, please try again."):lf("Download failed, please try again.");c.warningNotification(e)}let t=Date.now()-u;if(pxt.tickEvent("deploy.exception",{notifyUser:e.notifyUser,elapsedMs:t}),pxt.reportException(e),i)try{i.close()}catch(e){}}}catch(e){if(pxt.reportException(e),c.errorNotification(lf("Compilation failed, please contact support.")),i)try{i.close()}catch(e){}}finally{this.setState({compiling:!1,isSaving:!1}),n&&this.runSimulator()}}catch(e){this.setState({compiling:!1,isSaving:!1}),pxt.reportException(e),c.errorNotification(lf("Compilation failed, please try again."))}}overrideTypescriptFile(e){this.textEditor&&this.textEditor.overrideFile(e)}overrideBlocksFile(e){this.blocksEditor&&this.blocksEditor.overrideFile(e)}async setLanguageRestrictionAsync(e){if(this.state.header){const t=l.mainEditorPkg(),i=t.files["pxt.json"],n=pxt.Package.parseAndValidConfig(null==i?void 0:i.content);if(n){let r;switch(n.languageRestriction=e,await i.setContentAsync(JSON.stringify(n,null,4)),e){case"blocks-only":case"no-javascript":case"":r=[];break;case"javascript-only":r=[pxt.MAIN_BLOCKS,pxt.MAIN_PY];break;case"python-only":case"no-blocks":r=[pxt.MAIN_BLOCKS];break;case"no-python":r=[pxt.MAIN_PY]}for(const e of r)await t.removeFileAsync(e);switch(e){case"blocks-only":case"no-javascript":case"":case"no-python":if(this.editorFile.name!==pxt.MAIN_BLOCKS)return void this.openBlocksAsync();break;case"javascript-only":case"no-blocks":if(this.editorFile.name!==pxt.MAIN_TS)return void await this.openTypeScriptAsync();break;case"python-only":if(this.editorFile.name!==pxt.MAIN_PY)return void await this.openPythonAsync()}await this.reloadHeaderAsync()}}}startStopSimulator(e){switch(this.state.simState){case pxt.editor.SimState.Starting:case pxt.editor.SimState.Pending:break;case pxt.editor.SimState.Running:this.stopSimulator(!1,e);break;default:this.maybeShowPackageErrors(!0),this.startSimulator(e),e&&e.clickTrigger&&d.driver.focus()}}toggleTrace(e){const t=!!this.state.tracing;t?(this.editor.clearHighlightedStatements(),d.setTraceInterval(0)):d.setTraceInterval(e||d.SLOW_TRACE_INTERVAL),this.setState({tracing:!t},(()=>{this.state.debugging?this.onDebuggingStart():this.restartSimulator()}))}setTrace(e,t){!!this.state.tracing!=e?this.toggleTrace(t):this.state.tracing&&(d.setTraceInterval(t||d.SLOW_TRACE_INTERVAL),this.startSimulator())}proxySimulatorMessage(e){d.proxy({type:"custom",content:e})}toggleSimulatorCollapse(){const e=this.state;pxt.tickEvent("simulator.toggleCollapse",{view:"computer",collapsedTo:""+!e.collapseEditorTools},{interactiveConsent:!0}),e.simState==pxt.editor.SimState.Stopped&&e.collapseEditorTools&&this.startStopSimulator(),e.collapseEditorTools?this.expandSimulator():this.collapseSimulator()}expandSimulator(){pxt.appTarget.simulator.headless?d.unhide():this.startSimulator(),this.setState({collapseEditorTools:!1}),this.fireResize()}collapseSimulator(){d.hide((()=>{this.setState({collapseEditorTools:!0}),this.fireResize()}))}setSimulatorFullScreen(e){e?document.removeEventListener("keydown",this.closeOnEscape):(document.addEventListener("keydown",this.closeOnEscape),d.driver.focus()),this.closeFlyout(),this.setState({fullscreen:e})}toggleSimulatorFullscreen(){this.setSimulatorFullScreen(!this.state.fullscreen)}closeFlyout(){this.editor.closeFlyout()}toggleMute(){this.setMute(!this.state.mute)}setMute(e){d.mute(e),this.setState({mute:e})}openInstructions(){const e=this.state.simState!=pxt.editor.SimState.Stopped;e&&this.stopSimulator(),O.makeAsync().finally((()=>{e&&this.startSimulator()}))}printCode(){if(!this.state.header)return;const e=l.mainEditorPkg().getAllFiles(),t=pxt.webConfig.docsUrl||"/--docs",i=ie.isBlocksActive()?"blocks":"typescript";window.localStorage.printjob=JSON.stringify(e);const r=`${t}#print:job:${i}:${pxt.Util.localeInfo()}`;c.dialogAsync({header:lf("Print Code"),hasCloseIcon:!0,size:"large",jsx:n.createElement("div",{className:"ui container"},n.createElement("div",{id:"printcontainer",style:{position:"relative",height:0,paddingBottom:"40%",overflow:"hidden"}},n.createElement("iframe",{frameBorder:"0","aria-label":lf("Print preview"),sandbox:"allow-popups allow-forms allow-scripts allow-same-origin allow-modals",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},src:r})))}).then((e=>{}))}clearSerial(){var e,t;this.serialEditor.clear(),null===(e=this.simulatorSerialIndicator())||void 0===e||e.clear(),null===(t=this.deviceSerialIndicator())||void 0===t||t.clear(),this.setState({simSerialActive:!1,deviceSerialActive:!1})}simulatorSerialIndicator(){return this.refs.simIndicator}deviceSerialIndicator(){return this.refs.devIndicator}shouldStartSimulator(){switch(this.state.simState){case pxt.editor.SimState.Starting:case pxt.editor.SimState.Running:return!1}return!!pxt.shell.isControllerMode()||!this.state.home}isSimulatorRunning(){return this.state.simState==pxt.editor.SimState.Running}restartSimulator(){const e=this.state.tracing||this.state.debugging;this.state.simState==pxt.editor.SimState.Stopped||this.debugOptionsChanged()?this.startSimulator():(d.driver.stopSound(),d.driver.restart()),d.driver.focus(),e||this.blocksEditor.clearBreakpoints()}startSimulator(e){pxt.tickEvent("simulator.start");const t=!this.debugOptionsChanged(),i=e&&e.clickTrigger;return pxt.debug(`start sim (autorun ${this.state.autoRun})`),!this.shouldStartSimulator()&&t?(pxt.log("Ignoring call to start simulator, either already running or we shouldn't start."),Promise.resolve()):this.saveFileAsync().then((()=>this.runSimulator({debug:this.state.debugging,clickTrigger:i})))}debugOptionsChanged(){const{debugging:e,tracing:t}=this.state;return!!e!=d.driver.isDebug()||!!t!=d.driver.isTracing()}stopSimulator(e,t){pxt.perf.measureStart("stopSimulator"),pxt.tickEvent("simulator.stop");const i=t&&t.clickTrigger;pxt.debug(`sim: stop (autorun ${this.state.autoRun})`),this.runToken&&(this.runToken.cancel(),this.runToken=null),d.stop(e);const n=this.state.autoRun&&!i;this.setState({simState:pxt.editor.SimState.Stopped,autoRun:n}),pxt.perf.measureEnd("stopSimulator")}suspendSimulator(){pxt.tickEvent("simulator.suspend"),this.runToken&&(this.runToken.cancel(),this.runToken=null),d.suspend()}showMiniSim(e){this.setState({showMiniSim:e})}onHighContrastChanged(){this.clearSerial(),this.stopSimulator(),this.startSimulator()}onCloudStatusChanged(e){const t=this.getData(e),i=null==t?void 0:t.cloudStatus();if(i){const e={type:"pxteditor",action:"projectcloudstatus",headerId:t.headerId,status:i.value};pxt.editor.postHostMessageAsync(e)}}runSimulator(e={}){const t=this.firstRun&&e.background&&pxt.appTarget.simulator&&!!pxt.appTarget.simulator.emptyRunCode&&!this.isBlocksEditor();this.firstRun&&pxt.BrowserUtils.isSafari()&&this.setMute(!0),pxt.debug(`sim: start run (autorun ${this.state.autoRun}, first ${this.firstRun})`),this.firstRun=!1,this.runToken&&this.runToken.cancel();let i=new pxt.Util.CancellationToken;return this.runToken=i,i.startOperation(),(()=>{const n=this.editor?this.editor.getId().replace(/Editor$/,""):"unknown";if(e.background){if(pxt.tickEvent("activity.autorun",{editor:n}),pxt.storage.getLocal("noAutoRun"))return Promise.resolve()}else pxt.tickEvent(e.debug?"debug":"run",{editor:n});e.background||this.editor.beforeCompile(),this.state.tracing&&this.state.debugging&&(e.trace=!0),e.debug&&(e.debugExtensionCode=pxt.appTarget.appTheme.debugExtensionCode&&!this.isBlocksActive()),this.syncPreferredEditor(),d.stop(!1,!0);const r=this.autoRunOnStart()&&this.isBlocksEditor()&&(this.state.autoRun||!!e.clickTrigger),o=this.editor.snapshotState();return this.setStateAsync({simState:pxt.editor.SimState.Starting,autoRun:r}).then((()=>t?Promise.resolve(p.emptyCompileResult()):p.compileAsync(e))).then((t=>{if(i.isCancelled())pxt.debug("sim: cancelled");else if(this.clearSerial(),this.editor.setDiagnostics(this.editorFile,o),t.outfiles[pxtc.BINARY_JS]){if(!i.isCancelled()){pxt.debug("sim: run");const n=a.getData(B.HIGHCONTRAST);d.run(l.mainPkg,e.debug,t,{mute:this.state.mute,highContrast:n,light:pxt.options.light,clickTrigger:e.clickTrigger,storedState:l.mainEditorPkg().getSimState(),autoRun:this.state.autoRun},e.trace),this.blocksEditor.setBreakpointsMap(t.breakpoints,t.procCallLocations),this.textEditor.setBreakpointsMap(t.breakpoints,t.procCallLocations),i.isCancelled()?(pxt.debug("sim: cancelled 2"),d.stop(),this.setState({simState:pxt.editor.SimState.Stopped})):this.setState({showParts:d.driver.hasParts()})}}else e.background||(c.warningNotification(lf("Oops, we could not run this project. Please check your code for errors.")),d.stop(),this.setState({simState:pxt.editor.SimState.Stopped}))})).finally((()=>{i.isCancelled()||i.resolveCancel(),i=null}))})()}openNewTab(e,t){if(!e||pxt.BrowserUtils.isElectron()||pxt.BrowserUtils.isUwpEdge()||pxt.BrowserUtils.isIOS())return;let i=window.location.href.replace(/#.*$/,"");t&&(i=i+(i.indexOf("?")>-1?"&":"?")+"nestededitorsim=1&lockededitor=1"),i+="#header:"+e.id;const n=window.open(i,pxt.appTarget.id+e.id);n&&(pxt.log("dependent editor window registered"),d.driver.registerDependentEditor(n))}createGitHubRepositoryAsync(){const{projectName:e,header:t}=this.state;return s.githubProvider(!0).createRepositoryAsync(e,t).then((e=>e&&this.reloadHeaderAsync()))}simDebug(){pxt.tickEvent("menu.debug.sim"),this.stopSimulator(),this.runSimulator({debug:!0})}hwDebug(){pxt.tickEvent("menu.debug.hw");let e=Promise.resolve();return this.state.simState==pxt.editor.SimState.Running&&d.driver.isDebug()||(e=this.runSimulator({debug:!0})),e.then((()=>(d.driver.setHwDebugger({postMessage:e=>{pxt.HWDBG.handleMessage(e)}}),pxt.HWDBG.postMessage=e=>d.driver.handleHwDebuggerMsg(e),Promise.all([p.compileAsync({debug:!0,native:!0}),pxt.packetio.initAsync()]).then((e=>pxt.HWDBG.startDebugAsync(e[0],e[1]))))))}toggleDebugging(){const e=!this.state.debugging;this.setState({debugging:e,debugFirstRun:e},(()=>{this.setSimulatorFullScreen(!1),this.onDebuggingStart()}))}onDebuggingStart(){this.renderCore(),this.editor&&(this.editor.updateBreakpoints(),this.editor.updateToolbox()),this.restartSimulator()}dbgPauseResume(){d.dbgPauseResume()}dbgStepOver(){d.dbgStepOver()}dbgStepInto(){d.dbgStepInto()}dbgInsertBreakpoint(){this.editor.insertBreakpoint()}editText(){this.editor!=this.textEditor&&(this.updateEditorFileAsync(this.textEditor).then((()=>{this.textEditor.editor.focus()})),this.forceUpdate())}hasCloudSync(){return this.isLoggedIn()}showScriptManager(){this.scriptManagerDialog.show()}importProjectDialog(){this.importDialog.show()}renderPythonAsync(e){return p.decompilePythonSnippetAsync(e.ts).then((e=>({python:e})))}blocksScreenshotAsync(e,t){return pxt.blocks.layout.screenshotEnabled()&&this.blocksEditor&&this.blocksEditor.isReady&&this.blocksEditor.editor?pxt.blocks.layout.screenshotAsync(this.blocksEditor.editor,e,t):Promise.resolve(void 0)}renderBlocksAsync(e){return p.getBlocksAsync().then((t=>p.decompileBlocksSnippetAsync(e.ts,t,e))).then((t=>{const i=pxt.blocks.render(t.outfiles[pxt.MAIN_BLOCKS],{snippetMode:e.snippetMode||!1,layout:void 0!==e.layout?e.layout:pxt.blocks.BlockLayout.Align,splitSvg:!1}),n=i.getAttribute("viewBox").split(/\s+/).map((e=>parseInt(e)));return{svg:i,xml:pxt.blocks.layout.blocklyToSvgAsync(i,n[0],n[1],n[2],n[3])}}))}launchFullEditor(){Z.assert(pxt.shell.isSandboxMode());let e=pxt.appTarget.appTheme.embedUrl;/\/$/.test(e)||(e+="/");const t=l.mainPkg,i=l.getEditorPkg(t);pxt.shell.isReadOnly()?(i.header.pubId,e+=`#pub:${i.header.pubId}`,window.open(e,"_blank")):this.exportAsync().then((t=>{pxt.tickEvent("sandbox.openfulleditor"),e+=`#project:${t}`,window.open(e,"_blank")}))}anonymousPublishAsync(e){pxt.tickEvent("publish"),this.setState({publishing:!0});const t=l.mainPkg,i=l.getEditorPkg(t);return this.saveProjectNameAsync().then((()=>this.saveFileAsync())).then((()=>t.filesToBePublishedAsync(!0))).then((n=>{if(i.header.pubCurrent&&!e)return Promise.resolve(i.header.pubId);const r={description:t.config.description},s=this.blocksEditor.contentSize();return s&&(r.blocksHeight=s.height,r.blocksWidth=s.width),o.anonymousPublishAsync(i.header,n,r,e).then((e=>e.id))})).finally((()=>{this.setState({publishing:!1})}))}async anonymousPublishHeaderByIdAsync(e){const t=o.getHeader(e),i=await o.getTextAsync(e),n=JSON.stringify(i,null,2)+"\n",r={name:t.name,target:t.target,targetVersion:t.targetVersion,description:lf("Made with  in {0}.",pxt.appTarget.title||pxt.appTarget.name),editor:t.editor,text:i,meta:{versions:pxt.appTarget.versions,blocksHeight:0,blocksWidth:0}};return pxt.debug(`publishing script; ${n.length} bytes`),Q.privatePostAsync("scripts",r,!0)}async saveLocalProjectsToCloudAsync(e){return j.saveLocalProjectsToCloudAsync(e)}async requestProjectCloudStatus(e){await j.requestProjectCloudStatus(e)}convertCloudProjectsToLocal(e){return j.convertCloudToLocal(e)}updateHeaderName(e){this.setState({projectName:e}),this.debouncedSaveProjectName||(this.debouncedSaveProjectName=Z.debounce((()=>{this.saveProjectNameAsync()}),pxt.options.light?2e3:500,!1)),this.debouncedSaveProjectName()}saveProjectNameAsync(){if(!this.state.projectName||!this.state.header)return Promise.resolve();try{return this.updateHeaderNameAsync(this.state.projectName)}catch(e){return pxt.reportException(e),Promise.resolve()}}updateHeaderNameAsync(e){if(l.mainPkg.config.name==e)return Promise.resolve();l.mainPkg.config.name=e,pxt.debug("saving project name to "+e);let t=l.mainEditorPkg().lookupFile("this/"+pxt.CONFIG_NAME),i=JSON.parse(t.content);return i.name=e,t.setContentAsync(pxt.Package.stringifyConfig(i)).then((()=>{this.state.header&&this.setState({projectName:e})}))}isTextEditor(){return this.editor==this.textEditor}isPxtJsonEditor(){return this.editor==this.pxtJsonEditor}isBlocksEditor(){return this.editor==this.blocksEditor}loadBlocklyAsync(){return this.blocksEditor.loadBlocklyAsync()}createModalClasses(e){const t=[e,-1!=this.rootClasses.indexOf("flyoutOnly")?"flyoutOnly":"",-1!=this.rootClasses.indexOf("inverted-theme")?"inverted-theme":"",-1!=this.rootClasses.indexOf("hideIteration")?"hideIteration":""];return u.cx(t)}showReportAbuse(){const e=this.state.tutorialOptions&&this.state.tutorialOptions.tutorialReportId||this.state.header&&this.state.header.pubCurrent&&this.state.header.pubId;E.showReportAbuseAsync(e)}showAboutDialog(){E.showAboutDialogAsync(this)}showLoginDialog(e){this.loginDialog.show(e)}showProfileDialog(e){this.profileDialog.show(e)}showShareDialog(e){this.shareEditor.show(e)}showLanguagePicker(){this.languagePicker.show()}showImportUrlDialog(){E.showImportUrlDialogAsync().then((e=>{e&&(pxt.github.isGithubId(e)?pe(e):he(e))}),(e=>{c.errorNotification(lf("Sorry, the project url looks invalid."))}))}showImportGithubDialog(){E.showImportGithubDialogAsync().then((e=>{"NEW"===e?E.showCreateGithubRepoDialogAsync().then((e=>{e&&pe(e)})):e&&pe(e)}),(e=>{c.errorNotification(lf("Sorry, that repository looks invalid."))}))}showImportFileDialog(e){E.showImportFileDialogAsync(e).then((t=>{t&&(pxt.tickEvent("app.open.file"),this.importFile(t,e))}))}showResetDialog(){E.showResetDialogAsync().then((e=>e?Promise.resolve().then((()=>pxt.winrt.releaseAllDevicesAsync())).then((()=>(E.clearDontShowDownloadDialogFlag(),this.resetWorkspace()))):Promise.resolve()))}showExitAndSaveDialog(){var e,t;this.setState({debugging:!1}),this.isTutorial()?(pxt.tickEvent("tutorial.exit.home",{tutorial:null===(t=null===(e=this.state.header)||void 0===e?void 0:e.tutorial)||void 0===t?void 0:t.tutorial}),this.exitTutorialAsync().finally((()=>this.openHome()))):this.state.projectName!==lf("Untitled")?this.openHome():this.exitAndSaveDialog.show()}askForProjectCreationOptionsAsync(){return this.newProjectDialog.promptUserAsync()}showPackageDialog(){this.scriptSearch.showExtensions()}showBoardDialogAsync(e,t){return this.scriptSearch.showBoardsAsync(e,t)}showModalDialogAsync(e){return c.dialogAsync({header:e.header,body:e.body,hasCloseIcon:!0,buttons:e.buttons})}showExperimentsDialog(){this.scriptSearch.showExperiments()}showChooseHwDialog(e){this.chooseHwDialog&&this.chooseHwDialog.show(e)}showRenameProjectDialogAsync(){if(!this.state.header||this.state.header.githubId)return Promise.resolve(!1);const e={header:lf("Rename your project"),agreeLbl:lf("Save"),agreeClass:"green",placeholder:lf("Enter your project name here")};return c.promptAsync(e).then((e=>null===e?Promise.resolve(!1):new Promise(((t,i)=>{this.setState({projectName:e},(()=>t()))})).then((()=>this.saveProjectNameAsync())).then((()=>!0))))}loadActivityFromMarkdownAsync(e,t,i){const n=o.getHeader(e.split(":")[0]),r=!n&&pxt.Cloud.parseScriptId(e),s=!n&&!r&&pxt.github.parseRepoId(e);let a,l,u,d,p=!0,h={},f=!1;if(/^\//.test(e))a=t||e.split("/").reverse()[0].replace("-"," "),l=pxt.Cloud.markdownAsync(e).then((e=>(p=!0,m(e))));else if(r)pxt.tickEvent("tutorial.shared",{tutorial:r}),l=o.downloadFilesByIdAsync(r).then((e=>{const t=pxt.Package.parseAndValidConfig(e["pxt.json"]);return pxt.Util.jsonMergeFrom(h,t.dependencies),a=t.name||lf("Untitled"),p=!1,u=r,m(e["README.md"])}));else if(s&&s.owner&&s.project)pxt.tickEvent("tutorial.github"),pxt.log(`loading tutorial from ${s.fullName}`),l=pxt.packagesConfigAsync().then((e=>{switch(pxt.github.repoStatus(s,e)){case pxt.github.GitRepoStatus.Banned:throw lf("This GitHub repository has been banned.");case pxt.github.GitRepoStatus.Approved:u=void 0;break;default:u="https://github.com/"+s.slug}return(s.tag?Promise.resolve(s.tag):pxt.github.latestVersionAsync(s.slug,e,!0)).then((t=>{if(t)return s.tag=t,pxt.log(`tutorial ${s.fullName} tag: ${t}`),pxt.github.downloadPackageAsync(`${s.slug}#${s.tag}`,e);pxt.log(`tutorial github tag not found at ${s.fullName}`)}))})).then((t=>{let i=Promise.resolve();return t.files[pxt.TUTORIAL_INFO_FILE]&&i.then((()=>pxt.tutorial.parseCachedTutorialInfo(t.files[pxt.TUTORIAL_INFO_FILE],e))),i.then((()=>t&&g(s,t.files)))}));else if(n){pxt.tickEvent("tutorial.header"),f=!0;const t=pxt.github.parseRepoId(n.githubId),i=e.split(":")[1]||"README";l=o.getTextAsync(n.id).then((e=>g(t,e,i)))}else l=Promise.resolve(void 0);return l.then((e=>({reportId:u,filename:a,autoChooseBoard:p,dependencies:h,features:d,temporary:f,md:e}))).catch((e=>{c.handleNetworkError(e),c.errorNotification(lf("Oops, we could not load this activity.")),this.openHome()}));function m(e){return e?(i==pxt.JAVASCRIPT_PROJECT_NAME?e=e.replace(/^```(blocks|block|spy)\b/gm,"```typescript"):i==pxt.PYTHON_PROJECT_NAME&&(e=e.replace(/^```(blocks|block|typescript)\b/gm,"```spy")),pxt.Util.jsonMergeFrom(h,pxt.gallery.parsePackagesFromMarkdown(e)),d=pxt.gallery.parseFeaturesFromMarkdown(e),e):e}function g(e,t,i){const n=pxt.Package.parseAndValidConfig(t["pxt.json"]);return n.files.find((e=>/\.ts$/.test(e)))?(h={})[e.project]=pxt.github.toGithubDependencyPath(e.slug,e.tag):pxt.Util.jsonMergeFrom(h,n.dependencies),a=n.name||lf("Untitled"),p=!1,m(pxt.tutorial.resolveLocalizedMarkdown(e,t,i))}}startTutorialAsync(e,t,i,n,r,o){var s,a,u,d,p,h;return(null===(a=null===(s=this.state.header)||void 0===s?void 0:s.tutorial)||void 0===a?void 0:a.tutorial)&&(pxt.tickEvent("recipe.exit",{tutorial:null===(d=null===(u=this.state.header)||void 0===u?void 0:u.tutorial)||void 0===d?void 0:d.tutorial,goto:e}),pxt.tickEvent("tutorial.finish",{tutorial:null===(h=null===(p=this.state.header)||void 0===p?void 0:p.tutorial)||void 0===h?void 0:h.tutorial})),c.hideDialog(),c.showLoading("tutorial",lf("starting tutorial...")),I.initTutorial(),i=i&&!!this.state.header,this.loadActivityFromMarkdownAsync(e,t,n).then((t=>{const{filename:s,dependencies:a,temporary:c,reportId:u,autoChooseBoard:d,features:p,md:h}=t||{};if(!h)throw new Error(lf("Tutorial {0} not found",e));const{options:f,editor:m}=pxt.tutorial.getTutorialOptions(h,e,s,u,!!i);this.hintManager.clearViewedHints(),f.mergeCarryoverCode=o,f.mergeHeaderId=r;const g=n||m;if(i){const e=l.mainEditorPkg().header;return e.tutorial=f,e.tutorialCompleted=void 0,this.loadHeaderAsync(e)}return this.createProjectAsync({name:s,tutorial:f,preferredEditor:g,dependencies:a,temporary:c,skillmapProject:pxt.BrowserUtils.isSkillmapEditor()}).then((()=>d?this.autoChooseBoardAsync(p):Promise.resolve())).then((()=>this.postTutorialProgress()))})).catch((t=>{pxt.reportException(t,{tutorialId:e}),c.warningNotification(lf("Please check your internet connection and check the tutorial is valid.")),this.openHome()})).finally((()=>c.hideLoading("tutorial")))}async startActivity(e){const{activity:t,path:i,editor:n,title:r,focus:o,importOptions:s,previousProjectHeaderId:a,carryoverPreviousCode:l}=e;switch(this.textEditor.giveFocusOnLoading=o,t){case"tutorial":pxt.tickEvent("tutorial.start",{tutorial:i,editor:n}),await this.startTutorialAsync(i,r,!1,n,e.previousProjectHeaderId,e.carryoverPreviousCode);break;case"recipe":pxt.tickEvent("recipe.start",{recipe:i,editor:n}),await this.startTutorialAsync(i,r,!0,n);break;case"example":pxt.tickEvent("example.start",{example:i,editor:n}),await this.importExampleAsync(Object.assign({name:r,path:i,preferredEditor:n},s))}}completeTutorialAsync(){var e,t,i,n;pxt.tickEvent("tutorial.finish",{tutorial:null===(t=null===(e=this.state.header)||void 0===e?void 0:e.tutorial)||void 0===t?void 0:t.tutorial}),pxt.tickEvent("tutorial.complete",{tutorial:null===(n=null===(i=this.state.header)||void 0===i?void 0:i.tutorial)||void 0===n?void 0:n.tutorial}),c.showLoading("leavingtutorial",lf("leaving tutorial...")),this.postTutorialCompleted();const r=this.state.header.tutorial;return r&&!this.state.header.isSkillmapProject&&(this.state.tutorialOptions&&this.state.tutorialOptions.tutorialRecipe?this.state.header.tutorialCompleted=void 0:this.state.header.tutorialCompleted={id:r.tutorial,steps:r.tutorialStepInfo.length},this.state.header.tutorial=void 0),pxt.BrowserUtils.isIE()?(this.exitTutorial(),Promise.resolve()):pxt.BrowserUtils.isSkillmapEditor()?this.exitTutorialAsync().finally((()=>{c.hideLoading("leavingtutorial")})):this.exitTutorialAsync().then((()=>{let e=l.mainEditorPkg().header;return this.loadHeaderAsync(e)})).finally((()=>{c.hideLoading("leavingtutorial"),this.postTutorialProgress()})).then((()=>{pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.appTheme.shareFinishedTutorials&&(pxt.tickEvent("tutorial.share",void 0,{interactiveConsent:!1}),this.showShareDialog(lf("Well done! Would you like to share your project?")))}))}exitTutorial(e){var t,i;pxt.tickEvent("tutorial.exit",{tutorial:null===(i=null===(t=this.state.header)||void 0===t?void 0:t.tutorial)||void 0===i?void 0:i.tutorial}),c.showLoading("leavingtutorial",lf("leaving tutorial...")),this.postTutorialExit(),this.exitTutorialAsync(e).finally((()=>{c.hideLoading("leavingtutorial"),this.openHome()}))}async exitTutorialAsync(e){let t=l.mainEditorPkg().header;t.isDeleted=e;let i=l.mainEditorPkg().getAllFiles();try{await o.saveAsync(t,i),await Z.delay(500)}catch(e){}finally{c.resetFocus(),await this.setStateAsync({tutorialOptions:void 0,tracing:void 0,editorState:void 0}),this.state.header&&await o.saveAsync(this.state.header)}}showTutorialHint(e){let t=this.refs[se.tutorialCardId];t&&t.showHint(!0,e)}isTutorial(){return null!=this.state.tutorialOptions}onTutorialLoaded(){pxt.tickEvent("tutorial.editorLoaded"),this.postTutorialLoaded()}setEditorOffset(){if(this.isTutorial())if(pxt.BrowserUtils.useOldTutorialLayout()){const e=this.refs[se.tutorialCardId];let t=0;if(this.state.editorState&&!1===this.state.editorState.hasCategories&&(t+=document.getElementById("headers").offsetHeight),e){let i=Math.min(e.getCardHeight()+t,18*parseFloat(getComputedStyle(document.documentElement).fontSize));this.setState({editorOffset:"calc("+i+"px + 2em)"})}}else{const e=null===document||void 0===document?void 0:document.getElementById("editorSidebar");e&&pxt.BrowserUtils.isTabletSize()?this.setState({editorOffset:e.offsetHeight+"px"}):this.setState({editorOffset:void 0})}}saveTutorialTemplateAsync(){return l.mainEditorPkg().buildAssetsAsync().then((()=>l.mainPkg.saveToJsonAsync())).then((e=>{pxt.BrowserUtils.browserDownloadText(e.source,l.genFileName(".assets.mkcd"))}))}pokeUserActivity(){this.state.tutorialOptions&&this.state.tutorialOptions.tutorial&&this.hintManager.pokeUserActivity(se.tutorialCardId,this.state.tutorialOptions.tutorialStep,this.state.tutorialOptions.tutorialHintCounter)}stopPokeUserActivity(){this.hintManager.stopPokeUserActivity()}clearUserPoke(){this.setState({pokeUserComponent:null})}setHintSeen(e){this.hintManager.viewedHint(e)}tutorialCardHintCallback(){let e=this.state.tutorialOptions;e.tutorialHintCounter=e.tutorialHintCounter+1,this.setState({pokeUserComponent:se.tutorialCardId,tutorialOptions:e}),setTimeout((()=>this.clearUserPoke()),1e4)}toggleHighContrast(){c.toggleHighContrast(),pxt.tickEvent("app.highcontrast",{on:c.getHighContrastOnce()?1:0}),this.isSimulatorRunning()&&this.startSimulator()}setHighContrast(e){return c.setHighContrast(e)}toggleGreenScreen(){const e=!this.state.greenScreen;pxt.tickEvent("app.greenscreen",{on:e?1:0}),this.setState({greenScreen:e})}toggleAccessibleBlocks(){this.setAccessibleBlocks(!this.state.accessibleBlocks)}setAccessibleBlocks(e){pxt.tickEvent("app.accessibleblocks",{on:e?1:0}),this.blocksEditor.enableAccessibleBlocks(e),this.setState({accessibleBlocks:e})}setBannerVisible(e){this.setState({bannerVisible:e})}hideLightbox(){this.setState({lightbox:!1})}showLightbox(){this.setState({lightbox:!0})}showKeymap(e){this.setState({keymap:e})}toggleKeymap(){this.state.keymap?this.showKeymap(!1):this.showKeymap(!0)}renderCore(){!function(e){if(ie=e,re){for(;re.length;)re.shift()(e);re=void 0}}(this);const e=pxt.appTarget.appTheme,t=pxt.appTarget.simulator,i=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&!pxt.shell.isControllerMode(),r=pxt.shell.isSandboxMode(),o=!this.editor.isVisible||this.getPreferredEditor()===pxt.BLOCKS_PROJECT_NAME,s=!(r||e.hideSideDocs),a=this.state.tutorialOptions,c=!!a&&!!a.tutorial,d=pxt.appTarget.appTheme.sidebarTutorial,p=c&&!pxt.BrowserUtils.useOldTutorialLayout(),f=c&&a.tutorialStepExpanded,m=c&&a.metadata&&a.metadata.hideIteration,g=this.state.debugging,E=this.state.home&&!r,I=!!this.state.header&&!E,{lightbox:O,greenScreen:P,accessibleBlocks:D}=this.state,M=this.state.editorState&&!1===this.state.editorState.hasCategories,{hideEditorToolbar:j,transparentEditorToolbar:q}=e,z=e.hideMenuBar||m||p&&pxt.appTarget.appTheme.embeddedTutorial,G=t&&t.headless,$=e.selectLanguage,V=I&&!j&&this.editor.hasEditorToolbar(),W=pxt.appTarget.serial&&!!pxt.appTarget.serial.useEditor,K=s&&this.state.sideDocsLoadUrl&&!this.state.sideDocsCollapsed,Y=V&&!E&&!r&&!e.simCollapseInMenu&&(!G||g)&&!p,X=this.state.hideEditorFloats||this.state.collapseEditorTools,Q=!!e.logoWide,Z=!r&&pxt.hasHwVariants(),ee=(f||p)&&this.state.editorOffset?{top:this.state.editorOffset}:void 0,te=e.invertedMenu&&e.invertedMonaco,ne=this.state.collapseEditorTools?lf("Show the simulator"):lf("Hide the simulator"),oe=h.isNativeHost()||pxt.winrt.isWinRT()||pxt.BrowserUtils.isElectron(),ae=this.getData(B.HIGHCONTRAST);let le=["ui",O?"dimmable dimmed":"dimmable",X?"hideEditorFloats":"",this.state.collapseEditorTools?"collapsedEditorTools":"",q?"transparentEditorTools":"",te?"inverted-theme":"",this.state.fullscreen?"fullscreensim":"",this.state.showMiniSim?"miniSim":"",ae?"hc":"",K?"sideDocs":"",pxt.shell.layoutTypeClass(),E?"inHome":"",c&&!p?"tutorial":"",f&&!p?"tutorialExpanded":"",p?"tabTutorial":"",d?"sidebarTutorial":"",g?"debugger":"",pxt.options.light?"light":"",pxt.BrowserUtils.isTouchEnabled()?"has-touch":"",z?"hideMenuBar":"",!V||q?"hideEditorToolbar":"",this.state.bannerVisible&&!E?"notificationBannerVisible":"",this.state.debugging?"debugging":"",r&&this.isEmbedSimActive()?"simView":"",oe?"app":"",P?"greenscreen":"",Q?"logo-wide":"",G?"headless":"",M?"flyoutOnly":"",m?"hideIteration":"",this.editor!=this.blocksEditor?"editorlang-text":"",this.editor==this.textEditor&&this.state.errorListState,"full-abs",pxt.appTarget.appTheme.embeddedTutorial?"tutorial-embed":""];this.rootClasses=le;const ce=u.cx(le);if(this.state.hasError)return n.createElement("div",{id:"root",className:"ui middle aligned center aligned grid",style:{height:"100%",alignItems:"center"}},n.createElement("div",{className:"ui raised segment inverted purple"},n.createElement("h2",null,lf("Oops")),lf("We detected a problem and we will reload the editor in a few seconds..")));const ue=pxt.Util.isUserLanguageRtl(),de=(this.state.collapseEditorTools||ue)&&!(this.state.collapseEditorTools&&ue),pe=!(r||c||this.isAssetsActive()||o||l.mainPkg&&l.mainPkg.config&&l.mainPkg.config.preferredEditor==pxt.BLOCKS_PROJECT_NAME),he=pxt.auth.hasIdentity();return n.createElement("div",{id:"root",className:ce},P?n.createElement(L.WebCam,{close:this.toggleGreenScreen}):void 0,D&&n.createElement(R.AccessibleBlocksInfo,null),z||E?void 0:n.createElement("header",{className:"menubar",role:"banner"},I?n.createElement(y.EditorAccessibilityMenu,{parent:this,highContrast:ae}):void 0,n.createElement(J.NotificationBanner,{parent:this}),n.createElement(F.HeaderBar,{parent:this})),d&&M&&c&&n.createElement(w.SidebarTutorialCard,{ref:se.tutorialCardId,parent:this,pokeUser:this.state.pokeUserComponent==se.tutorialCardId}),c&&!p&&n.createElement("div",{id:"maineditor",className:r?"sandbox":"",role:"main"},!(d&&M)&&c&&n.createElement(k.TutorialCard,{ref:se.tutorialCardId,parent:this,pokeUser:this.state.pokeUserComponent==se.tutorialCardId}),M&&n.createElement(k.WorkspaceHeader,{parent:this})),n.createElement(H.Sidepanel,{parent:this,inHome:E,showKeymap:this.state.keymap&&t.keymap,showSerialButtons:W,showFileList:pe,showFullscreenButton:!G,collapseEditorTools:this.state.collapseEditorTools,simSerialActive:this.state.simSerialActive,devSerialActive:this.state.deviceSerialActive,showMiniSim:this.showMiniSim,openSerial:this.openSerial,handleHardwareDebugClick:this.hwDebug,handleFullscreenButtonClick:this.toggleSimulatorFullscreen,tutorialOptions:p?a:void 0,onTutorialStepChange:this.setTutorialStep,onTutorialComplete:this.completeTutorialAsync,setEditorOffset:this.setEditorOffset}),n.createElement("div",{id:"maineditor",className:(r?"sandbox":"")+(g?"debugging":""),role:"main","aria-hidden":E},Y&&n.createElement(u.Button,{id:"computertogglesim",className:"computer only collapse-button large",icon:"inverted chevron "+(de?"right":"left"),title:ne,onClick:this.toggleSimulatorCollapse}),this.allEditors.map((e=>e.displayOuter(ee)))),E?n.createElement("div",{id:"homescreen",className:"full-abs"},n.createElement("div",{className:"ui home projectsdialog"},n.createElement("header",{className:"menubar",role:"banner"},n.createElement(y.HomeAccessibilityMenu,{parent:this,highContrast:ae}),n.createElement(F.HeaderBar,{parent:this})),n.createElement(T.Projects,{parent:this,ref:this.handleHomeRef}))):void 0,V&&n.createElement(x.EditorToolbar,{ref:"editortools",parent:this}),s?n.createElement(S.SideDocs,{ref:"sidedoc",parent:this,sideDocsCollapsed:this.state.sideDocsCollapsed,docsUrl:this.state.sideDocsLoadUrl}):void 0,r?void 0:n.createElement(_.ScriptSearch,{parent:this,ref:this.handleScriptSearchRef}),r?void 0:n.createElement(N.Extensions,{parent:this,ref:this.handleExtensionRef}),E?n.createElement(T.ImportDialog,{parent:this,ref:this.handleImportDialogRef}):void 0,he?n.createElement(C.LoginDialog,{parent:this,ref:this.handleLoginDialogRef}):void 0,he?n.createElement(U.ProfileDialog,{parent:this,ref:this.handleProfileDialogRef}):void 0,E&&e.scriptManager?n.createElement(A.ScriptManagerDialog,{parent:this,ref:this.handleScriptManagerDialogRef,onClose:this.handleScriptManagerDialogClose}):void 0,r?void 0:n.createElement(T.ExitAndSaveDialog,{parent:this,ref:this.handleExitAndSaveDialogRef}),r?void 0:n.createElement(T.NewProjectDialog,{parent:this,ref:this.handleNewProjectDialogRef}),Z?n.createElement(T.ChooseHwDialog,{parent:this,ref:this.handleChooseHwDialogRef}):void 0,r||!i?void 0:n.createElement(b.ShareEditor,{parent:this,ref:this.handleShareEditorRef,loading:this.state.publishing}),$?n.createElement(v.LanguagePicker,{parent:this,ref:this.handleLanguagePickerRef}):void 0,r?n.createElement(S.SandboxFooter,{parent:this}):void 0,z?n.createElement("div",{id:"editorlogo"},n.createElement("a",{className:"poweredbylogo"})):void 0,O?n.createElement(u.Dimmer,{isOpen:!0,active:O,portalClassName:"tutorial",className:"ui modal",shouldFocusAfterRender:!1,closable:!0,onClose:this.hideLightbox}):void 0)}}function ae(){return ie}i.ProjectView=se,se.tutorialCardId="tutorialcard";let le={workspace:o,require:e,core:c,getEditor:ae,monaco:q,blocks:$,compiler:p,pkg:l,getsrc:function(){pxt.log(ie.editor.getCurrentSource())},sim:d,apiAsync:c.apiAsync,assembleCurrent:function(){p.compileAsync({native:!0}).then((()=>p.assembleAsync(ae().editorFile.content))).then((e=>{let t=e.words;pxt.debug("["+t.map((e=>"0x"+e.toString(16))).join(",")+"]")}))},log:function(e){console.log(e)},cloudsync:s};function ce(){let e=/^#(\w+)(:([:\.\/\-\+\=\w]+))?/.exec(window.location.hash);return e?{cmd:e[1],arg:e[3]||""}:{cmd:"",arg:""}}function ue(e,t){if(!e)return!1;let i=ie;if(!i)return!1;switch(de(e)&&i.setState({home:!1}),e.cmd){case"doc":pxt.tickEvent("hash.doc"),i.setSideDoc(e.arg,i.editor===i.blocksEditor);break;case"follow":return pxt.tickEvent("hash.follow"),i.newEmptyProject(void 0,e.arg),!0;case"newproject":return pxt.tickEvent("hash.newproject"),i.newEmptyProject(),pxt.BrowserUtils.changeHash(""),!0;case"newjavascript":return pxt.tickEvent("hash.newjavascript"),i.newProject({prj:pxt.appTarget.blocksprj,filesOverride:{[pxt.MAIN_BLOCKS]:""}}),pxt.BrowserUtils.changeHash(""),!0;case"testproject":{pxt.tickEvent("hash.testproject");const t=e.arg,n=o.getHeader(t);if(n){const e=o.getHeaders().filter((e=>e.extensionUnderTest==n.id))[0];e?i.loadHeaderAsync(e):i.newProject({prj:pxt.appTarget.blocksprj,name:lf("test {0}",n.name),extensionUnderTest:t})}return pxt.BrowserUtils.changeHash(""),!0}case"gettingstarted":return pxt.tickEvent("hash.gettingstarted"),i.newProject(),pxt.BrowserUtils.changeHash(""),!0;case"tutorial":case"example":case"recipe":{pxt.tickEvent("hash."+e.cmd),ne=e;let t,n=e.arg;return/^([jt]s|py|blocks?):/i.test(n)&&(t=/^py:/i.test(n)?pxt.PYTHON_PROJECT_NAME:/^[jt]s:/i.test(n)?pxt.JAVASCRIPT_PROJECT_NAME:pxt.BLOCKS_PROJECT_NAME,n=n.substr(n.indexOf(":")+1)),i.startActivity({activity:e.cmd,path:n,editor:t,focus:!1}),pxt.BrowserUtils.changeHash("editor"),!0}case"home":return pxt.tickEvent("hash.home"),i.openHome(),pxt.BrowserUtils.changeHash(""),!0;case"sandbox":case"pub":case"edit":return pxt.tickEvent("hash."+e.cmd),pxt.BrowserUtils.changeHash(""),/^(github:|https:\/\/github\.com\/)/.test(e.arg)?pe(e.arg):he(e.arg),!0;case"header":return pxt.tickEvent("hash."+e.cmd),pxt.BrowserUtils.changeHash(""),i.loadHeaderAsync(o.getHeader(e.arg)),!0;case"sandboxproject":case"project":pxt.tickEvent("hash."+e.cmd);const n=Z.stringToUint8Array(atob(e.arg));return pxt.BrowserUtils.changeHash(""),c.showLoading("loadingproject",lf("loading project...")),i.importProjectFromFileAsync(n).finally((()=>c.hideLoading("loadingproject"))),!0;case"reload":return t&&pxt.BrowserUtils.changeHash(""),!1;case"skillmapimport":const r=e.arg;return c.showLoading("skillmapimport",lf("loading project...")),i.importSkillmapProjectAsync(r).finally((()=>{pxt.BrowserUtils.changeHash(""),c.hideLoading("skillmapimport")})),!0;case"github":{const t=pxt.github.parseRepoId(e.arg),[i,n]=e.arg.split(":",2);pxt.BrowserUtils.changeHash("");const r=s.githubProvider();if(!r)return!1;if("create-repository"===i){const e=o.getHeader(n);if(e)return!!r.hasToken()&&(ie.loadHeaderAsync(e).then((()=>r.createRepositoryAsync(e.name,e))).then((e=>e&&ie.reloadHeaderAsync())),!0)}else{if("import"===i)return E.showImportGithubDialogAsync(),!0;if(t)return pe(e.arg,!0),!0}break}}return!1}function de(e){if(!e)return!1;switch(e.cmd){case"follow":case"newproject":case"newjavascript":case"testproject":case"tutorial":case"example":case"recipe":case"projects":case"sandbox":case"pub":case"edit":case"sandboxproject":case"project":case"header":return!0;case"github":default:return!1}}async function pe(e,t){if(!pxt.appTarget.appTheme.githubEditor||pxt.winrt.isWinRT()||pxt.BrowserUtils.isPxtElectron())return c.warningNotification(lf("Importing GitHub projects not currently supported")),void ie.openHome();c.showLoading("loadingheader",lf("importing GitHub project..."));try{e=pxt.github.normalizeRepoId(e);let i=o.getHeaders().find((t=>t.githubId&&pxt.github.normalizeRepoId(t.githubId)==e));if(!i){if(t&&!(await s.githubProvider(!0).routedLoginAsync(e)).accessToken)return void ie.openHome();i=await o.importGithubAsync(e)}i?await ie.loadHeaderAsync(i,null):ie.openHome()}catch(e){c.handleNetworkError(e),ie.openHome()}finally{c.hideLoading("loadingheader")}}function he(e){c.showLoading("loadingheader",lf("loading project...")),o.installByIdAsync(e).then((e=>ie.loadHeaderAsync(e,null))).catch((e=>{ie.openHome(),c.handleNetworkError(e)})).finally((()=>c.hideLoading("loadingheader")))}window.E=le;const fe=e=>{ue(ce(),!1)};function me(){try{return/saveblocks=1/.test(window.location.href)&&!!l.mainPkg.readFile(pxt.MAIN_BLOCKS)}catch(e){return!1}}function ge(){try{return/save(?:as)?template=1/i.test(window.location.href)}catch(e){return!1}}function be(e){var t;const i=null===(t=l.getEditorPkg(l.mainPkg))||void 0===t?void 0:t.getMainFile();switch(e.toLowerCase()){case"javascript":case"js":case pxt.JAVASCRIPT_PROJECT_NAME:return i.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME);case"python":case"py":case pxt.PYTHON_PROJECT_NAME:return i.getVirtualFileName(pxt.PYTHON_PROJECT_NAME);case"assets":case"asset":return pxt.ASSETS_FILE;case"blocks":case pxt.BLOCKS_PROJECT_NAME:default:return i.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME)}}pxt.winrt.captureInitialActivation(),document.addEventListener("DOMContentLoaded",(async()=>{var t;pxt.perf.recordMilestone("DOM loaded"),pxt.setupWebConfig(window.pxtConfig);const i=pxt.webConfig;pxt.options.debug=/dbg=1/i.test(window.location.href),pxt.options.debug&&(pxt.debug=console.debug),pxt.options.light=/light=1/i.test(window.location.href)||pxt.BrowserUtils.isARM()||pxt.BrowserUtils.isIE(),pxt.options.light&&pxsim.U.addClass(document.body,"light");const p=/wsport=(\d+)/i.exec(window.location.href);if(p?(pxt.options.wsPort=parseInt(p[1])||3233,pxt.BrowserUtils.changeHash(window.location.hash.replace(p[0],""))):pxt.options.wsPort=3233,pxt.perf.measureStart("setAppTarget"),l.setupAppTarget(window.pxtTargetBundle),pxt.setBundledApiInfo(window.pxtTargetBundle.apiInfo),pxt.perf.measureEnd("setAppTarget"),function(){pxt.analytics.enable(),pxt.editor.enableControllerAnalytics();const e={};if("undefined"!=typeof window){const t=window.screen;e["screen.width"]=t.width,e["screen.height"]=t.height,e["screen.availwidth"]=t.availWidth,e["screen.availheight"]=t.availHeight,e["screen.innerWidth"]=window.innerWidth,e["screen.innerHeight"]=window.innerHeight,e["screen.devicepixelratio"]=pxt.BrowserUtils.devicePixelRatio();const i=document.firstElementChild;i&&(e["screen.clientWidth"]=i.clientWidth,e["screen.clientHeight"]=i.clientHeight)}pxt.tickEvent("editor.loaded",e)}(),!pxt.BrowserUtils.isBrowserSupported()&&!/skipbrowsercheck=1/i.exec(window.location.href))return pxt.tickEvent("unsupported"),window.location.href="/browsers",void c.showLoading("browsernotsupported",lf("Sorry, this browser is not supported."));const m=Z.parseQueryString(window.location.href);m.authcallback&&await B.loginCallbackAsync(m),await B.initAsync(),j.init(),s.loginCheck(),function(){const e=Z.parseQueryString((location.hash||"#").slice(1).replace(/%local_token/,"local_token"));e.local_token&&(pxt.storage.setLocal("local_token",e.local_token),location.hash=location.hash.replace(/(%23)?[\#\&\?]*local_token.*/,"")),Q.localToken=pxt.storage.getLocal("local_token")||""}(),ne=ce(),f.init((()=>ie.reloadEditor())),X.init(),pxt.react.getTilemapProject=()=>{const e=l.mainEditorPkg();return e.tilemapProject||(e.tilemapProject=new pxt.TilemapProject,e.tilemapProject.loadPackage(l.mainPkg)),e.tilemapProject},pxt.hexloader.showLoading=e=>c.showLoading("hexcloudcompiler",e),pxt.hexloader.hideLoading=()=>c.hideLoading("hexcloudcompiler"),pxt.docs.requireMarked=()=>e("marked");const b=(e,t)=>ie.importHex(e,t);if(null===(t=pxt.appTarget.cloud)||void 0===t?void 0:t.apiRoot)Q.apiRoot=pxt.appTarget.cloud.apiRoot;else{const e=/^(https:\/\/[^/]+)/.exec(window.location.href);e&&(Q.apiRoot=e[1]+"/api/")}m.hw&&(pxt.setHwVariant(m.hw),pxt.tickEvent("projects.choosehwvariant",{hwid:pxt.hwVariant,card:"QUERY-"+pxt.hwVariant})),pxt.setCompileSwitches(m.compiler||m.compile);const y=pxt.shell.isSandboxMode()||pxt.shell.isReadOnly(),k=pxt.shell.isControllerMode();let w=pxt.appTarget.appTheme;m.ws?o.setupWorkspace(m.ws):(w.allowParentController||k)&&pxt.BrowserUtils.isIFrame()?o.setupWorkspace("iframe"):y?o.setupWorkspace("mem"):pxt.winrt.isWinRT()?o.setupWorkspace("uwp"):pxt.BrowserUtils.isIpcRenderer()?o.setupWorkspace("idb"):pxt.BrowserUtils.isPxtElectron()?o.setupWorkspace("fs"):o.setupWorkspace("browser"),"iframe"===o.getWorkspaceType()&&pxt.auth.enableAuth(!1),Promise.resolve().then((async()=>{const e=window.location.href;let t=!1;const n=a.getData(B.LANGUAGE);let r;if(B.initialUserPreferencesAsync().then((e=>{const t=pxt.BrowserUtils.getCookieLang();t&&e&&e.language&&e.language!=t&&(pxt.BrowserUtils.setCookieLang(e.language),c.infoNotification(lf("Reload the page to apply your new language preference.")),pxt.tickEvent("identity.preferences.askingUserToReloadToApplyLang"))})),/[&?]translate=1/.test(e)&&!pxt.BrowserUtils.isIE())console.log("translation mode"),t=!0,pxt.Util.enableLiveLocalizationUpdates(),r=ts.pxtc.Util.TRANSLATION_LOCALE;else{const e=/(live)?(force)?lang=([a-z]{2,}(-[A-Z]+)?)/i.exec(window.location.href);e&&window.location.hash.indexOf(e[0])>=0&&pxt.BrowserUtils.changeHash(window.location.hash.replace(e[0],""));const i=!!(null==e?void 0:e[1]),o=!!(null==e?void 0:e[2]),s=null==e?void 0:e[3],a=pxt.BrowserUtils.getCookieLang();r=s||n||a||w.defaultLocale||navigator.userLanguage||navigator.language;const l=/staticlang=1/i.test(window.location.href),c=pxt.appTarget.appTheme.defaultLocale,u=null==r?void 0:r.toLocaleLowerCase(),d=pxt.BrowserUtils.isLocalHostDev()&&(!u||(c?c.toLocaleLowerCase()===u:"en"===u||"en-us"===u)),p=pxt.BrowserUtils.isPxtElectron()||d;(l||p||w.disableLiveTranslations)&&!i||pxt.Util.enableLiveLocalizationUpdates(),t=o}const o=pxt.appTarget.id,s=i.commitCdnUrl,l=pxt.appTarget.versions.pxtCrowdinBranch,u=pxt.appTarget.versions.targetCrowdinBranch;return Z.updateLocalizationAsync({targetId:o,baseUrl:s,code:r,pxtBranch:l,targetBranch:u,force:t}).then((()=>{pxt.Util.isLocaleEnabled(r)?(pxt.BrowserUtils.setCookieLang(r),v.setInitialLang(r)):pxt.tickEvent("unavailablelocale",{lang:r,force:t?"true":"false"}),pxt.tickEvent("locale",{lang:pxt.Util.userLanguage(),live:pxt.Util.liveLocalizationEnabled()?"true":"false"}),Z.downloadTranslationsAsync(o,s,r,l,u,pxt.Util.liveLocalizationEnabled(),Z.TranslationsKind.Sim).then((e=>e&&d.setTranslations(e)))}))})).then((()=>(pxt.BrowserUtils.initTheme(),((w=pxt.editor.experiments.syncTheme()).allowParentController||w.allowPackageExtensions||w.allowSimulatorTelemetry||pxt.shell.isControllerMode())&&pxt.editor.bindEditorMessages(oe),o.initAsync().then((async e=>(await j.syncAsync(),e)))))).then((e=>(r.render(n.createElement(se,null),u.appElement),e&&ie.setState({editorState:e}),function(){if(!pxt.appTarget.appTheme||!pxt.appTarget.appTheme.extendEditor)return Promise.resolve();pxt.debug("loading editor extensions...");const e={blocklyToolbox:P.getToolboxDefinition(),monacoToolbox:D.getToolboxDefinition(),projectView:ie};return pxt.BrowserUtils.loadScriptAsync("editor.js").then((()=>pxt.editor.initExtensionsAsync(e))).then((e=>{e.hexFileImporters&&e.hexFileImporters.forEach((e=>{pxt.debug(`\tadded hex importer ${e.id}`),ie.hexFileImporters.push(e)})),e.resourceImporters&&e.resourceImporters.forEach((e=>{pxt.debug(`\tadded resource importer ${e.id}`),ie.resourceImporters.push(e)})),e.beforeCompile&&(ie.beforeCompile=e.beforeCompile),e.toolboxOptions&&(e.toolboxOptions.blocklyToolbox&&P.overrideToolbox(e.toolboxOptions.blocklyToolbox),e.toolboxOptions.monacoToolbox&&D.overrideToolbox(e.toolboxOptions.monacoToolbox)),h.setExtensionResult(e)}))}()))).then((()=>h.initAsync())).then((()=>(pxt.debug("packetio: hook events"),pxt.packetio.configureEvents((()=>a.invalidate("packetio:*")),((e,t)=>{const i=Z.fromUTF8(Z.uint8ArrayToString(e));window.postMessage({type:"serial",id:"n/a",data:i},"*")}),((e,t)=>{var i;const n=null===(i=pxt.appTarget.simulator)||void 0===i?void 0:i.messageSimulators;(null==n?void 0:n[e])&&window.postMessage({type:"messagepacket",broadcast:!1,channel:e,data:t,sender:"packetio"},"*")})),window.addEventListener("message",(e=>{var t,i;const n=e.data;"messagepacket"===n.type&&"packetio"!==n.sender&&(null===(i=null===(t=pxt.appTarget.simulator)||void 0===t?void 0:t.messageSimulators)||void 0===i?void 0:i[n.channel])&&pxt.packetio.sendCustomEventAsync(n.channel,n.data).then((()=>{}),(e=>{c.errorNotification(lf("{0}: {1}",n.channel,e.message))}))}),!1),function(){const e=pxt.appTarget.serial&&pxt.appTarget.serial.useHF2&&pxt.winrt.isWinRT(),t=pxt.appTarget.serial&&pxt.BrowserUtils.isLocalHost()&&!!Q.localToken;if(!e&&!t&&!pxt.usb.isEnabled)return;if(g.shouldUse()||pxt.usb.isEnabled)return;pxt.debug("initializing serial pipe");let i=new WebSocket(`ws://localhost:${pxt.options.wsPort}/${Q.localToken}/serial`),n={};i.onopen=e=>{pxt.debug("serial: socket opened")},i.onclose=e=>{pxt.debug("serial: socket closed")},i.onerror=e=>{pxt.debug("serial: error")},i.onmessage=e=>{try{let t=JSON.parse(e.data);t&&"serial"==t.type&&pxt.Util.bufferSerial(n,t.data,t.id)}catch(t){pxt.debug("unknown message: "+e.data)}}}(),window.addEventListener("hashchange",fe),M.tryInit(),Y.initElectron(ie),pxt.winrt.initAsync(b)))).then((()=>pxt.winrt.hasActivationProjectAsync())).then((e=>{const t=ie.shouldShowHomeScreen();if(t&&!e||ie.setState({home:!1}),ne.cmd&&ue(ne,!0))return Promise.resolve();if(e)return pxt.winrt.loadActivationProject();if(pxt.shell.isNoProject())return pxt.editor.postHostMessageAsync({action:"newproject",options:{preferredEditor:"blocks"}}),Promise.resolve();if(t)return Promise.resolve();const i=ie.settings.fileHistory.filter((e=>!!o.getHeader(e.id)))[0];let n=o.getHeaders()[0];return i&&(n=o.getHeader(i.id)),n?ie.loadHeaderAsync(n,ie.state.editorState):(ie.newProject(),Promise.resolve())})).catch((e=>{throw ie.handleCriticalError(e,"Failure in DOM loaded handler"),e})).then((()=>(pxsim.U.remove(document.getElementById("loading")),o.loadedAsync()))),document.addEventListener("visibilitychange",(async e=>{ie&&await ie.updateVisibilityAsync()})),window.addEventListener("unload",(e=>{ie&&ie.saveSettings(),h.disconnectAsync()})),window.addEventListener("resize",(e=>{ie&&ie.editor&&(ie.editor.resize(e),pxt.BrowserUtils.isIOS()&&setTimeout((()=>{ie.editor.resize(e)}),1e3),!ie.isTutorial()||pxt.BrowserUtils.useOldTutorialLayout()?pxt.BrowserUtils.isTabletSize()?ie.showMiniSim(!0):ie.showMiniSim(!1):ie.isTutorial()&&ie.setEditorOffset())}),!1);const x=window.ipcRenderer;x&&x.on("responseFromApp",((e,t)=>{try{d.driver.postMessage(JSON.parse(t))}catch(e){}})),window.addEventListener("message",(e=>{let t=e.data;if(t)if("parent"!=e.data.__proxy)if("tutorial"!=t.type&&"opendoc"!=t.type)if("sidedocready"===t.type&&pxt.BrowserUtils.isLocalHost()&&Q.localToken)S.SideDocs.notify({type:"localtoken",localToken:Q.localToken});else if("importfile"!=t.type);else{const e=t;ie&&ie.importFile(new File(e.parts,e.filename))}else ie&&ie.editor&&ie.handleMessage(t);else{pxt.debug("received parent proxy message"+e.data),delete e.data.__proxy;const t=window.ipcRenderer;t?t.sendToHost("sendToApp",e.data):window.parent&&window!=window.parent&&window.parent.postMessage(e.data,"*")}}),!1),pxt.appTarget.appTheme.lockedEditor&&window.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1)}))},{"./accessibility":14,"./accessibleblocks":15,"./appcache":17,"./auth":20,"./blocklyFieldView":21,"./blocks":22,"./blocksSnippets":23,"./cloud":26,"./cloudsync":27,"./cmds":28,"./compiler":30,"./components/assetEditor/editor":65,"./container":77,"./core":78,"./data":81,"./dialogs":88,"./draganddrop":89,"./editortoolbar":90,"./electron":91,"./extensions":94,"./gitjson":99,"./greenscreen":100,"./headerbar":101,"./hidbridge":102,"./hinttooltip":103,"./identity":105,"./lang":109,"./make":110,"./mergeProjects":113,"./monaco":114,"./monacoSnippets":119,"./notification":121,"./package":122,"./projects":123,"./pxtjson":124,"./screenshot":126,"./scriptmanager":127,"./scriptsearch":128,"./serial":129,"./share":131,"./sidebarTutorial":132,"./sidepanel":133,"./simulator":135,"./socketbridge":140,"./sounds":141,"./sui":143,"./tutorial":146,"./user":148,"./workspace":151,marked:245,react:335,"react-dom":291}],17:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.init=void 0;const n=e("./core"),r=e("./cmds");i.init=function(e){"serviceWorker"in navigator&&!pxt.webConfig.isStatic&&!pxt.BrowserUtils.isLocalHost(!0)&&window.addEventListener("load",(function(){const t=pxt.webConfig.relprefix.replace("---","").replace(/^\//,"");navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("message",(i=>{const o=i.data;"serviceworker"===(null==o?void 0:o.type)&&"activated"===o.state&&o.ref===t&&(pxt.appTarget.appTheme&&pxt.appTarget.appTheme.noReloadOnUpdate||(n.infoNotification(lf("Update download complete. Reloading... ")),setTimeout((()=>{pxt.tickEvent("appcache.updated"),e()}),3e3))),o&&r.handleServiceWorkerMessageAsync(o)})),navigator.serviceWorker.register(pxt.webConfig.serviceworkerjs).then((function(e){pxt.debug("ServiceWorker registration successful with scope: "+e.scope)}),(function(e){pxt.debug("ServiceWorker registration failed: "+e)}))}))}},{"./cmds":28,"./core":78}],18:[function(e,t,i){"use strict";function n(e,t=new pxt.ImageConverter){var i;switch(e.type){case"image":case"tile":return e.previewURI=t.convert("data:image/x-mkcd-f,"+e.jresData),e;case"tilemap":let n=e.data.tilemap;return e.previewURI=pxtblockly.tilemapToImageURI(e.data,Math.max(n.width,n.height),!1),e;case"animation":return(null===(i=e.frames)||void 0===i?void 0:i.length)<=0?null:(e.framePreviewURIs=e.frames.map((e=>t.convert("data:image/x-mkcd-f,"+pxt.sprite.base64EncodeBitmap(e)))),e.previewURI=e.framePreviewURIs[0],e)}}function r(e,t){return e.internalID-t.internalID}Object.defineProperty(i,"__esModule",{value:!0}),i.assetToGalleryItem=i.getAssets=i.getNewInternalID=i.lookupAsset=i.createTile=i.createProjectImage=i.createNewImageAsset=i.isNameTaken=void 0,i.isNameTaken=function(e){return pxt.react.getTilemapProject().isNameTaken("image",e)},i.createNewImageAsset=function(e,t,i,n){const r=pxt.react.getTilemapProject();switch(e){case"tile":return r.createNewTile(new pxt.sprite.Bitmap(t,i).data(),null,n);case"image":return r.createNewImage(t,i)}return null},i.createProjectImage=function(e){return pxt.react.getTilemapProject().createNewProjectImage(e)},i.createTile=function(e,t,i){return pxt.react.getTilemapProject().createNewTile(e,t,i)},i.lookupAsset=function(e,t){return pxt.react.getTilemapProject().lookupAsset(e,t)},i.getNewInternalID=function(){return pxt.react.getTilemapProject().getNewInternalId()},i.getAssets=function(e=!1,t="image",i=[]){const o=pxt.react.getTilemapProject(),s=new pxt.ImageConverter,a=e=>n(e,s),l=e?o.getGalleryAssets.bind(o):o.getAssets.bind(o),c=l("image").map(a).sort(r),u=l("tile").map(a).filter((e=>!e.id.match(/^myTiles.transparency(8|16|32)$/gi))).sort(r),d=l("tilemap").map(a).sort(r),p=l("animation").map(a).sort(r);for(const e of i)switch(e.type){case"image":c.push(a(e));break;case"tile":u.push(a(e));break;case"animation":p.push(a(e));break;case"tilemap":d.push(a(e))}let h=[];switch(t){case"image":h=c.concat(u).concat(p).concat(d);break;case"tile":h=u.concat(c).concat(p).concat(d);break;case"animation":h=p.concat(c).concat(u).concat(d);break;case"tilemap":h=d.concat(u).concat(c).concat(p)}return pxt.tickEvent(e?"assets.gallery":"assets.update",{count:h.length}),h},i.assetToGalleryItem=n},{}],19:[function(e,t,i){"use strict";let n;function r(){return n||(n=function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(e){}}()),n}Object.defineProperty(i,"__esModule",{value:!0}),i.loadAsync=i.play=void 0,i.play=function(e,t=1){if(!e)return;const i=r();if(!i)return;const n=i.createBufferSource();n.buffer=e;const o=i.createGain();o.gain.value=t,n.connect(o),o.connect(i.destination),n.start(0)},i.loadAsync=function(e){const t=r();return new Promise(((i,n)=>{t.decodeAudioData(e,(e=>i(e)),(()=>{i(void 0)}))}))}},{}],20:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.apiAsync=i.setEmailPrefAsync=i.setImmersiveReaderPrefAsync=i.setLangaugePrefAsync=i.setHighContrastPrefAsync=i.patchUserPreferencesAsync=i.deleteProfileAsync=i.logoutAsync=i.loginCallbackAsync=i.loginAsync=i.initialUserPreferencesAsync=i.authCheckAsync=i.userPreferences=i.userProfile=i.loggedIn=i.hasIdentity=i.initAsync=i.Component=i.HAS_USED_CLOUD=i.READER=i.LANGUAGE=i.HIGHCONTRAST=i.USER_PREFERENCES=i.LOGGED_IN=i.USER_PROFILE=void 0;const n=e("./core"),r=e("./data"),o=e("./cloud"),s="auth",a="profile",l="logged-in";i.USER_PROFILE="auth:profile",i.LOGGED_IN="auth:logged-in";const c="user-pref",u="preferences",d="high-contrast",p="language",h="reader";i.USER_PREFERENCES="user-pref:preferences",i.HIGHCONTRAST="user-pref:high-contrast",i.LANGUAGE="user-pref:language",i.READER="user-pref:reader",i.HAS_USED_CLOUD="has-used-cloud";class f extends r.Component{getUserProfile(){return this.getData(i.USER_PROFILE)}getUserPreferences(){return this.getData(i.USER_PREFERENCES)}isLoggedIn(){return this.getData(i.LOGGED_IN)}}i.Component=f;class m extends pxt.auth.AuthClient{async onSignedIn(){const e=this.getState();n.infoNotification(lf("Signed in: {0}",pxt.auth.userName(e.profile))),await o.syncAsync(),pxt.storage.setLocal(i.HAS_USED_CLOUD,"true")}onSignedOut(){return n.infoNotification(lf("Signed out")),Promise.resolve()}onSignInFailed(){return n.errorNotification(lf("Sign in failed. Something went wrong.")),Promise.resolve()}onUserProfileChanged(){const e=this.getState();return pxt.auth.generateUserProfilePicDataUrl(e.profile),r.invalidate("auth:*"),Promise.resolve()}onUserPreferencesChanged(e){for(const t of e)switch(t.path.join("/")){case"language":r.invalidate(i.LANGUAGE);break;case"highContrast":r.invalidate(i.HIGHCONTRAST);break;case"reader":r.invalidate(i.READER)}return Promise.resolve()}async onProfileDeleted(e){await o.convertCloudToLocal(e)}onStateLoaded(){const e=this.getState();return pxt.auth.generateUserProfilePicDataUrl(e.profile),r.invalidate("auth:*"),r.invalidate("user-pref:*"),Promise.resolve()}onApiError(e){return n.handleNetworkError(e),Promise.resolve()}onStateCleared(){return r.invalidate("auth:*"),Promise.resolve()}static authApiHandler(e){const t=pxt.auth.client();if(t){const i=r.stripProtocol(e),n=t.getState();switch(i){case a:return Object.assign({},n.profile);case l:return t.hasUserId()}}return null}static userPreferencesHandler(e){const t=pxt.auth.client();if(t)return t.getState().preferences||t.initialUserPreferencesAsync().then((()=>{})),m.internalUserPreferencesHandler(e);switch(e){case i.HIGHCONTRAST:return/^true$/i.test(pxt.storage.getLocal(i.HIGHCONTRAST));case i.LANGUAGE:return pxt.storage.getLocal(i.LANGUAGE);case i.READER:return pxt.storage.getLocal(i.READER)}return null}static internalUserPreferencesHandler(e){var t,i,n,o,s,a;const l=pxt.auth.client();if(l){const c=l.getState();switch(r.stripProtocol(e)){case u:return Object.assign({},c.preferences);case d:return null!==(i=null===(t=c.preferences)||void 0===t?void 0:t.highContrast)&&void 0!==i?i:pxt.auth.DEFAULT_USER_PREFERENCES().highContrast;case p:return null!==(o=null===(n=c.preferences)||void 0===n?void 0:n.language)&&void 0!==o?o:pxt.auth.DEFAULT_USER_PREFERENCES().language;case h:return null!==(a=null===(s=c.preferences)||void 0===s?void 0:s.reader)&&void 0!==a?a:pxt.auth.DEFAULT_USER_PREFERENCES().reader}return c.preferences}return null}}let g;async function b(){if(pxt.auth.hasIdentity())return g||(g=new Promise((async(e,t)=>{const i=new m;await i.initAsync(),await i.authCheckAsync(),await i.initialUserPreferencesAsync(),e(i)})))}async function v(e,t={}){const i=await b();return await(null==i?void 0:i.patchUserPreferencesAsync(e,t))}i.initAsync=async function(){r.mountVirtualApi(c,{getSync:m.userPreferencesHandler}),r.mountVirtualApi(s,{getSync:m.authApiHandler});const e=await b();await(null==e?void 0:e.authCheckAsync())},i.hasIdentity=function(){return pxt.auth.hasIdentity()},i.loggedIn=function(){return r.getData(i.LOGGED_IN)},i.userProfile=function(){return r.getData(i.USER_PROFILE)},i.userPreferences=function(){return r.getData(i.USER_PREFERENCES)},i.authCheckAsync=async function(){const e=await b();return await(null==e?void 0:e.authCheckAsync())},i.initialUserPreferencesAsync=async function(){const e=await b();return await(null==e?void 0:e.initialUserPreferencesAsync())},i.loginAsync=async function(e,t,i){const n=await b();await(null==n?void 0:n.loginAsync(e,t,i))},i.loginCallbackAsync=async function(e){await pxt.auth.loginCallbackAsync(e)},i.logoutAsync=async function(){const e=await b();await(null==e?void 0:e.logoutAsync("#"))},i.deleteProfileAsync=async function(){const e=await b();await(null==e?void 0:e.deleteProfileAsync())},i.patchUserPreferencesAsync=v,i.setHighContrastPrefAsync=async function(e){const t=await b();t?await t.patchUserPreferencesAsync({op:"replace",path:["highContrast"],value:e}):(pxt.storage.setLocal(i.HIGHCONTRAST,e.toString()),r.invalidate(i.HIGHCONTRAST))},i.setLangaugePrefAsync=async function(e){const t=await b();t?await t.patchUserPreferencesAsync({op:"replace",path:["language"],value:e},{immediate:!0}):(pxt.storage.setLocal(i.LANGUAGE,e),r.invalidate(i.LANGUAGE))},i.setImmersiveReaderPrefAsync=async function(e){const t=await b();t?await t.patchUserPreferencesAsync({op:"replace",path:["reader"],value:e}):(pxt.storage.setLocal(i.READER,e),r.invalidate(i.READER))},i.setEmailPrefAsync=async function(e){return await v({op:"replace",path:["email"],value:e},{immediate:!0})},i.apiAsync=async function(e,t,i){const n=await b();return await(null==n?void 0:n.apiAsync(e,t,i))}},{"./cloud":26,"./core":78,"./data":81}],21:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.dismissIfVisible=i.init=i.setContainerClass=i.setEditorBounds=i.FieldEditorView=void 0;const n=e("react"),r=e("react-dom"),o=e("./components/ImageFieldEditor");let s,a;class l{constructor(e){this.contentDiv=e,this.resizeContentCore=()=>{this.resizeFrameRef=void 0;const e=this.editorBounds;let t=25,i=25;e.width-2*t<500&&(t=0,i=0),e.height-2*i<610&&(i=(i=Math.min(e.height-610,0)/2)<0?0:i,t=0),t=null!=e.horizontalPadding?e.horizontalPadding:t,i=null!=e.horizontalPadding?e.verticalPadding:i,this.contentBounds={left:e.left+t,top:e.top+i,width:e.width-2*t,height:e.height-2*i},this.contentDiv.style.left=this.contentBounds.left+"px",this.contentDiv.style.top=this.contentBounds.top+"px",this.contentDiv.style.width=this.contentBounds.width+"px",this.contentDiv.style.height=this.contentBounds.height+"px",this.overlayDiv.style.left=e.left+"px",this.overlayDiv.style.top=e.top+"px",this.overlayDiv.style.width=e.width+"px",this.overlayDiv.style.height=e.height+"px",this.componentRef&&this.visible&&this.componentRef.onResize&&this.componentRef.onResize()},this.handleOutsideClick=e=>{this.contentBounds&&(function(e,t,i){return!(e<i.left||e>i.left+i.width||t<i.top||t>i.top+i.height)}(e.clientX,e.clientY,this.contentBounds)||(e.stopPropagation(),this.hide()))}}injectElement(e){r.render(e,this.contentDiv)}setRef(e){this.componentRef=e,e&&this.persistentData&&(e.restorePersistentData(this.persistentData),this.persistentData=void 0)}show(){!this.visible&&this.contentDiv&&(this.visible=!0,this.resize(this.editorBounds),this.contentDiv.style.display="",this.overlayDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.overlayDiv,"blocks-editor-field-overlay"),this.contentDiv.parentElement.appendChild(this.overlayDiv),this.overlayDiv.addEventListener("mousedown",this.handleOutsideClick),document.addEventListener("mousedown",this.handleOutsideClick))}hide(){var e,t;this.visible&&this.contentDiv&&(null!==(t=null===(e=this.componentRef)||void 0===e?void 0:e.shouldPreventHide)&&void 0!==t&&t.call(e)||(this.visible=!1,this.resizeFrameRef&&cancelAnimationFrame(this.resizeFrameRef),this.clearContents(),this.contentDiv.style.display="none",this.overlayDiv.parentElement.removeChild(this.overlayDiv),document.removeEventListener("mousedown",this.handleOutsideClick),this.hideCallback&&this.hideCallback()))}onHide(e){this.hideCallback=e}getResult(){return this.componentRef?this.componentRef.getValue():void 0}resize(e){this.editorBounds=e,this.visible&&(this.resizeFrameRef&&cancelAnimationFrame(this.resizeFrameRef),this.resizeFrameRef=requestAnimationFrame(this.resizeContentCore))}dispose(){this.contentDiv&&(this.hide(),this.contentDiv=null)}getPersistentData(){return this.componentRef.getPersistentData()}restorePersistentData(e){this.componentRef?this.componentRef.restorePersistentData(e):this.persistentData=e}setContainerClass(e){this.contentDiv&&this.contentDiv.classList.contains(this.containerClass)&&this.contentDiv.classList.remove(this.containerClass),this.containerClass=e,this.updateContainerClass()}clearContents(){for(r.unmountComponentAtNode(this.contentDiv);this.contentDiv.firstChild;)this.contentDiv.removeChild(this.contentDiv.firstChild)}updateContainerClass(){this.contentDiv&&this.containerClass&&(this.contentDiv.classList.contains(this.containerClass)||this.contentDiv.classList.add(this.containerClass))}}function c(){a&&a.dispose(),a=void 0}i.FieldEditorView=l,i.setEditorBounds=function(e){a&&a.resize(e),s=e},i.setContainerClass=function(e){a&&a.setContainerClass(e)},i.init=function(){pxt.react.getFieldEditorView=function(e,t,i){a&&a.dispose();const r=e=>{e&&a&&(a.setRef(e),e.init(t,c,i))};switch(a=new l(document.getElementById("blocks-editor-field-div")),e){case"image-editor":a.injectElement(n.createElement(o.ImageFieldEditor,{ref:r,singleFrame:!0}));break;case"animation-editor":a.injectElement(n.createElement(o.ImageFieldEditor,{ref:r,singleFrame:!1}));break;case"tilemap-editor":a.injectElement(n.createElement(o.ImageFieldEditor,{ref:r,singleFrame:!0}))}return s&&a.resize(s),a};let e=new pxt.TilemapProject;pxt.react.getTilemapProject=()=>e},i.dismissIfVisible=c},{"./components/ImageFieldEditor":55,react:335,"react-dom":291}],22:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Editor=void 0;const n=e("react"),r=e("react-dom"),o=e("./package"),s=e("./core"),a=e("./toolboxeditor"),l=e("./compiler"),c=e("./toolbox"),u=e("./blocksSnippets"),d=e("./workspace"),p=e("./simulator"),h=e("./dialogs"),f=e("./blocklyFieldView"),m=e("./createFunction"),g=e("./snippetBuilder");var b=pxt.Util;const v=e("./debuggerToolbox"),y=e("./errorList"),k=e("./extensionManager");class w extends a.ToolboxEditor{constructor(e){super(e),this.isFirstBlocklyLoad=!0,this.functionsDialog=null,this.showCategories=!0,this.errorChangesListeners={},this.handleKeyDown=e=>{var t;(null===(t=this.parent.state)||void 0===t?void 0:t.accessibleBlocks)&&84===("number"==typeof e.which?e.which:e.keyCode)&&(this.focusToolbox(),e.stopPropagation())},this.markIncomplete=!1,this.handleToolboxRef=e=>{this.toolbox=e},this.handleDebuggerToolboxRef=e=>{this.debuggerToolbox=e},this.flyoutBlockXmlCache={},this.flyoutXmlList=[],this.flyouts={},this.listenToBlockErrorChanges=this.listenToBlockErrorChanges.bind(this),this.onErrorListResize=this.onErrorListResize.bind(this)}setBreakpointsMap(e,t){let i={};e&&this.compilationResult&&(e.forEach((e=>{let t=pxt.blocks.findBlockIdByLine(this.compilationResult.sourceMap,{start:e.line,length:e.endLine-e.line});t&&(i[t]=e.id)})),this.breakpointsByBlock=i)}setBreakpointsFromBlocks(){this.breakpointsSet=this.getBreakpoints(),p.driver.setBreakpoints(this.breakpointsSet)}getBreakpoints(){const e=[],t=this.breakpointsByBlock;return t&&this.editor&&this.editor.getAllBlocks(!1).forEach((i=>{t[i.id]&&i.isBreakpointSet()&&e.push(this.breakpointsByBlock[i.id])})),e}addBreakpointFromEvent(e){this.breakpointsSet.push(this.breakpointsByBlock[e]),p.driver.setBreakpoints(this.breakpointsSet)}removeBreakpointFromEvent(e){let t=this.breakpointsByBlock[e];this.breakpointsSet.filter((e=>e!=t)),p.driver.setBreakpoints(this.breakpointsSet)}clearBreakpoints(){p.driver.setBreakpoints([])}setVisible(e){super.setVisible(e),this.isVisible=e;let t="#blocksEditor .blocklyToolboxDiv, #blocksEditor .blocklyWidgetDiv, #blocksEditor .blocklyToolboxDiv";this.isVisible?(pxt.Util.toArray(document.querySelectorAll(t)).forEach((e=>e.style.display="")),this.parent.fireResize()):(pxt.Util.toArray(document.querySelectorAll(t)).forEach((e=>e.style.display="none")),this.editor&&Blockly.hideChaff(),this.toolbox&&this.toolbox.clearExpandedItem())}saveToTypeScriptAsync(e=!1){if(!this.typeScriptSaveable)return Promise.resolve(void 0);this.clearHighlightedStatements();try{return pxt.blocks.compileAsync(this.editor,this.blockInfo,{emitTilemapLiterals:e}).then((t=>{this.compilationResult=t,pxt.tickEvent("activity.blocks.compile");let i=Promise.resolve();return e&&this.parent&&(function(e){x(e,(e=>e.clearTemporaryAssetData()))}(this.editor),i=this.parent.saveCurrentSourceAsync().then((()=>function(e){x(e,(e=>e.disposeOfTemporaryAsset()))}(this.editor)))),i.then((()=>this.compilationResult.source))}))}catch(e){return pxt.reportException(e),s.errorNotification(lf("Sorry, we were not able to convert this program.")),Promise.resolve(void 0)}}domUpdate(){if(this.delayLoadXml){if(this.loadingXml)return;pxt.debug("loading blockly"),pxt.perf.measureStart("domUpdate loadBlockly"),this.loadingXml=!0;const e=document.createElement("div");e.className="ui active dimmer";const t=document.createElement("div");t.className="ui text loader",t.appendChild(document.createTextNode(lf("Loading blocks..."))),e.appendChild(t);let i=document.getElementById("blocksEditor");i.appendChild(e),l.clearCaches(),this.loadingXmlPromise=this.loadBlocklyAsync().then((()=>l.getBlocksAsync())).then((e=>{this.blockInfo=e,pxt.blocks.initialize(this.blockInfo),this.nsMap=this.partitionBlocks(),this.refreshToolbox(),pxt.debug("loading block workspace");let t=this.delayLoadXml;this.delayLoadXml=void 0,this.loadBlockly(t),this.resize(),Blockly.svgResize(this.editor),this.isFirstBlocklyLoad=!1})).finally((()=>{try{i.removeChild(e)}catch(e){}this.loadingXml=!1,this.loadingXmlPromise=null,pxt.perf.measureEnd("domUpdate loadBlockly"),this.parent.isTutorial()&&this.parent.onTutorialLoaded()}))}}isDropdownDivVisible(){return"undefined"!=typeof Blockly&&Blockly.DropDownDiv&&Blockly.DropDownDiv.isVisible()}beforeCompile(){"undefined"!=typeof Blockly&&(Blockly.DropDownDiv.hide(),Blockly.WidgetDiv.hide())}getTemporaryAssets(){return this.editor?pxtblockly.getTemporaryAssets(this.editor,"image").concat(pxtblockly.getTemporaryAssets(this.editor,"animation")):[]}updateTemporaryAsset(e){this.editor.getBlockById(e.meta.temporaryInfo.blockId).getField(e.meta.temporaryInfo.fieldName).updateAsset(e)}saveBlockly(){return this.delayLoadXml?this.delayLoadXml:this.serializeBlocks()}serializeBlocks(e){let t=pxt.blocks.saveWorkspaceXml(this.editor,!e&&this.parent.state&&this.parent.state.header&&!!this.parent.state.header.githubId);return e&&(t=t.replace(/(x|y|id)="[^"]*"/g,"")),pxt.debug(t),t}loadBlockly(e){if(this.serializeBlocks()==e)return this.typeScriptSaveable=!0,pxt.debug("blocks already loaded..."),!1;this.typeScriptSaveable=!1,pxt.blocks.clearWithoutEvents(this.editor);try{const t=e||`<block type="${ts.pxtc.ON_START_TYPE}"></block>`,i=Blockly.Xml.textToDom(t);pxt.blocks.domToWorkspaceNoEvents(i,this.editor),pxtblockly.upgradeTilemapsInWorkspace(this.editor,pxt.react.getTilemapProject()),this.initLayout(),this.editor.clearUndo(),this.reportDeprecatedBlocks(),this.updateGrayBlocks(),this.typeScriptSaveable=!0}catch(e){return pxt.log(e),pxt.blocks.clearWithoutEvents(this.editor),this.switchToTypeScript(),this.changeCallback(),!1}return this.changeCallback(),!0}initLayout(){let e,t,i=!1,n=!this.editor.getToolbox()&&this.editor.getFlyout();this.editor.getTopComments(!1).forEach((n=>{const r=n.getBoundingRectangle(),o=Math.sqrt(r.left*r.left+r.top*r.top);(void 0===e||o<e)&&(t=r,e=o),i=i||10==r.left&&10==r.top}));let r=[];this.editor.getTopBlocks(!1).forEach((n=>{const o=n.getBoundingRectangle(),s=Math.sqrt(o.left*o.left+o.top*o.top);(void 0===e||s<e)&&(t=o,e=s);const a=!!r.find((e=>e.left===o.left&&e.top===o.top));i=i||a,r.push(o)})),i&&!n?pxt.blocks.layout.flow(this.editor,{useViewWidth:!0}):(t&&(this.editor.getTopComments(!1).forEach((e=>e.moveBy(-t.left,-t.top))),this.editor.getTopBlocks(!1).forEach((e=>e.moveBy(-t.left,-t.top)))),this.editor.scrollX=10,this.editor.scrollY=10,this.editor.resizeContents())}initPrompts(){Blockly.alert=function(e,t){return s.confirmAsync({hideCancel:!0,header:lf("Alert"),agreeLbl:lf("Ok"),agreeClass:"positive",agreeIcon:"checkmark",body:e,size:"tiny"}).then((()=>{t&&t()}))},Blockly.confirm=function(e,t){return s.confirmAsync({header:lf("Confirm"),body:e,agreeLbl:lf("Yes"),agreeClass:"positive",agreeIcon:"checkmark",disagreeLbl:lf("No"),disagreeClass:"cancel",disagreeIcon:"cancel",size:"tiny"}).then((e=>{t(1==e)}))},Blockly.prompt=function(e,t,i,n){return s.promptAsync(Object.assign({header:e,initialValue:t,agreeLbl:lf("Ok"),hasCloseIcon:!0,size:"tiny"},n)).then((e=>{i(e)}))},pxt.Util.isTranslationMode()&&(pxt.blocks.promptTranslateBlock=h.promptTranslateBlock)}initBlocklyToolbox(){let e=this;const t=Blockly.Toolbox.prototype.position;Blockly.Toolbox.prototype.position=function(){t.call(this),e.resizeToolbox()};const i=this;Blockly.WorkspaceSvg.prototype.refreshToolboxSelection=function(){let e=this.isFlyout?this.targetWorkspace:this;e&&!e.currentGesture_&&e.toolbox_&&e.toolbox_.flyout_&&i.toolbox.refreshSelection()};const n=Blockly.hideChaff;Blockly.hideChaff=function(e){n(e),e||i.hideFlyout()}}initWorkspaceSounds(){const e=this,t=Blockly.WorkspaceAudio.prototype.play;Blockly.WorkspaceAudio.prototype.play=function(i,n){e&&e.parent.state.mute&&(n=0),t.call(this,i,n)}}initAccessibleBlocks(){var e;(null===(e=pxt.appTarget.appTheme)||void 0===e?void 0:e.accessibleBlocks)&&!this.navigationController&&(this.navigationController=new NavigationController,this.navigationController.init(),this.navigationController.addWorkspace(this.editor),Navigation.prototype.focusToolbox=e=>{this.toolbox&&(this.focusToolbox(),this.navigationController.navigation.resetFlyout(e,!1),this.navigationController.navigation.setState(e,"toolbox"))})}enableAccessibleBlocks(e){e?this.navigationController.enable(this.editor):this.navigationController.disable(this.editor)}initWorkspaceSearch(){pxt.appTarget.appTheme.workspaceSearch&&!this.workspaceSearch&&(this.workspaceSearch=new pxt.blocks.PxtWorkspaceSearch(this.editor),this.workspaceSearch.init())}reportDeprecatedBlocks(){const e={};let t=!1;this.blockInfo.blocks.forEach((t=>{t.attributes.deprecated&&(e[t.attributes.blockId]=0)})),this.editor.getAllBlocks(!1).forEach((i=>{e[i.type]>=0&&(e[i.type]++,t=!0)}));for(const t in e)0!==e[t]&&pxt.tickEvent("blocks.usingDeprecated",{block:t,count:e[t]})}contentSize(){return this.editor?pxt.blocks.blocksMetrics(this.editor):void 0}isIncomplete(){const e=this.editor&&this.editor.currentGesture_&&this.editor.currentGesture_.isDraggingBlock_;return e&&(this.markIncomplete=!0),e}prepare(){this.isReady=!0}prepareBlockly(e){pxt.perf.measureStart("prepareBlockly");let t=document.getElementById("blocksEditor");if(!t)return;pxsim.U.clear(t),this.editor=Blockly.inject(t,this.getBlocklyOptions(e)),this.editor.options.hasCategories;let i=Blockly.Colours;b.jsonMergeFrom(i,pxt.appTarget.appTheme.blocklyColors||{}),Blockly.Colours=i;let n=!1;this.editor.addChangeListener((e=>{if(Blockly.Events.disableOrphans(e),(e.type!=Blockly.Events.UI&&e.type!=Blockly.Events.VIEWPORT_CHANGE||this.markIncomplete)&&(this.changeCallback(),this.markIncomplete=!1),e.type==Blockly.Events.CREATE){let t=e.xml.getAttribute("type");"variables_set"==t&&this.clearFlyoutCaches(),t!==pxtc.TS_STATEMENT_TYPE&&t!==pxtc.TS_OUTPUT_TYPE||this.updateGrayBlocks(),pxt.tickEvent("blocks.create",{block:t},{interactiveConsent:!0}),"SHADOW"==e.xml.tagName&&this.cleanUpShadowBlocks(),this.parent.state.tutorialOptions&&this.parent.state.tutorialOptions.metadata&&this.parent.state.tutorialOptions.metadata.flyoutOnly||this.parent.setState({hideEditorFloats:!1}),d.fireEvent({type:"create",editor:"blocks",blockId:t})}else if(e.type==Blockly.Events.VAR_CREATE||e.type==Blockly.Events.VAR_RENAME||e.type==Blockly.Events.VAR_DELETE)this.clearFlyoutCaches();else if(e.type==Blockly.Events.UI)if("category"==e.element){let t=!!e.newValue;t&&pxt.setInteractiveConsent(!0),this.parent.setState({hideEditorFloats:t})}else"breakpointSet"==e.element?this.setBreakpointsFromBlocks():"melody-editor"==e.element&&(e.newValue?(n=this.parent.state.simState!=pxt.editor.SimState.Stopped,this.parent.stopSimulator()):n&&this.parent.startSimulator());null!=this.parent.state.tutorialOptions&&this.parent.pokeUserActivity()})),this.shouldShowCategories()&&this.renderToolbox(),this.hideFlyout(),this.initPrompts(),this.initBlocklyToolbox(),this.initWorkspaceSounds(),this.initAccessibleBlocks(),this.initWorkspaceSearch(),this.resize(),pxt.perf.measureEnd("prepareBlockly")}resize(e){this.getBlocksAreaDiv()&&this.getBlocksEditorDiv()&&this.editor&&(Blockly.svgResize(this.editor),this.resizeToolbox(),this.resizeFieldEditorView())}resizeToolbox(){if(!this.getBlocksEditorDiv())return;const e=this.getBlocklyToolboxDiv();e&&(this.parent.isBlocksActive()&&this.parent.updateEditorLogo(e.offsetWidth),this.getBlocklyOptions(this.showCategories).horizontalLayout||(e.style.height="100%"))}resizeFieldEditorView(){if(!window)return;const e=this.getBlocksEditorDiv();if(e&&this.parent.isTutorial()&&!pxt.BrowserUtils.isTabletSize()){const t=e.getBoundingClientRect();f.setEditorBounds({top:t.top,left:t.left,width:t.width,height:t.height})}else f.setEditorBounds({top:0,left:0,width:window.innerWidth,height:window.innerHeight})}hasUndo(){return!!this.editor&&(0!=this.editor.undoStack_.length||0==this.editor.undoStack_.length&&0==this.editor.redoStack_.length)}undo(){this.editor&&(this.editor.undo(!1),Blockly.hideChaff(),this.parent.forceUpdate())}hasRedo(){return!!this.editor&&0!=this.editor.redoStack_.length}redo(){this.editor&&(this.editor.undo(!0),Blockly.hideChaff(),this.parent.forceUpdate())}zoomIn(){this.editor&&this.editor.zoomCenter(.8)}zoomOut(){this.editor&&this.editor.zoomCenter(-.8)}setScale(e){this.editor&&e!=this.editor.scale&&this.editor.setScale(e)}closeFlyout(){this.editor&&this.hideFlyout()}getId(){return"blocksArea"}display(){let e=this.parent.state.editorState&&!1===this.parent.state.editorState.hasCategories,t=pxt.appTarget.appTheme.blocksErrorList;return n.createElement("div",{className:"blocksAndErrorList"},n.createElement("div",{className:"blocksEditorOuter"},n.createElement("div",{id:"blocksEditor"}),n.createElement(c.ToolboxTrashIcon,{flyoutOnly:e})),t&&n.createElement(y.ErrorList,{isInBlocksEditor:!0,listenToBlockErrorChanges:this.listenToBlockErrorChanges,onSizeChange:this.onErrorListResize}))}onErrorListResize(){this.parent.fireResize()}listenToBlockErrorChanges(e,t){this.errorChangesListeners[e]=t}onBlockErrorChanges(e){for(let t of pxt.U.values(this.errorChangesListeners))t(e)}async validateTutorialCode(e){const{tutorialStep:t}=e,i=this.editor.getAllBlocks(!1),n=await pxt.tutorial.validate(e,i,this.blockInfo);this.parent.setTutorialCodeStatus(t,n)}getBlocksAreaDiv(){return document.getElementById("blocksArea")}getBlocksEditorDiv(){return this.getBlocksAreaDiv()?document.getElementById("blocksEditor"):void 0}getBlocklyToolboxDiv(){const e=this.getBlocksAreaDiv();return e?e.getElementsByClassName("blocklyToolboxDiv")[0]:void 0}moveFocusToFlyout(){}focusToolbox(){this.toolbox&&this.toolbox.focus()}renderToolbox(e){if(pxt.shell.isReadOnly())return;const t=this.getBlocklyToolboxDiv(),i=n.createElement("div",{className:"blocklyToolbox"},n.createElement(c.Toolbox,{ref:this.handleToolboxRef,editorname:"blocks",parent:this}),n.createElement("div",{id:"debuggerToolbox"}));b.assert(!!t),r.render(i,t),e||this.toolbox.showLoading()}updateToolbox(){var e;const t=document.getElementById("debuggerToolbox");if(!t)return;pxt.perf.measureStart("updateToolbox");const i=!!this.parent.state.debugging;let o=i?n.createElement(v.DebuggerToolbox,{ref:this.handleDebuggerToolboxRef,parent:this.parent,apis:this.blockInfo.apis.byQName}):n.createElement("div",null);i?(this.toolbox.hide(),null===(e=Blockly.selected)||void 0===e||e.unselect()):(this.debuggerToolbox=null,this.toolbox.show()),r.render(o,t),pxt.perf.measureEnd("updateToolbox")}showPackageDialog(){pxt.tickEvent("blocks.addpackage"),this.editor.getToolbox()&&this.editor.getToolbox().clearSelection(),this.parent.showPackageDialog()}showVariablesFlyout(){this.showFlyoutInternal_(Blockly.Variables.flyoutCategory(this.editor),"variables")}showFunctionsFlyout(){this.showFlyoutInternal_(Blockly.Functions.flyoutCategory(this.editor),"functions")}getViewState(){return{}}setViewState(e){}getCurrentSource(){return this.editor&&!this.delayLoadXml?this.saveBlockly():this.currSource}acceptsFile(e){return"blocks"==e.getExtension()}overrideFile(e){this.delayLoadXml?(this.delayLoadXml=e,this.currSource=e):this.loadBlockly(e)}insertBreakpoint(){if(!this.editor)return;const e=this.editor.newBlock(pxtc.TS_DEBUGGER_TYPE),t=this.editor.getMetrics();e.moveBy(t.viewWidth/2,t.viewHeight/3),e.initSvg(),e.render()}loadBlocklyAsync(){return this._loadBlocklyPromise||(pxt.perf.measureStart("loadBlockly"),this._loadBlocklyPromise=pxt.BrowserUtils.loadBlocklyAsync().then((()=>{Blockly.Functions.editFunctionExternalHandler=(e,t)=>{b.delay(10).then((()=>{if(!this.functionsDialog){const e=document.body.appendChild(document.createElement("div"));this.functionsDialog=r.render(n.createElement(m.CreateFunctionDialog,{parent:this.parent}),e)}this.functionsDialog.show(e,t,this.editor)}))},pxt.blocks.openHelpUrl=e=>{var t;pxt.tickEvent("blocks.help",{url:e},{interactiveConsent:!0});const i=/^\/pkg\/([^#]+)#(.+)$/.exec(e);if(i){const t=o.mainPkg.deps[i[1]];if(t&&"github"==t.verProtocol())return e=`/pkg/${t.verArgument().replace(/#.*$/,"")}#${i[2]}`,void window.open(e,i[1])}if(/^github:/.test(e)){e=e.replace(/^github:\/?/,"")+(/\.md$/i.test(e)?"":".md");const i=o.getEditorPkg(o.mainPkg).lookupFile(e),n=null===(t=null==i?void 0:i.content)||void 0===t?void 0:t.trim();n&&(this.parent.setSideMarkdown(n),this.parent.setSideDocCollapsed(!1))}else/^\//.test(e)?this.parent.setSideDoc(e):window.open(e,"docs")},this.prepareBlockly()})).then((()=>pxt.editor.initEditorExtensionsAsync())).then((()=>pxt.perf.measureEnd("loadBlockly")))),this._loadBlocklyPromise}loadFileAsync(e){return b.assert(!this.delayLoadXml),(this.loadingXmlPromise||Promise.resolve()).then((()=>this.loadBlocklyAsync())).then((()=>{pxt.blocks.cleanBlocks(),this.toolbox&&this.toolbox.showLoading(),this.blockInfo=void 0,this.currSource=e.content,this.typeScriptSaveable=!1,this.setDiagnostics(e),this.delayLoadXml=e.content,this.parent.shouldPreserveUndoStack()||pxt.blocks.clearWithoutEvents(this.editor),this.closeFlyout(),this.filterToolbox(),this.parent.state.editorState&&null!=this.parent.state.editorState.hasCategories?this.showCategories=this.parent.state.editorState.hasCategories:this.showCategories=!0,this.currFile=e;let t=document.getElementById("blocklySearchInputField");t&&t.value&&(t.value=""),this.extensions=!!pxt.appTarget.appTheme.allowPackageExtensions&&o.allEditorPkgs().map((e=>e.getKsPkg())).filter((e=>{var t;return!!(null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.extension)}))||[]}))}unloadFileAsync(){return this.delayLoadXml=void 0,this.toolbox&&this.toolbox.clearSearch(),Promise.resolve()}switchToTypeScript(){pxt.tickEvent("blocks.switchjavascript"),this.parent.closeFlyout(),this.parent.switchTypeScript()}setDiagnostics(e){if(b.assert(null!=this.editor),!this.compilationResult||this.delayLoadXml||this.loadingXml)return;this.editor.getAllBlocks(!1).filter((e=>e.isEnabled())).forEach((e=>{e.setWarningText(null),e.setHighlightWarning(!1)}));let t=e&&e.epkg&&e.epkg.files[e.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)];if(!t||!t.diagnostics)return;let i=t.diagnostics.filter((e=>e.category==ts.pxtc.DiagnosticCategory.Error)),n=this.compilationResult.sourceMap;i.filter((e=>e.category==ts.pxtc.DiagnosticCategory.Error)).forEach((e=>{let t=pxt.blocks.findBlockIdByLine(n,{start:e.line,length:0});if(t){let i=this.editor.getBlockById(t);if(i){let t=ts.pxtc.flattenDiagnosticMessageText(e.messageText,"\n");i.setWarningText(t),i.setHighlightWarning(!0)}}})),this.compilationResult.diagnostics.forEach((e=>{if(e.blockId){let t=this.editor.getBlockById(e.blockId);t&&(t.setWarningText(e.message),t.setHighlightWarning(!0))}})),this.onBlockErrorChanges(this.compilationResult.diagnostics),this.setBreakpointsFromBlocks()}highlightStatement(e,t){if(!this.compilationResult||this.delayLoadXml||this.loadingXml)return!1;if(this.updateDebuggerVariables(t),!e)return this.editor.highlightBlock(null),!1;{let i=pxt.blocks.findBlockIdByLine(this.compilationResult.sourceMap,{start:e.line,length:e.endLine-e.line});if(i){const e=this.editor.getBlockById(i).getRootBlock();if(i=(null==e?void 0:e.isCollapsed())?e.id:i,this.editor.highlightBlock(i),t){const e=this.editor.getBlockById(i);e.setWarningText(t?t.exceptionMessage:void 0);const n=e.getRelativeToSurfaceXY(),r=e.getHeightWidth(),o=this.editor.scale,s=this.editor.getMetrics(),a=4,l=4;(n.x*o<s.viewLeft+a||(n.x+r.width)*o>s.viewLeft+s.viewWidth-a||n.y*o<s.viewTop+l||(n.y+r.height)*o>s.viewTop+s.viewHeight-l)&&this.editor.centerOnBlock(i)}return!0}}return!1}updateDebuggerVariables(e){if(this.parent.state.debugging&&this.debuggerToolbox){const t=Blockly.Variables.allUsedVarModels(this.editor).map((e=>pxtc.escapeIdentifier(e.name)));this.debuggerToolbox.setBreakpoint(e,t)}}clearHighlightedStatements(){this.editor.highlightBlock(null),this.debuggerToolbox&&this.debuggerToolbox.setBreakpoint(null)}openTypeScript(){pxt.tickEvent("blocks.showjavascript"),this.parent.closeFlyout(),this.parent.openTypeScriptAsync()}openPython(){pxt.tickEvent("blocks.showpython"),this.parent.closeFlyout(),this.parent.openPythonAsync()}cleanUpShadowBlocks(){this.editor.getTopBlocks(!1).filter((e=>e.isShadow())).forEach((e=>e.dispose(!1)))}getBlocklyOptions(e){let t=this.getDefaultOptions();b.jsonMergeFrom(t,pxt.appTarget.appTheme.blocklyOptions||{});const i=null!=e?e:null!=t.hasCategories?t.hasCategories:this.showCategories;t.hasCategories=i,t.renderer="pxt",i||(this.showCategories=!1);const n=i?document.getElementById("blocklyToolboxDefinitionCategory"):document.getElementById("blocklyToolboxDefinitionFlyout");return t.toolbox=null!=t.toolbox?t.toolbox:t.readOnly?void 0:n,t}getDefaultOptions(){if(this.blocklyOptionsCache)return this.blocklyOptionsCache;const e=pxt.shell.isReadOnly(),t=pxt.appTarget.appTheme,i={media:pxt.webConfig.commitCdnUrl+"blockly/media/",sounds:!0,trashcan:!1,collapse:!!t.blocksCollapsing,comments:!0,disable:!1,readOnly:e,toolboxOptions:{colour:t.coloredToolbox,inverted:t.invertedToolbox},move:{scrollbars:!0,wheel:!0},zoom:{controls:!1,maxScale:2.5,minScale:.2,scaleSpeed:1.5,startScale:pxt.BrowserUtils.isMobile()?.7:.9,pinch:!0},rtl:b.isUserLanguageRtl()};return this.blocklyOptionsCache=i,i}refreshToolbox(){if(!this.blockInfo)return;if(pxt.perf.measureStart("refreshToolbox"),pxt.shell.isReadOnly())return;if(null!=this.parent.state.tutorialOptions&&!this.parent.state.tutorialOptions.tutorialReady)return;this.clearCaches();const e=this.parent.state.editorState&&!1===this.parent.state.editorState.hasCategories,t=this.shouldShowCategories(!e);if(this.editor.getToolbox()&&t||this.editor.flyout_&&!t)t?this.toolbox.setState({loading:!1,categories:this.getAllCategories(),showSearchBox:this.shouldShowSearch()}):this.showFlyoutOnlyToolbox();else{t||r.unmountComponentAtNode(this.getBlocklyToolboxDiv());const e=()=>{this.delayLoadXml=this.getCurrentSource(),this.editor=void 0,this.prepareBlockly(t),this.domUpdate(),this.editor.scrollCenter(),t&&this.renderToolbox(!0)};this.loadingXmlPromise?this.loadingXmlPromise.then(e):e()}pxt.perf.measureEnd("refreshToolbox")}filterToolbox(e){this.showCategories=e,this.refreshToolbox()}async openExtension(e){const t=this.extensions.filter((t=>t.config.name===e))[0];if(!(null==t?void 0:t.config.extension))return;pxt.tickEvent("blocks.extensions.open",{extension:e});const{name:i,url:n,trusted:r}=await k.resolveExtensionUrl(t);if(!r)return s.errorNotification(lf("Sorry, this extension is not allowed.")),void pxt.tickEvent("blocks.extensions.untrusted",{extension:e});pxt.tickEvent("blocks.extensions.trusted",{extension:e}),this.parent.openExtension(i,n)}partitionBlocks(){const e={};this.topBlocks=[];const t=this;function i(e,i){t.subcategoryMap[e]||(t.subcategoryMap[e]={}),t.subcategoryMap[e][i]=!0}return pxt.blocks.injectBlocks(this.blockInfo).forEach((t=>{let n=(t.attributes.blockNamespace||t.namespace).split(".")[0];e[n]||(e[n]=[]),e[n].push(t);const r=t.attributes.subcategory;t.attributes.advanced?i(n,lf("more")):r&&i(n,r),t.attributes.topblock&&this.topBlocks.push(t)})),e}hideFlyout(){this.editor.getToolbox()&&this.editor.getFlyout().hide(),this.toolbox&&this.toolbox.clear()}clearCaches(){super.clearCaches(),this.clearFlyoutCaches(),u.clearBuiltinBlockCache()}clearFlyoutCaches(){this.flyoutBlockXmlCache={}}shouldShowSearch(){return!this.parent.state.editorState||null==this.parent.state.editorState.searchBar||this.parent.state.editorState.searchBar}shouldShowCategories(e){return this.parent.state.editorState&&null!=this.parent.state.editorState.hasCategories?this.parent.state.editorState.hasCategories:this.getBlocklyOptions(e).hasCategories}getBuiltinCategory(e){return u.getBuiltinCategory(e)}isBuiltIn(e){return u.isBuiltin(e)}getNamespaceAttrs(e){const t=u.getBuiltinCategory(e);return t?(t.attributes.color=pxt.toolbox.getNamespaceColor(t.nameid),t.attributes):this.blockInfo?super.getNamespaceAttrs(e):void 0}getNamespaces(){const e=Object.keys(this.nsMap).filter((e=>!u.isBuiltin(e)&&!!this.getNamespaceAttrs(e)));function t(e){return u.getBuiltinCategory(e).removed}let i=pxt.appTarget.runtime||{};return i.loopsBlocks&&!t("loops")&&e.push("loops"),i.logicBlocks&&!t("logic")&&e.push("logic"),i.variablesBlocks&&!t("variables")&&e.push("variables"),i.mathBlocks&&!t("Math")&&e.push("Math"),i.functionBlocks&&!t("functions")&&e.push("functions"),i.listsBlocks&&!t("arrays")&&e.push("arrays"),i.textBlocks&&!t("text")&&e.push("text"),pxt.appTarget.cloud&&pxt.appTarget.cloud.packages&&e.push("addpackage"),e.concat(super.getNamespaces())}getBlocksForCategory(e,t){return u.isBuiltin(e)?this.getBuiltInBlocks(e,t).concat(this.getExtraBlocks(e,t)):this.getNonBuiltInBlocks(e,t).concat(this.getExtraBlocks(e,t))}filterBlocks(e,t){return t.filter((t=>!t.attributes.blockHidden&&!(t.attributes.deprecated&&!this.parent.isTutorial())&&(!e&&!t.attributes.subcategory&&!t.attributes.advanced||e&&(t.attributes.advanced&&e==lf("more")||t.attributes.subcategory&&e==t.attributes.subcategory))))}getBuiltInBlocks(e,t){let i=u.getBuiltinCategory(e),n=i.blocks||[];return!i.custom&&this.nsMap[e]&&(n=this.filterBlocks(t,n.concat(this.nsMap[e]))),n}getNonBuiltInBlocks(e,t){return this.filterBlocks(t,this.nsMap[e])||[]}getExtraBlocks(e,t){if(t)return[];let i=[];const n=pxt.appTarget.runtime.onStartNamespace||"loops";e==n&&i.push({name:ts.pxtc.ON_START_TYPE,attributes:{blockId:ts.pxtc.ON_START_TYPE,weight:pxt.appTarget.runtime.onStartWeight||10},blockXml:'<block type="pxt-on-start"></block>'});const r=u.getPauseUntil();return r&&e==r.attributes.blockNamespace&&i.push(r),t||this.extensions.forEach((t=>{const n=t.config,r=n.name,o=n.extension.namespace||r;e==o&&i.push({name:`EXT${r}_BUTTON`,type:"button",attributes:{blockId:`EXT${r}_BUTTON`,label:n.extension.label?b.rlf(n.extension.label):b.lf("Editor"),weight:101,group:n.extension.group},callback:()=>{this.openExtension(r)}})})),pxt.appTarget.appTheme.snippetBuilder&&g.initializeSnippetExtensions(e,i,this.editor,this.parent),i}showFlyout(e){const{nameid:t,subns:i}=e,n=this.parent.state.tutorialOptions&&!!this.parent.state.tutorialOptions.tutorial;if("search"==t)return void this.showSearchFlyout();if("topblocks"==t)return void this.showTopBlocksFlyout();this.flyoutXmlList=[];let r=t+i+(n?"tutorialexpanded":"");if(this.flyoutBlockXmlCache[r])return pxt.debug("showing flyout with blocks from flyout blocks xml cache"),this.flyoutXmlList=this.flyoutBlockXmlCache[r],void this.showFlyoutInternal_(this.flyoutXmlList,r);this.abstractShowFlyout(e)&&(pxt.Util.isTranslationMode()||(this.flyoutBlockXmlCache[r]=this.flyoutXmlList),this.showFlyoutInternal_(this.flyoutXmlList,r))}showFlyoutHeadingLabel(e,t,i,n,r){const o=t||b.capitalize(i||e),s=`blocklyTreeIcon${n?e.toLowerCase():"Default"}`.replace(/\s/g,"");let a=pxt.blocks.createFlyoutHeadingLabel(o,r,n,s);this.flyoutXmlList.push(a)}showFlyoutGroupLabel(e,t,i,n){let r=pxt.blocks.createFlyoutGroupLabel(pxt.Util.rlf(`{id:group}${e}`),t,i,n?`GROUP_HELP_${e}`:void 0);n&&this.editor.registerButtonCallback(`GROUP_HELP_${e}`,(()=>{this.helpButtonCallback(e)})),this.flyoutXmlList.push(r)}helpButtonCallback(e){pxt.debug(`${e} help icon clicked.`),d.fireEvent({type:"ui",editor:"blocks",action:"groupHelpClicked",data:{group:e}})}showFlyoutBlocks(e,t,i){this.parent.state.editorState&&this.parent.state.editorState.filters,i.sort(((e,t)=>(null!=t.attributes.weight?t.attributes.weight:50)-(null!=e.attributes.weight?e.attributes.weight:50))).forEach((e=>{let t;(t="button"==e.type?this.getButtonXml(e):this.getBlockXml(e))&&(this.flyoutXmlList=this.flyoutXmlList.concat(t))}))}showSearchFlyout(){if(this.flyoutXmlList=[],this.toolbox.getSearchBlocks().forEach((e=>{const t=this.getBlockXml(e,!0);t&&(this.flyoutXmlList=this.flyoutXmlList.concat(t))})),0==this.flyoutXmlList.length){let e=Blockly.utils.xml.createElement("label");e.setAttribute("text",lf("No search results...")),this.flyoutXmlList.push(e)}this.showFlyoutInternal_(this.flyoutXmlList,"search"),this.toolbox.setSearch()}showTopBlocksFlyout(){this.flyoutXmlList=[];const e=this.getTopBlocks();if(0==e.length){let e=Blockly.utils.xml.createElement("label");e.setAttribute("text",lf("No basic blocks...")),this.flyoutXmlList.push(e)}else this.showFlyoutHeadingLabel("topblocks",lf("{id:category}Basic"),null,pxt.toolbox.getNamespaceIcon("topblocks"),pxt.toolbox.getNamespaceColor("topblocks")),e.forEach((e=>{const t=this.getBlockXml(e,!0);t&&(this.flyoutXmlList=this.flyoutXmlList.concat(t))}));this.showFlyoutInternal_(this.flyoutXmlList)}blocksToString(e){let t=null;return e.map((e=>e?e.outerHTML?e.outerHTML:(t||(t=new XMLSerializer),t.serializeToString(e)):"\x3c!-- invalid block here! --\x3e")).reduce(((e,t)=>e+t),"")}hashBlocks(e){return pxt.Util.codalHash16(this.blocksToString(e))}swapFlyout(e,t){e.setVisible(!1),this.editor.getToolbox().setFlyout(t),t.setVisible(!0);const i=t.getWorkspace(),n=t.targetWorkspace;i.getScale()!==n.getScale()&&t.reflow()}showFlyoutInternal_(e,t="default"){var i;if(this.parent.state.editorState&&!1===this.parent.state.editorState.hasCategories||!this.editor.getToolbox())this.editor.flyout_&&(this.editor.flyout_.show(e),this.editor.flyout_.scrollToStart());else{const n=this.editor.getFlyout(),r=t in this.flyouts,o=r?this.flyouts[t].blocksHash:0,s=this.hashBlocks(e),a=o===s&&!!o,l=()=>{const e=this.editor.getToolbox().getWorkspace(),t=n.svgGroup_;return Blockly.Functions.createFlyout(e,t)};let c;r?c=this.flyouts[t].flyout:(c=l(),this.flyouts[t]={flyout:c,blocksHash:0}),this.flyouts[t].blocksHash=s,this.swapFlyout(n,c),a||c.show(e),c.scrollToStart(),(null===(i=this.parent.state)||void 0===i?void 0:i.accessibleBlocks)&&c.svgGroup_.focus()}}showFlyoutOnlyToolbox(){const e=this.getAllCategories();let t=[];e.forEach((e=>{const i=e.blocks;t=t.concat(i),e.subcategories&&e.subcategories.forEach((e=>{const i=e.blocks;t=t.concat(i)}))}));let i=document.createElement("div");r.render(n.createElement(c.ToolboxStyle,{categories:e}),i),document.getElementById("editorcontent").appendChild(i);let o=[];t.forEach((e=>{const t=this.getBlockXml(e);t&&(o=o.concat(t))})),this.showFlyoutInternal_(o),this.parent.forceUpdate()}updateGrayBlocks(){if(this.editor){const e=pxt.shell.isPyLangPref();this.editor.getAllBlocks(!1).forEach((t=>{t.type!==pxtc.TS_STATEMENT_TYPE&&t.type!==pxtc.TS_OUTPUT_TYPE||t.setPythonEnabled(e)}))}}getBlockXml(e,t,i){const n=this;let r;if(!e.attributes.blockBuiltin){if(e.builtinBlock){if("function_return"===e.attributes.blockId)return[pxt.blocks.mkReturnStatementBlock()];const i=u.allBuiltinBlocks()[e.attributes.blockId];if(i&&i.blockXml&&e.builtinField&&2==e.builtinField.length){const t=e.builtinField[0],n=e.builtinField[1],r=new RegExp(`<field name="${t}">(.*)</field>`,"i");i.blockXml=i.blockXml.replace(r,(()=>`<field name="${t}">${n}</field>`))}return i?this.getBlockXml(i,t):void 0}if(e.blockXml)r=Blockly.Xml.textToDom(e.blockXml);else{let t=pxt.blocks.blockSymbol(e.attributes.blockId);if(t){if(!function(e){if(e.attributes.debug&&!pxt.options.debug)return!1;if(!i&&e.attributes.blockHidden)return!1;if(e.attributes.deprecated&&!n.parent.isTutorial())return!1;let t=(e.attributes.blockNamespace||e.namespace).split(".")[0];return n.shouldShowBlock(e.attributes.blockId,t,i)}(t))return;let e=pxt.blocks.compileInfo(t);if(r=pxt.blocks.createToolboxBlock(this.blockInfo,t,e),t.attributes.optionalVariableArgs&&t.attributes.toolboxVariableArgs){const i=e.handlerArgs;t.attributes.toolboxVariableArgs.split(";").map((e=>parseInt(e))).filter((e=>e<=i.length&&e>=0)).forEach((e=>{const t=document.createElement("mutation");t.setAttribute("numargs",e.toString());for(let n=0;n<e;n++)t.setAttribute("arg"+n,i[n].name);r.appendChild(t)}))}else if(e.handlerArgs.length&&!t.attributes.optionalVariableArgs)e.handlerArgs.forEach((e=>{const t=Blockly.Xml.textToDom(`\n    <value name="HANDLER_${e.name}">\n    <shadow type="variables_get_reporter">\n    <field name="VAR" variabletype="">${e.name}</field>\n    </shadow>\n    </value>`);r.appendChild(t)}));else{if(t.attributes.mutateDefaults){const e=t.attributes.mutateDefaults.split(";"),i=[];return e.forEach((e=>{const n=r.cloneNode(!0);pxt.blocks.mutateToolboxBlock(n,t.attributes.mutate,e),i.push(n)})),i}if(null!=t.attributes.blockSetVariable&&t.retType&&!i){const e=t.attributes.blockSetVariable;let i,n=i=!e||pxt.blocks.isReservedWord(e)?b.htmlEscape(t.retType.toLowerCase()):b.htmlEscape(e),s=2;for(;o(n,this.editor);)n=i+s++;i=n;const a=Blockly.Xml.textToDom(`\n<block type="variables_set" gap="${b.htmlEscape((t.attributes.blockGap||8)+"")}">\n<field name="VAR" variabletype="">${i}</field>\n</block>`);{let e=document.createElement("value");e.setAttribute("name","VALUE"),e.appendChild(r),e.appendChild(pxt.blocks.mkFieldBlock("math_number","NUM","0",!0)),a.appendChild(e)}r=a}}}else pxt.log("Couldn't find block for: "+e.attributes.blockId),pxt.log(e)}return r&&(t&&r.setAttribute("gap",`${pxt.appTarget.appTheme&&pxt.appTarget.appTheme.defaultBlockGap&&pxt.appTarget.appTheme.defaultBlockGap.toString()||8}`),pxt.Util.toArray(r.querySelectorAll("shadow")).filter((e=>!e.innerHTML)).forEach(((e,i)=>{let n=e.getAttribute("type");const r=u.allBuiltinBlocks()[n];let o=this.getBlockXml(r||{name:n,attributes:{blockId:n}},t,!0);o&&o.length>0&&o[0]&&(e.innerHTML=o[0].innerHTML)}))),[r]}function o(e,t){const i=t.getVariable(e),n=i&&t.getVariableUsesById(i.getId());return n&&n.some((e=>"variables_set"==e.type||"variables_change"==e.type))}pxt.log("ignoring built in block: "+e.attributes.blockId)}getButtonXml(e){return this.editor.registerButtonCallback(e.attributes.blockId,(t=>{e.callback()})),[pxt.blocks.createFlyoutButton(e.attributes.blockId,e.attributes.label)]}updateBreakpoints(){if(!this.editor)return;const e=!!this.parent.state.debugging;this.editor.getAllBlocks(!1).forEach((t=>{t.previousConnection&&t.enableBreakpoint(e)})),this.editor.setDebugModeOption(e)}}function x(e,t){const i=e.getAllBlocks(!1);for(const e of i)for(const i of e.inputList)for(const e of i.fieldRow)(e instanceof pxtblockly.FieldSpriteEditor||e instanceof pxtblockly.FieldAnimationEditor)&&t(e)}i.Editor=w},{"./blocklyFieldView":21,"./blocksSnippets":23,"./compiler":30,"./core":78,"./createFunction":80,"./debuggerToolbox":86,"./dialogs":88,"./errorList":92,"./extensionManager":93,"./package":122,"./simulator":135,"./snippetBuilder":136,"./toolbox":144,"./toolboxeditor":145,"./workspace":151,react:335,"react-dom":291}],23:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.getToolboxDefinition=i.overrideToolbox=i.overrideCategory=i.clearBuiltinBlockCache=i.allBuiltinBlocks=i.isBuiltin=i.getBuiltinCategory=i.getPauseUntil=void 0;let n,r,o=null;function s(){return o||((o={}).loops={name:lf("{id:category}Loops"),nameid:"loops",blocks:[{name:"controls_repeat_ext",attributes:{blockId:"controls_repeat_ext",weight:49},blockXml:'<block type="controls_repeat_ext">\n                    <value name="TIMES">\n                        <shadow type="math_whole_number">\n                            <field name="NUM">4</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"device_while",attributes:{blockId:"device_while",weight:48},blockXml:'<block type="device_while">\n                    <value name="COND">\n                        <shadow type="logic_boolean">\n                            <field name="BOOL">FALSE</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"pxt_controls_for",attributes:{blockId:"pxt_controls_for",weight:47},blockXml:`<block type="pxt_controls_for">\n                    <value name="VAR">\n                        <shadow type="variables_get_reporter">\n                            <field name="VAR">${lf("{id:var}index")}</field>\n                        </shadow>\n                    </value>\n                    <value name="TO">\n                        <shadow type="math_whole_number">\n                            <field name="NUM">4</field>\n                        </shadow>\n                    </value>\n                </block>`},{name:"pxt_controls_for_of",attributes:{blockId:"pxt_controls_for_of",weight:46},blockXml:`<block type="pxt_controls_for_of">\n                    <value name="VAR">\n                        <shadow type="variables_get_reporter">\n                            <field name="VAR">${lf("{id:var}value")}</field>\n                        </shadow>\n                    </value>\n                    <value name="LIST">\n                        <shadow type="variables_get">\n                            <field name="VAR">list</field>\n                        </shadow>\n                    </value>\n                </block>`}],attributes:{callingConvention:0,icon:"loops",weight:50.09,paramDefl:{}}},pxt.appTarget.runtime&&pxt.appTarget.runtime.breakBlock&&o.loops.blocks.push({name:"pxt_break",attributes:{blockId:"break_keyword",weight:30},blockXml:'<block type="break_keyword"></block>'}),pxt.appTarget.runtime&&pxt.appTarget.runtime.continueBlock&&o.loops.blocks.push({name:"pxt_continue",attributes:{blockId:"continue_keyword",weight:29},blockXml:'<block type="continue_keyword"></block>'}),o.logic={name:lf("{id:category}Logic"),nameid:"logic",groups:[lf("Conditionals"),lf("Comparison"),lf("Boolean"),"other"],blocks:[{name:"controls_if",attributes:{blockId:"controls_if",group:lf("Conditionals"),weight:49},blockXml:'<block type="controls_if" gap="8">\n                    <value name="IF0">\n                        <shadow type="logic_boolean">\n                            <field name="BOOL">TRUE</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"controls_if_else",attributes:{blockId:"controls_if",group:lf("Conditionals"),weight:48},blockXml:'<block type="controls_if" gap="8">\n                    <mutation else="1"></mutation>\n                    <value name="IF0">\n                        <shadow type="logic_boolean">\n                            <field name="BOOL">TRUE</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_compare_eq",attributes:{blockId:"logic_compare",group:lf("Comparison"),weight:47},blockXml:'<block type="logic_compare" gap="8">\n                    <value name="A">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                    <value name="B">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_compare_lt",attributes:{blockId:"logic_compare",group:lf("Comparison"),weight:46},blockXml:'<block type="logic_compare">\n                    <field name="OP">LT</field>\n                    <value name="A">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                    <value name="B">\n                        <shadow type="math_number">\n                            <field name="NUM">0</field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_compare_strings",attributes:{blockId:"logic_compare",group:lf("Comparison"),weight:45},blockXml:'<block type="logic_compare" gap="8">\n                    <value name="A">\n                        <shadow type="text">\n                            <field name="TEXT"></field>\n                        </shadow>\n                    </value>\n                    <value name="B">\n                        <shadow type="text">\n                            <field name="TEXT"></field>\n                        </shadow>\n                    </value>\n                </block>'},{name:"logic_operation_and",attributes:{blockId:"logic_operation",group:lf("Boolean"),weight:44},blockXml:'<block type="logic_operation" gap="8">\n                    <field name="OP">AND</field>\n                </block>'},{name:"logic_operation_or",attributes:{blockId:"logic_operation",group:lf("Boolean"),weight:43},blockXml:'<block type="logic_operation" gap="8">\n                    <field name="OP">OR</field>\n                </block>'},{name:"logic_negate",attributes:{blockId:"logic_negate",group:lf("Boolean"),weight:42},blockXml:'<block type="logic_negate"></block>'},{name:"logic_boolean_true",attributes:{blockId:"logic_boolean",group:lf("Boolean"),weight:41},blockXml:'<block type="logic_boolean" gap="8">\n                    <field name="BOOL">TRUE</field>\n                </block>'},{name:"logic_boolean_false",attributes:{blockId:"logic_boolean",group:lf("Boolean"),weight:40},blockXml:'<block type="logic_boolean">\n                    <field name="BOOL">FALSE</field>\n                </block>'}],attributes:{callingConvention:0,weight:50.08,icon:"logic",paramDefl:{}}},o.variables={name:lf("{id:category}Variables"),nameid:"variables",blocks:void 0,custom:!0,customClick:e=>(e.showVariablesFlyout(),!1),attributes:{weight:50.07,icon:"variables",callingConvention:0,paramDefl:{}}},o.Math={name:lf("{id:category}Math"),nameid:"Math",blocks:[{name:"math_arithmetic_ADD",attributes:{blockId:"math_arithmetic",weight:90},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">ADD</field>\n                    </block>'},{name:"math_arithmetic_MINUS",attributes:{blockId:"math_arithmetic",weight:89},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">MINUS</field>\n                    </block>'},{name:"math_arithmetic_TIMES",attributes:{blockId:"math_arithmetic",weight:88},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">MULTIPLY</field>\n                    </block>'},{name:"math_arithmetic_DIVIDE",attributes:{blockId:"math_arithmetic",weight:87},blockXml:'<block type="math_arithmetic" gap="8">\n                        <value name="A">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="B">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="OP">DIVIDE</field>\n                    </block>'},{name:"math_number",attributes:{blockId:"math_number",weight:86},blockXml:'<block type="math_number" gap="8">\n                        <field name="NUM">0</field>\n                    </block>'},{name:"math_modulo",attributes:{blockId:"math_modulo",weight:85},blockXml:'<block type="math_modulo">\n                        <value name="DIVIDEND">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="DIVISOR">\n                            <shadow type="math_number">\n                                <field name="NUM">1</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"math_op2_min",attributes:{blockId:"math_op2",weight:84},blockXml:'<block type="math_op2" gap="8">\n                        <value name="x">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="y">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="op">min</field>\n                    </block>'},{name:"math_op2_max",attributes:{blockId:"math_op2",weight:83},blockXml:'<block type="math_op2" gap="8">\n                        <value name="x">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="y">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <field name="op">max</field>\n                    </block>'},{name:"math_op3",attributes:{blockId:"math_op3",weight:82},blockXml:'<block type="math_op3">\n                        <value name="x">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"math_js_op",attributes:{blockId:"math_js_op",weight:81},blockXml:'<block type="math_js_op">\n                        <field name="OP">sqrt</field>\n                        <value name="ARG0">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'},{name:"math_js_round",attributes:{blockId:"math_js_round",weight:80},blockXml:'<block type="math_js_round">\n                        <field name="OP">round</field>\n                        <value name="ARG0">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>'}],attributes:{callingConvention:0,weight:50.06,icon:"math",paramDefl:{}}},o.functions={name:lf("{id:category}Functions"),nameid:"functions",blocks:[],custom:!0,customClick:e=>(e.showFunctionsFlyout(),!1),attributes:{advanced:!0,weight:50.08,callingConvention:0,icon:"functions",paramDefl:{}}},o.arrays={name:lf("{id:category}Arrays"),nameid:"arrays",blocks:[{name:"lists_create_with",attributes:{blockId:"lists_create_with",group:"Create",weight:90},blockXml:`<block type="variables_set" gap="8">\n                        <field name="VAR" variabletype="">${lf("{id:var}list")}</field>\n                        <value name="VALUE">\n                            <block type="lists_create_with">\n                                <mutation items="2"></mutation>\n                                <value name="ADD0">\n                                    <shadow type="math_number">\n                                        <field name="NUM">0</field>\n                                    </shadow>\n                                </value>\n                                <value name="ADD1">\n                                    <shadow type="math_number">\n                                        <field name="NUM">1</field>\n                                    </shadow>\n                                </value>\n                            </block>\n                        </value>\n                    </block>`},{name:"lists_create_with",attributes:{blockId:"lists_create_with",group:"Create",weight:89},blockXml:`<block type="variables_set">\n                        <field name="VAR" variabletype="">${lf("{id:var}text list")}</field>\n                        <value name="VALUE">\n                            <block type="lists_create_with">\n                                <mutation items="3"></mutation>\n                                <value name="ADD0">\n                                    <shadow type="text">\n                                        <field name="TEXT">${lf("a")}</field>\n                                    </shadow>\n                                </value>\n                                <value name="ADD1">\n                                    <shadow type="text">\n                                        <field name="TEXT">${lf("b")}</field>\n                                    </shadow>\n                                </value>\n                                <value name="ADD2">\n                                    <shadow type="text">\n                                        <field name="TEXT">${lf("c")}</field>\n                                    </shadow>\n                                </value>\n                            </block>\n                        </value>\n                    </block>`},{name:"lists_create_with",attributes:{blockId:"lists_create_with",group:"Create",weight:5},blockXml:'<block type="lists_create_with">\n                        <mutation items="0"></mutation>\n                    </block>'},{name:"lists_index_get",attributes:{blockId:"lists_index_get",group:"Read",weight:87},blockXml:`<block type="lists_index_get">\n                        <value name="LIST">\n                            <block type="variables_get">\n                                <field name="VAR">${lf("{id:var}list")}</field>\n                            </block>\n                        </value>\n                        <value name="INDEX">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                    </block>`},{name:"lists_index_set",attributes:{blockId:"lists_index_set",group:"Modify",weight:86},blockXml:`<block type="lists_index_set">\n                        <value name="INDEX">\n                            <shadow type="math_number">\n                                <field name="NUM">0</field>\n                            </shadow>\n                        </value>\n                        <value name="LIST">\n                            <block type="variables_get">\n                                <field name="VAR">${lf("{id:var}list")}</field>\n                            </block>\n                        </value>\n                    </block>`},{name:"lists_length",attributes:{blockId:"lists_length",group:"Read",weight:88},blockXml:`<block type="lists_length">\n                        <value name="VALUE">\n                            <block type="variables_get">\n                                <field name="VAR">${lf("{id:var}list")}</field>\n                            </block>\n                        </value>\n                    </block>`}],attributes:{advanced:!0,weight:50.07,icon:"arrays",groups:["Create","Read","Modify","Operations"],callingConvention:0,paramDefl:{}}},o.text={name:lf("{id:category}Text"),nameid:"text",blocks:[{name:"text",attributes:{blockId:"text",weight:90},blockXml:'<block type="text"></block>'},{name:"text_length",attributes:{blockId:"text_length",weight:89},blockXml:`<block type="text_length">\n                        <value name="VALUE">\n                            <shadow type="text">\n                                <field name="TEXT">${lf("Hello")}</field>\n                            </shadow>\n                        </value>\n                    </block>`},{name:"text_join",attributes:{blockId:"text_join",weight:88},blockXml:`<block type="text_join">\n                        <mutation items="2"></mutation>\n                        <value name="ADD0">\n                            <shadow type="text">\n                                <field name="TEXT">${lf("Hello")}</field>\n                            </shadow>\n                        </value>\n                        <value name="ADD1">\n                            <shadow type="text">\n                                <field name="TEXT">${lf("World")}</field>\n                            </shadow>\n                        </value>\n                    </block>`}],attributes:{advanced:!0,weight:50.06,icon:"text",callingConvention:0,paramDefl:{}}},o.addpackage={name:pxt.toolbox.addPackageTitle(),nameid:"addpackage",blocks:[],custom:!0,customClick:e=>(e.closeFlyout(),e.showPackageDialog(),!0),attributes:{advanced:!0,weight:-1,icon:"addpackage",callingConvention:0,paramDefl:{}}}),o}function a(){if(n)return n;const e=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;return e&&(n={name:pxtc.PAUSE_UNTIL_TYPE,attributes:{blockId:pxtc.PAUSE_UNTIL_TYPE,blockNamespace:e.category||"loops",weight:null==e.weight?0:e.weight},blockXml:Blockly.Xml.domToText(pxt.blocks.mkPredicateBlock(pxtc.PAUSE_UNTIL_TYPE))}),n}function l(e){return s()[e]}function c(e,t){const i=l(e);if(t&&i&&(0===Object.keys(t).length&&(i.removed=!0),t.name&&(i.name=t.name),t.icon&&(i.attributes.icon=t.icon),void 0!==t.weight&&(i.attributes.weight=t.weight),void 0!==t.advanced&&(i.attributes.advanced=t.advanced),null!=t.groups&&(i.groups=t.groups),t.blocks)){let e=100;i.blocks=t.blocks.map(((t,i)=>(t.weight?e=t.weight:e--,function(e,t){return{name:e.name,snippet:e.snippet,snippetName:e.snippetName,snippetOnly:e.snippetOnly,pySnippet:e.pySnippet,pySnippetName:e.pySnippetName,attributes:{blockId:e.blockId,weight:t||e.weight,advanced:e.advanced,jsDoc:e.jsDoc,group:e.group},retType:e.retType,blockXml:e.blockXml}}(t,e))))}}function u(e){return{name:e.name,icon:e.attributes.icon,color:e.attributes.color,weight:e.attributes.weight,advanced:e.attributes.advanced,blocks:e.blocks?e.blocks.map((e=>function(e){return{name:e.name,snippet:e.snippet,snippetName:e.snippetName,pySnippet:e.pySnippet,pySnippetName:e.pySnippetName,snippetOnly:e.snippetOnly,retType:e.retType,weight:e.attributes.weight,advanced:e.attributes.advanced,jsDoc:e.attributes.jsDoc,group:e.attributes.group,blockXml:e.blockXml,blockId:e.attributes.blockId}}(e))):[]}}i.getPauseUntil=a,i.getBuiltinCategory=l,i.isBuiltin=function(e){return!!s()[e]},i.allBuiltinBlocks=function(){r||(r={},[l("loops"),l("logic"),l("Math"),l("text"),l("arrays")].forEach((e=>{e.blocks.forEach((e=>{e.attributes.blockId&&!r[e.attributes.blockId]&&(r[e.attributes.blockId]=e)}))}))),r[ts.pxtc.ON_START_TYPE]={name:ts.pxtc.ON_START_TYPE,attributes:{blockId:ts.pxtc.ON_START_TYPE,weight:pxt.appTarget.runtime.onStartWeight||10},blockXml:'<block type="pxt-on-start"></block>'};const e=a();return e&&(r[pxtc.PAUSE_UNTIL_TYPE]=e),r},i.clearBuiltinBlockCache=function(){r=void 0},i.overrideCategory=c,i.overrideToolbox=function(e){c("loops",e.loops),c("logic",e.logic),c("variables",e.variables),c("Math",e.maths),c("text",e.text),c("arrays",e.arrays),c("functions",e.functions)},i.getToolboxDefinition=function(){return{loops:u(l("loops")),logic:u(l("logic")),variables:u(l("variables")),maths:u(l("Math")),text:u(l("text")),arrays:u(l("arrays")),functions:u(l("functions"))}}},{}],24:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.provider=i.copyProjectToLegacyEditor=void 0;const n=e("./db"),r=e("./workspace");let o,s;async function a(e){const t=o.getAsync(e.id),i=s.getAsync(e.id);let[n,r]=await Promise.all([t,i]);if(n&&r)return{header:n,text:r.files,version:r._rev}}function l(e,t,i){return c(o,s,e,t,i)}function c(e,t,i,n,r){let o="";return(r?t.setAsync({id:i.id,files:r,_rev:n}).then((e=>{o=e})):Promise.resolve()).then((()=>e.setAsync(i))).then((e=>(i._rev=e,o)))}i.copyProjectToLegacyEditor=function(e,t){const i=pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[t],r=new n.Table(i?`${i}-header`:"header"),o=new n.Table(i?`${i}-text`:"text"),s=pxt.Util.clone(e);return delete s._id,delete s._rev,s.id=pxt.Util.guidGen(),a(e).then((e=>c(r,o,s,void 0,e.text))).then((e=>s))},i.provider={getAsync:a,setAsync:l,deleteAsync:function(e,t){return o.deleteAsync(e).then((()=>s.deleteAsync({id:e.id,_rev:e._rev})))},listAsync:async function(){return await function(){const e=pxt.semver.parse(pxt.appTarget.versions.target).major,t=pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[e];return t?(o=new n.Table(`${t}-header`),s=new n.Table(`${t}-text`),o.getAllAsync().then((t=>{if(t.length)return Promise.resolve();const i=e-1,r=i<0?"":pxt.appTarget.appTheme.browserDbPrefixes&&pxt.appTarget.appTheme.browserDbPrefixes[i];let o=new n.Table("header"),s=new n.Table("text");return r&&(o=new n.Table(`${r}-header`),s=new n.Table(`${r}-text`)),o.getAllAsync().then((e=>pxt.Util.promiseMapAll(e,(e=>(e=>s.getAsync(e.id).then((t=>(delete e._id,delete e._rev,l(e,void 0,t.files)))))(e))))).then((()=>{}))}))):(o=new n.Table("header"),s=new n.Table("text"),Promise.resolve())}(),await async function(){const e=new pxt.skillmap.IndexedDBWorkspace;await e.initAsync();const t=await e.getAllProjectsAsync();for(const i of t)i.header.isSkillmapProject=!0,await r.installAsync(i.header,i.text,!0),await e.deleteProjectAsync(i.header.id)}(),o.getAllAsync()},resetAsync:function(){return Promise.resolve()},loadedAsync:function(){var e,t;return null===(t=(e=pxt.commands).workspaceLoadedAsync)||void 0===t?void 0:t.call(e)}}},{"./db":82,"./workspace":151}],25:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Carousel=void 0;const n=e("react"),r=e("./sui"),o=e("./data"),s=e("./util"),a=300;var l,c;(c=l||(l={}))[c.None=0]="None",c[c.X=1]="X",c[c.Y=2]="Y";class u extends o.Component{constructor(e){super(e),this.arrows=[],this.isDragging=!1,this.definitelyDragging=l.None,this.currentOffset=0,this.index=0,this.childrenElements=[],this.handleContainerRef=e=>{this.container=e},this.handleDragSurfaceRef=e=>{this.dragSurface=e},this.handleArrowRefs=e=>{this.arrows.push(e)},this.handleChildRefs=e=>{e&&this.childrenElements.push(e)},this.updateDimensions=()=>{if(this.container){let e=!1;if(this.containerWidth=this.container.getBoundingClientRect().width,this.getArrowWidth(),this.childrenElements.length){const t=this.childrenElements[0].getBoundingClientRect().width;t!==this.childWidth&&(this.childWidth=t,e=!0),this.actualPageLength=Math.floor(this.containerWidth/this.childWidth)}this.dragSurface.style.width=this.totalLength()+"px",this.updateArrows(),this.index>=this.maxIndex()&&(e=!0,this.index=this.maxIndex()),e&&this.setPosition(this.indexToOffset(this.index))}},this.state={},this.childrenElements=[],this.arrows=[],this.onLeftArrowClick=this.onLeftArrowClick.bind(this),this.onRightArrowClick=this.onRightArrowClick.bind(this)}UNSAFE_componentWillReceiveProps(e){null!=e.selectedIndex&&this.setIndex(e.selectedIndex)}renderCore(){const{rightDisabled:e,leftDisabled:t}=this.state,i=pxt.Util.isUserLanguageRtl();return n.createElement("div",{className:"ui carouselouter"},!t&&n.createElement("span",{role:"button",className:"carouselarrow left aligned",tabIndex:0,title:lf("See previous"),"aria-label":lf("See previous"),onClick:this.onLeftArrowClick,onKeyDown:s.fireClickOnEnter,ref:this.handleArrowRefs},n.createElement(r.Icon,{icon:"circle angle "+(i?"right":"left")})),n.createElement("div",{className:"carouselcontainer",ref:this.handleContainerRef},n.createElement("div",{className:"carouselbody",ref:this.handleDragSurfaceRef},n.Children.map(this.props.children,((e,t)=>e?n.createElement("div",{className:"carouselitem "+(this.props.selectedIndex==t?"selected":""),ref:this.handleChildRefs},n.cloneElement(e,{tabIndex:this.isVisible(t)?0:-1})):void 0)))),!e&&n.createElement("span",{role:"button",className:"carouselarrow right aligned",tabIndex:0,title:lf("See more"),"aria-label":lf("See more"),onClick:this.onRightArrowClick,onKeyDown:s.fireClickOnEnter,ref:this.handleArrowRefs},n.createElement(r.Icon,{icon:"circle angle "+(pxt.Util.isUserLanguageRtl()?"left":"right")})))}onLeftArrowClick(){this.onArrowClick(!0)}onRightArrowClick(){this.onArrowClick(!1)}onArrowClick(e){const t=this.index,i=this.container.scrollLeft;this.setIndex(e?this.index-this.actualPageLength:this.index+this.actualPageLength);const{tickId:n}=this.props;if(n&&pxt.tickEvent("carousel.arrow.click",{tickId:n,index:this.index,left:e?-1:1},{interactiveConsent:!0}),e){const e=this.index+this.actualPageLength<t?this.index+this.actualPageLength:t-1;this.childrenElements[e]&&this.childrenElements[e].firstChild.focus()}else{const e=this.index>t+this.actualPageLength?this.index:t+this.actualPageLength;this.childrenElements[e]&&this.childrenElements[e].firstChild.focus()}this.container.scrollLeft=i}componentDidMount(){this.initDragSurface(),this.updateDimensions(),window.addEventListener("resize",this.updateDimensions)}componentWillUnmount(){window.removeEventListener("resize",this.updateDimensions)}componentDidUpdate(){this.updateDimensions()}initDragSurface(){let e=e=>{this.definitelyDragging=l.None,this.dragStart(p(e),h(e))},t=e=>{this.isDragging&&(this.dragEnd(),this.definitelyDragging&&(e.preventDefault(),e.stopPropagation()))},i=e=>{this.isDragging&&this.dragEnd()},n=e=>{if(this.isDragging){let t=p(e);if(!this.definitelyDragging){let i=h(e);Math.abs(t-this.dragStartX)>5?this.definitelyDragging=l.X:Math.abs(i-this.dragStartY)>5&&(this.definitelyDragging=l.Y)}this.definitelyDragging==l.X&&(e.stopPropagation(),e.preventDefault(),window.requestAnimationFrame((()=>{this.dragMove(t)})))}};this.dragSurface.addEventListener("click",(e=>{this.definitelyDragging&&(e.stopPropagation(),e.preventDefault())})),window.PointerEvent?(this.dragSurface.addEventListener("pointerdown",e),this.dragSurface.addEventListener("pointerup",t),this.dragSurface.addEventListener("pointerleave",i),this.dragSurface.addEventListener("pointermove",n)):(this.dragSurface.addEventListener("mousedown",e),this.dragSurface.addEventListener("mouseup",t),this.dragSurface.addEventListener("mouseleave",i),this.dragSurface.addEventListener("mousemove",n),pxt.BrowserUtils.isTouchEnabled()&&(this.dragSurface.addEventListener("touchstart",e),this.dragSurface.addEventListener("touchend",t),this.dragSurface.addEventListener("touchcancel",i),this.dragSurface.addEventListener("touchmove",n)))}dragStart(e,t){this.isDragging=!0,this.dragStartX=e,this.dragStartY=t,this.dragStartOffset=this.currentOffset,this.animationId&&(window.cancelAnimationFrame(this.animationId),this.animationId=0)}dragEnd(){this.isDragging=!1,this.calculateIndex()}dragMove(e){this.dragOffset=e-this.dragStartX;const t=pxt.Util.isUserLanguageRtl()?this.dragStartOffset+this.dragOffset:this.dragStartOffset-this.dragOffset;this.setPosition(t)}setPosition(e){this.dragSurface&&(e=Math.min(Math.max(e,-300),this.maxScrollOffset()),this.currentOffset=e,pxt.Util.isUserLanguageRtl()?this.dragSurface.style.marginRight=-e+"px":this.dragSurface.style.marginLeft=-e+"px")}calculateIndex(){if(this.dragSurface){const e=Math.round(Math.max(this.currentOffset,0)/this.childWidth);let t;t=this.currentOffset>this.dragStartOffset?e:e-1,this.setIndex(t,200)}}setIndex(e,t){const i=Math.max(Math.min(e,this.maxIndex()),0);t||(t=100*Math.abs(i-this.index)),this.index=i,this.updateArrows(),this.animation=new d(this.currentOffset,this.indexToOffset(this.index),t),this.animationId||(this.animationId=window.requestAnimationFrame(this.easeTowardsIndex.bind(this)))}isVisible(e){return e>=this.index&&e<this.index+(this.actualPageLength||4)}easeTowardsIndex(e){this.dragSurface&&(this.setPosition(this.animation.getPosition(e)),this.animation.isComplete?(this.animation=void 0,this.animationId=0):this.animationId=window.requestAnimationFrame(this.easeTowardsIndex.bind(this)))}indexToOffset(e){return e<=0?0:e===this.maxIndex()?this.totalLength()-this.containerWidth-a+2*this.arrowWidth:e*this.childWidth-this.childWidth*this.props.bleedPercent/100}totalLength(){return n.Children.count(this.props.children)*this.childWidth+a}getArrowWidth(){this.arrows.length&&(this.arrowWidth=0,this.arrows.forEach((e=>{e&&(this.arrowWidth=Math.max(e.getBoundingClientRect().width,this.arrowWidth))})))}maxScrollOffset(){return Math.max(this.totalLength()-this.actualPageLength*this.childWidth+a,0)}maxIndex(){return Math.max(this.childrenElements.length-this.actualPageLength,0)}updateArrows(){const{rightDisabled:e,leftDisabled:t}=this.state||{},i=this.index===this.maxIndex(),n=0===this.index;i===e&&n===t||this.setState({leftDisabled:n,rightDisabled:i})}}i.Carousel=u;class d{constructor(e,t,i){this.start=e,this.end=t,this.millis=i,this.isComplete=!1,this.slope=(t-e)/i}getPosition(e){if(this.isComplete)return this.end;if(void 0===this.startTime)return this.startTime=e,this.start;const t=e-this.startTime;return t>this.millis?(this.isComplete=!0,this.end):this.start+Math.floor(this.slope*t)}}function p(e){return"screenX"in e?e.screenX:e.changedTouches[0].screenX}function h(e){return"screenY"in e?e.screenY:e.changedTouches[0].screenY}},{"./data":81,"./sui":143,"./util":149,react:335}],26:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.init=i.HEADER_CLOUDSTATE=i.requestProjectCloudStatus=i.saveLocalProjectsToCloudAsync=i.convertCloudToLocal=i.forceReloadForCloudSync=i.syncAsync=i.getCloudTempMetadata=i.CloudTempMetadata=i.excludeCloudMetadataFields=i.excludeLocalOnlyMetadataFields=void 0;const n=e("./core"),r=e("./auth"),o=e("./data"),s=e("./workspace"),a=e("./app");var l=pxt.Util;const c=["_rev","_id","cloudVersion","cloudCurrent","cloudLastSyncTime"],u=["cloudVersion","cloudCurrent","cloudLastSyncTime","cloudUserId"];function d(e,t){const i=Object.assign({},e);for(let e of t)delete i[e];return i}function p(e){return d(e,c)}function h(e){return d(e,u)}function f(e){return new Promise((async(t,i)=>{var n;const o=b(e.id);try{pxt.debug(`downloading from cloud: '${N(e)}`),o.syncInProgress();const s=await r.apiAsync(`/api/user/project/${e.id}`);if(s.success){const e=null===(n=r.userProfile())||void 0===n?void 0:n.id,i=s.resp,o={header:p(JSON.parse(i.header)),text:JSON.parse(i.text),version:i.version};o.header.cloudCurrent=!0,o.header.cloudVersion=o.version,o.header.cloudUserId=e,o.header.cloudLastSyncTime=l.nowSeconds(),pxt.tickEvent("identity.cloudApi.getProject.success"),t(o)}else pxt.tickEvent("identity.cloudApi.getProject.failed"),i(s.err)}finally{o.syncFinished()}}))}i.excludeLocalOnlyMetadataFields=p,i.excludeCloudMetadataFields=h;class m{constructor(e){this.headerId=e}get justSynced(){return this._justSynced}syncInProgress(){this._syncStartTime=l.nowSeconds(),o.invalidate(`${i.HEADER_CLOUDSTATE}:${this.headerId}`)}syncFinished(){this._syncStartTime=0,this._justSynced=!0,o.invalidate(`${i.HEADER_CLOUDSTATE}:${this.headerId}`),setTimeout((()=>{0===this._syncStartTime&&(this._justSynced=!1,o.invalidate(`${i.HEADER_CLOUDSTATE}:${this.headerId}`))}),1500)}cloudStatus(){const e=s.getHeader(this.headerId);if(e&&e.cloudUserId)return r.loggedIn()?this._syncStartTime>0?pxt.cloud.cloudStatus.syncing:e.cloudCurrent?this.justSynced?pxt.cloud.cloudStatus.justSynced:e.cloudLastSyncTime>0?pxt.cloud.cloudStatus.synced:void pxt.reportError("cloudsave",`Invalid project cloud state for project ${N(e)}: user: ${e.cloudUserId}, inProg: ${this._syncStartTime}, cloudCurr: ${e.cloudCurrent}, lastCloud: ${e.cloudLastSyncTime}`):pxt.cloud.cloudStatus.localEdits:pxt.cloud.cloudStatus.offline}}i.CloudTempMetadata=m;const g={};function b(e){return g[e]||(g[e]=new m(e)),g[e]}let v;async function y(e){return r.hasIdentity()&&r.loggedIn()?(e=null!=e?e:{},v||(v=async function(e){try{const t=!e.hdrs;t&&(e.hdrs=E()),pxt.debug(`Synchronizing ${e.hdrs.length} local project(s) with the cloud...`);const i=E(e.hdrs),n=l.nowSeconds();pxt.tickEvent("identity.sync.start");const a=e=>n-e+" seconds ago";let c=await async function(){return new Promise((async(e,t)=>{var i;const n=await r.apiAsync("/api/user/project");if(n.success){const t=l.nowSeconds(),o=null===(i=r.userProfile())||void 0===i?void 0:i.id,s=n.resp.map((e=>{const i=p(JSON.parse(e.header));return i.cloudUserId=o,i.cloudCurrent=!0,i.cloudLastSyncTime=t,i.cloudVersion=e.version,i}));pxt.tickEvent("identity.cloudApi.list.success",{count:s.length}),e(s)}else pxt.tickEvent("identity.cloudApi.list.failed"),t(n.err)}))}();t||(c=c.filter((e=>i.some((t=>t.id===e.id)))));const u=c.length-i.length;0!==u&&pxt.debug(`${Math.abs(u)} ${u>0?"more":"fewer"} projects found in the cloud.`);const d=c.length?Math.max(...c.map((e=>e.modificationTime))):n;pxt.debug(`Last cloud project change was ${a(d)}`);const h=l.toDictionary(c,(e=>e.id)),f={},m=k,g=async(e,t)=>{const i=await w(e,t);if(i)return f[i.id]=i,i};let b=[];const v=10;e.direction&&"up"!==e.direction||await l.promisePoolAsync(v,i,(async function(e){const t=N(e);try{if(!e.cloudCurrent)if(e.isDeleted){if("succeeded"!==(await m(e,null)).status)throw new Error(`Failed to save deleted ${t} to the cloud.`)}else{const i=h[e.id];if(i){const n=await m(e,e.cloudVersion);if("conflict"===n.status)await x(e,i);else if("succeeded"!==n.status)throw new Error(`Failed to save ${t} to the cloud.`)}else if("succeeded"!==(await m(e,null)).status)throw pxt.tickEvent("identity.sync.failed.localNewProjectSyncUpFailed"),new Error(`Failed to save new ${t} to the cloud.`)}}catch(e){b.push(e)}})),e.direction&&"down"!==e.direction||await l.promisePoolAsync(v,c,(async function(e){const t=N(e);try{const i=s.getHeader(e.id);if(i){if(i.cloudVersion!==e.cloudVersion)if(i.cloudCurrent){if(!await g(i,e))throw new Error(`Failed to download cloud project ${t}`)}else await x(i,e)}else if(!e.isDeleted&&!await g(i,e))throw new Error(`Failed to import new cloud project ${t}`)}catch(e){b.push(e)}})),b.forEach((e=>pxt.debug(e))),b=[];const y=l.nowSeconds()-n;return pxt.tickEvent("identity.sync.finished",{elapsed:y}),o.invalidate("headers:"),l.values(f)}catch(e){pxt.reportException(e),pxt.tickEvent("identity.sync.failed",{exception:e})}return[]}(e).then((e=>e)).finally((()=>{v=void 0}))),v):[]}async function k(e,t){const i=await s.getTextAsync(e.id);s.acquireHeaderSession(e);const n=await function(e,t,i){return new Promise((async(n,o)=>{var s;const a=b(e.id);try{pxt.debug(`uploading to cloud: ${N(e)}`);const c=null===(s=r.userProfile())||void 0===s?void 0:s.id;e.cloudUserId=c,e.cloudCurrent=!1,e.cloudVersion=t,a.syncInProgress();const u={id:e.id,header:JSON.stringify(p(e)),text:i?JSON.stringify(i):void 0,version:t},d=await r.apiAsync("/api/user/project",u);d.success?(e.cloudCurrent=!0,e.cloudVersion=d.resp,e.cloudLastSyncTime=l.nowSeconds(),pxt.tickEvent("identity.cloudApi.setProject.success"),n({header:e,status:"succeeded"})):409===d.statusCode?(pxt.tickEvent("identity.cloudApi.setProject.conflict"),n({header:e,status:"conflict"})):(pxt.tickEvent("identity.cloudApi.setProject.failed"),o(d.err))}finally{a.syncFinished()}}))}(e,t,i);return"succeeded"===n.status?(await s.saveAsync(e,null,!0),n.header=s.getHeader(e.id)):pxt.tickEvent("identity.toCloud.failed"),n}async function w(e,t){if(e){const i=Object.assign(Object.assign({},e),t);s.acquireHeaderSession(e);const n=await f(e);return await s.saveAsync(i,n.text,!0),s.getHeader(i.id)}if(t){const e=Object.assign({},t);s.acquireHeaderSession(t);const i=await f(t);return await s.importAsync(e,i.text,!0),s.getHeader(e.id)}pxt.tickEvent("identity.fromCloud.failed")}async function x(e,t){var i;pxt.debug(`cloud conflict detected for ${N(e)}`);const r=function(e){return e.name+lf(" - Copy")}(e);let o=await s.duplicateAsync(e,r);pxt.tickEvent("identity.sync.conflict.createdDuplicate");let l=!1;try{if(a.hasEditor()){const t=await a.getEditorAsync();t.state.home||(null===(i=t.state.header)||void 0===i?void 0:i.id)!==e.id||await t.loadHeaderAsync(o,t.state.editorState,!1)}}catch(e){pxt.reportException(e),pxt.tickEvent("identity.sync.conflict.reloadEditorFailed",{exception:e}),l=!0}try{e=await w(e,t)}catch(e){throw pxt.reportException(e),pxt.tickEvent("identity.sync.conflict.overwriteLocalFailed",{exception:e}),pxt.tickEvent("identity.sync.conflict.failed"),e}try{n.dialogAsync({header:lf("Project '{0}' had a conflict!",e.name),body:lf("Project '{0}' was edited in two places and the changes conflict. The changes on this computer have been saved to '{1}'. The changes made elsewhere remain in '{2}'.",e.name,o.name,e.name),disagreeLbl:lf("Got it!"),disagreeClass:"green",hasCloseIcon:!1})}catch(e){pxt.reportException(e),l=!0}l?pxt.tickEvent("identity.sync.conflict.failed"):pxt.tickEvent("identity.sync.conflict.success")}function E(e){var t;const i=null===(t=r.userProfile())||void 0===t?void 0:t.id;return(e||s.getHeaders(!0,!1)).filter((e=>e.cloudUserId&&e.cloudUserId===i))}i.getCloudTempMetadata=b,i.syncAsync=y,i.forceReloadForCloudSync=function(){n.infoNotification(lf("Cloud synchronization finished. Reloading... ")),setTimeout((()=>{pxt.debug("cloud forcing reload."),pxt.tickEvent("identity.sync.forcingReload"),location.reload()}),3e3)},i.convertCloudToLocal=async function(e){if(e){const t=s.getHeaders(!1,!1).filter((t=>t.cloudUserId&&t.cloudUserId===e)),i=[];t.forEach((e=>{e=h(e),i.push(s.forceSaveAsync(e,null,!0))})),await Promise.all(i)}},i.saveLocalProjectsToCloudAsync=async function(e){const t=s.getHeaders().filter((e=>null==e.cloudUserId)).filter((t=>e.includes(t.id)));if(t.length){const e={},i=[];for(const n of t){const t=await s.duplicateAsync(n,n.name);e[n.id]=t.id,i.push(t)}return await y({hdrs:i,direction:"up"}),e}},i.requestProjectCloudStatus=async function(e){for(const t of e){const e=b(t),i=e.cloudStatus(),n={type:"pxteditor",action:"projectcloudstatus",headerId:e.headerId,status:i.value};pxt.editor.postHostMessageAsync(n)}};let C={},S=0,_=0;const T={subscriptions:[],onDataChanged:e=>{const t=e.split("header:");l.assert(2===t.length,"onHeaderChangeSubscriber has invalid path subscription: "+e);const i=t[1];if("*"===i)E().forEach((e=>A(e)));else{const e=s.getHeader(i);e?A(e):pxt.debug("cannot find header with id: "+i)}}};async function A(e){var t;if(!r.hasIdentity())return;if(!r.loggedIn())return;if(e.cloudUserId!==(null===(t=r.userProfile())||void 0===t?void 0:t.id)||e.cloudCurrent)return;if(s.isHeaderSessionOutdated(e))return;C[e.id]=!0,clearTimeout(S);const i=async()=>{_=0,await async function(){try{await v}catch(e){v=void 0}const e=E().filter((e=>C[e.id]));C={},y({hdrs:e,direction:"up"})}()};_||(_=l.now()),15e3<l.now()-_?await i():S=setTimeout(i,3e3)}function N(e){return`'${e.name}' (${e.id.substr(0,5)}...)`}function I(e){return"*"==(e=o.stripProtocol(e))?s.getHeaders().map((e=>b(e.id))):b(e)}i.HEADER_CLOUDSTATE="header-cloudstate",i.init=function(){o.mountVirtualApi(i.HEADER_CLOUDSTATE,{getSync:I}),o.subscribe(T,"header:*")}},{"./app":16,"./auth":20,"./core":78,"./data":81,"./workspace":151}],27:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.loginCheck=i.syncAsync=i.refreshToken=i.resetAsync=i.ensureGitHubTokenAsync=i.githubProvider=i.reconstructMeta=i.ProviderBase=i.setOauth=i.OAUTH_REMEMBER_STATE=i.OAUTH_HASH=i.OAUTH_REDIRECT=i.OAUTH_STATE=i.OAUTH_TYPE=void 0;const n=e("./core"),r=e("./data");var o=pxt.Util;const s=o.lf;let a,l;function c(e){const t=new Error(e);return t.isUserError=!0,t.isSyncError=!0,t}i.OAUTH_TYPE="oauthType",i.OAUTH_STATE="oauthState",i.OAUTH_REDIRECT="oauthRedirect",i.OAUTH_HASH="oauthHash",i.OAUTH_REMEMBER_STATE="oauthRememberState";const u="token",d="tokenExp",p="AutoLogin",h="cloudUser";function f(e,t,n,r){const o=ts.pxtc.Util.guidGen();return pxt.storage.setLocal(i.OAUTH_TYPE,e),pxt.storage.setLocal(i.OAUTH_STATE,o),pxt.storage.setLocal(i.OAUTH_REDIRECT,n||window.location.hash),pxt.storage.setLocal(i.OAUTH_HASH,r),t?pxt.storage.setLocal(i.OAUTH_REMEMBER_STATE,o):pxt.storage.removeLocal(i.OAUTH_REMEMBER_STATE),o}function m(){pxt.storage.removeLocal(i.OAUTH_TYPE),pxt.storage.removeLocal(i.OAUTH_STATE),pxt.storage.removeLocal(i.OAUTH_REDIRECT),pxt.storage.removeLocal(i.OAUTH_HASH),pxt.storage.removeLocal(i.OAUTH_REMEMBER_STATE)}i.setOauth=f;i.ProviderBase=class{constructor(e,t,i,n){this.name=e,this.friendlyName=t,this.icon=i,this.urlRoot=n,this._token=pxt.storage.getLocal(this.name+u)}syncError(e){throw c(e)}user(){return pxt.Util.jsonTryParse(pxt.storage.getLocal(this.name+h))}setUser(e){e?pxt.storage.setLocal(this.name+h,JSON.stringify(e)):pxt.storage.removeLocal(this.name+h),r.invalidate("sync:user"),r.invalidate("github:user")}token(){if(!this.hasTokenExpired())return this._token}reqAsync(e){const t=this.token();if(!t)throw this.pleaseLogin();return e.headers||(e.headers={}),e.headers.Authorization="Bearer "+t,/^https:\/\//.test(e.url)||(e.url=this.urlRoot+e.url),e.allowHttpErrors=!0,o.requestAsync(e)}getJsonAsync(e){return this.reqAsync({url:e}).then((t=>{if(t.statusCode<300)return t.json;throw this.syncError(s("Invalid {0} response {1} at {2}",this.friendlyName,t.statusCode,e))}))}fileSuffix(){return".mkcd-"+pxt.appTarget.id}createFileNameWithSuffix(e){return e.replace(/[~"#%&*:<>?/\\{|}]+/g,"_")+this.fileSuffix()}parseTime(e){return Math.round(new Date(e).getTime()/1e3)}pleaseLogin(){let e=s("Please log in to {0}",this.friendlyName);n.infoNotification(e);let t=c(e);return t.isLoginError=!0,t}loginCheck(){if(this.token())if(this.hasTokenExpired()){if(pxt.storage.getLocal(this.name+p))return void this.pleaseLogin();pxt.storage.setLocal(this.name+p,"yes"),this.loginAsync(void 0,!0).then((e=>e&&this.setNewToken(e.accessToken,e.rememberMe,e.expiresIn)))}else(e=this)!==l&&(l=e,y());var e}loginAsync(e,t){return o.userError("Not implemented"),Promise.resolve(void 0)}loginInner(){const e=this.name;n.showLoading(e+"login",s("Signing you in to {0}...",this.friendlyName));const t=f(e,!1),i=pxt.appTarget.cloud&&pxt.appTarget.cloud.cloudProviders&&pxt.appTarget.cloud.cloudProviders[this.name],r=window.location.protocol+"//"+window.location.host+"/oauth-redirect",o={client_id:i.client_id,response_type:"token",state:t,redirect_uri:r,scope:"",expires_in:86400};return i.redirect&&(o.redirect=i.redirect),o}loginCompleteInner(){const e=this.name;n.hideLoading(e+"login")}loginCallback(e,t){const i=this.name;pxt.storage.removeLocal(i+p),this.setNewToken(t.access_token,e,parseInt(t.expires_in)),this.setUser(void 0)}setNewToken(e,t,i){const n=this.name,r=n+u,o=n+d;if(this._token=e,!t)return pxt.debug("token storage non-opted in"),pxt.storage.removeLocal(r),void pxt.storage.removeLocal(o);if(e)if(pxt.storage.setLocal(r,e),i){let e=Math.round(Date.now()/1e3+.75*i);pxt.storage.setLocal(o,e+"")}else pxt.storage.removeLocal(o);else pxt.storage.removeLocal(r),pxt.storage.removeLocal(o);y()}hasTokenExpired(){const e=parseInt(pxt.storage.getLocal(this.name+d)||"0");return!(!e||e<o.nowSeconds())}logout(){pxt.storage.removeLocal(this.name+u),pxt.storage.removeLocal(this.name+d),pxt.storage.removeLocal(this.name+p),this._token=void 0,this.setUser(void 0),y()}},i.reconstructMeta=function(e){let t=JSON.parse(e[pxt.CONFIG_NAME]),i={meta:{cloudId:pxt.CLOUD_ID+pxt.appTarget.id,editor:pxt.BLOCKS_PROJECT_NAME,name:t.name},source:JSON.stringify(e)},n=JSON.parse(e[".cloudheader.json"]||"{}");return n&&(n.editor&&(i.meta.editor=n.editor),n.target&&(i.meta.cloudId=pxt.CLOUD_ID+n.target),n.targetVersion&&(i.meta.targetVersions={target:n.targetVersion})),i};const g=e("./githubprovider");function b(){if(!a){a={};const e=pxt.appTarget.cloud;if(e&&e.githubPackages){const e=new g.GithubProvider;a[e.name]=e}}return pxt.Util.values(a)}function v(e){const t=b().filter((e=>e.name==g.PROVIDER_NAME))[0];return!t&&e&&o.userError(s("GitHub not configured in this editor.")),t}function y(){r.invalidate("sync:status"),r.invalidate("sync:user"),r.invalidate("sync:loggedin"),r.invalidate("sync:provider"),r.invalidate("sync:providericon"),r.invalidate("github:user")}i.githubProvider=v,i.ensureGitHubTokenAsync=async function(){await v(!0).loginAsync(),pxt.github.token||o.userError(s("Please sign in to GitHub to perform this operation."))},i.resetAsync=function(){const e=v(),t=e&&e.hasToken();return l&&l.logout(),l=null,pxt.storage.removeLocal("cloudId"),m(),y(),t&&e.logout(),Promise.resolve()},i.refreshToken=function(){l&&l.loginAsync(void 0,!0)},i.syncAsync=function(){return function(){const e=v();return e?function(e){return e?e.user()?Promise.resolve():e.getUserInfoAsync().then((t=>t?(t.initials||(t.initials=o.initials(t.name)),e.setUser(t),null):Promise.resolve())):Promise.resolve()}(e):Promise.resolve()}().then((()=>{}))},i.loginCheck=function(){const e=b();if(e.length){{const t=o.parseQueryString(pxt.storage.getLocal(i.OAUTH_HASH)||"");if(t.access_token){const n=pxt.storage.getLocal(i.OAUTH_TYPE),r=e.filter((e=>e.name==n))[0];if(r){pxt.storage.removeLocal(i.OAUTH_HASH);const e=t.state===pxt.storage.getLocal(i.OAUTH_REMEMBER_STATE);r.loginCallback(e,t)}m()}}{const t=o.parseQueryString((location.hash||"#").slice(1).replace(/%23access_token/,"access_token"));if(t.access_token){const n=pxt.storage.getLocal(i.OAUTH_STATE),r=pxt.storage.getLocal(i.OAUTH_TYPE);if(n&&n==t.state){pxt.storage.removeLocal(i.OAUTH_STATE),pxt.storage.removeLocal(i.OAUTH_TYPE);const n=t.state===pxt.storage.getLocal(i.OAUTH_REMEMBER_STATE),o=e.filter((e=>e.name==r))[0];if(o){o.loginCallback(n,t);const e=pxt.storage.getLocal(i.OAUTH_REDIRECT)||"";location.hash=e}}m()}}for(const t of e)t.loginCheck()}},r.mountVirtualApi("sync",{getSync:function(e){const t=l;switch(r.stripProtocol(e)){case"user":return t&&t.user();case"loggedin":return!!t;case"status":return"";case"provider":return t&&t.name;case"providericon":return t?t.icon:"user"}return null}}),r.mountVirtualApi("github",{getSync:function(e){const t=v();switch(r.stripProtocol(e)){case"user":return t&&t.user()}return null}}),r.mountVirtualApi("ping",{getAsync:function(e){const t=r.stripProtocol(e);if(/\.ico$/.test(e)){const e=pxt.BrowserUtils.isEdge()?t:`${t}?v=${Math.random()}&origin=${encodeURIComponent(window.location.origin)}`,i=document.createElement("img");return new Promise(((t,n)=>{i.onload=()=>t(!0),i.onerror=()=>t(!1),i.src=e}))}return pxt.Util.requestAsync({url:t,method:"GET",allowHttpErrors:!0}).then((e=>200===e.statusCode||403==e.statusCode||400==e.statusCode)).catch((e=>!1))},expirationTime:e=>864e5,isOffline:()=>!pxt.Cloud.isOnline()})},{"./core":78,"./data":81,"./githubprovider":98}],28:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.showUnsupportedHardwareMessageAsync=i.handleServiceWorkerMessageAsync=i.disconnectAsync=i.showDisconnectAsync=i.pairAsync=i.maybeReconnectAsync=i.initAsync=i.setExtensionResult=i.hidDeployCoreAsync=i.nativeHostLongpressAsync=i.nativeHostBackAsync=i.isNativeHost=i.nativeHostPostMessageFunction=i.browserDownloadDeployCoreAsync=void 0;const n=e("./core"),r=e("./electron"),o=e("./package"),s=e("./hidbridge"),a=e("./webusb"),l=e("./data"),c=e("./dialogs");var u=pxt.Cloud;const d=e("./dialogs");function p(e){pxt.debug(`cmds: ${e}`)}let h;function f(e,t,i){return pxt.BrowserUtils.browserDownloadBinText(e,t,{contentType:i,onError:e=>n.errorNotification(lf("saving file failed..."))}),Promise.resolve()}function m(e){let t="";const i=pxt.outputName().replace(/[^.]*/,""),r=e.outfiles[pxt.outputName()],s=o.genFileName(i),a=pxt.BrowserUtils.isBrowserDownloadWithinUserContext();return a?t=pxt.BrowserUtils.toDownloadDataUri(pxt.isOutputText()?ts.pxtc.encodeBase64(r):r,pxt.appTarget.compile.hexMimeType):pxt.isOutputText()?(p("saving "+s),t=pxt.BrowserUtils.browserDownloadBinText(r,s,{contentType:pxt.appTarget.compile.hexMimeType,userContextWindow:e.userContextWindow,onError:e=>n.errorNotification(lf("saving file failed...")),maintainObjectURL:!0})):(p("saving "+s),t=pxt.BrowserUtils.browserDownloadBase64(r,s,{contentType:"application/x-uf2",userContextWindow:e.userContextWindow,onError:e=>n.errorNotification(lf("saving file failed...")),maintainObjectURL:!0})),e.success?!a&&pxt.BrowserUtils.isBrowserDownloadInSameWindow()||!e.saveOnly&&d.isDontShowDownloadDialogFlagSet()?Promise.resolve().then((()=>{var e;return null===(e=window.URL)||void 0===e?void 0:e.revokeObjectURL(t)})):pxt.commands.showUploadInstructionsAsync(s,t,n.confirmAsync,e.saveOnly).then((()=>{var e;return null===(e=window.URL)||void 0===e?void 0:e.revokeObjectURL(t)})):Promise.resolve()}function g(e,t,i,r){var o,s;const a=pxt.appTarget.appTheme.boardName||lf("device"),l=pxt.appTarget.appTheme.driveDisplayName||pxt.appTarget.compile.driveName||"???",c=pxt.BrowserUtils.isBrowserDownloadWithinUserContext(),u=!pxt.BrowserUtils.isIE()&&!pxt.BrowserUtils.isEdge(),d=pxt.appTarget.appTheme.usbDocs,p=pxt.BrowserUtils.hasSaveAs(),h=pxt.appTarget.compile.useUF2?".uf2":".hex",f=(pxt.usb.isEnabled&&(null===(s=null===(o=pxt.appTarget)||void 0===o?void 0:o.compile)||void 0===s||s.webUSB),!c&&!p&&pxt.commands.renderBrowserDownloadInstructions&&pxt.commands.renderBrowserDownloadInstructions(r)),m=c?lf("Click 'Download' to open the {0} app.",pxt.appTarget.appTheme.boardName):p?lf("Click 'Save As' and save the {0} file to the {1} drive to transfer the code into your {2}.",h,l,a):!f&&lf("Move the {0} file to the {1} drive to transfer the code into your {2}.",h,l,a),g=pxt.BrowserUtils.isBrowserDownloadWithinUserContext()?0:1e4;return i({header:c?lf("Download ready..."):lf("Download completed..."),body:m,jsx:f,hasCloseIcon:!0,hideAgree:!0,helpUrl:d,bigHelpButton:!0,className:"downloaddialog",buttons:[u&&{label:c?lf("Download"):lf("Download again"),className:c?"primary":"lightgrey",urlButton:!0,url:t,fileName:e},{label:lf("Done"),className:"primary",onclick:()=>{pxt.tickEvent("downloaddialog.done"),n.hideDialog()}}],timeout:g}).then((()=>{}))}function b(){const e=window.webkit;if(e&&e.messageHandlers&&e.messageHandlers.host&&e.messageHandlers.host.postMessage)return t=>e.messageHandlers.host.postMessage(t);const t=window.android;return t&&t.postMessage?e=>t.postMessage(JSON.stringify(e)):void 0}function v(){return!!b()}function y(e){p("native deploy"),n.infoNotification(lf("Flashing device..."));const t=e.outfiles[pxt.outputName()];return b()({name:e.downloadFileBaseName,download:t}),Promise.resolve()}function k(e){p("native save"),n.infoNotification(lf("Saving file..."));const t=e.outfiles[pxt.outputName()];return b()({name:e.downloadFileBaseName,save:t}),Promise.resolve()}function w(){p("native workspace loaded");const e=b();return e&&e({cmd:"workspaceloaded"}),Promise.resolve()}function x(e,t){if(pxt.tickEvent("hid.deploy"),p("hid deploy"),!e.success)return p("compilation failed, use browser deploy instead"),m(e);const i="hiddeploy";return B=!0,pxt.Util.promiseTimeout(12e4,pxt.packetio.initAsync(!1).then((t=>n.showLoadingAsync(i,lf("Downloading..."),t.reflashAsync(e).then((()=>t.reconnectAsync())),5e3))).finally((()=>n.hideLoading(i)))).catch((i=>{if("repairbootloader"===i.type)return(p("pair bootloader"),A()).then((()=>x(e)));if("timeout"===i.message)pxt.tickEvent("hid.flash.timeout"),p("flash timeout");else{if("devicenotfound"===i.type)return pxt.tickEvent("hid.flash.devicenotfound"),p("device not found"),pxt.commands.saveOnlyAsync(e);if(19==i.code||"devicelocked"===i.type)return pxt.tickEvent("hid.flash.devicelocked"),p("error: device locked"),pxt.commands.saveOnlyAsync(e);pxt.tickEvent("hid.flash.error"),p(`hid error ${i.message}`),pxt.reportException(i),t&&t.reportError(i.message)}return pxt.commands.saveOnlyAsync(e)})).finally((()=>{B=!1}))}function E(e,t){return p("winrt deploy"),pxt.Util.promiseTimeout(18e4,x(e,t)).catch((t=>pxt.packetio.disconnectAsync().catch((e=>{pxt.reportException(e)})).then((()=>n.confirmAsync({header:lf("Something went wrong..."),body:lf("Flashing your {0} took too long. Please disconnect your {0} from your computer and try reconnecting it.",pxt.appTarget.appTheme.boardName||lf("device")),disagreeLbl:lf("Ok"),hideAgree:!0}))).then((()=>pxt.commands.saveOnlyAsync(e)))))}function C(e){return p("local deploy"),n.infoNotification(lf("Uploading...")),pxt.Util.requestAsync({url:"/api/deploy",headers:{Authorization:u.localToken},method:"POST",data:e,allowHttpErrors:!0}).then((e=>{200!==e.statusCode?n.errorNotification(lf("There was a problem, please try again")):0===e.json.boardCount&&n.warningNotification(lf("Please connect your {0} to your computer and try again",pxt.appTarget.appTheme.boardName))}))}function S(e){return pxt.winrt.saveOnlyAsync(e).then((e=>{e&&n.infoNotification(lf("file saved!"))})).catch((e=>n.errorNotification(lf("saving file failed..."))))}function _(){const e=h;e&&(e.mkPacketIOWrapper&&(p("extension mkPacketIOWrapper"),pxt.packetio.mkPacketIOWrapper=e.mkPacketIOWrapper),e.deployAsync&&(p("extension deploy core async"),pxt.commands.deployCoreAsync=e.deployAsync),e.saveOnlyAsync&&(p("extension save only async"),pxt.commands.saveOnlyAsync=e.saveOnlyAsync),e.saveProjectAsync&&(p("extension save project async"),pxt.commands.saveProjectAsync=e.saveProjectAsync),e.renderBrowserDownloadInstructions&&(p("extension upload renderBrowserDownloadInstructions"),pxt.commands.renderBrowserDownloadInstructions=e.renderBrowserDownloadInstructions),e.renderUsbPairDialog&&(p("extension renderUsbPairDialog"),pxt.commands.renderUsbPairDialog=e.renderUsbPairDialog),e.renderIncompatibleHardwareDialog&&(p("extension renderIncompatibleHardwareDialog"),pxt.commands.renderIncompatibleHardwareDialog=e.renderIncompatibleHardwareDialog),e.showUploadInstructionsAsync&&(p("extension upload instructions async"),pxt.commands.showUploadInstructionsAsync=e.showUploadInstructionsAsync),e.patchCompileResultAsync&&(p("extension build patch"),pxt.commands.patchCompileResultAsync=e.patchCompileResultAsync),e.blocklyPatch&&(p("extension blockly patch"),pxt.blocks.extensionBlocklyPatch=e.blocklyPatch),e.webUsbPairDialogAsync&&(p("extension webusb pair dialog"),pxt.commands.webUsbPairDialogAsync=e.webUsbPairDialogAsync),e.onTutorialCompleted&&(p("extension tutorial completed"),pxt.commands.onTutorialCompleted=e.onTutorialCompleted))}function T(e=!1,t=!1){return p("[CLIENT]: starting reconnect"),t&&pxt.packetio.isConnected()&&!j?Promise.resolve():L||(L=async function(){var e;if(M)return;return O?Promise.reject("Already waiting for packet lock"):await async function(){if(void 0!==R)return R;const e=new Promise((e=>{D=e,U({type:"serviceworkerclient",action:"packet-io-supported"})}));try{await pxt.U.promiseTimeout(1e3,e),R=!0}catch(e){p("[CLIENT]: old version of service worker, ignoring lock"),R=!1}return R}()&&(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)?new Promise(((e,t)=>{O=e,P=t,p("[CLIENT]: requesting lock "+I),U({type:"serviceworkerclient",action:"request-packet-io-lock",lock:I})})).finally((()=>{O=void 0,P=void 0})):void 0}().then((()=>pxt.packetio.initAsync())).then((t=>t?t.reconnectAsync().catch((t=>{if("devicenotfound"==t.type)return e&&A();throw t})):Promise.resolve())).finally((()=>{L=void 0})))}function A(){return pxt.tickEvent("cmds.pair"),pxt.commands.webUsbPairDialogAsync(pxt.usb.pairAsync,n.confirmAsync).then((e=>e?T():n.infoNotification("Oops, no device was paired.")))}function N(){return p("[CLIENT]: starting disconnect"),j=!0,pxt.packetio.disconnectAsync().then((()=>{p("[CLIENT]: sending confirmed disconnect "+I),M=!1,U({type:"serviceworkerclient",action:"release-packet-io-lock",lock:I}),j=!1}))}pxt.commands.renderBrowserDownloadInstructions=c.renderBrowserDownloadInstructions,pxt.commands.renderIncompatibleHardwareDialog=c.renderIncompatibleHardwareDialog,i.browserDownloadDeployCoreAsync=m,i.nativeHostPostMessageFunction=b,i.isNativeHost=v,i.nativeHostBackAsync=function(){p("native back");const e=b();return e&&e({cmd:"backtap"}),Promise.resolve()},i.nativeHostLongpressAsync=function(){p("native longpress");const e=b();return e&&e({cmd:"backpress"}),Promise.resolve()},i.hidDeployCoreAsync=x,i.setExtensionResult=function(e){h=e,_()},i.initAsync=async function e(){var t,i,n,o,l,c,d,h,b,T,A,N,I,O;p("cmds init"),pxt.onAppTargetChanged=()=>{p("app target changed"),e()},await pxt.usb.checkAvailableAsync(),await pxt.packetio.disconnectAsync(),pxt.packetio.mkPacketIOWrapper=void 0,pxt.commands.renderDisconnectDialog=void 0,pxt.commands.deployCoreAsync=m,pxt.commands.browserDownloadAsync=f,pxt.commands.saveOnlyAsync=m,pxt.commands.webUsbPairDialogAsync=a.webUsbPairDialogAsync,pxt.commands.showUploadInstructionsAsync=g,pxt.packetio.mkPacketIOAsync=void 0,(null===(i=null===(t=pxt.appTarget)||void 0===t?void 0:t.compile)||void 0===i?void 0:i.useUF2)&&(p("hf2 wrapper"),pxt.packetio.mkPacketIOWrapper=pxt.HF2.mkHF2PacketIOWrapper),((null===(o=null===(n=pxt.appTarget)||void 0===n?void 0:n.compile)||void 0===o?void 0:o.isNative)||(null===(c=null===(l=pxt.appTarget)||void 0===l?void 0:l.compile)||void 0===c?void 0:c.hasHex))&&!pxt.BrowserUtils.isPxtElectron()&&(pxt.usb.isAvailable()&&(null===(h=null===(d=pxt.appTarget)||void 0===d?void 0:d.compile)||void 0===h?void 0:h.webUSB)?(p("enabled webusb"),pxt.usb.setEnabled(!0),pxt.packetio.mkPacketIOAsync=pxt.usb.mkWebUSBHIDPacketIOAsync):(null===(T=null===(b=pxt.appTarget)||void 0===b?void 0:b.compile)||void 0===T?void 0:T.disableHIDBridge)||(p("enabled hid bridge (webusb disabled)"),pxt.usb.setEnabled(!1),pxt.packetio.mkPacketIOAsync=s.mkHIDBridgePacketIOAsync));const P=/force(Hex)?(Browser)?Download/i.test(window.location.href),D=pxt.usb.isEnabled&&(null===(N=null===(A=pxt.appTarget)||void 0===A?void 0:A.compile)||void 0===N?void 0:N.webUSB);P||(null===(O=null===(I=pxt.appTarget)||void 0===I?void 0:I.serial)||void 0===O?void 0:O.noDeploy)?p("deploy: force browser download"):v()?(p("deploy: webkit deploy/save"),pxt.commands.deployCoreAsync=y,pxt.commands.saveOnlyAsync=k,pxt.commands.workspaceLoadedAsync=w):pxt.winrt.isWinRT()?(p("deploy: winrt"),pxt.packetio.mkPacketIOAsync=pxt.winrt.mkWinRTPacketIOAsync,pxt.commands.browserDownloadAsync=pxt.winrt.browserDownloadAsync,pxt.commands.deployCoreAsync=E,pxt.commands.saveOnlyAsync=S):pxt.BrowserUtils.isPxtElectron()?(p("deploy: electron"),pxt.commands.deployCoreAsync=r.driveDeployAsync,pxt.commands.electronDeployAsync=r.driveDeployAsync):D?(p("deploy: webusb"),pxt.commands.deployCoreAsync=x,pxt.commands.renderDisconnectDialog=a.renderUnpairDialog):s.shouldUse()?(p("deploy: hid"),pxt.commands.deployCoreAsync=x):pxt.BrowserUtils.isLocalHost()&&u.localToken?(p("deploy: localhost"),pxt.commands.deployCoreAsync=C):p("deploy: browser only"),_(),pxt.winrt.isWinRT()&&(p("deploy: init winrt"),pxt.winrt.initWinrtHid((()=>pxt.packetio.initAsync(!0).then((e=>null==e?void 0:e.reconnectAsync()))),(()=>pxt.packetio.disconnectAsync())))},i.maybeReconnectAsync=T,i.pairAsync=A,i.showDisconnectAsync=function(){if(pxt.commands.renderDisconnectDialog){const{header:e,jsx:t,helpUrl:i}=pxt.commands.renderDisconnectDialog();return n.dialogAsync({header:e,jsx:t,helpUrl:i,hasCloseIcon:!0})}return Promise.resolve()},i.disconnectAsync=N;const I=pxtc.Util.guidGen();let O,P,D,L,R,M=!1,B=!1,j=!1;function U(e){var t;(null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)&&navigator.serviceWorker.controller.postMessage(e)}i.handleServiceWorkerMessageAsync=async function(e){"packet-io-lock-disconnect"!==e.action||O||I!==e.lock?"packet-io-lock-granted"===e.action&&e.lock===I&&O?(e.granted?(p("[CLIENT]: received granted lock "+I),O(),M=!0):(p("[CLIENT]: received denied lock "+I),P()),O=void 0,P=void 0):"packet-io-supported"===e.action&&D?(D(),R=!0,D=void 0):"packet-io-status"===e.action&&U({type:"serviceworkerclient",action:"packet-io-status",hasLock:M,lock:I}):(p("[CLIENT]: received disconnect request "+I),B||pxt.packetio.isConnecting()?U({type:"serviceworkerclient",action:"packet-io-lock-disconnect",lock:I,didDisconnect:!1}):await N())},i.showUnsupportedHardwareMessageAsync=function(e){var t;if(!pxt.packetio.isConnected())return!0;const i=pxt.packetio.unsupportedParts(),r=pxtc.computeUsedParts(e);let o=[];for(const e of i)if(-1!==r.indexOf(e)){o.push(e);break}if(o.length){const e=pxt.commands.renderIncompatibleHardwareDialog(o);pxt.tickEvent("unsupportedhardwaredialog.shown");const i=null===(t=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===t?void 0:t.incompatibleHardwareHelpURL;let r=!0;return n.confirmAsync({header:lf("Incompatible Code"),jsx:e,hasCloseIcon:!0,hideAgree:!0,helpUrl:i,bigHelpButton:!0,className:"downloaddialog",buttons:[{label:lf("Download Anyway"),className:"primary",onclick:()=>{pxt.tickEvent("unsupportedhardwaredialog.downloadagain"),r=!1,n.hideDialog()}}]}).then((()=>(r&&pxt.tickEvent("unsupportedhardwaredialog.cancelled"),!r)))}return Promise.resolve(!0)},l.mountVirtualApi("packetio",{getSync:function(e){switch(l.stripProtocol(e)){case"active":return pxt.packetio.isActive();case"connected":return pxt.packetio.isConnected();case"connecting":return pxt.packetio.isConnecting();case"icon":return pxt.packetio.icon()}return!1}})},{"./core":78,"./data":81,"./dialogs":88,"./electron":91,"./hidbridge":102,"./package":122,"./webusb":150}],29:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CodeCardView=void 0;const n=e("react"),r=e("./sui"),o=e("./data"),s=e("./cloud"),a=e("./util");pxt.Util.repeatMap;class l extends o.Component{constructor(e){super(e),this.state={}}static setupIntersectionObserver(){this.observer||(this.observer=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&(this.observer.unobserve(e.target),(e=>{const t=e.getAttribute("data-src");e.style.backgroundImage=`url(${t})`})(e.target))}))}),{rootMargin:"50px 0px",threshold:.01}))}componentDidMount(){const e=this.refs.lazyimage;if(e)if("IntersectionObserver"in window)l.setupIntersectionObserver(),l.observer.observe(e);else{const t=e.getAttribute("data-src");e.style.backgroundImage=`url(${t})`}}renderCore(){var e;const t=this.props;let i=t.color||"";const o=t.url?/^[^:]+:\/\//.test(t.url)?t.url:"/"+t.url.replace(/^\.?\/?/,""):void 0,l=o&&/^\//.test(o)?"#doc:"+o:o,c=t.className,u=t.cardType,d=t.tutorialLength==t.tutorialStep+1,p=t&&t.description&&t.description.split("\n"),h=t.onClick?e=>{e.target&&"A"==e.target.tagName||(pxt.setInteractiveConsent(!0),t.onClick(e))}:void 0,f=t.imageUrl||(t.youTubeId?`https://img.youtube.com/vi/${t.youTubeId}/0.jpg`:void 0),m=t.projectId?this.getData(`header:${t.projectId}`):null,g=m?m.name:t.name,b=t.projectId?this.getData(`${s.HEADER_CLOUDSTATE}:${t.projectId}`):null,v=null==b?void 0:b.cloudStatus(),y=v?Math.min(m.cloudLastSyncTime,m.modificationTime):t.time,k=v&&("synced"===v.value||"justSynced"===v.value||"localEdits"===v.value),w=t.ariaLabel||t.title||t.shortName||g,x=t.style||"card",E=n.createElement("div",{className:`ui ${x} ${i} ${t.onClick?"link":""} ${c||""}`,role:t.role,"aria-selected":"option"===t.role?"true":void 0,"aria-label":w,title:t.title,onClick:h,tabIndex:t.onClick?t.tabIndex||0:null,onKeyDown:t.onClick?a.fireClickOnEnter:null},t.header?n.createElement("div",{key:"header",className:"ui content "+(t.responsive?" tall desktop only":"")},t.header):null,t.label||t.labelIcon||t.blocksXml||t.typeScript||f||"file"==u?n.createElement("div",{className:"ui image"},t.label||t.labelIcon?n.createElement("label",{role:t.onLabelClicked?"button":void 0,onClick:t.onLabelClicked,className:`ui ${t.labelClass?t.labelClass:"orange right ribbon"} label`,"aria-label":`${w} ${t.onLabelClicked?"button":"label"}`},t.labelIcon?n.createElement(r.Icon,{icon:t.labelIcon}):t.label):void 0,t.typeScript?n.createElement("pre",{key:"promots"},t.typeScript):void 0,"file"!=t.cardType&&f?n.createElement("div",{className:"ui imagewrapper","aria-hidden":!0,role:"presentation"},n.createElement("div",{className:"ui cardimage","data-src":f,ref:"lazyimage","aria-hidden":!0,role:"presentation"})):void 0,"file"!=t.cardType||f?void 0:n.createElement("div",{className:"ui fileimage"}),"file"==t.cardType&&f?n.createElement("div",{className:"ui fileimage","data-src":f,ref:"lazyimage"}):void 0):void 0,t.icon||t.iconContent?n.createElement("div",{className:"ui imagewrapper","aria-hidden":!0,role:"presentation"},n.createElement("div",{className:`ui button massive fluid ${t.iconColor} ${t.iconContent?"iconcontent":""}`,"aria-hidden":!0,role:"presentation"},t.icon?n.createElement(r.Icon,{icon:""+("icon "+t.icon)}):void 0,t.iconContent||void 0)):void 0,t.shortName||g||p?n.createElement("div",{className:"content "+(this.props.tallCard?"tall":"")},t.shortName||g?n.createElement("div",{className:"header"},t.shortName||g,n.createElement("div",{className:"tags"},null===(e=t.tags)||void 0===e?void 0:e.join(" "))):null,p&&p.map(((e,i)=>n.createElement("div",{key:`line${i}`,className:"description tall "+(t.icon||t.iconContent||t.imageUrl?"":"long")},(e=>e.replace(/`/g,""))(e))))):void 0,t.time?n.createElement("div",{className:"meta"},t.tutorialLength?n.createElement("span",{className:`ui tutorial-progress ${d?"green":"orange"} left floated label`},n.createElement("i",{className:(d?"trophy":"circle")+" icon"}),"",lf("{0}/{1}",(t.tutorialStep||0)+1,t.tutorialLength)):void 0,!v&&t.time&&n.createElement("span",{key:"date",className:"date"},pxt.Util.timeSince(t.time)),v&&k&&n.createElement("span",{key:"date",className:"date "+(t.tutorialLength?"small-screen hide":"")},pxt.Util.timeSince(y),v.indicator),v&&!k&&n.createElement("span",{key:"date",className:"date"},v.indicator),v&&n.createElement("i",{className:"ui large right floated icon cloud"})):void 0,t.extracontent||t.learnMoreUrl||t.buyUrl||t.feedbackUrl?n.createElement("div",{className:"ui extra content mobile hide"},t.extracontent,t.buyUrl?n.createElement("a",{className:"learnmore left floated",href:t.buyUrl,"aria-label":lf("Buy"),target:"_blank",rel:"noopener noreferrer"},lf("Buy")):void 0,t.learnMoreUrl?n.createElement("a",{className:"learnmore right floated",href:t.learnMoreUrl,"aria-label":lf("Learn more"),target:"_blank",rel:"noopener noreferrer"},lf("Learn more")):void 0,t.feedbackUrl?n.createElement("a",{className:"learnmore right floated",href:t.feedbackUrl,"aria-label":lf("Feedback"),target:"_blank",rel:"noopener noreferrer"},lf("Feedback")):void 0):void 0);return!t.onClick&&o?n.createElement("div",null,n.createElement("a",{href:o,target:"docs",className:"ui widedesktop hide"},E),n.createElement("a",{href:l,className:"ui widedesktop only"},E)):E}}i.CodeCardView=l},{"./cloud":26,"./data":81,"./sui":143,"./util":149,react:335}],30:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.clearApiInfoDbAsync=i.getPackagesWithErrors=i.clearCaches=i.newProjectAsync=i.updatePackagesAsync=i.applyUpgradesAsync=i.getBlocksAsync=i.getApisInfoAsync=i.typecheckAsync=i.snippetAsync=i.formatAsync=i.projectSearchClear=i.projectSearchAsync=i.apiSearchAsync=i.refreshLanguageServiceApisInfo=i.workerOpAsync=i.decompilePySnippetstoXmlAsync=i.decompileSnippetstoXmlAsync=i.decompilePythonSnippetAsync=i.pyDecompileAsync=i.pySnippetToBlocksAsync=i.decompileBlocksSnippetAsync=i.decompileAsync=i.syntaxInfoAsync=i.completionsAsync=i.py2tsAsync=i.assembleAsync=i.compileAsync=i.emptyCompileResult=i.emptyProgram=void 0;const n=e("./package"),r=e("./core"),o=e("./workspace");var s=pxt.Util;function a(e,t,i){let r=n.mainEditorPkg();r.forEachFile((e=>e.diagnostics=[]));let o,a="";if(t.length>0&&r.files[pxt.MAIN_TS]&&r.files[pxt.MAIN_PY]&&i){const e=r.files[pxt.MAIN_TS].content,t=r.files[pxt.MAIN_PY].content;o=pxtc.BuildSourceMapHelpers(i,e,t).ts.locToLoc}for(let e of t){if(e.fileName){a+=`${e.category==ts.pxtc.DiagnosticCategory.Error?lf("error"):e.category==ts.pxtc.DiagnosticCategory.Warning?lf("warning"):lf("message")}: ${e.fileName}(${e.line+1},${e.column+1}): `;let t=r.filterFiles((t=>t.getTextFileName()==e.fileName))[0];if(t&&(t.diagnostics.push(e),o&&e.fileName===pxt.MAIN_TS)){let t=o(e);if(t){let i=Object.assign(Object.assign({},e),t);r.files[pxt.MAIN_PY].diagnostics.push(i)}}}a+=`${ts.pxtc.DiagnosticCategory[e.category].toLowerCase()} TS${e.code}: ${ts.pxtc.flattenDiagnosticMessageText(e.messageText,"\n")}\n`}a&&pxt.log(a),a||(a=s.lf("Everything seems fine!\n"));let l=r.outputPkg.setFile("output.txt",a);const u=t.filter((e=>e.category==ts.pxtc.DiagnosticCategory.Error));l.numDiagnosticsOverride=u.length,c(u),pxt.editor.shouldPostHostMessages()&&pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspacediagnostics",operation:e,output:a,diagnostics:t.map((e=>({code:e.code,category:ts.pxtc.DiagnosticCategory[e.category].toLowerCase(),fileName:e.fileName,start:e.start,length:e.length,line:e.line,column:e.column,endLine:e.endLine,endColumn:e.endColumn})))})}let l="";function c(e){if(e&&e.length){const t={};e.filter((e=>e.code)).forEach((e=>t[e.code]=(t[e.code]||0)+1));const i=JSON.stringify(e);if(i!==l){for(const e of Object.keys(t))pxt.tickEvent("diagnostics",{errorCode:e,count:t[e]});l=i}}else l=""}let u,d,p,h=new Promise((()=>{}));function f(e){return t=>t.isUserError?(r.errorNotification(t.message),n.mainEditorPkg().outputPkg.setFile("output.txt",t.message).numDiagnosticsOverride=1,e):Promise.reject(t)}function m(e){return w("assemble",{fileContent:e})}function g(e){return w("compile",{options:e})}function b(e,t,i){const r=n.mainPkg.getTargetOptions();return n.mainPkg.getCompileOptionsAsync(r).then((t=>(t.fileSystem[pxt.MAIN_TS]=e,t.fileSystem[pxt.MAIN_BLOCKS]="",t.snippetMode=i&&i.snippetMode||!1,-1===t.sourceFiles.indexOf(pxt.MAIN_TS)&&t.sourceFiles.push(pxt.MAIN_TS),-1===t.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&t.sourceFiles.push(pxt.MAIN_BLOCKS),t.ast=!0,v(t,pxt.MAIN_TS))))}function v(e,t){return w("decompile",{options:e,fileName:t})}function y(e,t){return w("pydecompile",{options:e,fileName:t})}function k(e){const t=n.mainPkg.getTargetOptions();return n.mainPkg.getCompileOptionsAsync(t).then((t=>(t.sourceTexts=e,t.snippetMode=!1,-1===t.sourceFiles.indexOf(pxt.MAIN_TS)&&t.sourceFiles.push(pxt.MAIN_TS),-1===t.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&t.sourceFiles.push(pxt.MAIN_BLOCKS),t.ast=!0,function(e){return w("decompileSnippets",{options:e})}(t))))}function w(e,t){const i=Date.now();return pxt.debug("worker op: "+e),pxt.worker.getWorker(pxt.webConfig.workerjs).opAsync(e,t).then((t=>(pxt.appTarget.compile.switches.time&&(pxt.log(`Worker perf: ${e} ${Date.now()-i}ms`),t.times&&console.log(t.times)),pxt.debug("worker op done: "+e),t)))}i.emptyProgram="(function (ectx) {\n'use strict';\nectx.runtime.setupPerfCounters([]);\nectx.setupDebugger(1)\nreturn function (s) {\n    // START\n    ectx.runtime.kill()\n    return ectx.leave(s, s.r0)\n}\n})\n",i.emptyCompileResult=function(){return{success:!0,diagnostics:[],times:{},breakpoints:[],outfiles:{"binary.js":i.emptyProgram.replace("// START",pxt.appTarget.simulator.emptyRunCode||"")}}},i.compileAsync=function(e={}){let t=n.mainPkg.getTargetOptions();return t.isNative=e.native,n.mainEditorPkg().buildAssetsAsync().then((()=>n.mainPkg.getCompileOptionsAsync(t))).then((t=>(e.debug&&(t.breakpoints=!0,t.justMyCode=!e.debugExtensionCode,t.testMode=!0),e.trace&&(t.breakpoints=!0,t.justMyCode=!0,t.trace=!0),t.computeUsedSymbols=!0,e.forceEmit&&(t.forceEmit=!0),/test=1/i.test(window.location.href)&&(t.testMode=!0),t))).then(g).then((t=>{let i=n.mainEditorPkg().outputPkg.files[pxtc.BINARY_ASM];if(i&&!t.outfiles[pxtc.BINARY_ASM]&&(t.outfiles[pxtc.BINARY_ASM]=i.content),e.jsMetaVersion&&t.outfiles[pxtc.BINARY_JS]){const i={simUrl:pxt.webConfig.simUrl.replace(/\/[^\-]*---simulator/,`/v${pxt.appTarget.versions.target}/---simulator`),cdnUrl:pxt.webConfig.cdnUrl,version:e.jsMetaVersion,target:pxt.appTarget.id,targetVersion:pxt.appTarget.versions.target},r=n.mainPkg.readGitJson();r&&(i.repo=pxt.github.parseRepoId(r.repo).fullName),t.outfiles[pxtc.BINARY_JS]=`// meta=${JSON.stringify(i)}\n${t.outfiles[pxtc.BINARY_JS]}`}return n.mainEditorPkg().outputPkg.setFiles(t.outfiles),a("compile",t.diagnostics),C().then((()=>{if(!t.usedSymbols||!d)return t;for(let e of Object.keys(t.usedSymbols))t.usedSymbols[e]=s.lookup(d.byQName,e);return t}))})).catch(f(h))},i.assembleAsync=function(e){return m(`.startaddr 536887040\n${e}`).then((t=>m(`.startaddr ${536887296-4*(t.words.length+1)}\n${e}`).then((e=>(s.assert(e.words.length==t.words.length),e)))))},i.py2tsAsync=function(e=!1){let t=n.mainPkg.getTargetOptions();return E().then((()=>n.mainPkg.getCompileOptionsAsync(t))).then((e=>(e.target.preferredEditor=pxt.PYTHON_PROJECT_NAME,w("py2ts",{options:e}))))},i.completionsAsync=function(e,t,i,n,r,o){return w("getCompletions",{fileName:e,fileContent:r,position:t,wordStartPos:i,wordEndPos:n,light:o,runtime:pxt.appTarget.runtime})},i.syntaxInfoAsync=function(e,t,i,n){return w("syntaxInfo",{fileName:t,fileContent:n,position:i,infoType:e})},i.decompileAsync=function(e,t,i,r){let o=n.mainPkg.getTargetOptions();return n.mainPkg.getCompileOptionsAsync(o).then((t=>(t.ast=!0,t.testMode=!0,t.alwaysDecompileOnStart=pxt.appTarget.runtime&&pxt.appTarget.runtime.onStartUnDeletable,v(t,e)))).then((e=>{if(e.success&&t&&i&&r){const n=pxt.blocks.layout.patchBlocksFromOldWorkspace(t,i,e.outfiles[r]);e.outfiles[r]=n}return n.mainEditorPkg().outputPkg.setFiles(e.outfiles),a("decompile",e.diagnostics),e}))},i.decompileBlocksSnippetAsync=b,i.pySnippetToBlocksAsync=function(e,t){let i=n.mainPkg.getTargetOptions();return E().then((()=>n.mainPkg.getCompileOptionsAsync(i))).then((t=>(t.fileSystem[pxt.MAIN_PY]=e,t.fileSystem[pxt.MAIN_BLOCKS]="",-1===t.sourceFiles.indexOf(pxt.MAIN_PY)&&t.sourceFiles.push(pxt.MAIN_PY),-1===t.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&t.sourceFiles.push(pxt.MAIN_BLOCKS),w("py2ts",{options:t})))).then((e=>b(e.outfiles[pxt.MAIN_TS])))},i.pyDecompileAsync=function(e){let t=n.mainPkg.getTargetOptions();return n.mainPkg.getCompileOptionsAsync(t).then((t=>(t.ast=!0,t.testMode=!0,t.alwaysDecompileOnStart=pxt.appTarget.runtime&&pxt.appTarget.runtime.onStartUnDeletable,y(t,e)))).then((e=>(n.mainEditorPkg().outputPkg.setFiles(e.outfiles),c(e.diagnostics.filter((e=>e.category==ts.pxtc.DiagnosticCategory.Error))),e)))},i.decompilePythonSnippetAsync=function(e){let t=n.mainPkg.getTargetOptions();return n.mainPkg.getCompileOptionsAsync(t).then((t=>(t.fileSystem[pxt.MAIN_TS]=e,t.fileSystem[pxt.MAIN_PY]="",-1===t.sourceFiles.indexOf(pxt.MAIN_TS)&&t.sourceFiles.push(pxt.MAIN_TS),-1===t.sourceFiles.indexOf(pxt.MAIN_PY)&&t.sourceFiles.push(pxt.MAIN_PY),t.ast=!0,y(t,pxt.MAIN_TS)))).then((e=>e.outfiles[pxt.MAIN_PY]))},i.decompileSnippetstoXmlAsync=k,i.decompilePySnippetstoXmlAsync=function(e){const t=/^\s*namespace\s+[^\s]+\s*{([\S\s]*)}\s*$/im,i=/^\s*export\s(let\s*[\S\s]*)\s*$/im,r=/^\s*export\s(function\s*[\S\s]*)\s*$/im,o=n.mainPkg.getTargetOptions();let s=[];return E().then((()=>n.mainPkg.getCompileOptionsAsync(o))).then((t=>{for(let i=0;i<e.length;i++){const n=`snippet_${i}`;t.fileSystem[n+".py"]=e[i],t.sourceFiles.push(n+".py"),s.push(n)}return t.fileSystem[pxt.MAIN_BLOCKS]="",-1===t.sourceFiles.indexOf(pxt.MAIN_BLOCKS)&&t.sourceFiles.push(pxt.MAIN_BLOCKS),w("py2ts",{options:t})})).then((e=>{const n=[];for(let o of s){let s=e.outfiles[o+".ts"].match(t);if(s&&s[1]){let e=s[1].split("\n").map((e=>{const t=e.match(i),n=t?t[1]:e,o=n.match(r);return o?o[1]:n}));n.push(e.join("\n"))}}return k(n)}))},i.workerOpAsync=w;let x=!1;function E(){return u||S()}function C(){return x||!d?w("apiInfo",{}).then((e=>{if(0!==Object.keys(e).length)return x=!1,ts.pxtc.localizeApisAsync(e,n.mainPkg)})).then((e=>{d=e})):Promise.resolve()}function S(){let e=n.mainEditorPkg().buildAssetsAsync().then((()=>n.mainPkg.getCompileOptionsAsync())).then((e=>(e.testMode=!0,w("setOptions",{options:e})))).then((()=>w("allDiags",{}))).then((e=>a("typecheck",e.diagnostics,e.sourceMap))).then(C).catch(f(null));return u||(u=e),e}function _(){return E().then((()=>d))}function T(){if(!p){const e=n.mainPkg.resolveBannedCategories();return async function(e,t){if(!t)return null;const i="libs/"+pxt.appTarget.corepkg,r=t[i];if(!r)return null;const o=e.getAllFiles(),a=[pxt.MAIN_TS,pxt.TUTORIAL_CODE_START,pxt.TUTORIAL_CODE_STOP,pxt.TILEMAP_CODE,pxt.IMAGES_CODE];if(Object.keys(o).some((e=>-1===a.indexOf(e)&&-1===e.indexOf("/")&&pxt.Util.endsWith(e,".ts"))))return null;const l=pxt.appTarget.bundleddirs.map((e=>{const t=pxt.appTarget.bundledpkgs[e.substr(e.lastIndexOf("/")+1)];return t?{dirname:e,files:t,config:JSON.parse(t[pxt.CONFIG_NAME])}:null})).filter((e=>e&&e.config)),c=e.pkgAndDeps(),u=[],d=[{dirname:i,info:r}];for(const e of c){if("built"===e.id||e.isTopLevel())continue;let i=!1;for(const n of l)if(n.config.name===B(e)){d.push({dirname:n.dirname,info:t[n.dirname]}),i=!0;break}i||u.push(e)}if(u.length){let t;try{t=await j.createAsync()}catch(e){return console.log("Unable to open API info cache DB"),null}for(const e of u){const i=await t.getAsync(e);if(!i)return pxt.debug(`Could not find cached API info for ${B(e)}, waiting for full compile`),null;pxt.debug(`Fetched cached API info for ${B(e)}`),d.push({dirname:e.getPkgId(),info:i})}}const p={byQName:{}};for(const e of d){if(!e)continue;let{info:t,dirname:i}=e;const n=s.cloneApis(t.apis.byQName);for(const e of Object.keys(n))n[e].pkg=i,delete n[e].attributes._translatedLanguageCode,p.byQName[e]=n[e]}p.jres=n.mainPkg.getJRes()||{};for(const e of Object.keys(p.byQName)){let t=p.byQName[e],i=t.attributes.jres;if(i){"true"==i&&(i=e);let n=s.lookup(p.jres,i);n&&n.icon&&!t.attributes.iconURL&&(t.attributes.iconURL=n.icon),n&&n.data&&!t.attributes.jresURL&&(t.attributes.jresURL="data:"+n.mimeType+";base64,"+n.data)}}return p}(n.mainEditorPkg(),pxt.getBundledApiInfo()).then((t=>t?ts.pxtc.localizeApisAsync(t,n.mainPkg).then((t=>p=pxtc.getBlocksInfo(t,e))):_().then((e=>{const t=n.mainPkg.resolveBannedCategories();return p=pxtc.getBlocksInfo(e,t),async function(e,t){var i;const n=pxt.Package.corePackages().map((e=>e.name)),r=e.pkgAndDeps().filter((e=>"built"!==e.id&&!e.isTopLevel()&&-1===n.indexOf(e.getPkgId())));if(r.length){const n=Object.keys(t.byQName);let o;try{o=await j.createAsync()}catch(e){return void pxt.log("Unable to create DB to cache API info")}for(const e of r){const r=e.getPkgId(),s={sha:null,apis:{byQName:{}}};for(const e of n){const n=t.byQName[e];(n.pkg===r||(null===(i=n.pkgs)||void 0===i?void 0:i.find((e=>e===r))))&&(s.apis.byQName[e]=A(n))}await o.setAsync(e,s),pxt.debug(`Stored API info for ${B(e)}`)}}}(n.mainEditorPkg(),e)})).then((()=>p))))}return Promise.resolve(p)}function A(e){const t=s.clone(e);delete t.pkgs;const i=s.clone(t.attributes);delete i._translatedLanguageCode;let n=!1;return i._untranslatedBlock&&(i.block=i._untranslatedBlock,delete i._untranslatedBlock,n=!0),i._untranslatedJsDoc&&(i.jsDoc=i._untranslatedJsDoc,delete i._untranslatedJsDoc,n=!0),n&&ts.pxtc.updateBlockDef(i),t.attributes=i,t}function N(){const e=n.mainPkg,t=n.getEditorPkg(e),i=t.header.targetVersion,r=t.files[pxt.MAIN_BLOCKS]?t.files[pxt.MAIN_BLOCKS].content:`<block type="${ts.pxtc.ON_START_TYPE}"></block>`;let o,s={};return pxt.debug("Applying upgrades to blocks"),pxt.BrowserUtils.loadBlocklyAsync().then((()=>T())).then((e=>{o=new Blockly.Workspace;const t=pxt.blocks.importXml(i,r,e,!0),n=Blockly.Xml.textToDom(t);pxt.blocks.domToWorkspaceNoEvents(n,o),pxtblockly.upgradeTilemapsInWorkspace(o,pxt.react.getTilemapProject());const a=Blockly.Xml.workspaceToDom(o);return s[pxt.MAIN_BLOCKS]=Blockly.Xml.domToText(a),pxt.blocks.compileAsync(o,e)})).then((e=>(s[pxt.MAIN_TS]=e.source,t.buildAssetsAsync()))).then((()=>{const e=t.getAllFiles(),i=Object.keys(e).filter((e=>!/^main\.(blocks|ts|py)$/.test(e)));for(const t of i)s[t]=e[t];return O(s)})).then((()=>({success:!0,editor:pxt.BLOCKS_PROJECT_NAME,patchedFiles:s}))).catch((()=>(pxt.debug("Block upgrade failed, falling back to TS"),I())))}function I(){const e=n.mainPkg,t=n.getEditorPkg(e),i=t.header.targetVersion,r={};return pxt.Util.values(t.files).filter(P).forEach((e=>{const t=pxt.patching.patchJavaScript(i,e.content);t!=e.content&&(r[e.name]=t)})),pxt.debug("Applying upgrades to TypeScript"),O(r).then((()=>({success:!0,editor:pxt.JAVASCRIPT_PROJECT_NAME,patchedFiles:r}))).catch((e=>({success:!1,errorCodes:e.errorCodes})))}function O(e){const t=n.mainPkg;return n.mainEditorPkg().buildAssetsAsync().then((()=>t.getCompileOptionsAsync())).then((t=>(e&&Object.keys(e).forEach((i=>{e[i]&&(t.fileSystem[i]=e[i])})),g(t)))).then((e=>{if(!e.success){const t={};e.diagnostics&&e.diagnostics.forEach((e=>{const i="TS"+e.code;t[i]=(t[i]||0)+1}));const i=new Error("Compile failed on updated package");return i.errorCodes=t,Promise.reject(i)}return Promise.resolve()}))}function P(e){return pxt.Util.endsWith(e.getName(),".ts")}function D(){return L(),w("reset",{})}function L(){u=null,d=null,p=null}function R(){const e=n.mainPkg.resolveBannedCategories();if(e)return{bannedCategories:e}}function M(e){const t=JSON.stringify(e.getAllFiles())+pxt.appTarget.versions.pxt+"_"+pxt.appTarget.versions.target;return pxtc.U.sha256(t)}function B(e){const t=e.getKsPkg(),i=t._verspec;return pxt.github.isGithubId(i)?/^([^#]+)/.exec(i)[1]:t.config.name}i.refreshLanguageServiceApisInfo=function(){x=!0},i.apiSearchAsync=function(e){return C().then((()=>(e.localizedApis=d,e.localizedStrings=pxt.Util.getLocalizedStrings(),w("apiSearch",{search:e,blocks:R()}))))},i.projectSearchAsync=function(e){return C().then((()=>w("projectSearch",{projectSearch:e})))},i.projectSearchClear=function(){return C().then((()=>w("projectSearchClear",{})))},i.formatAsync=function(e,t){return w("format",{format:{input:e,pos:t}})},i.snippetAsync=function(e,t){let i=Promise.resolve();return t&&(i=S().then((()=>{}))),i.then((()=>w("snippet",{snippet:{qName:e,python:t},runtime:pxt.appTarget.runtime}))).then((e=>e))},i.typecheckAsync=S,i.getApisInfoAsync=_,i.getBlocksAsync=T,i.applyUpgradesAsync=function(){const e=n.mainPkg,t=n.getEditorPkg(e),i=pxt.semver.parse(t.header.targetVersion||"0.0.0"),r=pxt.semver.parse(pxt.appTarget.versions.target);if(0===pxt.semver.cmp(i,r))return pxt.debug("Skipping project upgrade"),Promise.resolve({success:!0});const o=t.header.editor!==pxt.BLOCKS_PROJECT_NAME?I:N;let s=!1;return O().catch((()=>s=!0)).then(o).then((e=>e.success?(pxt.tickEvent("upgrade.success",{projectEditor:t.header.editor,upgradedEditor:e.editor,preUpgradeVersion:t.header.targetVersion||"unknown",projectNeverCompiled:""+s}),pxt.debug("Upgrade successful!"),function(e,t,i){return Object.keys(t).forEach((i=>e.setFile(i,t[i]))),e.header.targetVersion=pxt.appTarget.versions.target,e.header.editor=i,e.saveFilesAsync()}(t,e.patchedFiles,e.editor).then((()=>e))):(pxt.tickEvent("upgrade.failed",{projectEditor:t.header.editor,preUpgradeVersion:t.header.targetVersion||"unknown",errors:JSON.stringify(e.errorCodes),projectNeverCompiled:""+s}),pxt.debug("Upgrade failed; bailing out and leaving project as-is"),Promise.resolve(e))))},i.updatePackagesAsync=function(e,t){const i=n.mainEditorPkg();let r,a=0;return t&&t.startOperation(),o.getTextAsync(i.header.id).then((e=>o.makeBackupAsync(i.header,e))).then((e=>(r=e,i.header.backupRef=r.id,o.saveAsync(i.header)))).then((()=>s.promiseMapAllSeries(e,(n=>(t&&t.throwIfCancelled(),i.updateDepAsync(n.getPkgId()).then((()=>{++a,t&&!t.isCancelled()&&t.reportProgress(a,e.length)}))))))).then((()=>n.loadPkgAsync(i.header.id))).then((()=>D())).then((()=>O())).then((()=>(t&&t.throwIfCancelled(),delete i.header.backupRef,o.saveAsync(i.header)))).then((()=>!0)).catch((()=>o.restoreFromBackupAsync(i.header).then((()=>!1)))).finally((()=>{let e=Promise.resolve();return r&&(r.isDeleted=!0,e=o.forceSaveAsync(r)),e.finally((()=>{t&&t.resolveCancel()}))}))},i.newProjectAsync=D,i.clearCaches=L,i.getPackagesWithErrors=function(){const e={},t=n.mainEditorPkg();if(t){const i=pxt.Package.corePackages().map((e=>e.name));t.forEachFile((t=>{t.diagnostics&&t.diagnostics.length&&t.epkg&&-1===i.indexOf(t.epkg.getPkgId())&&!t.epkg.isTopLevel()&&t.diagnostics.some((e=>e.category===ts.pxtc.DiagnosticCategory.Error))&&(e[t.epkg.getPkgId()]=t.epkg)}))}return pxt.Util.values(e)};class j{constructor(e){this.db=e}static dbName(){return`__pxt_apis_${pxt.appTarget.id||""}`}static createAsync(){function e(){const e=new pxt.BrowserUtils.IDBWrapper(j.dbName(),2,((e,t)=>{t.result.createObjectStore(j.TABLE,{keyPath:j.KEYPATH})}),(()=>{pxt.BrowserUtils.IDBWrapper.deleteDatabaseAsync(j.dbName())}));return e.openAsync().then((()=>new j(e)))}return e().catch((t=>(console.log("db: failed to open api database, try delete entire store..."),pxt.BrowserUtils.IDBWrapper.deleteDatabaseAsync(j.dbName()).then((()=>e())))))}getAsync(e){const t=B(e),i=M(e);return this.db.getAsync(j.TABLE,t).then((e=>{if(e&&e.hash===i)return e.apis}))}setAsync(e,t){pxt.perf.measureStart("compiler db setAsync");const i={id:B(e),hash:M(e),apis:t};return this.db.setAsync(j.TABLE,i).then((()=>{pxt.perf.measureEnd("compiler db setAsync")}))}clearAsync(){return this.db.deleteAllAsync(j.TABLE).then((()=>console.debug("db: all clean"))).catch((e=>{console.error("db: failed to delete all")}))}}j.TABLE="files",j.KEYPATH="id",i.clearApiInfoDbAsync=function(){return j.createAsync().then((e=>e.clearAsync())).catch((e=>pxt.BrowserUtils.IDBWrapper.deleteDatabaseAsync(j.dbName()).then()))}},{"./core":78,"./package":122,"./workspace":151}],31:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FilterPanel=i.FilterPanelSubheading=i.FilterTag=void 0;const n=e("react"),r=e("../util");class o extends n.Component{constructor(e){super(e),this.clickHandler=this.clickHandler.bind(this)}render(){return n.createElement("div",{className:"filter-tag"},n.createElement("div",{className:"filter-tag-box",role:"checkbox",onClick:this.clickHandler,onKeyDown:r.fireClickOnEnter,"aria-checked":this.props.selected},n.createElement("i",{className:"icon square outline "+(this.props.selected?"check":"")})),n.createElement("div",{className:"filter-tag-name",role:"button",onClick:this.clickHandler,onKeyDown:r.fireClickOnEnter},pxtc.U.rlf(this.props.tag)))}clickHandler(){this.props.onClickHandler(this.props.tag)}}i.FilterTag=o;class s extends n.Component{render(){return n.createElement("div",{className:"filter-subheading-row"},n.createElement("div",{className:"filter-subheading-title"},`${this.props.subheading}:`),this.props.buttonText&&n.createElement("div",{className:"filter-subheading-button",role:"button",style:this.props.buttonStyle,onClick:this.props.buttonAction,onKeyDown:r.fireClickOnEnter},this.props.buttonText))}}i.FilterPanelSubheading=s;class a extends n.Component{isTagSelected(e){return this.props.enabledTags.indexOf(e.toLowerCase())>=0}render(){const e=this.props.tagOptions;return n.createElement("div",{className:"filter-panel"},n.createElement("div",{className:"filter-title"},lf("Filter")),n.createElement(s,{subheading:lf("Categories"),buttonText:lf("Clear"),buttonAction:this.props.clearTags,buttonStyle:this.props.enabledTags.length>0?{color:"white"}:{}}),n.createElement("div",{className:"filter-tag-list"},e.map((e=>n.createElement(o,{key:e,tag:e,selected:this.isTagSelected(e),onClickHandler:this.props.tagClickHandler})))))}}i.FilterPanel=a},{"../util":149,react:335}],32:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Alert=void 0;const n=e("react"),r=e("react-redux"),o=e("./actions/dispatch");class s extends n.Component{constructor(e){super(e)}render(){const{title:e,text:t,options:i,dispatchHideAlert:r}=this.props;return n.createElement("div",{className:"image-editor-alert-container",role:"region",onClick:r},n.createElement("div",{className:"image-editor-alert",role:"dialog"},n.createElement("div",{className:"title"},n.createElement("span",{className:"ms-Icon ms-Icon--Warning"}),n.createElement("span",null,e),n.createElement("span",{className:"ms-Icon ms-Icon--Cancel",role:"button",onClick:r})),n.createElement("div",{className:"text"},t),i&&n.createElement("div",{className:"options"},i.map(((e,t)=>n.createElement("div",{key:t,className:"button",role:"button",onClick:e.onClick},e.label))))))}}const a={dispatchHideAlert:o.dispatchHideAlert};i.Alert=r.connect((function({editor:e},t){return e?t:{}}),a)(s)},{"./actions/dispatch":45,react:335,"react-redux":314}],33:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BottomBar=i.BottomBarImpl=void 0;const n=e("react"),r=e("react-redux"),o=e("./actions/dispatch"),s=e("./Button"),a=e("./util"),l=e("../../assets"),c=e("./keyboardShortcuts");class u extends n.Component{constructor(e){super(e),this.disableShortcutsOnFocus=()=>{this.setShortcutsEnabled(!1)},this.handleWidthChange=e=>{const t=e.target.value,i=parseInt(t),{aspectRatioLocked:n,imageDimensions:r}=this.props;!isNaN(i)&&n?this.setState({width:i+"",height:Math.floor(i*(r[1]/r[0]))+""}):this.setState({width:t})},this.handleHeightChange=e=>{const t=e.target.value,i=parseInt(t),{aspectRatioLocked:n,imageDimensions:r}=this.props;!isNaN(i)&&n?this.setState({height:i+"",width:Math.floor(i*(r[0]/r[1]))+""}):this.setState({height:t})},this.handleDimensionalBlur=()=>{const{imageDimensions:e,isTilemap:t,dispatchChangeImageDimensions:i}=this.props,n=parseInt(this.state.width),r=parseInt(this.state.height),o=t?255:512,s=isNaN(n)?e[0]:Math.min(Math.max(n,1),o),a=isNaN(r)?e[1]:Math.min(Math.max(r,1),o);s===e[0]&&a===e[1]||i([s,a]),this.setState({width:null,height:null}),this.setShortcutsEnabled(!0)},this.handleDimensionalKeydown=e=>{13===("number"==typeof e.which?e.which:e.keyCode)&&e.currentTarget.blur()},this.handleAssetNameChange=e=>{let t=null;const i=e.target.value.trim(),n=e.target.value;pxt.validateAssetName(i)?l.isNameTaken(i)&&i!==this.props.assetName&&(t=lf("This name is already used elsewhere in your project")):t=lf("Names may only contain letters, numbers, '-', '_', and space"),this.setState({assetName:n,assetNameMessage:t})},this.handleAssetNameBlur=()=>{const{dispatchChangeAssetName:e,assetName:t}=this.props;let i=this.state.assetName.trim();i!==t&&pxt.validateAssetName(i)&&!l.isNameTaken(i)&&e(i),this.setState({assetName:null,assetNameMessage:null}),this.setShortcutsEnabled(!0)},this.zoomIn=()=>{this.props.dispatchChangeZoom(1)},this.zoomOut=()=>{this.props.dispatchChangeZoom(-1)},this.state={}}render(){const{imageDimensions:e,cursorLocation:t,hasUndo:i,hasRedo:r,dispatchUndoImageEdit:o,dispatchRedoImageEdit:l,aspectRatioLocked:c,onionSkinEnabled:u,dispatchToggleAspectRatioLocked:d,dispatchToggleOnionSkinEnabled:p,resizeDisabled:h,singleFrame:f,onDoneClick:m,assetName:g}=this.props,{assetNameMessage:b}=this.state,v=null==this.state.width?e[0]:this.state.width,y=null==this.state.height?e[1]:this.state.height,k=null==this.state.assetName?g||"":this.state.assetName;return n.createElement("div",{className:"image-editor-bottombar"},!h&&n.createElement("div",{className:"image-editor-resize"},n.createElement("input",{className:"image-editor-input",title:lf("Image Width"),value:v,tabIndex:0,onChange:this.handleWidthChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleDimensionalBlur,onKeyDown:this.handleDimensionalKeydown}),n.createElement(s.IconButton,{onClick:d,iconClass:c?"ms-Icon ms-Icon--Lock":"ms-Icon ms-Icon--Unlock",title:c?lf("Unlock Aspect Ratio"):lf("Lock Aspect Ratio"),toggle:!c,noTab:!0}),n.createElement("input",{className:"image-editor-input",title:lf("Image Height"),value:y,tabIndex:0,onChange:this.handleHeightChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleDimensionalBlur,onKeyDown:this.handleDimensionalKeydown})),!f&&n.createElement("div",{className:"image-editor-seperator"}),!f&&n.createElement("div",null,n.createElement(s.IconButton,{onClick:p,iconClass:"ms-Icon ms-Icon--MapLayers",title:u?lf("Hide Previous Frame"):lf("Show Previous Frame"),toggle:!u})),t&&!h&&n.createElement("div",{className:"image-editor-seperator"}),n.createElement("div",{className:"image-editor-coordinate-preview"},t&&`${t[0]}, ${t[1]}`),n.createElement("div",{className:"image-editor-change-name"},n.createElement("input",{className:"image-editor-input",title:lf("Asset Name"),value:k,placeholder:lf("Asset Name"),tabIndex:0,onChange:this.handleAssetNameChange,onFocus:this.disableShortcutsOnFocus,onBlur:this.handleAssetNameBlur,onKeyDown:this.handleDimensionalKeydown}),b&&n.createElement("div",{className:"ui pointing below red basic label"},b)),n.createElement("div",{className:"image-editor-undo-redo"},n.createElement(s.IconButton,{title:lf("Undo"),iconClass:"ms-Icon ms-Icon--Undo",onClick:i?o:null,disabled:!i}),n.createElement(s.IconButton,{title:lf("Redo"),iconClass:"ms-Icon ms-Icon--Redo",onClick:r?l:null,disabled:!r})),n.createElement("div",{className:"image-editor-seperator"}),n.createElement("div",{className:"image-editor-zoom-controls"},n.createElement(s.IconButton,{onClick:this.zoomOut,iconClass:"ms-Icon ms-Icon--ZoomOut",title:lf("Zoom Out"),toggle:!0}),n.createElement(s.IconButton,{onClick:this.zoomIn,iconClass:"ms-Icon ms-Icon--ZoomIn",title:lf("Zoom In"),toggle:!0})),n.createElement("div",{role:"button",className:"image-editor-confirm",title:lf("Done"),tabIndex:0,onClick:m,onKeyDown:a.fireClickOnlyOnEnter},lf("Done")))}setShortcutsEnabled(e){e&&this.shortcutLock?(c.releaseShortcutLock(this.shortcutLock),this.shortcutLock=void 0):e||this.shortcutLock||(this.shortcutLock=c.obtainShortcutLock())}}i.BottomBarImpl=u;const d={dispatchChangeImageDimensions:o.dispatchChangeImageDimensions,dispatchUndoImageEdit:o.dispatchUndoImageEdit,dispatchRedoImageEdit:o.dispatchRedoImageEdit,dispatchToggleAspectRatioLocked:o.dispatchToggleAspectRatioLocked,dispatchToggleOnionSkinEnabled:o.dispatchToggleOnionSkinEnabled,dispatchChangeZoom:o.dispatchChangeZoom,dispatchChangeAssetName:o.dispatchChangeAssetName};i.BottomBar=r.connect((function({store:{present:e,past:t,future:i},editor:n},r){var o,s,a;if(!e)return{};const l=n.isTilemap?e.tilemap.bitmap:e.frames[e.currentFrame].bitmap;return{imageDimensions:[l.width,l.height],aspectRatioLocked:e.aspectRatioLocked,onionSkinEnabled:n.onionSkinEnabled,cursorLocation:n.cursorLocation,resizeDisabled:"tile"===(null===(o=e.asset)||void 0===o?void 0:o.type),assetName:null===(a=null===(s=e.asset)||void 0===s?void 0:s.meta)||void 0===a?void 0:a.displayName,hasUndo:!!t.length,hasRedo:!!i.length,isTilemap:n.isTilemap}}),d)(u)},{"../../assets":18,"./Button":34,"./actions/dispatch":45,"./keyboardShortcuts":47,"./util":54,react:335,"react-redux":314}],34:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.IconButton=void 0;const n=e("react"),r=e("./util");class o extends n.Component{render(){const{title:e,iconClass:t,onClick:i,toggle:o,disabled:s,noTab:a}=this.props;return n.createElement("div",{role:"button",className:`image-editor-button ${o?"toggle":""} ${s?"disabled":""}`,title:e,tabIndex:a||s?-1:0,onClick:i,onKeyDown:r.fireClickOnlyOnEnter},n.createElement("span",{className:t}))}}i.IconButton=o},{"./util":54,react:335}],35:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CursorSizes=void 0;const n=e("react"),r=e("./actions/dispatch"),o=e("react-redux");class s extends n.Component{constructor(){super(...arguments),this.handlers=[]}render(){const{selected:e}=this.props;return n.createElement("div",{className:"cursor-buttons"},n.createElement("div",{className:"cursor-button-outer "+(1===e?"selected":""),title:lf("Small Cursor (1px)"),role:"button",onClick:this.clickHandler(1)},n.createElement("div",{className:"cursor-button small"})),n.createElement("div",{className:"cursor-button-outer "+(3===e?"selected":""),title:lf("Medium Cursor (3px)"),role:"button",onClick:this.clickHandler(3)},n.createElement("div",{className:"cursor-button medium"})),n.createElement("div",{className:"cursor-button-outer "+(5===e?"selected":""),title:lf("Large Cursor (5px)"),role:"button",onClick:this.clickHandler(5)},n.createElement("div",{className:"cursor-button large"})))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>{const{dispatchChangeCursorSize:t}=this.props;t(e)}),this.handlers[e]}}const a={dispatchChangeCursorSize:r.dispatchChangeCursorSize};i.CursorSizes=o.connect((function({editor:e},t){return e?{selected:e.cursorSize}:{}}),a)(s)},{"./actions/dispatch":45,react:335,"react-redux":314}],36:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Dropdown=void 0;const n=e("react");class r extends n.Component{constructor(e){super(e),this.handlers=[],this.handleDropdownClick=()=>{this.setState({open:!this.state.open})},this.state={open:!1}}componentDidUpdate(){this.handlers=[]}componentWillUnmount(){this.handlers=null}render(){const{options:e,selected:t}=this.props,{open:i}=this.state,r=e[t];return n.createElement("div",{className:"image-editor-dropdown-outer"},n.createElement("button",{className:"image-editor-dropdown","aria-haspopup":"listbox",onClick:this.handleDropdownClick,tabIndex:-1},(null==r?void 0:r.text)||"",n.createElement("span",{className:"image-editor-dropdown-chevron ms-Icon ms-Icon--ChevronDown"})),n.createElement("ul",{tabIndex:-1,role:"listbox","aria-activedescendant":null==r?void 0:r.id,className:i&&e.length?"":"hidden"},e.map(((e,i)=>n.createElement("li",{key:e.id,role:"option","aria-selected":i===t,className:i===t?"selected":"",onClick:this.clickHandler(i)},e.text)))))}clickHandler(e){if(!this.handlers[e]){const{onChange:t,options:i}=this.props;this.handlers[e]=()=>{this.setState({open:!1}),t(i[e],e)}}return this.handlers[e]}}i.Dropdown=r},{react:335}],37:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ImageCanvas=i.ImageCanvasImpl=void 0;const n=e("react"),r=e("react-redux"),o=e("./store/imageReducer"),s=e("./actions/dispatch"),a=e("./util"),l=e("./toolDefinitions"),c=e("../../assets"),u=e("./keyboardShortcuts"),d=e("./ImageEditor"),p=[o.TileDrawingMode.Wall];class h extends n.Component{constructor(){super(...arguments),this.cursor=l.ToolCursor.Crosshair,this.zoom=2.5,this.panX=0,this.panY=0,this.hasInteracted=!1,this.tileCache={},this.onKeyDown=e=>{var t,i,n,r,s,a;if(u.areShortcutsEnabled()){if(this.hasInteracted=!0,this.shouldHandleCanvasShortcut()&&(null===(i=null===(t=this.editState)||void 0===t?void 0:t.floating)||void 0===i?void 0:i.image)){let t=!1;switch(e.key){case"ArrowLeft":this.editState.layerOffsetX=Math.max(this.editState.layerOffsetX-1,-this.editState.floating.image.width),t=!0;break;case"ArrowUp":this.editState.layerOffsetY=Math.max(this.editState.layerOffsetY-1,-this.editState.floating.image.height),t=!0;break;case"ArrowRight":this.editState.layerOffsetX=Math.min(this.editState.layerOffsetX+1,this.editState.width),t=!0;break;case"ArrowDown":this.editState.layerOffsetY=Math.min(this.editState.layerOffsetY+1,this.editState.height),t=!0}t&&(this.props.dispatchImageEdit(this.editState.toImageState()),e.preventDefault())}if(!e.repeat){switch(!e.ctrlKey&&!e.metaKey||"c"!==e.key&&"v"!==e.key||e.stopPropagation(),(e.ctrlKey||e.metaKey)&&"a"===e.key&&this.shouldHandleCanvasShortcut()&&(this.selectAll(),e.preventDefault()),"Escape"==e.key&&(null===(r=null===(n=this.editState)||void 0===n?void 0:n.floating)||void 0===r?void 0:r.image)&&this.shouldHandleCanvasShortcut()&&(this.cancelSelection(),e.preventDefault()),("Backspace"===e.key||"Delete"===e.key)&&(null===(a=null===(s=this.editState)||void 0===s?void 0:s.floating)||void 0===a?void 0:a.image)&&this.shouldHandleCanvasShortcut()&&(this.deleteSelection(),e.preventDefault()),this.lastTool=this.props.tool,e.keyCode){case 18:this.props.dispatchChangeImageTool(o.ImageEditorTool.ColorSelect),e.preventDefault();break;case 32:this.props.dispatchChangeImageTool(o.ImageEditorTool.Pan);break;default:this.lastTool=null}this.updateCursor(!1,!1)}}},this.onKeyUp=e=>{null!=this.lastTool&&(this.props.dispatchChangeImageTool(this.lastTool),this.lastTool=null,this.updateCursor(!1,!1))},this.onCopy=e=>{var t,i;if(this.props.tool===o.ImageEditorTool.Marquee&&(null===(i=null===(t=this.editState)||void 0===t?void 0:t.floating)||void 0===i?void 0:i.image))if(e.preventDefault(),this.props.isTilemap)e.clipboardData.setData("application/makecode-tilemap",JSON.stringify(a.createTilemapPatchFromFloatingLayer(this.editState,this.props.tilemapState.tileset)));else{const t=pxt.sprite.bitmapToImageLiteral(this.editState.floating.image,"typescript");e.clipboardData.setData("application/makecode-image",t),e.clipboardData.setData("text/plain",t)}},this.onPaste=e=>{if(this.props.isTilemap){const t=e.clipboardData.getData("application/makecode-tilemap");let i;try{i=JSON.parse(t)}catch(e){}if(!(i&&i.map&&i.layers&&i.tiles))return;return e.preventDefault(),void this.applyTilemapPatch(i)}let t=e.clipboardData.getData("application/makecode-image");if(!t){const i=e.clipboardData.getData("text/plain"),n=/img(`|\(""")[\s\da-f.#tngrpoyw]+(`|"""\))/im.exec(i);n&&(t=n[0])}const i=t&&pxt.sprite.imageLiteralToBitmap(t);i&&i.width&&i.height&&(e.preventDefault(),this.props.tool!==o.ImageEditorTool.Marquee&&this.props.dispatchChangeImageTool(o.ImageEditorTool.Marquee),this.editState.setFloatingLayer(i),this.props.dispatchImageEdit(this.editState.toImageState()))},this.preventContextMenu=e=>e.preventDefault()}render(){const e=this.getImageState(),t=!e||e.bitmap.height>e.bitmap.width,i=!this.props.isTilemap&&this.props.tool==o.ImageEditorTool.Marquee;return n.createElement("div",{ref:"canvas-bounds",className:"image-editor-canvas "+(t?"portrait":"landscape"),onContextMenu:this.preventContextMenu},n.createElement("div",{className:"paint-container"},!this.props.lightMode&&n.createElement("canvas",{ref:"paint-surface-bg",className:"paint-surface"}),n.createElement("canvas",{ref:"paint-surface",className:"paint-surface main"}),p.map(((e,t)=>n.createElement("canvas",{ref:`paint-surface-${e.toString()}`,className:"paint-surface overlay "+(this.props.overlayEnabled?"":"hide"),key:t}))),n.createElement("div",{ref:"floating-layer-border",className:"image-editor-floating-layer"}),i&&n.createElement("div",{ref:"floating-layer-nw-corner",className:"image-editor-floating-layer-corner"}),i&&n.createElement("div",{ref:"floating-layer-ne-corner",className:"image-editor-floating-layer-corner"}),i&&n.createElement("div",{ref:"floating-layer-se-corner",className:"image-editor-floating-layer-corner"}),i&&n.createElement("div",{ref:"floating-layer-sw-corner",className:"image-editor-floating-layer-corner"})))}componentDidMount(){document.activeElement instanceof HTMLElement&&document.activeElement.blur(),this.tileCache={},this.cellWidth=this.props.isTilemap?this.props.tilemapState.tileset.tileWidth:1,this.canvas=this.refs["paint-surface"],this.background=this.refs["paint-surface-bg"],this.floatingLayer=this.refs["floating-layer-border"],this.canvasLayers=p.map((e=>this.refs[`paint-surface-${e.toString()}`])),a.bindGestureEvents(this.refs["canvas-bounds"],this);const e=this.refs["canvas-bounds"];e.addEventListener("wheel",(e=>{this.hasInteracted=!0,this.updateZoom(e.deltaY/30,e.clientX,e.clientY),e.preventDefault()})),e.addEventListener("mousemove",(e=>{e.button||(this.hasHover=!0),this.edit||this.updateCursorLocation(e)})),e.addEventListener("mouseout",(e=>{this.edit||this.updateCursorLocation(null)})),document.addEventListener("keydown",this.onKeyDown,!0),document.addEventListener("keyup",this.onKeyUp),document.addEventListener("copy",this.onCopy),document.addEventListener("paste",this.onPaste);const t=this.getImageState();this.editState=l.getEditState(t,this.props.isTilemap,this.props.drawingMode),this.redraw(),this.updateBackground()}componentDidUpdate(){if(!this.edit||!this.editState){const e=this.getImageState();this.editState=l.getEditState(e,this.props.isTilemap,this.props.drawingMode)}if(this.props.isTilemap||(this.tileCache={}),this.cellWidth=this.props.isTilemap?this.props.tilemapState.tileset.tileWidth:1,this.props.zoomDelta||0===this.props.zoomDelta)return 0===this.props.zoomDelta?this.hasInteracted||this.zoomToCanvas():(this.hasInteracted=!0,this.updateZoom(this.props.zoomDelta)),void this.props.dispatchChangeZoom(null);this.redraw(),this.updateBackground()}componentWillUnmount(){this.tileCache={},document.removeEventListener("keydown",this.onKeyDown,!0),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("copy",this.onCopy),document.removeEventListener("paste",this.onPaste)}onClick(e,t){var i,n;this.hasInteracted=!0,this.isPanning()||(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),this.isColorSelect()?this.selectCanvasColor(e,t):(this.updateCursorLocation(e),this.inBounds(this.cursorLocation[0],this.cursorLocation[1])?(this.touchesResize(e.clientX,e.clientY)&&(this.isResizing=!0),this.startEdit(!!t),this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit()):(null===(n=null===(i=this.editState)||void 0===i?void 0:i.floating)||void 0===n?void 0:n.image)&&(this.editState.mergeFloatingLayer(),this.props.dispatchImageEdit(this.editState.toImageState()))))}onDragStart(e,t){this.hasInteracted=!0,this.touchesResize(e.clientX,e.clientY)&&(this.isResizing=!0),this.isPanning()?(this.lastPanX=e.clientX,this.lastPanY=e.clientY,this.updateCursor(!0,!1)):this.isColorSelect()?this.selectCanvasColor(e,t):(this.updateCursorLocation(e),this.startEdit(!!t))}onDragMove(e){if(this.isPanning()&&null!=this.lastPanX&&null!=this.lastPanY)this.panX+=this.lastPanX-e.clientX,this.panY+=this.lastPanY-e.clientY,this.lastPanX=e.clientX,this.lastPanY=e.clientY,this.updateCursor(!0,!1);else{if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1])}}onDragEnd(e){if(this.isPanning()&&null!=this.lastPanX&&null!=this.lastPanY)this.panX+=this.lastPanX-e.clientX,this.panY+=this.lastPanY-e.clientY,this.lastPanX=void 0,this.lastPanY=void 0,this.updateCursor(!1,!1);else if(this.isResizing){if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit(!1),this.updateCursor(!1,!1)}else{if(!this.edit)return;this.updateCursorLocation(e)&&this.updateEdit(this.cursorLocation[0],this.cursorLocation[1]),this.commitEdit()}this.isResizing=!1}updateCursorLocation(e){if(!e)return this.cursorLocation&&(this.cursorLocation=null,this.props.dispatchChangeCursorLocation(null),this.edit||this.redraw()),!1;if(this.canvas){const t=this.canvas.getBoundingClientRect(),i=Math.floor((e.clientX-t.left)/t.width*this.imageWidth),n=Math.floor((e.clientY-t.top)/t.height*this.imageHeight);return!(this.cursorLocation&&i===this.cursorLocation[0]&&n===this.cursorLocation[1]||(this.cursorLocation=[i,n,e.clientX,e.clientY],this.hasHover&&this.props.dispatchChangeCursorLocation(this.cursorLocation),this.edit||this.redraw(),this.updateCursor(!!this.edit,this.editState.inFloatingLayer(i,n)),0))}return this.cursorLocation=[0,0,e.clientX,e.clientY],!1}updateCursor(e,t){const{tool:i}=this.props,n=l.tools.find((e=>e.tool===i));n?t?e?this.updateCursorCore(n.downLayerCursor||n.hoverLayerCursor||n.downCursor||n.hoverCursor):this.updateCursorCore(n.hoverLayerCursor||n.hoverCursor):e?this.updateCursorCore(n.downCursor||n.hoverCursor):this.updateCursorCore(n.hoverCursor):this.updateCursorCore(l.ToolCursor.Default)}updateCursorCore(e){this.cursor=e||l.ToolCursor.Default,this.updateBackground()}startEdit(e){const{tool:t,toolWidth:i,selectedColor:n,backgroundColor:r,drawingMode:s}=this.props,[a,c]=this.cursorLocation;if(this.inBounds(a,c)||this.isResizing){let a=s==o.TileDrawingMode.Wall?2:e?r:n;this.edit=l.getEdit(t,this.editState,a,i),this.edit.originalImage=this.originalImage,this.edit.start(this.cursorLocation[0],this.cursorLocation[1],this.cursorLocation[2],this.cursorLocation[3],this.editState)}}updateEdit(e,t){this.edit&&(this.edit.inBounds(e,t)||this.isResizing)&&(this.edit.update(e,t),this.redraw())}commitEdit(e=!0){const{dispatchImageEdit:t}=this.props,i=this.getImageState();this.edit&&(this.editState=l.getEditState(i,this.props.isTilemap,this.props.drawingMode),this.edit.doEdit(this.editState),this.originalImage=e?void 0:this.edit.originalImage,this.edit=void 0,t(this.editState.toImageState()))}redraw(){const{prevFrame:e,onionSkinEnabled:t,selectedColor:i,toolWidth:n,drawingMode:r,tool:s}=this.props,a=this.getImageState(),c=r==o.TileDrawingMode.Wall?2:i;let u=!1;if(this.canvas){if(this.imageWidth=a.bitmap.width,this.imageHeight=a.bitmap.height,u=this.canvas.width!=a.bitmap.width*this.cellWidth||this.canvas.height!=a.bitmap.height*this.cellWidth,this.canvas.width=a.bitmap.width*this.cellWidth,this.canvas.height=a.bitmap.height*this.cellWidth,this.canvasLayers.forEach((e=>{e.width=this.canvas.width/this.cellWidth,e.height=this.canvas.height/this.cellWidth})),t&&e){const t=l.getEditState(e,this.props.isTilemap,r),i=this.canvas.getContext("2d");i.globalAlpha=.5,this.drawImage(t.image),t.floating&&t.floating.image&&this.drawImage(t.floating.image,t.layerOffsetX,t.layerOffsetY,!0),i.globalAlpha=1}if(this.edit){const i=this.editState.copy();i.setActiveLayer(r),this.edit.doEdit(i),this.drawImage(i.image,0,0,!(!t||!e)),this.drawOverlayLayers(i.overlayLayers),this.redrawFloatingLayer(i)}else if(this.drawImage(this.editState.image,0,0,!(!t||!e)),this.drawOverlayLayers(this.editState.overlayLayers),this.redrawFloatingLayer(this.editState),this.cursorLocation&&this.shouldDrawCursor()){const e=s===o.ImageEditorTool.Erase?0:c;this.drawCursor(this.cursorLocation[0]-(n>>1),this.cursorLocation[1]-(n>>1),n,e)}if(this.background&&(this.background.width!=this.canvas.width<<1||this.background.height!=this.canvas.height<<1)){this.background.width=this.canvas.width<<1,this.background.height=this.canvas.height<<1;const e=this.background.getContext("2d");e.imageSmoothingEnabled=!1,e.fillStyle="#aeaeae",e.fillRect(0,0,this.background.width,this.background.height),e.fillStyle="#dedede";const t=this.imageHeight<<1,i=this.imageWidth<<1;for(let n=0;n<i;n++)for(let i=0;i<t;i++)n+i&1&&e.fillRect(n*this.cellWidth,i*this.cellWidth,this.cellWidth,this.cellWidth)}}u&&this.zoomToCanvas()}drawImage(e,t=0,i=0,n=!1,r=!this.props.lightMode){this.props.isTilemap?this.drawTilemap(e,t,i,n,r):this.drawBitmap(e,t,i,n,r)}redrawFloatingLayer(e,t=!1){const i=this.refs["floating-layer-border"],n=this.refs["floating-layer-nw-corner"],r=this.refs["floating-layer-ne-corner"],o=this.refs["floating-layer-se-corner"],s=this.refs["floating-layer-sw-corner"],a=[n,r,o,s];if(e.floating&&e.floating.image){t||(this.drawImage(e.floating.image,e.layerOffsetX,e.layerOffsetY,!0),e.floating.overlayLayers&&this.drawOverlayLayers(e.floating.overlayLayers,e.layerOffsetX,e.layerOffsetY));const l=this.canvas.getBoundingClientRect(),c=Math.max(e.layerOffsetX,0),u=Math.max(e.layerOffsetY,0),d=Math.min(e.layerOffsetX+e.floating.image.width,e.width),p=Math.min(e.layerOffsetY+e.floating.image.height,e.height),h=l.width/e.width,f=l.height/e.height;i.style.display="",(d-c<1||p-u<1)&&(i.style.display="none");const m=-this.panX+h*c,g=-this.panY+f*u,b=h*(d-c),v=f*(p-u);if(i.style.left=m+"px",i.style.top=g+"px",i.style.width=b+"px",i.style.height=v+"px",i.style.borderLeft=e.layerOffsetX>=0?"":"none",i.style.borderTop=e.layerOffsetY>=0?"":"none",i.style.borderRight=e.layerOffsetX+e.floating.image.width<=e.width?"":"none",i.style.borderBottom=e.layerOffsetY+e.floating.image.height<=e.height?"":"none",null!=n){const e=16,t=3;this.props.isTilemap||(a.forEach((i=>{i.style.display="",i.style.width=e+"px",i.style.height=e+"px",i.style.border=t+"px solid black",i.style.position="absolute",i.style.backgroundColor="white"})),n.style.left=m-e+"px",n.style.top=g-e+"px",n.style.cursor="nw-resize",r.style.left=m+b+"px",r.style.top=g-e+"px",r.style.cursor="ne-resize",o.style.left=m+b+"px",o.style.top=g+v+"px",o.style.cursor="se-resize",s.style.left=m-e+"px",s.style.top=g+v+"px",s.style.cursor="sw-resize")}}else i.style.display="none",a.forEach((e=>{e&&(e.style.display="none")}))}drawOverlayLayers(e,t=0,i=0,n=!this.props.lightMode){e&&e.forEach(((e,r)=>{this.drawBitmap(e,t,i,!0,n,this.canvasLayers[r])}))}drawBitmap(e,t=0,i=0,n=!1,r=!this.props.lightMode,o=this.canvas){if(!this.colors){this.colors=new Uint8ClampedArray(4*this.props.colors.length);const e=pxt.sprite.colorStringToRGB(d.LIGHT_MODE_TRANSPARENT);this.colors[0]=e[0],this.colors[1]=e[1],this.colors[2]=e[2];for(let e=1;e<this.props.colors.length;e++){const[t,i,n]=pxt.sprite.colorStringToRGB(this.props.colors[e]),r=e<<2;this.colors[r]=t,this.colors[r+1]=i,this.colors[r+2]=n,this.colors[r+3]=255}}this.colors[3]=r?0:255;const s=o.getContext("2d"),a=n?s.getImageData(0,0,o.width,o.height):new ImageData(o.width,o.height),l=this.colors.slice();for(let e=0;e<l.length;e+=4)l[e+3]=l[e+3]*s.globalAlpha|0;for(let r=0;r<e.height&&!(i+r>=o.height);r++)if(!(i+r<0))for(let s=0;s<e.width;s++){if(t+s>=o.width||t+s<0)continue;const c=(t+s<<2)+((i+r)*o.width<<2),u=e.get(s,r)<<2;!u&&n||(a.data[c]=l[u],a.data[c+1]=l[u+1],a.data[c+2]=l[u+2],a.data[c+3]=l[u+3])}o.getContext("2d").putImageData(a,0,0)}generateTile(e,t){if(!t.tiles[e])return null;const i=document.createElement("canvas");return i.width=t.tileWidth,i.height=t.tileWidth,this.drawBitmap(pxt.sprite.Bitmap.fromData(t.tiles[e].bitmap),0,0,!1,!this.props.lightMode,i),this.tileCache[t.tiles[e].id]=i,i}drawTilemap(e,t=0,i=0,n=!1,r=!this.props.lightMode,o=this.canvas){const{tilemapState:{tileset:s}}=this.props,a=o.getContext("2d");let l,c;this.tileCacheRevision!==this.props.tilesetRevision&&(this.tileCache={},this.tileCacheRevision=this.props.tilesetRevision),a.imageSmoothingEnabled=!1,a.fillStyle=d.LIGHT_MODE_TRANSPARENT;for(let o=0;o<e.width;o++)for(let u=0;u<e.height;u++)if((l=e.get(o,u))&&l<s.tiles.length){if((c=this.tileCache[s.tiles[l].id])||(c=this.generateTile(l,s)),!c)continue;a.drawImage(c,(o+t)*this.cellWidth,(u+i)*this.cellWidth)}else n||(r?a.clearRect((o+t)*this.cellWidth,(u+i)*this.cellWidth,this.cellWidth,this.cellWidth):a.fillRect((o+t)*this.cellWidth,(u+i)*this.cellWidth,this.cellWidth,this.cellWidth))}drawCursor(e,t,i,n){const r=this.props.isTilemap&&this.props.drawingMode===o.TileDrawingMode.Wall,s=(r?this.canvasLayers[0]:this.canvas).getContext("2d");if(s.imageSmoothingEnabled=!1,n&&-1!==n)if(this.props.isTilemap&&!r){if(n>=this.props.tilemapState.tileset.tiles.length)return;let r=this.tileCache[this.props.tilemapState.tileset.tiles[n].id];if(r||(r=this.generateTile(n,this.props.tilemapState.tileset)),!r)return;for(let n=0;n<i;n++)for(let o=0;o<i;o++)s.drawImage(r,(e+n)*this.cellWidth,(t+o)*this.cellWidth)}else r?(s.fillStyle=this.props.colors[n],s.fillRect(e,t,1,1)):(s.fillStyle=this.props.colors[n],s.fillRect(e*this.cellWidth,t*this.cellWidth,i*this.cellWidth,i*this.cellWidth));else this.props.lightMode?(s.fillStyle=d.LIGHT_MODE_TRANSPARENT,s.fillRect(e*this.cellWidth,t*this.cellWidth,i*this.cellWidth,i*this.cellWidth)):s.clearRect(e*this.cellWidth,t*this.cellWidth,i*this.cellWidth,i*this.cellWidth)}updateBackground(){this.refs["canvas-bounds"].style.cursor=this.cursor,this.canvas.style.cursor=this.cursor,this.updateZoom(0)}updateZoom(e,t,i){const n=this.refs["canvas-bounds"];if(this.canvas&&n){const r=n.getBoundingClientRect();t=void 0===t?r.left+(r.width>>1):t,i=void 0===i?r.top+(r.height>>1):i;const{canvasX:o,canvasY:s}=this.clientToCanvas(t,i,r);this.zoom=Math.max(this.zoom+e,2.5);const a=this.getCanvasUnit(r);if(a){const{canvasX:e,canvasY:n}=this.clientToCanvas(t,i,r);if(isNaN(e)||isNaN(n)||isNaN(o)||isNaN(s))return;this.panX+=(o-e)*a,this.panY+=(s-n)*a}this.applyZoom()}}getCenteredPan(){let[e,t]=[0,0];const i=this.refs["canvas-bounds"].getBoundingClientRect(),n=this.canvas.getBoundingClientRect();return n.width<i.width&&(e=-((i.width>>1)-(n.width>>1))),n.height<i.height&&(t=-((i.height>>1)-(n.height>>1))),[e,t]}zoomToCanvas(){this.zoom=10;const e=this.refs["canvas-bounds"];this.applyZoom(),this.canvas&&e&&([this.panX,this.panY]=this.getCenteredPan()),this.applyZoom()}applyZoom(e){const t=this.refs["canvas-bounds"];if(this.canvas&&t){e=e||t.getBoundingClientRect();const i=this.getCanvasUnit(e);if(0===i){if(this.waitingToZoom)return;return this.waitingToZoom=!0,void requestAnimationFrame((()=>{this.waitingToZoom&&(this.waitingToZoom=!1,this.applyZoom())}))}this.waitingToZoom=!1;const n=i*this.imageWidth,r=i*this.imageHeight,o=this.imageWidth>1&&this.imageHeight>1?2*i:i>>1;this.hasInteracted||([this.panX,this.panY]=this.getCenteredPan()),this.panX=Math.max(Math.min(this.panX,n-o),-(e.width-o)),this.panY=Math.max(Math.min(this.panY,r-o),-(e.height-o)),this.canvas.style.position="fixed",this.canvas.style.width=`${n}px`,this.canvas.style.height=`${r}px`,this.canvas.style.left=-this.panX+"px",this.canvas.style.top=-this.panY+"px",this.canvas.style.clipPath=`polygon(${this.panX}px ${this.panY}px, ${this.panX+e.width}px ${this.panY}px, ${this.panX+e.width}px ${this.panY+e.height}px, ${this.panX}px ${this.panY+e.height}px)`,this.background&&this.cloneCanvasStyle(this.canvas,this.background),this.canvasLayers.forEach((e=>this.cloneCanvasStyle(this.canvas,e))),this.redrawFloatingLayer(this.editState,!0)}}selectCanvasColor(e,t){const i=this.refs["canvas-bounds"].getBoundingClientRect();let n,{canvasX:r,canvasY:o}=this.clientToCanvas(e.clientX,e.clientY,i);r=Math.floor(r),o=Math.floor(o),this.editState.inFloatingLayer(r,o)&&(n=this.editState.floating.image.get(r-this.editState.layerOffsetX,o-this.editState.layerOffsetY)),n||(n=this.editState.image.get(r,o)),t?this.props.dispatchChangeBackgroundColor(n):this.props.dispatchChangeSelectedColor(n)}selectAll(){this.props.tool!==o.ImageEditorTool.Marquee&&this.props.dispatchChangeImageTool(o.ImageEditorTool.Marquee),this.editState.mergeFloatingLayer(),this.editState.copyToLayer(0,0,this.imageWidth,this.imageHeight,!0),this.props.dispatchImageEdit(this.editState.toImageState())}cancelSelection(){this.editState.mergeFloatingLayer(),this.props.dispatchImageEdit(this.editState.toImageState())}deleteSelection(){this.editState.floating=null,this.props.dispatchImageEdit(this.editState.toImageState())}cloneCanvasStyle(e,t){t.style.position=e.style.position,t.style.width=e.style.width,t.style.height=e.style.height,t.style.left=e.style.left,t.style.top=e.style.top,t.style.clipPath=e.style.clipPath}clientToCanvas(e,t,i){const n=this.getCanvasUnit(i);return{canvasX:(e-i.left+this.panX)/n,canvasY:(t-i.top+this.panY)/n}}getCanvasUnit(e){const t=e.width/e.height,i=this.imageWidth/this.imageHeight,n=Math.pow(this.zoom/10,2);return t>i?n*(e.height/this.imageHeight):n*(e.width/this.imageWidth)}inBounds(e,t){return e>=0&&e<this.imageWidth&&t>=0&&t<this.imageHeight}isPanning(){return this.props.tool===o.ImageEditorTool.Pan}touchesResize(e,t){const i=document.querySelectorAll(":hover");for(let e=0;e<i.length;e++)if("image-editor-floating-layer-corner"==i[e].className)return!0;return!1}isColorSelect(){return this.props.tool===o.ImageEditorTool.ColorSelect}shouldHandleCanvasShortcut(){return!(this.props.suppressShortcuts||document.activeElement instanceof HTMLInputElement)}shouldDrawCursor(){if(!this.hasHover)return!1;switch(this.props.tool){case o.ImageEditorTool.Fill:case o.ImageEditorTool.Marquee:case o.ImageEditorTool.Pan:case o.ImageEditorTool.ColorSelect:return!1;default:return!0}}getImageState(){return this.props.isTilemap?this.props.tilemapState.tilemap:this.props.imageState}applyTilemapPatch(e){const{tilemapState:t,dispatchCreateNewTile:i,gallery:n,backgroundColor:r}=this.props,{tileset:o}=t,s=pxt.sprite.tilemapLiteralToTilemap(e.map);if(!s||!s.width||!s.height)return;const a=e.tiles.map((e=>pxt.sprite.getBitmapFromJResURL(`data:image/x-mkcd-f4;base64,${e}`))),l=e.layers.map((e=>pxt.sprite.getBitmapFromJResURL(`data:image/x-mkcd-f4;base64,${e}`))),u=[];let d=o.tiles.length;for(const e of a){const t=o.tiles.findIndex((t=>e.equals(pxt.sprite.Bitmap.fromData(t.bitmap))));if(t>=0)u.push(t);else{if(n){const t=n.find((t=>e.equals(pxt.sprite.Bitmap.fromData(t.bitmap))));if(t){i(null,o.tiles.length,r,t.qualifiedName),u.push(d),d++;continue}}i(c.createTile(e.data()),o.tiles.length,r),u.push(d),d++}}this.editState.mergeFloatingLayer();const p=new pxt.sprite.Tilemap(s.width,s.height);for(let e=0;e<p.width;e++)for(let t=0;t<p.height;t++)p.set(e,t,u[s.get(e,t)]);this.editState.floating={image:p,overlayLayers:l},this.editState.layerOffsetX=0,this.editState.layerOffsetY=0,this.props.dispatchImageEdit(this.editState.toImageState())}}i.ImageCanvasImpl=h;const f={dispatchImageEdit:s.dispatchImageEdit,dispatchChangeCursorLocation:s.dispatchChangeCursorLocation,dispatchChangeZoom:s.dispatchChangeZoom,dispatchChangeImageTool:s.dispatchChangeImageTool,dispatchChangeSelectedColor:s.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:s.dispatchChangeBackgroundColor,dispatchCreateNewTile:s.dispatchCreateNewTile};i.ImageCanvas=r.connect((function({store:{present:e},editor:t},i){if(t.isTilemap){let i=e;return i?{selectedColor:t.selectedColor,tilemapState:i,tool:t.tool,toolWidth:t.cursorSize,zoomDelta:t.zoomDelta,onionSkinEnabled:!1,overlayEnabled:t.overlayEnabled,backgroundColor:t.backgroundColor,colors:i.colors,isTilemap:t.isTilemap,drawingMode:t.drawingMode,gallery:t.tileGallery,tilesetRevision:t.tilesetRevision}:{}}let n=e;return n?{selectedColor:t.selectedColor,colors:n.colors,imageState:n.frames[n.currentFrame],tool:t.tool,toolWidth:t.cursorSize,zoomDelta:t.zoomDelta,onionSkinEnabled:t.onionSkinEnabled,backgroundColor:t.backgroundColor,prevFrame:n.frames[n.currentFrame-1],isTilemap:t.isTilemap,tilesetRevision:t.tilesetRevision}:{}}),f)(h)},{"../../assets":18,"./ImageEditor":38,"./actions/dispatch":45,"./keyboardShortcuts":47,"./store/imageReducer":49,"./toolDefinitions":53,"./util":54,react:335,"react-redux":314}],38:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ImageEditor=i.LIGHT_MODE_TRANSPARENT=void 0;const n=e("react"),r=e("react-redux"),o=e("./store/imageStore"),s=e("./SideBar"),a=e("./BottomBar"),l=e("./TopBar"),c=e("./ImageCanvas"),u=e("./Alert"),d=e("./Timeline"),p=e("./keyboardShortcuts"),h=e("./actions/dispatch"),f=e("./util"),m=e("../../assets");i.LIGHT_MODE_TRANSPARENT="#dedede";class g extends n.Component{constructor(e){super(e),this.onStoreChange=()=>{this.props.onChange&&this.props.onChange(this.props.singleFrame?pxt.sprite.bitmapToImageLiteral(this.getCurrentFrame(),"typescript"):"");const e=this.getStore(),t=e.getState();if(p.setStore(e),t.editor&&this.setState({alert:t.editor.alert}),!!t.editor.editingTile!=!!this.state.editingTile)if(t.editor.editingTile){const e=t.editor.editingTile.tilesetIndex;if(e){const i=t.store.present.tileset.tiles[e];this.setState({editingTile:!0,tileToEdit:i})}else{const e=t.store.present.tileset.tileWidth,i=m.createNewImageAsset("tile",e,e,lf("myTile"));this.setState({editingTile:!0,tileToEdit:i})}this.props.onTileEditorOpenClose&&this.props.onTileEditorOpenClose(!0)}else this.setState({editingTile:!1}),this.props.onTileEditorOpenClose&&this.props.onTileEditorOpenClose(!1)},this.onDoneClick=()=>{this.props.onDoneClicked&&this.props.onDoneClicked(this.getAsset())},this.onTileEditorFinished=e=>{const t=this.getStore().getState().editor.editingTile;e.isProjectTile=!0,this.dispatchOnStore(h.dispatchCloseTileEditor(e,t.tilesetIndex))},this.state={editingTile:!1}}componentDidMount(){p.addKeyListener(),this.props.asset&&this.openAsset(this.props.asset),this.unsubscribeChangeListener=this.getStore().subscribe(this.onStoreChange),this.onResize()}componentWillUnmount(){this.props.nested||p.removeKeyListener(),this.unsubscribeChangeListener&&this.unsubscribeChangeListener()}render(){const{singleFrame:e,lightMode:t}=this.props,i=this.getStore(),{tileToEdit:p,editingTile:h,alert:f}=this.state,m="Animation"===i.getState().store.present.kind;return n.createElement("div",{className:"image-editor-outer"},n.createElement(r.Provider,{store:i},n.createElement("div",{className:"image-editor "+(h?"editing-tile":"")},n.createElement(l.TopBar,{singleFrame:e}),n.createElement("div",{className:"image-editor-content"},n.createElement(s.SideBar,{lightMode:t}),n.createElement(c.ImageCanvas,{suppressShortcuts:h,lightMode:t}),m&&!e?n.createElement(d.Timeline,null):void 0),n.createElement(a.BottomBar,{singleFrame:e,onDoneClick:this.onDoneClick}),f&&f.title&&n.createElement(u.Alert,{title:f.title,text:f.text,options:f.options}))),h&&n.createElement(g,{store:o.tileEditorStore,ref:"nested-image-editor",onDoneClicked:this.onTileEditorFinished,asset:p,singleFrame:!0,nested:!0}))}openAsset(e,t,i=!1){this.dispatchOnStore(h.dispatchOpenAsset(e,i,t)),e.meta.displayName?this.dispatchOnStore(h.dispatchChangeAssetName(e.meta.displayName)):i&&this.dispatchOnStore(h.dispatchChangeAssetName(""))}openGalleryAsset(e){const t=this.getAsset(),i=this.getStore().getState().store.present.frames;switch(t.type){case"animation":switch(e.type){case"image":case"tile":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.bitmap),1===i.length);break;case"animation":this.dispatchOnStore(h.dispatchSetFrames(e.frames.map((e=>({bitmap:e})))))}break;case"image":case"tile":switch(e.type){case"image":case"tile":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.bitmap),!0);break;case"animation":this.setCurrentFrame(pxt.sprite.Bitmap.fromData(e.frames[0]),!0)}}}onResize(){this.dispatchOnStore(h.dispatchChangeZoom(0))}getCurrentFrame(){const e=this.getStore().getState().store.present,t=e.frames[e.currentFrame];return f.imageStateToBitmap(t)}getAsset(){switch(this.getStore().getState().store.present.asset.type){case"tile":return this.getTile();case"animation":return this.getAnimation();case"tilemap":return this.getTilemap();default:return this.getImage()}}getImage(){var e;const t=this.getStore().getState().store.present,i=this.getCurrentFrame().data(),n=t.asset?Object.assign({},t.asset.meta):{};return{id:null===(e=t.asset)||void 0===e?void 0:e.id,internalID:t.asset?t.asset.internalID:m.getNewInternalID(),type:"image",bitmap:i,jresData:pxt.sprite.base64EncodeBitmap(i),meta:n}}getTile(){var e;const t=this.getStore().getState().store.present,i=this.getCurrentFrame().data(),n=t.asset?Object.assign({},t.asset.meta):{};return{id:null===(e=t.asset)||void 0===e?void 0:e.id,internalID:t.asset?t.asset.internalID:m.getNewInternalID(),isProjectTile:!0,type:"tile",bitmap:i,jresData:pxt.sprite.base64EncodeBitmap(i),meta:n}}getAnimation(){var e;const t=this.getStore().getState().store.present,i=t.asset?Object.assign({},t.asset.meta):{};return{id:null===(e=t.asset)||void 0===e?void 0:e.id,internalID:t.asset?t.asset.internalID:m.getNewInternalID(),type:"animation",interval:t.interval,frames:t.frames.map((e=>f.imageStateToBitmap(e).data())),meta:i}}getTilemap(){var e;const t=this.getStore().getState(),i=t.store.present,{floating:n,overlayLayers:r,layerOffsetX:o,layerOffsetY:s}=i.tilemap,a=f.applyBitmapData(r[0],n&&n.overlayLayers&&n.overlayLayers[0],o,s),l=new pxt.sprite.TilemapData(f.imageStateToTilemap(i.tilemap),i.tileset,a);l.deletedTiles=t.editor.deletedTiles,l.editedTiles=t.editor.editedTiles;const c=i.asset?Object.assign({},i.asset.meta):{};return{id:null===(e=i.asset)||void 0===e?void 0:e.id,internalID:i.asset?i.asset.internalID:m.getNewInternalID(),type:"tilemap",data:l,meta:c}}getPersistentData(){const e=this.getStore().getState();return{editor:e.editor,past:e.store.past}}restorePersistentData(e){e&&this.dispatchOnStore(h.dispatchSetInitialState(e.editor,e.past))}setCurrentFrame(e,t){if(!t){const t=this.getStore().getState().store.present.frames[0];if(e.width!==t.bitmap.width||e.height!==t.bitmap.height){const i=[Math.max(e.width,t.bitmap.width),Math.max(e.height,t.bitmap.height)];t.bitmap.width===i[0]&&t.bitmap.height===i[1]||this.dispatchOnStore(h.dispatchChangeImageDimensions(i)),e=(e=e.copy()).resize(i[0],i[1])}}this.dispatchOnStore(h.dispatchImageEdit({bitmap:e.data()}))}openInTileEditor(e){this.refs["nested-image-editor"].setCurrentFrame(e,!1)}disableResize(){this.dispatchOnStore(h.dispatchDisableResize())}closeNestedEditor(){var e;this.state.editingTile&&(null===(e=this.refs["nested-image-editor"])||void 0===e||e.onDoneClick())}getStore(){return this.props.store||o.mainStore}dispatchOnStore(e){this.getStore().dispatch(e)}}i.ImageEditor=g},{"../../assets":18,"./Alert":32,"./BottomBar":33,"./ImageCanvas":37,"./SideBar":40,"./Timeline":41,"./TopBar":44,"./actions/dispatch":45,"./keyboardShortcuts":47,"./store/imageStore":50,"./util":54,react:335,"react-redux":314}],39:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Pivot=void 0;const n=e("react"),r=e("./util");class o extends n.Component{constructor(e){super(e),this.handlers=[],this.state={open:!1}}componentWillUnmount(){this.handlers=null}render(){const{options:e,selected:t}=this.props,i=e[t];return n.createElement("div",{className:"image-editor-pivot-outer"},e.map(((e,t)=>n.createElement("div",{role:"tab",key:e.id,className:"image-editor-pivot-option "+(e===i?"selected":""),tabIndex:0,onClick:this.clickHandler(t),onKeyDown:r.fireClickOnlyOnEnter},e.text))))}clickHandler(e){if(!this.handlers[e]){const{onChange:t,options:i}=this.props;this.handlers[e]=()=>{this.setState({open:!1}),t(i[e],e)}}return this.handlers[e]}}i.Pivot=o},{"./util":54,react:335}],40:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SideBar=i.SideBarImpl=void 0;const n=e("react"),r=e("react-redux"),o=e("./toolDefinitions"),s=e("./Button"),a=e("./actions/dispatch"),l=e("./sprite/Palette"),c=e("./tilemap/TilePalette"),u=e("./tilemap/Minimap");class d extends n.Component{constructor(){super(...arguments),this.handlers=[]}render(){const{selectedTool:e,isTilemap:t,lightMode:i}=this.props;return n.createElement("div",{className:"image-editor-sidebar "+(t?"tilemap":"")},t&&n.createElement("div",{className:"image-editor-tilemap-minimap"},n.createElement(u.Minimap,{lightMode:i})),n.createElement("div",{className:"image-editor-tool-buttons"},o.tools.filter((e=>!e.hiddenTool)).map((t=>n.createElement(s.IconButton,{key:t.tool,iconClass:t.iconClass,toggle:e!=t.tool,title:t.title,onClick:this.clickHandler(t.tool)})))),n.createElement("div",{className:"image-editor-palette"},t?n.createElement(c.TilePalette,null):n.createElement(l.Palette,null)))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>this.props.dispatchChangeImageTool(e)),this.handlers[e]}}i.SideBarImpl=d;const p={dispatchChangeImageTool:a.dispatchChangeImageTool};i.SideBar=r.connect((function({editor:e},t){return e?{isTilemap:e.isTilemap,selectedTool:e.tool}:{}}),p)(d)},{"./Button":34,"./actions/dispatch":45,"./sprite/Palette":48,"./tilemap/Minimap":51,"./tilemap/TilePalette":52,"./toolDefinitions":53,react:335,"react-redux":314}],41:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Timeline=i.TimelineImpl=void 0;const n=e("react"),r=e("react-redux"),o=e("./actions/dispatch"),s=e("./TimelineFrame"),a=e("./util");class l extends n.Component{constructor(e){super(e),this.handlers=[],this.scrollOffset=0,this.dragEnd=!1,this.duplicateFrame=()=>{const{currentFrame:e,dispatchDuplicateFrame:t}=this.props;t(e)},this.deleteFrame=()=>{const{currentFrame:e,dispatchDeleteFrame:t}=this.props;t(e)},this.newFrame=()=>{const{dispatchNewFrame:e}=this.props;this.dragEnd?this.dragEnd=!1:e()},this.state={}}render(){const{frames:e,colors:t,currentFrame:i,interval:r,previewAnimating:o}=this.props,{isMovingFrame:a,dropPreviewIndex:l}=this.state;let c,u=e.slice();return a&&(c=e[i],u.splice(i,1),u.splice(l,0,null)),n.createElement("div",{className:"image-editor-timeline "+(pxt.BrowserUtils.isEdge()?"edge":"")},n.createElement("div",{className:"image-editor-timeline-preview"},n.createElement(s.TimelineFrame,{frames:o?e:[e[i]],colors:t,interval:r,animating:!0})),n.createElement("div",{className:"image-editor-timeline-frames-outer"},n.createElement("div",{className:"image-editor-timeline-frames",ref:"frame-scroller-ref"},u.map(((e,r)=>{const o=!a&&r===i;return e?n.createElement("div",{className:"image-editor-timeline-frame "+(o?"active":""),key:r,role:"button",onClick:this.clickHandler(r)},n.createElement(s.TimelineFrame,{frames:[e],colors:t,showActions:o,duplicateFrame:this.duplicateFrame,deleteFrame:this.deleteFrame})):n.createElement("div",{className:"image-editor-timeline-frame drop-marker",key:r})})),c&&n.createElement("div",{ref:"floating-frame",className:"image-editor-timeline-frame dragging"},n.createElement(s.TimelineFrame,{frames:[c],colors:t,duplicateFrame:this.duplicateFrame,deleteFrame:this.deleteFrame})),n.createElement("div",{className:"image-editor-timeline-frame collapsed",role:"button",onClick:this.newFrame},n.createElement("span",{className:"ms-Icon ms-Icon--Add"})))))}componentDidMount(){let e;this.frameScroller=this.refs["frame-scroller-ref"];let t=!1;a.bindGestureEvents(this.frameScroller,{onClick:e=>{this.dragEnd=!1},onDragStart:i=>{e=i.clientY,pxt.BrowserUtils.addClass(this.frameScroller,"scrolling");const n=this.frameScroller.getBoundingClientRect(),r=i.clientY-n.top,o=this.frameScroller.firstElementChild.getBoundingClientRect().height,s=Math.floor(r/o);t=s!==this.props.currentFrame},onDragMove:i=>{if(t){this.scrollOffset-=e-i.clientY,e=i.clientY;try{const e=this.frameScroller.getBoundingClientRect(),t=this.frameScroller.parentElement.getBoundingClientRect();e.height>t.height?this.scrollOffset=Math.max(Math.min(this.scrollOffset,0),t.height-e.height-15):this.scrollOffset=0,this.frameScroller.parentElement.scrollTop=-this.scrollOffset}catch(e){}}else this.updateDragDrop(i)},onDragEnd:()=>{if(e=null,pxt.BrowserUtils.removeClass(this.frameScroller,"scrolling"),this.dragEnd=!0,this.state.isMovingFrame){const{dispatchMoveFrame:e,currentFrame:t}=this.props;e(t,this.state.dropPreviewIndex),this.setState({isMovingFrame:!1})}}}),this.frameScroller.addEventListener("wheel",(e=>{this.scrollOffset-=e.deltaY;try{const e=this.frameScroller.getBoundingClientRect(),t=this.frameScroller.parentElement.getBoundingClientRect();e.height>t.height?this.scrollOffset=Math.max(Math.min(this.scrollOffset,0),t.height-e.height-15):this.scrollOffset=0,this.frameScroller.parentElement.scrollTop=-this.scrollOffset}catch(e){}}))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=()=>{const{currentFrame:t,dispatchChangeCurrentFrame:i}=this.props;this.dragEnd?this.dragEnd=!1:e!=t&&i(e)}),this.handlers[e]}updateDragDrop(e){const t=this.frameScroller.getBoundingClientRect(),i=e.clientY-t.top,n=this.frameScroller.firstElementChild.getBoundingClientRect().height,r=Math.floor(i/n);this.state.isMovingFrame?this.refs["floating-frame"]&&(this.refs["floating-frame"].style.top=i+"px",this.setState({dropPreviewIndex:r})):this.setState({isMovingFrame:!0,dropPreviewIndex:this.props.currentFrame})}}i.TimelineImpl=l;const c={dispatchDuplicateFrame:o.dispatchDuplicateFrame,dispatchDeleteFrame:o.dispatchDeleteFrame,dispatchChangeCurrentFrame:o.dispatchChangeCurrentFrame,dispatchNewFrame:o.dispatchNewFrame,dispatchMoveFrame:o.dispatchMoveFrame};i.Timeline=r.connect((function({store:{present:e},editor:t},i){let n=e;return n?{frames:n.frames,currentFrame:n.currentFrame,colors:n.colors,interval:n.interval,previewAnimating:t.previewAnimating}:{}}),c)(l)},{"./TimelineFrame":42,"./actions/dispatch":45,"./util":54,react:335,"react-redux":314}],42:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TimelineFrame=void 0;const n=e("react"),r=e("./Button"),o=pxt.BrowserUtils.isEdge()?25:1;class s extends n.Component{constructor(e){super(e),this.state={index:0}}render(){const{frames:e,animating:t,showActions:i,duplicateFrame:o,deleteFrame:s}=this.props,a=e[t?Math.min(Math.max(0,this.state.index),e.length-1):0],l=a.bitmap.height>a.bitmap.width;return n.createElement("div",{className:"timeline-frame-outer "+(l?"portrait":"landscape")},n.createElement("div",{className:"timeline-frame-spacer"}),n.createElement("canvas",{ref:"preview-canvas"}),n.createElement("div",{className:"timeline-frame-spacer"}),i&&n.createElement("div",{className:"timeline-frame-actions"},n.createElement(r.IconButton,{iconClass:"ms-Icon ms-Icon--Copy",title:lf("Duplicate Current Frame"),onClick:o}),n.createElement(r.IconButton,{iconClass:"ms-Icon ms-Icon--Delete",title:lf("Delete Current Frame"),onClick:s})))}componentDidMount(){this.canvas=this.refs["preview-canvas"],this.redraw(),this.updateAnimation()}componentDidUpdate(){this.redraw(),this.updateAnimation()}componentWillUnmount(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=void 0}redraw(){if(!this.canvas)return;const{animating:e,frames:t}=this.props,i=t[e?Math.min(Math.max(0,this.state.index),t.length-1):0];this.canvas.height=i.bitmap.height*o,this.canvas.width=i.bitmap.width*o;const n=pxt.sprite.Bitmap.fromData(i.bitmap);if(this.drawBitmap(n),i.floating&&i.floating.bitmap){const e=pxt.sprite.Bitmap.fromData(i.floating.bitmap);this.drawBitmap(e,i.layerOffsetX,i.layerOffsetY,!0)}}updateAnimation(){const{animating:e,interval:t,frames:i}=this.props,n=e&&t>5&&i.length>1;n&&t!==this.intervalcurrent?(this.intervalId&&clearInterval(this.intervalId),this.intervalId=setInterval((()=>this.setState({index:(this.state.index+1)%this.props.frames.length})),t),this.intervalcurrent=t):!n&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0,this.intervalcurrent=void 0)}drawBitmap(e,t=0,i=0,n=!1){const{colors:r}=this.props,s=this.canvas.getContext("2d");for(let a=0;a<e.width;a++)for(let l=0;l<e.height;l++){const c=e.get(a,l);c?(s.fillStyle=r[c],s.fillRect((a+t)*o,(l+i)*o,o,o)):n||s.clearRect((a+t)*o,(l+i)*o,o,o)}}}i.TimelineFrame=s},{"./Button":34,react:335}],43:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Toggle=void 0;const n=e("react");class r extends n.Component{constructor(e){super(e),this.checked=!1,this.handleToggleClick=e=>{this.checked=!this.checked,this.props.onChange&&this.props.onChange(e.target.checked)},this.checked=e.initialValue}render(){const{initialValue:e,label:t}=this.props;return n.createElement("div",{className:"image-editor-toggle-container"},t&&n.createElement("span",null,t),n.createElement("label",{className:"image-editor-toggle"},n.createElement("input",{type:"checkbox",onClick:this.handleToggleClick,defaultChecked:e,"aria-checked":this.checked}),n.createElement("span",{className:"image-editor-toggle-switch"})))}}i.Toggle=r},{react:335}],44:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TopBar=i.TopBarImpl=void 0;const n=e("react"),r=e("react-redux"),o=e("./actions/dispatch"),s=e("./Button"),a=e("./CursorSizes"),l=e("./Toggle"),c=e("./keyboardShortcuts");class u extends n.Component{constructor(e){super(e),this.togglePreviewAnimating=()=>this.props.dispatchChangePreviewAnimating(!this.props.previewAnimating),this.flipVertical=()=>c.flip(!0),this.flipHorizontal=()=>c.flip(!1),this.rotateClockwise=()=>c.rotate(!0),this.rotateCounterclockwise=()=>c.rotate(!1),this.handleIntervalChange=e=>{this.setState({interval:e.target.value})},this.handleIntervalBlur=()=>{const{dispatchChangeInterval:e}=this.props,t=parseInt(this.state.interval);isNaN(t)||e(Math.min(Math.max(t,50),1e6)),this.setState({interval:null})},this.state={}}render(){const{interval:e,previewAnimating:t,singleFrame:i,isTilemap:r,dispatchChangeOverlayEnabled:o}=this.props,c=null==this.state.interval?e:this.state.interval;return n.createElement("div",{className:"image-editor-topbar"},n.createElement("div",{className:"cursor-group"},n.createElement(a.CursorSizes,null)),n.createElement("div",{className:"image-editor-seperator"}),n.createElement("div",{className:"image-transform-group"},n.createElement(s.IconButton,{key:"flipv",iconClass:"xicon flipvertical",title:lf("Flip vertical"),onClick:this.flipVertical}),n.createElement(s.IconButton,{key:"fliph",iconClass:"xicon fliphorizontal",title:lf("Flip horizontal"),onClick:this.flipHorizontal}),n.createElement(s.IconButton,{key:"rotatec",iconClass:"xicon rotateright",title:lf("Rotate clockwise"),onClick:this.rotateClockwise}),n.createElement(s.IconButton,{key:"rotatecc",iconClass:"xicon rotateleft",title:lf("Rotate counterclockwise"),onClick:this.rotateCounterclockwise})),n.createElement("div",{className:"spacer"}),!i&&n.createElement("div",{className:"image-editor-seperator"}),!i&&n.createElement("div",{className:"timeline-controls"},n.createElement(s.IconButton,{onClick:this.togglePreviewAnimating,iconClass:t?"ms-Icon ms-Icon--Stop":"ms-Icon ms-Icon--Play",title:t?lf("Stop Animation Preview"):lf("Play Animation Preview"),toggle:!0}),n.createElement("div",{className:"image-editor-interval-label image-editor-label"},n.createElement("span",{className:"ms-Icon ms-Icon--Clock"})),n.createElement("div",{className:"image-editor-interval"},n.createElement("input",{className:"image-editor-input",title:lf("Interval Between Frames (ms)"),value:c,onChange:this.handleIntervalChange,onBlur:this.handleIntervalBlur}))),r&&n.createElement(l.Toggle,{initialValue:!0,label:lf("Show walls"),onChange:o}))}}i.TopBarImpl=u;const d={dispatchChangeInterval:o.dispatchChangeInterval,dispatchChangePreviewAnimating:o.dispatchChangePreviewAnimating,dispatchChangeOverlayEnabled:o.dispatchChangeOverlayEnabled};i.TopBar=r.connect((function({store:{present:e},editor:t},i){return e?{interval:e.interval,previewAnimating:t.previewAnimating,isTilemap:t.isTilemap}:{}}),d)(u)},{"./Button":34,"./CursorSizes":35,"./Toggle":43,"./actions/dispatch":45,"./keyboardShortcuts":47,react:335,"react-redux":314}],45:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.dispatchSetFrames=i.dispatchOpenAsset=i.dispatchChangeAssetName=i.dispatchDisableResize=i.dispatchDeleteTile=i.dispatchCloseTileEditor=i.dispatchOpenTileEditor=i.dispatchSetGalleryOpen=i.dispatchCreateNewTile=i.dispatchChangeDrawingMode=i.dispatchChangeTilePalettePage=i.dispatchChangeTilePaletteCategory=i.dispatchSetInitialState=i.dispatchChangeBackgroundColor=i.dispatchSwapBackgroundForeground=i.dispatchHideAlert=i.dispatchShowAlert=i.dispatchChangeZoom=i.dispatchChangeOverlayEnabled=i.dispatchToggleOnionSkinEnabled=i.dispatchChangePreviewAnimating=i.dispatchChangeInterval=i.dispatchMoveFrame=i.dispatchChangeCurrentFrame=i.dispatchDuplicateFrame=i.dispatchDeleteFrame=i.dispatchNewFrame=i.dispatchToggleAspectRatioLocked=i.dispatchRedoImageEdit=i.dispatchUndoImageEdit=i.dispatchImageEdit=i.dispatchChangeCursorLocation=i.dispatchChangeKeyModifiers=i.dispatchChangeImageDimensions=i.dispatchChangeSelectedColor=i.dispatchChangeCursorSize=i.dispatchChangeImageTool=void 0;const n=e("./types");i.dispatchChangeImageTool=e=>({type:n.CHANGE_IMAGE_TOOL,tool:e});i.dispatchChangeCursorSize=e=>({type:n.CHANGE_CURSOR_SIZE,cursorSize:e});i.dispatchChangeSelectedColor=e=>({type:n.CHANGE_SELECTED_COLOR,selectedColor:e});i.dispatchChangeImageDimensions=e=>({type:n.CHANGE_IMAGE_DIMENSIONS,imageDimensions:e});i.dispatchChangeKeyModifiers=e=>({type:n.CHANGE_KEY_MODIFIERS,keyModifiers:e});i.dispatchChangeCursorLocation=e=>({type:n.CHANGE_CURSOR_LOCATION,cursorLocation:e});i.dispatchImageEdit=e=>({type:n.IMAGE_EDIT,newState:e});i.dispatchUndoImageEdit=()=>({type:n.UNDO_IMAGE_EDIT});i.dispatchRedoImageEdit=()=>({type:n.REDO_IMAGE_EDIT});i.dispatchToggleAspectRatioLocked=()=>({type:n.TOGGLE_ASPECT_RATIO});i.dispatchNewFrame=e=>({type:n.NEW_FRAME,index:e});i.dispatchDeleteFrame=e=>({type:n.DELETE_FRAME,index:e});i.dispatchDuplicateFrame=e=>({type:n.DUPLICATE_FRAME,index:e});i.dispatchChangeCurrentFrame=e=>({type:n.CHANGE_CURRENT_FRAME,index:e});i.dispatchMoveFrame=(e,t)=>({type:n.MOVE_FRAME,oldIndex:e,newIndex:t});i.dispatchChangeInterval=e=>({type:n.CHANGE_INTERVAL,newInterval:e});i.dispatchChangePreviewAnimating=e=>({type:n.CHANGE_PREVIEW_ANIMATING,animating:e});i.dispatchToggleOnionSkinEnabled=()=>({type:n.TOGGLE_ONION_SKIN_ENABLED});i.dispatchChangeOverlayEnabled=e=>({type:n.CHANGE_OVERLAY_ENABLED,enabled:e});i.dispatchChangeZoom=e=>({type:n.CHANGE_CANVAS_ZOOM,zoom:e});i.dispatchShowAlert=(e,t,i)=>({type:n.SHOW_ALERT,title:e,text:t,options:i});i.dispatchHideAlert=()=>({type:n.HIDE_ALERT});i.dispatchSwapBackgroundForeground=()=>({type:n.SWAP_FOREGROUND_BACKGROUND});i.dispatchChangeBackgroundColor=e=>({type:n.CHANGE_BACKGROUND_COLOR,backgroundColor:e});i.dispatchSetInitialState=(e,t)=>({type:n.SET_INITIAL_STATE,state:e,past:t});i.dispatchChangeTilePaletteCategory=e=>({type:n.CHANGE_TILE_PALETTE_CATEGORY,category:e});i.dispatchChangeTilePalettePage=e=>({type:n.CHANGE_TILE_PALETTE_PAGE,page:e});i.dispatchChangeDrawingMode=e=>({type:n.CHANGE_DRAWING_MODE,drawingMode:e});i.dispatchCreateNewTile=(e,t,i,r)=>({type:n.CREATE_NEW_TILE,tile:e,foreground:t,background:i,qualifiedName:r});i.dispatchSetGalleryOpen=e=>({type:n.SET_GALLERY_OPEN,open:e});i.dispatchOpenTileEditor=(e,t)=>({type:n.OPEN_TILE_EDITOR,index:e,id:t});i.dispatchCloseTileEditor=(e,t)=>({type:n.CLOSE_TILE_EDITOR,result:e,index:t});i.dispatchDeleteTile=(e,t)=>({type:n.DELETE_TILE,id:t,index:e});i.dispatchDisableResize=()=>({type:n.DISABLE_RESIZE});i.dispatchChangeAssetName=e=>({type:n.CHANGE_ASSET_NAME,name:e});i.dispatchOpenAsset=(e,t,i)=>({type:n.OPEN_ASSET,asset:e,keepPast:t,gallery:i});i.dispatchSetFrames=e=>({type:n.SET_FRAMES,frames:e})},{"./types":46}],46:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.OPEN_ASSET=i.CHANGE_ASSET_NAME=i.DISABLE_RESIZE=i.DELETE_TILE=i.CLOSE_TILE_EDITOR=i.OPEN_TILE_EDITOR=i.CREATE_NEW_TILE=i.CHANGE_DRAWING_MODE=i.CHANGE_TILE_PALETTE_CATEGORY=i.CHANGE_TILE_PALETTE_PAGE=i.CHANGE_BACKGROUND_COLOR=i.SWAP_FOREGROUND_BACKGROUND=i.HIDE_ALERT=i.SHOW_ALERT=i.CHANGE_CANVAS_ZOOM=i.CHANGE_OVERLAY_ENABLED=i.TOGGLE_ONION_SKIN_ENABLED=i.CHANGE_PREVIEW_ANIMATING=i.CHANGE_INTERVAL=i.CHANGE_CURRENT_FRAME=i.MOVE_FRAME=i.DUPLICATE_FRAME=i.DELETE_FRAME=i.NEW_FRAME=i.SET_GALLERY_OPEN=i.TOGGLE_ASPECT_RATIO=i.REDO_IMAGE_EDIT=i.UNDO_IMAGE_EDIT=i.IMAGE_EDIT=i.CHANGE_CURSOR_LOCATION=i.CHANGE_KEY_MODIFIERS=i.CHANGE_IMAGE_DIMENSIONS=i.CHANGE_SELECTED_COLOR=i.CHANGE_CURSOR_SIZE=i.CHANGE_IMAGE_TOOL=i.SET_FRAMES=i.SET_INITIAL_STATE=void 0,i.SET_INITIAL_STATE="SET_INITIAL_STATE",i.SET_FRAMES="SET_FRAMES",i.CHANGE_IMAGE_TOOL="CHANGE_IMAGE_TOOL",i.CHANGE_CURSOR_SIZE="CHANGE_CURSOR_SIZE",i.CHANGE_SELECTED_COLOR="CHANGE_SELECTED_COLOR",i.CHANGE_IMAGE_DIMENSIONS="CHANGE_IMAGE_DIMENSIONS",i.CHANGE_KEY_MODIFIERS="CHANGE_KEY_MODIFIERS",i.CHANGE_CURSOR_LOCATION="CHANGE_CURSOR_LOCATION",i.IMAGE_EDIT="IMAGE_EDIT",i.UNDO_IMAGE_EDIT="UNDO_IMAGE_EDIT",i.REDO_IMAGE_EDIT="REDO_IMAGE_EDIT",i.TOGGLE_ASPECT_RATIO="TOGGLE_ASPECT_RATIO",i.SET_GALLERY_OPEN="SET_GALLERY_OPEN",i.NEW_FRAME="NEW_FRAME",i.DELETE_FRAME="DELETE_FRAME",i.DUPLICATE_FRAME="DUPLICATE_FRAME",i.MOVE_FRAME="MOVE_FRAME",i.CHANGE_CURRENT_FRAME="CHANGE_CURRENT_FRAME",i.CHANGE_INTERVAL="CHANGE_INTERVAL",i.CHANGE_PREVIEW_ANIMATING="CHANGE_PREVIEW_ANIMATING",i.TOGGLE_ONION_SKIN_ENABLED="TOGGLE_ONION_SKIN_ENABLED",i.CHANGE_OVERLAY_ENABLED="CHANGE_OVERLAY_ENABLED",i.CHANGE_CANVAS_ZOOM="CHANGE_CANVAS_ZOOM",i.SHOW_ALERT="SHOW_ALERT",i.HIDE_ALERT="HIDE_ALERT",i.SWAP_FOREGROUND_BACKGROUND="SWAP_FOREGROUND_BACKGROUND",i.CHANGE_BACKGROUND_COLOR="CHANGE_BACKGROUND_COLOR",i.CHANGE_TILE_PALETTE_PAGE="CHANGE_TILE_PALETTE_PAGE",i.CHANGE_TILE_PALETTE_CATEGORY="CHANGE_TILE_PALETTE_CATEGORY",i.CHANGE_DRAWING_MODE="CHANGE_DRAWING_MODE",i.CREATE_NEW_TILE="CREATE_NEW_TILE",i.OPEN_TILE_EDITOR="OPEN_TILE_EDITOR",i.CLOSE_TILE_EDITOR="CLOSE_TILE_EDITOR",i.DELETE_TILE="DELETE_TILE",i.DISABLE_RESIZE="DISABLE_RESIZE",i.CHANGE_ASSET_NAME="CHANGE_ASSET_NAME",i.OPEN_ASSET="OPEN_ASSET"},{}],47:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.replaceColor=i.outline=i.rotate=i.flip=i.setStore=i.areShortcutsEnabled=i.releaseShortcutLock=i.obtainShortcutLock=i.removeKeyListener=i.addKeyListener=void 0;const n=e("./store/imageReducer"),r=e("./actions/dispatch"),o=e("./store/imageStore"),s=e("./toolDefinitions");let a=o.mainStore,l=[];function c(){return!l.length}function u(e){const t=e.ctrlKey||e.metaKey;"Undo"===e.key||t&&"z"===e.key&&!e.shiftKey?(g(r.dispatchUndoImageEdit()),e.preventDefault(),e.stopPropagation()):("Redo"===e.key||t&&"y"===e.key||t&&"Z"===e.key&&e.shiftKey)&&(g(r.dispatchRedoImageEdit()),e.preventDefault(),e.stopPropagation())}function d(e){"Backspace"!==e.key&&"Delete"!==e.key||e.stopPropagation()}function p(e){if(!c())return;if(e.shiftKey&&/^(?:Digit[1-9])|(?:Key[A-F])$/.test(e.code))return void(0==e.code.indexOf("Digit")?k(parseInt(e.code.substring(5))):k(parseInt(e.code.substring(3),16)));switch(e.key){case"e":f(n.ImageEditorTool.Erase);break;case"h":f(n.ImageEditorTool.Pan);break;case"b":case"p":f(n.ImageEditorTool.Paint);break;case"g":f(n.ImageEditorTool.Fill);break;case"m":f(n.ImageEditorTool.Marquee);break;case"u":f(n.ImageEditorTool.Rect);break;case"l":f(n.ImageEditorTool.Line);break;case"c":f(n.ImageEditorTool.Circle);break;case"-":case"_":m(-1);break;case"=":case"+":m(1);break;case"x":g(r.dispatchSwapBackgroundForeground());break;case"H":v(!1);break;case"V":v(!0);break;case"[":y(!1);break;case"]":y(!0);break;case">":b(!0);break;case"<":b(!1)}const t=a.getState().editor;if(e.shiftKey&&"KeyR"===e.code)w(t.backgroundColor,t.selectedColor);else if(!t.isTilemap&&/^Digit\d$/.test(e.code)){const t=+e.code.slice(-1)+(e.shiftKey?9:0);t>=0&&t<16&&function(e){g(r.dispatchChangeSelectedColor(e))}(t)}}function h(){const e=a.getState();if(e.editor.isTilemap){const t=e.store.present;return[s.getEditState(t.tilemap,!0,e.editor.drawingMode),"tilemap"]}{const t=e.store.present;return[s.getEditState(t.frames[t.currentFrame],!1,e.editor.drawingMode),t.frames.length>1?"animation":"image"]}}function f(e){g(r.dispatchChangeImageTool(e))}function m(e){g(r.dispatchChangeZoom(e))}function g(e){a.dispatch(e)}function b(e){let t;const i=a.getState().editor.cursorSize;switch(i){case 1:t=e?3:1;break;case 3:t=e?5:1;break;case 5:t=e?5:3}i!==t&&g(r.dispatchChangeCursorSize(t))}function v(e){const[t,i]=h(),n=s.flipEdit(t,e,"tilemap"===i);g(r.dispatchImageEdit(n.toImageState()))}function y(e){const[t,i]=h(),n=s.rotateEdit(t,e,"tilemap"===i,"animation"===i);g(r.dispatchImageEdit(n.toImageState()))}function k(e){const[t,i]=h();if("tilemap"===i)return;const n=s.outlineEdit(t,e);g(r.dispatchImageEdit(n.toImageState()))}function w(e,t){const[i,n]=h(),o=s.replaceColorEdit(i,e,t);g(r.dispatchImageEdit(o.toImageState()))}i.addKeyListener=function(){l=[],document.addEventListener("keydown",p),document.addEventListener("keydown",u,!0),document.addEventListener("keydown",d,!0)},i.removeKeyListener=function(){document.removeEventListener("keydown",p),document.removeEventListener("keydown",u,!0),document.removeEventListener("keydown",d,!0)},i.obtainShortcutLock=function(){let e=0;for(;!e;)e=Math.random()*Number.MAX_SAFE_INTEGER;return l.push(e),e},i.releaseShortcutLock=function(e){const t=l.indexOf(e);-1!==t&&l.splice(t,1)},i.areShortcutsEnabled=c,i.setStore=function(e){a=e||o.mainStore},i.flip=v,i.rotate=y,i.outline=k,i.replaceColor=w},{"./actions/dispatch":45,"./store/imageReducer":49,"./store/imageStore":50,"./toolDefinitions":53}],48:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Palette=void 0;const n=e("react"),r=e("react-redux"),o=e("../actions/dispatch");class s extends n.Component{constructor(){super(...arguments),this.handlers=[],this.preventContextMenu=e=>e.preventDefault()}render(){const{colors:e,selected:t,backgroundColor:i,dispatchSwapBackgroundForeground:r}=this.props;return n.createElement("div",null,n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"image-editor-colors",viewBox:"0 0 23 15",onClick:r},n.createElement("defs",null,n.createElement("pattern",{id:"alpha-background",width:"6",height:"6",patternUnits:"userSpaceOnUse"},n.createElement("rect",{x:"0",y:"0",width:"6px",height:"6px",fill:"#aeaeae"}),n.createElement("rect",{x:"0",y:"0",width:"3px",height:"3px",fill:"#dedede"}),n.createElement("rect",{x:"3",y:"3",width:"3px",height:"3px",fill:"#dedede"}))),n.createElement("g",null,n.createElement("rect",{fill:i?e[i]:"url(#alpha-background)",x:6,y:4,width:15,height:10,stroke:"#3c3c3c",strokeWidth:"0.5"},n.createElement("title",null,a(i,e[i]))),n.createElement("rect",{fill:t?e[t]:"url(#alpha-background)",x:2,y:1,width:15,height:10,stroke:"#3c3c3c",strokeWidth:"0.5"},n.createElement("title",null,a(t,e[t]))))),n.createElement("div",{className:"image-editor-color-buttons",onContextMenu:this.preventContextMenu},this.props.colors.map(((e,t)=>n.createElement("div",{key:t,className:"image-editor-button "+(0===t?"checkerboard":""),role:"button",title:a(t,e),onMouseDown:this.clickHandler(t),style:0===t?null:{backgroundColor:e}})))))}clickHandler(e){return this.handlers[e]||(this.handlers[e]=t=>{0===t.button?this.props.dispatchChangeSelectedColor(e):(this.props.dispatchChangeBackgroundColor(e),t.preventDefault(),t.stopPropagation())}),this.handlers[e]}}function a(e,t){const i=0===e?lf("transparency"):function(e){switch(null==e?void 0:e.toLowerCase()){case"#ffffff":return lf("white");case"#ff2121":return lf("red");case"#ff93c4":return lf("pink");case"#ff8135":return lf("orange");case"#fff609":return lf("yellow");case"#249ca3":return lf("teal");case"#78dc52":return lf("green");case"#003fad":return lf("blue");case"#87f2ff":return lf("light blue");case"#8e2ec4":return lf("purple");case"#a4839f":return lf("light purple");case"#5c406c":return lf("dark purple");case"#e5cdc4":return lf("tan");case"#91463d":return lf("brown");case"#000000":return lf("black");default:return}}(t);return i?lf("Color {0} ({1})",e,i):lf("Color {0}",e)}const l={dispatchChangeSelectedColor:o.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:o.dispatchChangeBackgroundColor,dispatchSwapBackgroundForeground:o.dispatchSwapBackgroundForeground};i.Palette=r.connect((function({store:{present:e},editor:t},i){let n=e;return n?{selected:t.selectedColor,backgroundColor:t.backgroundColor,colors:n.colors}:{}}),l)(s)},{"../actions/dispatch":45,react:335,"react-redux":314}],49:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.setTelemetryFunction=i.TileDrawingMode=i.TileCategory=i.KeyModifiers=i.CursorSize=i.ImageEditorTool=void 0;const n=e("../../../assets"),r=e("../actions/types");var o,s,a,l;(l=o=i.ImageEditorTool||(i.ImageEditorTool={}))[l.Paint=0]="Paint",l[l.Fill=1]="Fill",l[l.Line=2]="Line",l[l.Erase=3]="Erase",l[l.Circle=4]="Circle",l[l.Rect=5]="Rect",l[l.ColorSelect=6]="ColorSelect",l[l.Marquee=7]="Marquee",l[l.Pan=8]="Pan",function(e){e[e.One=1]="One",e[e.Three=3]="Three",e[e.Five=5]="Five"}(i.CursorSize||(i.CursorSize={})),function(e){e[e.Alt=1]="Alt",e[e.Shift=2]="Shift"}(i.KeyModifiers||(i.KeyModifiers={})),function(e){e[e.Forest=0]="Forest",e[e.Aquatic=1]="Aquatic",e[e.Dungeon=2]="Dungeon",e[e.Misc=3]="Misc"}(s=i.TileCategory||(i.TileCategory={})),function(e){e.Default="default",e.Wall="wall"}(a=i.TileDrawingMode||(i.TileDrawingMode={}));const c={store:{present:{kind:"Animation",visible:!0,colors:["#000000","#ffffff","#ff2121","#ff93c4","#ff8135","#fff609","#249ca3","#78dc52","#003fad","#87f2ff","#8e2ec4","#a4839f","#5c406c","#e5cdc4","#91463d","#000000"],aspectRatioLocked:!1,currentFrame:0,frames:[f(16,16)],interval:200},past:[],future:[]},editor:{selectedColor:3,tool:o.Paint,cursorSize:1,backgroundColor:1,previewAnimating:!1,onionSkinEnabled:!1,overlayEnabled:!0,tilesetRevision:0,isTilemap:!1}},u=(e,t)=>{switch(t.type){case r.TOGGLE_ASPECT_RATIO:return g("toggle-aspect-ratio-lock"),Object.assign(Object.assign({},e),{aspectRatioLocked:!e.aspectRatioLocked});case r.CHANGE_CURRENT_FRAME:return g("change-frame"),Object.assign(Object.assign({},e),{currentFrame:t.index});case r.CHANGE_INTERVAL:return g("change-interval"),Object.assign(Object.assign({},e),{interval:t.newInterval});case r.CHANGE_IMAGE_DIMENSIONS:g("change-dimensions");const[i,n]=t.imageDimensions;return Object.assign(Object.assign({},e),{frames:e.frames.map(((e,t)=>Object.assign(Object.assign({},e),{bitmap:pxt.sprite.Bitmap.fromData(e.bitmap).resize(i,n).data()})))});case r.IMAGE_EDIT:return g("image-edit"),Object.assign(Object.assign({},e),{frames:e.frames.map(((i,n)=>n===e.currentFrame?t.newState:i))});case r.DELETE_FRAME:if(1===e.frames.length)return e;g("delete-frame");const o=e.frames.slice();o.splice(t.index,1);let s=e.currentFrame;return e.currentFrame>=t.index&&e.currentFrame>0&&s--,Object.assign(Object.assign({},e),{currentFrame:s,frames:o});case r.DUPLICATE_FRAME:g("duplicate-frame");const a=e.frames.slice();return a.splice(t.index,0,function(e){let t,i,n;return e.floating&&(e.floating.bitmap&&(i=pxt.sprite.Bitmap.fromData(e.floating.bitmap).copy().data()),e.floating.overlayLayers&&(n=e.floating.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy().data()))),t={bitmap:i,overlayLayers:n}),Object.assign(Object.assign({},e),{bitmap:pxt.sprite.Bitmap.fromData(e.bitmap).copy().data(),overlayLayers:e.overlayLayers&&e.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy().data())),floating:t})}(e.frames[t.index])),Object.assign(Object.assign({},e),{frames:a,currentFrame:t.index+1});case r.NEW_FRAME:return g("new-frame"),Object.assign(Object.assign({},e),{frames:[...e.frames,f(e.frames[0].bitmap.width,e.frames[0].bitmap.height)],currentFrame:e.frames.length});case r.MOVE_FRAME:if(t.newIndex<0||t.newIndex>=e.frames.length||t.newIndex<0||t.newIndex>=e.frames.length)return e;g("move-frame");const l=e.frames.slice(),c=l.splice(t.oldIndex,1)[0];return l.splice(t.newIndex,0,c),Object.assign(Object.assign({},e),{frames:l,currentFrame:t.oldIndex===e.currentFrame?t.newIndex:e.currentFrame});case r.SET_FRAMES:return g("set-frames"),Object.assign(Object.assign({},e),{frames:t.frames,currentFrame:0});default:return e}},d=(e,t,i)=>{let n;switch(t.type){case r.CHANGE_PREVIEW_ANIMATING:return g("preview-animate-"+(t.animating?"on":"off")),Object.assign(Object.assign({},e),{previewAnimating:t.animating});case r.CHANGE_CANVAS_ZOOM:return(t.zoom>0||t.zoom<0)&&g("zoom-"+(t.zoom>0?"in":"out")),Object.assign(Object.assign({},e),{zoomDelta:t.zoom});case r.CHANGE_IMAGE_TOOL:return g(`change-tool-${o[t.tool]}`),Object.assign(Object.assign({},e),{tool:t.tool});case r.CHANGE_CURSOR_SIZE:return g(`change-cursor-size-${t.cursorSize}`),Object.assign(Object.assign({},e),{cursorSize:t.cursorSize});case r.CHANGE_SELECTED_COLOR:return g(`foreground-color-${t.selectedColor}`),Object.assign(Object.assign({},e),{selectedColor:t.selectedColor,tool:e.tool===o.Erase?o.Paint:e.tool});case r.CHANGE_CURSOR_LOCATION:return Object.assign(Object.assign({},e),{cursorLocation:t.cursorLocation});case r.CHANGE_BACKGROUND_COLOR:return g(`background-color-${t.backgroundColor}`),Object.assign(Object.assign({},e),{backgroundColor:t.backgroundColor});case r.SWAP_FOREGROUND_BACKGROUND:return g("swap-foreground-background"),Object.assign(Object.assign({},e),{backgroundColor:e.selectedColor,selectedColor:e.backgroundColor});case r.TOGGLE_ONION_SKIN_ENABLED:return g("toggle-onion-skin"),Object.assign(Object.assign({},e),{onionSkinEnabled:!e.onionSkinEnabled});case r.CHANGE_TILE_PALETTE_CATEGORY:return g(`change-tile-category-${s[t.category]}`),Object.assign(Object.assign({},e),{tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{category:t.category,page:0})});case r.CHANGE_TILE_PALETTE_PAGE:return g("change-tile-page"),Object.assign(Object.assign({},e),{tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{page:t.page})});case r.CHANGE_DRAWING_MODE:return g("change-drawing-mode"),Object.assign(Object.assign({},e),{drawingMode:t.drawingMode||a.Default});case r.CHANGE_OVERLAY_ENABLED:return g("change-overlay-enabled"),Object.assign(Object.assign({},e),{overlayEnabled:t.enabled});case r.CREATE_NEW_TILE:return n=e.editedTiles,!t.tile||n&&-1!==n.indexOf(t.tile.id)||(n=(n||[]).concat([t.tile.id])),Object.assign(Object.assign({},e),{editedTiles:n,selectedColor:t.foreground,backgroundColor:t.background});case r.SET_GALLERY_OPEN:return g(`set-gallery-open-${t.open}`),Object.assign(Object.assign({},e),{tileGalleryOpen:t.open,tilemapPalette:Object.assign(Object.assign({},e.tilemapPalette),{page:0})});case r.DELETE_TILE:return Object.assign(Object.assign({},e),{deletedTiles:(e.deletedTiles||[]).concat([t.id]),selectedColor:t.index===e.selectedColor?0:e.selectedColor,backgroundColor:t.index===e.backgroundColor?0:e.backgroundColor,tilesetRevision:e.tilesetRevision+1});case r.OPEN_TILE_EDITOR:const l=t.index?"edit":"new";return g(`open-tile-editor-${l}`),Object.assign(Object.assign({},e),{editingTile:{type:l,tilesetIndex:t.index}});case r.CLOSE_TILE_EDITOR:return n=e.editedTiles,!t.result||n&&-1!==n.indexOf(t.result.id)||(n=(n||[]).concat([t.result.id])),Object.assign(Object.assign({},e),{editedTiles:n,selectedColor:t.index||i.present.tileset.tiles.length,editingTile:void 0,tilesetRevision:e.tilesetRevision+1});case r.SHOW_ALERT:return g("show-alert"),Object.assign(Object.assign({},e),{alert:{title:t.title,text:t.text,options:t.options}});case r.HIDE_ALERT:return g("hide-alert"),Object.assign(Object.assign({},e),{alert:null});case r.DISABLE_RESIZE:return Object.assign(Object.assign({},e),{resizeDisabled:!0})}return e},p=(e,t)=>{switch(t.type){case r.TOGGLE_ASPECT_RATIO:return g("toggle-aspect-ratio-lock"),Object.assign(Object.assign({},e),{aspectRatioLocked:!e.aspectRatioLocked});case r.CHANGE_IMAGE_DIMENSIONS:g("change-dimensions");const[i,o]=t.imageDimensions;return Object.assign(Object.assign({},e),{tilemap:Object.assign(Object.assign({},e.tilemap),{bitmap:y(e.tilemap.bitmap,i,o),overlayLayers:e.tilemap.overlayLayers&&e.tilemap.overlayLayers.map((e=>function(e,t,i){return pxt.sprite.Bitmap.fromData(e).resize(t,i).data()}(e,i,o)))})});case r.CREATE_NEW_TILE:const s=!t.qualifiedName;let a;return g(s?"new-tile":`used-tile-${t.qualifiedName}`),s?(a=t.tile).isProjectTile=!0:a=n.lookupAsset("tile",t.qualifiedName),Object.assign(Object.assign({},e),{tileset:Object.assign(Object.assign({},e.tileset),{tiles:e.tileset.tiles.concat([a])}),nextId:s?e.nextId+1:e.nextId});case r.CLOSE_TILE_EDITOR:return g("close-tile-editor"),t.result?t.index?Object.assign(Object.assign({},e),{tileset:h(e.tileset,t.index,t.result)}):Object.assign(Object.assign({},e),{tileset:Object.assign(Object.assign({},e.tileset),{tiles:e.tileset.tiles.concat([t.result])}),nextId:e.nextId+1}):e;case r.DELETE_TILE:g("delete-tile");const l=e.tileset.tiles.slice();return l.splice(t.index,1),Object.assign(Object.assign({},e),{tilemap:Object.assign(Object.assign({},e.tilemap),{bitmap:v(t.index,pxt.sprite.Tilemap.fromData(e.tilemap.bitmap)).data()}),tileset:Object.assign(Object.assign({},e.tileset),{tiles:l})});case r.IMAGE_EDIT:return g("image-edit"),Object.assign(Object.assign({},e),{tilemap:t.newState});default:return e}};function h(e,t,i){return Object.assign(Object.assign({},e),{tiles:e.tiles.map(((e,n)=>n===t?i:e))})}function f(e,t){return{bitmap:new pxt.sprite.Bitmap(e,t).data()}}let m;function g(e){m&&m(e)}function b(e,t){for(const i of e.tiles)if(!i.jresData&&!i.isProjectTile)for(const e of t)if(e.qualifiedName===i.id){i.bitmap=e.bitmap;break}return e}function v(e,t){const i=t.copy();for(let t=0;t<i.width;t++)for(let n=0;n<i.height;n++){const r=i.get(t,n);r===e?i.set(t,n,0):r>e&&i.set(t,n,r-1)}return i}function y(e,t,i){return pxt.sprite.Tilemap.fromData(e).resize(t,i).data()}function k(e,t){return"tilemap"===e.type?function(e,t){return{kind:"Tilemap",asset:e,colors:pxt.appTarget.runtime.palette.slice(),aspectRatioLocked:!1,tilemap:{bitmap:e.data.tilemap.data(),overlayLayers:[e.data.layers]},tileset:b(e.data.tileset,t),nextId:e.data.nextId}}(e,t):function(e){return{kind:"Animation",asset:e,visible:!0,colors:pxt.appTarget.runtime.palette.slice(),aspectRatioLocked:"tile"===e.type,currentFrame:0,frames:"animation"===e.type?e.frames.map((e=>({bitmap:e}))):[{bitmap:e.bitmap}],interval:"animation"===e.type?e.interval:100}}(e)}i.setTelemetryFunction=function(e){m=e},i.default=(e=c,t)=>{var i;switch(t.type){case r.OPEN_TILE_EDITOR:case r.CHANGE_PREVIEW_ANIMATING:case r.CHANGE_CANVAS_ZOOM:case r.CHANGE_IMAGE_TOOL:case r.CHANGE_CURSOR_SIZE:case r.CHANGE_SELECTED_COLOR:case r.CHANGE_CURSOR_LOCATION:case r.CHANGE_BACKGROUND_COLOR:case r.SWAP_FOREGROUND_BACKGROUND:case r.TOGGLE_ONION_SKIN_ENABLED:case r.CHANGE_OVERLAY_ENABLED:case r.CHANGE_TILE_PALETTE_PAGE:case r.CHANGE_TILE_PALETTE_CATEGORY:case r.CHANGE_DRAWING_MODE:case r.SET_GALLERY_OPEN:case r.SHOW_ALERT:case r.HIDE_ALERT:case r.DISABLE_RESIZE:return Object.assign(Object.assign({},e),{editor:d(e.editor,t,e.store)});case r.SET_INITIAL_STATE:const o=t.state;return Object.assign(Object.assign({},e),{editor:Object.assign(Object.assign({},c.editor),{selectedColor:o.selectedColor,backgroundColor:o.backgroundColor,tilemapPalette:o.tilemapPalette,tileGalleryOpen:o.tileGalleryOpen,tileGallery:o.tileGallery,isTilemap:o.isTilemap,referencedTiles:e.editor.referencedTiles}),store:Object.assign(Object.assign({},e.store),{past:t.past||e.store.past,future:t.past?[]:e.store.future})});case r.OPEN_ASSET:const l=t.asset,h=t.gallery||(t.keepPast?e.editor.tileGallery:[]);let f=-1;if("tilemap"===l.type){const e=t.asset.data;if(pxt.sprite.isEmptyTilemap(e)){const t=e.tileset.tiles||[],r=null===(i=h.find((e=>-1!==e.tags.indexOf("forest"))))||void 0===i?void 0:i.qualifiedName,o=n.lookupAsset("tile",r);o&&!t.find((e=>e.id===r))&&t.push(o),f=t.indexOf(o)}}return Object.assign(Object.assign({},e),{editor:"tilemap"===l.type?{selectedColor:f,backgroundColor:-1,isTilemap:!0,tilemapPalette:{category:s.Forest,page:0},drawingMode:a.Default,overlayEnabled:!0,tileGallery:h,tileGalleryOpen:!!h,referencedTiles:l.data.projectReferences,previewAnimating:!1,onionSkinEnabled:!1,tilesetRevision:0,tool:t.keepPast?e.editor.tool:c.editor.tool,cursorSize:t.keepPast?e.editor.cursorSize:c.editor.cursorSize,editedTiles:t.keepPast?e.editor.editedTiles:void 0,deletedTiles:t.keepPast?e.editor.deletedTiles:void 0}:{isTilemap:!1,tilesetRevision:0,selectedColor:t.keepPast?e.editor.selectedColor:c.editor.selectedColor,backgroundColor:t.keepPast?e.editor.backgroundColor:c.editor.backgroundColor,previewAnimating:t.keepPast?e.editor.previewAnimating:c.editor.previewAnimating,tool:t.keepPast?e.editor.tool:c.editor.tool,onionSkinEnabled:t.keepPast?e.editor.onionSkinEnabled:c.editor.onionSkinEnabled,cursorSize:t.keepPast?e.editor.cursorSize:c.editor.cursorSize,resizeDisabled:t.keepPast?e.editor.resizeDisabled:c.editor.resizeDisabled},store:Object.assign(Object.assign({},e.store),{past:t.keepPast?e.store.past:[],present:k(t.asset,h),future:[]})});case r.CHANGE_ASSET_NAME:return g("change-asset-name"),Object.assign(Object.assign({},e),{store:{past:[...e.store.past,e.store.present],present:Object.assign(Object.assign({},e.store.present),{asset:Object.assign(Object.assign({},e.store.present.asset),{meta:Object.assign(Object.assign({},e.store.present.asset.meta||{}),{displayName:t.name})})}),future:[]}});case r.UNDO_IMAGE_EDIT:return e.store.past.length?(g("undo"),Object.assign(Object.assign({},e),{store:Object.assign(Object.assign({},e.store),{past:e.store.past.slice(0,e.store.past.length-1),present:e.store.past[e.store.past.length-1],future:[...e.store.future,e.store.present]}),editor:Object.assign(Object.assign({},e.editor),{tilesetRevision:e.editor.tilesetRevision+1})})):e;case r.REDO_IMAGE_EDIT:return e.store.future.length?(g("redo"),Object.assign(Object.assign({},e),{store:Object.assign(Object.assign({},e.store),{past:[...e.store.past,e.store.present],present:e.store.future[e.store.future.length-1],future:e.store.future.slice(0,e.store.future.length-1)}),editor:Object.assign(Object.assign({},e.editor),{tilesetRevision:e.editor.tilesetRevision+1})})):e;default:return Object.assign(Object.assign({},e),{editor:d(e.editor,t,e.store),store:Object.assign(Object.assign({},e.store),{past:[...e.store.past,e.store.present],present:e.editor.isTilemap?p(e.store.present,t):u(e.store.present,t),future:[]})})}}},{"../../../assets":18,"../actions/types":46}],50:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.mainStore=i.tileEditorStore=void 0;const n=e("redux"),r=e("./imageReducer"),o=n.createStore(r.default);i.default=o,i.tileEditorStore=n.createStore(r.default),i.mainStore=o},{"./imageReducer":49,redux:356}],51:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Minimap=void 0;const n=e("react"),r=e("react-redux"),o=e("../ImageEditor"),s=pxt.BrowserUtils.isEdge()?25:1;class a extends n.Component{constructor(){super(...arguments),this.tileColors=[]}componentDidMount(){this.canvas=this.refs["minimap-canvas"],this.redrawCanvas()}componentDidUpdate(){this.redrawCanvas()}render(){return n.createElement("div",{className:"minimap-outer"},n.createElement("canvas",{ref:"minimap-canvas",className:"paint-surface"}))}redrawCanvas(){const{tilemap:e,lightMode:t}=this.props;let{bitmap:i,floating:n,layerOffsetX:r,layerOffsetY:a}=e;const l=this.canvas.getContext("2d"),c=pxt.sprite.Tilemap.fromData(i),u=n&&n.bitmap?pxt.sprite.Tilemap.fromData(n.bitmap):null;this.canvas.width=c.width*s,this.canvas.height=c.height*s,this.tileColors=[];for(let e=0;e<c.width;e++)for(let i=0;i<c.height;i++){const n=u?u.get(e-r,i-a):null,d=c.get(e,i);n?(l.fillStyle=this.getColor(n),l.fillRect(e*s,i*s,s,s)):d?(l.fillStyle=this.getColor(d),l.fillRect(e*s,i*s,s,s)):t?(l.fillStyle=o.LIGHT_MODE_TRANSPARENT,l.fillRect(e*s,i*s,s,s)):l.clearRect(e*s,i*s,s,s)}}getColor(e){if(!this.tileColors[e]){const{tileset:t,colors:i}=this.props;if(e>=t.tiles.length)return"#ffffff";const n=pxt.sprite.Bitmap.fromData(t.tiles[e].bitmap);this.tileColors[e]=pxt.sprite.computeAverageColor(n,i)}return this.tileColors[e]}}i.Minimap=r.connect((function({store:{present:e},editor:t},i){let n=e;return n?{tilemap:n.tilemap,tileset:n.tileset,colors:n.colors}:{}}),{})(a)},{"../ImageEditor":38,react:335,"react-redux":314}],52:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TilePalette=void 0;const n=e("react"),r=e("react-redux"),o=e("../store/imageReducer"),s=e("../actions/dispatch"),a=e("../TimelineFrame"),l=e("../Dropdown"),c=e("../Pivot"),u=e("../Button"),d=e("../../../assets"),p=pxt.BrowserUtils.isEdge()?25:1,h=[{id:"forest",text:lf("Forest"),tiles:[]},{id:"aquatic",text:lf("Aquatic"),tiles:[]},{id:"dungeon",text:lf("Dungeon"),tiles:[]},{id:"misc",text:lf("Miscellaneous"),tiles:[]}],f=[{id:"custom",text:lf("My Tiles")},{id:"gallery",text:lf("Gallery")}],m=new pxt.sprite.Bitmap(16,16);class g extends n.Component{constructor(e){super(e),this.dropdownHandler=(e,t)=>{this.props.dispatchChangeTilePaletteCategory(t)},this.pivotHandler=(e,t)=>{this.props.dispatchSetGalleryOpen(1===t)},this.pageHandler=e=>{this.props.dispatchChangeTilePalettePage(e)},this.tileCreateHandler=()=>{this.props.dispatchOpenTileEditor()},this.tileEditHandler=()=>{const{tileset:e,selected:t,dispatchOpenTileEditor:i}=this.props,n=e.tiles[t];(null==n?void 0:n.isProjectTile)&&0!==t&&i(t,n.id)},this.tileDuplicateHandler=()=>{var e;const{tileset:t,selected:i,backgroundColor:n,dispatchCreateNewTile:r}=this.props;if(!t.tiles[i]||!t.tiles[i].isProjectTile||0===i)return;const o=t.tiles[i];r(d.createTile(o.bitmap,null,null===(e=o.meta)||void 0===e?void 0:e.displayName),t.tiles.length,n)},this.tileDeleteAlertHandler=()=>{const{tileset:e,selected:t,dispatchShowAlert:i,dispatchHideAlert:n,referencedTiles:r}=this.props,o=e.tiles[t];t&&o&&o.isProjectTile&&(r&&-1!==r.indexOf(o.id)?i(lf("Unable to delete"),lf("This tile is used in your game. Remove all blocks using the tile before deleting."),[{label:lf("Cancel"),onClick:n}]):i(lf("Are you sure?"),lf("Deleting this tile will remove it from all other tile maps in your game."),[{label:lf("Yes"),onClick:this.deleteTile},{label:lf("No"),onClick:n}]))},this.deleteTile=()=>{const e=this.props.tileset.tiles[this.props.selected];e&&this.props.dispatchDeleteTile(this.props.selected,e.id)},this.canvasClickHandler=e=>{this.handleCanvasClickCore(e.clientX,e.clientY,e.button>0)},this.canvasTouchHandler=e=>{this.handleCanvasClickCore(e.changedTouches[0].clientX,e.changedTouches[0].clientY,!1)},this.foregroundBackgroundClickHandler=()=>{this.props.drawingMode!=o.TileDrawingMode.Default?this.props.dispatchChangeDrawingMode(o.TileDrawingMode.Default):this.props.dispatchSwapBackgroundForeground()},this.wallClickHandler=()=>{this.props.drawingMode===o.TileDrawingMode.Wall?this.props.dispatchChangeDrawingMode(o.TileDrawingMode.Default):this.props.dispatchChangeDrawingMode(o.TileDrawingMode.Wall)},this.preventContextMenu=e=>e.preventDefault();const{gallery:t}=e;if(this.refreshGallery(e),t){const e={};for(const i of t){const t=i.tags.find((e=>pxt.Util.startsWith(e,"category-")));t&&(e[t]||(e[t]={id:t,text:pxt.Util.rlf(`{id:tilecategory}${t.substr(9)}`),tiles:[]}),e[t].tiles.push(i))}this.categories=h.concat(Object.keys(e).map((t=>e[t])))}else this.categories=[]}componentDidMount(){this.canvas=this.refs["tile-canvas-surface"],this.updateGalleryTiles(),this.redrawCanvas()}UNSAFE_componentWillReceiveProps(e){this.props.selected!=e.selected?this.jumpToPageContaining(e.selected):this.props.backgroundColor!=e.backgroundColor&&this.jumpToPageContaining(e.backgroundColor),this.refreshGallery(e)}componentDidUpdate(){this.updateGalleryTiles(),this.redrawCanvas()}render(){const{colors:e,selected:t,backgroundColor:i,tileset:r,category:s,page:d,drawingMode:p,galleryOpen:h}=this.props,g=r.tiles[t]?r.tiles[t].bitmap:m.data(),v=r.tiles[i]?r.tiles[i].bitmap:m.data();m.data(),this.updateGalleryTiles();let y=Math.ceil(this.categoryTiles.length/16);h||this.categoryTiles.length%16!=0||y++;const k=!h&&(1===y||d===y-1),w=h||!this.renderedTiles.some((e=>!b(e)&&e.index===t));return n.createElement("div",{className:"tile-palette"},n.createElement("div",{className:"tile-palette-fg-bg"},n.createElement("div",{className:"tile-palette-swatch fg "+(p==o.TileDrawingMode.Default?"selected":""),onClick:this.foregroundBackgroundClickHandler,role:"button"},n.createElement(a.TimelineFrame,{frames:[{bitmap:g}],colors:e})),n.createElement("div",{className:"tile-palette-swatch bg",onClick:this.foregroundBackgroundClickHandler,role:"button"},n.createElement(a.TimelineFrame,{frames:[{bitmap:v}],colors:e}),n.createElement(u.IconButton,{iconClass:"ms-Icon ms-Icon--ReturnKey",title:lf("Swap the background and foreground colors."),toggle:!0})),n.createElement("div",{className:"tile-palette-swatch wall "+(p==o.TileDrawingMode.Wall?"selected":""),onClick:this.wallClickHandler,title:lf("Draw walls"),role:"button"},n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1000 1000",width:"1000",height:"1000"},n.createElement("path",{d:"M 968.49289,108.05443 771.30518,3.7581533 183.65231,166.0694 l 2.58963,202.62638 -156.247366,54.4148 0.872799,492.65563 179.544267,81.08212 758.08125,-222.4989 z M 765.6275,42.836761 916.79721,122.02922 412.26526,262.35026 250.08966,187.43643 Z M 934.62189,739.077 234.56171,946.92199 233.81426,554.79578 422.38222,493.25053 423.42046,300.4059 934.62189,157.54989 Z M 204.96854,402.33519 361.49056,473.98651 222.88861,518.46222 75.008408,444.5191 Z"})))),n.createElement(c.Pivot,{options:f,selected:h?1:0,onChange:this.pivotHandler}),n.createElement("div",{className:"tile-palette-controls-outer"},h&&n.createElement(l.Dropdown,{onChange:this.dropdownHandler,options:this.categories.filter((e=>!!e.tiles.length)),selected:s}),!h&&n.createElement("div",{className:"tile-palette-controls"},n.createElement(u.IconButton,{onClick:this.tileEditHandler,iconClass:"ms-Icon ms-Icon--SingleColumnEdit",title:lf("Edit the selected tile"),disabled:w,toggle:!w}),n.createElement(u.IconButton,{onClick:this.tileDuplicateHandler,iconClass:"ms-Icon ms-Icon--Copy",title:lf("Duplicate the selected tile"),disabled:w,toggle:!w}),n.createElement(u.IconButton,{onClick:this.tileDeleteAlertHandler,iconClass:"ms-Icon ms-Icon--Delete",title:lf("Delete the selected tile"),disabled:w,toggle:!w}))),n.createElement("div",{className:"tile-canvas-outer",onContextMenu:this.preventContextMenu},n.createElement("div",{className:"tile-canvas"},n.createElement("canvas",{ref:"tile-canvas-surface",className:"paint-surface",onMouseDown:this.canvasClickHandler,onTouchStart:this.canvasTouchHandler,role:"complementary"}),k&&n.createElement("div",{ref:"create-tile-ref"},n.createElement(u.IconButton,{onClick:this.tileCreateHandler,iconClass:"ms-Icon ms-Icon--Add",title:lf("Create a new tile"),toggle:!0}))),n.createElement("div",{className:"tile-canvas-controls"},function(e,t,i){const r=16+5*(e-1),o=[];for(let i=0;i<e;i++)o[i]=i===t;return n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${r} 10`,className:"tile-palette-pages "+(e<2?"disabled":"")},n.createElement("polygon",{className:"tile-palette-page-arrow",points:"1,5 4,3 4,7",onClick:t?()=>i(t-1):void 0}),o.map(((e,t)=>n.createElement("circle",{className:"tile-palette-page-dot",key:t,cx:8+5*t,cy:"5",r:e?2:1,onClick:e?void 0:()=>i(t)}))),n.createElement("polygon",{className:"tile-palette-page-arrow",points:`${r-1},5 ${r-4},3 ${r-4},7`,onClick:t<e-1?()=>i(t+1):void 0}))}(y,d,this.pageHandler))))}updateGalleryTiles(){const{page:e,category:t,galleryOpen:i}=this.props;this.categoryTiles=i?this.categories[t].tiles:this.getCustomTiles().map((([e,t])=>({index:t,bitmap:e.bitmap})));const n=16*e;this.renderedTiles=this.categoryTiles.slice(n,n+16)}jumpToPageContaining(e){const{tileset:t,dispatchSetGalleryOpen:i,dispatchChangeTilePaletteCategory:n,dispatchChangeTilePalettePage:r}=this.props;if(!e||e<0||e>=t.tiles.length)return;const o=t.tiles[e];if(o.isProjectTile){const e=this.getCustomTiles().map((([e,t])=>e));if(!e)return;const t=Math.max(Math.floor(e.findIndex((e=>e.id==o.id))/16),0);i(!1),r(t)}else{const e=this.categories.find((e=>-1!==e.tiles.findIndex((e=>e.qualifiedName==o.id))));if(!e||!e.tiles)return;const t=Math.max(Math.floor(e.tiles.findIndex((e=>e.qualifiedName==o.id))/16),0);i(!0),n(this.categories.indexOf(e)),r(t)}}redrawCanvas(){const{tileset:e,page:t,selected:i}=this.props,n=4*t*4,r=e.tileWidth+1;this.canvas.width=(4*r+1)*p,this.canvas.height=(4*r+1)*p;const o=this.canvas.getContext("2d");for(let e=0;e<4;e++)for(let t=0;t<4;t++){const s=this.categoryTiles[n+4*e+t];s&&(b(s)||s.index!==i||(o.fillStyle="#ff0000",o.fillRect(t*r,e*r,r+1,r+1)),o.fillStyle="#333333",o.fillRect(t*r+1,e*r+1,r-1,r-1),this.drawBitmap(pxt.sprite.Bitmap.fromData(s.bitmap),1+t*r,1+e*r))}this.positionCreateTileButton()}drawBitmap(e,t=0,i=0,n=!0,r=p,o=this.canvas){const{colors:s}=this.props,a=o.getContext("2d");a.imageSmoothingEnabled=!1;for(let o=0;o<e.width;o++)for(let l=0;l<e.height;l++){const c=e.get(o,l);c?(a.fillStyle=s[c],a.fillRect((o+t)*r,(l+i)*r,r,r)):n||a.clearRect((o+t)*r,(l+i)*r,r,r)}}handleCanvasClickCore(e,t,i){const n=this.canvas.getBoundingClientRect(),r=(e-n.left)/(n.width/4)|0,s=(t-n.top)/(n.height/4)|0,a=this.renderedTiles[4*s+r];if(a){let e,t;if(b(a)?(e=this.getTileIndex(a),t=a.qualifiedName):e=a.index,e>=0)i?this.props.dispatchChangeBackgroundColor(e):this.props.dispatchChangeSelectedColor(e);else{const{selected:e,backgroundColor:n,tileset:r}=this.props,o=r.tiles.length||1;this.props.dispatchCreateNewTile(null,i?e:o,i?o:n,t)}this.props.dispatchChangeDrawingMode(o.TileDrawingMode.Default)}}refreshGallery(e){const{gallery:t,tileset:i}=e;t&&h.forEach((e=>{e.tiles=t.filter((t=>-1!==t.tags.indexOf(e.id)&&t.tileWidth===i.tileWidth))}))}positionCreateTileButton(){const e=this.refs["create-tile-ref"];if(e){const t=this.categoryTiles.length%4,i=Math.floor(this.categoryTiles.length/4)%4;e.style.position="absolute",e.style.left="calc("+t/4+" * (100% - 0.5rem) + 0.25rem)",e.style.top="calc("+i/4+" * (100% - 0.5rem) + 0.25rem)"}}getCustomTiles(){return this.props.tileset.tiles.map(((e,t)=>[e,t])).filter((([e])=>e.isProjectTile)).sort((([e],[t])=>{const i="myTiles.transparency"+this.props.tileset.tileWidth;return e.id==i?-1:t.id==i?1:e.internalID-t.internalID}))}getTileIndex(e){const{tileset:t}=this.props;for(let i=0;i<t.tiles.length;i++)if(t.tiles[i].id===e.qualifiedName)return i;return-1}}function b(e){return!!e.qualifiedName}const v={dispatchChangeSelectedColor:s.dispatchChangeSelectedColor,dispatchChangeBackgroundColor:s.dispatchChangeBackgroundColor,dispatchSwapBackgroundForeground:s.dispatchSwapBackgroundForeground,dispatchChangeTilePalettePage:s.dispatchChangeTilePalettePage,dispatchChangeTilePaletteCategory:s.dispatchChangeTilePaletteCategory,dispatchChangeDrawingMode:s.dispatchChangeDrawingMode,dispatchCreateNewTile:s.dispatchCreateNewTile,dispatchSetGalleryOpen:s.dispatchSetGalleryOpen,dispatchOpenTileEditor:s.dispatchOpenTileEditor,dispatchDeleteTile:s.dispatchDeleteTile,dispatchShowAlert:s.dispatchShowAlert,dispatchHideAlert:s.dispatchHideAlert};i.TilePalette=r.connect((function({store:{present:e},editor:t},i){let n=e;return n?{selected:t.selectedColor,tileset:n.tileset,backgroundColor:t.backgroundColor,category:t.tilemapPalette.category,page:t.tilemapPalette.page,colors:n.colors,drawingMode:t.drawingMode,gallery:t.tileGallery,galleryOpen:t.tileGalleryOpen,referencedTiles:t.referencedTiles}:{}}),v)(g)},{"../../../assets":18,"../Button":34,"../Dropdown":36,"../Pivot":39,"../TimelineFrame":42,"../actions/dispatch":45,"../store/imageReducer":49,react:335,"react-redux":314}],53:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.replaceColorEdit=i.outlineEdit=i.flipEdit=i.rotateEdit=i.MarqueeEdit=i.FillEdit=i.CircleEdit=i.LineEdit=i.OutlineEdit=i.RectangleEdit=i.PaintEdit=i.SelectionEdit=i.Edit=i.EditState=i.getEditState=i.getEdit=i.tools=i.ToolCursor=void 0;const n=e("./store/imageReducer");var r,o;(o=r=i.ToolCursor||(i.ToolCursor={})).None="none",o.Default="default",o.Pointer="pointer",o.Crosshair="crosshair",o.Grab="grab",o.Grabbing="grabbing",o.EyeDropper="var(--eyedropper)",i.tools=[{tool:n.ImageEditorTool.Paint,iconClass:"ms-Icon ms-Icon--Edit",title:lf("Paint Tool"),hoverCursor:r.Crosshair},{tool:n.ImageEditorTool.Erase,iconClass:"ms-Icon ms-Icon--EraseTool",title:lf("Erase Tool"),hoverCursor:r.Crosshair},{tool:n.ImageEditorTool.Rect,iconClass:"ms-Icon ms-Icon--RectangleShape",title:lf("Rectangle Tool"),hoverCursor:r.Crosshair},{tool:n.ImageEditorTool.Fill,iconClass:"ms-Icon ms-Icon--BucketColor",title:lf("Fill Tool"),hoverCursor:r.Crosshair},{tool:n.ImageEditorTool.Circle,iconClass:"ms-Icon ms-Icon--CircleRing",title:lf("Circle Tool"),hoverCursor:r.Crosshair},{tool:n.ImageEditorTool.Line,iconClass:"ms-Icon ms-Icon--Line",title:lf("Line Tool"),hoverCursor:r.Crosshair},{tool:n.ImageEditorTool.Marquee,iconClass:"ms-Icon ms-Icon--SelectAll",title:lf("Marquee Tool"),hoverCursor:r.Crosshair,hoverLayerCursor:r.Grab,downLayerCursor:r.Grabbing},{tool:n.ImageEditorTool.Pan,iconClass:"ms-Icon ms-Icon--HandsFree",title:lf("Canvas Pan Tool"),hoverCursor:r.Grab,downCursor:r.Grabbing},{tool:n.ImageEditorTool.ColorSelect,hiddenTool:!0,iconClass:"ms-Icon ms-Icon--Edit",title:lf("Color Select Tool"),hoverCursor:r.EyeDropper}],i.getEdit=function(e,t,i,r){switch(e){case n.ImageEditorTool.Paint:return new c(t.width,t.height,i,r);case n.ImageEditorTool.Rect:return new u(t.width,t.height,i,r);case n.ImageEditorTool.Fill:return new h(t.width,t.height,i,r);case n.ImageEditorTool.Line:return new d(t.width,t.height,i,r);case n.ImageEditorTool.Marquee:return new f(t.width,t.height,i,r);case n.ImageEditorTool.Circle:return new p(t.width,t.height,i,r);case n.ImageEditorTool.Erase:return new c(t.width,t.height,0,r);case n.ImageEditorTool.ColorSelect:default:return}},i.getEditState=function(e,t,i=n.TileDrawingMode.Default){const r=new s(t?pxt.sprite.Tilemap.fromData(e.bitmap).copy():pxt.sprite.Bitmap.fromData(e.bitmap).copy());let o,a,l;return e.overlayLayers&&(r.overlayLayers=e.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy()))),r.layerOffsetX=e.layerOffsetX,r.layerOffsetY=e.layerOffsetY,e.floating&&(e.floating.bitmap&&(a=t?pxt.sprite.Tilemap.fromData(e.floating.bitmap).copy():pxt.sprite.Bitmap.fromData(e.floating.bitmap).copy()),e.floating.overlayLayers&&(l=e.floating.overlayLayers.map((e=>pxt.sprite.Bitmap.fromData(e).copy()))),o={image:a,overlayLayers:l}),r.floating=o,r.setActiveLayer(i),r};class s{constructor(e){this.activeLayerIndex=-1,this.image=e,this.layerOffsetX=0,this.layerOffsetY=0}get width(){return this.image.width}get height(){return this.image.height}get activeLayer(){return this.activeLayerIndex<0?this.image:this.overlayLayers[this.activeLayerIndex]}setActiveLayer(e){switch(e){case n.TileDrawingMode.Wall:this.activeLayerIndex=0;break;default:this.activeLayerIndex=-1}}copy(){const e=new s;if(e.image=this.image.copy(),e.overlayLayers=this.overlayLayers&&this.overlayLayers.map((e=>e.copy())),this.floating){let t,i;this.floating.image&&(t=this.floating.image.copy()),this.floating.overlayLayers&&(i=this.floating.overlayLayers.map((e=>e.copy()))),e.floating={image:t,overlayLayers:i}}return e.layerOffsetX=this.layerOffsetX,e.layerOffsetY=this.layerOffsetY,e}equals(e){return!(!this.image.equals(e.image)||this.floating&&!e.floating||!this.floating&&e.floating)&&(!this.floating||!this.floating.image||this.floating.image.equals(e.floating.image)&&this.layerOffsetX===e.layerOffsetX&&this.layerOffsetY===e.layerOffsetY)}mergeFloatingLayer(){this.floating&&(this.floating.image||this.floating.overlayLayers)&&(this.floating.image&&(this.floating.image.x0=this.layerOffsetX,this.floating.image.y0=this.layerOffsetY,this.image.apply(this.floating.image,!0),this.floating.image=void 0),this.floating.overlayLayers&&(this.floating.overlayLayers.forEach(((e,t)=>{e.x0=this.layerOffsetX,e.y0=this.layerOffsetY,this.overlayLayers[t].apply(e,!0)})),this.floating.overlayLayers=void 0))}copyToLayer(e,t,i,n,r=!1){if(0===i||0===n)return;i<0&&(e+=i,i=-i),n<0&&(t+=n,n=-n);let o,s=this.image.copy(e,t,i,n);if(this.layerOffsetX=s.x0,this.layerOffsetY=s.y0,s.x0=void 0,s.y0=void 0,this.overlayLayers&&(o=this.overlayLayers.map((r=>r.copy(e,t,i,n)))),r)for(let r=0;r<i;r++)for(let i=0;i<n;i++)this.image.set(e+r,t+i,0),this.overlayLayers&&this.overlayLayers.forEach((n=>n.set(e+r,t+i,0)));this.floating={image:s,overlayLayers:o}}inFloatingLayer(e,t){return!(!this.floating||!this.floating.image)&&(e-=this.layerOffsetX,t-=this.layerOffsetY,e>=0&&e<this.floating.image.width&&t>=0&&t<this.floating.image.height)}setFloatingLayer(e,t,i){var n,r;i&&this.mergeFloatingLayer(),this.floating={image:e},this.layerOffsetX=null!==(n=null==t?void 0:t.layerOffsetX)&&void 0!==n?n:0,this.layerOffsetY=null!==(r=null==t?void 0:t.layerOffsetY)&&void 0!==r?r:0}toImageState(){return{bitmap:this.image.data(),layerOffsetX:this.layerOffsetX,layerOffsetY:this.layerOffsetY,floating:this.floating&&{bitmap:this.floating.image?this.floating.image.data():void 0,overlayLayers:this.floating.overlayLayers?this.floating.overlayLayers.map((e=>e.data())):void 0},overlayLayers:this.overlayLayers?this.overlayLayers.map((e=>e.data())):void 0}}}i.EditState=s;class a{constructor(e,t,i,n){this.canvasWidth=e,this.canvasHeight=t,this.color=i,this.toolWidth=n}doEdit(e){this.isStarted&&this.doEditCore(e)}inBounds(e,t){return e>=0&&e<this.canvasWidth&&t>=0&&t<this.canvasHeight}start(e,t,i,n,r){this.isStarted=!0,this.startCol=e,this.startRow=t,this.startX=i,this.startY=n}drawCursor(e,t,i){i(e,t)}}i.Edit=a;class l extends a{update(e,t){this.endCol=e,this.endRow=t,this.isDragged||e==this.startCol&&t==this.startRow||(this.isDragged=!0)}topLeft(){return{x:Math.min(this.startCol,this.endCol),y:Math.min(this.startRow,this.endRow)}}bottomRight(){return{x:Math.max(this.startCol,this.endCol),y:Math.max(this.startRow,this.endRow)}}}i.SelectionEdit=l;class c extends a{constructor(e,t,i,n){super(e,t,i,n),this.showPreview=!0,this.mask=new pxt.sprite.Bitmask(e,t)}update(e,t){this.interpolate(this.startCol,this.startRow,e,t),this.startCol=e,this.startRow=t}interpolate(e,t,i,n){const r=i-e,o=n-t,s=(e,t)=>this.mask.set(e,t);if(0===r){const i=o>=0?n:t;for(let r=o>=0?t:n;r<=i;r++)this.drawCore(e,r,s);return}const a=r>0?1:-1,l=o>0?1:-1,c=Math.abs(o/r);let u=0,d=t;for(let t=e;a>0?t<=i:t>=i;t+=a)for(this.drawCore(t,d,s),u+=c;u>=.5;)(l>0?d<=n:d>=n)&&this.drawCore(t,d,s),d+=l,u-=1}doEditCore(e){e.mergeFloatingLayer();for(let t=0;t<e.width;t++)for(let i=0;i<e.height;i++)this.mask.get(t,i)&&e.activeLayer.set(t,i,this.color)}drawCursor(e,t,i){this.drawCore(e,t,i)}drawCore(e,t,i){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(let n=0;n<this.toolWidth;n++)for(let r=0;r<this.toolWidth;r++){const o=e+n,s=t+r;o>=0&&o<this.canvasWidth&&s>=0&&s<this.canvasHeight&&i(e+n,t+r)}}}i.PaintEdit=c;i.RectangleEdit=class extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();const t=this.topLeft(),i=this.bottomRight();for(let n=t.x;n<=i.x;n++)for(let r=t.y;r<=i.y;r++)e.activeLayer.set(n,r,this.color)}};class u extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();let t=this.topLeft();t.x-=this.toolWidth>>1,t.y-=this.toolWidth>>1;let i=this.bottomRight();i.x+=this.toolWidth>>1,i.y+=this.toolWidth>>1;for(let n=0;n<this.toolWidth;n++)this.drawRectangle(e,{x:t.x+n,y:t.y+n},{x:i.x-n,y:i.y-n})}drawRectangle(e,t,i){if(!(t.x>i.x||t.y>i.y)){for(let n=t.x;n<=i.x;n++)e.activeLayer.set(n,t.y,this.color),e.activeLayer.set(n,i.y,this.color);for(let n=t.y;n<=i.y;n++)e.activeLayer.set(t.x,n,this.color),e.activeLayer.set(i.x,n,this.color)}}drawCursor(e,t,i){this.drawCore(e,t,i)}drawCore(e,t,i){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(let n=0;n<this.toolWidth;n++)for(let r=0;r<this.toolWidth;r++){const o=e+n,s=t+r;o>=0&&o<this.canvasWidth&&s>=0&&s<this.canvasHeight&&i(e+n,t+r)}}}i.OutlineEdit=u;class d extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer(),this.bresenham(this.startCol,this.startRow,this.endCol,this.endRow,e)}bresenham(e,t,i,n,r){const o=i-e,s=n-t,a=(e,t)=>r.activeLayer.set(e,t,this.color);if(0===o){const i=s>=0?n:t;for(let r=s>=0?t:n;r<=i;r++)this.drawCore(e,r,a);return}const l=o>0?1:-1,c=s>0?1:-1,u=Math.abs(s/o);let d=0,p=t;for(let t=e;l>0?t<=i:t>=i;t+=l)for(this.drawCore(t,p,a),d+=u;d>=.5;)(c>0?p<=n:p>=n)&&this.drawCore(t,p,a),p+=c,d-=1}drawCursor(e,t,i){this.drawCore(e,t,i)}drawCore(e,t,i){e-=Math.floor(this.toolWidth/2),t-=Math.floor(this.toolWidth/2);for(let n=0;n<this.toolWidth;n++)for(let r=0;r<this.toolWidth;r++)i(e+n,t+r)}}i.LineEdit=d;class p extends l{constructor(){super(...arguments),this.showPreview=!0}doEditCore(e){e.mergeFloatingLayer();const t=this.topLeft(),i=this.bottomRight(),n=i.x-t.x,r=i.y-t.y,o=Math.floor(Math.hypot(n,r)),s=this.startCol,a=this.startRow;this.midpoint(s,a,o,e)}midpoint(e,t,i,n){let r=i-1,o=0,s=1,a=1,l=s-2*i;for(;r>=o;)n.activeLayer.set(e+r,t+o,this.color),n.activeLayer.set(e+r,t-o,this.color),n.activeLayer.set(e+o,t+r,this.color),n.activeLayer.set(e+o,t-r,this.color),n.activeLayer.set(e-o,t+r,this.color),n.activeLayer.set(e-o,t-r,this.color),n.activeLayer.set(e-r,t+o,this.color),n.activeLayer.set(e-r,t-o,this.color),l<=0&&(o++,l+=a,a+=2),l>0&&(r--,l+=(s+=2)-2*i)}}i.CircleEdit=p;class h extends a{constructor(){super(...arguments),this.showPreview=!0}start(e,t,i,n,r){this.isStarted=!0,this.col=e,this.row=t}update(e,t){this.col=e,this.row=t}doEditCore(e){const t=e.activeLayer!==e.image,i=(i,n)=>(t?e.activeLayer.get(i,n)+1<<8:0)+e.image.get(i,n),n=i(this.col,this.row);if(n===this.color)return;e.mergeFloatingLayer();const r=new pxt.sprite.Bitmask(e.width,e.height);r.set(this.col,this.row);const o=[{x:this.col,y:this.row}];for(;o.length;){const t=o.pop();i(t.x,t.y)===n&&(e.activeLayer.set(t.x,t.y,this.color),s(t.x+1,t.y),s(t.x-1,t.y),s(t.x,t.y+1),s(t.x,t.y-1))}function s(e,t){e>=0&&e<r.width&&t>=0&&t<r.height&&!r.get(e,t)&&(r.set(e,t),o.push({x:e,y:t}))}}}i.FillEdit=h;class f extends l{constructor(){super(...arguments),this.isMove=!1,this.isResize=!1,this.showPreview=!1}start(e,t,i,n,r){this.isStarted=!0,this.startCol=e,this.startRow=t;const o=document.elementFromPoint(i,n);if(r.floating&&r.floating.image)if(o&&"image-editor-floating-layer-corner"==o.className){this.isResize=!0,this.startOffsetX=r.layerOffsetX,this.startOffsetY=r.layerOffsetY;let e,t=0;const o=document.getElementsByClassName("image-editor-floating-layer-corner");for(let r=0;r<o.length;r++){let s=Math.sqrt(Math.pow(o[r].getBoundingClientRect().x-i,2)+Math.pow(o[r].getBoundingClientRect().y-n,2));s>t&&(t=s,e=o[r])}const s=document.getElementsByClassName("paint-surface");let a;for(let e=0;e<s.length;e++)s[e].className.includes("main")&&(a=s[e]);const l=a.getBoundingClientRect().left,c=a.getBoundingClientRect().top,u=a.getBoundingClientRect().width,d=a.getBoundingClientRect().height;this.anchorCol=(e.getBoundingClientRect().x-l)/u*this.canvasWidth,this.anchorRow=(e.getBoundingClientRect().y-c)/d*this.canvasHeight,this.originalImage||(this.originalImage=r.floating.image.copy())}else r.inFloatingLayer(e,t)&&(this.isMove=!0,this.startOffsetX=r.layerOffsetX,this.startOffsetY=r.layerOffsetY)}inBounds(e,t){return this.isMove||super.inBounds(e,t)}doEditCore(e){const t=this.topLeft(),i=this.bottomRight();if(this.isDragged)if(this.isMove)e.layerOffsetX=this.startOffsetX+this.endCol-this.startCol,e.layerOffsetY=this.startOffsetY+this.endRow-this.startRow;else if(this.isResize){const t=Math.round(Math.abs(this.anchorCol-this.endCol)),i=Math.round(Math.abs(this.anchorRow-this.endRow)),n=function(e,t,i){const n=new pxt.sprite.Bitmap(t,i,0,0);for(let r=0;r<t;r++)for(let o=0;o<i;o++){const s=Math.floor(r/t*e.width),a=Math.floor(o/i*e.height),l=e.get(s,a);n.set(r,o,l)}return n}(this.originalImage,t,i);e.setFloatingLayer(n,{layerOffsetX:Math.round(Math.min(this.anchorCol,this.endCol)),layerOffsetY:Math.round(Math.min(this.anchorRow,this.endRow))},!1)}else e.mergeFloatingLayer(),e.copyToLayer(t.x,t.y,i.x-t.x+1,i.y-t.y+1,!0);else this.isMove||e.mergeFloatingLayer()}}i.MarqueeEdit=f,i.rotateEdit=function(e,t,i,n){var r;const o=!!(null===(r=e.floating)||void 0===r?void 0:r.image),a=o?e.floating:e,l=i?new pxt.sprite.Tilemap(a.image.height,a.image.width):new pxt.sprite.Bitmap(a.image.height,a.image.width),c=a.overlayLayers?a.overlayLayers.map((e=>new pxt.sprite.Bitmap(e.height,e.width))):void 0;for(let e=0;e<a.image.width;e++)for(let t=0;t<a.image.height;t++)d(a.image,l,e,t),c&&c.forEach(((i,n)=>d(a.overlayLayers[n],i,e,t)));const u=l.width===l.height&&l.width===e.image.width&&e.image.width===e.image.height;if(!n&&!o||u){const e=new s(l);return e.overlayLayers=c,e}if(!o)for(let t=0;t<e.width;t++)for(let i=0;i<e.height;i++)e.image.set(t,i,0),e.overlayLayers&&e.overlayLayers.forEach((e=>null==e?void 0:e.set(t,i,0)));return(l.width===e.image.height&&l.height===e.image.width||l.width===e.image.width&&l.height===e.image.height)&&(e.layerOffsetX=(e.width>>1)-(l.width>>1),e.layerOffsetY=(e.height>>1)-(l.height>>1)),e.floating={image:l,overlayLayers:c},e;function d(e,i,n,r){t?i.set(r,n,e.get(n,e.height-r-1)):i.set(r,n,e.get(e.width-n-1,r))}},i.flipEdit=function(e,t,i){var n,r;const o=(null===(n=e.floating)||void 0===n?void 0:n.image)?e.floating:e,a=i?new pxt.sprite.Tilemap(o.image.width,o.image.height):new pxt.sprite.Bitmap(o.image.width,o.image.height),l=o.overlayLayers?o.overlayLayers.map((e=>new pxt.sprite.Bitmap(e.width,e.height))):void 0;for(let e=0;e<o.image.width;e++)for(let t=0;t<o.image.height;t++)c(o.image,a,e,t),l&&l.forEach(((i,n)=>c(o.overlayLayers[n],i,e,t)));if(null===(r=e.floating)||void 0===r?void 0:r.image)return e.floating={image:a,overlayLayers:l},e;{const e=new s(a);return e.overlayLayers=l,e}function c(e,i,n,r){t?i.set(n,r,e.get(n,e.height-r-1)):i.set(n,r,e.get(e.width-n-1,r))}},i.outlineEdit=function(e,t){var i,n;const r=(null===(i=e.floating)||void 0===i?void 0:i.image)?e.floating:e,o=e.copy(),s=(null===(n=null==e?void 0:e.floating)||void 0===n?void 0:n.image)?o.floating.image:o.image;for(let e=0;e<r.image.width;e++)for(let i=0;i<r.image.height;i++)0===r.image.get(e,i)&&(0===r.image.get(e-1,i)&&0===r.image.get(e,i-1)&&0===r.image.get(e+1,i)&&0===r.image.get(e,i+1)||s.set(e,i,t));return o},i.replaceColorEdit=function(e,t,i){var n,r;const o=(null===(n=e.floating)||void 0===n?void 0:n.image)?e.floating:e,s=e.copy(),a=(null===(r=null==e?void 0:e.floating)||void 0===r?void 0:r.image)?s.floating.image:s.image;for(let e=0;e<o.image.width;e++)for(let n=0;n<o.image.height;n++)o.image.get(e,n)===t&&a.set(e,n,i);return s}},{"./store/imageReducer":49}],54:[function(e,t,i){"use strict";function n(){return"undefined"!=typeof window&&!!window.PointerEvent}function r(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0)}var o;Object.defineProperty(i,"__esModule",{value:!0}),i.createTilemapPatchFromFloatingLayer=i.applyBitmapData=i.imageStateToTilemap=i.imageStateToBitmap=i.bindGestureEvents=i.GestureState=i.fireClickOnlyOnEnter=i.clientCoord=i.pointerEvents=i.Bitmask=i.MapTools=i.isBitmapSupported=i.isTouchEnabled=i.hasPointerEvents=i.DRAG_RADIUS=void 0,i.DRAG_RADIUS=3,i.hasPointerEvents=n,i.isTouchEnabled=r,i.isBitmapSupported=function(){return!!window.createImageBitmap},(o=i.MapTools||(i.MapTools={}))[o.Pan=0]="Pan",o[o.Stamp=1]="Stamp",o[o.Object=2]="Object",o[o.Erase=3]="Erase";function s(e){if(e.touches){const t=e;return t.touches.length?t.touches[0]:t.changedTouches[0]}return e}i.Bitmask=class{constructor(e,t){this.width=e,this.height=t,this.mask=new Uint8Array(Math.ceil(e*t/8))}set(e,t){const i=e+this.width*t,n=i>>3,r=7&i;this.mask[n]|=1<<r}get(e,t){const i=e+this.width*t,n=i>>3,r=7&i;return this.mask[n]>>r&1}},i.pointerEvents=n()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:r()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"},i.clientCoord=s,i.fireClickOnlyOnEnter=function(e){13===("number"==typeof e.which?e.which:e.keyCode)&&(e.preventDefault(),e.currentTarget.click())};class a{constructor(e,t,i){this.target=e,this.isRightClick=i,this.startX=t.clientX,this.startY=t.clientY,this.currentX=t.clientX,this.currentY=t.clientY}update(e){this.currentX=e.clientX,this.currentY=e.clientY,!this.isDrag&&this.distance()>i.DRAG_RADIUS?(this.isDrag=!0,this.target.onDragStart(e,this.isRightClick)):this.isDrag&&this.target.onDragMove(e)}end(e){e&&this.update(e),e=e||{clientX:this.currentX,clientY:this.currentY},this.isDrag?this.target.onDragEnd(e):this.target.onClick(e,this.isRightClick)}distance(){return Math.sqrt(Math.pow(this.currentX-this.startX,2)+Math.pow(this.currentY-this.startY,2))}}function l(e,t){for(let i=0;i<e.changedTouches.length;i++)if(e.changedTouches[i].identifier===t)return e.changedTouches[i]}function c(e){return e.button>0}i.GestureState=a,i.bindGestureEvents=function(e,t){n()?function(e,t){let i;e.addEventListener("pointerup",(e=>{i&&(i.end(s(e)),e.preventDefault()),i=void 0})),e.addEventListener("pointerdown",(e=>{i&&i.end(),i=new a(t,s(e),c(e)),e.preventDefault()})),e.addEventListener("pointermove",(e=>{i&&(i.update(s(e)),e.preventDefault())})),e.addEventListener("pointerleave",(e=>{i&&(i.end(s(e)),e.preventDefault()),i=void 0}))}(e,t):r()?function(e,t){let i,n;e.addEventListener("touchend",(e=>{if(i&&n){const t=l(e,n);t&&(i.end(t),i=void 0,e.preventDefault())}})),e.addEventListener("touchstart",(e=>{i&&i.end(),n=e.changedTouches[0].identifier,i=new a(t,e.changedTouches[0],c(e))})),e.addEventListener("touchmove",(e=>{if(i&&n){const t=l(e,n);t&&(i.update(t),e.preventDefault())}})),e.addEventListener("touchcancel",(e=>{if(i&&n){const t=l(e,n);t&&(i.end(t),i=void 0,e.preventDefault())}}))}(e,t):function(e,t){let i;e.addEventListener("mouseup",(e=>{i&&i.end(s(e)),i=void 0})),e.addEventListener("mousedown",(e=>{i&&i.end(),i=new a(t,s(e),c(e))})),e.addEventListener("mousemove",(e=>{i&&i.update(s(e))})),e.addEventListener("mouseleave",(e=>{i&&i.end(s(e)),i=void 0}))}(e,t)},i.imageStateToBitmap=function(e){const t=pxt.sprite.Bitmap.fromData(e.bitmap);if(e.floating&&e.floating.bitmap){const i=pxt.sprite.Bitmap.fromData(e.floating.bitmap);i.x0=e.layerOffsetX||0,i.y0=e.layerOffsetY||0,t.apply(i,!0)}return t},i.imageStateToTilemap=function(e){const t=pxt.sprite.Tilemap.fromData(e.bitmap);if(e.floating&&e.floating.bitmap){const i=pxt.sprite.Tilemap.fromData(e.floating.bitmap);i.x0=e.layerOffsetX||0,i.y0=e.layerOffsetY||0,t.apply(i,!0)}return t},i.applyBitmapData=function(e,t,i=0,n=0){if(!e||!t)return e;const r=pxt.sprite.Bitmap.fromData(e),o=pxt.sprite.Bitmap.fromData(t);return o.x0=i,o.y0=n,r.apply(o,!0),r.data()},i.createTilemapPatchFromFloatingLayer=function(e,t){if(!e.floating)return;const i=pxt.sprite.Tilemap.fromData(e.floating.image.data()),n=new pxt.sprite.Tilemap(i.width,i.height),r=e.floating.overlayLayers?e.floating.overlayLayers.map((e=>pxt.sprite.base64EncodeBitmap(e.data()))):[];let o=[];for(let e=0;e<i.width;e++)for(let r=0;r<i.height;r++){const s=t.tiles[i.get(e,r)],a=o.indexOf(s);-1===a?(n.set(e,r,o.length),o.push(s)):n.set(e,r,a)}return{map:pxt.sprite.hexEncodeTilemap(n),layers:r,tiles:o.map((e=>pxt.sprite.base64EncodeBitmap(e.bitmap)))}}},{}],55:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ImageFieldEditor=void 0;const n=e("react"),r=e("./assetEditor/assetCard"),o=e("../assets"),s=e("./ImageEditor/ImageEditor"),a=e("./ImageEditor/keyboardShortcuts"),l=e("./ImageEditor/store/imageReducer"),c=e("./FilterPanel"),u=e("../util");class d extends n.Component{constructor(e){super(e),this.tagClickHandler=e=>{let t=this.state.gallerySelectedTags;const i=e.toLowerCase(),n=t.indexOf(i);n<0?t.push(i):t.splice(n,1),this.setState({gallerySelectedTags:t})},this.clearFilterTags=()=>{this.setState({gallerySelectedTags:[]})},this.toggleFilter=()=>{this.setState({filterOpen:!this.state.filterOpen})},this.showEditor=()=>{this.setImageEditorShortcutsEnabled(!0),f("gallery-editor"),this.setState({currentView:"editor",tileGalleryVisible:!1})},this.showGallery=()=>{this.setImageEditorShortcutsEnabled(!1),f("gallery-builtin"),this.setState({currentView:"gallery",tileGalleryVisible:!1})},this.showMyAssets=()=>{this.setImageEditorShortcutsEnabled(!1),f("gallery-my-assets"),this.userAssets=o.getAssets(void 0,void 0,this.options.temporaryAssets),this.setState({currentView:"my-assets",tileGalleryVisible:!1})},this.toggleTileGallery=()=>{this.state.tileGalleryVisible?this.setState({tileGalleryVisible:!1}):this.setState({tileGalleryVisible:!0,currentView:"editor"})},this.onAssetSelected=e=>{var t,i;if(this.ref&&e.id!==(null===(t=this.asset)||void 0===t?void 0:t.id))if(this.state.editingTile)this.ref.openInTileEditor(pxt.sprite.Bitmap.fromData(e.bitmap));else if("gallery"===this.state.currentView)this.ref.openGalleryAsset(e);else{const t=pxt.react.getTilemapProject();"tilemap"===(null===(i=this.asset)||void 0===i?void 0:i.type)&&pxt.sprite.updateTilemapReferencesFromResult(t,this.asset),this.asset.meta.displayName?t.updateAsset(this.asset):e.meta.displayName||(e=Object.assign(Object.assign({},pxt.cloneAsset(e)),{id:this.asset.id,meta:this.asset.meta})),"tilemap"===e.type&&pxt.sprite.addMissingTilemapTilesAndReferences(t,e),this.ref.openAsset(e,void 0,!0)}f("gallery-selection"),this.setState({currentView:"editor",tileGalleryVisible:!1}),this.setImageEditorShortcutsEnabled(!0)},this.onTileEditorOpenClose=e=>{this.setState({editingTile:e})},this.onDoneClick=()=>{this.closeEditor&&this.closeEditor(),this.props.doneButtonCallback&&this.props.doneButtonCallback()},this.state={currentView:"editor",headerVisible:!0,filterOpen:!1,gallerySelectedTags:[],galleryFilter:""},l.setTelemetryFunction(f)}get asset(){var e;return null===(e=this.ref)||void 0===e?void 0:e.getAsset()}render(){var e,t;const{currentView:i,headerVisible:r,editingTile:o,hideMyAssets:a,filterOpen:l}=this.state,d="gallery"===this.state.currentView&&l;let f=r;const m=!this.asset||o||"tilemap"!==this.asset.type,g=!a&&!o;this.asset&&!this.galleryAssets&&m&&this.updateGalleryAssets();const b=["tile","dialog","background"];let v=[],y=[];switch(i){case"my-assets":y=this.filterAssetsByType(this.userAssets,o?"tile":null===(e=this.asset)||void 0===e?void 0:e.type),v=this.getAvailableTags(y,b);break;case"gallery":y=this.filterAssetsByType(this.galleryAssets,o?"tile":null===(t=this.asset)||void 0===t?void 0:t.type,!0,!0),v=this.getAvailableTags(y,b),y=this.filterAssetsByTag(y)}const k=[{label:lf("Editor"),view:"editor",icon:"paint brush",onClick:this.showEditor},{label:lf("Gallery"),view:"gallery",icon:"picture",onClick:this.showGallery},{label:lf("My Assets"),view:"my-assets",icon:"folder",onClick:this.showMyAssets}];return m||g?m?g||k.splice(2,1):k.splice(1,1):f=!1,n.createElement("div",{className:"image-editor-wrapper"},f&&n.createElement("div",{className:"gallery-editor-header"},n.createElement("div",{className:"image-editor-header-left"}),n.createElement("div",{className:"image-editor-header-center"},n.createElement(h,{options:k,view:i})),n.createElement("div",{className:"image-editor-header-right"},n.createElement("div",{className:"gallery-filter-button "+("gallery"===this.state.currentView?"":"hidden"),role:"button",onClick:this.toggleFilter,onKeyDown:u.fireClickOnEnter},n.createElement("div",{className:"gallery-filter-button-icon"},n.createElement("i",{className:"icon filter"})),n.createElement("div",{className:"gallery-filter-button-label"},lf("Filter"))),!o&&n.createElement("div",{className:"image-editor-close-button",role:"button",onClick:this.onDoneClick},n.createElement("i",{className:"ui icon close"})))),n.createElement("div",{className:"image-editor-gallery-window"},n.createElement("div",{className:"image-editor-gallery-content"},n.createElement(s.ImageEditor,{ref:"image-editor",singleFrame:this.props.singleFrame,onDoneClicked:this.onDoneClick,onTileEditorOpenClose:this.onTileEditorOpenClose,lightMode:this.lightMode}),n.createElement(p,{items:y,hidden:"editor"===i,onAssetSelected:this.onAssetSelected})),n.createElement("div",{className:"filter-panel-gutter "+(d?"":"hidden")},n.createElement("div",{className:"filter-panel-container"},n.createElement(c.FilterPanel,{enabledTags:this.state.gallerySelectedTags,tagClickHandler:this.tagClickHandler,clearTags:this.clearFilterTags,tagOptions:v})))))}componentDidMount(){this.ref=this.refs["image-editor"],f("image-editor-shown")}componentWillUnmount(){f("image-editor-hidden"),this.galleryAssets=void 0,this.userAssets=void 0}init(e,t,i){switch(this.closeEditor=t,this.options=i,this.lightMode=i.lightMode,e.type){case"image":this.initSingleFrame(e,i);break;case"tile":i.disableResize=!0,this.initSingleFrame(e,i);break;case"animation":this.initAnimation(e,i);break;case"tilemap":this.initTilemap(e,i)}this.editID=e.id;let n=!1;i&&(this.blocksInfo=i.blocksInfo,i.filter&&(this.setState({galleryFilter:i.filter}),n=!0),null!=i.headerVisible&&(this.setState({headerVisible:i.headerVisible}),n=!0),null!=i.hideMyAssets&&(this.setState({hideMyAssets:i.hideMyAssets}),n=!0)),n||this.forceUpdate()}getValue(){return this.ref?this.ref.getAsset():null}getJres(){if(this.ref&&this.props.singleFrame){const e=this.ref.getCurrentFrame().data();return pxt.sprite.base64EncodeBitmap(e)}return""}getPersistentData(){return this.ref?this.ref.getPersistentData():null}restorePersistentData(e){this.ref&&(this.ref.restorePersistentData(e),this.options&&this.options.disableResize&&this.ref.disableResize())}onResize(){this.ref&&this.ref.onResize()}updateGalleryAssets(){this.galleryAssets=o.getAssets(!0,this.asset.type)}getAvailableTags(e,t){let i=[];return this.galleryAssets?(e.forEach((e=>{var n;null===(n=e.meta.tags)||void 0===n||n.forEach((e=>{const n=function(e){let t=0===e.indexOf("?")&&e.length>1?e.substring(1):e;return t.toLowerCase()}(e);t.indexOf(n)<0&&i.indexOf(n)<0&&i.push(n)}))})),i):[]}filterAssetsByTag(e){return this.state.gallerySelectedTags.length>0&&this.state.filterOpen&&(e=e.filter((e=>{var t;return!!(null===(t=e.meta.tags)||void 0===t?void 0:t.find((e=>this.state.gallerySelectedTags.indexOf(e)>=0)))}))),e}filterAssetsByType(e,t,i=!1,n){var r;if(void 0===t&&(t=null===(r=this.asset)||void 0===r?void 0:r.type),void 0===t)return e;if(this.asset&&!i&&(e=e.map((e=>e.type!==this.asset.type||e.id!==this.asset.id?e:o.assetToGalleryItem(this.getValue()))),this.state.editingTile)){const t=this.ref.getAsset();e=e.map((e=>{var i;return(null===(i=t.data.editedTiles)||void 0===i?void 0:i.indexOf(e.id))>=0?o.assetToGalleryItem(t.data.tileset.tiles.find((t=>t.id===e.id))):e}))}if(n){e.forEach((e=>{var t,i;!e.meta.tags&&this.options&&(e.meta.tags=(null===(i=null===(t=this.blocksInfo.apis.byQName[e.id])||void 0===t?void 0:t.attributes.tags)||void 0===i?void 0:i.split(" "))||[])}));const t=this.state.galleryFilter.split(" ").filter((e=>!!e)).map((e=>e.toLowerCase())),i=t.filter((e=>0!==e.indexOf("!"))),n=t.filter((e=>0===e.indexOf("!")&&e.length>1)).map((e=>e.substring(1)));e=e.filter((e=>function(e,t){const i=e.meta.tags?e.meta.tags:[];return t.every((e=>{const t=`?${e}`;return i.some((i=>i===e||i===t))}))}(e,i)&&function(e,t){const i=e.meta.tags?e.meta.tags:[];return t.every((e=>!i.some((t=>t===e))))}(e,n)))}if(i)switch(t){case"animation":return e.filter((e=>"animation"===e.type||"tile"===e.type||"image"===e.type));case"image":return e.filter((e=>"tile"===e.type||"image"===e.type));case"tile":return e.filter((e=>"tile"===e.type));case"tilemap":return e.filter((e=>"tilemap"===e.type))}else switch(t){case"animation":return e.filter((e=>"animation"===e.type));case"image":return e.filter((e=>"image"===e.type));case"tile":return e.filter((e=>"tile"===e.type));case"tilemap":return e.filter((e=>"tilemap"===e.type))}}initSingleFrame(e,t){this.ref.openAsset(e),t.disableResize&&this.ref.disableResize()}initAnimation(e,t){this.ref.openAsset(e),t.disableResize&&this.ref.disableResize()}initTilemap(e,t){let i;t&&(this.blocksInfo=t.blocksInfo,i=pxt.sprite.filterItems(pxt.sprite.getGalleryItems(this.blocksInfo,"Image"),["tile"]).map((e=>({bitmap:pxt.sprite.getBitmap(this.blocksInfo,e.qName).data(),tags:e.tags,qualifiedName:e.qName,tileWidth:16})))),this.ref.openAsset(e,i)}loadJres(e){if(e)try{this.ref.setCurrentFrame(pxt.sprite.getBitmapFromJResURL(e),!0)}catch(e){return}}setImageEditorShortcutsEnabled(e){e&&this.shortcutLock?(a.releaseShortcutLock(this.shortcutLock),this.shortcutLock=void 0):e||this.shortcutLock||(this.shortcutLock=a.obtainShortcutLock())}}i.ImageFieldEditor=d;class p extends n.Component{constructor(){super(...arguments),this.clickHandler=e=>{this.props.onAssetSelected(e)}}render(){let{items:e,hidden:t}=this.props;return n.createElement("div",{className:"image-editor-gallery "+(e&&!t?"visible":"")},!t&&e&&e.map(((e,t)=>n.createElement(r.AssetCardView,{key:t,asset:e,selected:!1,onClick:this.clickHandler}))))}}class h extends n.Component{render(){const{options:e,view:t}=this.props,i=e.length>2,r=e.findIndex((e=>e.view===t)),o=e[0],s=i?e[1]:void 0,a=i?e[2]:e[1];let l;return l=i?["left","center","right"][r]:["left","right"][r]+" no-gallery",n.createElement("div",{className:`gallery-editor-toggle ${l} ${pxt.BrowserUtils.isEdge()?"edge":""}`},n.createElement("div",{className:"gallery-editor-toggle-label gallery-editor-toggle-left",onClick:o.onClick,role:"button"},o.icon&&n.createElement("i",{className:`ui icon ${o.icon}`}),n.createElement("span",null,o.label)),s&&n.createElement("div",{className:"gallery-editor-toggle-label gallery-editor-toggle-center",onClick:s.onClick,role:"button"},s.icon&&n.createElement("i",{className:`ui icon ${s.icon}`}),n.createElement("span",null,s.label)),n.createElement("div",{className:"gallery-editor-toggle-label gallery-editor-toggle-right",onClick:a.onClick,role:"button"},a.icon&&n.createElement("i",{className:`ui icon ${a.icon}`}),n.createElement("span",null,a.label)),n.createElement("div",{className:"gallery-editor-toggle-handle"}))}}function f(e){pxt.tickEvent("image.editor",{action:e})}},{"../assets":18,"../util":149,"./FilterPanel":31,"./ImageEditor/ImageEditor":38,"./ImageEditor/keyboardShortcuts":47,"./ImageEditor/store/imageReducer":49,"./assetEditor/assetCard":58,react:335}],56:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.dispatchUpdateGalleryAssets=i.dispatchUpdateUserAssets=i.dispatchChangeGalleryView=i.dispatchChangeSelectedAsset=void 0;const n=e("./types");i.dispatchChangeSelectedAsset=(e,t)=>({type:n.CHANGE_SELECTED_ASSET,assetType:e,assetId:t});i.dispatchChangeGalleryView=(e,t,i)=>({type:n.CHANGE_GALLERY_VIEW,view:e,assetType:t,assetId:i});i.dispatchUpdateUserAssets=()=>({type:n.UPDATE_USER_ASSETS});i.dispatchUpdateGalleryAssets=()=>({type:n.UPDATE_GALLERY_ASSETS})},{"./types":57}],57:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.UPDATE_GALLERY_ASSETS=i.UPDATE_USER_ASSETS=i.CHANGE_GALLERY_VIEW=i.CHANGE_SELECTED_ASSET=void 0,i.CHANGE_SELECTED_ASSET="CHANGE_SELECTED_ASSET",i.CHANGE_GALLERY_VIEW="CHANGE_GALLERY_VIEW",i.UPDATE_USER_ASSETS="UPDATE_USER_ASSETS",i.UPDATE_GALLERY_ASSETS="UPDATE_GALLERY_ASSETS"},{}],58:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetCard=i.AssetCardView=void 0;const n=e("react"),r=e("react-redux"),o=e("./store/assetEditorReducerState"),s=e("./actions/dispatch"),a=e("./assetPreview");class l extends n.Component{constructor(){super(...arguments),this.clickHandler=()=>{const{type:e,id:t}=this.props.asset;this.props.dispatchChangeSelectedAsset(e,t)}}render(){const{asset:e,selected:t}=this.props;return n.createElement(c,{asset:e,selected:t,onClick:this.clickHandler})}}class c extends n.Component{constructor(){super(...arguments),this.clickHandler=()=>{this.props.onClick(this.props.asset)}}getDisplayIconForAsset(e){switch(e){case"tile":return"clone";case"animation":return"video";case"tilemap":return"map";case"image":default:return null}}render(){var e,t;const{asset:i,selected:r}=this.props,s=o.isGalleryAsset(i),l=this.getDisplayIconForAsset(i.type),c=l||!(null===(e=i.meta)||void 0===e?void 0:e.displayName);return n.createElement("div",{className:"asset-editor-card "+(r?"selected":""),onClick:this.clickHandler,role:"listitem"},n.createElement(a.AssetPreview,{asset:i}),c&&n.createElement("div",{className:"asset-editor-card-label"},l&&n.createElement("div",{className:"asset-editor-card-icon"},n.createElement("i",{className:`icon ${l}`})),!(null===(t=i.meta)||void 0===t?void 0:t.displayName)&&!s&&n.createElement("div",{className:"asset-editor-card-icon warning"},n.createElement("i",{className:"icon exclamation triangle"}))))}}i.AssetCardView=c;const u={dispatchChangeSelectedAsset:s.dispatchChangeSelectedAsset};i.AssetCard=r.connect((function(e,t){return e?{selected:e.selectedAsset&&t.asset.id==e.selectedAsset.id}:{}}),u)(l)},{"./actions/dispatch":56,"./assetPreview":62,"./store/assetEditorReducerState":67,react:335,"react-redux":314}],59:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetCardList=void 0;const n=e("react"),r=e("./assetCard");class o extends n.Component{constructor(){super(...arguments),this.hasUpdatedCards=!1,this.handleContainerRef=e=>{e&&(this.container=e,this.updateEmptyCards())},this.updateEmptyCards=pxtc.Util.throttle((()=>{if(!this.container)return;const e=this.container.firstElementChild;if(!e)return;this.emptyCards||(this.emptyCards=[]);const t=e.getBoundingClientRect(),i=this.container.getBoundingClientRect();if(!(t.width&&t.height&&i.width&&i.height))return;let n=t.width;if(e.nextElementSibling){const i=e.nextElementSibling.getBoundingClientRect();n=Math.max(n,i.left-t.left)}this.hasUpdatedCards=!0;const r=Math.floor(i.width/n),o=Math.floor(this.container.parentElement.getBoundingClientRect().height/n);let s,a,l=this.container.firstElementChild,c=0;for(;l;)l.classList.contains("empty-card")?s||(s=l):(c++,s&&this.container.insertBefore(l,s)),l=l.nextElementSibling;if((a=r*o>c?r*o-c:r-c%r)!==this.emptyCards.length)if(this.emptyCards.length>a)for(;this.emptyCards.length>a;)this.emptyCards.pop().remove();else for(let e=this.emptyCards.length;e<a;e++){const e=document.createElement("div");e.setAttribute("class","asset-editor-card empty-card"),this.container.appendChild(e),this.emptyCards.push(e)}}),100)}componentDidUpdate(){this.updateEmptyCards()}componentDidMount(){window.addEventListener("resize",this.updateEmptyCards);let e=()=>{this.hasUpdatedCards||(this.updateEmptyCards(),this.hasUpdatedCards||requestAnimationFrame(e))};requestAnimationFrame(e)}componentWillUnmount(){window.removeEventListener("resize",this.updateEmptyCards)}render(){const{assets:e}=this.props;return n.createElement("div",{ref:this.handleContainerRef},this.props.children,e.map((e=>n.createElement(r.AssetCard,{asset:e,key:e.id}))))}}i.AssetCardList=o},{"./assetCard":58,react:335}],60:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetGallery=void 0;const n=e("react"),r=e("../../package"),o=e("react-redux"),s=e("../../../../react-common/components/controls/List"),a=e("../../../../react-common/components/controls/Button"),l=e("../../../../react-common/components/controls/Modal"),c=e("./actions/dispatch"),u=e("./assetCardList"),d=e("./assetTopbar");class p extends n.Component{constructor(e){super(e),this.showCreateModal=()=>{this.setState({showCreateModal:!0})},this.hideCreateModal=()=>{this.setState({showCreateModal:!1})},this.getCreateAssetHandler=e=>()=>{pxt.tickEvent("assets.create",{type:e.toString()});const t=pxt.react.getTilemapProject(),i=this.getEmptyAsset(e);this.hideCreateModal(),this.props.showAssetFieldView(i,(i=>{var n;t.pushUndo();const o=null===(n=i.meta)||void 0===n?void 0:n.displayName;switch(e){case"image":t.createNewProjectImage(i.bitmap,o);break;case"tile":t.createNewTile(i.bitmap,null,o);break;case"tilemap":t.createNewTilemapFromData(i.data,o);break;case"animation":t.createNewAnimationFromData(i.frames,i.interval,o)}r.mainEditorPkg().buildAssetsAsync().then((()=>this.props.dispatchUpdateUserAssets()))}))},this.state={showCreateModal:!1},this.assetCreateOptions=[{label:lf("Image"),icon:"picture",handler:this.getCreateAssetHandler("image")},{label:lf("Tile"),icon:"clone",handler:this.getCreateAssetHandler("tile")},{label:lf("Tilemap"),icon:"map",handler:this.getCreateAssetHandler("tilemap")},{label:lf("Animation"),icon:"video",handler:this.getCreateAssetHandler("animation")}]}getEmptyAsset(e){const t=pxt.react.getTilemapProject(),i={type:e,id:"",internalID:0,meta:{displayName:pxt.getDefaultAssetDisplayName(e)}};switch(e){case"image":case"tile":i.bitmap=new pxt.sprite.Bitmap(16,16).data();break;case"tilemap":i.data=t.blankTilemap(16,16,16);case"animation":const e=i;e.frames=[new pxt.sprite.Bitmap(16,16).data()],e.interval=200}return i}render(){var e;const{view:t,galleryAssets:i,userAssets:o,disableCreateButton:c}=this.props,{showCreateModal:p}=this.state,f=(null===(e=r.mainPkg)||void 0===e?void 0:e.config)&&r.mainPkg.getPreferredEditor()===pxt.BLOCKS_PROJECT_NAME;return n.createElement("div",{className:"asset-editor-gallery"},n.createElement(d.AssetTopbar,null),n.createElement("div",{className:"asset-editor-card-list "+(0!==t?"hidden":"")},n.createElement(u.AssetCardList,{assets:h(o,f)},n.createElement(a.Button,{className:"create-new inverted",disabled:c,leftIcon:"icon huge add circle",title:lf("Create a new asset"),ariaLabel:lf("Create a new asset"),onClick:c?void 0:this.showCreateModal}))),n.createElement("div",{className:"asset-editor-card-list "+(1!==t?"hidden":"")},n.createElement(u.AssetCardList,{assets:i})),p&&n.createElement(l.Modal,{className:"asset-editor-create-dialog",onClose:this.hideCreateModal,title:lf("Create New Asset"),parentElement:document.getElementById("root")},n.createElement("div",null,lf("Choose your asset type from the options below:")),n.createElement(s.List,{className:"asset-editor-create-options"},this.assetCreateOptions.map(((e,t)=>n.createElement(a.Button,{key:t,className:"asset-editor-create-button inverted",leftIcon:`icon ${e.icon}`,label:e.label,title:lf("Create a new {0} asset",e.label),ariaLabel:lf("Create a new {0} asset",e.label),onClick:e.handler}))))))}}function h(e,t){return t?e:e.filter((e=>!!e.meta.displayName))}const f={dispatchUpdateUserAssets:c.dispatchUpdateUserAssets};i.AssetGallery=o.connect((function(e,t){return e?Object.assign(Object.assign({},t),{view:e.view,userAssets:e.assets,galleryAssets:e.galleryAssets}):{}}),f)(p)},{"../../../../react-common/components/controls/Button":2,"../../../../react-common/components/controls/List":5,"../../../../react-common/components/controls/Modal":6,"../../package":122,"./actions/dispatch":56,"./assetCardList":59,"./assetTopbar":64,react:335,"react-redux":314}],61:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetGalleryTab=void 0;const n=e("react"),r=e("react-redux"),o=e("./actions/dispatch");class s extends n.Component{constructor(){super(...arguments),this.handleClick=()=>{pxt.tickEvent("assets.gallerytab",{view:this.props.view.toString()}),this.props.dispatchChangeGalleryView(this.props.view)}}render(){const{title:e,selected:t}=this.props;return n.createElement("div",{className:"asset-editor-gallery-tab "+(t?"selected":""),onClick:this.handleClick,role:"navigation"},e)}}const a={dispatchChangeGalleryView:o.dispatchChangeGalleryView};i.AssetGalleryTab=r.connect((function(e,t){return e?{selected:e.view==t.view}:{}}),a)(s)},{"./actions/dispatch":56,react:335,"react-redux":314}],62:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetPreview=void 0;const n=e("react");class r extends n.Component{constructor(){super(...arguments),this.onMouseEnter=()=>{this.restartAnimation()},this.onMouseLeave=()=>{this.endAnimation()},this.restartAnimation=()=>{var e;this.endAnimation();const t=this.props.asset;"animation"===t.type&&(null===(e=t.framePreviewURIs)||void 0===e?void 0:e.length)>1&&(this.currentFrame=0,this.animationIntervalRef=setInterval((()=>{this.ref&&(this.ref.src=t.framePreviewURIs[this.currentFrame]),this.currentFrame=(this.currentFrame+1)%t.framePreviewURIs.length}),Math.max(t.interval,100)))},this.handleRef=e=>{e&&(this.ref=e)}}render(){var e;const{asset:t}=this.props,i="animation"===t.type&&(null===(e=t.framePreviewURIs)||void 0===e?void 0:e.length)>1,r=t.meta.displayName||(t.meta.temporaryInfo?lf("Temporary Asset"):t.id);return n.createElement("div",{className:"asset-editor-preview",title:r},n.createElement("img",{src:t.previewURI,alt:lf("A preview of your asset (eg image, tile, animation)"),onMouseEnter:i?this.onMouseEnter:void 0,onMouseLeave:i?this.onMouseLeave:void 0,ref:i?this.handleRef:void 0,loading:"lazy"}))}componentDidUpdate(){this.animationIntervalRef&&this.restartAnimation()}componentWillUnmount(){this.endAnimation()}endAnimation(){this.animationIntervalRef&&(clearInterval(this.animationIntervalRef),this.animationIntervalRef=void 0,this.ref.src=this.props.asset.previewURI)}}i.AssetPreview=r},{react:335}],63:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetSidebar=void 0;const n=e("react"),r=e("../../package"),o=e("../../simulator"),s=e("react-redux"),a=e("../../../../react-common/components/controls/Button"),l=e("../../../../react-common/components/controls/List"),c=e("../../../../react-common/components/controls/Modal"),u=e("./store/assetEditorReducerState"),d=e("./actions/dispatch"),p=e("./assetPreview"),h=e("../../app");class f extends n.Component{constructor(e){super(e),this.editAssetHandler=()=>{this.props.showAssetFieldView(this.props.asset,this.editAssetDoneHandler)},this.editAssetDoneHandler=e=>{var t;pxt.tickEvent("assets.edit",{type:e.type.toString()});const i=pxt.react.getTilemapProject();i.pushUndo(),!(null===(t=this.props.asset.meta)||void 0===t?void 0:t.displayName)&&e.meta.temporaryInfo&&(h.getBlocksEditor().updateTemporaryAsset(e),r.mainEditorPkg().lookupFile(`this/${pxt.MAIN_BLOCKS}`).setContentAsync(h.getBlocksEditor().getCurrentSource())),e.meta.displayName&&i.updateAsset(e),this.props.dispatchChangeGalleryView(0),this.updateAssets().then((()=>o.setDirty()))},this.duplicateAssetHandler=()=>{var e;const{isGalleryAsset:t}=this.props;pxt.tickEvent("assets.duplicate",{type:this.props.asset.type.toString(),gallery:t.toString()});const i=this.props.asset,n=(null===(e=i.meta)||void 0===e?void 0:e.displayName)||g(i,t)||pxt.getDefaultAssetDisplayName(i.type),r=pxt.react.getTilemapProject();r.pushUndo();const{type:o,id:s}=r.duplicateAsset(i,n);this.updateAssets().then((()=>{t&&this.props.dispatchChangeGalleryView(0,o,s)}))},this.copyAssetHandler=()=>{const{asset:e}=this.props;switch(pxt.tickEvent("assets.clipboard",{type:e.type.toString(),gallery:this.props.isGalleryAsset.toString()}),e.type){case"image":case"tile":try{const t=pxt.sprite.bitmapToImageLiteral(pxt.sprite.getBitmapFromJResURL(e.jresData),"typescript");this.copyTextAreaRef.value=t,this.copyTextAreaRef.focus(),this.copyTextAreaRef.select(),document.execCommand("copy")}catch(e){}}},this.copyTextAreaRefHandler=e=>{this.copyTextAreaRef=e},this.showDeleteModal=()=>{this.setState({showDeleteModal:!0})},this.hideDeleteModal=()=>{this.setState({showDeleteModal:!1})},this.deleteAssetHandler=()=>{pxt.tickEvent("assets.delete",{type:this.props.asset.type.toString()}),this.setState({showDeleteModal:!1});const e=pxt.react.getTilemapProject();e.pushUndo(),e.removeAsset(this.props.asset),this.props.dispatchChangeSelectedAsset(),this.updateAssets()},this.state={showDeleteModal:!1,canEdit:!0,canCopy:!0,canDelete:!0}}UNSAFE_componentWillReceiveProps(e){if(e.asset&&this.props.asset!=e.asset){const{asset:t,isGalleryAsset:i}=e,n=pxt.react.getTilemapProject(),o=!i,s="tilemap"!=(null==t?void 0:t.type)&&"animation"!=(null==t?void 0:t.type),a=!i&&!n.isAssetUsed(t,r.mainEditorPkg().files);this.setState({canEdit:o,canCopy:s,canDelete:a})}}getAssetDetails(){const e=this.props.asset,t=[];if(e)switch(t.push({name:lf("Type"),value:m(e.type)}),e.type){case"image":case"tile":t.push({name:lf("Size"),value:`${e.bitmap.width} x ${e.bitmap.height}`});break;case"tilemap":t.push({name:lf("Size"),value:`${e.data.tilemap.width} x ${e.data.tilemap.height}`});break;case"animation":t.push({name:lf("Size"),value:`${e.frames[0].width} x ${e.frames[0].height}`})}return t}updateAssets(){return r.mainEditorPkg().buildAssetsAsync().then((()=>this.props.dispatchUpdateUserAssets()))}render(){var e;const{asset:t,isGalleryAsset:i}=this.props,{showDeleteModal:r,canEdit:o,canCopy:s,canDelete:u}=this.state,d=this.getAssetDetails(),h=(null===(e=null==t?void 0:t.meta)||void 0===e?void 0:e.displayName)||i,f=g(t,i),m=[{label:lf("Delete"),onClick:this.deleteAssetHandler,icon:"icon trash",className:"red"}];return n.createElement("div",{className:"asset-editor-sidebar"},n.createElement(l.List,{className:"asset-editor-sidebar-info"},n.createElement("div",null,lf("Asset Preview")),n.createElement("div",{className:"asset-editor-sidebar-preview"},t&&n.createElement(p.AssetPreview,{asset:t})),h||!t?n.createElement("div",{className:"asset-editor-sidebar-name"},f):n.createElement("div",{className:"asset-editor-sidebar-temp"},n.createElement("i",{className:"icon exclamation triangle"}),n.createElement("span",null,lf("No asset name"))),d.map((e=>n.createElement("div",{key:e.name,className:"asset-editor-sidebar-detail"},`${e.name}: ${e.value}`)))),t&&n.createElement(l.List,{className:"asset-editor-sidebar-controls"},o&&n.createElement(a.Button,{label:lf("Edit"),title:lf("Edit the selected asset"),ariaLabel:lf("Edit the selected asset"),leftIcon:"icon edit",className:"asset-editor-button",onClick:this.editAssetHandler}),n.createElement(a.Button,{label:lf("Duplicate"),title:lf("Duplicate the selected asset"),ariaLabel:lf("Duplicate the selected asset"),leftIcon:"icon copy",className:"asset-editor-button",onClick:this.duplicateAssetHandler}),s&&n.createElement(a.Button,{label:lf("Copy"),title:lf("Copy the selected asset to the clipboard"),ariaLabel:lf("Copy the selected asset to the clipboard"),leftIcon:"icon paste",className:"asset-editor-button",onClick:this.copyAssetHandler}),u&&n.createElement(a.Button,{label:lf("Delete Asset"),title:lf("Delete the selected asset"),ariaLabel:lf("Delete the selected asset"),className:"delete-asset",onClick:this.showDeleteModal})),n.createElement("textarea",{className:"asset-editor-sidebar-copy",ref:this.copyTextAreaRefHandler}),r&&n.createElement(c.Modal,{className:"asset-editor-delete-dialog",onClose:this.hideDeleteModal,title:lf("Delete Asset"),actions:m,parentElement:document.getElementById("root")},n.createElement("div",null,lf("Are you sure you want to delete {0}? Deleted assets cannot be recovered.",f))))}}function m(e){switch(e){case"image":return lf("Image");case"tile":return lf("Tile");case"animation":return lf("Animation");case"tilemap":return lf("Tilemap")}}function g(e,t){var i;return e?(null===(i=null==e?void 0:e.meta)||void 0===i?void 0:i.displayName)?e.meta.displayName:t?e.id.split(".").pop():null:lf("No asset selected")}const b={dispatchChangeGalleryView:d.dispatchChangeGalleryView,dispatchChangeSelectedAsset:d.dispatchChangeSelectedAsset,dispatchUpdateUserAssets:d.dispatchUpdateUserAssets};i.AssetSidebar=s.connect((function(e,t){return e?{asset:e.selectedAsset,isGalleryAsset:u.isGalleryAsset(e.selectedAsset)}:{}}),b)(f)},{"../../../../react-common/components/controls/Button":2,"../../../../react-common/components/controls/List":5,"../../../../react-common/components/controls/Modal":6,"../../app":16,"../../package":122,"../../simulator":135,"./actions/dispatch":56,"./assetPreview":62,"./store/assetEditorReducerState":67,react:335,"react-redux":314}],64:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetTopbar=void 0;const n=e("react"),r=e("./assetGalleryTab");class o extends n.Component{render(){return n.createElement("div",{className:"asset-editor-topbar"},n.createElement(r.AssetGalleryTab,{title:lf("My Assets"),view:0}),n.createElement(r.AssetGalleryTab,{title:lf("Gallery"),view:1}))}}i.AssetTopbar=o},{"./assetGalleryTab":61,react:335}],65:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AssetEditor=void 0;const n=e("react"),r=e("../../package"),o=e("../../compiler"),s=e("../../blocklyFieldView"),a=e("react-redux"),l=e("./store/assetEditorStore"),c=e("./actions/dispatch"),u=e("../../srceditor"),d=e("./assetSidebar"),p=e("./assetGallery");class h extends u.Editor{constructor(){super(...arguments),this.showAssetFieldView=(e,t)=>{let i;switch(e.type){case"image":case"tile":i=pxt.react.getFieldEditorView("image-editor",e,{initWidth:16,initHeight:16,headerVisible:!0,hideMyAssets:!0,blocksInfo:this.blocksInfo});break;case"tilemap":const t=pxt.react.getTilemapProject();pxt.sprite.addMissingTilemapTilesAndReferences(t,e),i=pxt.react.getFieldEditorView("tilemap-editor",e,{initWidth:16,initHeight:16,headerVisible:!0,hideMyAssets:!0,blocksInfo:this.blocksInfo});break;case"animation":i=pxt.react.getFieldEditorView("animation-editor",e,{initWidth:16,initHeight:16,headerVisible:!0,hideMyAssets:!0,blocksInfo:this.blocksInfo})}this.parent.isTutorial()&&s.setContainerClass("asset-editor-tutorial"),i.onHide((()=>{this.parent.isTutorial()&&this.unbindTutorialEvents();const n=i.getResult();"tilemap"==e.type&&pxt.sprite.updateTilemapReferencesFromResult(pxt.react.getTilemapProject(),n),Promise.resolve(t(n)).then((()=>{var t;(null===(t=e.meta)||void 0===t?void 0:t.displayName)||this.parent.saveBlocksToTypeScriptAsync().then((e=>{e&&r.mainEditorPkg().setContentAsync(pxt.MAIN_TS,e)}))})),s.setContainerClass(null)})),this.parent.isTutorial()&&this.bindTutorialEvents(),i.show()}}getId(){return"assetEditor"}acceptsFile(e){return e.name===pxt.ASSETS_FILE}loadFileAsync(e,t){return super.loadFileAsync(e,t).then((()=>o.getBlocksAsync())).then((e=>{pxt.blocks.initializeAndInject(e),this.blocksInfo=e,this.updateGalleryAssets()})).then((()=>l.default.dispatch(c.dispatchUpdateUserAssets()))).then((()=>{this.parent.forceUpdate(),this.parent.isTutorial()&&this.parent.onTutorialLoaded()}))}unloadFileAsync(){return s.dismissIfVisible(),r.mainEditorPkg().buildAssetsAsync()}undo(){pxt.react.getTilemapProject().undo(),l.default.dispatch(c.dispatchUpdateUserAssets())}redo(){pxt.react.getTilemapProject().redo(),l.default.dispatch(c.dispatchUpdateUserAssets())}resize(e){const t=this.getAssetEditorDiv();if(t&&this.parent.isTutorial()&&!pxt.BrowserUtils.isTabletSize()){const e=t.getBoundingClientRect(),i=document.getElementById("editortools");s.setEditorBounds({top:e.top,left:e.left,width:e.width,height:e.height+(i?i.getBoundingClientRect().height:0),horizontalPadding:0,verticalPadding:0})}else s.setEditorBounds({top:0,left:0,width:window.innerWidth,height:window.innerHeight})}display(){return n.createElement(a.Provider,{store:l.default},n.createElement("div",{className:"asset-editor-outer"},n.createElement(d.AssetSidebar,{showAssetFieldView:this.showAssetFieldView}),n.createElement(p.AssetGallery,{showAssetFieldView:this.showAssetFieldView,disableCreateButton:this.parent.isTutorial()})))}getAssetEditorDiv(){return document.getElementById("assetEditor")}getTutorialCardDiv(){return document.getElementById("tutorialcard")}getTutorialMenuDiv(){var e;return null===(e=document.getElementsByClassName("tutorial-menuitem"))||void 0===e?void 0:e[0]}handleTutorialClick(e){e.stopPropagation(),e.preventDefault()}bindTutorialEvents(){const e=this.getTutorialCardDiv();null==e||e.addEventListener("mousedown",this.handleTutorialClick);const t=this.getTutorialMenuDiv();null==t||t.addEventListener("mousedown",this.handleTutorialClick),pxt.BrowserUtils.addClass(document.getElementById("maineditor"),"image-editor-open")}unbindTutorialEvents(){const e=this.getTutorialCardDiv();null==e||e.removeEventListener("mousedown",this.handleTutorialClick);const t=this.getTutorialMenuDiv();null==t||t.removeEventListener("mousedown",this.handleTutorialClick),pxt.BrowserUtils.removeClass(document.getElementById("maineditor"),"image-editor-open")}updateGalleryAssets(){l.default.dispatch(c.dispatchUpdateGalleryAssets())}}i.AssetEditor=h},{"../../blocklyFieldView":21,"../../compiler":30,"../../package":122,"../../srceditor":142,"./actions/dispatch":56,"./assetGallery":60,"./assetSidebar":63,"./store/assetEditorStore":68,react:335,"react-redux":314}],66:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("../actions/types"),r=e("../../../package"),o=e("../../../app"),s=e("../../../assets"),a={view:0,assets:[],galleryAssets:[]};function l(e,t,i){if(t&&i)return e.assets.find((e=>e.type==t&&e.id==i))||e.galleryAssets.find((e=>e.type==t&&e.id==i))}i.default=(e=a,t)=>{switch(t.type){case n.CHANGE_SELECTED_ASSET:return Object.assign(Object.assign({},e),{selectedAsset:l(e,t.assetType,t.assetId)});case n.CHANGE_GALLERY_VIEW:const i=t.assetId?l(e,t.assetType,t.assetId):e.selectedAsset;return Object.assign(Object.assign({},e),{view:t.view,selectedAsset:i});case n.UPDATE_USER_ASSETS:let a=s.getAssets(),c=new pxt.ImageConverter;return function(){var e,t;return(null===(t=null===(e=r.mainPkg)||void 0===e?void 0:e.config)||void 0===t?void 0:t.preferredEditor)===pxt.BLOCKS_PROJECT_NAME}()&&(a=a.concat(o.getBlocksEditor().getTemporaryAssets().map((e=>s.assetToGalleryItem(e,c))))),Object.assign(Object.assign({},e),{selectedAsset:e.selectedAsset?a.find((t=>t.id==e.selectedAsset.id)):void 0,assets:a});case n.UPDATE_GALLERY_ASSETS:return Object.assign(Object.assign({},e),{galleryAssets:s.getAssets(!0)});default:return e}}},{"../../../app":16,"../../../assets":18,"../../../package":122,"../actions/types":57}],67:[function(e,t,i){"use strict";var n;Object.defineProperty(i,"__esModule",{value:!0}),i.isGalleryAsset=i.GalleryView=void 0,(n=i.GalleryView||(i.GalleryView={}))[n.User=0]="User",n[n.Gallery=1]="Gallery",i.isGalleryAsset=function(e){return null==e?void 0:e.id.startsWith("sprites.")}},{}],68:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const n=e("redux"),r=e("./assetEditorReducer"),o=n.createStore(r.default);i.default=o},{"./assetEditorReducer":66,redux:356}],69:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TabContent=void 0;const n=e("react");i.TabContent=function(e){return n.createElement("div",null,e.children)}},{react:335}],70:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TabPane=void 0;const n=e("react"),r=e("../../util");i.TabPane=function(e){const{id:t,children:i,className:o,style:s,activeTabName:a}=e,l=(Array.isArray(i)?i:[i]).filter((e=>!!e));if(!l||0==l.length)return n.createElement("div",null);const[c,u]=n.useState(a),d=e=>{const{name:t,onSelected:i}=e;i&&i(),u(t)};return n.useEffect((()=>{l.some((e=>e.props.name===c))||d(l[0].props)}),[i]),n.useEffect((()=>{const e=l.find((e=>e.props.name===a))||l[0];d(e.props)}),[a]),n.createElement("div",{id:t,className:`tab-container ${o||""}`,style:s},l.length>1&&n.createElement("div",{className:"tab-navigation"},l.map((e=>{const{name:t,icon:i,title:o,ariaLabel:s,showBadge:a}=e.props;return n.createElement("div",{key:t,className:`tab-icon ${t} ${t==c?"active":""}`,"aria-label":s,tabIndex:0,onClick:()=>d(e.props),onKeyDown:r.fireClickOnEnter},a&&n.createElement("div",{className:"tab-badge"}),n.createElement("i",{className:i}),n.createElement("span",null,o))}))),l.map(((e,t)=>{const{name:i}=e.props;return n.createElement("div",{key:`tab-content-${t}`,className:`tab-content ${i} ${i!==c?"hidden":""}`},e)})))}},{"../../util":149,react:335}],71:[function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};Object.defineProperty(i,"__esModule",{value:!0}),i.SearchInput=void 0;const r=e("react");class o extends r.Component{constructor(e){super(e),this.updateInputValue=e=>{const{searchOnChange:t}=this.props,i=e.target.value;this.setState({inputValue:i}),t&&this.handleSearch(i)},this.state={inputValue:(null==e?void 0:e.defaultValue)||""},this.handleSearchKeyUpdate=this.handleSearchKeyUpdate.bind(this),this.handleClick=this.handleClick.bind(this)}handleSearchKeyUpdate(e){13==e.keyCode&&this.handleSearch(this.state.inputValue)}handleSearch(e){const{searchHandler:t}=this.props;t(e)}handleClick(){this.handleSearch(this.state.inputValue)}render(){const e=this.props,{ariaMessage:t,disabled:i,loading:o,placeholder:s,autoFocus:a,className:l,inputClassName:c,searchOnChange:u,searchHandler:d}=e,p=n(e,["ariaMessage","disabled","loading","placeholder","autoFocus","className","inputClassName","searchOnChange","searchHandler"]),{inputValue:h}=this.state;return r.createElement("div",Object.assign({className:`ui search ${l||""}`},p),r.createElement("div",{className:`ui icon input ${c||""}`},r.createElement("div",{"aria-live":"polite",className:"accessible-hidden",id:"searchInputBoxLabel"},t),r.createElement("input",{role:"search",autoFocus:a,ref:"searchInput","aria-labelledby":"searchInputBoxLabel",className:"prompt",type:"text",placeholder:s,onChange:this.updateInputValue,value:h,onKeyUp:this.handleSearchKeyUpdate,disabled:i,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),r.createElement("i",{role:"button",onClick:this.handleClick,title:lf("Search"),style:{cursor:"pointer"},className:`search link icon ${i?"disabled":""} ${o?"loading":""}`})))}}i.SearchInput=o},{react:335}],72:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TutorialCallout=void 0;const n=e("react"),r=e("../../sui");i.TutorialCallout=function(e){const{children:t,className:i,buttonIcon:o,buttonLabel:s}=e,[a,l]=n.useState(!1),c=e=>{document.removeEventListener("click",c),l(!1)};return n.createElement("div",{className:i},n.createElement(r.Button,{icon:o,text:s,className:"tutorial-callout-button",disabled:!t,onClick:t?()=>{const{onClick:t}=e;t&&t(a),a?document.removeEventListener("click",c):document.addEventListener("click",c),l(!a)}:void 0}),a&&n.createElement("div",{className:"tutorial-callout no-select",onClick:e=>{var t;e.preventDefault(),e.stopPropagation(),null===(t=e.nativeEvent)||void 0===t||t.stopImmediatePropagation()}},n.createElement(r.Button,{icon:"close",className:"tutorial-callout-close",onClick:c}),t),a&&n.createElement("div",{className:"tutorial-callout-mask",onClick:c}))}},{"../../sui":143,react:335}],73:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TutorialContainer=void 0;const n=e("react"),r=e("../../marked"),o=e("../../sui"),s=e("../../immersivereader"),a=e("./TutorialStepCounter"),l=e("./TutorialHint"),c=e("./TutorialResetCode");i.TutorialContainer=function(e){const{parent:t,tutorialId:i,name:u,steps:d,hideIteration:p,hasTemplate:h,tutorialOptions:f,onTutorialStepChange:m,onTutorialComplete:g,setParentHeight:b}=e,[v,y]=n.useState(e.currentStep||0),[k,w]=n.useState(!1),[x,E]=n.useState(!1),[C,S]=n.useState("vertical"),_=n.useRef(void 0),T=0!==v,A=v!==d.length-1,N=!A&&!pxt.appTarget.appTheme.lockedEditor&&!p,I=pxt.appTarget.appTheme.immersiveReader;n.useEffect((()=>{const e=new ResizeObserver((()=>{var e,t;pxt.BrowserUtils.isTabletSize()?S("horizontal"):S("vertical"),E((null===(e=null==_?void 0:_.current)||void 0===e?void 0:e.scrollHeight)>(null===(t=null==_?void 0:_.current)||void 0===t?void 0:t.offsetHeight))}));return e.observe(document.body),()=>e.disconnect()}),[document.body]),n.useEffect((()=>{var e,t;if("horizontal"==C){let i=0;((null===(e=null==_?void 0:_.current)||void 0===e?void 0:e.children)?pxt.Util.toArray(null===(t=null==_?void 0:_.current)||void 0===t?void 0:t.children):[]).forEach((e=>i+=null==e?void 0:e.scrollHeight)),i&&b(Math.min(Math.max(i+2,80),194))}else b()})),n.useEffect((()=>{y(e.currentStep)}),[e.currentStep]),n.useEffect((()=>{const e=null==_?void 0:_.current;e.scrollTo(0,0),E(e.scrollHeight>e.offsetHeight),m(v),A&&w(!1)}),[v]);const O=d[v];if(!d[v])return n.createElement("div",null);const P=O.showDialog,D=P?Math.min(v+1,d.length-1):v,L=d.findIndex((e=>!e.showDialog)),R=d[D].title,M=d[D].headerContentMd,B=d[D].hintContentMd,j=()=>{const t=Math.min(v+1,e.steps.length-1);pxt.tickEvent("tutorial.next",{tutorial:i,step:t,isModal:P?1:0},{interactiveConsent:!0}),y(t)},U=()=>{const e=Math.max(v-1,0);pxt.tickEvent("tutorial.previous",{tutorial:i,step:e,isModal:P?1:0},{interactiveConsent:!0}),y(e)},F=A?j:()=>w(!0);let H=[{label:lf("Ok"),onclick:F,icon:"arrow circle right",className:"green"}];T&&H.unshift({label:lf("Back"),onclick:U,icon:"arrow circle left",disabled:!T,labelPosition:"left"}),I&&H.push({className:"immersive-reader-button",onclick:()=>{s.launchImmersiveReader(O.contentMd,f)},ariaLabel:lf("Launch Immersive Reader"),title:lf("Launch Immersive Reader")});const q=n.createElement(o.Button,{icon:"arrow circle left",disabled:!T,text:lf("Back"),onClick:U}),z=N?n.createElement(o.Button,{icon:"check circle",text:lf("Done"),onClick:g}):n.createElement(o.Button,{icon:"arrow circle right",disabled:!A,text:lf("Next"),onClick:j});return n.createElement("div",{className:"tutorial-container"},n.createElement("div",{className:"tutorial-top-bar"},n.createElement(a.TutorialStepCounter,{tutorialId:i,currentStep:D,totalSteps:d.length,title:u,setTutorialStep:y}),I&&n.createElement(s.ImmersiveReaderButton,{content:M,tutorialOptions:f})),"horizontal"===C&&q,n.createElement("div",{className:"tutorial-content",ref:_,onScroll:()=>{const e=null==_?void 0:_.current;E(e&&e.scrollHeight-e.scrollTop-e.clientHeight>1)}},R&&n.createElement("div",{className:"tutorial-title"},R),n.createElement(r.MarkedContent,{className:"no-select",tabIndex:0,markdown:M,parent:t})),h&&v==L&&n.createElement(c.TutorialResetCode,{tutorialId:i,currentStep:D,resetTemplateCode:t.resetTutorialTemplateCode}),x&&n.createElement("div",{className:"tutorial-scroll-gradient"}),n.createElement("div",{className:"tutorial-controls"},"vertical"===C&&q,n.createElement(l.TutorialHint,{tutorialId:i,currentStep:D,markdown:B,parent:t}),"vertical"===C&&z),"horizontal"===C&&z,P&&!k&&n.createElement(o.Modal,{isOpen:P,closeIcon:!1,header:O.title||u,buttons:H,className:"hintdialog",onClose:F,dimmer:!0,longer:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},n.createElement(r.MarkedContent,{markdown:O.contentMd,parent:t})))}},{"../../immersivereader":107,"../../marked":111,"../../sui":143,"./TutorialHint":74,"./TutorialResetCode":75,"./TutorialStepCounter":76,react:335}],74:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TutorialHint=void 0;const n=e("react"),r=e("../../marked"),o=e("./TutorialCallout");i.TutorialHint=function(e){const{parent:t,markdown:i,tutorialId:s,currentStep:a}=e;return n.createElement(o.TutorialCallout,{className:"tutorial-hint",buttonIcon:"lightbulb",onClick:e=>{e||pxt.tickEvent("tutorial.showhint",{tutorial:s,step:a})}},i&&n.createElement(r.MarkedContent,{markdown:i,unboxSnippets:!0,parent:t}))}},{"../../marked":111,"./TutorialCallout":72,react:335}],75:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TutorialResetCode=void 0;const n=e("react"),r=e("../../sui"),o=e("./TutorialCallout");i.TutorialResetCode=function(e){const{resetTemplateCode:t,tutorialId:i,currentStep:s}=e,[a,l]=n.useState(!1);return n.createElement(o.TutorialCallout,{buttonLabel:lf("Replace my code"),className:"tutorial-replace-code"},n.createElement("p",null,lf("Did the code you're working with get off track? It happens.")),n.createElement("p",null,lf("Click below to replace your code with updated blocks.")),n.createElement("p",null,lf('This will delete all your current code blocks. Any custom images and tiles can still be found in the gallery under "My Assets".')),n.createElement("div",{className:"tutorial-replace-code-actions"},n.createElement(r.Button,{className:"primary",text:lf("Replace my code"),disabled:a,onClick:async()=>{pxt.tickEvent("tutorial.resetcode",{tutorial:i,step:s}),l(!0);try{await t(!0)}finally{document.dispatchEvent(new Event("click")),l(!1)}}})))}},{"../../sui":143,"./TutorialCallout":72,react:335}],76:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TutorialStepCounter=void 0;const n=e("react");i.TutorialStepCounter=function(e){const{tutorialId:t,currentStep:i,totalSteps:r,title:o}=e;return n.createElement("div",{className:"tutorial-step-counter"},n.createElement("div",{className:"tutorial-step-label"},n.createElement("span",{className:"tutorial-step-title"},o||lf("Step")),n.createElement("span",{className:"tutorial-step-number"},`${i+1}/${r}`)),n.createElement("div",{className:"tutorial-step-bar",onClick:i=>{const{totalSteps:n,setTutorialStep:r}=e,o=i.target,s=o.getBoundingClientRect(),a=Math.floor((i.clientX-s.left)/o.clientWidth*n);pxt.tickEvent("tutorial.step",{tutorial:t,step:a},{interactiveConsent:!0}),r(a)}},n.createElement("div",{className:"tutorial-step-bar-fill",style:{width:(i+1)/r*100+"%"}})))}},{react:335}],77:[function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};Object.defineProperty(i,"__esModule",{value:!0}),i.SandboxFooter=i.SideDocs=i.EditorSelector=i.SettingsMenu=i.DocsMenu=void 0;const r=e("react"),o=e("./data"),s=e("./sui"),a=e("./core"),l=e("./auth"),c=e("./cloudsync"),u=e("./package"),d=e("./dialogs"),p=e("./util");function h(e,t){pxt.tickEvent("docs",{path:t},{interactiveConsent:!0}),e.startActivity({activity:"tutorial",path:t})}function f(e,t){pxt.tickEvent("docs",{path:t},{interactiveConsent:!0}),e.setSideDoc(t)}function m(e,t,i=""){return t.map((t=>t.tutorial?r.createElement(b,{key:"docsmenututorial"+t.path,role:"menuitem",ariaLabel:pxt.Util.rlf(t.name),text:pxt.Util.rlf(t.name),className:"ui "+i,parent:e,path:t.path,onItemClick:h}):/^\//.test(t.path)?r.createElement(b,{key:"docsmenu"+t.path,role:"menuitem",ariaLabel:pxt.Util.rlf(t.name),text:pxt.Util.rlf(t.name),className:"ui "+i,parent:e,path:t.path,onItemClick:f}):r.createElement("a",{key:"docsmenulink"+t.path,role:"menuitem","aria-label":t.name,title:t.name,className:`ui item link ${i}`,href:t.path,target:"docs"},pxt.Util.rlf(t.name))))}class g extends o.PureComponent{renderCore(){const e=this.props.parent,t=pxt.appTarget.appTheme;return r.createElement(s.DropdownMenu,{role:"menuitem",icon:"help circle large",className:"item mobile hide help-dropdown-menuitem",textClass:"landscape only",title:lf("Help")},m(e,t.docMenu),function(e,t,i=""){const n="/"+e.toLowerCase();return r.createElement(b,{key:"docsmenu"+n,role:"menuitem",ariaLabel:pxt.Util.rlf(e),text:pxt.Util.rlf(e),className:`ui ${i}`,parent:t,path:n,onItemClick:f})}(this.props.editor,e))}}i.DocsMenu=g;class b extends s.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){const{onItemClick:e,parent:t,path:i}=this.props;e(t,i)}renderCore(){const e=this.props,{onClick:t,onItemClick:i,parent:o,path:a}=e,l=n(e,["onClick","onItemClick","parent","path"]);return r.createElement(s.Item,Object.assign({},l,{onClick:this.handleClick}))}}class v extends o.Component{constructor(e){super(e),this.state={},this.openSettings=this.openSettings.bind(this),this.showPackageDialog=this.showPackageDialog.bind(this),this.showBoardDialog=this.showBoardDialog.bind(this),this.removeProject=this.removeProject.bind(this),this.saveProject=this.saveProject.bind(this),this.toggleCollapse=this.toggleCollapse.bind(this),this.showReportAbuse=this.showReportAbuse.bind(this),this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this),this.toggleGreenScreen=this.toggleGreenScreen.bind(this),this.toggleAccessibleBlocks=this.toggleAccessibleBlocks.bind(this),this.showResetDialog=this.showResetDialog.bind(this),this.showShareDialog=this.showShareDialog.bind(this),this.showExitAndSaveDialog=this.showExitAndSaveDialog.bind(this),this.pair=this.pair.bind(this),this.pairBluetooth=this.pairBluetooth.bind(this),this.showAboutDialog=this.showAboutDialog.bind(this),this.print=this.print.bind(this),this.signOutGithub=this.signOutGithub.bind(this)}showExitAndSaveDialog(){pxt.tickEvent("menu.home",void 0,{interactiveConsent:!0}),this.props.parent.showExitAndSaveDialog()}showShareDialog(){pxt.tickEvent("menu.share",void 0,{interactiveConsent:!0}),this.props.parent.showShareDialog()}openSettings(){pxt.tickEvent("menu.settings",void 0,{interactiveConsent:!0}),this.props.parent.openSettings()}showPackageDialog(){pxt.tickEvent("menu.addpackage",void 0,{interactiveConsent:!0}),this.props.parent.showPackageDialog()}showBoardDialog(){pxt.tickEvent("menu.changeboard",void 0,{interactiveConsent:!0}),pxt.hasHwVariants()?this.props.parent.showChooseHwDialog():this.props.parent.showBoardDialogAsync(void 0,!0)}saveProject(){pxt.tickEvent("menu.saveproject",void 0,{interactiveConsent:!0}),this.props.parent.saveAndCompile()}removeProject(){pxt.tickEvent("menu.removeproject",void 0,{interactiveConsent:!0}),this.props.parent.removeProject()}toggleCollapse(){pxt.tickEvent("menu.toggleSim",void 0,{interactiveConsent:!0}),this.props.parent.toggleSimulatorCollapse()}showReportAbuse(){pxt.tickEvent("menu.reportabuse",void 0,{interactiveConsent:!0}),this.props.parent.showReportAbuse()}showLanguagePicker(){pxt.tickEvent("menu.langpicker",void 0,{interactiveConsent:!0}),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("menu.togglecontrast",void 0,{interactiveConsent:!0}),this.props.parent.toggleHighContrast()}toggleGreenScreen(){pxt.tickEvent("menu.togglegreenscreen",void 0,{interactiveConsent:!0}),this.props.parent.toggleGreenScreen()}toggleAccessibleBlocks(){pxt.tickEvent("menu.toggleaccessibleblocks",void 0,{interactiveConsent:!0}),this.props.parent.toggleAccessibleBlocks()}showResetDialog(){pxt.tickEvent("menu.reset",void 0,{interactiveConsent:!0}),pxt.tickEvent("reset"),this.props.parent.showResetDialog()}pair(){pxt.tickEvent("menu.pair"),this.props.parent.pairAsync()}pairBluetooth(){pxt.tickEvent("menu.pair.bluetooth"),a.showLoading("webblepair",lf("Pairing Bluetooth device...")),pxt.webBluetooth.pairAsync().then((()=>a.hideLoading("webblepair")))}showAboutDialog(){pxt.tickEvent("menu.about"),this.props.parent.showAboutDialog()}print(){pxt.tickEvent("menu.print"),this.props.parent.printCode()}signOutGithub(){pxt.tickEvent("menu.github.signout");const e=c.githubProvider();e&&(e.logout(),this.props.parent.forceUpdate(),a.infoNotification(lf("Signed out from GitHub...")))}UNSAFE_componentWillReceiveProps(e){const t={};void 0!==e.greenScreen&&(t.greenScreen=e.greenScreen),void 0!==e.accessibleBlocks&&(t.accessibleBlocks=e.accessibleBlocks),void 0!==e.showShare&&(t.showShare=e.showShare),Object.keys(t).length>0&&this.setState(t)}shouldComponentUpdate(e,t,i){return this.state.greenScreen!=t.greenScreen||this.state.accessibleBlocks!=t.accessibleBlocks||this.state.showShare!=t.showShare}renderCore(){var e,t;const i=pxt.auth.hasIdentity(),n=this.getData(l.HIGHCONTRAST),{greenScreen:o,accessibleBlocks:a}=this.state,c=pxt.appTarget.appTheme,u=pxt.appTarget.cloud&&!!pxt.appTarget.cloud.packages,d=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing,p=pxt.shell.isReadOnly(),h=pxt.shell.isControllerMode(),f=c.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),g=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),b=!c.lockedEditor&&!h&&l.hasIdentity(),v=this.props.showShare&&(null===(e=pxt.appTarget.cloud)||void 0===e?void 0:e.sharing)&&!h,y=!(p||h||!c.saveInMenu||f||g),k=!p&&!h&&!!c.simCollapseInMenu,w=c.greenScreen||/greenscreen=1/i.test(window.location.href),x=c.print&&!pxt.BrowserUtils.isIE(),E=c.showProjectSettings,C=c.docMenu&&c.docMenu.filter((e=>!e.tutorial)),S=(null===(t=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===t?void 0:t.deviceIcon)||"usb",_=!i&&!p&&!h&&this.getData("github:user"),T=pxt.usb.isEnabled,A=c.selectLanguage||c.highContrast||w||_;return r.createElement(s.DropdownMenu,{role:"menuitem",icon:"setting large",title:lf("More..."),className:"item icon more-dropdown-menuitem"},b&&r.createElement(s.Item,{className:"mobile only inherit",role:"menuitem",icon:"home",title:lf("Home"),text:lf("Home"),ariaLabel:lf("Home screen"),onClick:this.showExitAndSaveDialog}),v&&r.createElement(s.Item,{className:"mobile only inherit",role:"menuitem",icon:"share alternate",title:lf("Publish your game to create a shareable link"),text:lf("Share"),ariaLabel:lf("Share Project"),onClick:this.showShareDialog}),(b||v)&&r.createElement("div",{className:"ui divider mobile only inherit"}),E?r.createElement(s.Item,{role:"menuitem",icon:"options",text:lf("Project Settings"),onClick:this.openSettings}):void 0,u?r.createElement(s.Item,{role:"menuitem",icon:"disk outline",text:lf("Extensions"),onClick:this.showPackageDialog}):void 0,T?r.createElement(s.Item,{role:"menuitem",icon:S,text:lf("Connect device"),onClick:this.pair}):void 0,pxt.webBluetooth.isAvailable()?r.createElement(s.Item,{role:"menuitem",icon:"bluetooth",text:lf("Pair Bluetooth"),onClick:this.pairBluetooth}):void 0,x?r.createElement(s.Item,{role:"menuitem",icon:"print",text:lf("Print..."),onClick:this.print}):void 0,y?r.createElement(s.Item,{role:"menuitem",icon:"save",text:lf("Save Project"),onClick:this.saveProject}):void 0,h?void 0:r.createElement(s.Item,{role:"menuitem",icon:"trash",text:lf("Delete Project"),onClick:this.removeProject}),k?r.createElement(s.Item,{role:"menuitem",icon:"toggle right",text:lf("Toggle the simulator"),onClick:this.toggleCollapse}):void 0,r.createElement("div",{className:"ui divider"}),c.selectLanguage?r.createElement(s.Item,{icon:"xicon globe",role:"menuitem",text:lf("Language"),onClick:this.showLanguagePicker}):void 0,c.highContrast?r.createElement(s.Item,{role:"menuitem",text:n?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}):void 0,c.accessibleBlocks?r.createElement(s.Item,{role:"menuitem",text:a?lf("Accessible Blocks Off"):lf("Accessible Blocks On"),onClick:this.toggleAccessibleBlocks}):void 0,w?r.createElement(s.Item,{role:"menuitem",text:o?lf("Green Screen Off"):lf("Green Screen On"),onClick:this.toggleGreenScreen}):void 0,C&&m(this.props.parent,C,"setting-docs-item mobile only inherit"),_?r.createElement("div",{className:"ui divider"}):void 0,_?r.createElement("div",{className:"ui item",title:lf("Unlink {0} from GitHub",_.name),role:"menuitem",onClick:this.signOutGithub},r.createElement("div",{className:"avatar",role:"presentation"},r.createElement("img",{className:"ui circular image",src:_.photo,alt:lf("User picture")})),lf("Unlink GitHub")):void 0,A&&r.createElement("div",{className:"ui divider"}),d?r.createElement(s.Item,{role:"menuitem",icon:"warning circle",text:lf("Report Abuse..."),onClick:this.showReportAbuse}):void 0,h?void 0:r.createElement(s.Item,{role:"menuitem",icon:"sign out",text:lf("Reset"),onClick:this.showResetDialog}),r.createElement(s.Item,{role:"menuitem",text:lf("About..."),onClick:this.showAboutDialog}),c.feedbackUrl?r.createElement("a",{className:"ui item",href:c.feedbackUrl,role:"menuitem",title:lf("Give Feedback"),target:"_blank",rel:"noopener noreferrer"},lf("Give Feedback")):void 0)}}i.SettingsMenu=v;class y extends o.Component{constructor(e){super(e)}renderCore(){const e=this.props.isActive();return r.createElement(s.Item,{className:`base-menuitem ${this.props.className} ${e?"selected":""}`,role:"option",textClass:"landscape only",text:this.props.text,icon:this.props.icon,active:e,onClick:this.props.onClick,title:this.props.title})}}class k extends o.Component{constructor(e){super(e),this.onClick=()=>{pxt.BrowserUtils.isWinRT()?d.showWinAppDeprecateAsync():(pxt.tickEvent("menu.javascript",void 0,{interactiveConsent:!0}),this.props.parent.openJavaScript())},this.isActive=()=>this.props.parent.isJavaScriptActive()}renderCore(){return r.createElement(y,{className:"javascript-menuitem",icon:"xicon js",text:"JavaScript",title:lf("Convert code to JavaScript"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class w extends o.Component{constructor(e){super(e),this.onClick=()=>{pxt.BrowserUtils.isWinRT()?d.showWinAppDeprecateAsync():(pxt.tickEvent("menu.python",void 0,{interactiveConsent:!0}),this.props.parent.openPython())},this.isActive=()=>this.props.parent.isPythonActive()}renderCore(){return r.createElement(y,{className:"python-menuitem",icon:"xicon python",text:"Python",title:lf("Convert code to Python"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class x extends o.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.blocks",void 0,{interactiveConsent:!0}),this.props.parent.openBlocks()},this.isActive=()=>this.props.parent.isBlocksActive()}renderCore(){return r.createElement(y,{className:"blocks-menuitem",icon:"xicon blocks",text:lf("Blocks"),title:lf("Convert code to Blocks"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class E extends o.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.simView",void 0,{interactiveConsent:!0}),this.props.parent.openSimView()},this.isActive=()=>this.props.parent.isEmbedSimActive()}renderCore(){const e=this.isActive(),t=this.props.parent.state.simState==pxt.editor.SimState.Running,i=t?lf("Stop the simulator"):lf("Start the simulator");return r.createElement(y,{className:"sim-menuitem",icon:e&&t?"stop":"play",text:lf("Simulator"),title:e?i:lf("Show Simulator"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class C extends o.Component{constructor(e){super(e),this.onClick=()=>{pxt.tickEvent("menu.assets",void 0,{interactiveConsent:!0}),this.props.parent.openAssets()},this.isActive=()=>this.props.parent.isAssetsActive()}renderCore(){return r.createElement(y,{className:"assets-menuitem",icon:"picture",text:lf("Assets"),title:lf("View project assets"),onClick:this.onClick,isActive:this.isActive,parent:this.props.parent})}}class S extends o.Component{constructor(e){super(e)}renderCore(){const{python:e,sandbox:t,headless:i,languageRestriction:n,parent:o}=this.props,a=e&&(o.isJavaScriptActive()||o.isPythonActive()),l="javascript-only"===n,c="python-only"===n,d="blocks-only"===n,p="no-javascript"===n,h="no-python"===n,f="no-blocks"===n,m=o.isPythonActive()||pxt.shell.isPyLangPref(),g=e&&!l&&!d&&!h,b=!(c||l||f||!u.mainEditorPkg().files[pxt.MAIN_BLOCKS]),v=!p&&!c&&!d,y=t&&!i,S=g&&v&&b,_=pxt.appTarget.appTheme.assetEditor&&!t;let T,A;return S?T=m?r.createElement(w,{parent:o}):r.createElement(k,{parent:o}):g&&v?(T=r.createElement(k,{parent:o}),A=r.createElement(w,{parent:o})):g?T=r.createElement(w,{parent:o}):v&&(T=r.createElement(k,{parent:o})),r.createElement("div",{id:"editortoggle",className:"ui grid padded "+(c||l?"one-language":""),role:"listbox","aria-orientation":"horizontal"},y&&r.createElement(E,{parent:o}),b&&r.createElement(x,{parent:o}),T,A,S&&r.createElement(s.DropdownMenu,{id:"editordropdown",role:"menuitem",icon:"chevron down",rightIcon:!0,title:lf("Select code editor language"),className:"item button attached right "+(a?"active":"")},r.createElement(k,{parent:o}),r.createElement(w,{parent:o})),_&&r.createElement(C,{parent:o}),r.createElement("div",{className:"ui item toggle "+(a?"dropdown-attached":"")}))}}i.EditorSelector=S;class _ extends o.Component{constructor(e){super(e),this.openingSideDoc=!1,this.state={},this.toggleVisibility=this.toggleVisibility.bind(this),this.popOut=this.popOut.bind(this)}rootDocsUrl(){return(pxt.webConfig.docsUrl||"/--docs")+"#"}static notify(e){let t=document.getElementById("sidedocsframe");t&&t.contentWindow&&t.contentWindow.postMessage(e,"*")}setPath(e,t){this.openingSideDoc=!0;let i=this.rootDocsUrl();const n=t?"blocks":"js",r=pxt.BrowserUtils.isPxtElectron()?"?pxtElectron=true":"";r&&i.endsWith("#")&&(i=i.substr(0,i.length-1)+r+"#");const o=`${i}doc:${e}:${n}:${pxt.Util.localeInfo()}`;this.setUrl(o)}setMarkdown(e){const t=`${this.rootDocsUrl()}md:${encodeURIComponent(e)}:blocks:${pxt.Util.localeInfo()}`;this.props.parent.setState({sideDocsLoadUrl:t})}setUrl(e){this.props.parent.setState({sideDocsLoadUrl:e,sideDocsCollapsed:!1})}expand(){this.props.parent.setState({sideDocsCollapsed:!1})}collapse(){this.props.parent.setState({sideDocsCollapsed:!0})}isCollapsed(){return!!this.state.sideDocsCollapsed}popOut(){_.notify({type:"popout"})}toggleVisibility(){const e=this.props.parent.state;this.props.parent.setState({sideDocsCollapsed:!e.sideDocsCollapsed}),document.getElementById("sidedocstoggle").focus()}componentDidUpdate(){this.props.parent.editor.resize();let e=document.getElementById("sidedocstoggle");this.openingSideDoc&&e&&(e.focus(),this.openingSideDoc=!1)}UNSAFE_componentWillReceiveProps(e){const t={};null!=e.sideDocsCollapsed&&(t.sideDocsCollapsed=e.sideDocsCollapsed),null!=e.docsUrl&&(t.docsUrl=e.docsUrl),Object.keys(t).length>0&&this.setState(t)}shouldComponentUpdate(e,t,i){return this.state.sideDocsCollapsed!=t.sideDocsCollapsed||this.state.docsUrl!=t.docsUrl}renderCore(){const{sideDocsCollapsed:e,docsUrl:t}=this.state,i=pxt.Util.isUserLanguageRtl(),n=(e||i)&&!(e&&i),o=!!pxt.appTarget.appTheme.lockedEditor;if(!t)return null;const a=e?this.rootDocsUrl():t;return r.createElement("div",null,r.createElement("button",{id:"sidedocstoggle",role:"button","aria-label":e?lf("Expand the side documentation"):lf("Collapse the side documentation"),className:"ui icon button large",onClick:this.toggleVisibility},r.createElement(s.Icon,{icon:"icon inverted chevron "+(n?"left":"right")})),r.createElement("div",{id:"sidedocs"},r.createElement("div",{id:"sidedocsframe-wrapper"},r.createElement("iframe",{id:"sidedocsframe",src:a,title:lf("Documentation"),"aria-atomic":"true","aria-live":"assertive",sandbox:"allow-scripts allow-same-origin allow-forms "+(o?"":"allow-popups")})),!o&&r.createElement("div",{className:"ui app hide",id:"sidedocsbar"},r.createElement("a",{className:"ui icon link",role:"button",tabIndex:0,"data-content":lf("Open documentation in new tab"),"aria-label":lf("Open documentation in new tab"),onClick:this.popOut,onKeyDown:p.fireClickOnEnter},r.createElement(s.Icon,{icon:"external"})))))}}i.SideDocs=_;class T extends o.PureComponent{constructor(e){super(e),this.state={},this.compile=this.compile.bind(this)}compile(){pxt.tickEvent("sandboxfooter.compile",void 0,{interactiveConsent:!0}),this.props.parent.compile()}renderCore(){const e=pxt.appTarget.appTheme,t=lf("Download your code to the {0}",e.boardName);return r.createElement("div",{className:"ui horizontal small divided link list sandboxfooter"},e.organizationUrl&&e.organization?r.createElement("a",{className:"item",target:"_blank",rel:"noopener noreferrer",href:e.organizationUrl},e.organization):void 0,r.createElement("a",{target:"_blank",className:"item",href:e.termsOfUseUrl,rel:"noopener noreferrer"},lf("Terms of Use")),r.createElement("a",{target:"_blank",className:"item",href:e.privacyUrl,rel:"noopener noreferrer"},lf("Privacy")),r.createElement("span",{className:"item"},r.createElement("a",{role:"button",className:"ui thin portrait only",title:t,onClick:this.compile},r.createElement(s.Icon,{icon:`icon ${pxt.appTarget.appTheme.downloadIcon||"download"}`}),pxt.appTarget.appTheme.useUploadMessage?lf("Upload"):lf("Download"))))}}i.SandboxFooter=T},{"./auth":20,"./cloudsync":27,"./core":78,"./data":81,"./dialogs":88,"./package":122,"./sui":143,"./util":149,react:335}],78:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.apiAsync=i.handleNetworkError=i.findChild=i.navigateInWindow=i.keyCodeFromEvent=i.resetFocus=i.setLanguage=i.setHighContrast=i.toggleHighContrast=i.getHighContrastOnce=i.SPACE_KEY=i.ENTER_KEY=i.ESC_KEY=i.TAB_KEY=i.promptAsync=i.confirmDelete=i.confirmAsync=i.forceUpdate=i.hideDialog=i.dialogAsync=i.infoNotification=i.warningNotification=i.errorNotification=i.cancelAsyncLoading=i.showLoadingAsync=i.showLoading=i.killLoadingQueue=i.hideLoading=i.isLoading=void 0;const n=e("react"),r=e("react-dom"),o=e("./data"),s=e("./coretsx"),a=e("./auth"),l=e("../../react-common/components/Notification");var c=pxt.Cloud;let u,d=!1,p=[],h={};function f(e){if(pxt.debug("hideloading: "+e),pxt.perf.recordMilestone(`loading done #${e}`),null!=h[e]){const t=p.indexOf(e);t>-1&&p.splice(t,1),delete h[e]}else pxt.debug("Loading not in queue, disregard: "+e);p.length>0?g():d&&u&&u.hide()}function m(e,t){pxt.debug("showloading: "+e),h[e]||(pxt.perf.recordMilestone(`loading started #${e}`),function(){if(d)return;const e=document.getElementById("content").appendChild(document.createElement("div"));u=r.render(n.createElement(s.LoadingDimmer,{}),e),d=!0}(),u.show(lf("Please wait")),p.push(e),h[e]=t,g())}function g(){if(!p.length)return;const e=p[p.length-1],t=h[e];u.show(t)}i.isLoading=function(){return u&&u.isVisible()},i.hideLoading=f,i.killLoadingQueue=function(){p=[],h={},d&&u&&u.hide()},i.showLoading=m;let b={};function v(e){clearTimeout(b[e]),f(e)}function y(e,t){l.pushNotificationMessage({kind:e,text:t,hc:E()})}function k(e){pxt.log("warning: "+e),y("warn",e)}function w(e){return e.buttons||(e.buttons=[]),e.type||(e.type="dialog"),e.hasCloseIcon&&(e.hideCancel=!0),e.hideCancel||(e.buttons||(e.buttons=[]),e.buttons.push({label:e.disagreeLbl||lf("Cancel"),className:e.disagreeClass||"cancel",icon:e.disagreeIcon||"cancel"})),e.helpUrl&&(e.bigHelpButton?e.buttons.unshift({className:"dialog-help-large help",urlButton:!0,label:lf("Help"),title:lf("Help"),url:e.helpUrl}):e.buttons.unshift({className:"circular help",title:lf("Help"),icon:"help",url:e.helpUrl})),s.renderConfirmDialogAsync(e)}function x(e){e.type="confirm",e.buttons||(e.buttons=[]);let t=0;return e.hideAgree||e.buttons.push({label:e.agreeLbl||lf("Go ahead!"),className:e.agreeClass,icon:e.agreeIcon||"checkmark",approveButton:!0,onclick:()=>{t=1}}),e.deleteLbl&&e.buttons.push({label:e.deleteLbl,className:"delete red",icon:"trash",onclick:()=>{t=2}}),w(e).then((()=>t))}function E(){return o.getData(a.HIGHCONTRAST)||!1}async function C(e){await a.setHighContrastPrefAsync(e)}i.showLoadingAsync=function(e,t,i,n=700){return clearTimeout(b[e]),b[e]=setTimeout((function(){m(e,t)}),n),i.finally((()=>{v(e)}))},i.cancelAsyncLoading=v,i.errorNotification=function(e){pxt.tickEvent("notification.error",{message:e}),y("err",e)},i.warningNotification=k,i.infoNotification=function(e){pxt.debug(e),y("info",e)},i.dialogAsync=w,i.hideDialog=function(){s.hideDialog()},i.forceUpdate=function(){s.forceUpdate()},i.confirmAsync=x,i.confirmDelete=function(e,t,i){x({header:i?lf("Would you like to delete {0} projects?",e):lf("Would you like to delete '{0}'?",e),body:lf("It will be deleted for good. No undo."),agreeLbl:lf("Delete"),agreeClass:"red",agreeIcon:"trash"}).then((e=>{e&&t()}))},i.promptAsync=function(e){e.type="prompt",e.buttons||(e.buttons=[]);let t=e.initialValue||"",i=!1;return e.onInputChanged=e=>{t=e},e.hideAgree||e.buttons.push({label:e.agreeLbl||lf("Go ahead!"),className:e.agreeClass,icon:e.agreeIcon||"checkmark",approveButton:!0,onclick:()=>{i=!0}}),w(e).then((()=>i?t:null))},i.TAB_KEY=9,i.ESC_KEY=27,i.ENTER_KEY=13,i.SPACE_KEY=32,i.getHighContrastOnce=E,i.toggleHighContrast=function(){C(!E())},i.setHighContrast=C,i.setLanguage=async function(e){pxt.BrowserUtils.setCookieLang(e),await a.setLangaugePrefAsync(e)},i.resetFocus=function(){let e=document.getElementById("content");e.tabIndex=0,e.focus(),e.blur(),e.tabIndex=-1},i.keyCodeFromEvent=function(e){return"number"==typeof e.which?e.which:e.keyCode},i.navigateInWindow=function(e){window.location.href=e},i.findChild=function(e,t){let i=r.findDOMNode(e);return t?pxt.Util.toArray(i.querySelectorAll(t)):[i]},i.handleNetworkError=function(e,t){let i=parseInt(e.statusCode);if(e.isOffline||0===i)k(lf("Network request failed; you appear to be offline"));else if(!isNaN(i)&&200!==i){if(t&&-1!==t.indexOf(i))return e;k(lf("Network request failed"))}throw e},i.apiAsync=function(e,t){return(t?c.privatePostAsync(e,t):c.privateGetAsync(e)).then((t=>(console.log("*"),console.log("*******",e,"---\x3e"),console.log("*"),console.log(t),console.log("*"),t)),(e=>{console.log(e.message)}))}},{"../../react-common/components/Notification":1,"./auth":20,"./coretsx":79,"./data":81,react:335,"react-dom":291}],79:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.LoadingDimmer=i.hideDialog=i.renderConfirmDialogAsync=i.forceUpdate=i.dialogIsShowing=i.CoreDialog=void 0;const n=e("react"),r=e("react-dom"),o=e("./sui"),s=e("./core");class a extends n.Component{constructor(e){super(e),this.state={inputValue:e.initialValue,inputError:void 0,confirmationGranted:!e.confirmationText&&!e.confirmationCheckbox&&void 0},this.hide=this.hide.bind(this),this.modalDidOpen=this.modalDidOpen.bind(this),this.handleInputChange=this.handleInputChange.bind(this),this.handleConfirmationTextChange=this.handleConfirmationTextChange.bind(this),this.handleConfirmationCheckboxChange=this.handleConfirmationCheckboxChange.bind(this)}hide(){this.close()}close(e){this.setState({visible:!1}),this.resolve(e),this.props.onClose&&this.props.onClose()}componentDidMount(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}modalDidOpen(e){const t=this.props,i=this.refs.promptInput;if(i){i.setSelectionRange(0,9999);const e=this;i.onkeydown=t=>{s.keyCodeFromEvent(t)===s.ENTER_KEY&&e.okButton&&i.value&&(e.okButton.onclick(),t.preventDefault())}}t.onLoaded&&t.onLoaded(e)}handleInputChange(e){const t=this.props;let i;t.onInputChanged&&t.onInputChanged(e.target.value),t.onInputValidation&&(i=t.onInputValidation(e.target.value)),this.setState({inputValue:e.target.value,inputError:i})}handleConfirmationTextChange(e){this.setState({confirmationText:e,confirmationGranted:this.state.confirmationText===this.props.confirmationText})}handleConfirmationCheckboxChange(e){this.setState({confirmationGranted:e})}render(){var e;const t=this.props,{inputValue:i,inputError:r}=this.state,s=void 0===t.size?"small":t.size,a=t.hasCloseIcon||!t.hideCancel,l=t.buttons?t.buttons.filter((e=>!!e)):[];l.forEach((e=>{const t=e.onclick;e.onclick=()=>{this.close(t?t():0)},e.className||(e.className="approve positive"),e.approveButton&&(this.okButton=e)})),"prompt"==t.type&&this.okButton&&(this.okButton.disabled=!i||!!r);const c=o.cx(["coredialog",t.className]),u=pxt.BrowserUtils.isMobile();return null===(e=t.buttons)||void 0===e||e.forEach((e=>{if(e.approveButton&&void 0!==this.state.confirmationGranted){const t=" disabled";this.state.confirmationGranted?e.className=e.className.replace(t,""):e.className+=e.className.indexOf(t)>=0?"":t}})),n.createElement(o.Modal,{isOpen:!0,ref:"modal",className:c,onClose:this.hide,size:s,defaultOpen:!0,buttons:l,dimmer:!0,closeIcon:t.hasCloseIcon,header:t.header,headerIcon:t.headerIcon,closeOnDimmerClick:a,closeOnDocumentClick:a,closeOnEscape:a,modalDidOpen:this.modalDidOpen},"prompt"==t.type&&n.createElement("div",{className:"ui"},n.createElement("div",{className:"ui fluid icon input"},n.createElement("input",{autoFocus:!0,className:"ui input "+(r?"error":""),type:"text",ref:"promptInput",onChange:this.handleInputChange,value:i,placeholder:t.placeholder,"aria-label":t.placeholder})),!!r&&n.createElement("div",{className:"ui error message"},r)),t.jsx,!!t.jsxd&&t.jsxd(),!!t.body&&n.createElement("p",null,t.body),!!t.copyable&&n.createElement(o.Input,{copy:!0,readOnly:!0,value:t.copyable,selectOnClick:!0,autoComplete:!1}),!!t.confirmationText&&n.createElement(n.Fragment,null,n.createElement("p",null,"Type '",t.confirmationText,"' to confirm:"),n.createElement(o.Input,{ref:"confirmationInput",id:"confirmationInput",ariaLabel:lf("Type your name to confirm"),autoComplete:!1,value:this.state.confirmationText||"",onChange:this.handleConfirmationTextChange,selectOnMount:!u,autoFocus:!u})),!!t.confirmationCheckbox&&n.createElement(o.PlainCheckbox,{label:t.confirmationCheckbox,isChecked:this.state.confirmationGranted,onChange:this.handleConfirmationCheckboxChange}))}}let l;i.CoreDialog=a,i.dialogIsShowing=function(){return!!l},i.forceUpdate=function(){l&&l.forceUpdate()},i.renderConfirmDialogAsync=function(e){return pxt.Util.delay(10).then((()=>{const t=document.body.appendChild(document.createElement("div")),i=r.render(n.createElement(a,e),t);return l=i,i.promise.finally((()=>(r.unmountComponentAtNode(t),void setTimeout((()=>{t.parentElement.removeChild(t),i===l&&(l=void 0)})))))}))},i.hideDialog=function(){l&&(l.hide(),l=void 0)};class c extends n.Component{constructor(e){super(e),this.state={visible:!0}}hide(){this.setState({visible:!1,content:void 0})}show(e){this.setState({visible:!0,content:e})}isVisible(){return this.state.visible}render(){const{visible:e,content:t}=this.state;return e?n.createElement(o.Dimmer,{isOpen:!0,active:e,closable:!1},n.createElement(o.Loader,{className:"large main msg no-select","aria-live":"assertive"},t)):n.createElement("div",null)}}i.LoadingDimmer=c},{"./core":78,"./sui":143,react:335,"react-dom":291}],80:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CreateFunctionDialog=void 0;const n=e("react"),r=e("./data"),o=e("./sui");class s extends r.Component{constructor(e){super(e),this.state={visible:!1,functionEditorWorkspace:null,functionCallback:null,initialMutation:null,functionBeingEdited:null},this.hide=this.hide.bind(this),this.modalDidOpen=this.modalDidOpen.bind(this),this.cancel=this.cancel.bind(this),this.confirm=this.confirm.bind(this)}hide(){pxt.BrowserUtils.removeClass(Blockly.WidgetDiv.DIV,"functioneditor");const{functionEditorWorkspace:e,mainWorkspace:t}=this.state;e.clear(),e.dispose(),t.refreshToolboxSelection(),this.setState({visible:!1,functionEditorWorkspace:null,functionCallback:null,initialMutation:null,functionBeingEdited:null})}show(e,t,i){pxt.tickEvent("createfunction.show",null,{interactiveConsent:!1}),this.setState({visible:!0,functionCallback:t,initialMutation:e,mainWorkspace:i})}modalDidOpen(e){const t=document.getElementById("functionEditorWorkspace");let{functionEditorWorkspace:i,initialMutation:n}=this.state;if(!t)return;pxt.BrowserUtils.addClass(Blockly.WidgetDiv.DIV,"functioneditor"),(i=Blockly.inject(t,{trashcan:!1,move:{scrollbars:!0},renderer:"pxt"})).showContextMenu_=()=>{},i.clear();const r=i.newBlock("function_declaration");r.domToMutation(n),r.initSvg(),r.render(!1),i.centerOnBlock(r.id),i.addChangeListener((()=>{const{functionBeingEdited:e}=this.state;e&&e.updateFunctionSignature()})),this.setState({functionEditorWorkspace:i,functionBeingEdited:r}),Blockly.svgResize(i)}cancel(){pxt.tickEvent("createfunction.cancel",void 0,{interactiveConsent:!0}),this.hide()}confirm(){Blockly.hideChaff();const{functionBeingEdited:e,mainWorkspace:t,functionCallback:i}=this.state,n=e.mutationToDom();Blockly.Functions.validateFunctionExternal(n,t)&&(i(n),this.hide())}addArgumentFactory(e){return()=>this.addArgument(e)}addArgument(e){const{functionBeingEdited:t}=this.state;switch(e){case"boolean":t.addBooleanExternal();break;case"string":t.addStringExternal();break;case"number":t.addNumberExternal();break;case"Array":t.addArrayExternal();break;default:t.addCustomExternal(e)}}renderCore(){const{visible:e}=this.state,t=[{label:lf("Done"),onclick:this.confirm,icon:"check",className:"approve positive"}],i=this.getArgumentTypes().slice(),r=this.props.parent.createModalClasses("createfunction");return n.createElement(o.Modal,{isOpen:e,className:r,size:"large",closeOnEscape:!1,closeIcon:!0,closeOnDimmerClick:!1,closeOnDocumentClick:!1,dimmer:!0,buttons:t,header:lf("Edit Function"),modalDidOpen:this.modalDidOpen,onClose:this.hide},n.createElement("div",null,n.createElement("span",{className:"ui text mobile only paramlabel"},lf("Add a parameter")),n.createElement("div",{className:"horizontal list"},n.createElement("span",{className:"ui text mobile hide paramlabel"},lf("Add a parameter")),i.map((e=>n.createElement(o.Button,{key:e.typeName,role:"button",className:"icon",icon:e.icon,textClass:"mobile hide",text:e.label||e.typeName,ariaLabel:lf("Add {0} parameter",e.label||e.typeName),onClick:this.addArgumentFactory(e.typeName)})))),n.createElement("div",{id:"functionEditorWorkspace"})))}getArgumentTypes(){if(!s.cachedFunctionTypes){const e=[{label:lf("Text"),typeName:"string",icon:pxt.blocks.defaultIconForArgType("string")},{label:lf("Boolean"),typeName:"boolean",icon:pxt.blocks.defaultIconForArgType("boolean")},{label:lf("Number"),typeName:"number",icon:pxt.blocks.defaultIconForArgType("number")},{label:lf("Array"),typeName:"Array",icon:pxt.blocks.defaultIconForArgType("Array")}];pxt.appTarget.runtime&&pxt.appTarget.runtime.functionsOptions&&pxt.appTarget.runtime.functionsOptions.extraFunctionEditorTypes&&Array.isArray(pxt.appTarget.runtime.functionsOptions.extraFunctionEditorTypes)&&pxt.appTarget.runtime.functionsOptions.extraFunctionEditorTypes.forEach((t=>{e.push(Object.assign(Object.assign({},t),{label:t.label&&pxt.Util.rlf(`{id:type}${t.label}`),defaultName:t.defaultName&&pxt.Util.rlf(`{id:var}${t.defaultName}`)}))})),e.forEach((e=>{e.icon||(e.icon=pxt.blocks.defaultIconForArgType())})),s.cachedFunctionTypes=e}return s.cachedFunctionTypes}}i.CreateFunctionDialog=s,s.cachedFunctionTypes=null},{"./data":81,"./sui":143,react:335}],81:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PureComponent=i.Component=i.invalidateHeader=i.getDataWithStatus=i.getData=i.getAsync=i.invalidate=i.stripProtocol=i.mountVirtualApi=i.getCached=i.loadCache=i.clearCache=i.unsubscribe=i.subscribe=i.FetchStatus=void 0;const n=e("react"),r=e("./core");var o,s,a=pxt.Cloud,l=pxt.Util;(s=o=i.FetchStatus||(i.FetchStatus={}))[s.Pending=0]="Pending",s[s.Complete=1]="Complete",s[s.Error=2]="Error",s[s.Offline=3]="Offline";const c={};let u,d={};function p(e,t){let i=k(t),n=i.components;n.indexOf(e)<0&&(n.push(e),e.subscriptions.push(i))}function h(e){let t=e.subscriptions;0!=t.length&&(e.subscriptions=[],t.forEach((t=>{let i=t.components.indexOf(e);i>=0&&t.components.splice(i,1)})))}function f(e){return e.api.expirationTime?null==e.data||Date.now()-e.lastRefresh>e.api.expirationTime(e.path):!e.lastRefresh}function m(e){return!(!e.data||e.data instanceof Error)&&/^cloud:(me\/settings|ptr-pkg-)/.test(e.path)}function g(){JSON.parse(pxt.storage.getLocal("apiCache2")||"[]").forEach((e=>{k(e.path).data=e.data}))}function b(){let e=l.values(d).filter((e=>m(e))).map((e=>({path:e.path,data:e.data})));pxt.storage.setLocal("apiCache2",JSON.stringify(e))}function v(e){let t=/^([\w\-]+):/.exec(e);return t&&c[t[1]]||l.oops("bad data protocol: "+e),c[t[1]]}function y(e,t){if(e.queued)return;if(e.api.isOffline&&e.api.isOffline())return;e.queued=!0;let i=i=>{e.data=i,e.lastRefresh=pxt.Util.now(),e.queued=!1,function(e,t){m(e)&&b();let i=e.callbackOnce;i.length>0&&(e.callbackOnce=[],l.nextTick((()=>i.forEach((e=>e()))))),e.components.length>0&&e.components.forEach((e=>l.nextTick((()=>e.onDataChanged(t)))))}(e,t)};e.api.isSync?i(e.api.getSync(e.path)):e.api.getAsync(e.path).then(i)}function k(e){return d.hasOwnProperty(e)||(d[e]={path:e,data:null,lastRefresh:0,queued:!1,callbackOnce:[],components:[],api:v(e)}),d[e]}function w(e,t){return p(e,t),S(t)}function x(e,t){l.assert(!c[e]),l.assert(!!t.getSync||!!t.getAsync),l.assert(!!t.getSync!=!!t.getAsync),t.isSync=!!t.getSync,c[e]=t}function E(e){let t=/^([\w\-]+):(.*)/.exec(e);return t?t[2]:(l.oops("protocol missing in: "+e),e)}function C(e){const t=e.replace(/:\*$/,":");l.values(d).forEach((i=>{(function(e,t){if(e.path.slice(0,t.length)==t)return!0;if(e.path.endsWith(":*")){const[i]=e.path.split(":"),[n]=t.split(":");return i==n}return!1})(i,t)&&(i.lastRefresh=0,i.components.length>0&&y(k(i.path),e),i.api.onInvalidated&&i.api.onInvalidated(e))}))}function S(e){let t=k(e);if(t.api.isSync)return{data:t.api.getSync(t.path),status:o.Complete};let i={data:t.data,status:o.Complete};return(f(t)||t.data instanceof Error)&&(i.status=t.data instanceof Error?o.Error:o.Pending,t.api.isOffline&&t.api.isOffline()?i.status=o.Offline:y(t,e)),i}i.subscribe=p,i.unsubscribe=h,i.clearCache=function(){d={},b()},i.loadCache=g,i.getCached=w,i.mountVirtualApi=x,i.stripProtocol=E,i.invalidate=C,i.getAsync=function(e){let t=k(e);return t.api.isSync?Promise.resolve(t.api.getSync(t.path)):a.isOnline()&&f(t)?new Promise(((i,n)=>{t.callbackOnce.push((()=>{i(t.data)})),y(t,e)})):Promise.resolve(t.data)},i.getData=function(e){return S(e).data},i.getDataWithStatus=S,x("cloud",{getAsync:e=>a.privateGetAsync(E(e)).catch(r.handleNetworkError),expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),x("cloud-search",{getAsync:e=>a.privateGetAsync(E(e)).catch((e=>(r.handleNetworkError(e,[404]),{statusCode:404,headers:{},json:{}}))),expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),x("gallery",{getAsync:e=>pxt.gallery.loadGalleryAsync(E(decodeURIComponent(e))).catch((e=>Promise.resolve(e))),expirationTime:e=>36e5}),x("gh-search",{getAsync:e=>pxt.targetConfigAsync().then((t=>pxt.github.searchAsync(E(e),t?t.packages:void 0))).catch(r.handleNetworkError),expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),x("gh-pkgcfg",{getAsync:e=>pxt.github.pkgConfigAsync(E(e)).catch(r.handleNetworkError),expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),x("gh-commits",{getAsync:e=>{const t=E(e),[i,n]=t.split("#",2);return pxt.github.getCommitsAsync(i,n).catch((e=>(r.handleNetworkError(e),[])))},expirationTime:e=>6e4,isOffline:()=>!a.isOnline()}),x("target-config",{getAsync:e=>{u||(u=pxt.targetConfigAsync().then((e=>(e&&(pxt.storage.setLocal("targetconfig",JSON.stringify(e)),C("target-config"),C("gh-search"),C("gh-pkgcfg")),e))).catch(r.handleNetworkError));const t=JSON.parse(pxt.storage.getLocal("targetconfig")||"null");return t?Promise.resolve(t):u},expirationTime:e=>864e5,isOffline:()=>!a.isOnline()}),i.invalidateHeader=function(e,t){t&&C(e+":"+t.id)};class _ extends n.Component{constructor(e){super(e),this.subscriptions=[],this.renderCoreOk=!1,this.state={}}getData(e){return this.getDataWithStatus(e).data}getDataWithStatus(e){return this.renderCoreOk||l.oops("Override renderCore() not render()"),w(this,e)}onDataChanged(){this.forceUpdate()}componentWillUnmount(){h(this)}child(e){return r.findChild(this,e)}renderCore(){return null}render(){return h(this),this.renderCoreOk=!0,this.renderCore()}setStateAsync(e){return new Promise(((t,i)=>{this.setState(e,(()=>{t()}))}))}}i.Component=_;class T extends n.PureComponent{constructor(e){super(e),this.renderCoreOk=!1,this.state={}}child(e){return r.findChild(this,e)}renderCore(){return null}render(){return this.renderCoreOk=!0,this.renderCore()}}i.PureComponent=T,g()},{"./core":78,react:335}],82:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Table=i.destroyAsync=i.getDbAsync=void 0;const n=e("pouchdb").plugin(e("pouchdb-adapter-memory"));let r;function o(){return r||(r=Promise.resolve().then((()=>{const e=new n("pxt-"+pxt.storage.storageId(),{revs_limit:2});return pxt.log(`PouchDB adapter: ${e.adapter}`),e})))}i.getDbAsync=o,i.destroyAsync=function(){return r?r.then((e=>{e.destroy(),r=void 0})):Promise.resolve()};class s{constructor(e){this.name=e}getAsync(e){return o().then((t=>t.get(this.name+"--"+e))).then((t=>(t.id=e,t)))}getAllAsync(){return o().then((e=>e.allDocs({include_docs:!0,startkey:this.name+"--",endkey:this.name+"--"}))).then((e=>e.rows.map((e=>e.doc))))}deleteAsync(e){return o().then((t=>t.remove(e)))}forceSetAsync(e){return this.getAsync(e.id).then((t=>(e._rev=t._rev,this.setAsync(e))),(t=>this.setAsync(e)))}setAsync(e){return this.setAsyncNoRetry(e).then((e=>(pxt.BrowserUtils.scheduleStorageCleanup(),e))).catch((t=>{if(409!=t.status)return pxt.reportException(t),pxt.log("table: set failed, cleaning translation db"),pxt.BrowserUtils.clearTranslationDbAsync().then((()=>pxt.BrowserUtils.clearTutorialInfoDbAsync())).then((()=>this.setAsyncNoRetry(e))).catch((e=>{throw pxt.log("table: we are out of space..."),e}));pxt.debug("table: set conflict (409)")}))}setAsyncNoRetry(e){return e.id&&!e._id&&(e._id=this.name+"--"+e.id),o().then((t=>t.put(e))).then((e=>e.rev))}}i.Table=s;pxt.github.db=new class{constructor(){this.mem=new pxt.github.MemoryGithubDb,this.table=new s("github")}loadConfigAsync(e,t){if("master"==t)return this.mem.loadConfigAsync(e,t);const i=`config-${e}-${t}`;return this.table.getAsync(i).then((e=>(pxt.debug(`github offline cache hit ${i}`),e.config)),(n=>(pxt.debug(`github offline cache miss ${i}`),this.mem.loadConfigAsync(e,t).then((e=>this.table.forceSetAsync({id:i,config:e}).then((()=>e),(t=>e)))))))}loadPackageAsync(e,t){if("master"==(t=t||"master"))return this.mem.loadPackageAsync(e,t);const i=`pkg-${e}-${t}`;return this.table.getAsync(i).then((e=>(pxt.debug(`github offline cache hit ${i}`),e.package)),(n=>(pxt.debug(`github offline cache miss ${i}`),this.mem.loadPackageAsync(e,t).then((e=>this.table.forceSetAsync({id:i,package:e}).then((()=>e),(t=>e)))))))}}},{pouchdb:278,"pouchdb-adapter-memory":264}],83:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DebuggerCallStack=void 0;const n=e("react"),r=e("./debuggerTable");class o extends n.Component{constructor(e){super(e),this.handleRowClick=(e,t)=>{if(!this.props.openLocation)return;const[i,n]=t.props.refID.split("_").map((e=>parseInt(e))),r=this.props.stackframes[n];r&&r.breakpointId===i&&this.props.openLocation(r.breakpointId,n)}}render(){return n.createElement(r.DebuggerTable,{header:lf("Call Stack")},this.props.stackframes.map(((e,t)=>{if(!e.breakpointId)return null;const i=e.breakpointId+"_"+t;let o=e.funcInfo.fileName;return 0===o.indexOf("pxt_modules/")&&(o=o.slice(12)),n.createElement(r.DebuggerTableRow,{key:i,refID:i,onClick:this.handleRowClick,leftText:e.funcInfo.functionName,rightText:`${o}:${e.funcInfo.line}`,icon:t===this.props.activeFrame?"arrow right":void 0,rowClass:"callstack-row"})})))}}i.DebuggerCallStack=o},{"./debuggerTable":84,react:335}],84:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DebuggerTableRow=i.DebuggerTable=void 0;const n=e("react");class r extends n.Component{render(){return n.createElement("div",{className:"ui varExplorer"},n.createElement("div",{className:"ui variableTableHeader"},this.props.header),this.props.placeholderText&&n.createElement("div",{className:"ui variableTablePlaceholder"},this.props.placeholderText),n.createElement("div",{className:"ui segment debugvariables collapsing basic striped table"},this.props.children))}}i.DebuggerTable=r;class o extends n.Component{constructor(){super(...arguments),this.clickHandler=e=>{this.props.onClick&&this.props.onClick(e,this)},this.valueClickHandler=e=>{this.props.onValueClick&&this.props.onValueClick(e,this)}}render(){return n.createElement("div",{role:"listitem",className:`item ${this.props.rowClass||""}`,onClick:this.props.onClick?this.clickHandler:void 0,"aria-describedby":this.props.describedBy},n.createElement("div",{className:"variableAndValue"},n.createElement("div",{className:`variable varname ${this.props.leftClass||""}`,title:this.props.leftTitle,style:this.props.depth?{marginLeft:.75*this.props.depth+"em"}:void 0},n.createElement("i",{className:`ui icon small ${this.props.icon||"invisible"}`}),n.createElement("span",null,this.props.leftText)),n.createElement("div",{className:"variable detail",role:"button",style:{padding:.2},title:this.props.rightTitle,onClick:this.valueClickHandler},n.createElement("span",{className:`varval ${this.props.rightClass||""}`},this.props.rightText))))}}i.DebuggerTableRow=o},{react:335}],85:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DebuggerToolbar=void 0;const n=e("react"),r=e("react-dom"),o=e("./sui"),s=e("./data"),a=e("./simulator");class l extends s.Component{constructor(e){super(e),this.state={},this.restartSimulator=this.restartSimulator.bind(this),this.dbgPauseResume=this.dbgPauseResume.bind(this),this.dbgStepOver=this.dbgStepOver.bind(this),this.dbgStepInto=this.dbgStepInto.bind(this),this.dbgStepOut=this.dbgStepOut.bind(this),this.exitDebugging=this.exitDebugging.bind(this),this.toggleTrace=this.toggleTrace.bind(this)}restartSimulator(){pxt.tickEvent("debugger.restart",void 0,{interactiveConsent:!0}),this.props.parent.restartSimulator()}exitDebugging(){pxt.tickEvent("debugger.exit",void 0,{interactiveConsent:!0}),this.props.parent.toggleDebugging()}dbgPauseResume(){pxt.tickEvent("debugger.pauseresume",void 0,{interactiveConsent:!0}),this.props.parent.dbgPauseResume()}dbgStepOver(){pxt.tickEvent("debugger.stepover",void 0,{interactiveConsent:!0}),this.props.parent.dbgStepOver()}dbgStepInto(){pxt.tickEvent("debugger.stepinto",void 0,{interactiveConsent:!0}),this.props.parent.dbgStepInto()}dbgStepOut(){pxt.tickEvent("debugger.stepout",void 0,{interactiveConsent:!0}),a.dbgStepOut()}toggleTrace(){pxt.tickEvent("simulator.trace",void 0,{interactiveConsent:!0}),this.props.parent.toggleTrace()}getMenuDom(){const e=r.findDOMNode(this);return e&&e.firstElementChild}renderCore(){const e=this.props.parent.state,t=e.simState,i=t==pxt.editor.SimState.Running,r=t==pxt.editor.SimState.Starting,s=e.debugging;if(!s)return n.createElement("div",null);const l=a.driver&&a.driver.state==pxsim.SimulatorState.Running,c=!this.props.parent.isBlocksActive();if(!(c||this.props.parent.isBlocksActive()||pxt.appTarget.appTheme.debugExtensionCode))return n.createElement("div",null);const u=l||r,d=u?"disabled":"",p=lf("Restart debugging"),h=i?lf("Pause execution"):lf("Continue execution"),f=lf("Step into"),m=lf("Step over"),g=lf("Step out"),b=this.props.parent.state.tracing,v=b?lf("Disable Slow-Mo"):lf("Slow-Mo");return s?c?n.createElement("div",{className:"debugtoolbar",role:"complementary","aria-label":lf("Debugger toolbar")},s?n.createElement("div",{className:"ui compact borderless menu icon"},n.createElement(o.Item,{key:"dbgpauseresume",className:`dbg-btn dbg-pause-resume ${d} ${l?"pause":"play"}`,icon:""+(l?"pause blue":"play green"),title:h,onClick:this.dbgPauseResume}),n.createElement(o.Item,{key:"dbgstepover",className:`dbg-btn dbg-step-over ${d}`,icon:"xicon stepover "+(l?"disabled":"blue"),title:m,onClick:this.dbgStepOver}),n.createElement(o.Item,{key:"dbgstepinto",className:`dbg-btn dbg-step-into ${d}`,icon:"xicon stepinto "+(l?"disabled":""),title:f,onClick:this.dbgStepInto}),n.createElement(o.Item,{key:"dbgstepout",className:`dbg-btn dbg-step-out ${d}`,icon:"xicon stepout "+(l?"disabled":""),title:g,onClick:this.dbgStepOut}),n.createElement(o.Item,{key:"dbgrestart",className:"dbg-btn dbg-restart right",icon:"refresh green",title:p,onClick:this.restartSimulator}),n.createElement(o.Item,{key:"dbgslowmo",className:"dbg-btn dbg-trace "+(b?"tracing":""),icon:"xicon turtle",title:v,onClick:this.toggleTrace})):void 0):n.createElement("div",{className:"debugtoolbar",role:"complementary","aria-label":lf("Debugger toolbar")},n.createElement("div",{className:"ui compact borderless menu icon"},n.createElement(o.Item,{key:"dbgstep",className:`dbg-btn dbg-step separator-after ${d}`,icon:"arrow right "+(u?"disabled":"blue"),title:f,onClick:this.dbgStepInto,text:"Step"}),n.createElement(o.Item,{key:"dbgpauseresume",className:"dbg-btn dbg-pause-resume "+(l?"pause":"play"),icon:""+(l?"pause blue":"play green"),title:h,onClick:this.dbgPauseResume}),n.createElement(o.Item,{key:"dbgrestart",className:"dbg-btn dbg-restart",icon:"refresh green",title:p,onClick:this.restartSimulator}),n.createElement(o.Item,{key:"dbgslowmo",className:"dbg-btn dbg-trace "+(b?"tracing":""),icon:"xicon turtle",title:v,onClick:this.toggleTrace}))):n.createElement("div",{className:"debugtoolbar",role:"complementary","aria-label":lf("Debugger toolbar")})}}i.DebuggerToolbar=l},{"./data":81,"./simulator":135,"./sui":143,react:335,"react-dom":291}],86:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DebuggerToolbox=void 0;const n=e("react"),r=e("./debuggerCallStack"),o=e("./debuggerVariables"),s=e("./debuggerToolbar");class a extends n.Component{constructor(e){super(e),this.state={sequence:0,currentFrame:0}}setBreakpoint(e,t){this.setState({lastBreakpoint:e,currentFrame:0,sequence:this.state.sequence+1,varFilters:t||this.state.varFilters})}render(){return n.createElement("div",null,n.createElement(s.DebuggerToolbar,{parent:this.props.parent}),n.createElement(o.DebuggerVariables,{apis:this.props.apis,breakpoint:this.state.lastBreakpoint,filters:this.state.varFilters,activeFrame:this.state.currentFrame,sequence:this.state.sequence}),this.props.showCallStack&&n.createElement(r.DebuggerCallStack,{openLocation:this.props.openLocation,activeFrame:this.state.currentFrame,stackframes:this.state.lastBreakpoint?this.state.lastBreakpoint.stackframes:[]}))}}i.DebuggerToolbox=a},{"./debuggerCallStack":83,"./debuggerToolbar":85,"./debuggerVariables":87,react:335}],87:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DebuggerVariables=void 0;const n=e("react"),r=e("./data"),o=e("./simulator"),s=e("./debuggerTable");class a extends r.Component{constructor(e){super(e),this.handleComponentClick=(e,t)=>{if(this.state.frozen)return;const i=this.getVariableById(t.props.refID);i&&(this.toggle(i),null!==this.state.preview&&this.setState({preview:null}))},this.handleValueClick=(e,t)=>{if(this.state.frozen)return;const i=t.props.refID,n=e.target.getBoundingClientRect();this.setState({preview:{id:i,top:n.top,left:n.left}})},this.handlePreviewRef=e=>{if(e){const t=this.state.preview;e.focus(),e.addEventListener("blur",(()=>{var e;(null===(e=this.state.preview)||void 0===e?void 0:e.id)===t.id&&this.setState({preview:null})}));const i=window.getSelection();i.removeAllRanges();const n=document.createRange();n.selectNodeContents(e),i.addRange(n)}},this.state={globalFrame:{title:lf("Globals"),variables:[]},stackFrames:[],nextID:0,preview:null}}clear(){this.setState({globalFrame:{title:this.state.globalFrame.title,variables:[]},stackFrames:[],preview:null})}update(e=!1){this.setState({frozen:e,preview:e?null:this.state.preview})}componentDidUpdate(e){this.props.breakpoint?this.props.sequence!=this.state.renderedSequence&&this.updateVariables(this.props.breakpoint,this.props.filters):this.state.frozen||this.update(!0)}renderCore(){const{globalFrame:e,stackFrames:t,frozen:i,preview:r}=this.state,{activeFrame:o,breakpoint:a}=this.props,l=lf("Variables");let c,u=e.variables;t&&t.length&&void 0!==o&&(u=t[o].variables.concat(u)),i?c=lf("Code is running..."):u.length||(null==a?void 0:a.exceptionMessage)||(c=lf("No variables to show"));const d=c?[]:this.renderVars(u);(null==a?void 0:a.exceptionMessage)&&!i&&d.unshift(n.createElement(s.DebuggerTableRow,{leftText:lf("Exception:"),leftClass:"exception",key:"exception-message",rightText:h(a.exceptionMessage),rightTitle:a.exceptionMessage}));const f=this.getVariableById(null==r?void 0:r.id),m=f&&lf("Current value for '{0}'",f.name);return n.createElement("div",null,n.createElement(s.DebuggerTable,{header:l,placeholderText:c},d),r&&n.createElement("div",{id:"debugger-preview",role:"tooltip",className:"debugger-preview",ref:this.handlePreviewRef,tabIndex:0,"aria-label":m,style:{top:`${r.top}px`,left:`${r.left}px`}},p(f.value)))}renderVars(e,t=0,i=[]){var r;const o=null===(r=this.state.preview)||void 0===r?void 0:r.id;return e.forEach((e=>{const r=p(e.value),a=function(e){let t=e.value;if(null==t)return"undefined";let i=typeof t;switch(i){case"string":case"number":case"boolean":return i;case"object":return t.type?t.type:t.preview?t.preview:t.text?t.text:"object";default:return"unknown"}}(e);i.push(n.createElement(s.DebuggerTableRow,{key:e.id,describedBy:e.id===o?"debugger-preview":void 0,refID:e.id,icon:e.value&&e.value.hasFields?e.children?"down triangle":"right triangle":void 0,leftText:e.name+":",leftTitle:e.name,leftClass:void 0!==e.prevValue?"changed":void 0,rightText:h(r),rightTitle:f(a)?r:void 0,rightClass:a,onClick:this.handleComponentClick,onValueClick:this.handleValueClick,depth:t})),e.children&&this.renderVars(e.children,t+1,i)})),i}updateVariables(e,t){const{globals:i,environmentGlobals:n,stackframes:r}=e;if(!i&&!n)return void this.update(!0);let o=0;const s=c(this.state.globalFrame,i);let a;if(t&&(s.variables=s.variables.filter((e=>-1!==t.indexOf(e.name)))),n&&(s.variables=s.variables.concat(l(n))),d(s.variables),r){const e=this.state.stackFrames;(a=r.map(((t,i)=>{const n=t.breakpointId+"_"+i;for(const i of e)if(i.key===n)return c(i,t.locals,u(t.arguments));return c({key:n,title:t.funcInfo.functionName,variables:[]},t.locals,u(t.arguments))}))).forEach((e=>d(e.variables)))}function u(e){return e?null!=e.thisParam?[{name:"this",value:e.thisParam},...e.params]:e.params:[]}function d(e){e.forEach((e=>{e.id=o++,e.children&&d(e.children)}))}this.setState({globalFrame:s,stackFrames:a||[],nextID:o,renderedSequence:this.props.sequence,frozen:!1})}getVariableById(e){if(null===e)return null;for(const t of this.getFullVariableList())if(t.id===e)return t;return null}getFullVariableList(){let e=[];return t(this.state.globalFrame.variables),this.state.stackFrames&&this.state.stackFrames.forEach((e=>t(e.variables))),e;function t(i){i.forEach((i=>{e.push(i),i.children&&t(i.children)}))}}toggle(e){if(e.children)delete e.children,this.setState({globalFrame:this.state.globalFrame});else{if(!e.value||!e.value.id)return;let t=this.props.apis,i=new RegExp("^((.+.)?"+e.value.type+")."),n=Object.keys(t).filter((e=>i.test(e))),r=[];n.forEach((e=>{let i=t[e];!e.endsWith("@set")&&i&&i.attributes.callInDebugger&&r.push(e)})),o.driver.variablesAsync(e.value.id,r).then((t=>{if(t&&t.variables){let i=this.state.nextID;e.children=Object.keys(t.variables).map((e=>({name:e,value:t.variables[e],id:i++}))),this.setState({globalFrame:this.state.globalFrame,nextID:i})}}))}}}function l(e){return Object.keys(e).map((t=>({name:u(t),value:e[t]})))}function c(e,t,i){let n=l(t);return i&&(n=i.concat(n)),Object.assign(Object.assign({},e),{variables:d(e.variables,n)})}function u(e){return e.replace(/___\d+$/,"")}function d(e,t){return t.map((t=>{const i=function(e,t){for(let i=0;i<e.length;i++)if(e[i].name===t.name)return e[i]}(e,t);return i&&i.value&&!i.value.id&&i.value!==t.value?Object.assign(Object.assign({},t),{prevValue:i.value}):t}))}function p(e){let t="";switch(typeof e){case"undefined":t="undefined";break;case"number":case"boolean":t=e+"";break;case"string":t=JSON.stringify(e);break;case"object":if(null==e)t="null";else if(e.text)t=e.text;else{if(e.id&&e.preview)return e.preview;t=void 0!==e.id?"(object)":"(unknown)"}}return t}function h(e){let t=17,i=!1;return 0==e.indexOf('"')&&(t-=2,i=!0,e=e.substring(1,e.length-1)),e.length>t&&(e=e.substring(0,t)+"..."),i&&(e='"'+e+'"'),e}function f(e){switch(e){case"string":case"number":case"boolean":case"array":return!0;default:return!1}}i.DebuggerVariables=a},{"./data":81,"./debuggerTable":84,"./simulator":135,react:335}],88:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.isDontShowDownloadDialogFlagSet=i.clearDontShowDownloadDialogFlag=i.renderIncompatibleHardwareDialog=i.renderBrowserDownloadInstructions=i.promptTranslateBlock=i.showResetDialogAsync=i.showWinAppDeprecateAsync=i.showReportAbuseAsync=i.showImportFileDialogAsync=i.showImportGithubDialogAsync=i.showCreateGithubRepoDialogAsync=i.showGithubTokenError=i.showImportUrlDialogAsync=i.showPRDialogAsync=i.showPackageErrorDialogAsync=i.showAboutDialogAsync=void 0;const n=e("react"),r=e("./sui"),o=e("./core"),s=e("./coretsx"),a=e("./cloudsync");var l=pxt.Cloud,c=pxt.Util;const u=e("./util");let d=!1;function p(e,t,i){return n.createElement("p",null,lf("{0} version:",e)," ",n.createElement("a",{href:encodeURI(i),title:`${lf("{0} version: {1}",e,t)}`,"aria-label":`${lf("{0} version{1}",e,t)}`,target:"_blank",rel:"noopener noreferrer"},t))}i.showAboutDialogAsync=function(e){var t;pxt.appTarget.compileService;const i=pxt.appTarget.appTheme.githubUrl,r=pxt.appTarget.appTheme,s=pxt.appTarget.versions,a=[];r.experiments&&a.push({label:lf("Experiments"),className:"secondary",onclick:()=>{o.hideDialog(),pxt.tickEvent("about.experiments",void 0,{interactiveConsent:!0}),e.showExperimentsDialog()}});const l=((null===(t=pxt.appTarget.multiVariants)||void 0===t?void 0:t.map((e=>{const t=pxt.U.clone(pxt.appTarget.compileService),i=pxt.appTarget.variants[e];return(null==i?void 0:i.compileService)&&pxt.U.jsonCopyFrom(t,i.compileService),{variantName:e,compileService:t}})))||[{variantName:"",compileService:pxt.appTarget.compileService}]).filter((e=>e.compileService&&e.compileService.githubCorePackage&&e.compileService.gittag&&e.compileService.serviceId));pxt.targetConfigAsync().then((e=>{var t;const c=pxt.BrowserUtils.isPxtElectron(),u=null===(t=null==e?void 0:e.electronManifest)||void 0===t?void 0:t.latest;return o.confirmAsync({header:lf("About"),hasCloseIcon:!0,agreeLbl:lf("Ok"),agreeClass:"positive",buttons:a,jsx:n.createElement("div",null,c?pxt.Cloud.isOnline()&&u?pxt.semver.strcmp(pxt.appTarget.versions.target,u)<0?n.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"/offline-app"},lf("An update {0} for {1} is available",u,pxt.appTarget.title)):n.createElement("p",null,lf("{0} is up to date",pxt.appTarget.title)):n.createElement("p",null,lf("Please connect to internet to check for updates")):void 0,i&&s&&p(pxt.appTarget.name,s.target,`${i}/releases/tag/v${s.target}`),s&&p("Microsoft MakeCode",s.pxt,`https://github.com/Microsoft/pxt/releases/tag/v${s.pxt}`),(null==l?void 0:l.length)?l.map((e=>n.createElement("div",{key:e.variantName},function(e,t){let i,n,r;return"object"==typeof t.codalTarget&&"string"==typeof t.codalTarget.url?(i=t.codalTarget.branch?pxt.BrowserUtils.joinURLs(t.codalTarget.url,"releases/tag",t.codalTarget.branch):t.codalTarget.url,n=t.codalTarget.branch||"master",r=t.codalTarget.name||t.serviceId):(i=`https://github.com/${t.githubCorePackage}/releases/tag/${t.gittag}`,n=t.gittag,r=t.serviceId),p(lf("{0} runtime",r),n,i)}(e.variantName,e.compileService)))):void 0,n.createElement("p",null,n.createElement("br",null)),n.createElement("p",null,r.termsOfUseUrl?n.createElement("a",{target:"_blank",className:"item",href:r.termsOfUseUrl,rel:"noopener noreferrer"},lf("Terms of Use")):void 0," ",r.privacyUrl?n.createElement("a",{target:"_blank",className:"item",href:r.privacyUrl,rel:"noopener noreferrer"},lf("Privacy")):void 0),r.copyrightText?n.createElement("p",null," ",r.copyrightText," "):void 0)})}))},i.showPackageErrorDialogAsync=function(e,t,i){let r=!1;const s=new c.CancellationToken;return pxt.tickEvent("update.extensionErrorsShown"),o.dialogAsync({header:lf("Extension Errors"),hasCloseIcon:!0,jsx:n.createElement("div",{className:"wizard-wrapper"},n.createElement(h,{openLegacyEditor:i,affectedPackages:e,updatePackages:t,onProjectOpen:()=>r=!0,token:s}))}).then((()=>r?Promise.resolve():(o.showLoading("package-update-cancel",lf("Stopping update...")),s.cancelAsync()))).then((()=>(o.hideLoading("package-update-cancel"),r)))};class h extends n.Component{constructor(e){super(e),this.state={updating:!1,showProgressBar:!1,updateComplete:!1,packagesUpdated:0},this.startUpdate=this.startUpdate.bind(this),this.openProject=this.openProject.bind(this),this.openLegacyEditor=this.openLegacyEditor.bind(this)}startUpdate(){if(this.state.updating)return;pxt.tickEvent("update.startExtensionUpdate");const e=Date.now();this.setState({updating:!0}),setTimeout((()=>{this.props.token.isCancelled()||this.state.updating&&this.props.affectedPackages.length>1&&this.setState({showProgressBar:!0})}),3e3);const t=this.props.affectedPackages;this.props.token.onProgress((e=>{this.setState({packagesUpdated:e})})),this.props.updatePackages(t,this.props.token).then((t=>{this.props.token.isCancelled()||(pxt.tickEvent("update.endExtensionUpdate",{success:""+t,duration:Date.now()-e}),t?(this.setState({updating:!1,updateComplete:!0}),setTimeout((()=>{this.props.token.isCancelled()||this.openProject(!0)}),1500)):this.setState({updateError:!0,updating:!1}))}))}openProject(e=!1){e||pxt.tickEvent("update.ignoredExtensionErrors"),this.props.onProjectOpen(),s.hideDialog()}openLegacyEditor(){this.props.onProjectOpen(),this.props.openLegacyEditor()}buildActionList(){const e=[];return this.state.updateError||e.push({text:lf("Try to fix"),title:lf("Update all extensions in the project to their latest versions"),callback:this.startUpdate}),e.push({text:lf("Ignore errors and open"),title:lf("Ignore errors and open"),callback:this.openProject}),this.props.openLegacyEditor&&e.push({text:lf("Go to the old editor"),title:lf("Open this project in the editor where it was created"),callback:this.openLegacyEditor}),e}render(){const{affectedPackages:e}=this.props,{updating:t,updateComplete:i,packagesUpdated:r,updateError:o,showProgressBar:s}=this.state;if(t){const t=r===e.length?lf("Finishing up..."):lf("Updating extension {0} of {1}...",r+1,e.length);return n.createElement("div",null,s?n.createElement(f,{percentage:r/e.length*100,label:t}):n.createElement("div",{className:"ui centered inline inverted text loader"},t))}if(i)return n.createElement("div",null,n.createElement("h2",{className:"ui center aligned icon header"},n.createElement("i",{className:"green check circle outline icon"}),lf("Update complete")));const a=o?lf("Looks like updating didn't fix the issue. How would you like to proceed?"):lf("Looks like there are some errors in the extensions added to this project. How would you like to proceed?");return n.createElement("div",null,n.createElement("p",null,a),n.createElement(m,{actions:this.buildActionList()}))}}class f extends n.Component{render(){let{percentage:e,label:t,cornerRadius:i}=this.props;return i=null==i?3:Math.max(i,0),e=Math.max(Math.min(e,100),2),n.createElement("div",null,n.createElement("div",{className:"progress-bar-container"},n.createElement("svg",{className:"progress-bar",width:"100%",height:"100%"},n.createElement("rect",{className:"progress-bar-bg",width:"100%",height:"100%",rx:i,ry:i}),n.createElement("rect",{className:"progress-bar-content",width:e.toString()+"%",height:"100%",rx:i,ry:i}))),t?n.createElement("p",{className:"progress-bar-label"},t):void 0)}}class m extends r.StatelessUIElement{render(){return n.createElement("div",{className:"ui relaxed list",role:"menu"},this.props.actions.map((({text:e,title:t,callback:i},o)=>n.createElement("div",{className:"item wizard-action","aria-label":t,title:t,onClick:i,role:"menuitem",key:o},n.createElement("span",{className:"left floated"},n.createElement("i",{className:"medium arrow right icon"})),n.createElement(r.Link,null,e)))))}}function g(e){return 401==e.statusCode?(o.errorNotification(lf("GitHub didn't accept token")),!0):404==e.statusCode&&(o.errorNotification(lf("Token has neither '{0}' nor '{1}' scope","repo","public_repo")),!0)}i.showPRDialogAsync=function e(t,i){return o.confirmAsync({header:lf("Commit conflict in {0}",t),agreeLbl:lf("Resolve conflict"),disagreeLbl:lf("I'm done!"),body:lf("The latest online version of {0} contains edits conflicting with yours. We have created a pull request (PR) that you can use to resolve the conflicts. Once you're done, sync to get all merged changes. In the meantime we have taken you to the latest online version of {0}.",t)}).then((n=>n?(pxt.tickEvent("app.commit.pr"),window.open(i,"_blank"),e(t,i)):Promise.resolve()))},i.showImportUrlDialogAsync=function(){let e;const t=pxt.appTarget.appTheme.shareUrl||"https://makecode.com/";return o.confirmAsync({header:lf("Open project URL"),hasCloseIcon:!0,onLoaded:t=>{(e=t.querySelector("input")).onkeydown=e=>{if("Enter"===e.key){const e=t.querySelector(".button.approve");null==e||e.click()}}},jsx:n.createElement("div",{className:"ui form"},n.createElement("div",{className:"ui icon violet message"},n.createElement("i",{className:"user icon","aria-hidden":!0}),n.createElement("div",{className:"content"},n.createElement("h3",{className:"header"},lf("User-provided content")),n.createElement("p",null,lf("The content below is provided by a user, and is not endorsed by Microsoft."),n.createElement("br",null),lf("If you think it's not appropriate, please report abuse through Settings -> Report Abuse.")))),n.createElement("div",{className:"ui field"},n.createElement("label",{id:"selectUrlToOpenLabel"},lf("Copy the URL of the project.")),n.createElement("input",{type:"url",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectUrlToOpenLabel",placeholder:lf("{0} or {1}...",t,"https://github.com/..."),className:"ui blue fluid"})))}).then((t=>{if(t){pxt.tickEvent("app.open.url");const t=e.value;let i=pxt.github.normalizeRepoId(t);return i||(i=pxt.Cloud.parseScriptId(t)),i?Promise.resolve(i):Promise.reject(new Error(lf("Sorry, the project url looks invalid.")))}return Promise.resolve(void 0)}))},i.showGithubTokenError=g,i.showCreateGithubRepoDialogAsync=function(e){pxt.tickEvent("github.create.dialog"),e&&(e=(e=e.toLocaleLowerCase().replace(/\s+/g,"-")).replace(/[^\w\-]/g,""));let t=e||"",i="",a=!0;function l(){return t=="pxt-"+lf("Untitled").toLocaleLowerCase()||"pxt-untitled"==t?lf("Please pick a different name."):/^[\w\-]{1,64}$/.test(t)?void 0:lf("Repository names must be less than 64 characters and cannot include spaces or special characters.")}function c(e){e=e.trim(),t!=e&&(t=e,s.forceUpdate())}function u(e){i!=e&&(i=e,s.forceUpdate())}function d(e){const t=0==e.currentTarget.selectedIndex;a!=t&&(a=t,s.forceUpdate())}return o.confirmAsync({hasCloseIcon:!0,header:lf("Create GitHub repository"),jsxd:()=>{const e=l();return n.createElement("div",{className:"ui form"},n.createElement("p",null,lf("Host your code on GitHub and work together with friends."),r.helpIconLink("/github",lf("Learn more about GitHub"))),n.createElement("div",{className:"ui field"},n.createElement(r.Input,{type:"url",autoFocus:!0,value:t,onChange:c,label:lf("Repository name"),id:"githubRepoNameInput",placeholder:"pxt-my-gadget...",class:"fluid",error:e})),n.createElement("div",{className:"ui field"},n.createElement(r.Input,{type:"text",value:i,onChange:u,label:lf("Repository description"),id:"githubRepoDescriptionInput",placeholder:lf("MakeCode extension for my gadget"),class:"fluid"})),n.createElement("div",{className:"ui field"},n.createElement("select",{className:"ui dropdown",onChange:d,"aria-label":lf("Repository visibility setting")},n.createElement("option",{"aria-selected":a,value:"true"},lf("Public repository, anyone can look at your code.")),n.createElement("option",{"aria-selected":!a,value:"false"},lf("Private repository, your code is only visible to you.")))))}}).then((e=>{if(e){if(!l())return i=i||lf("A MakeCode project"),o.showLoading("creategithub",lf("creating {0} repository...",t)),pxt.github.createRepoAsync(t,i.trim(),!a).finally((()=>o.hideLoading("creategithub"))).then((e=>(pxt.tickEvent("github.create.ok"),pxt.github.normalizeRepoId("https://github.com/"+e.fullName))),(e=>(g(e)||(422==e.statusCode?o.errorNotification(lf("Repository '{0}' already exists.",t)):o.errorNotification(e.message),pxt.tickEvent("github.create.error",{statusCode:e.statusCode})),"")));o.errorNotification(lf("Invalid repository name.")),pxt.tickEvent("github.create.invalidname")}else pxt.tickEvent("github.create.cancel");return""}))},i.showImportGithubDialogAsync=function(){let e="",t=()=>{e="NEW",o.hideDialog()};return o.showLoading("githublist",lf("searching GitHub repositories...")),a.githubProvider(!0).routedLoginAsync("import").then((e=>e&&e.accessToken&&pxt.github.listUserReposAsync())).finally((()=>o.hideLoading("githublist"))).then((i=>{if(!i)return Promise.resolve(-1);const r=i.map((t=>({name:t.fullName,description:t.description,updatedAt:t.updatedAt,onClick:()=>{e=pxt.github.normalizeRepoId("https://github.com/"+t.fullName),o.hideDialog()}})));return o.confirmAsync({header:lf("Clone or create your own GitHub repo"),hideAgree:!0,hasCloseIcon:!0,jsx:n.createElement("div",{className:"ui form"},n.createElement("div",{className:"ui relaxed divided list"},n.createElement("div",{key:"create new",className:"item"},n.createElement("i",{className:"large plus circle middle aligned icon"}),n.createElement("div",{className:"content"},n.createElement("a",{onClick:t,role:"button",className:"header",tabIndex:0,onKeyDown:u.fireClickOnEnter,title:lf("Create new GitHub repository")},n.createElement("b",null,lf("Create new..."))),n.createElement("div",{className:"description"},lf("Create a new GitHub repo in your account.")))),r.map((e=>n.createElement("div",{key:e.name,className:"item"},n.createElement("i",{className:"large github middle aligned icon"}),n.createElement("div",{className:"content"},n.createElement("a",{onClick:e.onClick,role:"button",className:"header",tabIndex:0,onKeyDown:u.fireClickOnEnter},e.name),n.createElement("div",{className:"description"},pxt.Util.timeSince(e.updatedAt),". ",e.description)))))),n.createElement("div",{className:"ui icon green message"},n.createElement("i",{className:"info circle icon"}),n.createElement("div",{className:"content"},n.createElement("h3",{className:"header"},lf("Not finding what you're looking for?")),n.createElement("p",null,lf("Use the 'Import URL' option in the previous dialog to import repo by exact URL.")))))})})).then((()=>e))},i.showImportFileDialogAsync=function(e){let t,i=[pxt.appTarget.compile.saveAsPNG?".png":".mkcd"];return pxt.appTarget.compile.hasHex&&i.push(".hex"),pxt.appTarget.compile.useUF2&&i.push(".uf2"),o.confirmAsync({header:lf("Open {0} file",i.join(lf(" or "))),hasCloseIcon:!0,onLoaded:e=>{t=e.querySelectorAll("input")[0]},jsx:n.createElement("div",{className:"ui form"},n.createElement("div",{className:"ui field"},n.createElement("label",{id:"selectFileToOpenLabel"},lf("Select a {0} file to open.",i.join(lf(" or ")))),n.createElement("input",{type:"file",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectFileToOpenLabel",className:"ui blue fluid"})),n.createElement("div",{className:"ui secondary segment"},lf("You can import files by dragging and dropping them anywhere in the editor!")))}).then((e=>{if(e)return t.files[0]}))},i.showReportAbuseAsync=function(e){if(pxt.github.parseRepoId(e))return pxt.tickEvent("reportabuse.github"),void o.confirmAsync({header:lf("Is this content inappropriate?"),hasCloseIcon:!0,agreeLbl:lf("Report"),disagreeLbl:lf("Cancel"),jsx:n.createElement("div",{className:"ui form"},n.createElement("div",{className:"ui field"},n.createElement("p",null,lf("This content was written by an independent user and may be inappropriate or abusive. Help us block or filter that content by reporting it to Github."))),n.createElement("div",{className:"ui field"},n.createElement("label",{id:"githubContentUrlLabel"},lf("Content URL")),n.createElement(r.Input,{type:"url","aria-labelledby":"githubContentUrlLabel",readOnly:!0,lines:1,copy:!0,autoFocus:!pxt.BrowserUtils.isMobile(),selectOnClick:!0,value:e})))}).then((e=>{e&&window.open("https://github.com/contact/report-content","_blank")}));let t,i;const s=pxt.appTarget.appTheme.shareUrl||"https://makecode.com/";o.confirmAsync({header:lf("Report Abuse"),hasCloseIcon:!0,onLoaded:n=>{t=n.querySelectorAll("input")[0],i=n.querySelectorAll("textarea")[0],e&&(t.value=s+e)},agreeLbl:lf("Submit"),jsx:n.createElement("div",{className:"ui form"},n.createElement("div",{className:"ui field"},n.createElement("label",{id:"abuseUrlLabel"},lf("What is the URL of the offensive project?")),n.createElement("input",{type:"url","aria-labelledby":"abuseUrlLabel",tabIndex:0,autoFocus:!0,placeholder:"Enter project URL here..."})),n.createElement("div",{className:"ui field"},n.createElement("label",{id:"abuseDescriptionLabel"},lf("Why do you find it offensive?")),n.createElement("textarea",{"aria-labelledby":"abuseDescriptionLabel"})))}).then((e=>{if(e){pxt.tickEvent("app.reportabuse.send");const e=pxt.Cloud.parseScriptId(t.value);e?(o.infoNotification(lf("Sending abuse report...")),l.privatePostAsync(`${e}/abusereports`,{text:i.value}).then((e=>{o.infoNotification(lf("Report sent. Thank you!"))})).catch((e=>{404==e.statusCode?o.warningNotification(lf("Oops, we could not find this script.")):o.handleNetworkError(e)}))):o.errorNotification(lf("Sorry, the project url looks invalid."))}}))},i.showWinAppDeprecateAsync=function(){return pxt.tickEvent("winApp.dialog",void 0),o.confirmAsync({header:lf("You can't get there from here!"),hideAgree:!0,hasCloseIcon:!0,helpUrl:"/windows-app",jsx:n.createElement("div",null,n.createElement("img",{className:"ui medium centered image",src:pxt.appTarget.appTheme.winAppDeprImage,alt:lf("An image of a shrugging board")}),n.createElement("div",null,lf("This app is being deprecated. Text editing is only available on the MakeCode website "),`(https://${pxt.appTarget.name}).`))})},i.showResetDialogAsync=function(){return o.confirmAsync({header:lf("Reset"),body:lf("You are about to clear all projects. Are you sure? This operation cannot be undone."),agreeLbl:lf("Reset"),agreeClass:"red",agreeIcon:"sign out",disagreeLbl:lf("Cancel")})},i.promptTranslateBlock=function(e,t){o.confirmAsync({header:lf("Translate this block"),hideAgree:!0,hasCloseIcon:!0,helpUrl:"/translate",jsx:n.createElement("div",null,n.createElement("div",null,lf("Update the block translation below."),lf("Do not translate variable names (%name, $name)."),lf("Once validated in Crowdin, translations may take 24h to be active.")),t.map((e=>n.createElement("div",{key:`ictr${e}`,className:"ui basic segment"},e))))})},i.renderBrowserDownloadInstructions=function(e){var t,i,s,a;const l=pxt.appTarget.appTheme.boardName||lf("device"),c=pxt.appTarget.appTheme.driveDisplayName||pxt.appTarget.compile.driveName||"???",u=(null===(t=pxt.appTarget.compile)||void 0===t?void 0:t.useUF2)?".uf2":".hex",p=pxt.usb.isEnabled&&(null===(s=null===(i=pxt.appTarget)||void 0===i?void 0:i.compile)||void 0===s?void 0:s.webUSB),h=null===(a=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===a?void 0:a.dragFileImage,f=h?"two":"one";return n.createElement("div",{className:"ui grid stackable upload"},n.createElement("div",{className:"column sixteen wide instructions"},n.createElement("div",{className:"ui grid"},n.createElement("div",{className:"row"},n.createElement("div",{className:"column"},n.createElement("div",{className:`ui ${f} column grid padded`},n.createElement("div",{className:"column"},n.createElement("div",{className:"ui"},n.createElement("div",{className:"content"},n.createElement("div",{className:"description"},lf("Your code is being downloaded as a {1} file. You can drag this file to your {0} using your computer's file explorer.",l,u)),p&&n.createElement("div",{className:"download-callout"},n.createElement("label",{className:"ui purple ribbon large label"},lf("New!")),n.createElement("div",{className:"ui two column grid"},n.createElement("div",{className:"icon-align three wide column"},n.createElement("div",null),n.createElement("i",{className:"icon big usb"}),n.createElement("div",null)),n.createElement("div",{className:"thirteen wide column"},lf("Download your code faster by pairing with web usb!"),n.createElement("br",null),n.createElement("strong",null,n.createElement("a",{onClick:()=>{o.hideDialog(),pxt.commands.webUsbPairDialogAsync(pxt.usb.pairAsync,o.confirmAsync)}},lf("Pair now"))))))))),h&&n.createElement("div",{className:"column"},n.createElement("div",{className:"ui"},n.createElement("div",{className:"image"},n.createElement("img",{alt:lf("Comic moving {1} file to {0}",c,u),className:"ui medium rounded image",src:h})))))))),n.createElement("div",null,!e&&n.createElement(r.Checkbox,{inputLabel:lf("Don't show this again"),onChange:e=>{const t=""+e;pxt.tickEvent("downloaddialog.dontshowagain",{checked:t}),d=e}}))))},i.renderIncompatibleHardwareDialog=function(){var e,t;const i=pxt.appTarget.appTheme.boardName||lf("device"),r=lf("Oops! Looks like your project has code that won't run on the hardware you have connected. Would you like to download anyway?"),o=lf("Learn more about what's supported by your hardware"),s=null===(e=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===e?void 0:e.incompatibleHardwareHelpURL,a=null===(t=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===t?void 0:t.incompatibleHardwareImage,l=a?"two":"one";return n.createElement("div",{className:`ui ${l} column grid padded download-dialog`},n.createElement("div",{className:"column"},n.createElement("div",{className:"ui"},n.createElement("div",{className:"content"},n.createElement("div",{className:"description"},r,n.createElement("br",null),s&&n.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:s},o))))),a&&n.createElement("div",{className:"column"},n.createElement("div",{className:"ui"},n.createElement("div",{className:"image download-dialog-image"},n.createElement("img",{alt:lf("Image of {0}",i),className:"ui medium rounded image",src:a})))))},i.clearDontShowDownloadDialogFlag=function(){d=!1},i.isDontShowDownloadDialogFlagSet=function(){return d}},{"./cloudsync":27,"./core":78,"./coretsx":79,"./sui":143,"./util":149,react:335}],89:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.setupDragAndDrop=void 0,i.setupDragAndDrop=function(e,t,i,n){e.addEventListener("paste",(function(e){if(e.clipboardData){let n=pxt.Util.toArray(e.clipboardData.files).filter(t);if(n.length>0)e.stopPropagation(),e.preventDefault(),i(n);else if(e.clipboardData.items&&e.clipboardData.items.length>0){let t=e.clipboardData.items[0].getAsFile();t&&(e.stopPropagation(),e.preventDefault(),i([t]))}}})),e.addEventListener("dragover",(function(e){let t=e.dataTransfer.types,i=!1;for(let e=0;e<t.length;++e)"Files"!=t[e]&&"text/uri-list"!=t[e]||(i=!0);return!i||(e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="copy",!1)}),!1),e.addEventListener("drop",(function(e){let t=pxt.Util.toArray(e.dataTransfer.files);if(t.length>0)e.stopPropagation(),e.preventDefault(),i(t);else if(e.dataTransfer.types.indexOf("text/uri-list")>-1){const t=e.dataTransfer.getData("text/uri-list");t&&(e.stopPropagation(),e.preventDefault(),n(t))}return!1}),!1),e.addEventListener("dragend",(function(e){return!1}),!1)}},{}],90:[function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};Object.defineProperty(i,"__esModule",{value:!0}),i.SmallEditorToolbar=i.ZoomSlider=i.EditorToolbar=void 0;const r=e("react"),o=e("./data"),s=e("./sui"),a=e("./githubbutton"),l=e("./cmds"),c=e("./identity");var u,d;(d=u||(u={}))[d.Computer=0]="Computer",d[d.Tablet=1]="Tablet",d[d.Mobile=2]="Mobile";class p extends o.Component{constructor(e){super(e),this.onHwItemClick=()=>{pxt.hasHwVariants()?this.props.parent.showChooseHwDialog(!0):this.props.parent.showBoardDialogAsync(void 0,!0)},this.onDownloadButtonClick=()=>{pxt.tickEvent("editortools.downloadbutton",{collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.compile()},this.onHwDownloadClick=()=>{pxt.tickEvent("editortools.download",{collapsed:this.getCollapsedState()},{interactiveConsent:!0}),pxt.tickEvent("editortools.downloadasfile",{collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.compile(!0)},this.onPairClick=()=>{pxt.tickEvent("editortools.pair",void 0,{interactiveConsent:!0}),this.props.parent.pairAsync()},this.onDisconnectClick=()=>{l.showDisconnectAsync()},this.onHelpClick=()=>{var e;pxt.tickEvent("editortools.downloadhelp"),window.open(null===(e=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===e?void 0:e.downloadMenuHelpURL)},this.saveProjectName=this.saveProjectName.bind(this),this.compile=this.compile.bind(this),this.saveFile=this.saveFile.bind(this),this.undo=this.undo.bind(this),this.redo=this.redo.bind(this),this.zoomIn=this.zoomIn.bind(this),this.zoomOut=this.zoomOut.bind(this),this.startStopSimulator=this.startStopSimulator.bind(this),this.toggleDebugging=this.toggleDebugging.bind(this),this.toggleCollapsed=this.toggleCollapsed.bind(this),this.cloudButtonClick=this.cloudButtonClick.bind(this)}saveProjectName(e,t){pxt.tickEvent("editortools.projectrename",{view:t},{interactiveConsent:!0}),this.props.parent.updateHeaderName(e)}compile(e){this.setState({compileState:"compiling"}),pxt.tickEvent("editortools.download",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.compile()}saveFile(e){pxt.tickEvent("editortools.save",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.saveAndCompile()}undo(e){pxt.tickEvent("editortools.undo",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.undo()}redo(e){pxt.tickEvent("editortools.redo",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.redo()}zoomIn(e){pxt.tickEvent("editortools.zoomIn",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.zoomIn(),this.props.parent.forceUpdate()}zoomOut(e){pxt.tickEvent("editortools.zoomOut",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0}),this.props.parent.editor.zoomOut(),this.props.parent.forceUpdate()}startStopSimulator(e){pxt.tickEvent("editortools.startStopSimulator",{view:e,collapsed:this.getCollapsedState(),headless:this.getHeadlessState()},{interactiveConsent:!0}),this.props.parent.startStopSimulator({clickTrigger:!0})}toggleDebugging(e){pxt.tickEvent("editortools.debug",{view:e,collapsed:this.getCollapsedState(),headless:this.getHeadlessState()},{interactiveConsent:!0}),this.props.parent.toggleDebugging()}toggleCollapsed(){pxt.tickEvent("editortools.portraitToggleCollapse",{collapsed:this.getCollapsedState(),headless:this.getHeadlessState()},{interactiveConsent:!0}),this.props.parent.toggleSimulatorCollapse()}cloudButtonClick(e){pxt.tickEvent("editortools.cloud",{view:e,collapsed:this.getCollapsedState()},{interactiveConsent:!0})}componentDidUpdate(){var e,t;this.props.parent.state.compiling?(null===(e=this.state)||void 0===e?void 0:e.compileState)||this.setState({compileState:"compiling"}):"compiling"===(null===(t=this.state)||void 0===t?void 0:t.compileState)&&(this.props.parent.state.cancelledDownload?this.setState({compileState:null}):(this.setState({compileState:"success"}),this.compileTimeout&&clearTimeout(this.compileTimeout),this.compileTimeout=setTimeout((()=>{var e;"success"===(null===(e=this.state)||void 0===e?void 0:e.compileState)&&this.setState({compileState:null})}),2e3)))}componentWillUnmount(){this.compileTimeout&&clearTimeout(this.compileTimeout)}getCollapsedState(){return""+this.props.parent.state.collapseEditorTools}getHeadlessState(){return pxt.appTarget.simulator.headless?"true":"false"}getSaveInput(e,t,i,n){let o="";this.props.parent.state.isSaving?o="loading disabled":this.props.parent.state.compiling&&(o="disabled");let s=[];return s.push(r.createElement("label",{htmlFor:t,className:"accessible-hidden phone hide",key:"label"},lf("Type a name for your project"))),s.push(r.createElement(m,{id:t,view:this.getViewString(0),key:"input",type:"text","aria-labelledby":t,placeholder:lf("Pick a name..."),value:i||"",onChangeValue:this.saveProjectName,disabled:n,readOnly:n})),e&&s.push(r.createElement(f,{icon:"save",className:`right attached editortools-btn save-editortools-btn ${o}`,title:lf("Save"),ariaLabel:lf("Save the project"),onButtonClick:this.saveFile,view:this.getViewString(0),key:"save0"})),s}getZoomControl(e){return[r.createElement(f,{icon:"minus circle",className:"editortools-btn zoomout-editortools-btn",title:lf("Zoom Out"),onButtonClick:this.zoomOut,view:this.getViewString(e),key:"minus"}),r.createElement(f,{icon:"plus circle",className:"editortools-btn zoomin-editortools-btn",title:lf("Zoom In"),onButtonClick:this.zoomIn,view:this.getViewString(e),key:"plus"})]}getUndoRedo(e){const t=this.props.parent.editor.hasUndo(),i=this.props.parent.editor.hasRedo();return[r.createElement(f,{icon:"xicon undo",className:"editortools-btn undo-editortools-btn "+(t?"":"disabled"),title:lf("Undo"),ariaLabel:lf("{0}, {1}",lf("Undo"),t?"":lf("Disabled")),onButtonClick:this.undo,view:this.getViewString(e),key:"undo"}),r.createElement(f,{icon:"xicon redo",className:"editortools-btn redo-editortools-btn "+(i?"":"disabled"),title:lf("Redo"),ariaLabel:lf("{0}, {1}",lf("Redo"),i?"":lf("Disabled")),onButtonClick:this.redo,view:this.getViewString(e),key:"redo"})]}getViewString(e){return e.toString().toLowerCase()}getCompileButton(e){var t,i,n,o,a;const l=pxt.appTarget.appTheme,{compiling:c,isSaving:u}=this.props.parent.state,{compileState:d}=this.state,p=lf("Download your code to the {0}",l.boardName);let h;h="success"===d?l.useUploadMessage?lf("Uploaded!"):lf("Downloaded!"):l.useUploadMessage?lf("Upload"):lf("Download");const m=pxt.appTarget.simulator&&!!pxt.appTarget.simulator.dynamicBoardDefinition,g=pxt.usb.isEnabled&&(null===(i=null===(t=pxt.appTarget)||void 0===t?void 0:t.compile)||void 0===i?void 0:i.webUSB),b=!!this.getData("packetio:connected"),v=!!this.getData("packetio:connecting"),y=this.getData("packetio:icon"),k=b&&(null===(n=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===n?void 0:n.deviceSuccessIcon)||"xicon file-download-check",w=!!v&&"ping "+y||"success"===d&&k||!!b&&y||l.downloadIcon||"xicon file-download";let x="left attached ",E="",C=!1;switch(u?x+="disabled ":c&&(x+="loading disabled "),b?x+="connected ":v&&(x+="connecting "),e){case 2:x+="download-button-full ",C=!0;break;case 1:x+="download-button-full  ",E="",C=!0;break;case 0:default:x+="large fluid ",E="large"}let S=[];S.push(r.createElement(f,{key:"downloadbutton",icon:w,className:`primary download-button ${x}`,text:2!=e?h:void 0,title:p,onButtonClick:this.onDownloadButtonClick,view:"computer"}));const _=pxt.hwName||pxt.appTarget.appTheme.boardNickname||lf("device"),T=pxt.hwName||b&&lf("Connected to {0}",_)||v&&lf("Connecting...")||(m?lf("Click to select hardware"):g?lf("Click for one-click downloads."):void 0),A=2==e?lf("Hardware"):lf("Choose hardware"),N=2==e?pxt.hwName||lf("Download"):lf("Download as file"),I=null===(o=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===o?void 0:o.downloadMenuHelpURL,O=(null===(a=pxt.appTarget.appTheme.downloadDialogTheme)||void 0===a?void 0:a.deviceIcon)||"usb";return S.push(r.createElement(s.DropdownMenu,{key:"downloadmenu",role:"menuitem",icon:`ellipsis horizontal ${E}`,title:lf("Download options"),className:`${E} right attached editortools-btn hw-button button`,dataTooltip:T,displayAbove:!0,displayRight:C},g&&!b&&r.createElement(s.Item,{role:"menuitem",icon:O,text:lf("Connect device"),tabIndex:-1,onClick:this.onPairClick}),g&&(v||b)&&r.createElement(s.Item,{role:"menuitem",icon:O,text:lf("Disconnect"),tabIndex:-1,onClick:this.onDisconnectClick}),m&&r.createElement(s.Item,{role:"menuitem",icon:"microchip",text:A,tabIndex:-1,onClick:this.onHwItemClick}),r.createElement(s.Item,{role:"menuitem",icon:"xicon file-download",text:N,tabIndex:-1,onClick:this.onHwDownloadClick}),I&&r.createElement(s.Item,{role:"menuitem",icon:"help circle",text:lf("Help"),tabIndex:-1,onClick:this.onHelpClick}))),S}renderCore(){var e;const{tutorialOptions:t,projectName:i,compiling:n,isSaving:o,simState:s,debugging:l,editorState:u}=this.props.parent.state,d=null!==(e=this.getData(`header:${this.props.parent.state.header.id}`))&&void 0!==e?e:this.props.parent.state.header,p=pxt.appTarget.appTheme,h=pxt.shell.isControllerMode(),m=pxt.shell.isReadOnly(),g=!!t&&t.tutorial,b=pxt.appTarget.simulator.headless,v=u&&!1===u.hasCategories,y=p.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),k=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),w=!(!d||!pxt.github.parseRepoId(d.githubId)),x=!(m||h||p.saveInMenu||g||l||y||k||w),E=!(g||m||h||p.hideProjectRename||l),C=pxt.appTarget.compile,S=C.hasHex||C.saveAsPNG||C.useUF2,_=lf("Download your code to the {0}",p.boardName),T=!!n,A=s==pxt.editor.SimState.Running,N=s==pxt.editor.SimState.Starting,I=!m&&!l&&!v,O=!v,P=!!pxt.appTarget.cloud&&!!pxt.appTarget.cloud.githubPackages&&p.githubEditor&&!pxt.winrt.isWinRT()&&!pxt.BrowserUtils.isPxtElectron()&&!m&&!h&&!l&&!g,D=pxt.appTarget.appTheme.downloadIcon||"download",L=(()=>{switch(s){case pxt.editor.SimState.Stopped:return lf("Start");case pxt.editor.SimState.Pending:case pxt.editor.SimState.Starting:return lf("Starting");default:return lf("Stop")}})();let R="",M="";return o?(R="disabled",M="loading disabled"):T&&(R="loading disabled",M="disabled"),r.createElement("div",{id:"editortools",className:"ui",role:"region","aria-label":lf("Editor toolbar")},r.createElement("div",{id:"downloadArea",role:"menu",className:"ui column items"},b&&r.createElement("div",{className:"ui item"},r.createElement("div",{className:"ui icon large buttons"},S&&r.createElement(f,{icon:D,className:`primary large download-button mobile tablet hide ${R}`,title:_,onButtonClick:this.compile,view:"computer"}))),!b&&r.createElement("div",{className:"ui item portrait hide"},S&&this.getCompileButton(0)),!b&&r.createElement("div",{className:"ui portrait only"},S&&this.getCompileButton(2))),(E||P||c.CloudSaveStatus.wouldRender(d.id))&&r.createElement("div",{id:"projectNameArea",role:"menu",className:"ui column items"},r.createElement("div",{className:`ui right ${x?"labeled":""} input projectname-input projectname-computer`},E&&this.getSaveInput(x,"fileNameInput2",i,!1),P&&r.createElement(a.GithubButton,{parent:this.props.parent,key:"githubbtn0"}),r.createElement(c.CloudSaveStatus,{headerId:d.id}))),r.createElement("div",{id:"editorToolbarArea",role:"menu",className:"ui column items"},I&&r.createElement("div",{className:"ui icon buttons"},this.getUndoRedo(0)),O&&r.createElement("div",{className:"ui icon buttons mobile hide"},this.getZoomControl(0)),p.bigRunButton&&r.createElement("div",{className:"big-play-button-wrapper"},r.createElement(f,{className:"big-play-button play-button "+(A?"stop":"play"),key:"runmenubtn",disabled:N,icon:A?"stop":"play",title:L,onButtonClick:this.startStopSimulator,view:"computer"}))))}}i.EditorToolbar=p;class h extends o.Component{constructor(e){super(e),this.zoomMin=this.props.zoomMin?this.props.zoomMin:0,this.zoomMax=this.props.zoomMax?this.props.zoomMax:5,this.state={zoomValue:Math.floor((this.zoomMax+1-this.zoomMin)/2)+this.zoomMin},this.handleWheelZoom=this.handleWheelZoom.bind(this),this.zoomUpdate=this.zoomUpdate.bind(this),this.zoomOut=this.zoomOut.bind(this),this.zoomIn=this.zoomIn.bind(this)}componentDidMount(){window.addEventListener("wheel",this.handleWheelZoom)}componentWillUnmount(){window.removeEventListener("wheel",this.handleWheelZoom)}handleWheelZoom(e){e.ctrlKey&&(e.deltaY<0?this.increaseZoomState():this.decreaseZoomState())}decreaseZoomState(){this.state.zoomValue>this.zoomMin&&this.setState({zoomValue:this.state.zoomValue-1})}increaseZoomState(){this.state.zoomValue<this.zoomMax&&this.setState({zoomValue:this.state.zoomValue+1})}zoomOut(){this.state.zoomValue>this.zoomMin&&(this.decreaseZoomState(),this.props.parent.editor.zoomOut(),this.props.parent.forceUpdate())}zoomIn(){this.state.zoomValue<this.zoomMax&&(this.increaseZoomState(),this.props.parent.editor.zoomIn(),this.props.parent.forceUpdate())}zoomUpdate(e){const t=parseInt(e.target.value);if(this.state.zoomValue<t)for(let e=0;e<t-this.state.zoomValue;e++)this.props.parent.editor.zoomIn();else if(t<this.state.zoomValue)for(let e=0;e<this.state.zoomValue-t;e++)this.props.parent.editor.zoomOut();this.setState({zoomValue:t}),this.props.parent.forceUpdate()}renderCore(){return r.createElement("div",{className:"zoom"},r.createElement(f,{icon:"minus circle",className:"editortools-btn zoomout-editortools-btn borderless",title:lf("Zoom Out"),onButtonClick:this.zoomOut,view:this.props.view,key:"minus"}),r.createElement("div",{id:"zoomSlider"},r.createElement("input",{className:"zoomSliderBar",type:"range",min:this.zoomMin,max:this.zoomMax,step:"1",value:this.state.zoomValue.toString(),onChange:this.zoomUpdate,"aria-valuemax":this.zoomMax,"aria-valuemin":this.zoomMin,"aria-valuenow":this.state.zoomValue})),r.createElement(f,{icon:"plus circle",className:"editortools-btn zoomin-editortools-btn borderless",title:lf("Zoom In"),onButtonClick:this.zoomIn,view:this.props.view,key:"plus"}))}}i.ZoomSlider=h;i.SmallEditorToolbar=class extends p{constructor(e){super(e)}renderCore(){return r.createElement("div",{id:"headerToolbar",className:"smallEditorToolbar"},r.createElement(h,{parent:this.props.parent,view:super.getViewString(0),zoomMin:0,zoomMax:5}),r.createElement("div",{className:"ui icon undo-redo-buttons"},super.getUndoRedo(0)))}};class f extends s.StatelessUIElement{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this)}handleClick(){const{onButtonClick:e,view:t}=this.props;e(t)}renderCore(){const e=this.props,{onClick:t,onButtonClick:i,role:o}=e,a=n(e,["onClick","onButtonClick","role"]);return r.createElement(s.Button,Object.assign({role:o||"menuitem"},a,{onClick:this.handleClick}))}}class m extends r.Component{constructor(e){super(e),this.onChange=e=>{this.setState({editValue:e.target.value});const{onChangeValue:t,view:i}=this.props;t(e.target.value,i)},this.onBlur=e=>{if(!this.state.editValue)return;const{onChangeValue:t,view:i}=this.props;t(e.target.value,i),this.setState({editValue:void 0})},this.onKeyDown=e=>{"Enter"!==e.key||e.metaKey||e.shiftKey||(e.target.blur(),e.stopPropagation())},this.state={editValue:void 0}}render(){const e=this.props,{onChange:t,onChangeValue:i,view:o}=e,s=n(e,["onChange","onChangeValue","view"]),{editValue:a}=this.state;return r.createElement("input",Object.assign({onChange:this.onChange,onBlur:this.onBlur,onKeyDown:this.onKeyDown,className:"mobile hide ui",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1},s,{value:void 0!==a?a:this.props.value}))}}},{"./cmds":28,"./data":81,"./githubbutton":97,"./identity":105,"./sui":143,react:335}],91:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.openDevTools=i.driveDeployAsync=i.initElectron=void 0;const n=e("./cmds"),r=e("./core"),o=window.pxtElectron;i.initElectron=function(e){if(!pxt.BrowserUtils.isPxtElectron())return;o.onTelemetry((e=>{pxt.tickEvent(e.event,e.data)})),o.onUpdateInstalled((()=>{r.infoNotification(lf("An update will take effect after the app restarts"))})),o.onDriveDeployResult((e=>{if(s)if(e)pxt.tickEvent("electron.drivedeploy.success"),s.resolve();else{pxt.tickEvent("electron.drivedeploy.failure");const e=new Error("electron drive deploy failed");s.reject(e)}else pxt.tickEvent("electron.drivedeploy.unknowndeployoperation")}));const t=new Promise((e=>{o.onCriticalUpdateFailed((()=>{pxt.tickEvent("electron.criticalupdate.failed"),e()}))}));o.onUpdateStatus((i=>{switch(pxt.debug(`Electron app update status: ${i}`),pxt.tickEvent(`electron.updatestatus.${i}`),"updating-critical"!==i&&"banned-without-update"!==i||e.stopSimulator(),i){case"update-available":case"ok":return;case"updating-critical":r.confirmAsync({header:lf("Critical update required"),body:lf("A critical update is installing. Please do not quit the app. It will automatically restart when the update has completed."),hideAgree:!0,disagreeLbl:lf("Ok"),disagreeClass:"green",size:"large"}).then((()=>{r.showLoading("pxt-electron-update",lf("Installing update..."))})),t.then((()=>{r.hideLoading("pxt-electron-update"),r.hideDialog(),r.confirmAsync({header:lf("Critical update failed"),body:lf("There was an error installing the critical update. Please ensure you are connected to the Internet and try again later."),hideAgree:!0,disagreeLbl:lf("Quit"),disagreeClass:"red",size:"large"}).then((e=>{o.sendQuit()}))}));break;case"banned-without-update":r.confirmAsync({header:lf("Critical update required"),body:lf("We have disabled this app for security reasons. Please ensure you are connected to the Internet and try again later. An update will be automatically installed as soon as it is available."),hideAgree:!0,disagreeLbl:lf("Quit"),disagreeClass:"red",size:"large"}).then((e=>{o.sendQuit()}));default:return}})),o.sendUpdateStatusCheck()};let s=null;i.driveDeployAsync=function(e){return pxt.BrowserUtils.isPxtElectron()?(s||(s=pxt.Util.defer(),o.sendDriveDeploy(e)),s.promise.catch((t=>(pxt.tickEvent("electron.drivedeploy.browserdownloadinstead"),n.browserDownloadDeployCoreAsync(e)))).finally((()=>{s=null}))):n.browserDownloadDeployCoreAsync(e)},i.openDevTools=function(){o&&o.sendOpenDevTools()}},{"./cmds":28,"./core":78}],92:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ErrorList=void 0;const n=e("react"),r=e("./sui"),o=e("./util");class s extends n.Component{constructor(e){super(e),this.state={isCollapsed:!0,errors:[],exception:null,blockErrors:[]},this.onCollapseClick=this.onCollapseClick.bind(this),this.onErrorsChanged=this.onErrorsChanged.bind(this),this.onBlockErrorsChanged=this.onBlockErrorsChanged.bind(this),this.onExceptionDetected=this.onExceptionDetected.bind(this),this.onErrorMessageClick=this.onErrorMessageClick.bind(this),this.onDisplayStateChange=this.onDisplayStateChange.bind(this),this.getCompilerErrors=this.getCompilerErrors.bind(this),this.generateStackTraces=this.generateStackTraces.bind(this),this.listBlockErrors=this.listBlockErrors.bind(this),e.isInBlocksEditor?e.listenToBlockErrorChanges("errorList",this.onBlockErrorsChanged):(e.listenToErrorChanges("errorList",this.onErrorsChanged),e.listenToExceptionChanges("errorList",this.onExceptionDetected))}render(){const{isCollapsed:e,errors:t,exception:i,blockErrors:s}=this.state,a=!!(null==t?void 0:t.length)||!!i||!!(null==s?void 0:s.length),l=(lf("Collapse Error List"),e?void 0:this.props.isInBlocksEditor?this.listBlockErrors(s):i?this.generateStackTraces(i):this.getCompilerErrors(t)),c=this.props.isInBlocksEditor?s.length:i?1:t.length;return n.createElement("div",{className:`errorList ${e?"errorListSummary":""} ${this.props.isInBlocksEditor?"errorListBlocks":""}`,hidden:!a},n.createElement("div",{className:"errorListHeader",role:"button","aria-label":lf("{0} error list",e?lf("Expand"):lf("Collapse")),onClick:this.onCollapseClick,onKeyDown:o.fireClickOnEnter,tabIndex:0},n.createElement("h4",null,lf("Problems")),n.createElement("div",{className:"ui red circular label countBubble"},c),n.createElement("div",{className:"toggleButton"},n.createElement(r.Icon,{icon:"chevron "+(e?"up":"down")}))),!e&&n.createElement("div",{className:"errorListInner"},i&&n.createElement("div",{className:"debuggerSuggestion",role:"button",onClick:this.props.startDebugger,onKeyDown:o.fireClickOnEnter,tabIndex:0},lf("Debug this project"),n.createElement(r.Icon,{className:"debug-icon",icon:"icon bug"})),l))}onDisplayStateChange(){const{errors:e,exception:t,isCollapsed:i}=this.state,n=!((null==e?void 0:e.length)||t);this.props.onSizeChange&&this.props.onSizeChange(n?void 0:i?pxt.editor.ErrorListState.HeaderOnly:pxt.editor.ErrorListState.Expanded)}onCollapseClick(){pxt.tickEvent("errorlist.collapse",null,{interactiveConsent:!0}),this.setState({isCollapsed:!this.state.isCollapsed},this.onDisplayStateChange)}onErrorMessageClick(e,t){pxt.tickEvent("errorlist.goto",{errorIndex:t},{interactiveConsent:!0}),this.props.goToError(e)}onErrorsChanged(e){this.setState({errors:e,isCollapsed:0==(null==e?void 0:e.length)||this.state.isCollapsed,exception:null},this.onDisplayStateChange)}onBlockErrorsChanged(e){this.setState({blockErrors:e,isCollapsed:0==(null==e?void 0:e.length)||this.state.isCollapsed,exception:null},this.onDisplayStateChange)}onExceptionDetected(e,t){this.setState({isCollapsed:!1,exception:e,callLocations:t})}getCompilerErrors(e){function t(e){return`${e.messageText}-${e.fileName}-${e.line}-${e.column}`}const i=function(e){const t=new Map;let i=0;for(const n of e){const e=l(n);t.has(e)?t.get(e).count++:t.set(e,{index:i++,count:1,error:n})}const n=[];return t.forEach((e=>n.push(e))),n.sort(((e,t)=>e.index-t.index))}(e);return n.createElement("div",{className:"ui selection list"},i.map(((e,i)=>n.createElement(a,{key:t(e.error),index:i,error:e,revealError:this.onErrorMessageClick}))))}generateStackTraces(e){return n.createElement("div",null,n.createElement("div",{className:"exceptionMessage"},pxt.Util.rlf(e.exceptionMessage)),n.createElement("div",{className:"ui selection list"},(e.stackframes||[]).map(((e,t)=>{const i=this.state.callLocations[e.callLocationId];return i?n.createElement(a,{key:t,index:t,stackframe:e,location:i,revealError:this.onErrorMessageClick}):null}))))}listBlockErrors(e){return n.createElement("div",{className:"ui selection list"},(e||[]).map(((e,t)=>n.createElement(a,{index:t,key:`${t}-${e}`,blockError:e}))))}}i.ErrorList=s;class a extends n.Component{constructor(e){super(e),this.onErrorListItemClick=this.onErrorListItemClick.bind(this)}render(){const{error:e,stackframe:t,location:i,blockError:r}=this.props,s=r?lf("{0}",r.message):t?function(e,t){return lf("at {0} (line {1})",e.funcInfo.functionName,t.line+1)}(t,i):l(e.error),a=t||r?1:e.count;return n.createElement("div",{className:"item "+(t?"stackframe":""),role:"button",onClick:r?void 0:this.onErrorListItemClick,onKeyDown:o.fireClickOnEnter,"aria-label":lf("Go to {0}: {1}",t?"":"error",s),tabIndex:0},s," ",a<=1?null:n.createElement("div",{className:"ui gray circular label countBubble"},a))}onErrorListItemClick(){const e=this.props.stackframe?this.props.location:this.props.error.error;this.props.revealError(e,this.props.index)}}function l(e){return lf("Line {0}: {1}",e.endLine?e.endLine+1:e.line+1,e.messageText)}},{"./sui":143,"./util":149,react:335}],93:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.resolveExtensionUrl=i.ExtensionManager=void 0;const n=e("./package");function r(e,t){const i=n.mainEditorPkg();t.resp=i.getAllFiles()}i.ExtensionManager=class{constructor(e){this.host=e,this.nameToExtId={},this.extIdToName={},this.streams={},this.messages={}}clear(){}streamingExtensions(){return Object.keys(this.streams)}messagesExtensions(){return Object.keys(this.messages)}handleExtensionMessage(e){this.handleRequestAsync(e).catch((e=>{}))}sendEvent(e,t){this.host.send(e,function(e){return{target:pxt.appTarget.id,type:"pxtpkgext",event:e}}(t))}getExtId(e){return this.nameToExtId[e]||(this.nameToExtId[e]=ts.pxtc.Util.guidGen(),this.extIdToName[this.nameToExtId[e]]=e),this.nameToExtId[e]}sendResponse(e){this.host.send(this.extIdToName[e.extId],e)}handleRequestAsync(e){var t;const i=function(e,t=!0){return{type:"pxtpkgext",id:e.id,extId:e.extId,success:t}}(e);switch(e.action){case"extinit":i.target=pxt.appTarget,this.sendResponse(i);break;case"extdatastream":return(null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.messages)?this.operation(e.extId,i,((e,t)=>this.handleMessageStreamRequest(e,t))):this.operation(e.extId,i,((e,t)=>this.handleDataStreamRequest(e,t)));case"extusercode":return this.operation(e.extId,i,r);case"extreadcode":(function(e,t){const i=n.mainEditorPkg(),r=ts.pxtc.escapeIdentifier(e),o=i.getAllFiles();t.resp={json:o[r+".json"],code:o[r+".ts"],jres:o[r+".jres"],asm:o[r+".asm"]}})(this.extIdToName[e.extId],i),this.sendResponse(i);break;case"extwritecode":const o=()=>function(e,t,i){var r;const o=n.mainEditorPkg(),s=ts.pxtc.escapeIdentifier(e);function a(e,t){return void 0!==e&&(!o.files[s+t]||o.files[s+t].content!=e)}let l,c=!1;if(a(i.json,".json")&&(c=!0,o.setFile(s+".json",i.json)),a(i.code,".ts")&&(c=!0,o.setFile(s+".ts",i.code)),a(i.jres,".jres")&&(c=!0,o.setFile(s+".jres",i.jres)),a(i.asm,".asm")&&(c=!0,o.setFile(s+".asm",i.asm)),i.dependencies){const e=pxt.Util.jsonTryParse(null===(r=o.files[pxt.CONFIG_NAME])||void 0===r?void 0:r.content);(null==e?void 0:e.dependencies)&&(l=Object.keys(i.dependencies).filter((t=>!e.dependencies[t])),c=c||!!(null==l?void 0:l.length))}return c?o.updateConfigAsync((e=>{void 0!==i.json&&e.files.indexOf(s+".json")<0&&e.files.push(s+".json"),void 0!==i.code&&e.files.indexOf(s+".ts")<0&&e.files.push(s+".ts"),void 0!==i.jres&&e.files.indexOf(s+".jres")<0&&e.files.push(s+".jres"),void 0!==i.asm&&e.files.indexOf(s+".asm")<0&&e.files.push(s+".asm"),null==l||l.forEach((t=>e.dependencies[t]=i.dependencies[t]))})).then((()=>o.saveFilesAsync())):Promise.resolve()}(this.extIdToName[e.extId],0,e.body).then((()=>this.sendResponse(i))),s=function(e){var t;let i;if(null==e?void 0:e.dependencies){const r=n.mainEditorPkg(),o=pxt.Util.jsonTryParse(null===(t=null==r?void 0:r.files[pxt.CONFIG_NAME])||void 0===t?void 0:t.content);(null==o?void 0:o.dependencies)&&(i=Object.keys(e.dependencies).filter((e=>!o.dependencies[e])))}return i}(e.body);(null==s?void 0:s.length)?this.operation(e.extId,i,o):o()}return Promise.resolve()}operation(e,t,i){return Promise.resolve().then((()=>{i(this.extIdToName[e],t),this.sendResponse(t)})).catch((e=>{t.success=!1,t.error=e,this.sendResponse(t)}))}handleDataStreamRequest(e,t){this.streams[e]=!0}handleMessageStreamRequest(e,t){this.messages[e]=!0}},i.resolveExtensionUrl=async function(e){var t;const{config:i,installedVersion:n}=e,{extension:r}=i,o=await pxt.packagesConfigAsync(),s=pxt.github.parseRepoId(n),a=pxt.github.repoStatus(s,o);let l="",c=!1;const u=pxt.BrowserUtils.isLocalHost()&&/debugextensions=1/i.test(window.location.href),d=!u&&pxt.BrowserUtils.isLocalHost()&&/localeditorextensions=1/i.test(window.location.href)&&r.localUrl;return u?(l="http://localhost:3232/extension.html",c=!0):d?(l=r.localUrl,c=!0):r.url&&a===pxt.github.GitRepoStatus.Approved&&(null===(t=null==o?void 0:o.approvedEditorExtensionUrls)||void 0===t?void 0:t.indexOf(r.url))>-1&&(pxt.log(`extension url ${r.url} trusted`),l=r.url,c=!0),pxt.log(`extension ${i.name}: resolved ${l}`),{url:l,name:i.name,trusted:c}}},{"./package":122}],94:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Extensions=void 0;const n=e("react"),r=e("./data"),o=e("./core"),s=e("./sui"),a=e("./extensionManager");class l extends r.Component{constructor(e){super(e),this.handleExtensionWrapperRef=e=>{this.extensionWrapper=e},this.state={visible:!1},this.manager=new a.ExtensionManager(this),window.addEventListener("message",this.processMessage.bind(this),!1),this.hide=this.hide.bind(this),this.updateDimensions=this.updateDimensions.bind(this)}unload(){const e=l.getCustomContent();e&&pxsim.U.removeChildren(e),this.manager.clear()}processSerialMessage(e){const t=this.manager.streamingExtensions();if(!(null==t?void 0:t.length))return;const i=e.data||"",n=e.id||"?",r={target:pxt.appTarget.id,type:"pxtpkgext",event:"extconsole",body:{source:n,sim:e.sim,data:i}};t.forEach((e=>this.send(e,r)))}processMessagePacketMessage(e){const t=this.manager.messagesExtensions();if(!(null==t?void 0:t.length))return;const i=e.data,n=e.channel,r=e.source,o={target:pxt.appTarget.id,type:"pxtpkgext",event:"extmessagepacket",body:{source:r,channel:n,data:i}};t.forEach((e=>this.send(e,o)))}processMessage(e){const t=e.data;"serial"===(null==t?void 0:t.type)?this.processSerialMessage(t):"messagepacket"===(null==t?void 0:t.type)&&this.processMessagePacketMessage(t)}hide(){this.setState({visible:!1}),l.getFrame(this.state.extension,!0).style.display="none",o.showLoading("reloadproject",lf("loading...")),this.send(this.state.extension,{target:pxt.appTarget.id,type:"pxtpkgext",event:"exthidden"}),this.props.parent.reloadHeaderAsync().then((()=>o.hideLoading("reloadproject")))}showExtensionAsync(e,t){this.setState({visible:!0,extension:e,url:t},(()=>{this.send(e,{target:pxt.appTarget.id,type:"pxtpkgext",event:"extshown"})}))}initializeFrame(){const e=l.getFrame(this.state.extension,!0);e.style.display="block",e.src||(e.src=this.state.url+"#"+this.manager.getExtId(this.state.extension),e.onload=()=>{this.send(this.state.extension,{target:pxt.appTarget.id,type:"pxtpkgext",event:"extloaded"})})}shouldComponentUpdate(e,t,i){return this.state.visible!=t.visible||this.state.extension!=t.extension}updateDimensions(){if(this.extensionWrapper){const e=60,t=this.extensionWrapper.getAttribute("data-frame");if(t){const i=l.getFrame(t,!1),n=document.getElementsByClassName("extensiondialog")[0];n&&i&&(n.getBoundingClientRect(),i.width=`${window.innerWidth}px`,i.height=window.innerHeight-e+"px",i.style.top=`${e}px`,i.style.left="0px")}}}componentDidMount(){window.addEventListener("resize",this.updateDimensions)}componentWillUnmount(){window.removeEventListener("resize",this.updateDimensions)}componentDidUpdate(){setTimeout((()=>{this.updateDimensions()}),0)}UNSAFE_componentWillUpdate(e,t){t.extension&&t.visible&&l.getFrame(t.extension,!0)}handleExtensionRequest(e){this.manager.handleExtensionMessage(e)}send(e,t){const i=l.getFrame(e,!1);i?i.contentWindow.postMessage(t,"*"):console.warn(`Attempting to post message to unloaded extesnion ${e}`)}static getCustomContent(){return document.getElementById("custom-content")}static getFrame(e,t){let i=this.getCustomContent().getElementsByClassName(`extension-frame-${e}`)[0];return!i&&t&&(i=this.createFrame(e)),i}static createFrame(e){const t=this.getCustomContent(),i=document.createElement("iframe");return i.className=`extension-frame extension-frame-${e}`,i.allowFullscreen=!0,i.setAttribute("sandbox","allow-same-origin allow-scripts"),i.frameBorder="0",i.style.display="none",t.appendChild(i),i}static hideAllFrames(){const e=this.getCustomContent();e&&pxt.Util.toArray(e.getElementsByClassName("extension-frame")).forEach((e=>{e.style.zIndex="10"}))}static showAllFrames(){const e=this.getCustomContent();e&&pxt.Util.toArray(e.getElementsByClassName("extension-frame")).forEach((e=>{e.style.zIndex=""}))}renderCore(){const{visible:e,extension:t}=this.state;return l.showAllFrames(),e&&this.initializeFrame(),n.createElement(s.Modal,{isOpen:e,className:"extensiondialog",size:"fullscreen",closeIcon:!0,onClose:this.hide,dimmer:!0,modalDidOpen:this.updateDimensions,shouldFocusAfterRender:!1,onPositionChanged:this.updateDimensions,closeOnDimmerClick:!0},n.createElement("div",{id:"extensionWrapper","data-frame":t,ref:this.handleExtensionWrapperRef}))}}i.Extensions=l},{"./core":78,"./data":81,"./extensionManager":93,"./sui":143,react:335}],95:[function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};Object.defineProperty(i,"__esModule",{value:!0}),i.FileList=void 0;const r=e("react"),o=e("./data"),s=e("./sui"),a=e("./package"),l=e("./core"),c=e("./util"),u="custom.ts",d=`\nenum MyEnum {\n    //% block="one"\n    One,\n    //% block="two"\n    Two\n}\n\n/**\n * ${lf("Custom blocks")}\n */\n//% weight=100 color=#0fbc11 icon=""\nnamespace custom {\n    /**\n     * TODO: ${lf("describe your function here")}\n     * @param n ${lf("describe parameter here")}, eg: 5\n     * @param s ${lf("describe parameter here")}, eg: "Hello"\n     * @param e ${lf("describe parameter here")}\n     */\n    //% block\n    export function foo(n: number, s: string, e: MyEnum): void {\n        // Add code here\n    }\n\n    /**\n     * TODO: ${lf("describe your function here")}\n     * @param value ${lf("describe value here")}, eg: 5\n     */\n    //% block\n    export function fib(value: number): number {\n        return value <= 1 ? value : fib(value -1) + fib(value - 2);\n    }\n}\n`,p=e=>`\n/**\n* ${lf("Use this file to define custom functions and blocks.")}\n* ${lf("Read more at {0}",e+"blocks/custom")}\n*/\n`;class h extends o.Component{constructor(e){super(e),this.state={},this.toggleVisibility=this.toggleVisibility.bind(this),this.handleCustomBlocksClick=this.handleCustomBlocksClick.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this),this.setFile=this.setFile.bind(this),this.removeFile=this.removeFile.bind(this),this.addLocalizedFile=this.addLocalizedFile.bind(this),this.removePkg=this.removePkg.bind(this),this.updatePkg=this.updatePkg.bind(this),this.togglePkg=this.togglePkg.bind(this),this.navigateToError=this.navigateToError.bind(this)}UNSAFE_componentWillReceiveProps(e){const t=e.parent.state.currFile;if(this.state.currentFile!=t){let e;a.allEditorPkgs().forEach((i=>{this.packageContainsFile(i,t)&&(e=i.getPkgId())})),this.setState({expandedPkg:e,currentFile:t})}}removePkg(e){l.confirmAsync({header:lf("Remove {0} extension",e.getPkgId()),body:lf("You are about to remove an extension from your project. Are you sure?"),agreeClass:"red",agreeIcon:"trash",agreeLbl:lf("Remove it")}).then((t=>{t&&a.mainEditorPkg().removeDepAsync(e.getPkgId()).then((()=>this.props.parent.reloadHeaderAsync()))}))}setFile(e){this.props.parent.setSideFile(e)}removeFile(e){this.props.parent.removeFile(e)}addLocalizedFile(e,t){return this.props.parent.updateFileAsync(t,e.content,!0)}updatePkg(e){l.showLoading("update",lf("Updating...")),a.mainEditorPkg().updateDepAsync(e.getPkgId()).then((()=>this.props.parent.reloadHeaderAsync())).finally((()=>l.hideLoading("update")))}navigateToError(e){const t=e&&e.diagnostics&&e.diagnostics[0];t&&this.props.parent.navigateToError(t)}filesOf(e){const t=e.isTopLevel(),i=e.getLanguageRestrictions();let n=e.sortedFiles();t&&(n=n.filter((e=>{switch(i){case"javascript-only":return!/\.(blocks|py)$/.test(e.name);case"python-only":return!/\.(blocks|ts)$/.test(e.name);default:return!0}})));const o={};return n.forEach((e=>{const t=e.name.lastIndexOf("/"),i=t<0?"":e.name.slice(0,t);(o[i]||(o[i]=[])).push(e)})),Object.keys(o).map((t=>r.createElement(f,{key:"folder-"+t,folder:t},this.folderFilesOf(e,t,o[t])))).reduce(((e,t)=>e.concat(t)),[])}folderFilesOf(e,t,i){const{currentFile:n}=this.state,o=this.props.parent.state.header,a=e.isTopLevel(),l=pxt.shell.isReadOnly(),c=a&&!l;return i.map((u=>{const d=this.getData("open-meta:"+u.getName()),p=!!o&&!!o.githubId,h=a&&p&&/\.md$/.test(u.name)&&!/^_locales\//.test(u.name),f=u.name.replace(/\.[a-z]+$/,""),g=!l&&h&&`#tutorial:${o.id}:${f}`,b=p&&pxt.github.parseRepoId(o.githubId),v=h&&b&&pxt.appTarget.appTheme.embedUrl&&`${window.location.origin}${window.location.pathname||""}#tutorial:github:${b.fullName}/${f}`,y=`_locales/${pxt.Util.userLanguage()}/${u.name}`,k=!l&&h&&pxt.Util.userLanguage()!==(pxt.appTarget.appTheme.defaultLocale||"en")&&!i.some((e=>e.name==y)),w=c&&u.name!=pxt.CONFIG_NAME&&(p||u.name!=pxt.MAIN_TS)&&!u.isReadonly(),x=t.length?t.length+1:0;return r.createElement(m,{key:"file-"+u.getName(),file:u,meta:d,onItemClick:this.setFile,onItemRemove:this.removeFile,onErrorClick:this.navigateToError,onItemLocalize:this.addLocalizedFile,isActive:n==u,hasDelete:w,previewUrl:g,shareUrl:v,addLocalizedFile:k&&y,className:(n==u?"active ":"")+(e.isTopLevel()?"":"nested ")+(t?"folderitem ":"")+"item"},u.name.slice(x),"",d.isGitModified?" ":"",d.isReadonly?r.createElement(s.Icon,{icon:"lock"}):null)}))}packageOf(e){var t;const i=this.state.expandedPkg,n=e.getPkgId(),o=!pxt.shell.isReadOnly()&&n!=pxt.appTarget.id&&"built"!=n&&"assets"!=n&&n!=pxt.appTarget.corepkg&&e.getKsPkg().config&&!e.getKsPkg().config.core&&e.getKsPkg().level<=1,s=o&&"github"==(null===(t=e.getKsPkg())||void 0===t?void 0:t.verProtocol()),a=this.getData("open-pkg-meta:"+e.getPkgId());let l=s?e.getKsPkg().verArgument().split("#")[1]:void 0;return l&&l.length>20&&(l=l.substring(0,7)),[r.createElement(g,{key:"hd-"+n,pkg:e,isActive:i==n,onItemClick:this.togglePkg,hasDelete:o,onItemRemove:this.removePkg,version:l,hasRefresh:s,onItemRefresh:this.updatePkg},a.numErrors?r.createElement("span",{className:"ui label red"},a.numErrors):null,n,i==n?r.createElement("div",{role:"group",className:"menu"},this.filesOf(e)):void 0)]}packageContainsFile(e,t){return e.sortedFiles().filter((e=>e==t)).length>0}togglePkg(e){this.setState({expandedPkg:this.state.expandedPkg==e.getPkgId()?void 0:e.getPkgId()})}filesWithHeader(e){return e.isTopLevel()?this.filesOf(e):this.packageOf(e)}toggleVisibility(){this.props.parent.setState({showFiles:!this.props.parent.state.showFiles})}handleCustomBlocksClick(e){this.addCustomBlocksFile(),e.stopPropagation()}handleButtonKeydown(e){e.stopPropagation()}addProjectFile(){const e=a.mainEditorPkg(),t=/^[\w][\/\w\-\.]*$/;l.promptAsync({header:lf("Add new file?"),hasCloseIcon:!0,onInputValidation:e=>e?(e=e.trim(),t.test(e)?void 0:lf("Don't use spaces or special characters.")):lf("filename is empty."),body:lf("Please provide a name for your new file."),initialValue:e.files[u]?void 0:u}).then((e=>{if(!e)return Promise.resolve();const i=(e=e.replace(/\s+/g,"")).lastIndexOf(".");let n,r=e;-1!=i&&(r=e.slice(0,i),n=e.slice(i+1).toLowerCase());const o=a.mainPkg&&a.mainPkg.config,s=o&&o.languageRestriction;let c="ts",h="//",f=pxt.U.lf("Add your code here");if("python-only"===s&&(c="py",h="#"),n)switch(n){case"js":case"ts":break;case"py":"javascript-only"!==s&&(c="py",h="#");break;case"md":c="md",h="#",f=r;break;case"json":c="json",h=void 0;break;case"jres":c="jres",h=void 0;break;default:r=e}if(!r)return Promise.resolve();if(!t.test(r))return l.warningNotification(lf("Invalid file name")),Promise.resolve();const m=`${r}.${c}`;if(a.mainEditorPkg().sortedFiles().some((e=>e.name==m)))return l.warningNotification(lf("File already exists")),Promise.resolve();let g="";return m==u?g=p(pxt.appTarget.appTheme.homeUrl)+d:h&&(g=`${h} ${f}\n`),this.props.parent.updateFileAsync(m,g,!0)}))}addCustomBlocksFile(){this.props.parent.state.header.githubId||pxt.appTarget.appTheme.addNewTypeScriptFile?this.addProjectFile():l.confirmAsync({header:lf("Add custom blocks?"),body:lf("A new JavaScript file, custom.ts, will be added to your project. You can define custom functions and blocks in that file.")}).then((e=>{if(e)return this.props.parent.updateFileAsync(u,p(pxt.appTarget.appTheme.homeUrl)+d,!0)}))}renderCore(){const e=!!this.props.parent.state.showFiles,t=pxt.appTarget.appTheme,i=a.mainEditorPkg(),n=e&&!pxt.shell.isReadOnly()&&(!i.files[u]||pxt.appTarget.appTheme.addNewTypeScriptFile),o=this.getData("open-pkg-meta:"+i.getPkgId());return r.createElement("div",{role:"tree",className:`ui tiny vertical ${t.invertedMenu?"inverted":""} menu filemenu landscape only hidefullscreen`},r.createElement("div",{role:"treeitem","aria-selected":e,"aria-expanded":e,"aria-label":lf("File explorer toolbar"),key:"projectheader",className:"link item",onClick:this.toggleVisibility,tabIndex:0,onKeyDown:c.fireClickOnEnter},lf("Explorer"),r.createElement(s.Icon,{icon:`chevron ${e?"up":"down"} icon`}),n?r.createElement(s.Button,{className:"primary label",icon:"plus",title:lf("Add custom blocks?"),onClick:this.handleCustomBlocksClick,onKeyDown:this.handleButtonKeydown}):void 0,o.numErrors?r.createElement("span",{className:"ui label red"},o.numErrors):null),e?pxt.Util.concat(a.allEditorPkgs().map((e=>this.filesWithHeader(e)))):void 0)}}i.FileList=h;class f extends s.StatelessUIElement{constructor(e){super(e)}renderCore(){const{folder:e,children:t}=this.props;return e?r.createElement(r.Fragment,null,r.createElement("div",{className:"folder item",role:"treeitem","aria-selected":!1,"aria-label":lf("Files in folder {0}",e)},r.createElement("i",{className:"folder open outline icon"}),e),t):t}}class m extends s.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleRemove=this.handleRemove.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this),this.handlePreview=this.handlePreview.bind(this),this.handleShare=this.handleShare.bind(this),this.handleAddLocale=this.handleAddLocale.bind(this)}handleClick(e){this.props.onErrorClick&&this.props.meta&&this.props.meta.numErrors&&this.props.meta.diagnostics&&this.props.meta.diagnostics[0]?this.props.onErrorClick(this.props.meta):this.props.onItemClick(this.props.file),e.stopPropagation()}handleRemove(e){pxt.tickEvent("explorer.file.remove"),e.preventDefault(),e.stopPropagation(),this.props.onItemRemove(this.props.file)}handlePreview(e){pxt.tickEvent("explorer.file.preview"),e.preventDefault(),e.stopPropagation(),window.open(this.props.previewUrl,"_blank")}handleShare(e){pxt.tickEvent("explorer.file.share"),e.preventDefault(),e.stopPropagation(),l.dialogAsync({header:lf("Share this tutorial"),body:lf("The URL will start the MakeCode editor in your tutorial."),copyable:this.props.shareUrl,hasCloseIcon:!0})}handleAddLocale(e){pxt.tickEvent("explorer.file.addlocale");const{addLocalizedFile:t,onItemLocalize:i}=this.props;i&&t&&i(this.props.file,t),e.stopPropagation()}handleButtonKeydown(e){e.stopPropagation()}renderCore(){const{isActive:e,hasDelete:t,file:i,meta:n,previewUrl:o,shareUrl:a,addLocalizedFile:l,className:u}=this.props;return r.createElement("a",{onClick:this.handleClick,tabIndex:0,role:"treeitem","aria-selected":e,"aria-label":e?lf("{0}, it is the current opened file in the JavaScript editor",i.name):i.name,onKeyDown:c.fireClickOnEnter,className:u},this.props.children,t&&r.createElement(s.Button,{className:"primary label",icon:"trash",title:lf("Delete file {0}",i.name),onClick:this.handleRemove,onKeyDown:this.handleButtonKeydown}),n&&n.numErrors?r.createElement("span",{className:"ui label red button",role:"button",title:lf("Go to error")},n.numErrors):void 0,a&&r.createElement(s.Button,{className:"button primary label",icon:"share alternate",title:lf("Share"),onClick:this.handleShare,onKeyDown:c.fireClickOnEnter}),o&&r.createElement(s.Button,{className:"button primary label",icon:"flask",title:lf("Preview"),onClick:this.handlePreview,onKeyDown:c.fireClickOnEnter}),!!l&&r.createElement(s.Button,{className:"primary label",icon:"xicon globe",title:lf("Add localized file"),onClick:this.handleAddLocale,onKeyDown:this.handleButtonKeydown}))}}class g extends s.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleRemove=this.handleRemove.bind(this),this.handleRefresh=this.handleRefresh.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this)}handleClick(){this.props.onItemClick(this.props.pkg)}handleRefresh(e){e.stopPropagation(),this.props.onItemRefresh(this.props.pkg)}handleRemove(e){e.stopPropagation(),this.props.onItemRemove(this.props.pkg)}handleButtonKeydown(e){e.stopPropagation()}renderCore(){const e=this.props,{onItemClick:t,onItemRemove:i,onItemRefresh:o,version:a,isActive:l,hasRefresh:u,hasDelete:d,pkg:p}=e,h=n(e,["onItemClick","onItemRemove","onItemRefresh","version","isActive","hasRefresh","hasDelete","pkg"]);return r.createElement("div",Object.assign({className:"header link item",role:"treeitem","aria-selected":l,"aria-expanded":l,"aria-label":lf("{0}, {1}",p.getPkgId(),l?lf("expanded"):lf("collapsed")),onClick:this.handleClick,tabIndex:0,onKeyDown:c.fireClickOnEnter},h),r.createElement(s.Icon,{icon:`chevron ${l?"up":"down"} icon`}),u?r.createElement(s.Button,{className:"primary label",icon:"refresh",title:lf("Refresh extension {0}",p.getPkgId()),onClick:this.handleRefresh,onKeyDown:this.handleButtonKeydown,text:a||""}):void 0,d?r.createElement(s.Button,{className:"primary label",icon:"trash",title:lf("Delete extension {0}",p.getPkgId()),onClick:this.handleRemove,onKeyDown:this.handleButtonKeydown}):void 0,this.props.children)}}},{"./core":78,"./data":81,"./package":122,"./sui":143,"./util":149,react:335}],96:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.provider=i.setApiAsync=void 0;const n=e("./core");var r=pxt.Util,o=pxt.Cloud;let s=(e,t)=>r.requestAsync({url:"/api/"+e,headers:{Authorization:o.localToken},method:t?"POST":"GET",data:t||void 0}).then((e=>e.json)).catch(n.handleNetworkError);function a(e,t,i){let n={files:[],config:null,header:e,path:e.path,isDeleted:e.isDeleted};if(i){t||(t={});for(let e of Object.keys(i))i[e]!==t[e]&&n.files.push({name:e,mtime:null,content:i[e],prevContent:t[e]});for(let e of Object.keys(t))void 0===i[e]&&n.files.push({name:e,mtime:null,content:null,prevContent:t[e]})}let o=r.flatClone(i||{});return s("pkg/"+e.path,n).then((e=>o))}i.setApiAsync=function(e){s=e},i.provider={getAsync:function(e){return s("pkg/"+e.path).then((t=>{let i={header:e,text:{},version:null};for(let n of t.files)i.text[n.name]=n.content,e.modificationTime=Math.max(e.modificationTime,n.mtime/1e3|0);return e.recentUse=Math.max(e.recentUse,e.modificationTime),i.version=r.flatClone(i.text),i}))},setAsync:a,listAsync:async function(){let e=await s("list");for(let t of e.pkgs)if(t.header)t.header.path=t.path;else{let e=t.files.map((e=>e.mtime));e.sort(((e,t)=>t-e));let i=Math.round(e[0]/1e3)||r.nowSeconds();t.header=pxt.workspace.freshHeader(t.config.name,i),t.config.preferredEditor&&(t.header.editor=t.config.preferredEditor),t.header.path=t.path,await a(t.header,null)}return e.pkgs.map((e=>e.header))},resetAsync:function(){return pxt.BrowserUtils.isPxtElectron()?s("resetworkspace",{}).then((()=>{})):Promise.resolve()},deleteAsync:function(e,t){return e.isDeleted=!0,a(e,t,{})},saveScreenshotAsync:function(e,t,i){return s("screenshot/"+e.path,{screenshot:t,icon:i})},saveAssetAsync:function(e,t,i){return s("pkgasset/"+e,{encoding:"base64",name:t,data:btoa(ts.pxtc.Util.uint8ArrayToString(i))}).then((e=>{}))},listAssetsAsync:function(e){return s("pkgasset/"+e).then((e=>e.files))}}},{"./core":78}],97:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GithubButton=void 0;const n=e("react"),r=e("./sui"),o=e("./package"),s=e("./workspace"),a=e("./util");class l extends r.UIElement{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this),this.handleButtonKeydown=this.handleButtonKeydown.bind(this),this.createRepository=this.createRepository.bind(this)}handleButtonKeydown(e){e.stopPropagation()}createRepository(e){pxt.tickEvent("github.button.create",void 0,{interactiveConsent:!0}),this.props.parent.createGitHubRepositoryAsync()}handleClick(e){e.stopPropagation();const{header:t}=this.props.parent.state;if(!t)return;const{githubId:i}=t;if(!i)return;pxt.tickEvent("github.button.nav");const n=o.mainEditorPkg().lookupFile("this/"+pxt.github.GIT_JSON);n&&this.props.parent.setSideFile(n)}renderCore(){const e=this.props.parent.state.header;if(!e)return n.createElement("div",null);const{githubId:t}=e,i=pxt.github.parseRepoId(t),o="ui icon button editortools-btn editortools-github-btn";if(!i)return n.createElement(r.Button,{key:"githubcreatebtn",className:`${o} ${this.props.className||""}`,icon:"github",title:lf("create GitHub repository"),ariaLabel:lf("create GitHub repository"),onClick:this.createRepository});const l=this.getData("pkg-git-status:"+e.id),c=l&&this.getData("pkg-git-pull-status:"+e.id),u=c==s.PullStatus.BranchNotFound,d=c==s.PullStatus.GotChanges,p=l&&!!l.modified,h=i.project&&i.tag?`${i.project}${"master"==i.tag?"":`#${i.tag}`}`:i.fullName;let f=i.tag&&"master"!=i.tag?`#${i.tag}`:"";f.length>20&&(f=f.slice(0,18)+"..");const m=u?lf("{0}: there is an issue with your GitHub connection.",h):d?lf("{0}: remote changes are ready to be pulled.",h):p?lf("{0}: review, commit & push local changes to GitHub.",h):lf("{0}: local changes are synchronized with GitHub.",h);return n.createElement("div",{key:"githubeditorbtn",role:"button",className:`${o}\n            ${this.props.className||""}`,title:m,onClick:this.handleClick,onKeyDown:a.fireClickOnEnter,tabIndex:0},n.createElement("i",{className:"github icon"}),n.createElement("span",{className:"ui mobile hide"},f),n.createElement("i",{className:`ui long ${u?"exclamation circle":d?"arrow alternate down":p?"arrow alternate up":"check"} icon mobile hide`}))}}i.GithubButton=l},{"./package":122,"./sui":143,"./util":149,"./workspace":151,react:335}],98:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GithubProvider=i.PROVIDER_NAME=void 0;const n=e("react"),r=e("./sui"),o=e("./core"),s=e("./cloudsync"),a=e("./dialogs"),l=e("./workspace");i.PROVIDER_NAME="github";class c extends s.ProviderBase{constructor(){super(i.PROVIDER_NAME,lf("GitHub"),"icon github","https://api.github.com"),pxt.github.handleGithubNetworkError=(e,t)=>401==t.statusCode&&pxt.github.token?(pxt.log("github: invalid token"),this.clearToken(),"GET"==e.method):(403==t.statusCode?pxt.log("github: unauthorized access"):404==t.statusCode&&(t.needsWritePermission=!0),!1)}clearToken(){pxt.github.token=void 0,super.logout()}logout(){pxt.github.token=void 0,super.logout(),window.location.href="https://github.com/logout"}hasToken(){return this.loginCheck(),!!this.token()}loginCheck(){super.loginCheck();const e=this.token();pxt.github.token=e}loginAsync(e,t){return this.routedLoginAsync(void 0)}routedLoginAsync(e){this.loginCheck();let t=Promise.resolve();return this.token()||(t=t.then((()=>this.showLoginAsync(e)))),t.then((()=>({accessToken:this.token()})))}showLoginAsync(e){pxt.tickEvent("github.login.dialog");let t,i=!(pxt.appTarget&&!pxt.BrowserUtils.isPxtElectron()&&pxt.appTarget.cloud&&pxt.appTarget.cloud.cloudProviders&&pxt.appTarget.cloud.cloudProviders[this.name]),s=!1;const a=e=>{s=e,o.forceUpdate()};return o.confirmAsync({header:lf("Sign in with GitHub"),hasCloseIcon:!0,helpUrl:"/github",agreeLbl:lf("Sign in"),onLoaded:e=>{t=e},jsxd:()=>n.createElement("div",{className:"ui form"},n.createElement("p",null,lf("You need to sign in with GitHub to use this feature.")),n.createElement("p",null,lf("You can host your code on GitHub and collaborate with friends on projects.")),n.createElement("div",null,n.createElement(r.PlainCheckbox,{label:lf("Remember me"),onChange:a})),!i&&n.createElement("p",{className:"ui small"},lf("Looking to use a Developer token instead?"),n.createElement(r.Link,{className:"link",text:lf("Use Developer token"),onClick:l,href:"#"})),i&&n.createElement("ol",null,n.createElement("li",null,lf("Navigate to: "),n.createElement("a",{href:"https://github.com/settings/tokens/new",target:"_blank",rel:"noopener noreferrer"},lf("GitHub token generation page"))),n.createElement("li",null,lf("Put something like 'MakeCode {0}' in description",pxt.appTarget.name)),n.createElement("li",null,lf("Select either '{0}' or '{1}' scope, depending which repos you want to edit from here","repo","public_repo")),n.createElement("li",null,lf("Click generate token, copy it, and paste it below."))),i&&n.createElement("div",{className:"ui field"},n.createElement("label",{id:"selectUrlToOpenLabel"},lf("Paste GitHub token here:")),n.createElement("input",{id:"githubTokenInput",type:"url",tabIndex:0,autoFocus:!0,"aria-labelledby":"selectUrlToOpenLabel",placeholder:"ghp_ABC...",className:"ui blue fluid"})))}).then((n=>{var r;if(n){if(i){const e=t.querySelector("#githubTokenInput"),i=null===(r=null==e?void 0:e.value)||void 0===r?void 0:r.trim();return this.saveAndValidateTokenAsync(i,s)}return this.oauthRedirectAsync(s,e)}return pxt.tickEvent("github.login.cancel"),Promise.resolve()}));function l(){i=!0,o.forceUpdate()}}authorizeAppAsync(e,t){return this.oauthRedirectAsync(e,t||window.location.hash,!0)}oauthRedirectAsync(e,t,i){o.showLoading("ghlogin",lf("Signing you into GitHub...")),t=(t||"").replace(/^#/,"");const n=s.setOauth(this.name,e,t?`#github:${t}`:void 0),r=window.location.href.replace(/#.*/,""),a=pxt.Cloud.getServiceUrl()+"/oauth/login?state="+n+(i?"&prompt=consent":"")+"&response_type=token&client_id=gh-token&redirect_uri="+encodeURIComponent(r);return window.location.href=a,pxt.Util.delay(1e3)}getUserInfoAsync(){return this.token()?pxt.github.authenticatedUserAsync().then((e=>{if(e)return{id:e.login,userName:e.login,name:e.name,photo:e.avatar_url,profile:`https://github.com/${e.login}`};pxt.log("unknown github user")})):Promise.resolve(void 0)}setNewToken(e,t){super.setNewToken(e,t),pxt.github.token=e}saveAndValidateTokenAsync(e,t){return o.showLoading("githubtokensave",lf("validating GitHub token...")),Promise.resolve().then((()=>(pxt.github.token=e,pxt.github.createRepoAsync(void 0,"").then((i=>{pxt.reportError("github","Succeeded creating undefined repo!"),o.infoNotification(lf("Something went wrong with validation; token stored")),this.setNewToken(e,t),pxt.tickEvent("github.token.wrong")}),(i=>{pxt.github.token="",a.showGithubTokenError(i)||(422==i.statusCode?o.infoNotification(lf("Token validated and stored")):o.infoNotification(lf("Token stored but not validated")),this.setNewToken(e,t),pxt.tickEvent("github.token.ok"))})).then((()=>s.syncAsync()))))).finally((()=>o.hideLoading("githubtokensave")))}async createRepositoryAsync(e,t){if(pxt.tickEvent("github.filelist.create.start"),await this.routedLoginAsync(`create-repository:${t.id}`),!this.token())return pxt.tickEvent("github.filelist.create.notoken"),!1;const i=await a.showCreateGithubRepoDialogAsync(e);if(!i)return!1;pxt.tickEvent("github.filelist.create.export");const n=pxt.github.parseRepoId(i);o.showLoading("creategithub",lf("preparing {0} repository...",n.project||n.fullName));try{return await l.exportToGithubAsync(t,i),!0}finally{o.hideLoading("creategithub")}}}i.GithubProvider=c},{"./cloudsync":27,"./core":78,"./dialogs":88,"./sui":143,"./workspace":151,react:335}],99:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Editor=void 0;const n=e("react"),r=e("./package"),o=e("./core"),s=e("./srceditor"),a=e("./sui"),l=e("./workspace"),c=e("./dialogs"),u=e("./coretsx"),d=e("./data"),p=e("./marked"),h=e("./compiler"),f=e("./cloudsync"),m=e("./tutorial"),g=e("./package"),b=e("./util");class v extends d.Component{constructor(e){super(e),this.diffCache={},this.goBack=this.goBack.bind(this),this.handlePullClick=this.handlePullClick.bind(this),this.handleBranchClick=this.handleBranchClick.bind(this),this.handleGithubError=this.handleGithubError.bind(this),this.handlePullRequest=this.handlePullRequest.bind(this)}clearCacheDiff(e,t){t?delete this.diffCache[e+t.name]:this.diffCache={}}cachedDiff(e,t){let i=this.diffCache[e+t.name];return i&&i.file.file===t.file||(i={file:t},this.diffCache[e+t.name]=i),i}fastForwardMergeAsync(e,t,i){return i=i||t.title||lf("Merge pull request"),o.showLoading("github.merge",lf("merging pull request...")),pxt.github.mergeAsync(e.fullName,t.base,e.tag,`${i} (#${t.number})`).then((()=>this.switchProjectToBranchAsync(t.base))).then((()=>this.pullAsync())).then((()=>{o.hideLoading("github.merge"),o.infoNotification("Pull request merged successfully!")})).then((()=>this.handleGithubError)).finally((()=>o.hideLoading("github.merge"))).then((()=>{}))}async revertAllFilesAsync(){if(pxt.tickEvent("github.revertall",{start:1},{interactiveConsent:!0}),!await o.confirmAsync({header:lf("Would you like to revert all local changes?"),body:lf("Changes will be lost for good. No undo."),agreeLbl:lf("Revert"),agreeClass:"red",agreeIcon:"trash"}))return;pxt.tickEvent("github.revertall",{ok:1}),this.setState({needsCommitMessage:!1});const{header:e}=this.props.parent.state;await l.revertAllAsync(e),await this.props.parent.reloadHeaderAsync()}async revertFileAsync(e,t,i,n){if(pxt.tickEvent("github.revert",{start:1},{interactiveConsent:!0}),!await o.confirmAsync({header:lf("Would you like to revert changes to {0}?",e.name),body:lf("Changes will be lost for good. No undo."),agreeLbl:lf("Revert"),agreeClass:"red",agreeIcon:"trash"}))return;pxt.tickEvent("github.revert",{ok:1}),this.setState({needsCommitMessage:!1});let s=!1;const a=r.mainEditorPkg();if(null==e.gitFile){s=!0,await a.removeFileAsync(e.name);for(const e of n)await a.removeFileAsync(e.name)}else if(e.name==pxt.CONFIG_NAME){s=!0;const n=this.getGitJson(),r=this.parsedRepoId();for(let e of t){const t=pxt.github.lookupFile(r,n.commit,e);a.setFile(e,t&&t.blobContent||"// Cannot restore.")}for(let e of i)delete a.files[e];await e.file.setContentAsync(e.gitFile)}else{await e.file.setContentAsync(e.gitFile),a.files;for(const e of n)null==e.baseGitContent?(s=!0,await a.removeFileAsync(e.name)):await e.setContentAsync(e.baseGitContent)}s?await this.props.parent.reloadHeaderAsync():this.forceUpdate()}async saveGitJsonAsync(e){const t=r.mainEditorPkg().files[pxt.github.GIT_JSON];await t.setContentAsync(JSON.stringify(e,null,4))}async switchProjectToBranchAsync(e){const{header:t}=this.props.parent.state,i=this.getGitJson(),n=this.parsedRepoId();t.githubId=n.fullName+"#"+e,i.repo=t.githubId,await this.saveGitJsonAsync(i),r.invalidatePullRequestStatus(t)}async newBranchAsync(){await f.ensureGitHubTokenAsync();const e=this.parsedRepoId(),t=await pxt.github.getNewBranchNameAsync(e.slug,"patch-"),i=await o.promptAsync({header:lf("New branch name"),body:lf("Name cannot have spaces or special characters. Examples: {0}","my_feature, add-colors, fix_something"),agreeLbl:lf("Create"),initialValue:t,hasCloseIcon:!0,onInputValidation:e=>{if(/[^\w\-]/.test(e))return lf("Don't use spaces or special characters.")}});if(i){this.showLoading("github.branch",!0,lf("creating branch..."));try{const t=this.getGitJson();await pxt.github.createNewBranchAsync(e.slug,i,t.commit.sha),await this.switchProjectToBranchAsync(i),this.forceUpdate()}catch(e){this.handleGithubError(e)}finally{this.hideLoading()}}}async switchBranchAsync(e){await this.setStateAsync({needsCommitMessage:!1});const t=this.parsedRepoId().tag;try{await this.switchProjectToBranchAsync(e),await this.pullAsync()}finally{this.state.needsCommitMessage&&await this.switchProjectToBranchAsync(t)}}async showSwitchBranchDialogAsync(){const e=this.parsedRepoId(),t=await pxt.github.listRefsExtAsync(e.slug,"heads"),i=Object.keys(t.refs).map((e=>({name:e,description:t.refs[e],onClick:async()=>{o.hideDialog(),await this.switchBranchAsync(e)}})));"master"==e.tag&&i.unshift({name:lf("Create new branch"),description:lf("Based on {0}",e.tag),onClick:()=>(o.hideDialog(),this.newBranchAsync())}),await o.confirmAsync({header:lf("Switch to a different branch"),hasCloseIcon:!0,hideAgree:!0,jsx:n.createElement("div",{className:"ui form"},n.createElement("div",{className:"ui relaxed divided list",role:"menu"},i.map((e=>n.createElement("div",{key:e.name,className:"item link"},n.createElement("i",{className:"large github middle aligned icon"}),n.createElement("div",{className:"content"},n.createElement("a",{onClick:e.onClick,role:"menuitem",className:"header",tabIndex:0,onKeyDown:b.fireClickOnEnter},e.name),n.createElement("div",{className:"description"},e.description)))))))})}handleBranchClick(e){pxt.tickEvent("github.branch"),e.stopPropagation(),this.showSwitchBranchDialogAsync()}goBack(){pxt.tickEvent("github.backButton",void 0,{interactiveConsent:!0}),this.props.parent.openPreviousEditor()}handlePullClick(e){pxt.tickEvent("github.pull"),this.pullAsync()}async forkAsync(e){const t=this.parsedRepoId(),i=f.githubProvider().user();let r,s=!1;const l=e=>{s=e,o.forceUpdate()},c=()=>{pxt.tickEvent("github.authorize"),f.githubProvider().authorizeAppAsync(s)};e&&i&&t.owner!==i.userName&&await pxt.github.isOrgAsync(t.owner)&&(r=n.createElement("div",{className:"ui small"},lf("If you already have write permissions to this repository, you may have to authorize the MakeCode App in the {0} organization.",t.owner),n.createElement(a.PlainCheckbox,{label:lf("Remember me"),onChange:l}),n.createElement(a.Link,{className:"ui link",text:lf("Authorize MakeCode"),onClick:c,onKeyDown:b.fireClickOnEnter})));const u=e&&n.createElement("div",{className:"ui message warning"},lf("Oops, we could not write to {0}.",t.slug),r),d=n.createElement("p",null,lf("Forking creates a copy of {0} under your account. You can submit your changes back via a pull request.",t.slug));if(await o.confirmAsync({header:lf("Do you want to fork {0}?",t.slug),hasCloseIcon:!0,helpUrl:"/github/fork",jsx:n.createElement("div",null,u,d),agreeLbl:"Fork",agreeIcon:"copy outline"})){this.showLoading("github.fork",!0,lf("forking repository (this may take a minute or two)..."));try{const e=this.getGitJson(),i=await pxt.github.forkRepoAsync(t.slug,e.commit.sha),{header:n}=this.props.parent.state;n.githubId=i,e.repo=n.githubId,await this.saveGitJsonAsync(e)}catch(e){this.handleGithubError(e)}finally{this.hideLoading()}}}handleGithubError(e){const t=parseInt(e.statusCode);e.isOffline||0===t?o.warningNotification(lf("Please connect to internet and try again.")):e.needsWritePermission?(o.hideDialog(),this.forkAsync(!0)):e.isMergeConflictMarkerError?(pxt.tickEvent("github.commitwithconflicts"),o.warningNotification(lf("Please merge all conflicts before commiting changes."))):401==t?(f.githubProvider().clearToken(),this.forceUpdate(),o.warningNotification(lf("Please sign in to GitHub again."))):404==t?o.warningNotification(lf("GitHub resource not found; please check that it still exists.")):403==t?o.warningNotification(lf("GitHub rate limit exceeded, please wait and try again.")):(pxt.reportException(e),o.warningNotification(lf("Oops, something went wrong. Please try again.")))}async bumpAsync(){try{l.prepareConfigForGithub(r.mainPkg.readFile(pxt.CONFIG_NAME),!0)}catch(e){return void o.warningNotification(e.message)}let e=r.mainPkg.config.version;try{const t=this.parsedRepoId(),i=await pxt.github.listRefsAsync(t.slug,"tags");e=pxt.semver.sortLatestTags(i)[0]}catch(e){console.log(e)}const t=pxt.semver.parse(e,"0.0.0"),i=pxt.semver.parse(pxt.semver.stringify(t));i.major++,i.minor=0,i.patch=0;const s=pxt.semver.parse(pxt.semver.stringify(t));s.minor++,s.patch=0;const c=pxt.semver.parse(pxt.semver.stringify(t));c.patch++;let d="patch";function p(e){d=e.currentTarget.name,u.forceUpdate()}let h=!1;function f(e){h=!h,u.forceUpdate()}if(!await o.confirmAsync({header:lf("Pick a release version"),agreeLbl:lf("Create release"),disagreeLbl:lf("Cancel"),jsxd:()=>n.createElement("div",null,n.createElement("div",{className:"grouped fields"},n.createElement("label",null,lf("Choose a release version that describes the changes you made to the code."),a.helpIconLink("/github/release#versioning",lf("Learn about version numbers."))),n.createElement("div",{className:"field"},n.createElement("div",{className:"ui radio checkbox"},n.createElement("input",{type:"radio",name:"patch",checked:"patch"==d,"aria-checked":"patch"==d,onChange:p}),n.createElement("label",null,lf("{0}: patch (bug fixes or other non-user visible changes)",pxt.semver.stringify(c))))),n.createElement("div",{className:"field"},n.createElement("div",{className:"ui radio checkbox"},n.createElement("input",{type:"radio",name:"minor",checked:"minor"==d,"aria-checked":"minor"==d,onChange:p}),n.createElement("label",null,lf("{0}: minor change (added function or optional parameters)",pxt.semver.stringify(s))))),n.createElement("div",{className:"field"},n.createElement("div",{className:"ui radio checkbox"},n.createElement("input",{type:"radio",name:"major",checked:"major"==d,"aria-checked":"major"==d,onChange:p}),n.createElement("label",null,lf("{0}: major change (renamed functions, deleted parameters or functions)",pxt.semver.stringify(i)))))),n.createElement("div",{className:"grouped fields"},n.createElement("label",null,lf("Advanced")),n.createElement("div",{className:"field checkbox"},n.createElement("input",{type:"checkbox",name:"cachetutorial",checked:h,"aria-checked":h,onChange:f}),n.createElement("label",null,lf("Optimize for tutorials by caching information about the markdown.")))))}))return;let m=c;"major"==d?m=i:"minor"==d&&(m=s);const g=pxt.semver.stringify(m);this.showLoading("github.release.new",!0,lf("creating release..."));try{const{header:e}=this.props.parent.state;h&&await this.cacheTutorialInfo(e),await l.bumpAsync(e,g),r.mainPkg.config.version=g,await this.maybeReloadAsync(),this.hideLoading(),o.infoNotification(lf("GitHub release created."))}catch(e){this.handleGithubError(e)}finally{this.hideLoading()}}async cacheTutorialInfo(e){const t=/\.md$/,i=this.parsedRepoId();let n=await l.getTextAsync(e.id),r=Object.keys(n).filter((e=>e.match(t)));const o={};for(let e of r){const r=pxt.tutorial.parseTutorial(n[e]),s=pxt.BrowserUtils.getTutorialCodeHash(r.code),a=await m.getUsedBlocksAsync(r.code,e,r.language,!0);if(a){const n=e.replace(t,"");o[`https://github.com/${i.fullName}${"README"==n?"":"/"+n}`]={snippetBlocks:a.snippetBlocks,usedBlocks:a.usedBlocks,hash:s}}}n[pxt.TUTORIAL_INFO_FILE]=JSON.stringify(o);let s=pxt.Package.parseAndValidConfig(n[pxt.CONFIG_NAME]);return s.files.indexOf(pxt.TUTORIAL_INFO_FILE)<0&&(s.files.push(pxt.TUTORIAL_INFO_FILE),n[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(s)),await l.saveAsync(e,n),await this.commitAsync()}async showLoading(e,t,i){t&&await f.ensureGitHubTokenAsync(),pxt.tickEvent(e),await this.setStateAsync({loadingMessage:i}),o.showLoading("githubjson",i)}hideLoading(){this.state.loadingMessage&&(o.hideLoading("githubjson"),this.setState({loadingMessage:void 0}))}pkgConfigKey(e){const t=JSON.parse(e);return delete t.version,JSON.stringify(t)}async maybeReloadAsync(){const{header:e}=this.props.parent.state,t=await l.getTextAsync(e.id);r.mainEditorPkg().setFiles(t);const i=this.pkgConfigKey(t[pxt.CONFIG_NAME]);g.invalidatePullStatus(e),i!=this.state.previousCfgKey&&(await this.setStateAsync({previousCfgKey:i}),await this.props.parent.reloadHeaderAsync())}async pullAsync(){this.showLoading("github.pull",!1,lf("pulling changes from GitHub..."));const{header:e}=this.props.parent.state;try{switch(await l.pullAsync(this.props.parent.state.header)){case l.PullStatus.NoSourceControl:case l.PullStatus.UpToDate:break;case l.PullStatus.NeedsCommit:this.setState({needsCommitMessage:!0});break;case l.PullStatus.GotChanges:await this.maybeReloadAsync()}}catch(e){this.handleGithubError(e)}finally{g.invalidatePullStatus(e),this.hideLoading()}}getGitJson(){return r.mainPkg.readGitJson()}parsedRepoId(){const e=this.props.parent.state.header;return pxt.github.parseRepoId(e.githubId)}async commitCoreAsync(){const{parent:e}=this.props,{header:t}=e.state,i=t.githubId;if(await l.pullAsync(t),await l.hasMergeConflictMarkersAsync(t))return await this.maybeReloadAsync(),void o.warningNotification(lf("Merge conflicts found. Resolve them before commiting."));let n=await l.commitAsync(t,{message:this.state.description,blocksScreenshotAsync:()=>{var e;return this.props.parent.blocksScreenshotAsync(1,null===(e=pxt.appTarget.appTheme)||void 0===e?void 0:e.embedBlocksInSnapshot)},blocksDiffScreenshotAsync:()=>{const e=r.mainEditorPkg().sortedFiles().find((e=>e.name==pxt.MAIN_BLOCKS)),t=pxt.blocks.diffXml(e.baseGitContent,e.content);return t&&t.ws?pxt.blocks.layout.toPngAsync(t.ws,1):Promise.resolve(void 0)}});if(n){let e=await l.prAsync(t,n,this.state.description||lf("Commit conflict"));await c.showPRDialogAsync(i,e),await l.pullAsync(t)}else r.invalidatePagesStatus(t),r.invalidatePullRequestStatus(t),await this.maybeReloadAsync();this.setState({description:""})}async commitAsync(){let e=!0;this.setState({needsCommitMessage:!1}),this.showLoading("github.commit",!0,lf("commit and push changes to GitHub..."));try{await this.commitCoreAsync(),await this.maybeReloadAsync()}catch(t){e=!1,pxt.tickEvent("github.commit.fail"),this.handleGithubError(t)}finally{e&&pxt.tickEvent("github.commit.success"),this.hideLoading()}}setVisible(e){if(e===this.state.isVisible)return;const{header:t}=this.props.parent.state;e?(d.invalidateHeader("pkg-git-pr",t),this.setState({previousCfgKey:this.pkgConfigKey(r.mainEditorPkg().files[pxt.CONFIG_NAME].content)})):(this.clearCacheDiff(),this.setState({needsCommitMessage:!1}))}async handlePullRequest(){const e=this.parsedRepoId();if(!await o.confirmAsync({header:lf("Create pull request"),jsx:n.createElement("p",null,lf("Pull requests let you tell others about changes you've pushed to a branch in a repository on GitHub.")),helpUrl:"/github/pull-request",hasCloseIcon:!0}))return;const t=e.tag;this.showLoading("github.createpr",!0,lf("creating pull request..."));try{const e=this.parsedRepoId(),i=`\n### ${lf("How to use this pull request")}\n\n- [ ] ${lf("assign a reviewer (you can be your own reviewer)")}\n- [ ] ${lf("reviewer approves or requests changes")}\n- [ ] ${lf("apply requested changes if any")}\n- [ ] ${lf("merge once approved")}\n`,n=await pxt.github.createPRFromBranchAsync(e.slug,"master",e.tag,t,i);d.invalidateHeader("pkg-git-pr",this.props.parent.state.header),o.infoNotification(lf("Pull request created successfully!",n))}catch(e){422==e.statusCode?o.warningNotification(lf("Please commit changes before creating a pull request.")):this.handleGithubError(e)}finally{this.hideLoading()}}computeDiffFiles(){const e=r.mainEditorPkg().sortedFiles();return e.map((t=>{const i=t.publishedContent();if(t.baseGitContent!=i){const n={file:t,name:t.name,gitFile:t.baseGitContent,editorFile:i};if(/\.blocks$/.test(t.name)){const i=t.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),r=e.find((e=>e.name==i));r&&(n.tsGitFile=r.baseGitContent,n.tsEditorFile=r.publishedContent())}return n}})).filter((e=>!!e))}renderCore(){const e=this.getGitJson();if(!e)return n.createElement("div",null);const{header:t}=this.props.parent.state,i=r.mainPkg.getPreferredEditor()==pxt.BLOCKS_PROJECT_NAME,o=this.computeDiffFiles(),s=o.length>0,c=this.getData("pkg-git-pull-status:"+t.id),u=c==l.PullStatus.BranchNotFound||c==l.PullStatus.NoSourceControl,d=c==l.PullStatus.GotChanges,p=this.parsedRepoId(),h="master"==p.tag,f=this.getData("github:user"),m=`https://github.com/${p.slug}/${h&&!p.fileName?"":pxt.github.join("tree",p.tag||"master",p.fileName)}`,g=!pxt.github.token,v=this.getData("pkg-git-pr:"+t.id),S=null!==v&&(e.isFork||!h),T=S&&v&&v.number>0,A=S&&v&&v.number<=0,N=f&&f.id===p.owner;return n.createElement("div",{id:"githubArea"},n.createElement("div",{className:"ui serialHeader"},n.createElement("div",{className:"leftHeaderWrapper"},n.createElement("div",{className:"leftHeader"},n.createElement(a.Button,{title:lf("Go back"),icon:"arrow left",text:lf("Go back"),textClass:"landscape only",tabIndex:0,onClick:this.goBack,onKeyDown:b.fireClickOnEnter}))),n.createElement("div",{className:"rightHeader"},n.createElement(a.Button,{icon:""+(u?"exclamation circle":d?"long arrow alternate down":"check"),className:!0===d?"positive":"",text:lf("Pull changes"),title:lf("Pull changes from GitHub to get your code up-to-date."),onClick:this.handlePullClick,onKeyDown:b.fireClickOnEnter}),!i&&N&&n.createElement(a.Link,{className:"ui item button desktop only",icon:"user plus",href:`https://github.com/${p.slug}/settings/collaboration`,target:"_blank",title:lf("Invite others to contributes to this GitHub repository.")}),n.createElement(a.Link,{className:"ui button",icon:"external alternate",href:m,title:lf("Open repository in GitHub."),target:"_blank",onKeyDown:b.fireClickOnEnter}))),n.createElement(k,{parent:this,needsToken:g,githubId:p,master:h,gs:e,isBlocks:i,needsCommit:s,user:f,pullStatus:c,pullRequest:v}),n.createElement("div",{className:"ui form"},T&&n.createElement(a.Link,{href:v.url,role:"button",className:"ui tiny basic button create-pr",target:"_blank",text:lf("Pull request (#{0})",v.number),icon:"external alternate"}),A&&n.createElement(a.Button,{className:"tiny basic create-pr",text:lf("Create pull request"),onClick:this.handlePullRequest}),n.createElement("h3",{className:"header"},n.createElement("i",{className:"large github icon"}),n.createElement("span",{className:"repo-name"},p.fullName),n.createElement("span",{onClick:this.handleBranchClick,onKeyDown:b.fireClickOnEnter,tabIndex:0,role:"button",className:"repo-branch"},"#"+p.tag,n.createElement("i",{className:"dropdown icon"}))),s&&n.createElement(w,{parent:this,needsToken:g,githubId:p,master:h,gs:e,isBlocks:i,needsCommit:s,user:f,pullStatus:c,pullRequest:v}),T&&!s&&n.createElement(x,{parent:this,needsToken:g,githubId:p,master:h,gs:e,isBlocks:i,needsCommit:s,user:f,pullStatus:c,pullRequest:v}),o&&n.createElement(y,{parent:this,diffFiles:o,cacheKey:e.commit.sha,allowRevert:!0,showWhitespaceDiff:!0,blocksMode:i,showConflicts:!0}),n.createElement(_,{parent:this,needsToken:g,githubId:p,master:h,gs:e,isBlocks:i,needsCommit:s,user:f,pullStatus:c,pullRequest:v}),h&&n.createElement(E,{parent:this,needsToken:g,githubId:p,master:h,gs:e,isBlocks:i,needsCommit:s,user:f,pullStatus:c,pullRequest:v}),!i&&n.createElement(C,{parent:this,needsToken:g,githubId:p,master:h,gs:e,isBlocks:i,needsCommit:s,user:f,pullStatus:c,pullRequest:v}),n.createElement("div",null)))}}class y extends a.StatelessUIElement{constructor(e){super(e),this.revertAllFiles=this.revertAllFiles.bind(this)}lineDiff(e,t){const i=pxt.diff.compute(e.split("").join("\n"),t.split("").join("\n"),{context:1/0});if(!i)return{a:n.createElement("div",{className:"inline-diff"},n.createElement("code",null,e)),b:n.createElement("div",{className:"inline-diff"},n.createElement("code",null,t))};const r=[],o=[];for(let e=0;e<i.length;){let t=e;const s=i[e][0];for(;i[t]&&i[t][0]==s;)t++;const a=i.slice(e,t).map((e=>e.slice(2))).join("");" "==s?(r.push(n.createElement("code",{key:e,className:"ch-common"},a)),o.push(n.createElement("code",{key:e,className:"ch-common"},a))):"-"==s?r.push(n.createElement("code",{key:e,className:"ch-removed"},a)):"+"==s?o.push(n.createElement("code",{key:e,className:"ch-added"},a)):pxt.Util.oops(),e=t}return{a:n.createElement("div",{className:"inline-diff"},r),b:n.createElement("div",{className:"inline-diff"},o)}}showDiff(e){const{cacheKey:t,blocksMode:i,showConflicts:o,showWhitespaceDiff:s}=this.props,l=this.props.parent.cachedDiff(t,e);if(l.diff&&l.file.gitFile==e.gitFile&&l.file.editorFile==e.editorFile)return l.diff;const c=/\.blocks$/.test(e.name),u=()=>{l.whitespace||(l.whitespace=!0,l.diff=d(),this.forceUpdate())},d=()=>{let r;return r=c?this.createBlocksDiffJSX(e):this.createTextDiffJSX(e,!l.whitespace),n.createElement("div",{key:`difffile${t}${e.name}`,className:"ui segments filediff"},n.createElement("div",{className:"ui segment diffheader"},(!i||e.name!=pxt.MAIN_BLOCKS)&&n.createElement("span",null,e.name),!!l.revert&&n.createElement(a.Button,{className:"small",icon:"undo",text:lf("Revert"),ariaLabel:lf("Revert file"),title:lf("Revert file"),textClass:"landscape only",onClick:l.revert}),r.legendJSX,o&&!!r.conflicts&&n.createElement("p",null,lf("Merge conflicts found. Resolve them before commiting.")),!!l.revert&&!!p.length&&n.createElement("p",null,lf("Reverting this file will also restore: {0}",p.join(", "))),!!l.revert&&!!h.length&&n.createElement("p",null,lf("Reverting this file will also remove: {0}",h.join(", "))),!!l.revert&&!!f.length&&!i&&n.createElement("p",null,lf("Reverting this file will also revert: {0}",f.map((e=>e.name)).join(", ")))),r.diffJSX?n.createElement("div",{className:"ui segment diff"},r.diffJSX):n.createElement("div",{className:"ui segment"},n.createElement("p",null,lf("Whitespace changes only."),s&&n.createElement(a.Link,{className:"link",text:lf("Show"),onClick:u}))))};let p=[],h=[];if(e.name==pxt.CONFIG_NAME){const t=pxt.Package.parseAndValidConfig(e.gitFile),i=pxt.Package.parseAndValidConfig(e.editorFile);if(t&&i){const e=pxt.allPkgFiles(t),n=pxt.allPkgFiles(i);p=e.filter((e=>-1==n.indexOf(e))),h=n.filter((t=>-1==e.indexOf(t)))}}const f=[];if(l.file=e,this.props.allowRevert){const t=r.mainEditorPkg().files,n=i&&t[e.file.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME)];n&&n!=e.file&&f.push(n);for(const t of r.mainEditorPkg().getGeneratedFiles(e.file))f.push(t);l.revert=()=>this.props.parent.revertFileAsync(e,p,h,f)}return l.diff=d(),l.diff}createBlocksDiffJSX(e){const t=e.gitFile||"",i=e.editorFile;let r;if(i){let o;o=e.tsEditorFile&&pxt.blocks.needsDecompiledDiff(t,i)?`\n\`\`\`diffblocks\n${e.tsGitFile||""}\n---------------------\n${e.tsEditorFile}\n\`\`\`\n`:`\n\`\`\`diffblocksxml\n${t}\n---------------------\n${i}\n\`\`\`\n`,r=n.createElement(p.MarkedContent,{key:`diffblocksxxml${e.name}`,parent:this.props.parent.props.parent,markdown:o})}else r=n.createElement("div",{className:"ui basic segment"},lf("Your blocks were updated. Go back to the editor to view the changes."));return{diffJSX:r,legendJSX:n.createElement("p",{className:"legend"},n.createElement("span",null,n.createElement("span",{className:"added icon"}),lf("added, changed or moved")),n.createElement("span",null,n.createElement("span",{className:"deleted icon"}),lf("deleted")),n.createElement("span",null,n.createElement("span",{className:"notchanged icon"}),lf("not changed")),a.helpIconLink("/github/diff#blocks",lf("Learn about reading differences in blocks code."))),conflicts:0}}createTextDiffJSX(e,t){const{showConflicts:i}=this.props,r=e.gitFile||"",o=e.editorFile||"",s={"@":"diff-marker"," ":"diff-unchanged","+":"diff-added","-":"diff-removed"},l=pxt.diff.compute(r,o,{ignoreWhitespace:!!t});if(!l)return pxt.tickEvent("github.diff.toobig"),{diffJSX:n.createElement("div",null,lf("Too many differences to render diff.")),conflicts:0};let c=0,u="",d=0,p=0,h="",f=null;const m=[];return l.forEach(((t,r)=>{const o=/^@@ -(\d+),\d+ \+(\d+),\d+/.exec(t);o?(d=parseInt(o[1])-1,p=parseInt(o[2])-1):("+"!=t[0]&&d++,"-"!=t[0]&&p++);const g=l[r+1]?l[r+1][0]:"",b=l[r+2]?l[r+2][0]:"",v=t.slice(2);let y=n.createElement("code",null,v);if(f)y=f,f=null;else if(!("-"!=t[0]||" "!=h&&"@"!=h||"+"!=g||" "!=b&&"@"!=b&&""!=b)){const e=this.lineDiff(t.slice(2),l[r+1].slice(2));y=e.a,f=e.b}let k=h=t[0];if("+"==h&&/^<<<<<<<[^<]/.test(v)){c++,u="local",k="@",m.push(n.createElement("tr",{key:"conflictheader"+d+p,className:"conflict ui small header"},n.createElement("td",{colSpan:4,className:"ui small header"},lf("Merge conflict")))),m.push(n.createElement("tr",{key:"conflictdescr"+d+p,className:"conflict ui description"},n.createElement("td",{colSpan:4,className:"ui small description"},lf("Changes from GitHub are conflicting with local changes."),a.helpIconLink("/github/merge-conflict",lf("Learn about merge conflicts and resolution.")))));const t=Math.min(d,p),r=()=>this.handleMergeConflictResolution(e,t,!0,!1),o=()=>this.handleMergeConflictResolution(e,t,!1,!0),s=()=>this.handleMergeConflictResolution(e,t,!0,!0);i&&m.push(n.createElement("tr",{key:"merge"+d+p,className:"conflict ui mergebtn"},n.createElement("td",{colSpan:4,className:"ui"},n.createElement(a.Button,{className:"compact",text:lf("Keep local"),title:lf("Ignore the changes from GitHub."),onClick:r}),n.createElement(a.Button,{className:"compact",text:lf("Keep remote"),title:lf("Override local changes with changes from GitHub."),onClick:o}),n.createElement(a.Button,{className:"compact",text:lf("Keep both"),title:lf("Keep both local and remote changes."),onClick:s}))))}else"+"==h&&/^>>>>>>>[^>]/.test(v)?(u="footer",k="@"):"+"==h&&/^=======$/.test(v)&&(k="@",u="remote");const w="@"==k,x=`${u?"conflict":""} ${u} ${s[k]}`;m.push(n.createElement("tr",{key:d+p,className:x},n.createElement("td",{className:"line-a","data-content":d}),n.createElement("td",{className:"line-b","data-content":p}),w?n.createElement("td",{colSpan:2,className:"change"},n.createElement("code",null,t)):n.createElement("td",{className:"marker","data-content":k}),w?void 0:n.createElement("td",{className:"change"},y))),"footer"==u&&(u="")})),{diffJSX:m.length?n.createElement("table",{className:"diffview"},n.createElement("tbody",null,m)):void 0,legendJSX:void 0,conflicts:c}}handleMergeConflictResolution(e,t,i,n){pxt.tickEvent("github.conflict.resolve",{local:i?1:0,remote:n?1:0},{interactiveConsent:!0});const r=pxt.diff.resolveMergeConflictMarker(e.file.content,t,i,n);e.file.setContentAsync(r).then((()=>this.props.parent.clearCacheDiff(this.props.cacheKey,e))).then((()=>this.props.parent.forceUpdate()))}revertAllFiles(){this.props.parent.revertAllFilesAsync()}renderCore(){const{diffFiles:e,blocksMode:t,allowRevert:i}=this.props,r=pxt.appTarget.appTheme,o=r.invertedMenu&&r.invertedMonaco,s=t&&!pxt.options.debug?e.filter((e=>/\.blocks$/.test(e.name))):e;return e.length?n.createElement("div",{className:"ui section"},n.createElement("div",{className:`ui ${o?"inverted ":""} diffheader segment`},lf("There are local changes."),i&&n.createElement(a.Button,{className:"small",icon:"undo",text:lf("Revert all"),ariaLabel:lf("Revert all changes"),title:lf("Revert all changes"),textClass:"landscape only",onClick:this.revertAllFiles})),s.map((e=>this.showDiff(e)))):n.createElement("div",{className:`ui ${o?"inverted ":""}segment`},lf("No local changes found."))}}class k extends a.StatelessUIElement{constructor(e){super(e),this.handleSwitchMasterBranch=this.handleSwitchMasterBranch.bind(this)}handleSwitchMasterBranch(e){pxt.tickEvent("github.branch.switch"),e.stopPropagation(),this.props.parent.switchBranchAsync("master")}renderCore(){const{needsCommitMessage:e}=this.props.parent.state,{pullStatus:t,pullRequest:i,githubId:r}=this.props,o="CLOSED"==(null==i?void 0:i.state),s="MERGED"==(null==i?void 0:i.state);return o||s?n.createElement("div",{className:"ui icon negative message"},n.createElement("i",{className:"exclamation circle icon"}),n.createElement("div",{className:"content"},o&&lf("This Pull Request is closed!"),s&&lf("This pull request has been merged."),n.createElement("span",{role:"button",className:"ui link",onClick:this.handleSwitchMasterBranch,onKeyDown:b.fireClickOnEnter},lf("Switch to master branch")))):t==l.PullStatus.NoSourceControl?n.createElement("div",{className:"ui icon warning message"},n.createElement("i",{className:"exclamation circle icon"}),n.createElement("div",{className:"content"},lf("This repository was not found. It might have been deleted or you may not have rights to access it."),n.createElement(a.Link,{href:`https://github.com/${r.slug}`,text:lf("Go to GitHub")}))):t==l.PullStatus.BranchNotFound?n.createElement("div",{className:"ui icon warning message"},n.createElement("i",{className:"exclamation circle icon"}),n.createElement("div",{className:"content"},lf("This branch was not found, please pull again or switch to a different branch."),n.createElement("span",{role:"button",className:"ui link",onClick:this.handleSwitchMasterBranch,onKeyDown:b.fireClickOnEnter},lf("Switch to master branch")))):e?n.createElement("div",{className:"ui warning message"},n.createElement("div",{className:"content"},lf("You need to commit your changes before you can pull from GitHub."))):n.createElement("div",null)}}class w extends a.StatelessUIElement{constructor(e){super(e),this.handleDescriptionChange=this.handleDescriptionChange.bind(this),this.handleCommitClick=this.handleCommitClick.bind(this)}handleDescriptionChange(e){this.props.parent.setState({description:e})}async handleCommitClick(e){pxt.tickEvent("github.commit"),e.stopPropagation(),await f.githubProvider().loginAsync(),pxt.github.token&&await this.props.parent.commitAsync()}renderCore(){const{description:e}=this.props.parent.state,t=e&&e.length>70?lf("Your description is getting long..."):void 0;return n.createElement("div",null,n.createElement("div",{className:"ui field"},n.createElement(a.Input,{type:"text",placeholder:lf("Describe your changes."),value:this.props.parent.state.description,onChange:this.handleDescriptionChange,error:t})),n.createElement("div",{className:"ui field"},n.createElement(a.Button,{className:"green",text:lf("Commit and push changes"),icon:"long arrow alternate up",onClick:this.handleCommitClick,onKeyDown:b.fireClickOnEnter}),n.createElement("span",{className:"inline-help"},lf("Save your changes in GitHub."),a.helpIconLink("/github/commit",lf("Learn about commiting and pushing code into GitHub.")))))}}class x extends a.StatelessUIElement{constructor(e){super(e),this.scheduleRefreshPullRequestStatus=pxtc.Util.debounce((()=>{const e=this.props.parent.props.parent.state.header;e&&(r.invalidatePullRequestStatus(e),this.pullRequestStatus())}),1e4,!1),this.handleMergeClick=this.handleMergeClick.bind(this)}pullRequestStatus(){const e=this.props.parent.props.parent.state.header,t=this.props.parent.getData("pkg-git-pr:"+e.id);return"UNKNOWN"===(null==t?void 0:t.mergeable)&&"OPEN"===(null==t?void 0:t.state)&&this.scheduleRefreshPullRequestStatus(),t}handleMergeClick(e){pxt.tickEvent("github.pr.merge",null,{interactiveConsent:!0}),e.stopPropagation();const{githubId:t}=this.props,i=this.props.parent.props.parent.state.header,r=this.props.parent.getData("pkg-git-pr:"+i.id);o.promptAsync({header:lf("Squash and merge?"),jsx:n.createElement("p",null,lf("Your changes will merged as a single commit into the base branch and you will switch back to the base branch.")),agreeLbl:lf("Confirm merge"),helpUrl:"/github/pull-request",hasCloseIcon:!0,placeholder:lf("Describe your changes")}).then((e=>null===e?Promise.resolve():this.props.parent.fastForwardMergeAsync(t,r,e)))}renderCore(){const{gs:e,githubId:t}=this.props,i=this.pullRequestStatus(),r=!!e.mergeSha,o="MERGEABLE"===i.mergeable,s="OPEN"===i.state,l=s&&"UNKNOWN"===i.mergeable,c=r?"sync":o?"check":l?"circle outline":"exclamation triangle",u=r?"orange":o?"green":l?"orange":"grey",d=r?lf("A merge is in progress. Please resolve conflicts or cancel it"):o?lf("This branch has no conflicts with the base branch"):l?lf("Checking if your branch can be merged"):lf("This branch has conflicts that must be resolved");return s?n.createElement("div",{className:`ui ${u} segment`},n.createElement("div",{className:"ui field"},n.createElement("div",{className:"ui"},n.createElement("i",{className:`icon ${u} inverted circular ${c}`}),d)),!o&&!l&&n.createElement("div",{className:"ui field"},n.createElement(a.Link,{className:"button",text:lf("Resolve conflicts"),href:`https://github.com/${t.slug}/pull/${i.number}/conflicts`,target:"_blank"}),n.createElement("span",{className:"inline-help"},lf("Resolve merge conflicts in GitHub."),a.helpIconLink("/github/pull-requests",lf("Learn about merging pull requests in GitHub.")))),o&&n.createElement("div",{className:"ui field"},n.createElement(a.Button,{className:u,text:lf("Squash and merge"),onClick:this.handleMergeClick,onKeyDown:b.fireClickOnEnter}),n.createElement("span",{className:"inline-help"},lf("Merge your changes as a single commit into the base branch."),a.helpIconLink("/github/pull-requests",lf("Learn about merging pull requests in GitHub."))))):n.createElement("div",null)}}class E extends a.StatelessUIElement{constructor(e){super(e),this.scheduleRefreshPageStatus=pxtc.Util.debounce((()=>{const e=this.props.parent.props.parent.state.header;e&&(r.invalidatePagesStatus(e),this.pagesStatus())}),1e4,!1),this.handleBumpClick=this.handleBumpClick.bind(this)}handleBumpClick(e){pxt.tickEvent("github.releasezone.bump",void 0,{interactiveConsent:!0}),e.stopPropagation();const{needsCommit:t,master:i}=this.props,n=this.props.parent.props.parent.state.header;t?o.confirmAsync({header:lf("Commit your changes..."),body:lf("You need to commit your local changes to create a release."),agreeLbl:lf("Ok"),hideAgree:!0}):i?f.githubProvider().loginAsync().then((()=>pxt.github.token&&this.props.parent.bumpAsync())).finally((()=>r.invalidatePagesStatus(n))):o.confirmAsync({header:lf("Checkout the master branch..."),body:lf("You need to checkout the master branch to create a release."),agreeLbl:lf("Ok"),hideAgree:!0})}pagesStatus(){const e=this.props.parent.props.parent.state.header,t=this.props.parent.getData("pkg-git-pages:"+e.id);return t&&"building"==t.status&&this.scheduleRefreshPageStatus(),t}renderCore(){const{gs:e,needsCommit:t}=this.props,i=e.commit&&e.commit.tag,r=!!pxt.appTarget.appTheme.githubCompiledJs;if(t)return n.createElement("div",null);const o=this.pagesStatus(),s=o&&!!o.html_url,l=o&&"building"==o.status,c=!!pxt.appTarget.appTheme.invertedGitHub;return n.createElement("div",{className:`ui transparent ${c?"inverted":""} segment`},n.createElement("div",{className:"ui header"},lf("Release zone")),!t&&!i&&n.createElement("div",{className:"ui field"},n.createElement(a.Button,{className:"basic",text:lf("Create release"),inverted:c,onClick:this.handleBumpClick,onKeyDown:b.fireClickOnEnter}),n.createElement("span",{className:"inline-help"},lf("Snapshot and publish your code."),a.helpIconLink("/github/release",lf("Learn more about extension releases.")))),!t&&i&&n.createElement("div",{className:"ui field"},n.createElement("p",{className:"inline-help"},lf("Current release: {0}",i),a.helpIconLink("/github/release",lf("Learn about releases.")))),s&&n.createElement("div",{className:"ui field"},n.createElement(a.Link,{className:"basic button",href:o.html_url,inverted:c,loading:l,text:lf("Open Pages"),target:"_blank"}),n.createElement("span",{className:"inline-help"},l?lf("Pages building, it may take a few minutes."):r?lf("Commit & create release to update Pages."):lf("Commit to update Pages."),a.helpIconLink("/github/pages",lf("Learn about GitHub Pages.")))))}}class C extends a.StatelessUIElement{constructor(e){super(e),this.handleForkClick=this.handleForkClick.bind(this),this.handleSaveClick=this.handleSaveClick.bind(this)}handleForkClick(e){pxt.tickEvent("github.extensionzone.fork",void 0,{interactiveConsent:!0}),e.stopPropagation(),this.props.parent.forkAsync(!1)}handleSaveClick(e){pxt.tickEvent("github.extensionzone.save",void 0,{interactiveConsent:!0}),e.stopPropagation(),this.props.parent.props.parent.saveAndCompile()}renderCore(){const{needsToken:e,githubId:t,gs:i,user:r}=this.props,o=this.props.parent.props.parent.state.header,s=!e&&i.commit&&!i.commit.tree.tree.some((e=>/^LICENSE/.test(e.path.toUpperCase())||/^COPYING/.test(e.path.toUpperCase()))),l=o&&`${window.location.href.replace(/#.*$/,"")}#testproject:${o.id}`,c=r&&r.id!=t.owner,u=!!pxt.appTarget.appTheme.invertedGitHub;return n.createElement("div",{className:`ui transparent ${u?"inverted":""} segment`},n.createElement("div",{className:"ui header"},lf("Extension zone")),n.createElement("div",{className:"ui field"},n.createElement(a.Link,{className:"basic button",href:l,inverted:u,text:lf("Test Extension"),target:`${pxt.appTarget.id}testproject`}),n.createElement("span",{className:"inline-help"},lf("Open a test project that uses this extension."),a.helpIconLink("/github/test-extension",lf("Learn about testing extensions.")))),c&&n.createElement("div",{className:"ui field"},n.createElement(a.Button,{className:"basic",text:lf("Fork repository"),onClick:this.handleForkClick,inverted:u,onKeyDown:b.fireClickOnEnter}),n.createElement("span",{className:"inline-help"},lf("Fork your own copy of {0} to your account.",t.slug),a.helpIconLink("/github/fork",lf("Learn more about forking repositories.")))),s&&n.createElement("div",{className:"ui field"},n.createElement(a.Link,{className:"basic button",href:`https://github.com/${t.slug}/community/license/new?branch=${t.tag}&template=mit`,inverted:u,text:lf("Add license"),target:"_blank"}),n.createElement("span",{className:"inline-help"},lf("Your project doesn't seem to have a license."),a.helpIconLink("/github/license",lf("Learn more about licenses.")))),n.createElement("div",{className:"ui field"},n.createElement(a.Button,{className:"basic",text:lf("Save for offline"),onClick:this.handleSaveClick,inverted:u,onKeyDown:b.fireClickOnEnter}),n.createElement("span",{className:"inline-help"},lf("Export this extension to a file that can be imported without Internet."),a.helpIconLink("/github/offline",lf("Learn more about offline support for extensions.")))))}}class S extends a.UIElement{constructor(e){super(e),this.handleRestore=this.handleRestore.bind(this)}loadDiffFilesAsync(){const{githubId:e,commit:t}=this.props;this.setState({loading:!0}),pxt.github.getCommitAsync(e.slug,t.sha).then((e=>this.computeDiffAsync(e))).then((e=>this.setState({diffFiles:e}))).finally((()=>this.setState({loading:!1})))}computeDiffAsync(e){const{githubId:t}=this.props,i=r.mainEditorPkg().sortedFiles(),n={};return Promise.all(i.map((i=>{const r=i.name;return pxt.github.lookupFile(t,e,r)?pxt.github.downloadTextAsync(t.fullName,e.sha,r).then((e=>{n[r]=e})):Promise.resolve()}))).then((()=>i.map((e=>{const t=e.name,r=n[t],o=/\.blocks$/.test(t),s=e.publishedContent();if(r===s)return;const a={file:e,name:e.name,gitFile:r,editorFile:s};if(o&&pxt.blocks.needsDecompiledDiff(r,s)){const t=e.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),r=i.find((e=>e.name==t)),o=n[t];r&&o&&(a.tsEditorFile=r.publishedContent(),a.tsGitFile=o)}return a})))).then((e=>e.filter((e=>!!e))))}handleRestore(e){e.stopPropagation(),pxt.tickEvent("github.restore",void 0,{interactiveConsent:!0});const{commit:t}=this.props;return o.confirmAsync({header:lf("Would you like to restore this commit?"),body:lf("You will restore your project to the point in time when this commit was made. Don't worry, you can undo this action by restoring to the previous commit."),agreeLbl:lf("Restore"),agreeClass:"green"}).then((e=>{e&&(o.showLoading("github.restore",lf("restoring commit...")),l.restoreCommitAsync(this.props.parent.props.parent.state.header,t).then((()=>(d.invalidate("gh-commits:*"),this.props.parent.props.parent.reloadHeaderAsync()))).finally((()=>o.hideLoading("github.restore"))))})),!1}renderCore(){const{parent:e,commit:t,expanded:i,onClick:r}=this.props,{diffFiles:o,loading:s}=this.state,l=new Date(Date.parse(t.author.date));return!i||o||s||this.loadDiffFilesAsync(),n.createElement("div",{className:"ui item link",role:"button",onClick:r,onKeyDown:b.fireClickOnEnter},n.createElement("div",{className:"content"},i&&n.createElement(a.Button,{loading:s,className:"right floated",text:lf("Restore"),onClick:this.handleRestore,onKeyDown:b.fireClickOnEnter}),n.createElement("div",{className:"meta"},n.createElement("span",null,l.toLocaleTimeString())),n.createElement("div",{className:"description"},t.message),i&&o&&n.createElement("div",{className:"ui inverted segment"},lf("Comparing selected commit with local files")),i&&o&&n.createElement(y,{parent:e,blocksMode:!1,diffFiles:o,cacheKey:t.sha})))}}class _ extends a.UIElement{constructor(e){super(e),this.handleLoadClick=this.handleLoadClick.bind(this)}handleLoadClick(){pxt.tickEvent("github.history.load",void 0,{interactiveConsent:!0});const{expanded:e}=this.state;this.setState({expanded:!e,selectedCommit:void 0,selectedDay:void 0})}renderCore(){const{githubId:e,gs:t,parent:i}=this.props,{selectedCommit:r,expanded:o,selectedDay:s}=this.state,l=!!pxt.appTarget.appTheme.invertedGitHub,c=o&&this.getData(`gh-commits:${e.slug}#${t.commit.sha}`),u=o&&!c,d={};return c&&c.forEach((e=>{const t=new Date(Date.parse(e.author.date)).toLocaleDateString();let i=d[t];i||(i=d[t]=[]),i.push(e)})),n.createElement("div",{className:`ui transparent ${l?"inverted":""} segment`},n.createElement("div",{className:"ui header"},lf("History")),(u||!o)&&n.createElement("div",{className:"ui field"},n.createElement(a.Button,{loading:u,className:"basic",text:lf("View commits"),onClick:this.handleLoadClick,inverted:l,onKeyDown:b.fireClickOnEnter}),n.createElement("span",{className:"inline-help"},lf("Restore your project to a previous commit."),a.helpIconLink("/github/history",lf("Learn more about history of commits.")))),c&&n.createElement("div",{className:"ui items"},Object.keys(d).map((t=>n.createElement("div",{role:"button",className:"ui link item",key:"commitday"+t,onClick:e=>{e.stopPropagation(),pxt.tickEvent("github.history.selectday"),this.setState({selectedDay:s===t?void 0:t,selectedCommit:void 0})},onKeyDown:b.fireClickOnEnter},n.createElement("div",{className:"content"},n.createElement("div",{className:"ui header"},t,n.createElement("div",{className:"ui label button"},n.createElement("i",{className:"long arrow alternate up icon"})," ",d[t].length)),t===s&&n.createElement("div",{className:"ui divided items"},d[t].map((t=>n.createElement(S,{key:"commit"+t.sha,onClick:e=>{e.stopPropagation(),pxt.tickEvent("github.history.selectcommit",void 0,{interactiveConsent:!0});const{selectedCommit:i}=this.state;this.setState({selectedCommit:t==i?void 0:t})},commit:t,parent:i,githubId:e,expanded:r===t}))))))))))}}class T extends s.Editor{constructor(e){super(e),this.parent=e,this.handleViewRef=e=>{this.view=e,this.view&&this.view.setVisible(this.isVisible)},this.handleViewRef=this.handleViewRef.bind(this)}getId(){return"githubEditor"}getCurrentSource(){return r.mainEditorPkg().files[pxt.github.GIT_JSON].content}hasHistory(){return!0}hasEditorToolbar(){return!1}setVisible(e){this.isVisible=e,this.view&&this.view.setVisible(e)}setHighContrast(e){}acceptsFile(e){return e.name===pxt.github.GIT_JSON}loadFileAsync(e,t){return super.loadFileAsync(e,t).then((()=>h.getBlocksAsync())).then((()=>this.parent.forceUpdate()))}display(){if(!this.isVisible)return;const e=this.parent.state.header;return e&&e.githubId?n.createElement(v,{ref:this.handleViewRef,parent:this.parent}):void 0}}i.Editor=T},{"./cloudsync":27,"./compiler":30,"./core":78,"./coretsx":79,"./data":81,"./dialogs":88,"./marked":111,"./package":122,"./srceditor":142,"./sui":143,"./tutorial":146,"./util":149,"./workspace":151,react:335}],100:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebCam=void 0;const n=e("react"),r=e("./data"),o=e("./sui"),s=e("./util");class a extends r.Component{constructor(e){super(e),this.handleVideoRef=e=>{this.video=e},this.state={hasPrompt:!0},this.handleDeviceClick=this.handleDeviceClick.bind(this),this.handleClose=this.handleClose.bind(this)}handleDeviceClick(e){this.setState({hasPrompt:!1}),pxt.debug("greenscreen: start"),this.deviceId=e,this.deviceId&&navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:e}},audio:!1}).then((e=>{pxt.debug("greenscreen: stream acquired");try{this.stream=e,this.video.srcObject=this.stream,this.video.play();const t=this.stream.getVideoTracks()[0];if(t){const e="environment"!==t.getSettings().facingMode;this.setState({userFacing:e})}}catch(e){pxt.debug("greenscreen: play failed"),console.error(e),this.stop()}}),(e=>{pxt.debug("greenscreen: get camera failed"),console.error(e),this.stop()}))}handleClose(){this.deviceId||this.props.close()}componentDidMount(){void 0!==typeof navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.getUserMedia&&!pxt.BrowserUtils.isElectron()&&!pxt.BrowserUtils.isUwpEdge()&&navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((()=>navigator.mediaDevices.enumerateDevices())).then((e=>{this.setState({devices:e.filter((e=>"videoinput"==e.kind))})}),(e=>{pxt.debug("greenscreen: enumerate devices failed"),console.error(e)}))}componentWillUnmount(){this.stop()}stop(){if(this.deviceId=void 0,this.stream){try{const e=this.stream.getTracks();e&&e.forEach((e=>e.stop()))}catch(e){}this.stream=void 0}if(this.video)try{this.video.srcObject=void 0}catch(e){}}render(){const{hasPrompt:e,devices:t,userFacing:i}=this.state;return n.createElement("div",{className:"videoContainer"},n.createElement("video",{className:i?"flipx":"",autoPlay:!0,playsInline:!0,ref:this.handleVideoRef}),e?n.createElement(o.Modal,{isOpen:e,onClose:this.handleClose,closeIcon:!0,dimmer:!0,header:lf("Choose a camera")},n.createElement("div",{className:"ui cards "+(t?"":"loading")},n.createElement(l,{key:"devicegreenscreen",icon:"green tint",onClick:this.handleDeviceClick,deviceId:"",header:lf("Green background")}),t&&t.map(((e,t)=>n.createElement(l,{key:`device${t}`,icon:"video camera",onClick:this.handleDeviceClick,deviceId:e.deviceId,header:e.label||lf("camera {0}",t)}))))):void 0)}}i.WebCam=a;class l extends r.Component{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this)}handleClick(){const{deviceId:e,onClick:t}=this.props;t(e)}renderCore(){const{header:e,icon:t}=this.props;return n.createElement("div",{role:"button",className:"ui card link",tabIndex:0,onClick:this.handleClick,onKeyDown:s.fireClickOnEnter},n.createElement("div",{className:"imageicon"},n.createElement(o.Icon,{icon:`${t} massive`})),n.createElement("div",{className:"content"},n.createElement("span",{className:"header"},e)))}}},{"./data":81,"./sui":143,"./util":149,react:335}],101:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.HeaderBar=void 0;const n=e("react"),r=e("./data"),o=e("./sui"),s=e("./auth"),a=e("./cmds"),l=e("./container"),c=e("./identity"),u=e("./package"),d=e("./projects"),p=e("./tutorial");class h extends r.Component{constructor(e){super(e),this.goHome=()=>{pxt.tickEvent("menu.home",void 0,{interactiveConsent:!0}),"home"!==this.getView()&&this.props.parent.showExitAndSaveDialog()},this.showShareDialog=()=>{pxt.tickEvent("menu.share",void 0,{interactiveConsent:!0}),this.props.parent.showShareDialog()},this.launchFullEditor=()=>{pxt.tickEvent("sandbox.openfulleditor",void 0,{interactiveConsent:!0}),this.props.parent.launchFullEditor()},this.exitTutorial=()=>{const e=this.props.parent.state.tutorialOptions;pxt.tickEvent("menu.exitTutorial",{tutorial:null==e?void 0:e.tutorial},{interactiveConsent:!0}),this.props.parent.exitTutorial()},this.showReportAbuse=()=>{pxt.tickEvent("tutorial.reportabuse",void 0,{interactiveConsent:!0}),this.props.parent.showReportAbuse()},this.toggleDebug=()=>{pxt.tickEvent("simulator.debug",void 0,{interactiveConsent:!0}),this.props.parent.toggleDebugging()},this.brandIconClick=()=>{pxt.tickEvent("projects.brand",void 0,{interactiveConsent:!0}),this.goHome()},this.backButtonTouchStart=e=>{this.longpressTimer=setTimeout((()=>a.nativeHostLongpressAsync()),750),this.touchStartTime=(new Date).getTime()},this.backButtonTouchEnd=e=>{e.preventDefault(),this.touchStartTime&&(new Date).getTime()-this.touchStartTime<750&&a.nativeHostBackAsync(),this.touchStartTime=null,clearTimeout(this.longpressTimer)},this.getView=()=>{const{home:e,debugging:t,tutorialOptions:i}=this.props.parent.state;return e?"home":pxt.shell.isSandboxMode()?"sandbox":t?"debugging":!pxt.BrowserUtils.useOldTutorialLayout()&&(null==i?void 0:i.tutorial)?"tutorial-tab":(null==i?void 0:i.tutorial)?"tutorial":"editor"},this.getSettingsMenu=e=>{const{greenScreen:t,accessibleBlocks:i,header:r}=this.props.parent.state;switch(e){case"home":return n.createElement(d.ProjectSettingsMenu,{parent:this.props.parent});case"tutorial-tab":case"editor":return n.createElement(l.SettingsMenu,{parent:this.props.parent,greenScreen:t,accessibleBlocks:i,showShare:!!r});default:return n.createElement("div",null)}}}getOrganizationLogo(e,t,i){return n.createElement("div",{className:"ui item logo organization"},e.organizationWideLogo||e.organizationLogo?n.createElement("img",{className:"ui logo "+("home"!==i?"mobile hide":""),src:e.organizationWideLogo||e.organizationLogo,alt:lf("{0} Logo",e.organization)}):n.createElement("span",{className:"name"},e.organization),e.organizationLogo&&"home"!==i&&n.createElement("img",{className:"ui image mobile only",src:e.organizationLogo,alt:lf("{0} Logo",e.organization)}))}getTargetLogo(e,t,i){return n.createElement("div",{"aria-label":lf("{0} Logo",e.boardName),role:"menuitem",className:"ui item logo brand "+("sandbox"!==i&&"home"!==i?"mobile hide":""),onClick:this.brandIconClick},e.useTextLogo?[n.createElement("span",{className:"name",key:"org-name"},e.organizationText),n.createElement("span",{className:"name-short",key:"org-name-short"},e.organizationShortText||e.organizationText)]:e.logo||e.portraitLogo?n.createElement("img",{className:`ui ${e.logoWide?"small":""} logo`,src:e.logo||e.portraitLogo,alt:lf("{0} Logo",e.boardName)}):n.createElement("span",{className:"name"},e.boardName))}getCenterLabel(e,t,i){var r,s,a,c;const d=!!u.mainEditorPkg().files[pxt.ASSETS_FILE],h=null===(s=null===(r=u.mainPkg)||void 0===r?void 0:r.config)||void 0===s?void 0:s.languageRestriction,f=!d&&("javascript-only"===h||"python-only"===h)||e.blocksOnly;switch(t){case"tutorial":const r=(null==i?void 0:i.tutorialActivityInfo)?i.tutorialActivityInfo[i.tutorialStepInfo[i.tutorialStep].activity].name:null,s=null===(a=null==i?void 0:i.metadata)||void 0===a?void 0:a.hideIteration;if(r)return n.createElement("div",{className:"ui item"},r);if(!s)return n.createElement(p.TutorialMenu,{parent:this.props.parent});break;case"tutorial-tab":return n.createElement("div",null);case"debugging":return n.createElement(o.MenuItem,{className:"centered",icon:"large bug",name:"Debug Mode"});case"sandbox":case"editor":if(!f)return n.createElement("div",{className:"ui item link editor-menuitem"},n.createElement(l.EditorSelector,{parent:this.props.parent,sandbox:"sandbox"===t,python:e.python,languageRestriction:h,headless:null===(c=pxt.appTarget.simulator)||void 0===c?void 0:c.headless}));switch(h){case"python-only":return n.createElement(o.MenuItem,{className:"centered",icon:"xicon python",name:"Python"});case"javascript-only":return n.createElement(o.MenuItem,{className:"centered",icon:"xicon js",name:"JavaScript"})}}return n.createElement("div",null)}getExitButtons(e,t,i){var r,s;switch(t){case"debugging":return n.createElement(o.ButtonMenuItem,{className:"exit-debugmode-btn",role:"menuitem",icon:"external",text:lf("Exit Debug Mode"),textClass:"landscape only",onClick:this.toggleDebug});case"sandbox":if(!e.hideEmbedEdit)return n.createElement(o.Item,{role:"menuitem",icon:"external",textClass:"mobile hide",text:lf("Edit"),onClick:this.launchFullEditor});break;case"tutorial":case"tutorial-tab":const a=[];if(null==i?void 0:i.tutorialReportId){const e=lf("Unapproved Content");a.push(n.createElement(o.Item,{key:"tutorial-report",role:"menuitem",icon:"exclamation triangle",className:"report-tutorial-btn link-button icon-and-text",textClass:"landscape only",text:e,ariaLabel:e,onClick:this.showReportAbuse}))}if(!e.lockedEditor&&!(null===(r=null==i?void 0:i.metadata)||void 0===r?void 0:r.hideIteration)&&("tutorial-tab"!==t||(null===(s=pxt.appTarget.simulator)||void 0===s?void 0:s.headless))){const e=lf("Exit tutorial");a.push(n.createElement(o.Item,{key:"tutorial-exit",role:"menuitem",icon:"sign out large",className:"exit-tutorial-btn link-button icon-and-text",textClass:"landscape only",text:e,ariaLabel:e,onClick:this.exitTutorial}))}if(a.length)return a}return n.createElement("div",null)}renderCore(){var e,t;const i=pxt.appTarget.appTheme,r=this.getData(s.HIGHCONTRAST),u=this.getView(),{home:d,header:p,tutorialOptions:h}=this.props.parent.state,f=pxt.shell.isControllerMode(),m=a.isNativeHost(),g=s.hasIdentity(),b=this.props.parent.isPythonActive()?"Python":this.props.parent.isJavaScriptActive()?"JavaScript":"Blocks",v=!("editor"!==u&&"tutorial-tab"!==u||i.lockedEditor||f),y="editor"===u&&p&&(null===(e=pxt.appTarget.cloud)||void 0===e?void 0:e.sharing)&&!f,k="editor"===u&&(null===(t=i.docMenu)||void 0===t?void 0:t.length),w="tutorial"==u&&22*h.tutorialStepInfo.length>window.innerWidth/3;return n.createElement("div",{id:"mainmenu",className:`ui borderless fixed menu ${i.invertedMenu?"inverted":""} ${w?"thin":""}`,role:"menubar"},n.createElement("div",{className:"left menu"},m&&n.createElement(o.Item,{className:"icon nativeback",role:"menuitem",icon:"chevron left large",ariaLabel:lf("Back to application"),onClick:a.nativeHostBackAsync,onMouseDown:this.backButtonTouchStart,onMouseUp:this.backButtonTouchEnd,onMouseLeave:this.backButtonTouchEnd}),this.getOrganizationLogo(i,r,u),"tutorial"===u?n.createElement(o.Item,{className:"tutorialname",tabIndex:-1,textClass:"landscape only",text:h.tutorialName}):this.getTargetLogo(i,r,u)),!d&&n.createElement("div",{className:"center menu"},this.getCenterLabel(i,u,h)),n.createElement("div",{className:"right menu"},this.getExitButtons(i,u,h),v&&n.createElement(o.Item,{className:"icon openproject "+(g?"mobile hide":""),role:"menuitem",title:lf("Home"),icon:"home large",ariaLabel:lf("Home screen"),onClick:this.goHome}),y&&n.createElement(o.Item,{className:"icon shareproject mobile hide",role:"menuitem",title:lf("Publish your game to create a shareable link"),icon:"share alternate large",ariaLabel:lf("Share Project"),onClick:this.showShareDialog}),k&&n.createElement(l.DocsMenu,{parent:this.props.parent,editor:b}),this.getSettingsMenu(u),g&&("home"===u||"editor"===u||"tutorial-tab"===u)&&n.createElement(c.UserMenu,{parent:this.props.parent})))}}i.HeaderBar=h},{"./auth":20,"./cmds":28,"./container":77,"./data":81,"./identity":105,"./package":122,"./projects":123,"./sui":143,"./tutorial":146,react:335}],102:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.mkHIDBridgePacketIOAsync=i.shouldUse=i.HIDError=void 0;var n=pxt.Cloud,r=pxt.Util;let o;class s extends Error{constructor(e){super(e),this.message=e}}i.HIDError=s;let a={};function l(e){let t=r.lookup(a,e.result.path);t?t.onOOB(e):console.error("Dropping data for "+e.result.path)}i.shouldUse=function(){let e=pxt.appTarget.serial;return e&&e.useHF2&&(pxt.BrowserUtils.isLocalHost()&&!!n.localToken||pxt.winrt.isWinRT())},i.mkHIDBridgePacketIOAsync=function(){!function(){if(!o){if(!pxt.BrowserUtils.isLocalHost()||!n.localToken)return;pxt.debug("initializing hid pipe"),o=pxt.worker.makeWebSocket(`ws://localhost:${pxt.options.wsPort}/${n.localToken}/hid`,l)}}();let e=!1;pxt.appTarget.serial&&pxt.appTarget.serial.rawHID&&(e=!0);let t=new c(e);return t.initAsync().then((()=>t))};class c{constructor(e=!1){this.rawMode=e,this.onDeviceConnectionChanged=e=>{},this.onConnectionChanged=()=>{},this.onData=e=>{},this.onEvent=e=>{},this.onError=e=>{},this.onSerial=(e,t)=>{},this.connecting=!1,e&&(this.onEvent=e=>this.onData(e))}disposeAsync(){return Promise.resolve()}isConnecting(){return this.connecting}isConnected(){return!!this.dev&&this.connected}onOOB(e){"serial"==e.op?this.onSerial(r.fromHex(e.result.data),e.result.isError):"event"==e.op&&this.onEvent(r.fromHex(e.result.data))}talksAsync(e){return o.opAsync("talk",{path:this.dev.path,cmds:e.map((e=>({cmd:e.cmd,data:e.data?r.toHex(e.data):""})))}).then((e=>e.map((e=>r.fromHex(e.data)))))}error(e){throw this.connected=!1,new s(r.lf("USB/HID error on device {0} ({1})",this.dev.product,e))}reconnectAsync(){return this.initAsync()}disconnectAsync(){return this.connected=!1,o.opAsync("disconnect",{path:this.dev.path}).finally((()=>{this.onConnectionChanged&&this.onConnectionChanged()}))}sendPacketAsync(e){if(this.rawMode)return o.opAsync("send",{path:this.dev.path,data:r.toHex(e),raw:!0});throw new Error("should use talksAsync()!")}sendSerialAsync(e,t){return o.opAsync("sendserial",{path:this.dev.path,data:r.toHex(e),isError:t})}initAsync(){return this.connected=!1,this.connecting=!0,o.opAsync("list",{}).then((e=>{let t=e.devices,i=t.filter((e=>16896==(65280&e.release)))[0];if(pxt.appTarget.serial&&pxt.appTarget.serial.rawHID&&(i=t[0]),!i)throw new Error("No device connected");this.dev&&delete a[this.dev.path],this.dev=i,a[this.dev.path]=this})).then((()=>o.opAsync("init",{path:this.dev.path,raw:this.rawMode}))).then((()=>{this.connected=!0})).finally((()=>{this.connecting=!1,this.onConnectionChanged&&this.onConnectionChanged()}))}}},{}],103:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.HintManager=i.HintTooltip=void 0;const n=e("react"),r=e("./data");class o extends r.Component{constructor(e){super(e)}UNSAFE_componentWillReceiveProps(e){e.pokeUser!=this.state.show&&this.setState({show:e.pokeUser})}renderCore(){return n.createElement("div",{className:"tooltip "+(this.state.show?"show":""),role:"tooltip",onClick:this.props.onClick},this.props.text)}}i.HintTooltip=o;i.HintManager=class{constructor(){this.defaultDuration=1e4,this.defaultDisplayCount=3,this.hints={},this.seenHints={}}viewedHint(e){this.seenHints[e]=!0}clearViewedHints(){this.seenHints={}}addHint(e,t,i){this.hints[e]=pxt.Util.debounce((()=>{t(),this.stopPokeUserActivity()}),i||this.defaultDuration)}pokeUserActivity(e,t,i){(null==i||i<this.defaultDisplayCount)&&!this.seenHints[t]&&(this.stopPokeUserActivity(),this.timer=this.hints[e]())}stopPokeUserActivity(){clearTimeout(this.timer),this.timer=null}}},{"./data":81,react:335}],104:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.provider=void 0;const n=e("./browserworkspace"),r="texts",o="headers";let s;async function a(){return s?await s:s=async function(){const e=new pxt.BrowserUtils.IDBWrapper("__pxt_idb_workspace",1,((e,t)=>{const i=t.result;i.createObjectStore(r,{keyPath:"id"}),i.createObjectStore(o,{keyPath:"id"})}),(async()=>{await pxt.BrowserUtils.clearTranslationDbAsync(),await pxt.BrowserUtils.clearTutorialInfoDbAsync()}));try{await e.openAsync()}catch(e){return pxt.reportException(e),Promise.reject(e)}return e}()}async function l(e,t,i){const n=await a();try{await s(n,e,t,i)}catch(r){if(409==r.status)return void pxt.debug("idb: set conflict (409)");pxt.reportException(r),pxt.log("idb: set failed, cleaning cache dbs"),await pxt.BrowserUtils.clearTranslationDbAsync(),await pxt.BrowserUtils.clearTutorialInfoDbAsync();try{await s(n,e,t,i)}catch(e){throw pxt.reportException(e,{ws:"idb"}),pxt.log("idb: we are out of space..."),e}}async function s(e,t,i,n){const s={id:t.id,files:n,_rev:i};n&&await e.setAsync(r,s),await e.setAsync(o,t)}}i.provider={getAsync:async function(e){const t=await a(),i=await t.getAsync(r,e.id);return{header:e,text:i.files,version:i._rev}},setAsync:l,deleteAsync:async function(e,t){const i=await a();await i.deleteAsync(r,e.id),await i.deleteAsync(o,e.id)},listAsync:async function(){return await async function(){const e=await a();if((await e.getAllAsync(o)).length)return;const t=await n.provider.listAsync();await Promise.all(t.map((e=>(async e=>{const t=await n.provider.getAsync(e);delete t._id,delete t._rev,await l(e,void 0,t.text)})(e))))}(),(await a()).getAllAsync(o)},resetAsync:async function(){const e=await a();await e.deleteAllAsync(r),await e.deleteAllAsync(o)}}},{"./browserworkspace":24}],105:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CloudSaveStatus=i.UserMenu=i.LoginDialog=void 0;const n=e("react"),r=e("./sui"),o=e("./core"),s=e("./auth"),a=e("./data"),l=e("./cloudsync"),c=e("./cloud"),u=e("./util");class d extends s.Component{constructor(e){super(e),this.handleRememberMeChanged=e=>{this.setState({rememberMe:e})},this.hide=()=>{this.setState({visible:!1})},this.state={visible:!1,rememberMe:!1,continuationHash:""}}async show(e){this.setState({visible:!0,continuationHash:e})}async signInAsync(e){pxt.tickEvent("identity.loginClick",{provider:e.name,rememberMe:this.state.rememberMe.toString()}),await s.loginAsync(e.id,this.state.rememberMe,{hash:this.state.continuationHash})}renderCore(){const{visible:e}=this.state,t=pxt.auth.identityProvider("microsoft"),i=[];i.push({label:lf("Sign in"),onclick:async()=>await this.signInAsync(t),icon:"checkmark",approveButton:!0,className:"positive"});const o=[];return o.push(n.createElement(r.PlainCheckbox,{label:lf("Remember me"),onChange:this.handleRememberMeChanged})),n.createElement(r.Modal,{isOpen:e,className:"signindialog",size:"tiny",onClose:this.hide,dimmer:!0,buttons:i,actions:o,closeIcon:!0,header:lf("Sign into {0}",pxt.appTarget.appTheme.organizationText),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},n.createElement("p",null,lf("Sign in with your Microsoft Account. We'll save your projects to the cloud, where they're accessible from anywhere.")),n.createElement("p",null,lf("Don't have a Microsoft Account? Start signing in to create one!")),n.createElement(r.Link,{className:"ui",text:lf("Learn more"),icon:"external alternate",ariaLabel:lf("Learn more"),href:"/identity/sign-in",target:"_blank",onKeyDown:u.fireClickOnEnter}))}}i.LoginDialog=d;class p extends s.Component{constructor(e){super(e),this.handleDropdownClicked=()=>{const e=this.isLoggedIn(),t=this.getData("github:user");return!(!e&&!t&&(this.props.parent.showLoginDialog(this.props.continuationHash),1))},this.handleLoginClicked=()=>{this.props.parent.showLoginDialog(this.props.continuationHash)},this.handleLogoutClicked=async()=>{await s.logoutAsync()},this.handleProfileClicked=()=>{this.props.parent.showProfileDialog()},this.handleUnlinkGitHubClicked=()=>{pxt.tickEvent("menu.github.signout");const e=l.githubProvider();e&&(e.logout(),this.props.parent.forceUpdate(),o.infoNotification(lf("Signed out from GitHub...")))},this.state={}}avatarPicUrl(){var e,t,i,n;const r=this.getUserProfile();return null!==(t=null===(e=null==r?void 0:r.idp)||void 0===e?void 0:e.pictureUrl)&&void 0!==t?t:null===(n=null===(i=null==r?void 0:r.idp)||void 0===i?void 0:i.picture)||void 0===n?void 0:n.dataUrl}renderCore(){const e=this.isLoggedIn(),t=this.getUserProfile(),i=lf("User Menu"),o=n.createElement("div",{className:"signin-button"},n.createElement("div",{className:"ui text widedesktop only"},lf("Sign In")),r.genericContent({icon:"xicon cloud-user large"})),s=n.createElement("div",{className:"avatar"},n.createElement("img",{src:this.avatarPicUrl(),alt:lf("User Menu")})),a=n.createElement("div",{className:"avatar"},n.createElement("span",{className:"initials"},pxt.auth.userInitials(t))),l=this.avatarPicUrl()?s:a,c=this.getData("github:user");return n.createElement(r.DropdownMenu,{role:"menuitem",title:i,className:"item icon user-dropdown-menuitem "+(e?"logged-in-dropdown":"sign-in-dropdown"),titleContent:e?l:o,tabIndex:e?0:-1,onClick:this.handleDropdownClicked},e?n.createElement(r.Item,{role:"menuitem",text:lf("My Profile"),onClick:this.handleProfileClicked}):void 0,e?n.createElement("div",{className:"ui divider"}):void 0,c?n.createElement(r.Item,{role:"menuitem",title:lf("Unlink {0} from GitHub",c.name),onClick:this.handleUnlinkGitHubClicked},n.createElement("div",{className:"icon avatar",role:"presentation"},n.createElement("img",{className:"circular image",src:c.photo,alt:lf("User picture")})),n.createElement("span",null,lf("Unlink GitHub"))):void 0,c&&n.createElement("div",{className:"ui divider"}),e?void 0:n.createElement(r.Item,{role:"menuitem",text:lf("Sign in"),onClick:this.handleLoginClicked}),e?n.createElement(r.Item,{role:"menuitem",text:lf("Sign out"),onClick:this.handleLogoutClicked}):void 0)}}i.UserMenu=p;class h extends a.Component{static wouldRender(e){const t=c.getCloudTempMetadata(e).cloudStatus();return!!t&&"none"!==t.value&&s.hasIdentity()}renderCore(){if(!this.props.headerId)return null;const e=this.getData(`${c.HEADER_CLOUDSTATE}:${this.props.headerId}`).cloudStatus();if(!e||"none"===e.value||!s.hasIdentity())return null;const t="localEdits"===e.value,i=t||"syncing"===e.value;return n.createElement("div",{className:"cloudstatusarea"},!i&&n.createElement(r.Item,{className:"ui tiny cloudicon xicon "+e.icon,title:e.tooltip,tabIndex:-1}),i&&n.createElement(r.Item,{className:"ui tiny inline loader active cloudprogress"+(t?" indeterminate":""),title:e.tooltip,tabIndex:-1}),"none"!==e.value&&"synced"!==e.value&&n.createElement("span",{className:"ui mobile hide no-select cloudtext",role:"note"},e.shortStatus))}}i.CloudSaveStatus=h},{"./auth":20,"./cloud":26,"./cloudsync":27,"./core":78,"./data":81,"./sui":143,"./util":149,react:335}],106:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.provider=void 0;const n=e("./memoryworkspace");let r;i.provider={getAsync:function(e){return n.provider.getAsync(e)},setAsync:function(e,t,i){return n.provider.setAsync(e,t,i).then((()=>{const t=i||n.projects[e.id]&&n.projects[e.id].text;return pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspacesave",project:{header:e,text:t},response:!1})})).then((()=>{}))},listAsync:function(){return pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspacesync",response:!0}).then((e=>((e.projects||[]).forEach(n.merge),r=e.editor,pxt.tickEvent("pxt.controller",{controllerId:e.controllerId}),n.provider.listAsync())))},resetAsync:function(){return n.provider.resetAsync().then((()=>pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspacereset",response:!0}))).then((()=>{}))},loadedAsync:function(){return pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspaceloaded",response:!0}).then((()=>{}))},getSyncState:function(){return r},fireEvent:function(e){pxt.editor.postHostMessageAsync({type:"pxthost",action:"workspaceevent",response:!1,event:e})}}},{"./memoryworkspace":112}],107:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ImmersiveReaderButton=i.launchImmersiveReader=void 0;const n=e("react"),r=e("./data"),o=e("./core"),s=e("./auth"),a=e("@microsoft/immersive-reader-sdk");var l=pxt.Cloud;const c=e("./util");function u(e){const t=[function(e){return e.replace(/@boardname@/g,pxt.appTarget.appTheme.boardName||"device")},function(e){return e.replace(/(!\w*\[[^\]]*\]\w*\([^)]*\))/gu,"")},function(e){return e.replace(/\w*\[([^\]]*)\]\w*\([^)]*\)/gu,((e,t,i,n)=>lf("{0}",t)))},function(e){return e.replace(/`?`\|\|[\w|\s]+:(.+?)\|\|``?/gu,((e,t,i,n)=>lf('"{0}"',t)))},function(e){return e.replace(/``\|([^|]+)\|``/gu,((e,t,i,n)=>lf("{0}",t)))},function(e){return e.replace(pxt.tutorial.getMetadataRegex(),"")},function(e){return e.replace(/\*\*([^*^\s]+)\*\*|__([^\s^_]+)__/gu,((e,t,i,n,r)=>'"'+lf("{0}",t||i)+'"')).replace(/\*\*([^*]+)\*\*|__([^_]+)__/gu,((e,t,i,n,r)=>t?lf("{0}",t):lf("{0}",i)))},function(e){return e.replace(/\*([^*]+)\*|_([^_]+)_/gu,((e,t,i,n,r)=>lf("{0}",t||i)))},function(e){return e.replace(/[\r\n]{2,}/gmu,"<br />\n")},function(e){return e.replace(/^\* \* \*$|^- - -$|^<hr\/>$|---/gmu,"<br />")},function(e){return e.replace(/^>>/gu,"")},function(e){let t;try{t=new RegExp("\\p{Extended_Pictographic}","ug")}catch(e){}const i=[];return t?e.replace(t,((e,t,n,r)=>""==e?"":i.indexOf(e)<0?"":e)):e},function(e){return e.replace(/[]/gu,lf("{0}","A")).replace(/[]/gu,lf("{0}","B"))},function(e){return e.replace(/<(true|false|down|up|high|low|on|off|yes|no|win|lose)>/giu,((e,t,i,n)=>"`"+lf("{0}",t)+"`"))}];let i=e;return t.forEach((e=>{i=e(i)})),i}function d(e,t){pxt.tickEvent("immersiveReader.launch",{tutorial:t.tutorial,tutorialStep:t.tutorialStep});const i=r.getData(s.READER)||"",n=r.getData(s.LANGUAGE)||"",c={chunks:[{content:u(e),mimeType:"text/html"}]},d={uiLang:n,onExit:()=>{pxt.tickEvent("immersiveReader.close",{tutorial:t.tutorial,tutorialStep:t.tutorialStep})},onPreferencesChanged:e=>{s.setImmersiveReaderPrefAsync(e)},preferences:i};(function(){const e=pxt.storage.getLocal("immReader"),t=pxt.Util.jsonTryParse(e);return!t||Date.now()/1e3>t.expiration?pxt.Cloud.privateGetAsync("immreader").then((e=>(pxt.storage.setLocal("immReader",JSON.stringify(e)),e)),(e=>(pxt.storage.removeLocal("immReader"),pxt.reportException(e),pxt.tickEvent("immersiveReader.error",{error:e.statusCode,message:e.message}),e.isOffline?Promise.reject(new Error("offline")):Promise.reject(new Error("token"))))):(pxt.tickEvent("immersiveReader.cachedToken"),Promise.resolve(t))})().then((e=>function(e){return pxt.Cloud.privateGetAsync("ping").then((()=>e))}(e))).then((e=>{if(l.isOnline()){const t=pxt.Util.now();return a.launchAsync(e.token,e.subdomain,c,d).then((e=>{const i=pxt.Util.now()-t;pxt.tickEvent("immersiveReader.launch.finished",{elapsed:i})}))}return Promise.reject(new Error("offline"))})).catch((e=>{if(e.isOffline)o.warningNotification(lf("Immersive Reader cannot be used offline"));else switch(e.message){case"offline":o.warningNotification(lf("Immersive Reader cannot be used offline"));break;case"token":default:o.warningNotification(lf("Immersive Reader could not be launched")),"string"==typeof e?pxt.tickEvent("immersiveReader.error",{message:e}):pxt.tickEvent("immersiveReader.error",{message:e.message,statusCode:e.statusCode})}pxt.reportException(e),a.close()}))}i.launchImmersiveReader=d;class p extends r.Component{constructor(){super(...arguments),this.buttonClickHandler=()=>{d(this.props.content,this.props.tutorialOptions)}}render(){return n.createElement("div",{className:"immersive-reader-button ui item",onClick:this.buttonClickHandler,"aria-label":lf("Launch Immersive Reader"),role:"button",onKeyDown:c.fireClickOnEnter,tabIndex:0,title:lf("Launch Immersive Reader")})}}i.ImmersiveReaderButton=p},{"./auth":20,"./core":78,"./data":81,"./util":149,"@microsoft/immersive-reader-sdk":160,react:335}],108:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Keymap=void 0;const n=e("react"),r=e("./data");class o extends r.Component{constructor(e){super(e),this.hideKeymap=()=>{this.props.parent.showKeymap(!1)},this.setData();const t=pxt.appTarget&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.boardName.toLowerCase();this.keymap=t&&o._data[t],this.state={above:!0}}renderCore(){return n.createElement("div",{className:"keymap "+(this.state.above?"above":""),ref:"keymap"},n.createElement("i",{className:"icon large close remove circle",role:"presentation",onClick:this.hideKeymap}),this.keymap&&this.keymap.map(((e,t)=>n.createElement("div",{key:t},n.createElement("span",{className:"keymap-title"},e.title),Object.keys(e.map).map(((t,i)=>n.createElement("div",{key:i,className:"keymap-row"},e.map[t].map(((e,t)=>n.createElement("div",{className:"keymap-key",key:t},e))),n.createElement("span",{className:"keymap-name"},t))))))))}setData(){o._data||(o._data={arcade:[{title:lf("player 1"),map:{[lf("up")]:["","W"],[lf("down")]:["","S"],[lf("left")]:["","A"],[lf("right")]:["","D"],a:["Z",lf("{id:keyboard symbol}space")],b:["X",lf("{id:keyboard symbol}enter")]}},{title:lf("player 2"),map:{[lf("up")]:["I"],[lf("down")]:["K"],[lf("left")]:["J"],[lf("right")]:["L"],[lf("a")]:["U"],[lf("b")]:["O"]}}]})}}i.Keymap=o},{"./data":81,react:335}],109:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.LanguagePicker=i.setInitialLang=i.initialLang=void 0;const n=e("react"),r=e("./codecard"),o=e("./sui"),s=e("./data"),a=e("./core"),l=["en"];i.setInitialLang=function(e){i.initialLang=pxt.Util.normalizeLanguageCode(e)[0]};class c extends s.Component{constructor(e){super(e),this.state={visible:!1},this.hide=this.hide.bind(this),this.changeLanguage=this.changeLanguage.bind(this),this.translateEditor=this.translateEditor.bind(this)}languageList(){return pxt.appTarget.appTheme.selectLanguage&&pxt.appTarget.appTheme.availableLocales&&pxt.appTarget.appTheme.availableLocales.length?pxt.appTarget.appTheme.availableLocales:l}translateEditor(){pxt.tickEvent("translate.editor.incontext",void 0,{interactiveConsent:!0}),a.confirmAsync({header:lf("Translate the editor"),jsx:n.createElement("div",null,n.createElement("p",null,lf("This editor uses crowd-sourced translation! If you wish to help with translation, make sure to register as a translator.")),n.createElement("p",null,lf("'Translate' will reload the editor with in-context translations. Close the editor when done."))),helpUrl:"/translate",buttons:[{label:lf("Register"),icon:"xicon globe",className:lf("secondary"),title:lf("Register as a translator before starting the translation."),url:`https://crowdin.com/project/${pxt.appTarget.appTheme.crowdinProject}`}],agreeLbl:lf("Translate"),hasCloseIcon:!0}).then((e=>{if(e){pxt.tickEvent("translate.editor.incontext.translate");const e=window.location.href.indexOf("?")<0?"?":"&";window.location.href=window.location.pathname+(window.location.search||"")+e+"translate=1"+(window.location.hash||"")}}))}changeLanguage(e){pxt.Util.allLanguages[e]&&(e!==i.initialLang?(pxt.tickEvent("menu.lang.changelang",{lang:e}),a.setLanguage(e).then((()=>pxt.winrt.releaseAllDevicesAsync())).then((()=>{this.props.parent.reloadEditor()}))):(pxt.tickEvent("menu.lang.samelang",{lang:e}),this.hide()))}hide(){this.setState({visible:!1})}show(){this.setState({visible:!0})}renderCore(){if(!this.state.visible)return n.createElement("div",null);const e=pxt.appTarget.appTheme,t=this.languageList(),i=t.length>4?"large":"small",r=!pxt.BrowserUtils.isIE()&&!pxt.shell.isReadOnly()&&!pxt.BrowserUtils.isPxtElectron()&&pxt.appTarget.appTheme.crowdinProject,s=this.props.parent.createModalClasses();return n.createElement(o.Modal,{isOpen:this.state.visible,className:s,size:i,onClose:this.hide,dimmer:!0,header:lf("Select Language"),closeIcon:!0,allowResetFocus:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},n.createElement("div",{id:"langmodal"},n.createElement("div",{id:"availablelocales",className:"ui cards centered",role:"list","aria-label":lf("List of available languages")},t.map((e=>{const t=pxt.Util.allLanguages[e];return n.createElement(u,{key:e,langId:e,name:t.localizedName,ariaLabel:t.englishName,description:t.englishName,onClick:this.changeLanguage})}))),e.crowdinProject?n.createElement("div",{className:"ui",id:"langmodalfooter"},n.createElement(o.Link,{"aria-label":lf("How do I add a new language?"),href:"/translate",text:lf("How do I add a new language?"),target:"_blank"}),r&&n.createElement(o.Button,{"aria-label":lf("Translate the editor"),onClick:this.translateEditor,text:lf("Translate the editor")})):void 0))}}i.LanguagePicker=c;class u extends o.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){this.props.onClick(this.props.langId)}renderCore(){const{name:e,ariaLabel:t,description:i}=this.props;return n.createElement(r.CodeCardView,{className:"card-selected langoption",name:e,ariaLabel:t,role:"listitem",description:i,onClick:this.handleClick})}}},{"./codecard":29,"./core":78,"./data":81,"./sui":143,react:335}],110:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.makeAsync=void 0;const n=e("react"),r=e("./package"),o=e("./core"),s=e("./compiler"),a="instructions";function l(e){return function(e){return new Promise(((t,i)=>{window.addEventListener("message",(function e(i){const n=i.data;"ready"==n.type&&n.frameid==a&&(window.removeEventListener("message",e),t())})),e.src=pxt.webConfig.partsUrl+"#"+a}))}(e).then((()=>s.compileAsync({native:!0}))).then((t=>{const i=r.mainEditorPkg().header.name||lf("Untitled"),n=pxt.appTarget.simulator.boardDefinition,o=ts.pxtc.computeUsedParts(t).sort(),s=r.mainPkg.computePartDefinitions(o),a=t.usedArguments;let l={},c={};for(let e of t.configData||[])l[e.key+""]=e.value,c[e.name]=e.key;const u={cfg:l,cfgKey:c};return e.contentWindow.postMessage({type:"instructions",options:{name:i,boardDef:n,parts:o,partDefinitions:s,fnArgs:a,configData:u,print:!0}},"*"),e}))}i.makeAsync=function(){return o.dialogAsync({header:lf("Make"),size:"large",hasCloseIcon:!0,jsx:n.createElement("div",{className:"ui container"},n.createElement("div",{id:"makecontainer",style:{position:"relative",height:0,paddingBottom:"40%",overflow:"hidden"}},n.createElement("iframe",{id:"makeiframe",frameBorder:"0",sandbox:"allow-popups allow-forms allow-scripts allow-same-origin allow-modals",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"}}))),onLoaded:e=>{l(e.querySelectorAll("#makeiframe")[0])}}).then((e=>{}))}},{"./compiler":30,"./core":78,"./package":122,react:335}],111:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MarkedContent=void 0;const n=e("react"),r=e("./data"),o=e("marked"),s=e("./compiler");class a extends r.Component{constructor(){super(...arguments),this.semanticIconNames=["flipped","horizontally","vertically","rotated","counterclockwise","access","accessible","accusoft","add","address","adjust","adn","adversal","affiliatetheme","aid","alarm","ald","algolia","alien","align","all","alphabet","als","alt","alternate","alternative","amazon","ambulance","american","amex","amilia","amount","anchor","and","android","angellist","angle","angrycreative","angular","announcement","app","apper","apple","archive","area","arrow","arrows","ascending","asexual","asl","assistive","asterisk","asymmetrik","at","attach","attention","audible","audio","autoprefixer","avianex","aviato","awesome","aws","backward","badge","bag","balance","ball","ban","band","bandcamp","bar","barcode","bars","baseball","basket","basketball","bath","bathtub","battery","bed","beer","beginner","behance","bell","bicycle","bill","bimobject","binary","binoculars","birthday","bishop","bitbucket","bitcoin","bity","black","blackberry","blind","block","blogger","bluetooth","board","bold","bolt","bomb","book","bookmark","bowling","box","boxes","braille","branch","briefcase","broken","browser","brush","btc","bug","building","bullhorn","bullseye","bureau","buromobelexperte","bus","buysellads","cake","calculator","calendar","call","camera","camp","cancel","cap","captioning","car","card","caret","cart","cc","center","centercode","certificate","chain","chart","chat","check","checked","checkered","checkmark","chess","chevron","child","chrome","circle","clipboard","clock","clone","close","closed","cloud","cloudscale","cloudsmith","cloudversify","club","cny","cocktail","code","codepen","codiepie","coffee","cog","cogs","columns","combinator","comment","commenting","comments","commons","compass","compose","compress","computer","configure","connectdevelop","contao","content","control","conversation","copy","copyright","cord","cpanel","creative","credit","crop","crosshairs","css3","cube","cubes","currency","cursor","cut","cuttlefish","dashboard","dashcube","database","deaf","deafness","delete","delicious","deploydog","descending","description","deskpro","desktop","detective","deviantart","devices","diamond","digg","digital","diners","discord","discourse","discover","discussions","disk","dna","dochub","docker","doctor","dollar","dolly","dont","dot","double","down","download","draft2digital","dribbble","dribble","drive","drivers","dropbox","dropdown","dropper","drupal","dyalog","earlybirds","edge","edit","eercast","eject","elementor","ellipsis","ember","emergency","empire","empty","end","envelope","envira","erase","eraser","erlang","ethereum","etsy","eur","euro","excel","exchange","exclamation","expand","expeditedssl","explorer","express","external","extinguisher","eye","eyedropper","facebook","factory","fast","favorite","fax","feed","female","fi","fighter","file","film","filter","find","fire","firefox","first","firstdraft","five","flag","flask","flatbed","flickr","flipboard","fly","folder","font","fonticons","food","football","fork","forms","fort","forumbee","forward","four","foursquare","framework","free","freebsd","from","frown","full","futbol","gallery","game","gavel","gay","gbp","gem","gender","genderless","get","gg","ghost","gift","git","github","gitkraken","gitlab","gitter","gittip","glass","glide","globe","gofore","golf","goodreads","google","grab","graduation","graph","gratipay","grav","grid","gripfire","group","grunt","gulp","hacker","half","hand","handicap","handshake","hard","hash","hashtag","hat","hdd","header","heading","headphones","hearing","heart","heartbeat","height","help","helper","heterosexual","hide","high","hips","hire","history","hockey","home","homosexual","hooli","horizontal","hospital","hotel","hotjar","hourglass","houzz","html5","hubspot","hundred","hunt","id","idea","ils","image","images","imdb","in","in-cart","inbox","indent","industry","info","inr","instagram","intergender","international","internet","interpreting","intersex","ios","ioxhost","isle","italic","itunes","japan","jcb","jenkins","jet","joget","joomla","jpy","js","jsfiddle","justify","key","keyboard","keycdn","kickstarter","king","knight","korvue","krw","lab","language","laptop","laravel","large","lastfm","law","layout","leaf","leanpub","left","legal","lemon","lesbian","less","level","license","life","lightbulb","lightning","like","line","linechat","linkedin","linkify","linode","linux","lira","list","listening","lizard","location","lock","log","logout","long","low","lyft","magento","magic","magnet","magnify","mail","male","man","map","marker","mars","martini","mastercard","maxcdn","maximize","md","meanpath","medapps","medium","medkit","medrt","meetup","meh","mercury","messenger","microchip","microphone","microsoft","military","minimize","minus","mix","mixcloud","mizuni","mobile","modx","monero","money","monster","moon","motorcycle","mouse","move","ms","mule","music","mute","napster","neuter","new","news","newspaper","nintendo","node","non","notch","notched","note","npm","ns8","numbered","numeric","nutritionix","object","ocean","odnoklassniki","of","off","official","ol","on","one","open","opencart","openid","opera","optin","optinmonster","options","order","ordered","osi","other","out","outdent","outline","overflow","page4","pagelines","paint","palfed","pallet","paper","paperclip","paragraph","paste","patreon","pause","paw","pawn","pay","payment","paypal","pdf","peace","pen","pencil","percent","periscope","phabricator","phoenix","phone","photo","php","picture","pie","piece","pied","pills","pin","pinterest","piper","pixels","plane","play","playstation","play","plug","plus","pocket","podcast","point","pointer","pointing","pound","power","powerpoint","pp","print","privacy","product","protect","puck","pushed","puzzle","python","qq","qrcode","quarter","quarters","queen","question","quidditch","quinscape","quora","quote","radio","rain","random","ravelry","react","rebel","record","rectangle","recycle","reddit","redo","redriver","refresh","registered","remove","rendact","renren","repeat","reply","replyd","resize","resolving","restore","retro","retweet","right","ring","rmb","road","rock","rocket","rocketchat","rockrms","rook","rouble","rss","rub","ruble","rupee","s15","safari","sass","save","scale","schlix","scissors","scribd","search","searchengin","secret","selected","sellcast","sellsy","send","server","servicestack","setting","settings","share","shekel","sheqel","shield","ship","shipping","shirtsinbulk","shop","shopping","shower","shuffle","shutdown","shuttle","sidebar","sign","sign-in","sign-out","signal","signing","signs","signup","simple","simplybuilt","sistrix","sitemap","skyatlas","skype","slack","slash","sliders","slideshare","smile","snapchat","snowflake","soccer","sort","sound","soundcloud","space","speakap","spinner","spock","spoon","spotify","spy","square","stack","star","start","staylinked","steam","step","stethoscope","sticker","sticky","stop","stopwatch","store","strava","street","strikethrough","stripe","stroke","student","studiovinari","stumbleupon","subscript","subway","suitcase","sun","superpowers","superscript","supple","switch","symbol","sync","syringe","systems","table","tablet","tachometer","tack","tag","tags","talk","target","tasks","taxi","telegram","telephone","teletype","television","tencent","tennis","terminal","text","th","theme","themeisle","thermometer","thin","three","thumb","thumbs","thumbtack","ticket","tie","time","times","tint","tm","to","toggle","trademark","train","transgender","translate","trash","travel","treatment","tree","trello","triangle","tripadvisor","trophy","truck","try","tumblr","tv","twitch","twitter","two","uber","uikit","ul","umbrella","underline","undo","ungroup","unhide","uniregistry","universal","university","unlink","unlinkify","unlock","unmute","unordered","untappd","up","upload","usb","usd","user","users","ussunnah","utensil","utensils","vaadin","vcard","venus","vertical","viacoin","viadeo","viber","victory","video","view","vimeo","vine","visa","vision","vk","vnv","volleyball","volume","vuejs","wait","wallet","warehouse","warning","wechat","weibo","weight","weixin","whatsapp","wheelchair","whmcs","wi-fi","width","wifi","wikipedia","window","windows","winner","wizard","woman","won","word","wordpress","world","wpbeginner","wpexplorer","wpforms","wrench","write","xbox","xing","yahoo","yandex","yc","ycombinator","yelp","yen","yoast","youtube","zero","zip","zoom","zoom-in","zoom-out"],this.customIconNames=["blocks","js","python","toolbox","book-reader","photo-video","gamepad"]}static clearBlockSnippetCache(){this.blockSnippetCache={}}getBuiltinMacros(){const e={},t=pxt.appTarget.appTheme;return t.boardName&&(e.boardname=pxt.Util.htmlEscape(t.boardName)),t.boardNickname&&(e.boardnickname=pxt.Util.htmlEscape(t.boardNickname)),t.driveDisplayName&&(e.drivename=pxt.Util.htmlEscape(t.driveDisplayName)),t.homeUrl&&(e.homeurl=pxt.Util.htmlEscape(t.homeUrl)),e.targetid=t.id||"???",e.targetname=t.name||"Microsoft MakeCode",e.targetlogo=t.docsLogo?`<img aria-hidden="true" role="presentation" class="ui mini image" src="${t.docsLogo}" />`:"",e}startRenderLangSnippet(e){const{unboxSnippets:t}=this.props,i=e.parentElement,n=i.parentElement,r=document.createElement("div");return r.className=`ui ${t?"":"segment raised "}loading codewidget`,n.insertBefore(r,i),n.removeChild(i),r}finishRenderLangSnippet(e,t){if("string"==typeof t){let e=document.createElement("code");e.className="hljs",e.textContent=t,pxt.tutorial.highlight(e),t=e}e.appendChild(t),pxsim.U.removeClass(e,"loading")}cachedRenderLangSnippetAsync(e,t){const i=e.textContent,n=this.startRenderLangSnippet(e);return a.blockSnippetCache[i]?void this.finishRenderLangSnippet(n,a.blockSnippetCache[i]):t(i).then((e=>{a.blockSnippetCache[i]=e,this.finishRenderLangSnippet(n,a.blockSnippetCache[i])})).catch((e=>{pxt.reportException(e),this.finishRenderLangSnippet(n,lf("Something changed."))}))}renderSnippets(e){const{parent:t,unboxSnippets:i,onDidRender:n,blocksDiffOptions:r,textDiffOptions:o}=this.props;let l=[];function c(e){const t=e.svg;if(t){if("SVG"==t.tagName){const e=t.getAttribute("viewBox").split(" ").map(parseFloat),i=e[2];let n=e[3];(i>480||n>128)&&(n=.8*n|0),t.setAttribute("height",`${n}px`)}return t}{const t=document.createElement("div");return t.className="ui basic segment",t.textContent=e.message||lf("No changes."),t}}function u(e,n){const r=e.textContent,o=document.createElement("div");pxsim.U.clear(e),e.appendChild(o),o.className=`ui ${i?"":"segment raised "} loading`;const s={type:"pxteditor",action:"renderblocks",ts:r,snippetMode:n},c=JSON.stringify(s);if(a.blockSnippetCache[c]){const e=a.blockSnippetCache[c],t=Blockly.utils.xml.textToDomDocument(pxt.blocks.layout.serializeSvgString(e));o.appendChild(t.documentElement),pxsim.U.removeClass(o,"loading")}else l.push(t.renderBlocksAsync(s).then((e=>{const t=e.svg;if(t){const e=t.getAttribute("viewBox").split(" ").map(parseFloat),i=e[2];let n=e[3];(i>480||n>128)&&(n=.8*n|0),t.setAttribute("height",`${n}px`),pxt.BrowserUtils.isIE()||(a.blockSnippetCache[c]=Blockly.Xml.domToText(t)),o.appendChild(t),pxsim.U.removeClass(o,"loading")}else{const e=document.createElement("span");e.textContent=lf("Oops, something went wrong trying to render this block snippet."),o.appendChild(e),pxsim.U.removeClass(o,"loading")}})))}pxt.Util.toArray(e.querySelectorAll("img")).forEach((e=>{l.push(new Promise(((t,i)=>{e.addEventListener("load",(()=>t()),!1),e.addEventListener("error",(()=>t()),!1)})))})),pxt.Util.toArray(e.querySelectorAll("code.lang-typescript,code.lang-python")).forEach((e=>{const t=e.textContent,i=this.startRenderLangSnippet(e);this.finishRenderLangSnippet(i,t)})),pxt.Util.toArray(e.querySelectorAll("code.lang-spy")).forEach((e=>{l.push(this.cachedRenderLangSnippetAsync(e,(e=>t.renderPythonAsync({type:"pxteditor",action:"renderpython",ts:e}).then((e=>e.python)))))})),pxt.Util.toArray(e.querySelectorAll("code.lang-diffspy")).forEach((e=>{l.push(this.cachedRenderLangSnippetAsync(e,(e=>{const{fileA:i,fileB:n}=pxt.diff.split(e);return pxt.Util.promiseMapAllSeries([i,n],(e=>t.renderPythonAsync({type:"pxteditor",action:"renderpython",ts:e}).then((e=>e.python)))).then((e=>pxt.diff.render(e[0],e[1],o||{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0})))})))})),pxt.Util.toArray(e.querySelectorAll("code.lang-diff,code.lang-diffpython")).forEach((e=>{l.push(this.cachedRenderLangSnippetAsync(e,(e=>{const{fileA:t,fileB:i}=pxt.diff.split(e),n=pxt.diff.render(t,i,o||{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0});return Promise.resolve(n)})))})),pxt.Util.toArray(e.querySelectorAll("code.lang-blocks")).forEach((e=>u(e,!1))),pxt.Util.toArray(e.querySelectorAll("code.lang-block")).forEach((e=>u(e,!0))),pxt.Util.toArray(e.querySelectorAll("code.lang-diffblocksxml")).forEach((e=>{const t=e.textContent,{fileA:i,fileB:n}=pxt.diff.split(t);l.push(this.cachedRenderLangSnippetAsync(e,(e=>pxt.BrowserUtils.loadBlocklyAsync().then((()=>c(pxt.blocks.diffXml(i,n,r)))))))})),pxt.Util.toArray(e.querySelectorAll("code.lang-diffblocks")).forEach((e=>{const t=e.textContent,{fileA:i,fileB:n}=pxt.diff.split(t);l.push(this.cachedRenderLangSnippetAsync(e,(e=>pxt.BrowserUtils.loadBlocklyAsync().then((()=>s.getBlocksAsync())).then((e=>pxt.Util.promiseMapAllSeries([i,n],(t=>s.decompileBlocksSnippetAsync(t,e))))).then((e=>pxt.blocks.decompiledDiffAsync(i,e[0],n,e[1],r||{hideDeletedTopBlocks:!0,hideDeletedBlocks:!0}))).then((e=>c(e))))))})),(l=l.filter((e=>!!e))).length&&n&&Promise.all(l).then((()=>{pxt.log("markdowcontent: forcing update after async rendering"),n()}))}renderInlineBlocks(e){pxt.Util.toArray(e.querySelectorAll(":not(pre) > code")).forEach((e=>{const t=e.innerText,i=/^(\|+)([^\|]+)\|+$/.exec(t);if(i){const t=/^(([^\:\.]*?)[\:\.])?(.*)$/.exec(i[2]),n=t[2]?t[2].trim().toLowerCase():"",r=t[3].trim(),o=1==i[1].length?`docs inlinebutton ui button ${pxt.Util.htmlEscape(r.toLowerCase())}-button`:`docs inlineblock ${pxt.Util.htmlEscape(n)}`,s=document.createElement("span");pxsim.U.clear(e),e.appendChild(s),s.className=o,s.textContent=pxt.U.rlf(r)}}))}renderBullets(e){const t=/^:([^:]+):/i;pxt.Util.toArray(e.querySelectorAll("li")).forEach((e=>{const i=e.innerHTML.match(t);if(null==i?void 0:i[1]){const t=document.createElement("p");pxt.Util.toArray(e.childNodes).forEach((e=>t.appendChild(e))),e.appendChild(t)}})),pxt.Util.toArray(e.querySelectorAll("li > p")).forEach((e=>{const i=e.innerText.match(t);if(null==i?void 0:i[1]){const n=pxt.Util.toArray(e.childNodes).find((e=>"#text"===e.nodeName));(null==n?void 0:n.nodeValue)&&(n.nodeValue=n.nodeValue.replace(t,""));const r=e.parentElement;r.className+=" formatted-bullet-li";const o=r.parentElement;o.classList.contains("formatted-bullet-ul")||(o.className+=" formatted-bullet-ul");const s=document.createElement("div");s.className="formatted-bullet";const a=document.createElement("i");let l=i[1].split(" "),c=l.filter((e=>this.semanticIconNames.indexOf(e)>=0));c.length?a.className=`ui icon ${c.join(" ")}`:(c=l.filter((e=>this.customIconNames.indexOf(e)>=0)),a.className=`ui xicon ${c.join(" ")}`),s.appendChild(a),r.insertBefore(s,e)}}))}renderOthers(e){pxt.Util.toArray(e.querySelectorAll(".lang-package,.lang-config,.lang-apis")).forEach((e=>{e.parentNode.removeChild(e)}))}renderMarkdown(e){const t=this.refs["marked-content"],i=this.getBuiltinMacros();if(!e)return;pxt.perf.measureStart("renderMarkdown"),e=e.replace(/@([a-z]+)@/gi,((e,t)=>i[t]||"unknown macro"));let n=new o.Renderer;pxt.docs.setupRenderer(n);const r=n.link;n.link=function(e,t,i){const o=/^[\/#]/.test(e)?"":"_blank";return r.call(n,e,t,i).replace(/^<a /,`<a ${o?`target="${o}"`:""} rel="nofollow noopener" `)},o.setOptions({renderer:n,sanitize:!0,sanitizer:pxt.docs.requireDOMSanitizer()}),e=e.replace(/<\s*script[^>]*>.*<\/\s*script[^>]*>/gi,"");const s=document.createElement("div");s.innerHTML=o(e),this.renderInlineBlocks(s),this.renderSnippets(s),this.renderBullets(s),this.renderOthers(s),t.innerHTML="",t.append(...s.childNodes),pxt.perf.measureEnd("renderMarkdown")}componentDidMount(){const{markdown:e}=this.props;this.renderMarkdown(e)}UNSAFE_componentWillReceiveProps(e){const{markdown:t}=e;this.props.markdown!=e.markdown&&this.renderMarkdown(t)}renderCore(){const{className:e,tabIndex:t}=this.props;return n.createElement("div",{ref:"marked-content",className:e||"",tabIndex:t})}}i.MarkedContent=a,a.blockSnippetCache={}},{"./compiler":30,"./data":81,marked:245,react:335}],112:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.provider=i.merge=i.projects=void 0;var n=pxt.Util;i.projects={},i.merge=function(e){let t=e.header;t||(e.header=t=pxt.workspace.freshHeader(lf("Untitled"),n.nowSeconds()),e.text&&e.text[pxt.MAIN_BLOCKS]&&(e.header.editor=pxt.BLOCKS_PROJECT_NAME)),i.projects[e.header.id]=e},i.provider={getAsync:function(e){let t=i.projects[e.id];return Promise.resolve({header:e,text:t?t.text:{},version:null})},setAsync:function(e,t,n){return n&&(i.projects[e.id]={header:e,text:n}),Promise.resolve()},deleteAsync:function(e,t){return delete i.projects[e.id],Promise.resolve()},listAsync:function(){return Promise.resolve(n.values(i.projects).map((e=>e.header)))},resetAsync:function(){return i.projects={},Promise.resolve()}}},{}],113:[function(e,t,i){"use strict";function n(e,t){var i;if(!e)return t;if(!t)return e;const n=JSON.parse(e),r=JSON.parse(t),o={},s={},a={},l={},c={},u=r["*"].mimeType;for(const e of Object.keys(r)){if("*"===e)continue;const t=r[e];let i;a[e]=!0;let n=u,l=!1;"string"==typeof t?i=t:(i=t.data,n=t.mimeType,l=!!t.tilemapTile,t.displayName&&(s[t.displayName]=!0)),n!==pxt.TILEMAP_MIME_TYPE&&(o[n+l+i]=e)}for(const e of Object.keys(n)){if("*"===e)continue;const t=n[e];let i,d,p=u,h=!1,f=!1;"string"==typeof t?(i=t,f=!0):(i=t.data,d=t.displayName,p=t.mimeType,h=!!t.tilemapTile);const m=p+h+i;if(o[m]){h&&(l[pxt.sprite.TILE_NAMESPACE+"."+e]=pxt.sprite.TILE_NAMESPACE+"."+o[m]);continue}if(!d)switch(p){case pxt.IMAGE_MIME_TYPE:d=h?`${pxt.sprite.TILE_NAMESPACE}.${pxt.sprite.TILE_PREFIX}`:`${pxt.sprite.IMAGES_NAMESPACE}.${pxt.sprite.IMAGE_PREFIX}`;break;case pxt.TILEMAP_MIME_TYPE:d="tilemap";break;case pxt.ANIMATION_MIME_TYPE:d=`${pxt.sprite.ANIMATION_NAMESPACE}.${pxt.sprite.ANIMATION_PREFIX}`}if(d&&s[d]){let e=0;for(;s[d+e];)e++;s[d+=e]=!0}let g=e;if(a[g]){let t=0;for(;a[g+t];)t++;a[g+=t]=!0,h&&(l[pxt.sprite.TILE_NAMESPACE+"."+e]=pxt.sprite.TILE_NAMESPACE+"."+g)}p!==pxt.TILEMAP_MIME_TYPE&&(o[m]=e);const b=Object.assign(Object.assign({},f?{}:n[e]),{data:i,displayName:d,mimeType:p});b.id&&(b.id=g),p===pxt.TILEMAP_MIME_TYPE?c[g]=b:r[g]=b}for(const e of Object.keys(c)){const t=c[e];t.tileset=null===(i=t.tileset)||void 0===i?void 0:i.map((e=>l[e]||e)),r[e]=t}return JSON.stringify(r)}function r(e,t){if(!e)return t;let i=pxt.U.jsonTryParse(t)||{};i["*"]||(i["*"]={mimeType:"image/x-mkcd-f4",dataEncoding:"base64",namespace:pxt.sprite.IMAGES_NAMESPACE});let n=0;return function(e){const t=[];return e.replace(/<field name=\"[\da-zA-Z]+\">\s*(img`[\s\da-f.#tngrpoyw]+`)\s*<\/field>/gim,((e,i)=>{var n;const r=null===(n=pxt.sprite.imageLiteralToBitmap(i))||void 0===n?void 0:n.data();return r&&t.push(r),e})),t}(e).forEach((e=>{const t=pxt.Util.guidGen();for(;i[`${pxt.sprite.IMAGES_NAMESPACE}.${pxt.sprite.IMAGE_PREFIX}${n}`];)n++;i[t]={data:pxt.sprite.base64EncodeBitmap(e),mimeType:pxt.IMAGE_MIME_TYPE,displayName:`${pxt.sprite.IMAGES_NAMESPACE}.${pxt.sprite.IMAGE_PREFIX}${n}`},n++})),n=0,function(e){const t=[];return e.replace(/<field name=\"[\da-zA-Z]+\">\s*\[((?:img`[\s\da-f.#tngrpoyw]+`,?)+)\]\s*<\/field>(?:.*<shadow type=\"timePicker\"><field name=\"ms\">(\d+)<\/field><\/shadow>)?/gim,((e,i,n)=>{const r=i.split(",").map((e=>{var t;return null===(t=pxt.sprite.imageLiteralToBitmap(e))||void 0===t?void 0:t.data()}));return t.push({frames:r.filter((e=>!!e)),interval:n||500}),e})),t}(e).forEach((e=>{const t=pxt.Util.guidGen();for(;i[`${pxt.sprite.ANIMATION_NAMESPACE}.${pxt.sprite.ANIMATION_NAMESPACE}${n}`];)n++;i[t]={data:pxt.sprite.encodeAnimationString(e.frames,e.interval),mimeType:pxt.ANIMATION_MIME_TYPE,displayName:`${pxt.sprite.ANIMATION_NAMESPACE}.${pxt.sprite.ANIMATION_PREFIX}${n}`},n++})),JSON.stringify(i)}Object.defineProperty(i,"__esModule",{value:!0}),i.appendTemporaryAssets=i.mergeProjectCode=void 0,i.mergeProjectCode=function(e,t,i){var o,s;const a=t[pxt.CONFIG_NAME],l=pxt.U.jsonTryParse(a),c=i?n(t[pxt.TILEMAP_JRES],e[pxt.TILEMAP_JRES]):n(e[pxt.TILEMAP_JRES],t[pxt.TILEMAP_JRES]),u=i?n(t[pxt.IMAGES_JRES],e[pxt.IMAGES_JRES]):n(r(e[pxt.MAIN_BLOCKS],e[pxt.IMAGES_JRES]),t[pxt.IMAGES_JRES]);return c&&(null===(o=null==l?void 0:l.files)||void 0===o?void 0:o.indexOf(pxt.TILEMAP_JRES))<0&&l.files.push(pxt.TILEMAP_JRES),u&&(null===(s=null==l?void 0:l.files)||void 0===s?void 0:s.indexOf(pxt.IMAGES_JRES))<0&&l.files.push(pxt.IMAGES_JRES),Object.assign(Object.assign({},t),{[pxt.MAIN_TS]:i?e[pxt.MAIN_TS]:t[pxt.MAIN_TS],[pxt.MAIN_PY]:i?e[pxt.MAIN_PY]:t[pxt.MAIN_PY],[pxt.MAIN_BLOCKS]:i?e[pxt.MAIN_BLOCKS]:t[pxt.MAIN_BLOCKS],[pxt.TILEMAP_JRES]:c,[pxt.IMAGES_JRES]:u,[pxt.CONFIG_NAME]:JSON.stringify(l)})},i.appendTemporaryAssets=r},{}],114:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.rangeToSelection=i.Editor=void 0;const n=e("react"),r=e("react-dom"),o=e("./package"),s=e("./core"),a=e("./toolboxeditor"),l=e("./compiler"),c=e("./monacoSnippets"),u=e("./monacopyhelper"),d=e("./simulator"),p=e("./toolbox"),h=e("./blocklyFieldView"),f=e("./monacoFieldEditorHost"),m=e("./data");var g=pxt.Util;const b=e("./monacoDebugger"),v=e("./debuggerToolbox"),y=e("./monacoEditAmendments"),k=e("./monacoFlyout"),w=e("./errorList"),x=e("./auth");class E{constructor(e,t){this.editor=e,this.python=t,this.triggerCharacters=["(","."],this.kindMap={}}tsKindToMonacoKind(e){switch(e){case 1:return monaco.languages.CompletionItemKind.Method;case 2:return monaco.languages.CompletionItemKind.Property;case 3:return monaco.languages.CompletionItemKind.Function;case 4:return monaco.languages.CompletionItemKind.Variable;case 5:return monaco.languages.CompletionItemKind.Module;case 6:return monaco.languages.CompletionItemKind.Class;case 7:return monaco.languages.CompletionItemKind.Enum;case 8:return monaco.languages.CompletionItemKind.Class;case 9:return monaco.languages.CompletionItemKind.Interface;default:return monaco.languages.CompletionItemKind.Text}}provideCompletionItems(e,t,i,n){const r=e.getOffsetAt(t),o=e.getValue(),s=this.editor.currFile.name,a=e.getWordUntilPosition(t),c=e.getOffsetAt({lineNumber:t.lineNumber,column:a.startColumn}),u=e.getOffsetAt({lineNumber:t.lineNumber,column:a.endColumn});return l.completionsAsync(s,r,c,u,o,pxt.options.light).then((i=>{function n(e){if(!e)return e;for(let t of i.namespace){if(!e.startsWith(t+"."))break;e=e.substr((t+".").length)}return e}let r=i.entries||[];return{suggestions:(r=r.filter((e=>"_"!=e.name.charAt(0)))).map(((r,o)=>{let s=this.python?r.pySnippetWithMarkers:r.snippetWithMarkers;const a=!!s,l=this.python?r.pySnippet:r.snippet;let c=a?s:l;c=n(c);let u=n(this.python?r.pyQName:r.qName),p=this.python?r.pyName:r.name,h=c&&c.indexOf("\n")>=0;if(this.python&&c&&h&&pxt.blocks.hasHandler(r))c=y.amendmentToInsertSnippet(y.createLineReplacementPyAmendment(c));else if(c=c||u,i.isMemberCompletion&&c){const e=c.lastIndexOf(p);-1!==e&&(c=c.substr(e))}const f=i.isMemberCompletion?p:u,m=pxt.Util.rlf(r.attributes.jsDoc),g=pxt.Util.rlf(r.attributes.block),b=e.getWordAtPosition(t),v={startLineNumber:t.lineNumber,startColumn:b?b.startColumn:t.column,endColumn:t.column,endLineNumber:t.lineNumber},k=`${f},${m},${g}`.replace(/\s/g,","),w=this.tsKindToMonacoKind(r.kind);return{label:f,range:v,kind:w,documentation:m,detail:`(${monaco.languages.CompletionItemKind[w].toLowerCase()}) ${l||""}`,sortText:`${d(o)} ${c}`,filterText:k,insertText:c||void 0,insertTextRules:a?monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet:void 0}}))}}));function d(e){return("000"+e).slice(-4)}}}class C{constructor(e,t){this.editor=e,this.python=t,this.signatureHelpTriggerCharacters=["(",","],this.isPython=!1,this.isPython=t}provideSignatureHelp(e,t,i,n){const r=e.getOffsetAt(t),o=e.getValue(),s=this.editor.currFile.name;return l.syntaxInfoAsync("signature",s,r,o).then((e=>{let t=e.symbols?e.symbols[0]:null;if(!t||!t.parameters)return null;const i=pxt.Util.rlf(t.attributes.jsDoc);let n=t.parameters.map((e=>({label:`${e.name}: ${this.isPython?e.pyTypeString:e.type}`,documentation:pxt.Util.rlf(e.description)})));return{value:{signatures:[{label:`${this.isPython&&t.pyName?t.pyName:t.name}(${n.map((e=>e.label)).join(", ")})`,documentation:i,parameters:n}],activeSignature:0,activeParameter:e.auxResult},dispose:()=>{}}}))}}class S{constructor(e,t){this.editor=e,this.python=t}provideHover(e,t,i){if(this.editor.hasInsertionSnippet())return null;const n=e.getOffsetAt(t),r=e.getValue(),o=this.editor.currFile.name;return l.syntaxInfoAsync("symbol",o,n,r).then((t=>{let i,n=t.symbols?t.symbols[0]:null;if(n){const e=pxt.Util.rlf(n.attributes.jsDoc);i=[t.auxResult[0],e]}else t.auxResult&&(i=[t.auxResult.displayString,t.auxResult.documentation]);return i?{contents:i.map(_),range:monaco.Range.fromPositions(e.getPositionAt(t.beginPos),e.getPositionAt(t.endPos))}:null}))}}function _(e){return{value:e}}const T={comments:{lineComment:"#",blockComment:['"""','"""']},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"',notIn:["string"]},{open:'r"',close:'"',notIn:["string","comment"]},{open:'R"',close:'"',notIn:["string","comment"]},{open:'u"',close:'"',notIn:["string","comment"]},{open:'U"',close:'"',notIn:["string","comment"]},{open:'f"',close:'"',notIn:["string","comment"]},{open:'F"',close:'"',notIn:["string","comment"]},{open:'b"',close:'"',notIn:["string","comment"]},{open:'B"',close:'"',notIn:["string","comment"]},{open:"'",close:"'",notIn:["string","comment"]},{open:"r'",close:"'",notIn:["string","comment"]},{open:"R'",close:"'",notIn:["string","comment"]},{open:"u'",close:"'",notIn:["string","comment"]},{open:"U'",close:"'",notIn:["string","comment"]},{open:"f'",close:"'",notIn:["string","comment"]},{open:"F'",close:"'",notIn:["string","comment"]},{open:"b'",close:"'",notIn:["string","comment"]},{open:"B'",close:"'",notIn:["string","comment"]},{open:"`",close:"`",notIn:["string"]}],onEnterRules:[{beforeText:/^\s*(?:def|class|for|if|elif|else|while|try|with|finally|except|async).*?:\s*$/,action:{indentAction:1}}]};class A{constructor(e,t){this.editor=e,this.python=t,this.isPython=!1,this.isPython=t}provideDocumentRangeFormattingEdits(e,t,i,n){return Promise.resolve().then((r=>this.isPython?u.provideDocumentRangeFormattingEdits(e,t,i,n):null))}}const N={cpp:"cpp",h:"cpp",json:"json",md:"markdown",py:"python",ts:"typescript",js:"javascript",svg:"xml",blocks:"xml",asm:"asm"};class I extends a.ToolboxEditor{constructor(e){super(e),this.fileType="text",this.giveFocusOnLoading=!0,this.foldFieldEditorRanges=!0,this.hasFieldEditors=!(!pxt.appTarget.appTheme.monacoFieldEditors||!pxt.appTarget.appTheme.monacoFieldEditors.length),this.highlightDecorations=[],this.errorChangesListeners={},this.exceptionChangesListeners={},this.userPreferencesSubscriber={subscriptions:[],onDataChanged:()=>{this.onUserPreferencesChanged()}},this.handleFlyoutWheel=e=>e.stopPropagation(),this.handleFlyoutScroll=e=>e.stopPropagation(),this.insertSnippet=(e,t,i=!1)=>{let n=this.editor.getPosition(),r=this.editor.getModel();if(e||(e=n),!e)return;let o,s=e.clone();"NewLineAfter"==(o=i?"Inline":1===e.column?"NewLineBefore":"NewLineAfter")&&(s=s.with(s.lineNumber,r.getLineMaxColumn(e.lineNumber)));const a=r.getLineContent(e.lineNumber);"Inline"===o||!a||("NewLineAfter"===o?t="\n"+t:t+="\n");const l=e=>{let t=e.match(/^\s*/)[0]||"";return t=t.replace("\t"," ".repeat(4)),Math.floor(t.length/4)},c=l(a);let u;if("NewLineAfter"===o){const t=Math.min(e.lineNumber+1,r.getLineCount()),i=l(r.getLineContent(t));u=Math.max(c,i)}else u="NewLineBefore"===o?c:0;const d=" ".repeat(4*u);if(d){let e=t.split("\n");t=(e=e.map((e=>e?d+e:e))).join("\n")}this.editor.pushUndoStop(),this.editor.executeEdits("",[{range:new monaco.Range(s.lineNumber,s.column,s.lineNumber,s.column),text:t||"",forceMoveMarkers:!0}]),this.beforeCompile(),this.editor.pushUndoStop(),this.editor.focus()},this.dragCurrentPos={x:0,y:0},this.onDragBlockThrottled=g.throttle((()=>{const{x:e,y:t}=this.dragCurrentPos;let i=this.editor.getTargetAtClientPoint(e,t);i&&i.position&&this.editor.getPosition()!=i.position&&this.editor.setPosition(i.position),this.editor.focus()}),200),this.onPointerMove=e=>{this.insertionSnippet&&(this.dragCurrentPos={x:pxt.BrowserUtils.getClientX(e),y:pxt.BrowserUtils.getClientY(e)},this.onDragBlockThrottled(e))},this.onPointerUp=e=>{let t=this.insertionSnippet;if(this.setInsertionSnippet(void 0),t){let i=pxtc.U.startsWith(t,"inline:1&");i&&(t=t.substring("inline:1&".length));let n=Promise.resolve(t);if(pxtc.U.startsWith(t,"qName:")){let e="python"==this.fileType,i=t.substring("qName:".length);n=(e?this.parent.saveFileAsync():Promise.resolve()).then((()=>l.snippetAsync(i,e)))}n.then((t=>{let n=this.editor.getTargetAtClientPoint(pxt.BrowserUtils.getClientX(e),pxt.BrowserUtils.getClientY(e)).position;pxt.tickEvent("monaco.toolbox.insertsnippet"),this.insertSnippet(n,t,i)}))}},this.moveFocusToToolbox=()=>{this.toolbox&&this.toolbox.focus()},this.revealBreakpointLocation=(e,t)=>{if(!this.breakpoints)return;const i=this.breakpoints.getLocationOfBreakpoint(e);i&&(this.highlightedBreakpoint=e,this.currFile.getTextFileName()!==i.fileName?(o.mainEditorPkg(),L(i.fileName)&&this.parent.setFile(L(i.fileName))):this.highilightStatementCore(i,!0),this.debuggerToolbox&&this.debuggerToolbox.setState({currentFrame:t}))},this.setInsertionSnippet=e=>{this.insertionSnippet=e},this.hasInsertionSnippet=()=>!!this.insertionSnippet,this.uniqueBlockId=0,this.handleToolboxRef=e=>{this.toolbox=e},this.handleDebugToolboxRef=e=>{e&&(this.debuggerToolbox=e,this.isDebugging()&&this.updateToolbox())},this.handleFlyoutRef=e=>{e&&(this.flyout=e)},this.setErrorListState=this.setErrorListState.bind(this),this.listenToErrorChanges=this.listenToErrorChanges.bind(this),this.listenToExceptionChanges=this.listenToExceptionChanges.bind(this),this.goToError=this.goToError.bind(this),this.startDebugger=this.startDebugger.bind(this),this.onUserPreferencesChanged=this.onUserPreferencesChanged.bind(this),m.subscribe(this.userPreferencesSubscriber,x.HIGHCONTRAST)}onUserPreferencesChanged(){const e=m.getData(x.HIGHCONTRAST);this.loadMonacoPromise&&this.defineEditorTheme(e,!0)}hasBlocks(){if(!this.currFile)return!0;let e=this.currFile.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME);return e&&null!=o.mainEditorPkg().files[e]}openBlocks(){this.openBlocksAsync()}async openBlocksAsync(){pxt.tickEvent("typescript.showBlocks");let e=Promise.resolve();if(pxt.BrowserUtils.isWinRT())return;if(!this.currFile){const e=o.mainEditorPkg();if(!e||!e.files[pxt.MAIN_TS])return;await this.loadFileAsync(e.files[pxt.MAIN_TS])}let t=e.then((()=>{const e="python"==this.fileType,t=e?"python":"typescript";pxt.tickEvent(`${t}.convertBlocks`);const i=o.mainEditorPkg();if(!this.hasBlocks()&&!i&&!i.files[pxt.MAIN_BLOCKS])return void pxt.debug("cancelling convertion to blocks, but main.blocks is missing");this.feWidget&&(this.feWidget.close(),this.activeRangeID=null);let n=this.currFile.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME),r=e?this.currFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME):this.currFile.name;if(!this.hasBlocks()){if(!i||!i.files[pxt.MAIN_BLOCKS])return void(i&&this.parent.setFile(i.files[pxt.MAIN_TS]));this.currFile=i.files[pxt.MAIN_TS],n=this.currFile.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME),r=pxt.MAIN_TS}const a=(e,t=!1)=>(s.cancelAsyncLoading("switchtoblocks"),this.forceDiagnosticsUpdate(),this.showBlockConversionFailedDialog(e,t));let c,u;return this.parent.saveFileAsync().then((()=>this.parent.saveFileAsync())).then((()=>this.parent.loadBlocklyAsync())).then((()=>this.saveToTypeScriptAsync())).then((()=>l.getBlocksAsync())).then((e=>{u=e,pxt.blocks.initializeAndInject(u);const r=pxt.blocks.loadWorkspaceXml(i.files[n].content);return r?pxt.blocks.compileAsync(r,u).then((e=>{const o=e.source;return l.formatAsync(o,0).then((e=>l.formatAsync(this.editor.getValue(),0).then((o=>e.formatted==o.formatted?(pxt.debug(`${t} not changed, skipping decompile`),pxt.tickEvent(`${t}.noChanges`),this.parent.setFile(i.files[n]),[r,!1]):[r,!0]))))})):[r,!0]})).then((e=>{if(!e)return Promise.resolve();const t=e[0];return e[1]?l.compileAsync().then((e=>e.success?this.transpileToBlocksInternalAsync(this.currFile,u,t).then((e=>{if(!e.success){const t=e.failedResponse;this.currFile.diagnostics=t.diagnostics;let i=!1;return t.diagnostics.forEach((e=>i=i||9266===e.code)),a(n,i)}return c=e.outText,g.assert(!!c),i.setContentAsync(n,c).then((()=>this.parent.setFile(i.files[n])))})):a(n,!1))):Promise.resolve()})).catch((e=>{pxt.reportException(e),s.errorNotification(lf("Oops, something went wrong trying to convert your code."))}))}));return s.showLoadingAsync("switchtoblocks",lf("switching to blocks..."),t),e}showBlockConversionFailedDialog(e,t){const i="python"==this.fileType,n=i?"python":"typescript";let r,a,l=o.mainEditorPkg().files[e];return t&&pxt.tickEvent(`${n}.programTooLarge`),i?(r=t?lf("Your program is too large to convert into blocks. You can keep working in Python or discard your changes and go back to the previous Blocks version."):lf("We are unable to convert your Python code back to blocks. You can keep working in Python or discard your changes and go back to the previous Blocks version."),a=lf("Stay in Python")):(r=t?lf("Your program is too large to convert into blocks. You can keep working in JavaScript or discard your changes and go back to the previous Blocks version."):lf("We are unable to convert your JavaScript code back to blocks. You can keep working in JavaScript or discard your changes and go back to the previous Blocks version."),a=lf("Stay in JavaScript")),s.confirmAsync({header:t?lf("Program too large"):lf("Oops, there is a problem converting your code."),body:r,agreeLbl:lf("Discard and go to Blocks"),agreeClass:"cancel",agreeIcon:"cancel",disagreeLbl:a,disagreeClass:"positive",disagreeIcon:"checkmark",hideCancel:!l}).then((e=>{e?(pxt.tickEvent(`${n}.discardText`,void 0,{interactiveConsent:!0}),this.parent.saveBlocksToTypeScriptAsync().then((e=>{this.overrideFile(e),this.parent.setFile(l)}))):pxt.tickEvent(`${n}.keepText`,void 0,{interactiveConsent:!0})}))}transpileToBlocksInternalAsync(e,t,i){const n=o.mainEditorPkg(),r=e.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME),s=e.getVirtualFileName(pxt.BLOCKS_PROJECT_NAME),a="py"===e.getExtension()?"py":"ts",c=e.content,u=n.getCachedTranspile(a,c,"blocks");return null!=u?Promise.resolve({success:!0,outText:u}):l.decompileAsync(r,t,i,s).then((e=>{if(!e.success)return{success:!1,failedResponse:e};const t=e.outfiles[s];return n.cacheTranspile(a,c,"blocks",t),{success:!0,outText:t}}))}decompileAsync(e){return l.decompileAsync(e)}setVisible(e){super.setVisible(e),e||this.onErrorChanges([])}display(){const e=pxt.appTarget.appTheme.errorList,t=pxt.BrowserUtils.isAndroid(),i=pxt.BrowserUtils.isWinRT(),r=i?this.getWinAppErrorMsg():[];return n.createElement("div",{id:"monacoEditorArea",className:"monacoEditorArea "+(t?"android":""),style:{direction:"ltr"}},this.isVisible&&n.createElement("div",{className:"monacoToolboxDiv "+(!this.toolbox||this.toolbox.state.visible||this.isDebugging()?"":"invisible")},n.createElement(p.Toolbox,{ref:this.handleToolboxRef,editorname:"monaco",parent:this}),n.createElement("div",{id:"monacoDebuggerToolbox"})),i?n.createElement("div",{id:"winAppError"},n.createElement("img",{className:"ui medium centered image",alt:lf("An image of a shrugging board"),src:pxt.appTarget.appTheme.winAppDeprImage}),n.createElement("div",{className:"ui centered",id:"winAppErrorMsg"},r)):n.createElement("div",{id:"monacoEditorRightArea",className:"monacoEditorRightArea"},n.createElement("div",{id:"monacoEditorInner"},n.createElement(k.MonacoFlyout,{ref:this.handleFlyoutRef,fileType:this.fileType,blockIdMap:this.blockIdMap,moveFocusToParent:this.moveFocusToToolbox,insertSnippet:this.insertSnippet,setInsertionSnippet:this.setInsertionSnippet,parent:this.parent})),e&&n.createElement(w.ErrorList,{isInBlocksEditor:!1,onSizeChange:this.setErrorListState,listenToErrorChanges:this.listenToErrorChanges,listenToExceptionChanges:this.listenToExceptionChanges,goToError:this.goToError,startDebugger:this.startDebugger})))}getWinAppErrorMsg(){const e=lf("Oops! Text editing is only available on the website at {0}. Go {1} for more information.",`https://${pxt.appTarget.name}`,"{1}").split(/\{\d\}/);return[e[0],n.createElement("a",{href:"/windows-app",target:"_blank",rel:"noopener noreferrer"},lf("here")),e[1]]}listenToExceptionChanges(e,t){this.exceptionChangesListeners[e]=t}onExceptionDetected(e){for(let t of pxt.U.values(this.exceptionChangesListeners))t(e,this.callLocations)}listenToErrorChanges(e,t){this.errorChangesListeners[e]=t}goToError(e){let t,i;e.endLine&&e.endColumn?(t=e.endLine+1,i=e.endColumn+1):(t=e.line+1,i=e.column+e.length+1),this.editor.revealLineInCenter(t),this.editor.setPosition({column:i,lineNumber:t}),this.editor.focus()}startDebugger(){pxt.tickEvent("errorList.startDebugger",null,{interactiveConsent:!0}),this.parent.toggleDebugging()}onErrorChanges(e){for(let t of pxt.U.values(this.errorChangesListeners))t(e)}showPackageDialog(){pxt.tickEvent("monaco.addpackage",void 0,{interactiveConsent:!0}),this.hideFlyout(),this.parent.showPackageDialog()}defineEditorTheme(e,t){const i=pxt.appTarget.appTheme.invertedMonaco;let n=[];if(!e&&t){const e={};this.getNamespaces().forEach((t=>{const i=this.getNamespaceAttrs(t),r=c.isBuiltin(t)?c.getBuiltinCategory(t).blocks.concat(this.nsMap[t]||[]):this.nsMap[t];if(i.color&&r){let s=o(i.color);r.forEach((e=>{n.push({token:`identifier.ts ${e.name}`,foreground:s})})),n.push({token:`identifier.ts ${t}`,foreground:s}),e[t]=i.color}})),n.push({token:"identifier.ts if",foreground:"5B80A5"}),n.push({token:"identifier.ts else",foreground:"5B80A5"}),n.push({token:"identifier.ts while",foreground:"5BA55B"}),n.push({token:"identifier.ts for",foreground:"5BA55B"});const t=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;if(t){const i=t.callName||"pauseUntil",r=t.color||e[t.category];r&&n.push({token:`identifier.ts ${i}`,foreground:o(r)})}}const r=pxt.appTarget.appTheme.monacoColors||{};function o(e){return e=pxt.toolbox.convertColor(e),(i?pxt.toolbox.fadeColor(e,.6,!0):e).replace("#","")}monaco.editor.defineTheme("pxtTheme",{base:e?"hc-black":i?"vs-dark":"vs",inherit:!0,rules:n,colors:e?{}:r}),monaco.editor.setTheme("pxtTheme")}saveToTypeScriptAsync(){return"python"==this.fileType?this.convertPythonToTypeScriptAsync(this.isDebugging()||this.parent.state.tracing):Promise.resolve(void 0)}convertPythonToTypeScriptAsync(e=!1){if(!this.currFile)return Promise.resolve(void 0);const t=this.currFile.getVirtualFileName(pxt.JAVASCRIPT_PROJECT_NAME);return l.py2tsAsync(e).then((e=>{var i;if(e.sourceMap){const n=o.mainEditorPkg(),r=e.outfiles[t],s=null===(i=n.files[this.currFile.getFileNameWithExtension("py")])||void 0===i?void 0:i.content;this.pythonSourceMap=r&&s?pxtc.BuildSourceMapHelpers(e.sourceMap,r,s):null}if(!e.diagnostics||!e.diagnostics.length)return e.outfiles[t]?e.outfiles[t]:""}))}setHighContrast(e){}beforeCompile(){}isIncomplete(){return!!(this.editor&&this.editor._view&&this.editor._view.contentWidgets._widgets["editor.widget.suggestWidget"].isVisible)||!(!this.editor||this.currFile.name!==pxt.CONFIG_NAME||g.jsonTryParse(this.getCurrentSource()))}resize(e){let t=document.getElementById("monacoEditorArea");if(!t)return;let i=t.getElementsByClassName("monacoToolboxDiv")[0];if(t&&this.editor){const e=i&&i.offsetWidth||0,n=this.parent.isJavaScriptActive()?this.parent.updateEditorLogo(e,this.getEditorColor()):0;if(this.editor.layout({width:t.offsetWidth-e,height:t.offsetHeight-n}),t&&this.parent.isTutorial()&&!pxt.BrowserUtils.isTabletSize()){const e=t.getBoundingClientRect();h.setEditorBounds({top:e.top,left:e.left,width:e.width,height:e.height})}else h.setEditorBounds({top:0,left:0,width:window.innerWidth,height:window.innerHeight});i&&(i.style.height="100%")}}setErrorListState(e){this.parent.state.errorListState!=e&&(this.resize(),this.parent.setState({errorListState:e}))}prepare(){this.isReady=!0}loadMonacoAsync(){return this.loadMonacoPromise||(this.loadMonacoPromise=this.createLoadMonacoPromise()),this.loadMonacoPromise}createLoadMonacoPromise(){this.extraLibs=Object.create(null),document.getElementById("monacoEditorArea");let e=document.getElementById("monacoEditorInner");return pxt.vs.initMonacoAsync(e).then((e=>{if(this.editor=e,"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1&&!this.mobileKeyboardWidget&&(this.mobileKeyboardWidget=new P(this.editor)),this.editor.updateOptions({fontSize:this.parent.settings.editorFontSize}),this.editor.addAction({id:"save",label:lf("Save"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_S],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",contextMenuGroupId:"0_pxtnavigation",contextMenuOrder:.2,run:()=>Promise.resolve(this.parent.typecheckNow())}),this.editor.addAction({id:"runSimulator",label:lf("Run Simulator"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.Enter],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",contextMenuGroupId:"0_pxtnavigation",contextMenuOrder:.21,run:()=>Promise.resolve(this.parent.runSimulator())}),pxt.appTarget.compile&&pxt.appTarget.compile.hasHex&&this.editor.addAction({id:"compileHex",label:lf("Download"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.Enter],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",contextMenuGroupId:"0_pxtnavigation",contextMenuOrder:.22,run:()=>Promise.resolve(this.parent.compile())}),this.editor.addAction({id:"zoomIn",label:lf("Zoom In"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.NUMPAD_ADD,monaco.KeyMod.CtrlCmd|monaco.KeyCode.US_EQUAL],run:()=>Promise.resolve(this.zoomIn())}),this.editor.addAction({id:"zoomOut",label:lf("Zoom Out"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.NUMPAD_SUBTRACT,monaco.KeyMod.CtrlCmd|monaco.KeyCode.US_MINUS],run:()=>Promise.resolve(this.zoomOut())}),pxt.appTarget.appTheme.hasReferenceDocs){let e=this.editor.createContextKey("editorHasReference",!1);this.editor.addAction({id:"reference",label:lf("Help"),keybindingContext:"!editorReadonly && editorHasReference",precondition:"!editorReadonly && editorHasReference",contextMenuGroupId:"navigation",contextMenuOrder:.1,run:()=>Promise.resolve(this.loadReference())}),this.editor.onDidChangeCursorPosition((t=>{let i=this.editor.getModel().getWordUntilPosition(t.position);i&&""!=i.word?e.set(!0):e.reset()}))}this.editor.addAction({id:"jumptoolbox",label:lf("Jump to Toolbox"),keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.KEY_T],keybindingContext:"!editorReadonly",precondition:"!editorReadonly",run:()=>Promise.resolve(this.moveFocusToToolbox())}),this.editor.onDidLayoutChange((e=>{let t=this.getEditorFontSize();this.parent.settings.editorFontSize!=t&&(this.parent.settings.editorFontSize=t,this.forceDiagnosticsUpdate());const i=document.getElementById("monacoToolboxDiv");i&&(i.style.height=`${this.editor.getLayoutInfo().height}px`)}));const t=document.getElementById("monacoEditorInner");pxt.BrowserUtils.hasPointerEvents()?(t.onpointermove=this.onPointerMove,t.onpointerup=this.onPointerUp):(t.onmousemove=this.onPointerMove,t.onmouseup=this.onPointerUp,pxt.BrowserUtils.isTouchEnabled()&&(t.ontouchend=this.onPointerUp)),this.editor.onDidFocusEditorText((()=>{this.hideFlyout()})),monaco.languages.registerCompletionItemProvider("python",new E(this,!0)),monaco.languages.registerSignatureHelpProvider("python",new C(this,!0)),monaco.languages.registerHoverProvider("python",new S(this,!0)),monaco.languages.registerDocumentRangeFormattingEditProvider("python",new A(this,!0)),monaco.languages.setLanguageConfiguration("python",T),this.editorViewZones=[],this.setupFieldEditors(),this.editor.onMouseDown((e=>{e.target.type===monaco.editor.MouseTargetType.GUTTER_GLYPH_MARGIN&&this.handleGutterClick(e)})),e.onDidChangeModelContent((t=>{this.fieldEditors&&this.fieldEditors.clearRanges(e)}))}))}undo(){this.editor&&this.editor.trigger("keyboard","undo",null)}redo(){this.editor&&this.editor.trigger("keyboard","redo",null)}zoomIn(){if(!this.editor)return;if(this.parent.settings.editorFontSize>=40)return;let e=this.getEditorFontSize();this.parent.settings.editorFontSize=e+1,this.editor.updateOptions({fontSize:this.parent.settings.editorFontSize}),this.forceDiagnosticsUpdate()}zoomOut(){if(!this.editor)return;if(this.parent.settings.editorFontSize<=10)return;let e=this.getEditorFontSize();this.parent.settings.editorFontSize=e-1,this.editor.updateOptions({fontSize:this.parent.settings.editorFontSize}),this.forceDiagnosticsUpdate()}loadReference(){g.assert(null!=this.editor);const e=this.editor.getModel(),t=e.getOffsetAt(this.editor.getPosition()),i=e.getValue(),n=this.currFile.name;l.syntaxInfoAsync("symbol",n,t,i).then((e=>{if(null==e?void 0:e.symbols)for(const t of e.symbols)if(t.attributes.help)return void this.parent.setSideDoc("/reference/"+t.attributes.help.replace(/^\//,""));s.warningNotification(g.lf("Help resource not found"))}))}setupFieldEditors(){this.hasFieldEditors&&!pxt.shell.isReadOnly()&&(this.fieldEditors||(this.fieldEditors=new f.FieldEditorManager(this.editor),monaco.languages.registerFoldingRangeProvider("typescript",this.fieldEditors),monaco.languages.registerFoldingRangeProvider("python",this.fieldEditors)),this.editor.onDidChangeCursorPosition((e=>{this.fieldEditors&&this.fieldEditors.setCursorLine(e.position.lineNumber)})),pxt.appTarget.appTheme.monacoFieldEditors.forEach((e=>{const t=pxt.editor.getMonacoFieldEditor(e);t?this.fieldEditors.addFieldEditor(t):pxt.debug("Skipping unknown monaco field editor '"+e+"'")})))}closeFlyout(){this.editor&&this.hideFlyout()}hideFlyout(){this.flyout&&this.flyout.setState({groups:void 0}),this.toolbox&&this.toolbox.clearSelection(),this.parent.setState({hideEditorFloats:!1})}updateToolbox(){pxt.appTarget.appTheme.monacoToolbox&&!pxt.shell.isReadOnly()&&this.editor&&(this.editor.layout(),this.toolbox&&(this.toolbox.setState({loading:!1,categories:this.getAllCategories(),showSearchBox:this.shouldShowSearch()}),this.shouldShowToolbox()?this.toolbox.show():this.toolbox.hide()),this.updateDebuggerToolbox())}updateDebuggerToolbox(){const e=document.getElementById("monacoDebuggerToolbox");if(!e||!this.blockInfo)return;const t=this.isDebugging();t&&this.flyout&&this.flyout.setState({groups:void 0});const i=t?n.createElement(v.DebuggerToolbox,{ref:this.handleDebugToolboxRef,parent:this.parent,apis:this.blockInfo.apis.byQName,openLocation:this.revealBreakpointLocation,showCallStack:!0}):null;r.render(i,e)}getId(){return"monacoEditor"}getViewState(){return this.editor?this.editor.getPosition():{}}getCurrentSource(){return this.editor?this.editor.getValue():this.currSource}acceptsFile(e){return!0}setValue(e){this.editor.setValue(e)}overrideFile(e){g.assert(null!=this.editor),this.editor.setValue(e)}shouldShowToolbox(){const e=!this.currFile||this.currFile.isReadonly()||pxt.shell.isReadOnly()||this.isDebugging();return pxt.appTarget.appTheme.monacoToolbox&&!e&&("typescript"==this.fileType||"python"==this.fileType)}loadFileAsync(e,t){let i="text";if(this.currSource=e.content,pxt.BrowserUtils.isWinRT())return this.currFile=e,Promise.resolve();let n=document.createElement("div");n.className="ui inverted loading dimmer active";let r=document.getElementById("monacoEditorRightArea"),s=document.getElementById("monacoEditorInner");return r.insertBefore(n,s),this.pythonSourceMap=null,this.loadMonacoAsync().then((()=>{if(!this.editor)return Promise.resolve();this.foldFieldEditorRanges=!0,this.updateFieldEditors();let n=e.getExtension();N.hasOwnProperty(n)&&(i=N[n]),this.fileType=i;const r=e.isReadonly()||pxt.shell.isReadOnly()||this.isDebugging();this.editor.updateOptions({readOnly:r});let s="pkg:"+e.getName(),a=monaco.editor.getModels().filter((e=>e.uri.toString()==s))[0];if(a||(a=monaco.editor.createModel(o.mainPkg.readFile(e.getName()),i,monaco.Uri.parse(s))),a&&this.editor.setModel(a),this.defineEditorTheme(t),this.currFile=e,this.shouldShowToolbox()?this.beginLoadToolbox(e,t):this.toolbox&&this.toolbox.hide(),this.setValue(e.content),this.setDiagnostics(e,this.snapshotState()),this.breakpoints){this.breakpoints.loadBreakpointsForFile(e,this.editor);const t=this.breakpoints.getLocationOfBreakpoint(this.highlightedBreakpoint);t&&t.fileName===e.getTextFileName()&&this.highilightStatementCore(t,!0)}return"markdown"==this.fileType&&this.parent.setSideMarkdown(e.content),this.currFile.setForceChangeCallback(((e,t)=>{e!=t&&(pxt.debug(`File changed (from ${e}, to ${t}). Reloading editor`),this.loadFileAsync(this.currFile))})),e.isReadonly()||a.onDidChangeContent((e=>{this.clearHighlightedStatements();let t=this.editorViewZones||[];this.editor.changeViewZones((function(e){t.forEach((t=>{e.removeZone(t)}))})),this.editorViewZones=[];const i=/[\u{201c}\u{201d}\u{2018}\u{2019}]/u;if(e.changes.some((e=>i.test(e.text)))){const t=e.changes.filter((e=>i.test(e.text))).map((e=>{const t=a.getPositionAt(e.rangeOffset),i=a.getPositionAt(e.rangeOffset+e.text.length);return{range:new monaco.Range(t.lineNumber,t.column,i.lineNumber,i.column),text:e.text.replace(/\u{201c}|\u{201d}/gu,'"').replace(/\u{2018}|\u{2019}/gu,"'")}}));this.editor.executeEdits("pxt",t)}this.updateDiagnostics(),this.changeCallback(),this.updateFieldEditors()})),this.resize(),this.hideFlyout(),this.extensions=o.allEditorPkgs().map((e=>e.getKsPkg())).filter((e=>!!e&&e.config&&!!e.config.extension&&/^(file:|github:)/.test(e.installedVersion))),this.giveFocusOnLoading&&this.editor.focus(),"python"===this.fileType&&(this.editAmendmentsListener=y.listenForEditAmendments(this.editor)),this.foldFieldEditorRangesAsync()})).finally((()=>{r.removeChild(n),this.parent.isTutorial()&&this.parent.onTutorialLoaded()}))}unloadFileAsync(){return this.toolbox&&this.toolbox.clearSearch(),this.currFile&&this.currFile.getName()=="this/"+pxt.CONFIG_NAME?this.parent.reloadHeaderAsync():(this.editAmendmentsListener&&(this.editAmendmentsListener.dispose(),this.editAmendmentsListener=void 0),Promise.resolve())}beginLoadToolbox(e,t){this.toolbox&&this.toolbox.showLoading(),l.getBlocksAsync().then((i=>{this.blockInfo=i,this.nsMap=this.partitionBlocks(),this.updateToolbox(),pxt.vs.syncModels(o.mainPkg,this.extraLibs,e.getName(),e.isReadonly()),this.defineEditorTheme(t,!0)})),this.blockIdMap=c.blockIdMap()}snapshotState(){return this.editor&&this.editor.getModel()?this.editor.getModel().getLinesContent():null}setViewState(e){this.editor&&e&&0!==Object.keys(e).length&&(this.editor.setPosition(e),this.editor.setScrollPosition({scrollTop:this.editor.getTopForLineNumber(e.lineNumber)}))}setBreakpointsMap(e,t){this.callLocations=t,this.isDebugging()?(this.breakpoints||(this.breakpoints=new b.BreakpointCollection(e,this.pythonSourceMap),this.breakpoints.loadBreakpointsForFile(this.currFile,this.editor)),this.fieldEditors&&this.fieldEditors.clearRanges(this.editor),this.feWidget&&this.feWidget.close(),this.editor&&this.editor.updateOptions({readOnly:!0})):(this.editor&&this.editor.updateOptions({readOnly:pxt.shell.isReadOnly()||this.currFile&&this.currFile.isReadonly()}),this.breakpoints&&(this.breakpoints.dispose(),this.breakpoints=void 0),this.updateFieldEditors())}setDiagnostics(e,t){this.editor&&this.currFile===e&&(this.diagSnapshot=t,this.forceDiagnosticsUpdate())}updateDiagnostics(){this.needsDiagUpdate()&&this.forceDiagnosticsUpdate()}getBreakpoints(){return this.breakpoints?this.breakpoints.getActiveBreakpoints():[]}getEditorFontSize(){return this.editor.getOptions().get(monaco.editor.EditorOption.fontInfo).fontSize}sendBreakpoints(){this.breakpoints&&d.driver.setBreakpoints(this.getBreakpoints())}needsDiagUpdate(){if(!this.annotationLines)return!1;let e=this.editor.getModel().getLinesContent();for(let t of this.annotationLines)if(this.diagSnapshot[t]!==e[t])return!0;return!1}forceDiagnosticsUpdate(){if("typescript"!=this.fileType&&"python"!=this.fileType)return;let e=this.currFile,t=[];if(e&&e.diagnostics){const i=monaco.editor.getModel(monaco.Uri.parse(`pkg:${e.getName()}`));for(let n of e.diagnostics){const e=e=>{t.push({severity:monaco.MarkerSeverity.Error,message:e,startLineNumber:n.line+1,startColumn:n.column+1,endLineNumber:null==n.endLine?r.lineNumber:n.endLine+1,endColumn:null==n.endColumn?r.column:n.endColumn})},r=i.getPositionAt(n.start+n.length);if("string"==typeof n.messageText)e(n.messageText);else{let t=n.messageText;for(;null!=t.next;)e(t.messageText),t=t.next}}monaco.editor.setModelMarkers(i,"typescript",t),this.onErrorChanges(e.diagnostics)}}showFieldEditor(e,t,i,n){this.feWidget&&this.feWidget.close(),this.feWidget=new f.ModalEditorHost(t,e,this.editor.getModel());const r=()=>{n&&(d.setDirty(),"typescript"==this.fileType&&o.mainEditorPkg().invalidateCachedTranspile("ts",this.getCurrentSource(),"blocks"))};this.feWidget.showAsync(this.fileType,this.editor).then((e=>{this.activeRangeID=null,e?this.editModelAsync(e.range,e.replacement).then((e=>this.indentRangeAsync(e))).then((()=>this.foldFieldEditorRangesAsync())).then(r):r()}))}updateFieldEditors(){this.fieldEditors&&this.fieldEditors.setFieldEditorsEnabled(this.hasFieldEditors&&this.editor&&!pxt.shell.isReadOnly()&&!this.isDebugging())}foldFieldEditorRangesAsync(){return this.foldFieldEditorRanges?this.editor.getAction("editor.foldAllBlockComments").run():Promise.resolve()}highlightStatement(e,t){var i;if(!e)return this.clearHighlightedStatements(),this.debuggerToolbox&&this.debuggerToolbox.setBreakpoint(null),!1;if(!this.editor)return!1;if(t&&(null===(i=this.breakpoints)||void 0===i?void 0:i.getLoadedBreakpoint(t.breakpointId))?e=this.breakpoints.getLoadedBreakpoint(t.breakpointId):"py"===this.currFile.getExtension()&&this.pythonSourceMap&&(e=this.pythonSourceMap.ts.locToLoc(e)),this.currFile.getTextFileName()!==e.fileName&&this.isDebugging()&&L(e.fileName))this.parent.setFile(L(e.fileName));else if(!this.highilightStatementCore(e,!!t))return!1;return this.highlightedBreakpoint=t?t.breakpointId:void 0,t&&this.isDebugging()&&this.debuggerToolbox&&(this.debuggerToolbox.setBreakpoint(t),this.resize()),!0}highilightStatementCore(e,t=!1){let i=this.editor.getModel().getPositionAt(e.start),n=this.editor.getModel().getPositionAt(e.start+e.length);return!(!i||!n||(this.highlightDecorations=this.editor.deltaDecorations(this.highlightDecorations,[{range:new monaco.Range(i.lineNumber,i.column,n.lineNumber,n.column),options:{inlineClassName:"highlight-statement"}}]),t&&this.editor.revealPositionInCenter(i),0))}clearHighlightedStatements(){this.editor&&this.highlightDecorations&&this.editor.deltaDecorations(this.highlightDecorations,[])}partitionBlocks(){const e={};this.topBlocks=[];const t=c.allBuiltinBlocksByName(),i=this;function n(e,t){i.subcategoryMap[e]||(i.subcategoryMap[e]={}),i.subcategoryMap[e][t]=!0}if(this.blockInfo.blocks.forEach((i=>{let r=(i.attributes.blockNamespace||i.namespace).split(".")[0];if(t[i.qName]||"TD_ID"==i.attributes.shim)return;e[r]||(e[r]=[]),e[r].push(i);const o=i.attributes.subcategory;i.attributes.advanced?n(r,lf("more")):o&&n(r,o),i.attributes.topblock&&this.topBlocks.push(i)})),c.getPauseUntil()){const t=pxt.appTarget.runtime.pauseUntilBlock.category;e[t]&&e[t].push(c.getPauseUntil())}return e}clearCaches(){super.clearCaches(),c.clearBuiltinBlockCache()}shouldShowSearch(){return!this.parent.state.editorState||null==this.parent.state.editorState.searchBar||this.parent.state.editorState.searchBar}getBuiltinCategory(e){return c.getBuiltinCategory(e)}isBuiltIn(e){return c.isBuiltin(e)}getNamespaceAttrs(e){const t=c.getBuiltinCategory(e);return t?(t.attributes.color=pxt.toolbox.getNamespaceColor(t.nameid),t.attributes):this.blockInfo?super.getNamespaceAttrs(e):void 0}getNamespaces(){const e=Object.keys(this.nsMap).filter((e=>!c.isBuiltin(e)&&!!this.getNamespaceAttrs(e)));function t(e){return c.getBuiltinCategory(e).removed}let i=pxt.appTarget.runtime||{};return i.loopsBlocks&&!t("loops")&&e.push("loops"),i.logicBlocks&&!t("logic")&&e.push("logic"),i.variablesBlocks&&!t("variables")&&e.push("variables"),i.mathBlocks&&!t("Math")&&e.push("Math"),i.functionBlocks&&!t("functions")&&e.push("functions"),i.listsBlocks&&!t("arrays")&&e.push("arrays"),i.textBlocks&&!t("text")&&e.push("text"),pxt.appTarget.cloud&&pxt.appTarget.cloud.packages&&e.push("addpackage"),e.concat(super.getNamespaces())}moveFocusToFlyout(){if(this.flyout){let e=document.querySelector(".monacoBlock");e&&(e.focus(),e.click())}}getBlocksForCategory(e,t){return c.isBuiltin(e)?this.getBuiltinBlocks(e,t):this.filterBlocks(t,this.nsMap[e])}filterBlocks(e,t){return t.filter((t=>!t.attributes.blockHidden&&!(t.attributes.deprecated&&!this.parent.isTutorial())&&0!=t.name.indexOf("_")&&(!e&&!t.attributes.subcategory&&!t.attributes.advanced||e&&(t.attributes.advanced&&e==lf("more")||t.attributes.subcategory&&e==t.attributes.subcategory))))}getBuiltinBlocks(e,t){let i=c.getBuiltinCategory(e),n=i.blocks||[];return!i.custom&&this.nsMap[e]&&(n=n.concat(this.nsMap[e].filter((e=>!(e.attributes.blockHidden||e.attributes.deprecated&&!this.parent.isTutorial()))))),this.filterBlocks(t,n)}showFlyout(e){if(!this.editor)return;let{nameid:t,name:i,subns:n,color:r,icon:o,blocks:s}=e,a=[];if(this.flyout){if("search"==t)try{0==(s=this.getSearchBlocks()).length&&(i=lf("No search results...")),a.push({name:pxt.DEFAULT_GROUP_NAME,blocks:s})}catch(e){pxt.reportException(e),s=[],i=lf("No search results...")}else"topblocks"==t?0==(s=this.getTopBlocks()).length?i=lf("No basic results..."):(r=pxt.toolbox.getNamespaceColor("topblocks"),o=pxt.toolbox.getNamespaceIcon("topblocks"),i=lf("{id:category}Basic"),a.push({name:pxt.DEFAULT_GROUP_NAME,blocks:s})):a=this.getBlockGroups(e);this.flyout.setState({name:i||g.capitalize(n||t),selectedBlock:void 0,hide:!1,ns:t,color:r,icon:o,groups:a})}}showFlyoutHeadingLabel(e,t,i,n,r){}showFlyoutGroupLabel(e,t,i,n){}showFlyoutBlocks(e,t,i){}handleGutterClick(e){const t=e.target.position.lineNumber;if(this.isDebugging())this.breakpoints&&(this.breakpoints.toggleBreakpointAt(t),this.sendBreakpoints());else if(this.fieldEditors){const e=this.editor.getModel();if(e.getDecorationsInRange(new monaco.Range(t,e.getLineMinColumn(t),t,e.getLineMaxColumn(t))).length){const e=this.fieldEditors.getInfoForLine(t);if(e){if(this.feWidget&&null!=this.activeRangeID&&e.id===this.activeRangeID)return this.feWidget.close(),void(this.activeRangeID=null);this.activeRangeID=e.id;const t=this.fieldEditors.getFieldEditorById(e.owner);t&&this.showFieldEditor(e.range,new t.proto,t.heightInPixels||500,t.alwaysBuildOnClose)}}}}getSearchBlocks(){let e=[];const t=this.toolbox.getSearchBlocks(),i=this;function n(e){const t=i.blockInfo.apis.byQName[e];return(t?t.attributes.color:void 0)||pxt.toolbox.getNamespaceColor(e)||"255"}return t.forEach((t=>{if(t.name){const i=this.blockInfo.apis.byQName[t.name];if(i){if(0==i.name.indexOf("_"))return;const t=(i.attributes.blockNamespace||i.namespace).split(".")[0];i.attributes.color=i.attributes.color||n(t),e.push(i)}else pxt.log("couldn't find non builtin search by qName: "+t.name)}else if(t.attributes.blockId==pxtc.PAUSE_UNTIL_TYPE){const t=c.getPauseUntil();if(t){const i=t.attributes.blockNamespace;t.attributes.color=n(i),e.push(t)}}else{const i=c.allBuiltinBlocks()[t.attributes.blockId];i?(i[0].attributes.blockNamespace=i[1],e.push(i[0])):pxt.log("couldn't find buildin search qName for block: "+t.attributes.blockId)}})),e}indentRangeAsync(e){const t=this.editor.getModel(),i=t.getLineFirstNonWhitespaceColumn(e.startLineNumber)-1,n=D(t.getOptions().indentSize+i),r=t.getValueInRange(e).split(/\n/),o=r.map(((e,t)=>0===t?e.trim():t===r.length-1?D(i)+e.trim():n+e.trim())).join(t.getEOL());return this.editModelAsync(e,o)}editModelAsync(e,t){return new Promise((i=>{const n=this.editor.getModel(),r=t.split("\n"),o=new monaco.Range(e.startLineNumber,e.startColumn,e.startLineNumber+r.length-1,r[r.length-1].length);let s=this.editor.onDidChangeModelContent((e=>{s&&(s.dispose(),s=void 0),this.editor.setSelection(o),this.fieldEditors&&this.fieldEditors.clearRanges(this.editor),i(o)}));n.pushEditOperations(this.editor.getSelections(),[{range:n.validateRange(e),text:t,forceMoveMarkers:!0}],(e=>[O(e[0].range)]))}))}isDebugging(){return this.parent.state.debugging}getEditorColor(){return pxt.appTarget.appTheme.monacoColors&&pxt.appTarget.appTheme.monacoColors["editor.background"]?pxt.appTarget.appTheme.monacoColors["editor.background"]:pxt.appTarget.appTheme.invertedMonaco?"#1e1e1e":"#ffffff"}}function O(e){return new monaco.Selection(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn)}i.Editor=I,i.rangeToSelection=O;class P{constructor(e){this.touchHandler=()=>{this.editor.focus()},this.editor=e,this._domNode=document.createElement("textarea"),this._domNode.className="iPadShowKeyboard",this._domNode.addEventListener("touchstart",this.touchHandler),this._domNode.addEventListener("focus",this.touchHandler),this.editor.addOverlayWidget(this)}dispose(){this.editor.removeOverlayWidget(this),this._domNode.removeEventListener("touchstart",this.touchHandler),this._domNode.removeEventListener("focus",this.touchHandler)}getId(){return P.ID}getDomNode(){return this._domNode}getPosition(){return{preference:monaco.editor.OverlayWidgetPositionPreference.TOP_RIGHT_CORNER}}}function D(e){let t="";for(let i=0;i<e;i++)t+=" ";return t}function L(e){const t=o.mainEditorPkg();if(t.files[e])return t.files[e];return t.lookupFile(e)||void 0}P.ID="editor.contrib.ShowKeyboardWidget_pxt"},{"./auth":20,"./blocklyFieldView":21,"./compiler":30,"./core":78,"./data":81,"./debuggerToolbox":86,"./errorList":92,"./monacoDebugger":115,"./monacoEditAmendments":116,"./monacoFieldEditorHost":117,"./monacoFlyout":118,"./monacoSnippets":119,"./monacopyhelper":120,"./package":122,"./simulator":135,"./toolbox":144,"./toolboxeditor":145,react:335,"react-dom":291}],115:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BreakpointCollection=i.MonacoBreakpoint=void 0;class n{constructor(e,t){this.source=e,this.editor=t,this.active=!1;const i=this.editor.getModel(),n=i.getPositionAt(this.source.start),r=i.getPositionAt(this.source.start+this.source.length);r.lineNumber===n.lineNumber?this.range=new monaco.Range(n.lineNumber,n.column,r.lineNumber,r.column):this.range=new monaco.Range(n.lineNumber,n.column,n.lineNumber,i.getLineMaxColumn(n.lineNumber)),this.updateDecoration()}simulatorID(){return this.source.id}isActive(){return this.active}setActive(e){this.active!==e&&(this.active=e,this.updateDecoration())}toggle(){this.setActive(!this.active)}distanceFromLine(e){return Math.abs(this.range.startLineNumber-e)}dispose(){this.decoration&&(this.editor.deltaDecorations([this.decoration],[]),this.decoration=void 0)}updateDecoration(){const e=this.active?"monaco-breakpoint active":"monaco-breakpoint",t=this.active?pxt.U.lf("Remove breakpoint"):pxt.U.lf("Add breakpoint"),i=this.editor.deltaDecorations(this.decoration?[this.decoration]:[],[{range:this.range,options:{glyphMarginClassName:e,glyphMarginHoverMessage:{value:t}}}]);this.decoration=i[0]}}i.MonacoBreakpoint=n;i.BreakpointCollection=class{constructor(e,t){this.fileToBreakpoint={},this.activeBreakpoints=[],this.sourcemap=t;for(const t of e)this.fileToBreakpoint[t.fileName]||(this.fileToBreakpoint[t.fileName]=[]),this.fileToBreakpoint[t.fileName].push(t)}loadBreakpointsForFile(e,t){if(this.loadedBreakpoints&&this.loadedBreakpoints.forEach((e=>e.dispose())),!e)return;const i="py"===e.getExtension();let r=e.getTextFileName();i&&(r=e.getFileNameWithExtension("ts"));let o=this.fileToBreakpoint[r];if(i){if(!this.sourcemap)return;o=null==o?void 0:o.map((e=>{const t=this.sourcemap.ts.locToLoc(e);return Object.assign(Object.assign({},e),t)}))}o&&(this.loadedBreakpoints=o.map((e=>{const i=new n(e,t);return-1!=this.activeBreakpoints.indexOf(e.id)&&i.setActive(!0),i})))}toggleBreakpointAt(e){const t=this.getBreakpointForLine(e);t&&(t.toggle(),t.isActive()?this.activeBreakpoints.push(t.source.id):this.activeBreakpoints=this.activeBreakpoints.filter((e=>e!=t.source.id)))}refreshDecorations(){this.loadedBreakpoints&&this.loadedBreakpoints.forEach((e=>e.updateDecoration()))}clearDecorations(){this.loadedBreakpoints&&this.loadedBreakpoints.forEach((e=>e.dispose()))}getActiveBreakpoints(){return this.activeBreakpoints}dispose(){this.loadedBreakpoints&&(this.loadedBreakpoints.forEach((e=>e.dispose())),this.loadedBreakpoints=void 0),this.activeBreakpoints=void 0,this.fileToBreakpoint=void 0}getLocationOfBreakpoint(e){const t=this.getLoadedBreakpoint(e);if(t)return t;for(const t of Object.keys(this.fileToBreakpoint)){const i=this.fileToBreakpoint[t];for(const t of i)if(t.id===e)return t}}getLoadedBreakpoint(e){if(this.loadedBreakpoints)for(const t of this.loadedBreakpoints)if(t.source.id===e)return t.source;return null}getBreakpointForLine(e){if(!this.loadedBreakpoints||!this.loadedBreakpoints.length)return;let t,i;for(const n of this.loadedBreakpoints){const r=n.distanceFromLine(e);(void 0===i||r<i)&&(t=n,i=r)}return i<5?t:void 0}}},{}],116:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.listenForEditAmendments=i.amendmentToInsertSnippet=i.createLineReplacementPyAmendment=void 0;const n=e("./monaco"),r=e("./monacopyhelper"),o="#AMENDMENT:";i.createLineReplacementPyAmendment=function(e,t="pass"){return{behavior:"replaceLine",insertText:e||"",selectText:t}},i.amendmentToInsertSnippet=function(e){return`#AMENDMENT:${JSON.stringify(e)}`},i.listenForEditAmendments=function(e){return e.onDidChangeModelContent((t=>{let i=function(e){if(1!=e.changes.length)return null;let t=e.changes[0];if(!(t.text.indexOf(o)>=0))return null;let i=t.text.split(o);if(2!=i.length)return null;i[0];let n=i[1],r=pxt.U.jsonTryParse(n);return r?Object.assign({range:t.range},r):null}(t);i&&function(e,t){const i=t.getModel();setTimeout((()=>{let o=e.range;"replaceLine"===e.behavior?o=Object.assign(Object.assign({},o),{endColumn:99999,startColumn:1}):e.behavior;const s=r.fixIndentationInRange(i,i.validateRange(o),e.insertText)[0];e.range=s.range,e.insertText=s.text;let a=null;if(e.selectText){let t=e.insertText.split(e.selectText);if(t.length>=2){let i=t[0].split("\n"),n=i[i.length-1],r=o.startLineNumber+i.length-1,s=n.length+1;a=new monaco.Range(r,s,r,s+e.selectText.length)}}let l=Object.assign(Object.assign({},e.range),{endColumn:99999}),c=[{range:i.validateRange(l),text:"",forceMoveMarkers:!1}];i.applyEdits(c),setTimeout((()=>{const r=t.onDidChangeModelContent((e=>{r.dispose(),a&&t.setSelection(a)}));let s=[{range:i.validateRange(o),text:e.insertText,forceMoveMarkers:!0}];i.pushEditOperations(t.getSelections(),s,(e=>[n.rangeToSelection(e[0].range)]))}),0)}),0)}(i,e)}))}},{"./monaco":114,"./monacopyhelper":120}],117:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.computeRanges=i.RangesCollector=i.FieldEditorManager=i.ModalEditorHost=i.ViewZoneEditorHost=void 0;const n=e("./compiler"),r=e("./package");i.ViewZoneEditorHost=class{constructor(e,t,i){this.fe=e,this.range=t,this.model=i,this.heightInPx=520,this.suppressMouseDown=!1,this.afterLineNumber=t.endLineNumber;const n=document.createElement("div");n.setAttribute("class","pxt-view-zone");const r=document.createElement("div");r.setAttribute("class","monaco-field-editor-frame"),n.appendChild(r),this.domNode=n,this.wrapper=r}getId(){return"pxt-monaco-field-editor"}contentDiv(){return this.content||(this.content=document.createElement("div"),this.wrapper.appendChild(this.content)),this.content}showAsync(e,t){return this.fileType=e,this.editor=t,n.getBlocksAsync().then((e=>(this.blocks=e,this.showViewZoneAsync()))).then((()=>(this.editor.setScrollPosition({scrollTop:this.editor.getTopForLineNumber(this.afterLineNumber)}),this.fe.showEditorAsync(this.fileType,this.range,this)))).finally((()=>{this.close()}))}onComputedHeight(e){this.contentDiv().style.height=e+"px"}onDomNodeTop(e){this._deferredShow&&(this._deferredShow(),this._deferredShow=void 0)}package(){return r.mainPkg}writeFileAsync(e,t){return r.mainEditorPkg().setContentAsync(e,t)}readFile(e){return this.package().host().readFile(r.mainPkg,e)}showViewZoneAsync(){return this._deferredShow?Promise.resolve():new Promise((e=>{this._deferredShow=e,this.editor.changeViewZones((e=>{this.id=e.addZone(this)}))}))}resizeViewZoneAsync(){return this.id?new Promise((e=>{this.editor.changeViewZones((e=>{e.layoutZone(this.id)}))})):Promise.resolve()}getText(e){return this.model.getValueInRange(e)}blocksInfo(){return this.blocks}close(){this.fe.onClosed(),this.fe.dispose(),this.editor.changeViewZones((e=>{e.removeZone(this.id)}))}};i.ModalEditorHost=class{constructor(e,t,i){this.fe=e,this.range=t,this.model=i}contentDiv(){return null}getText(e){return this.model.getValueInRange(e)}blocksInfo(){return this.blocks}package(){return r.mainPkg}writeFileAsync(e,t){return r.mainEditorPkg().setContentAsync(e,t)}readFile(e){return this.package().host().readFile(r.mainPkg,e)}showAsync(e,t){return n.getBlocksAsync().then((t=>(this.blocks=t,this.fe.showEditorAsync(e,this.range,this))))}close(){this.fe.onClosed(),this.fe.dispose()}};i.FieldEditorManager=class{constructor(e){this.editor=e,this.fieldEditors=[],this.decorations={},this.liveRanges=[],this.fieldEditorsEnabled=!0,this.rangeID=0}setFieldEditorsEnabled(e){this.fieldEditorsEnabled=e,e||this.clearRanges(this.editor)}setCursorLine(e){if(this.fieldEditorsEnabled&&e!=this.currentCursorLine){const t=this.getInfoForLine(this.currentCursorLine);t&&this.reapplyDecorations(t.owner);const i=this.getInfoForLine(e);i&&this.reapplyDecorations(i.owner,e),this.currentCursorLine=e}}addFieldEditor(e){for(const t of this.fieldEditors)if(t.id===e.id)return;this.fieldEditors.push(e)}getDecorations(e){return this.decorations[e]||[]}allDecorations(){const e=[];return Object.keys(this.decorations).forEach((t=>e.push(...this.getDecorations(t)))),e}setDecorations(e,t){this.decorations[e]=t}clearRanges(e){e&&Object.keys(this.decorations).forEach((t=>{e.deltaDecorations(this.decorations[t],[])})),this.decorations={},this.liveRanges=[],this.rangeID=0}trackRange(e,t,i){return!this.getInfoForLine(t)&&(this.liveRanges.push({line:t,owner:e,range:i,id:this.rangeID++}),!0)}getFieldEditorById(e){for(const t of this.fieldEditors)if(t.id===e)return t}getInfoForLine(e){for(const t of this.liveRanges)if(t.line===e)return t}allRanges(){return this.liveRanges}allFieldEditors(){return this.fieldEditors}provideFoldingRanges(e,t,i){this.updateFieldEditorRanges(e);const n=this.liveRanges.map((e=>({start:e.range.startLineNumber,end:e.range.endLineNumber-1,kind:monaco.languages.FoldingRangeKind.Comment})));let r=a(e,!1);return n.forEach((e=>{r=r.filter((t=>t.start!=e.start))})),n.concat(r)}reapplyDecorations(e,t=-1){const i=this.fieldEditors.find((t=>t.id===e));if(!i)return;const n=this.decorations[e],r=this.liveRanges.filter((t=>t.owner===e)),o=this.editor.getModel(),s=[];for(const e of r){let n=i.glyphCssClass;e.line===t&&(n+=" pxt-monaco-glyph-highlight"),s.push({range:new monaco.Range(e.line,o.getLineMinColumn(e.line),e.line,o.getLineMaxColumn(e.line)),options:{glyphMarginClassName:n}})}this.setDecorations(i.id,this.editor.deltaDecorations(n,s))}updateFieldEditorRanges(e){this.clearRanges(this.editor),this.fieldEditorsEnabled&&this.allFieldEditors().sort(((e,t)=>(t.weight||0)-(e.weight||0))).forEach((t=>{const i=t.matcher,n=e.findMatches(i.searchString,!0,i.isRegex,i.matchCase,i.matchWholeWord?this.editor.getOptions().get(monaco.editor.EditorOption.wordSeparators):null,!1),r=[];n.forEach((i=>{const n=i.range.startLineNumber;this.getInfoForLine(n)||(r.push({range:new monaco.Range(n,e.getLineMinColumn(n),n,e.getLineMaxColumn(n)),options:{glyphMarginClassName:t.glyphCssClass}}),this.trackRange(t.id,n,i.range))})),this.setDecorations(t.id,this.editor.deltaDecorations([],r))}))}};class o{constructor(e){this._startIndexes=[],this._endIndexes=[],this._indentOccurrences=[],this._length=0,this._foldingRangesLimit=e}insertFirst(e,t,i){let n=this._length;this._startIndexes[n]=e,this._endIndexes[n]=t,this._length++,i<1e3&&(this._indentOccurrences[i]=(this._indentOccurrences[i]||0)+1)}toIndentRanges(e){if(this._length<=this._foldingRangesLimit){let e=new Uint32Array(this._length),t=new Uint32Array(this._length);for(let i=this._length-1,n=0;i>=0;i--,n++)e[n]=this._startIndexes[i],t[n]=this._endIndexes[i];return s(e,t)}{let t=0,i=this._indentOccurrences.length;for(let e=0;e<this._indentOccurrences.length;e++){let n=this._indentOccurrences[e];if(n){if(n+t>this._foldingRangesLimit){i=e;break}t+=n}}const n=e.getOptions().tabSize;let r=new Uint32Array(this._foldingRangesLimit),o=new Uint32Array(this._foldingRangesLimit);for(let s=this._length-1,a=0;s>=0;s--){let c=this._startIndexes[s],u=l(e.getLineContent(c),n);(u<i||u===i&&t++<this._foldingRangesLimit)&&(r[a]=c,o[a]=this._endIndexes[s],a++)}return s(r,o)}}}function s(e,t){const i=[];for(let n=0;n<e.length;n++)i.push({start:e[n],end:t[n],kind:monaco.languages.FoldingRangeKind.Region});return i}function a(e,t,i,n=5e3){const r=e.getOptions().tabSize;let s,a=new o(n);i&&(s=new RegExp(`(${i.start.source})|(?:${i.end.source})`));let c=[],u=e.getLineCount()+1;c.push({indent:-1,endAbove:u,line:u});for(let i=e.getLineCount();i>0;i--){let n,o=e.getLineContent(i),u=l(o,r),d=c[c.length-1];if(-1!==u){if(s&&(n=o.match(s))){if(!n[1]){c.push({indent:-2,endAbove:i,line:i});continue}{let e=c.length-1;for(;e>0&&-2!==c[e].indent;)e--;if(e>0){c.length=e+1,d=c[e],a.insertFirst(i,d.line,u),d.line=i,d.indent=u,d.endAbove=i;continue}}}if(d.indent>u){do{c.pop(),d=c[c.length-1]}while(d.indent>u);let e=d.endAbove-1;e-i>=1&&a.insertFirst(i,e,u)}d.indent===u?d.endAbove=i:c.push({indent:u,endAbove:i,line:i})}else t&&(d.endAbove=i)}return a.toIndentRanges(e)}function l(e,t){let i=0,n=0,r=e.length;for(;n<r;){let r=e.charCodeAt(n);if(32===r)i++;else{if(9!==r)break;i=i-i%t+t}n++}return n===r?-1:i}i.RangesCollector=o,i.computeRanges=a},{"./compiler":30,"./package":122}],118:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MonacoFlyout=void 0;const n=e("react"),r=e("./compiler"),o=e("./core"),s=e("./workspace"),a=e("./data"),l=e("./auth");class c extends a.Component{constructor(e){super(e),this.dragging=!1,this.getBlockClickHandler=e=>()=>{pxt.tickEvent("monaco.toolbox.itemclick",void 0,{interactiveConsent:!0}),this.setState({selectedBlock:e!=this.state.selectedBlock?e:void 0})},this.getBlockMouseOver=e=>()=>{pxt.tickEvent("monaco.toolbox.itemmouseover"),this.setState({hoverBlock:e!=this.state.hoverBlock?e:void 0})},this.getBlockMouseOut=e=>()=>{e==this.state.hoverBlock&&this.setState({hoverBlock:void 0})},this.getBlockDragStartHandler=(e,t,i)=>n=>{this.dragInfo={x:pxt.BrowserUtils.getClientX(n),y:pxt.BrowserUtils.getClientY(n),block:e,snippet:t,color:i}},this.isHorizontalDrag=e=>{const t=Math.abs(this.dragInfo.x-pxt.BrowserUtils.getClientX(e)),i=Math.abs(this.dragInfo.y-pxt.BrowserUtils.getClientY(e));return t>5&&i>5&&t>i},this.blockDragHandler=e=>{let t=document.getElementById("monacoDraggingBlock");if(this.dragInfo&&(t||this.isHorizontalDrag(e))){pxt.tickEvent("monaco.toolbox.itemdrag",void 0,{interactiveConsent:!0}),e.preventDefault(),e.stopPropagation();const i=this.dragInfo.block,n=i.parameters;if(this.dragging=!0,!t){const e=document.getElementById("root");e.style.overflow="hidden",(t=document.createElement("div")).id="monacoDraggingBlock",t.textContent=i.snippetOnly?i.snippet:`${this.getQName(i)||this.getSnippetName(i)}${n?`(${n.map((e=>e.name)).join(", ")})`:""}`,t.style.backgroundColor=this.dragInfo.color,e.appendChild(t),s.fireEvent({type:"create",editor:"ts",blockId:i.attributes.blockId});let r="";"void"!=i.retType&&(r="inline:1&"),this.props.setInsertionSnippet(this.dragInfo.snippet||r+"qName:"+i.qName)}t.style.top=`${pxt.BrowserUtils.getClientY(e)}px`,t.style.left=`${pxt.BrowserUtils.getClientX(e)}px`,this.setState({hide:!0})}},this.blockDragEndHandler=e=>{this.dragInfo=void 0,this.dragging=!1,this.props.setInsertionSnippet(void 0);const t=document.getElementById("monacoDraggingBlock");t&&t.remove(),document.getElementById("root").style.overflow=""},this.getKeyDownHandler=(e,t,i)=>n=>{const a=pxt.Util.isUserLanguageRtl(),l=o.keyCodeFromEvent(n),c=n.target;if(40==l){let e=c.nextElementSibling;c&&e&&(e.click(),e.focus())}else if(38==l){let e=c.previousElementSibling;c&&e&&(e.click(),e.focus())}else 37==l&&!a||38==l&&a?this.props.moveFocusToParent():27==l?(this.setState({groups:void 0}),this.props.moveFocusToParent()):13==l&&e&&(t?Promise.resolve(t):r.snippetAsync(e.qName,i)).then((t=>{this.props.insertSnippet(null,t,"void"!=e.retType),s.fireEvent({type:"create",editor:"ts",blockId:e.attributes.blockId})}))},this.getHelpButtonClickHandler=e=>()=>{pxt.debug(`${e} help icon clicked.`),s.fireEvent({type:"ui",editor:"ts",action:"groupHelpClicked",data:{group:e}})},this.wheelHandler=e=>{e.stopPropagation()},this.scrollHandler=e=>{this.positionDragHandle()},this.getFlyoutStyle=()=>{var e,t;return{display:(null===(e=this.state)||void 0===e?void 0:e.groups)&&!(null===(t=this.state)||void 0===t?void 0:t.hide)?"block":"none"}},this.getIconStyle=e=>({color:e}),this.getSelectedStyle=()=>({touchAction:pxt.BrowserUtils.hasPointerEvents()?"pan-y":void 0}),this.getBlockStyle=e=>({backgroundColor:e,border:this.getData(l.HIGHCONTRAST)?`2px solid ${e}`:"none",fontSize:`${this.props.parent.settings.editorFontSize}px`,lineHeight:`${this.props.parent.settings.editorFontSize+16}px`}),this.state={}}componentDidMount(){pxt.BrowserUtils.hasPointerEvents()?(document.addEventListener("pointermove",this.blockDragHandler),document.addEventListener("pointerup",this.blockDragEndHandler)):(document.addEventListener("mousemove",this.blockDragHandler),document.addEventListener("mouseup",this.blockDragEndHandler),pxt.BrowserUtils.isTouchEnabled()&&(document.addEventListener("touchmove",this.blockDragHandler),document.addEventListener("touchend",this.blockDragEndHandler)))}componentWillUnmount(){pxt.BrowserUtils.hasPointerEvents()?(document.removeEventListener("pointermove",this.blockDragHandler),document.removeEventListener("pointerup",this.blockDragEndHandler)):(document.removeEventListener("mousemove",this.blockDragHandler),document.removeEventListener("mouseup",this.blockDragEndHandler),pxt.BrowserUtils.isTouchEnabled()&&(document.removeEventListener("touchmove",this.blockDragHandler),document.removeEventListener("touchend",this.blockDragEndHandler)))}componentDidUpdate(){this.positionDragHandle()}getQName(e){return"python"==this.props.fileType&&e.pyQName?e.pyQName:e.qName}getSnippetName(e){return("python"==this.props.fileType?e.pySnippetName||e.pyName:void 0)||e.snippetName||e.name}getBlockDescription(e,t){let i=[],r=pxt.blocks.compileInfo(e),o=e.attributes._def&&e.attributes._def.parts,s=e.qName||e.name;const a="python"==this.props.fileType;return o?(t&&o.filter((e=>"param"==e.kind)).length>t.length&&t.unshift(null),o.forEach(((e,t)=>{switch(e.kind){case"label":i.push(n.createElement("span",{key:s+t},e.text));break;case"break":i.push(n.createElement("span",{key:s+t}," "));break;case"param":let o=null==r?void 0:r.definitionNameToParam[e.name],l=(null==o?void 0:o.defaultValue)||e.varName||(null==o?void 0:o.actualName)||e.name;a&&(null==o?void 0:o.defaultValue)&&(l=pxtc.tsSnippetToPySnippet(l)),i.push(n.createElement("span",{className:"argName",key:s+t},l))}}))):i.push(n.createElement("span",{key:s},this.getSnippetName(e)||e.name)),t&&t.find((e=>(null==e?void 0:e.type)&&e.type.indexOf("=>")>=0))&&(i.unshift(n.createElement("span",{key:"prefix"},lf("run code "))),(null==r?void 0:r.handlerArgs)&&(i.push(n.createElement("span",{key:"handler_break"}," ")),r.handlerArgs.forEach((e=>{e.inBlockDef||i.push(n.createElement("span",{className:"argName",key:`handler_${e.name}`},e.name))})))),i}positionDragHandle(){let e=document.querySelector(".monacoBlock.hover .blockHandle");if(e){let t=e.parentElement,i=document.getElementById("monacoFlyoutWrapper");e.style.height=`${t.clientHeight}px`,e.style.left=`${t.clientWidth}px`,e.style.top=t.offsetTop-i.scrollTop+"px"}let t=document.querySelector(".monacoBlock.expand .blockHandle");if(t){let e=t.parentElement,i=document.getElementById("monacoFlyoutWrapper");t.style.height=`${e.clientHeight+8}px`,t.style.left=e.clientWidth+4-1+"px",t.style.top=e.offsetTop-i.scrollTop+"px"}}getMonacoBlock(e,t,i){if(void 0===e.snippet)return;const{ns:r}=this.state,o=this.props.parent.state.editorState?this.props.parent.state.editorState.filters:void 0,s=o?o.namespaces&&null!=o.namespaces[r]?o.namespaces[r]:o.defaultState:void 0,a=this.props.blockIdMap&&this.props.blockIdMap[e.attributes.blockId];let l=o?o.defaultState:pxt.editor.FilterState.Visible;if(o&&o.fns&&void 0!==o.fns[e.name]?l=o.fns[e.name]:o&&o.blocks&&e.attributes.blockId&&(void 0!==o.blocks[e.attributes.blockId]||(null==a?void 0:a.some((e=>o.blocks[e]))))?l=o.blocks[e.attributes.blockId]:void 0!==s&&(l=s),l==pxt.editor.FilterState.Hidden)return;const c=l==pxt.editor.FilterState.Disabled,u="python"==this.props.fileType,d=u?e.pySnippet:e.snippet,p=e.parameters,h=e.attributes.color||i,f=this.getBlockDescription(e,p?p.slice():null),m=e.attributes.help,g=this.getQName(e)||this.getSnippetName(e),b=g==this.state.selectedBlock,v=g==this.state.hoverBlock,y=pxt.BrowserUtils.hasPointerEvents(),k=pxt.BrowserUtils.isTouchEnabled(),w=this.getBlockDragStartHandler(e,d,h),x=e.attributes.jsDoc.replace(/``/g,'"').split("* @param",1)[0];return n.createElement("div",{className:`monacoBlock ${c?"monacoDisabledBlock":""} ${b?"expand":""} ${v?"hover":""}`,style:this.getSelectedStyle(),title:e.attributes.jsDoc,key:`block_${g}_${t}`,tabIndex:0,role:"listitem",onClick:this.getBlockClickHandler(g),onMouseOver:this.getBlockMouseOver(g),onMouseOut:this.getBlockMouseOut(g),onKeyDown:this.getKeyDownHandler(e,d,u),onPointerDown:y?w:void 0,onMouseDown:y?void 0:w,onTouchStart:!y&&k?w:void 0},n.createElement("div",{className:"blockHandle",style:this.getSelectedStyle()},n.createElement("i",{className:"icon bars"})),n.createElement("div",{className:"monacoDraggableBlock",style:this.getBlockStyle(h)},n.createElement("span",{className:"blockName"},f)),n.createElement("div",{className:"detail"},n.createElement("div",{className:"description"},x),n.createElement("div",{className:"signature"},n.createElement("span",null,d||`${g}(${p?p.map((e=>`${e.name}`)).join(", "):""})`),m&&n.createElement("a",{className:"blockHelp",href:`/reference/${m}`,target:"_blank",rel:"noopener noreferrer",role:"button"},n.createElement("i",{className:"question circle outline icon","aria-label":lf("Open documentation")}))),p&&n.createElement("div",{className:"params"},p.map(((e,t)=>n.createElement("div",{key:t},n.createElement("div",{className:"separator"}),n.createElement("span",{className:"paramName"},e.name),e.description&&n.createElement("span",{className:"paramDescription"},e.description.replace(/``/g,'"'))))))))}renderCore(){const{name:e,ns:t,color:i,icon:r,groups:o}=this.state,s=pxt.toolbox.convertColor(i||t&&pxt.toolbox.getNamespaceColor(t)||"255"),a=`blocklyTreeIcon${r?(t||r).toLowerCase():"Default"}`.replace(/\s/g,"");return n.createElement("div",{id:"monacoFlyoutWidget",className:"monacoFlyout",style:this.getFlyoutStyle()},n.createElement("div",{id:"monacoFlyoutWrapper",onScroll:this.scrollHandler,onWheel:this.wheelHandler,role:"list"},n.createElement("div",{className:"monacoFlyoutLabel monacoFlyoutHeading"},n.createElement("span",{className:`monacoFlyoutHeadingIcon blocklyTreeIcon ${a}`,role:"presentation",style:this.getIconStyle(s)},r&&1===r.length?r:""),n.createElement("div",{className:"monacoFlyoutLabelText"},pxtc.U.rlf(`{id:category}${e}`))),o&&o.map(((e,t)=>{let i=[];if(e.name!=pxt.DEFAULT_GROUP_NAME&&o.length>1&&i.push(n.createElement("div",{className:"monacoFlyoutLabel blocklyFlyoutGroup",key:`label_${t}`,tabIndex:0,onKeyDown:this.getKeyDownHandler(),role:"separator"},e.icon&&n.createElement("span",{className:`monacoFlyoutHeadingIcon blocklyTreeIcon ${a}`,role:"presentation"},e.icon),n.createElement("div",{className:"monacoFlyoutLabelText"},pxtc.U.rlf(`{id:group}${e.name}`)),e.hasHelp&&pxt.editor.HELP_IMAGE_URI&&n.createElement("span",null,n.createElement("img",{src:pxt.editor.HELP_IMAGE_URI,onClick:this.getHelpButtonClickHandler(e.name),alt:lf("Click for help")})),n.createElement("hr",{className:"monacoFlyoutLabelLine"}))),e.blocks){let t=e.blocks.map(((e,t)=>e.attributes.blockBuiltin?void pxt.log("ignoring built in block: "+e.attributes.blockId):this.getMonacoBlock(e,t,s))).filter((e=>void 0!==e));if(!(t&&t.length>0))return null;i=i.concat(t)}return i}))))}}i.MonacoFlyout=c},{"./auth":20,"./compiler":30,"./core":78,"./data":81,"./workspace":151,react:335}],119:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.getToolboxDefinition=i.overrideToolbox=i.overrideCategory=i.clearBuiltinBlockCache=i.allBuiltinBlocksByName=i.allBuiltinBlocks=i.isBuiltin=i.getBuiltinCategory=i.blockIdMap=i.getPauseUntil=void 0;let n,r,o,s,a=null;function l(){return a||((a={}).loops={name:lf("{id:category}Loops"),nameid:"loops",blocks:[{name:"loops_while",snippetName:"while",snippet:"while (true) {\n    \n}",pySnippet:"while True:\n    pass",attributes:{blockId:"device_while",weight:48,jsDoc:lf("Repeat code while condition is true")}},{name:"loops_for",snippetName:"for",snippet:"for (let i = 0; i < 5; i++) {\n    \n}",pySnippet:"for i in range(4):\n    pass",attributes:{blockId:"pxt_controls_for",weight:47,jsDoc:lf("Repeat code a number of times in a loop")}}],attributes:{callingConvention:0,icon:"loops",weight:50.09,paramDefl:{}}},a.logic={name:lf("{id:category}Logic"),nameid:"logic",blocks:[{name:"logic_if",snippetName:"if",snippet:"if (true) {\n    \n}",pySnippet:"if True:\n    pass",attributes:{blockId:"controls_if",weight:49,jsDoc:lf("Runs code if the condition is true")}},{name:"logic_if_else",snippetName:"if else",snippet:"if (true) {\n    \n} else {\n    \n}",pySnippet:"if True:\n    pass\nelse:\n    pass",attributes:{blockId:"controls_if",weight:48,jsDoc:lf("Runs code if the condition is true; else run other code")}},{name:"logic_and",snippetName:"and",snippet:"true && true",pySnippet:"True and True",attributes:{blockId:"logic_compare",weight:47,jsDoc:lf("Runs code if both specified conditions are true")}},{name:"logic_or",snippetName:"or",snippet:"true || false",pySnippet:"True or False",attributes:{blockId:"logic_compare",weight:46,jsDoc:lf("Runs code if either of two specified conditions is true")}}],attributes:{callingConvention:0,weight:50.08,icon:"logic",paramDefl:{}}},a.variables={name:lf("{id:category}Variables"),nameid:"variables",blocks:[{name:"var_let",snippetName:"let",snippet:"let item: number",pySnippet:"item = 0",pySnippetName:"item = 0",snippetOnly:!0,attributes:{blockId:"variables_set",jsDoc:lf("Declares a variable named 'item'")}},{name:"var_equals",snippetName:"equals",snippet:"item = 0",pySnippet:"item = 0",snippetOnly:!0,attributes:{blockId:"variables_get",jsDoc:lf("Assigns a value to a variable")}},{name:"var_change",snippetName:"change",snippet:"item += 1",pySnippet:"item += 1",snippetOnly:!0,attributes:{blockId:"variables_change",jsDoc:lf("Changes the value of item by 1")}}],attributes:{callingConvention:0,weight:50.07,icon:"variables",paramDefl:{}}},a.Math={name:lf("{id:category}Math"),nameid:"Math",blocks:[{name:"Math.plus",snippetName:"plus",snippet:"1 + 1",pySnippet:"1 + 1",snippetOnly:!0,attributes:{weight:90,blockId:"math_arithmetic",jsDoc:lf("Adds two numbers together")},retType:"number"},{name:"Math.minus",snippetName:"minus",snippet:"1 - 1",pySnippet:"1 - 1",snippetOnly:!0,attributes:{weight:89,blockId:"math_arithmetic",jsDoc:lf("Subtracts the value of one number from another")},retType:"number"},{name:"Math.multiply",snippetName:"multiply",snippet:"1 * 1",pySnippet:"1 * 1",snippetOnly:!0,attributes:{weight:88,blockId:"math_arithmetic",jsDoc:lf("Multiplies two numbers together")},retType:"number"},{name:"Math.divide",snippetName:"divide",snippet:"1 / 1",pySnippet:"1 / 1",snippetOnly:!0,attributes:{weight:87,blockId:"math_arithmetic",jsDoc:lf("Returns the quotient of one number divided by another")},retType:"number"},{name:"Math.remainder",snippetName:"remainder",snippet:"1 % 2",pySnippet:"1 % 2",snippetOnly:!0,attributes:{weight:80,blockId:"math_modulo",jsDoc:lf("Returns the remainder of one number divided by another")},retType:"number"},{name:"Math.max",snippetName:"max",snippet:"Math.max(1, 2)",pySnippet:"max(1, 2)",attributes:{weight:75,blockId:"math_op2",jsDoc:lf("Returns the largest of two numbers")},retType:"number"},{name:"Math.min",snippetName:"min",snippet:"Math.min(1, 2)",pySnippet:"min(1, 2)",attributes:{weight:74,blockId:"math_op2",jsDoc:lf("Returns the smallest of two numbers")},retType:"number"},{name:"Math.abs",snippetName:"abs",snippet:"Math.abs(-1)",pySnippet:"abs(-1)",attributes:{weight:70,blockId:"math_op3",jsDoc:lf("Returns the absolute value of a number")},retType:"number"},{name:"randint",snippetName:"randint",snippet:"randint(0, 10)",pySnippetName:"randint",pySnippet:"randint(0, 10)",attributes:{weight:65,blockId:"device_random",jsDoc:lf("Returns a random number between min and max")},retType:"number"}],attributes:{callingConvention:0,weight:50.06,icon:"math",paramDefl:{}}},a.functions={name:lf("{id:category}Functions"),nameid:"functions",blocks:[{name:"functionDef",snippetName:"function doSomething",snippet:"function doSomething() {\n    \n}",pySnippetName:"def do_something",pySnippet:"def do_something():\n    pass",attributes:{blockId:"procedures_defnoreturn",jsDoc:lf("Define a function")}},{name:"functionCall",snippetName:"doSomething",snippet:"doSomething()",pySnippetName:"do_something",pySnippet:"do_something()",attributes:{blockId:"procedures_callnoreturn",jsDoc:lf("Call a function")}}],attributes:{advanced:!0,weight:50.08,callingConvention:0,icon:"functions",paramDefl:{}}},a.arrays={name:lf("{id:category}Arrays"),nameid:"arrays",custom:!0,blocks:[{name:"array_create",snippetName:"create",snippet:`let ${lf("{id:snippets}list")} = [1, 2, 3];`,pySnippet:`${lf("{id:snippets}list")} = [1, 2, 3]`,snippetOnly:!0,attributes:{weight:100,blockId:"lists_create_with",jsDoc:lf("Creates a new Array")},retType:"array"},{name:"array_length",snippetName:"length",snippet:`${lf("{id:snippets}list")}.length`,pySnippetName:"len",pySnippet:`len(${lf("{id:snippets}list")})`,snippetOnly:!0,attributes:{weight:99,blockId:"lists_length",jsDoc:lf("Returns the number of values in an Array")},retType:"number"},{name:"array_get",snippetName:"get",snippet:`${lf("{id:snippets}list")}[0]`,pySnippet:`${lf("{id:snippets}list")}[0]`,snippetOnly:!0,attributes:{weight:98,blockId:"lists_index_get",jsDoc:lf("Returns the value in the Array at the given index")}},{name:"array_set",snippetName:"set",snippet:`${lf("{id:snippets}list")}[0] = 1`,pySnippet:`${lf("{id:snippets}list")}[0] = 1`,snippetOnly:!0,attributes:{weight:97,blockId:"lists_index_set",jsDoc:lf("Overwrites the value in an Array at the given index")}},{name:"array_push",snippetName:"push",snippet:`${lf("{id:snippets}list")}.push(1)`,pySnippetName:"append",pySnippet:`${lf("{id:snippets}list")}.append(1)`,attributes:{weight:96,blockId:"array_push",jsDoc:lf("Adds a value to the end of an Array")}},{name:"arary_pop",snippetName:"pop",snippet:`${lf("{id:snippets}list")}.pop()`,pySnippetName:"pop",pySnippet:`${lf("{id:snippets}list")}.pop()`,attributes:{weight:95,blockId:"array_pop",jsDoc:lf("Removes and returns the value at the end of an Array")},retType:"object"},{name:"array_insertAt",snippetName:"insertAt",snippet:`${lf("{id:snippets}list")}.insertAt(0, 0)`,pySnippetName:"insert",pySnippet:`${lf("{id:snippets}list")}.insert(0, 0)`,attributes:{weight:50,blockId:"array_insertAt",jsDoc:lf("Inserts a value into the Array at the given index"),advanced:!0}},{name:"array_removeAt",snippetName:"removeAt",snippet:`${lf("{id:snippets}list")}.removeAt(0)`,attributes:{weight:49,blockId:"array_removeat",jsDoc:lf("Removes a value from the Array at the given index and returns it"),advanced:!0},retType:"object"},{name:"array_shift",snippetName:"shift",snippet:`${lf("{id:snippets}list")}.shift()`,attributes:{weight:48,blockId:"array_shift",jsDoc:lf("Removes and returns the value at the front of an Array"),advanced:!0}},{name:"array_unshift",snippetName:"unshift",snippet:`${lf("{id:snippets}list")}.unshift(0)`,pySnippetName:"append",pySnippet:`${lf("{id:snippets}list")}.append(0)`,attributes:{weight:47,blockId:"array_unshift",jsDoc:lf("Inserts a value at the beginning of an Array"),advanced:!0}},{name:"array_indexOf",snippetName:"indexOf",snippet:"[0, 1, 2].indexOf(1)",pySnippetName:"index",pySnippet:"[0, 1, 2].index(1)",attributes:{weight:46,jsDoc:lf("Returns the first index in the Array that contains the given value or -1 if it does not exist in the Array"),advanced:!0},retType:"number"},{name:"array_reverse",snippetName:"reverse",snippet:`${lf("{id:snippets}list")}.reverse()`,pySnippet:`${lf("{id:snippets}list")}.reverse()`,attributes:{weight:45,jsDoc:lf("Reverses the contents of an Array"),advanced:!0}}],attributes:{advanced:!0,weight:50.07,icon:"arrays",callingConvention:0,paramDefl:{}}},a.text={name:lf("{id:category}Text"),nameid:"text",custom:!0,blocks:[{name:"text_length",snippetName:"length",snippet:'"".length',pySnippetName:"len",pySnippet:'len("")',snippetOnly:!0,attributes:{blockId:"text_length",jsDoc:lf("Returns the number of characters in a string")},retType:"number"},{name:"text_concat",snippetName:"concat",snippet:'"" + 5',pySnippet:'"" + 5',snippetOnly:!0,attributes:{blockId:"text_join",jsDoc:lf("Combines a string with a number, boolean, string, or other object into one string")},retType:"string"},{name:"text_compare",snippetName:"compare",snippet:'"".compare("")',attributes:{blockId:"string_compare",jsDoc:lf("Compares one string against another alphabetically and returns a number")},retType:"number"},{name:"text_parseInt",snippetName:"parseInt",snippet:'parseInt("5")',pySnippetName:"int",pySnippet:'int("5")',attributes:{blockId:"string_parseint",jsDoc:lf("Converts a number written as text into a number")},retType:"number"},{name:"text_substr",snippetName:"substr",snippet:'"".substr(0, 0)',pySnippet:'""[0:1]',attributes:{blockId:"string_substr",jsDoc:lf("Returns the part of a string starting at a given index with the given length")},retType:"string"},{name:"text_charAt",snippetName:"charAt",snippet:'"".charAt(0)',pySnippetName:"str[0]",pySnippet:'""[0]',attributes:{blockId:"string_get",jsDoc:lf("Returns the character at the given index")},retType:"string"}],attributes:{advanced:!0,weight:50.06,icon:"text",callingConvention:0,paramDefl:{}}},a.addpackage={name:pxt.toolbox.addPackageTitle(),nameid:"addpackage",blocks:[],custom:!0,customClick:e=>(e.closeFlyout(),e.showPackageDialog(),!0),attributes:{advanced:!0,weight:-1,icon:"addpackage",callingConvention:0,paramDefl:{}}}),a}function c(){if(n)return n;const e=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock;if(e){const t=e.callName||"pauseUntil";let i=`${t}(() => true)`;e.namespace&&(i=`${e.namespace}.${i}`),n={name:"pause_until",snippetName:t,snippet:i,attributes:{blockNamespace:e.category||"loops",weight:null==e.weight?0:e.weight,jsDoc:lf("Pause execution of code until the given boolean expression is true"),advanced:!1}}}return n}function u(e){return l()[e]}function d(){o||(o={},s={},[u("loops"),u("logic"),u("Math"),u("text"),u("arrays"),u("variables"),u("functions")].forEach((e=>{e.blocks.forEach((t=>{t.type||t.snippet&&(t.attributes.blockId&&!o[t.attributes.blockId]&&(o[t.attributes.blockId]=[t,e.nameid]),s[t.name]||(s[t.name]=[t,e.nameid]))}))})))}function p(e,t){const i=u(e);if(t&&i&&(0===Object.keys(t).length&&(i.removed=!0),t.name&&(i.name=t.name),t.icon&&(i.attributes.icon=t.icon),void 0!==t.weight&&(i.attributes.weight=t.weight),void 0!==t.advanced&&(i.attributes.advanced=t.advanced),null!=t.groups&&(i.groups=t.groups),t.blocks)){let e=100;i.blocks=t.blocks.map(((t,i)=>(t.weight?e=t.weight:e--,function(e,t){return{name:e.name,snippet:e.snippet,pySnippet:e.pySnippet,snippetName:e.snippetName,pySnippetName:e.pySnippetName,snippetOnly:e.snippetOnly,attributes:{blockId:e.blockId,weight:t||e.weight,advanced:e.advanced,jsDoc:e.jsDoc,group:e.group},retType:e.retType,blockXml:e.blockXml}}(t,e))))}}function h(e){return{name:e.name,icon:e.attributes.icon,color:e.attributes.color,weight:e.attributes.weight,advanced:e.attributes.advanced,blocks:e.blocks?e.blocks.map((e=>function(e){return{name:e.name,snippet:e.snippet,pySnippet:e.pySnippet,snippetName:e.snippetName,pySnippetName:e.pySnippetName,snippetOnly:e.snippetOnly,retType:e.retType,weight:e.attributes.weight,advanced:e.attributes.advanced,jsDoc:e.attributes.jsDoc,group:e.attributes.group,blockXml:e.blockXml,blockId:e.attributes.blockId}}(e))):[]}}i.getPauseUntil=c,i.blockIdMap=function(){if(!r){r={pxt_controls_for:["controls_repeat_ext"]};const e=pxt.appTarget.blockIdMap;e&&Object.keys(e).forEach((t=>r[t]=e[t]))}return r},i.getBuiltinCategory=u,i.isBuiltin=function(e){return!!l()[e]},i.allBuiltinBlocks=function(){d();const e=c();return e&&(o[pxtc.PAUSE_UNTIL_TYPE]=[e,"pause_until"]),o},i.allBuiltinBlocksByName=function(){d();const e=c();return e&&(s[pxtc.PAUSE_UNTIL_TYPE]=[e,"pause_until"]),s},i.clearBuiltinBlockCache=function(){o=void 0,s=void 0},i.overrideCategory=p,i.overrideToolbox=function(e){p("loops",e.loops),p("logic",e.logic),p("variables",e.variables),p("Math",e.maths),p("text",e.text),p("arrays",e.arrays),p("functions",e.functions)},i.getToolboxDefinition=function(){return{loops:h(u("loops")),logic:h(u("logic")),variables:h(u("variables")),maths:h(u("Math")),text:h(u("text")),arrays:h(u("arrays")),functions:h(u("functions"))}}},{}],120:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.fixIndentationInRange=i.provideDocumentRangeFormattingEdits=void 0;function n(e){return e&&e.match(/^ */)[0].length||0}function r(e,t){return new Array(e+1).join(" ")+t.trim()}function o(e,t,i){return e.slice(t.getOffsetAt({lineNumber:i,column:0}),t.getOffsetAt({lineNumber:i+1,column:0}))}function s(e,t,i){const s=e.getValue(),a=e.getOffsetAt({lineNumber:t.startLineNumber,column:0}),l=e.getOffsetAt({lineNumber:t.startLineNumber,column:t.startColumn}),c=e.getOffsetAt({lineNumber:t.endLineNumber,column:t.endColumn});let u;u=i?(s.slice(a,l)+i).split("\n"):s.slice(a,c).split("\n");const d=a!==l&&!!s.substring(a,l).trim(),p=u.map(((e,t)=>e?t:-1)).filter((e=>e>=0));let h=t.startLineNumber-1,f=o(s,e,h);for(;!f&&h>0;)f=o(s,e,h-=1);let m=n(f);(function(e){return":"==(e=e.trim())[e.length-1]})(f)&&(m+=4),u[0]=d?u[0]:r(m,u[0]);for(let e=1;e<p.length;e++){let t=p[e],i=u[t],o=n(i);u[t]=r(m+o,i)}return[{text:u.join("\n"),range:t.setStartPosition(t.startLineNumber,0)}]}i.provideDocumentRangeFormattingEdits=function(e,t,i,n){return s(e,t)},i.fixIndentationInRange=s},{}],121:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.NotificationBanner=i.GenericBanner=void 0;const n=e("react"),r=e("./data"),o=e("./sui");class s extends r.Component{constructor(e){super(e),this.delayTime=this.props.delayTime||0,this.doneSleeping=this.sleepDone(),this.bannerType=this.props.bannerType||"default",this.handleClick=this.handleClick.bind(this)}componentDidMount(){this.doneSleeping&&(this.timer=setTimeout((()=>this.show()),this.delayTime))}componentWillUnmount(){clearTimeout(this.timer)}sleepDone(){if(!this.props.sleepTime)return!0;const e=parseInt(pxt.storage.getLocal("lastBannerClosedTime")||"0");return pxt.Util.nowSeconds()-e>this.props.sleepTime}show(){pxt.tickEvent(`notificationBanner.${this.props.id}.show`),this.props.displayTime&&(this.timer=setTimeout((()=>this.hide("automatic")),this.delayTime+this.props.displayTime)),this.props.parent.setBannerVisible(!0),this.render()}hide(e){pxt.tickEvent(`notificationBanner.${this.props.id}.`+e+"Close"),pxt.storage.setLocal("lastBannerClosedTime",pxt.Util.nowSeconds().toString()),this.props.parent.setBannerVisible(!1),this.render()}handleClick(){this.hide("manual"),clearTimeout(this.timer)}renderCore(){return this.props.parent.state.bannerVisible&&this.doneSleeping?n.createElement("div",{id:"notificationBanner",className:`ui attached ${this.bannerType} message`},n.createElement("div",{className:"bannerLeft"},n.createElement("div",{className:"content"},this.props.children)),n.createElement("div",{className:"bannerRight"},n.createElement(o.Icon,{icon:"close",tabIndex:0,onClick:this.handleClick}))):n.createElement("div",null)}}i.GenericBanner=s;class a extends r.Component{constructor(e){super(e),this.state={},this.clearExperiments=this.clearExperiments.bind(this)}clearExperiments(){pxt.tickEvent("banner.experiments",void 0,{interactiveConsent:!0}),pxt.editor.experiments.clear(),this.props.parent.reloadEditor()}handleBannerClick(){pxt.tickEvent("winApp.banner",void 0),window.open("/windows-app","_blank")}renderCore(){const e=pxt.appTarget.appTheme,t=pxt.winrt.isWinRT()||pxt.BrowserUtils.isElectron(),i="localhost"===location.hostname,r="/"!==location.pathname&&-1===(e.appPathNames||[]).indexOf(location.pathname),a=!i&&t&&r,l=pxt.editor.experiments.someEnabled()&&!/experiments=1/.test(window.location.href),c=pxt.appTarget.appTheme.showWinAppDeprBanner&&pxt.BrowserUtils.isWinRT(),u=lf("This app is being deprecated. Please use the website instead.");if(c)return n.createElement(s,{id:"winAppBanner",parent:this.props.parent,bannerType:"negative"},n.createElement(o.Icon,{icon:"warning circle"}),n.createElement("div",{className:"header"},u),n.createElement(o.Link,{className:"link",ariaLabel:lf("More info"),onClick:this.handleBannerClick},lf("More info")));if(l){const e=2e4;return n.createElement(s,{id:"experimentsbanner",parent:this.props.parent,bannerType:"negative",displayTime:e},n.createElement(o.Icon,{icon:"information circle"}),n.createElement("div",{className:"header"},lf("Experiments enabled.")),n.createElement(o.Link,{className:"link",ariaLabel:lf("Clear"),onClick:this.clearExperiments},lf("Clear")))}if(a){const e=pxt.appTarget.appTheme.homeUrl+location.search+location.hash;return n.createElement(s,{id:"experimental",parent:this.props.parent,bannerType:"negative"},n.createElement(o.Icon,{icon:"warning circle"}),n.createElement("div",{className:"header"},lf("You are viewing an experimental version of the editor")),n.createElement(o.Link,{className:"link",ariaLabel:lf("Go back to live editor"),href:e},lf("Take me back")))}return n.createElement("div",null)}}i.NotificationBanner=a},{"./data":81,"./sui":143,react:335}],122:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.getExtensionOfFileName=i.invalidatePagesStatus=i.invalidatePullRequestStatus=i.invalidatePullStatus=i.loadPkgAsync=i.notifySyncDone=i.allEditorPkgs=i.genFileName=i.mainEditorPkg=i.getEditorPkg=i.mainPkg=i.EditorPackage=i.File=i.setupAppTarget=void 0;const n=e("./workspace"),r=e("./data"),o=e("./core"),s=e("./db"),a=e("./compiler");var l=pxt.Util;let c=new s.Table("hostcache"),u={ts:10,blocks:20,jres:25,json:30,md:40};i.setupAppTarget=function(e){pxt.setAppTarget(e)};const d=".g.";class p{constructor(e,t,i){this.epkg=e,this.name=t,this.content=i,this.inSyncWithEditor=!0}isReadonly(){return!this.epkg.header||this.isAutoGenerated()}getName(){return this.epkg.getPkgId()+"/"+this.name}getTextFileName(){return this.epkg.isTopLevel()?this.name:"pxt_modules/"+this.epkg.getPkgId()+"/"+this.name}getFileNameWithExtension(e){const t=this.getTextFileName();return t.substring(0,t.length-this.getExtension().length)+e}getExtension(){return y(this.name)}getVirtualFileName(e){const t=this.name.replace(/.*\./,""),i=t?this.name.slice(0,-t.length-1):this.name;if(/^blocks|py|ts$/.test(t))switch(e){case pxt.BLOCKS_PROJECT_NAME:return i+".blocks";case pxt.JAVASCRIPT_PROJECT_NAME:return i+".ts";case pxt.PYTHON_PROJECT_NAME:return i+".py";default:return void pxt.U.oops()}}weight(){return/^main\./.test(this.name)?5:/^_locales\//.test(this.name)?500:u.hasOwnProperty(this.getExtension())?u[this.getExtension()]:60}markDirty(){this.inSyncWithEditor=!1,this.updateStatus()}updateStatus(){r.invalidate("open-meta:"+this.getName())}setBaseGitContent(e){e!=this.baseGitContent&&(this.baseGitContent=e,this.updateStatus())}setContentAsync(e,t){if(l.assert(void 0!==e),this.inSyncWithEditor=!0,e!=this.content){let i=this.content;return this.content=e,this.updateStatus(),this.epkg.saveFileAsync(this.name).then((()=>{this.content==e&&this.updateStatus(),t&&this.forceChangeCallback&&this.forceChangeCallback(i,e),this.name==pxt.github.GIT_JSON&&this.epkg.updateGitJsonCache()}))}return this.updateStatus(),Promise.resolve()}setForceChangeCallback(e){this.forceChangeCallback=e}publishedContent(){let e=this.content;return this.name==pxt.CONFIG_NAME&&(e=n.prepareConfigForGithub(e)),e}isAutoGenerated(){return"this"===this.epkg.getPkgId()&&(this.name===pxt.TILEMAP_CODE||this.name===pxt.TILEMAP_JRES||this.name===pxt.IMAGES_CODE||this.name===pxt.IMAGES_JRES||this.name===pxt.TUTORIAL_INFO_FILE||this.name==pxt.ASSETS_FILE)}}i.File=p;class h{constructor(e,t){this.ksPkg=e,this.topPkg=t,this.files={},this.onupdate=()=>{},this.saveScheduled=!1,this.savingNow=0,this.simStateSaveScheduled=!1,this.transpileCache=[],e&&"workspace"==e.verProtocol()&&(this.header=n.getHeader(e.verArgument()))}getSimState(){if(!this.simState){this.files[pxt.SIMSTATE_JSON]||this.setFile(pxt.SIMSTATE_JSON,"{}");const e=this.files[pxt.SIMSTATE_JSON];try{this.simState=JSON.parse(e.content)}catch(e){this.simState={}}}return this.simState}setSimState(e,t){const i=this.getSimState();i[e]!=t&&(null==t?delete i[e]:i[e]=t,this.simStateSaveScheduled||(this.simStateSaveScheduled=!0,setTimeout((()=>{if(this.simStateSaveScheduled=!1,!this.simState)return;const e=this.files[pxt.SIMSTATE_JSON];e&&e.setContentAsync(JSON.stringify(this.simState))}),2e3)))}getTopHeader(){return this.topPkg.header}getLanguageRestrictions(){const e=this.topPkg.ksPkg,t=e&&e.config;return t&&t.languageRestriction}getGeneratedFiles(e){if(e.name.indexOf(d)>-1){const t=e.name.substring(0,e.name.indexOf(d)+d.length);return l.values(this.files).filter((i=>i!==e&&pxt.U.startsWith(i.name,t)))}return[]}afterMainLoadAsync(){return this.assetsPkg?this.assetsPkg.loadAssetsAsync():Promise.resolve()}saveAssetAsync(e,t){return n.saveAssetAsync(this.header.id,e,t).then((()=>this.assetsPkg.loadAssetsAsync()))}loadAssetsAsync(){return"assets"!=this.id?Promise.resolve():n.listAssetsAsync(this.topPkg.header.id).then((e=>{let t=l.flatClone(this.files);for(let i of e){let e=i.name,n=l.lookup(this.files,e);n?delete t[e]:(n=new p(this,e,`File size: ${i.size}; URL: ${i.url}`),this.files[e]=n)}for(let e of Object.keys(t))delete this.files[e];let i="";for(let t of this.sortedFiles()){let n=e.filter((e=>e.name==t.name))[0];i+=`    export const ${t.name.replace(/\..*/,"").replace(/[^a-zA-Z0-9_]/g,"_")} = "${n.url}";\n`}let n=this.topPkg.lookupFile("assets.ts");if(n||i){i=`namespace assets {\n${i}}\n`;let e=this.topPkg.ksPkg.config;if(e.files.indexOf("assets.ts")<0&&(e.files.push("assets.ts"),this.topPkg.ksPkg.saveConfig()),n)return n.setContentAsync(i);this.topPkg.setFile("assets.ts",i)}return Promise.resolve()}))}makeTopLevel(){this.topPkg=this,this.outputPkg=new h(null,this),this.outputPkg.id="built",pxt.appTarget.runtime&&pxt.appTarget.runtime.assetExtensions&&(this.assetsPkg=new h(null,this),this.assetsPkg.id="assets")}updateConfigAsync(e){let t=this.files[pxt.CONFIG_NAME];if(t)try{let i=JSON.parse(t.content);return e(i),t.setContentAsync(pxt.Package.stringifyConfig(i)).then((()=>this.ksPkg.loadConfig()))}catch(e){}return null}updateDepAsync(e){let t=this.ksPkg.resolveDep(e);if(!t||"github"!=t.verProtocol())return Promise.resolve();let i=pxt.github.parseRepoId(t.verArgument());return i?pxt.targetConfigAsync().then((e=>pxt.github.latestVersionAsync(i.slug,e.packages))).then((e=>{const t=l.values(this.ksPkg.dependencies()).map((e=>pxt.github.parseRepoId(e))).filter((e=>(null==e?void 0:e.slug)===i.slug));return Promise.all(t.map((t=>(t.tag=e,pxt.github.pkgConfigAsync(t.fullName,t.tag).catch(o.handleNetworkError).then((e=>({ghid:t,cfg:e})))))))})).then((e=>this.updateConfigAsync((t=>e.forEach((({ghid:e,cfg:i})=>t.dependencies[i.name]=pxt.github.stringifyRepo(e))))))).then((()=>this.saveFilesAsync())):Promise.resolve()}removeDepAsync(e){return this.updateConfigAsync((t=>delete t.dependencies[e])).then((()=>this.saveFilesAsync()))}setDependencyAsync(e,t){return this.updateConfigAsync((i=>i.dependencies[e]=t)).then((()=>this.saveFilesAsync()))}getKsPkg(){return this.ksPkg}getPkgId(){return this.ksPkg?this.ksPkg.id:this.id}isTopLevel(){return this.ksPkg&&0==this.ksPkg.level}setFile(e,t,i){let n=new p(this,e,t);return i&&(n.virtual=!0),this.files[e]=n,r.invalidate("open-meta:"),n}removeFileAsync(e){return delete this.files[e],r.invalidate("open-meta:"),this.updateConfigAsync((t=>{t.files=t.files.filter((t=>t!=e)),t.testFiles&&(t.testFiles=t.testFiles.filter((t=>t!=e)))}))}setContentAsync(e,t){let i=this.files[e],n=Promise.resolve();return i||(i=new p(this,e,""),this.files[e]=i,n=n.then((()=>this.updateConfigAsync((t=>t.files.indexOf(e)<0?t.files.push(e):0))))),n.then((()=>i.setContentAsync(t)))}updateGitJsonCache(){const e=this.files[pxt.github.GIT_JSON];if(e){const t=JSON.parse(e.content),i=pxt.github.parseRepoId(t.repo);t.commit&&Object.keys(this.files).forEach((e=>{const n=pxt.github.lookupFile(i,t.commit,e);n&&null!=n.blobContent&&this.files[e].setBaseGitContent(n.blobContent)}))}}setFiles(e){this.files=l.mapMap(e,((e,t)=>new p(this,e,t))),r.invalidate("open-meta:"),this.updateGitJsonCache()}getAllFiles(){let e=l.mapMap(this.files,((e,t)=>t.content));return delete e[pxt.SERIAL_EDITOR_FILE],e}saveFileAsync(e){var t;if(!this.header)return Promise.resolve();const i=null===(t=this.files[e])||void 0===t?void 0:t.content;return e===pxt.CONFIG_NAME?this.saveFilesAsync():n.partialSaveAsync(this.header.id,e,i)}saveFilesAsync(){if(!this.header)return Promise.resolve();let e=this.files[pxt.CONFIG_NAME];if(e)try{let t=JSON.parse(e.content);this.header.name=t.name}catch(e){}return n.saveAsync(this.header,this.getAllFiles())}sortedFiles(){let e=l.values(this.files);return pxt.options.debug||(e=e.filter((e=>e.name!=pxt.github.GIT_JSON&&e.name!=pxt.SIMSTATE_JSON&&e.name!=pxt.SERIAL_EDITOR_FILE))),e.sort(((e,t)=>e.weight()-t.weight()||l.strcmp(e.name,t.name))),e}forEachFile(e){this.pkgAndDeps().forEach((t=>{l.values(t.files).forEach(e)}))}getMainFile(){return this.sortedFiles()[0]}pkgAndDeps(){if(this.topPkg!=this)return this.topPkg.pkgAndDeps();let e=this.ksPkg.deps,t=Object.keys(e),i=[];for(let n of t)/---/.test(n)||e[n].cppOnly||i.push(g(e[n]));return this.assetsPkg&&i.push(this.assetsPkg),i.push(this.outputPkg),i}filterFiles(e){return l.concat(this.pkgAndDeps().map((t=>l.values(t.files).filter(e))))}lookupFile(e){return 0===e.indexOf("pxt_modules/")&&(e=e.slice(12)),this.filterFiles((t=>t.getName()==e))[0]}buildAssetsAsync(){var e;return(null===(e=this.tilemapProject)||void 0===e?void 0:e.needsRebuild)?(this.tilemapProject.needsRebuild=!1,this.buildTilemapsAsync().then((()=>this.buildImagesAsync()))):Promise.resolve()}buildTilemapsAsync(){const e=this.lookupFile("this/"+pxt.TILEMAP_CODE),t=this.lookupFile("this/"+pxt.TILEMAP_JRES),n=this.tilemapProject.getProjectTilesetJRes();if(!e&&1===Object.keys(n).length)return Promise.resolve();const r=pxt.emitTilemapsFromJRes(n),o=JSON.stringify(n,null,4);return(null==e?void 0:e.content)===r&&(null==t?void 0:t.content)===o?Promise.resolve():this.setContentAsync(pxt.TILEMAP_JRES,o).then((()=>this.setContentAsync(pxt.TILEMAP_CODE,r))).then((()=>{i.mainPkg.updateJRes(),a.refreshLanguageServiceApisInfo()}))}buildImagesAsync(){const e=this.lookupFile("this/"+pxt.IMAGES_CODE),t=this.lookupFile("this/"+pxt.IMAGES_JRES),n=this.tilemapProject.getProjectAssetsJRes();if(!e&&1===Object.keys(n).length)return Promise.resolve();const r=pxt.emitProjectImages(n),o=JSON.stringify(n,null,4);return(null==e?void 0:e.content)===r&&(null==t?void 0:t.content)===o?Promise.resolve():this.setContentAsync(pxt.IMAGES_JRES,o).then((()=>this.setContentAsync(pxt.IMAGES_CODE,r))).then((()=>{i.mainPkg.updateJRes(),a.refreshLanguageServiceApisInfo()}))}cacheTranspile(e,t,i,n){this.transpileCache.push({fromLanguage:e,fromText:t,toLanguage:i,toText:n}),this.transpileCache.length>10&&this.transpileCache.shift()}getCachedTranspile(e,t,i){for(const n of this.transpileCache){if(n.toLanguage===e&&n.fromLanguage===i&&f(e,n.toText,t))return n.fromText;if(n.fromLanguage===e&&n.toLanguage===i&&f(e,n.fromText,t))return n.toText}return null}invalidateCachedTranspile(e,t,i){for(let n=0;n<this.transpileCache.length;n++){const r=this.transpileCache[n],o=r.toLanguage===e&&r.fromLanguage===i&&f(e,r.toText,t),s=r.fromLanguage===e&&r.toLanguage===i&&f(e,r.fromText,t);if(o||s)return void this.transpileCache.splice(n,1)}}addDependencyAsync(e,t,i){return this.topPkg!==this?this.topPkg.addDependencyAsync(e,t):this.ksPkg.findConflictsAsync(e,t).then((n=>{let r=e.core?[]:n.filter((e=>this.ksPkg.isPackageInUse(e.pkg0.id))),s=Promise.resolve(!0);if(r.length)s=s.then((()=>o.confirmAsync({header:lf("Cannot add {0} extension",e.name),hideCancel:!0,agreeLbl:lf("Ok"),body:lf("Remove all the blocks from the {0} extension and try again.",r[0].pkg0.id)}))).then((()=>!1));else if(n.length){const t=1===n.length?lf("Extension {0} is incompatible with {1}. Remove {0} and add {1}?",n[0].pkg0.id,e.name):lf("Extensions {0} and {1} are incompatible with {2}. Remove them and add {2}?",n.slice(0,-1).map((e=>e.pkg0.id)).join(", "),n.slice(-1)[0].pkg0.id,e.name);s=s.then((()=>i?Promise.resolve(1):o.confirmAsync({header:lf("Some extensions will be removed"),agreeLbl:lf("Remove extension(s) and add {0}",e.name),agreeClass:"pink",body:t}))).then((e=>0!==e?Promise.all(n.map((e=>this.removeDepAsync(e.pkg0.id)))).then((()=>!0)):Promise.resolve(!1)))}return s.then((i=>i?this.setDependencyAsync(e.name,t).then((()=>!0)):Promise.resolve(!1)))}))}}function f(e,t,i){return t===i}i.EditorPackage=h;const m=new class{readFile(e,t){let i=g(e).files[t];return i?i.content:null}writeFile(e,t,i,n){if(t!=pxt.CONFIG_NAME&&!n)throw l.oops("trying to write "+e+" / "+t);g(e).files[t].setContentAsync(i,n)}getHexInfoAsync(e){return pxt.hexloader.getHexInfoAsync(this,e).catch(o.handleNetworkError)}cacheStoreAsync(e,t){return c.forceSetAsync({id:e,val:t}).then((()=>{}),(t=>{pxt.tickEvent("cache.store.failed",{error:t.name}),pxt.log(`cache store failed for ${e}: ${t.name}`)}))}cacheGetAsync(e){return c.getAsync(e).then((e=>e.val),(e=>null))}downloadPackageAsync(e){let t=e.verProtocol(),r=g(e),o=t=>n.getTextAsync(t).then((i=>r.isTopLevel()||i?i?r.isTopLevel()&&r.header?n.recomputeHeaderFlagsAsync(r.header,i).then((()=>r.setFiles(i))):(r.setFiles(i),Promise.resolve()):Promise.reject(new Error(`Cannot find text for package '${t}' in the workspace.`)):(e.configureAsInvalidPackage(`cannot find '${t}' in the workspace.`),Promise.resolve())));if("pub"==t)return n.getPublishedScriptAsync(e.verArgument()).then((e=>r.setFiles(e)));if("github"==t)return n.getPublishedScriptAsync(e.version()).then((e=>r.setFiles(e)));if("workspace"==t)return o(e.verArgument());if("file"==t){let t=e.verArgument();return"."==t[0]&&(t=function(e){return e.replace(/\/+/g,"/").replace(/[^\/]+\/\.\.\//g,"").replace(/\/\.\//g,"/")}(e.parent.verArgument()+"/"+t)),o(t)}if("embed"==t)return r.setFiles(pxt.getEmbeddedScript(e.verArgument())),Promise.resolve();if("pkg"==t){const t=i.mainPkg.readFile(e.verArgument().replace(/^\.\//,"")),n=ts.pxtc.Util.jsonTryParse(t);return n?r.setFiles(n):pxt.log(`failed to resolve ${e.version()}`),Promise.resolve()}return"invalid"==t?(pxt.log(`skipping invalid pkg ${e.id}`),Promise.resolve()):Promise.reject(`Cannot download ${e.version()}; unknown protocol`)}};function g(e){let t=e._editorPkg;if(t)return t;let n=null;e!=i.mainPkg&&(n=g(i.mainPkg));let r=new h(e,n);return e==i.mainPkg&&r.makeTopLevel(),e._editorPkg=r,r}function b(){return g(i.mainPkg)}function v(){return g(i.mainPkg).pkgAndDeps()}function y(e){let t=/\.([^\.]+)$/.exec(e);return t?t[1]:""}i.mainPkg=new pxt.MainPackage(m),i.getEditorPkg=g,i.mainEditorPkg=b,i.genFileName=function(e){let t=b().header.name.replace(/[()\\\/.,?*^:<>!;'#$%^&|"@+={}\[\]~`\x00-\x1F]/g,"");if(t=t.trim().replace(/\s+/g,"-"),pxt.appTarget.appTheme&&pxt.appTarget.appTheme.fileNameExclusiveFilter){const e=new RegExp(pxt.appTarget.appTheme.fileNameExclusiveFilter,"g");t=t.replace(e,"")}return t||(t="Untitled"),`${pxt.appTarget.nickname||pxt.appTarget.id}-${t}${e}`},i.allEditorPkgs=v,i.notifySyncDone=function(e){l.values(i.mainPkg.deps).filter((t=>"workspace"==t.verProtocol()&&e.hasOwnProperty(t.verArgument()))).length>0&&g(i.mainPkg).onupdate()},i.loadPkgAsync=function(e,t){return i.mainPkg=new pxt.MainPackage(m),i.mainPkg._verspec="workspace:"+e,m.downloadPackageAsync(i.mainPkg).catch(o.handleNetworkError).then((()=>ts.pxtc.Util.jsonTryParse(m.readFile(i.mainPkg,pxt.CONFIG_NAME)))).then((e=>e?i.mainPkg.installAllAsync(t).then((()=>b().afterMainLoadAsync())):(i.mainPkg.configureAsInvalidPackage(lf("invalid pxt.json file")),b().afterMainLoadAsync())))},r.mountVirtualApi("open-meta",{getSync:e=>{e=r.stripProtocol(e);const t=b(),i=t.lookupFile(e);if(!i)return{};const n=!(!t.header||!t.header.githubId||i.epkg!=t),o={isReadonly:i.isReadonly(),numErrors:i.numDiagnosticsOverride,isGitModified:n&&i.baseGitContent!=i.publishedContent()};return null==o.numErrors&&(o.numErrors=i.diagnostics?i.diagnostics.length:0,o.diagnostics=i.diagnostics),o}}),r.mountVirtualApi("open-pkg-meta",{getSync:e=>{e=r.stripProtocol(e);const t=v().filter((t=>t.getPkgId()==e))[0];if(!t||"built"==t.getPkgId())return{};const i=t.sortedFiles();let n=i.reduce(((e,t)=>e+(t.numDiagnosticsOverride||(t.diagnostics?t.diagnostics.length:0)||0)),0);const o=t.getKsPkg();o&&o.invalid()&&n++;const s={numErrors:n};return n&&(s.diagnostics=[],i.filter((e=>!!e.diagnostics)).forEach((e=>s.diagnostics.concat(e.diagnostics)))),s}}),r.mountVirtualApi("pkg-git-status",{getSync:e=>{e=r.stripProtocol(e);const t=v().find((t=>t.header&&t.header.id==e)),i={};if(t&&(i.id="this"==t.getPkgId()&&t.header&&t.header.githubId,i.id)){const e=t.sortedFiles();i.modified=!!e.find((e=>e.baseGitContent!=e.publishedContent()))}return i}}),i.invalidatePullStatus=function(e){r.invalidateHeader("pkg-git-pull-status",e)},r.mountVirtualApi("pkg-git-pull-status",{getAsync:e=>{e=r.stripProtocol(e);const t=v().find((t=>t.header&&t.header.id==e));return"this"==t.getPkgId()&&t.header&&t.header.githubId?n.pullAsync(t.header,!0).catch((e=>n.PullStatus.NoSourceControl)):Promise.resolve(n.PullStatus.NoSourceControl)},expirationTime:e=>36e5}),i.invalidatePullRequestStatus=function(e){r.invalidateHeader("pkg-git-pr",e)},r.mountVirtualApi("pkg-git-pr",{getAsync:e=>{const t={number:-1};e=r.stripProtocol(e);const i=v().find((t=>t.header&&t.header.id==e)),n=i.header,o="this"==i.getPkgId()&&n&&n.githubId;if(!o)return Promise.resolve(t);const s=pxt.github.parseRepoId(o);return s&&s.tag&&"master"!=s.tag?pxt.github.findPRNumberforBranchAsync(s.fullName,s.tag).catch((e=>t)):Promise.resolve(t)},expirationTime:e=>36e5}),i.invalidatePagesStatus=function(e){r.invalidateHeader("pkg-git-pages",e)},r.mountVirtualApi("pkg-git-pages",{getAsync:e=>{e=r.stripProtocol(e);const t=v().find((t=>t.header&&t.header.id==e)),i=t.header,n="this"==t.getPkgId()&&i&&i.githubId;if(!n)return Promise.resolve(void 0);const o=pxt.github.parseRepoId(n);return o?pxt.github.getPagesStatusAsync(o.fullName).catch((e=>{})):Promise.resolve(void 0)},expirationTime:e=>36e5}),r.mountVirtualApi("pkg-status",{getSync:e=>{e=r.stripProtocol(e);const t=v().find((t=>t.header&&t.header.id==e));return t&&t.savingNow?"saving":""}}),i.getExtensionOfFileName=y},{"./compiler":30,"./core":78,"./data":81,"./db":82,"./workspace":151}],123:[function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};Object.defineProperty(i,"__esModule",{value:!0}),i.ChooseHwDialog=i.NewProjectDialog=i.ExitAndSaveDialog=i.ImportDialog=i.ProjectsDetail=i.ProjectsCodeCard=i.ProjectsCarousel=i.ProjectSettingsMenu=i.Projects=void 0;const r=e("react"),o=e("react-dom"),s=e("./data"),a=e("./sui"),l=e("./core"),c=e("./cloudsync"),u=e("./auth"),d=e("./codecard"),p=e("./carousel"),h=e("./dialogs"),f=e("./util");class m extends u.Component{constructor(e){super(e),this.state={visible:!1},this.showLanguagePicker=this.showLanguagePicker.bind(this),this.showAboutDialog=this.showAboutDialog.bind(this),this.chgHeader=this.chgHeader.bind(this),this.chgGallery=this.chgGallery.bind(this),this.importProject=this.importProject.bind(this),this.showScriptManager=this.showScriptManager.bind(this),this.setSelected=this.setSelected.bind(this)}shouldComponentUpdate(e,t,i){return this.state.visible!=t.visible||this.state.selectedCategory!=t.selectedCategory||this.state.selectedIndex!=t.selectedIndex}setSelected(e,t){null==t||this.state.selectedCategory==e&&this.state.selectedIndex==t?this.setState({selectedCategory:void 0,selectedIndex:void 0}):this.setState({selectedCategory:e,selectedIndex:t})}componentDidUpdate(e,t){this.state.selectedCategory!==t.selectedCategory&&this.ensureSelectedItemVisible()}ensureSelectedItemVisible(){let e=this.refs.activeCarousel;if(e){let t=e.getCarouselDOM();this.scrollElementIntoViewIfNeeded(t)}}scrollElementIntoViewIfNeeded(e){let t=o.findDOMNode(this.refs.homeContainer);const i=e.getBoundingClientRect().top;t.parentElement.scrollTop=t.parentElement.scrollTop+i-30}showLanguagePicker(){pxt.tickEvent("projects.langpicker"),this.props.parent.showLanguagePicker()}showAboutDialog(){h.showAboutDialogAsync(this.props.parent)}chgHeader(e){pxt.tickEvent("projects.header"),l.showLoading("changeheader",lf("loading...")),this.props.parent.loadHeaderAsync(e).catch((e=>(l.warningNotification(lf("Sorry, we could not load this project.")),pxt.reportException(e),this.props.parent.openHome(),Promise.reject(e)))).finally((()=>{l.hideLoading("changeheader")}))}chgGallery(e,t){S(this.props.parent,"projects",e,t)}importProject(){pxt.tickEvent("projects.importdialog",void 0,{interactiveConsent:!0}),this.props.parent.importProjectDialog()}showScriptManager(){pxt.tickEvent("projects.showall.header",void 0,{interactiveConsent:!0}),this.props.parent.showScriptManager()}renderCore(){const{selectedCategory:e,selectedIndex:t}=this.state,i=pxt.appTarget.appTheme,{scriptManager:n}=i,o=this.getData("target-config:"),s=pxt.Util.userLanguage();let l={};o&&o.localizedGalleries&&o.localizedGalleries[s]&&pxt.Util.jsonCopyFrom(l,o.localizedGalleries[s]),o&&o.galleries&&pxt.Util.jsonCopyFrom(l,o.galleries);const c=a.cx(["ui segment bottom attached tab active tabsegment"]);return r.createElement("div",{ref:"homeContainer",className:c,role:"main"},r.createElement(b,{parent:this.props.parent}),r.createElement("h1",{className:"accessible-hidden"},lf("MakeCode Home")),r.createElement("div",{key:"mystuff_gallerysegment",className:"ui segment gallerysegment mystuff-segment",role:"region","aria-label":lf("My Projects")},r.createElement("div",{className:"ui heading"},r.createElement("div",{className:"column",style:{zIndex:1},role:n&&"button",onClick:n&&this.showScriptManager,onKeyDown:n&&f.fireClickOnEnter},n?r.createElement("h2",{className:"ui header myproject-header"},lf("My Projects"),r.createElement("span",{className:"view-all-button",tabIndex:0,title:lf("View all projects"),role:"button"},lf("View All"))):r.createElement("h2",{className:"ui header"},lf("My Projects"))),r.createElement("div",{className:"column right aligned",style:{zIndex:1}},pxt.appTarget.compile||pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing?r.createElement(a.Button,{key:"import",icon:"upload",className:"import-dialog-btn",textClass:"landscape only",text:lf("Import"),title:lf("Import a project"),onClick:this.importProject}):void 0)),r.createElement("div",{className:"content"},r.createElement(v,{key:"mystuff_carousel",parent:this.props.parent,name:"recent",onClick:this.chgHeader}))),Object.keys(l).filter((e=>{const t=l[e];if("string"==typeof t)return!0;const i=t.experimentName;if(i&&!pxt.appTarget.appTheme[i])return!1;const n=t.locales;if(n&&n.indexOf(pxt.Util.userLanguage())<0)return!1;const r=t.testUrl||!!t.youTube&&"https://www.youtube.com/favicon.ico";return!r||!0===this.getData(`ping:${r.replace("@random@",Math.random().toString())}`)})).map((i=>{const n=l[i],o="string"==typeof n?n:n.url,s="string"==typeof n?void 0:n.shuffle;return r.createElement("div",{key:`${i}_gallerysegment`,className:"ui segment gallerysegment",role:"region","aria-label":pxt.Util.rlf(i)},r.createElement("h2",{className:"ui header heading"},pxt.Util.rlf(i)," "),r.createElement("div",{className:"content"},r.createElement(v,{ref:""+(e==i?"activeCarousel":""),key:`${i}_carousel`,parent:this.props.parent,name:i,path:o,onClick:this.chgGallery,setSelected:this.setSelected,shuffle:s,selectedIndex:e==i?t:void 0})))})),i.organizationUrl||i.organizationUrl||i.privacyUrl||i.copyrightText?r.createElement("div",{className:"ui horizontal small divided link list homefooter",role:"contentinfo"},i.organizationUrl&&i.organization?r.createElement("a",{className:"item",target:"_blank",rel:"noopener noreferrer",href:i.organizationUrl},i.organization):void 0,i.selectLanguage?r.createElement(a.Link,{className:"item",icon:"xicon globe",text:lf("Language"),onClick:this.showLanguagePicker,onKeyDown:f.fireClickOnEnter,role:"button"}):void 0,i.termsOfUseUrl?r.createElement("a",{target:"_blank",className:"item",href:i.termsOfUseUrl,rel:"noopener noreferrer"},lf("Terms of Use")):void 0,i.privacyUrl?r.createElement("a",{target:"_blank",className:"item",href:i.privacyUrl,rel:"noopener noreferrer"},lf("Privacy")):void 0,pxt.appTarget.versions?r.createElement(a.Link,{className:"item",text:`v${pxt.appTarget.versions.target}`,onClick:this.showAboutDialog,onKeyDown:f.fireClickOnEnter,role:"button"}):void 0,i.copyrightText?r.createElement("div",{className:"ui item copyright"},i.copyrightText):void 0):void 0)}}i.Projects=m;class g extends s.Component{constructor(e){super(e),this.state={},this.showLanguagePicker=this.showLanguagePicker.bind(this),this.toggleHighContrast=this.toggleHighContrast.bind(this),this.showResetDialog=this.showResetDialog.bind(this),this.showReportAbuse=this.showReportAbuse.bind(this),this.showAboutDialog=this.showAboutDialog.bind(this),this.signOutGithub=this.signOutGithub.bind(this)}showLanguagePicker(){pxt.tickEvent("home.langpicker",void 0,{interactiveConsent:!0}),this.props.parent.showLanguagePicker()}toggleHighContrast(){pxt.tickEvent("home.togglecontrast",void 0,{interactiveConsent:!0}),l.toggleHighContrast()}toggleGreenScreen(){pxt.tickEvent("home.togglegreenscreen",void 0,{interactiveConsent:!0}),this.props.parent.toggleGreenScreen()}toggleAccessibleBlocks(){pxt.tickEvent("home.toggleaccessibleblocks",void 0,{interactiveConsent:!0}),this.props.parent.toggleAccessibleBlocks()}showResetDialog(){pxt.tickEvent("home.reset",void 0,{interactiveConsent:!0}),this.props.parent.showResetDialog()}showReportAbuse(){pxt.tickEvent("home.reportabuse",void 0,{interactiveConsent:!0}),this.props.parent.showReportAbuse()}showAboutDialog(){pxt.tickEvent("home.about"),this.props.parent.showAboutDialog()}signOutGithub(){pxt.tickEvent("home.github.signout");const e=c.githubProvider();e&&(e.logout(),this.props.parent.forceUpdate(),l.infoNotification(lf("Signed out from GitHub")))}renderCore(){const e=pxt.auth.hasIdentity(),t=this.getData(u.HIGHCONTRAST),i=pxt.appTarget.appTheme,n=!e&&this.getData("github:user"),o=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing,s=i.selectLanguage||i.highContrast||n;return r.createElement(a.DropdownMenu,{role:"menuitem",icon:"setting large",title:lf("More..."),className:"item icon more-dropdown-menuitem"},i.selectLanguage&&r.createElement(a.Item,{icon:"xicon globe",role:"menuitem",text:lf("Language"),onClick:this.showLanguagePicker}),i.highContrast&&r.createElement(a.Item,{role:"menuitem",text:t?lf("High Contrast Off"):lf("High Contrast On"),onClick:this.toggleHighContrast}),n&&r.createElement("div",{className:"ui divider"}),n&&r.createElement("div",{className:"ui item",title:lf("Unlink {0} from GitHub",n.name),role:"menuitem",onClick:this.signOutGithub},r.createElement("div",{className:"avatar",role:"presentation"},r.createElement("img",{className:"ui circular image",src:n.photo,alt:lf("User picture")})),lf("Unlink GitHub")),s&&r.createElement("div",{className:"ui divider"}),o?r.createElement(a.Item,{role:"menuitem",icon:"warning circle",text:lf("Report Abuse..."),onClick:this.showReportAbuse}):void 0,r.createElement(a.Item,{role:"menuitem",icon:"sign out",text:lf("Reset"),onClick:this.showResetDialog}),r.createElement(a.Item,{role:"menuitem",text:lf("About..."),onClick:this.showAboutDialog}),i.feedbackUrl?r.createElement("a",{className:"ui item",href:i.feedbackUrl,role:"menuitem",title:lf("Give Feedback"),target:"_blank",rel:"noopener noreferrer"},lf("Give Feedback")):void 0)}}i.ProjectSettingsMenu=g;class b extends s.Component{constructor(e){super(e),this.carouselTimeout=void 0,this.handleRefreshCard=e=>{var t;if(pxt.debug("next hero carousel"),null===(t=this.prevGalleries)||void 0===t?void 0:t.length){const t=this.state.cardIndex,i=e?this.prevGalleries.length-1:1;this.setState({cardIndex:(t+i)%this.prevGalleries.length})}this.scheduleRefresh()},this.handleSetCardIndex=e=>{this.clearRefresh(),this.setState({cardIndex:e,paused:!0})},this.onPointerDown=e=>{this.dragStartX=e.clientX},this.onTouchstart=e=>{var t;(null===(t=e.touches)||void 0===t?void 0:t.length)&&(this.dragStartX=e.touches[0].clientX)},this.onPointerUp=e=>{this.handleRelease(e.clientX,e)},this.onTouchEnd=e=>{var t,i;this.handleRelease(null===(i=null===(t=e.changedTouches)||void 0===t?void 0:t[0])||void 0===i?void 0:i.clientX,e)},this.onKeyDown=e=>{switch(l.keyCodeFromEvent(e)){case 37:this.handleRefreshCard(!0),e.stopPropagation();break;case 39:this.handleRefreshCard(),e.stopPropagation()}},this.handleCardClick=()=>{const e=void 0!==this.state.cardIndex&&this.prevGalleries[this.state.cardIndex];e&&(pxt.tickEvent("hero.card.click",{gallery:pxt.appTarget.appTheme.homeScreenHeroGallery,card:e.name,cardIndex:this.state.cardIndex}),S(this.props.parent,"herobanner",e))},this.scheduleRefresh=()=>{const{paused:e}=this.state;e||(this.clearRefresh(),this.carouselTimeout=setTimeout(this.handleRefreshCard,9e3))},this.state={cardIndex:0}}handleRelease(e,t){if(void 0!==this.dragStartX&&void 0!==e){const i=this.dragStartX-e;this.dragStartX=void 0,Math.abs(i)>30&&(t.stopPropagation(),t.preventDefault(),this.handleRefreshCard(i<0))}}clearRefresh(){this.carouselTimeout&&(clearTimeout(this.carouselTimeout),this.carouselTimeout=void 0)}componentDidMount(){this.scheduleRefresh()}componentWillUnmount(){this.clearRefresh()}fetchGallery(){const e=pxt.appTarget.appTheme,t=e.homeScreenHeroGallery;let i,n;"string"==typeof e.homeScreenHero?n=e.homeScreenHero:e.homeScreenHero&&(i=e.homeScreenHero);const r=e.homeScreenHero&&Object.assign(Object.assign({},null!=i?i:{}),{imageUrl:n||(null==i?void 0:i.imageUrl),description:(null==i?void 0:i.description)&&pxt.U.rlf(i.description),name:(null==i?void 0:i.name)&&pxt.U.rlf(i.name),buttonLabel:(null==i?void 0:i.buttonLabel)&&pxt.U.rlf(i.buttonLabel)});if(this.prevGalleries||(this.prevGalleries=[],r&&this.prevGalleries.push(r)),!t)return this.prevGalleries;let o=this.getData(`gallery:${encodeURIComponent(t)}`);return o&&(o instanceof Error||(this.prevGalleries=pxt.Util.concat(o.map((e=>e.cards))).slice(0,5),r&&this.prevGalleries.unshift(r),this.prevGalleries.forEach((e=>{const t=encodeURI(e.largeImageUrl||e.imageUrl);if(!b.fetchedImages[t]){const e=new Image;e.src=t,b.fetchedImages[t]=e}})),this.scheduleRefresh())),this.prevGalleries}renderCore(){const e=pxt.appTarget.appTheme,{cardIndex:t}=this.state,i=!!e.homeScreenHeroGallery,n=this.fetchGallery(),o=n[t];if(!o)return null;const s=e=>()=>this.handleSetCardIndex(e),a=o.url,l=o.description||o.name,c=`url(${encodeURI(o.largeImageUrl||o.imageUrl)})`,u=o.buttonLabel||w(o.cardType,o.youTubeId,o.youTubePlaylistId),d=!!a||!!o.youTubeId||!!o.youTubePlaylistId;return r.createElement("div",{className:"ui segment getting-started-segment hero",style:{backgroundImage:c},onKeyDown:this.onKeyDown,onPointerDown:this.onPointerDown,onTouchStart:this.onTouchstart,onPointerUp:this.onPointerUp,onTouchEnd:this.onTouchEnd},(!!l||d||i)&&r.createElement("div",{className:"gradient-overlay"}),r.createElement("div",{className:"hero-banner-contents"},!!l&&r.createElement("div",{className:"description"},r.createElement("p",null,l)),d&&r.createElement("div",{className:"action"},C({url:a,youTubeId:o.youTubeId,youTubePlaylistId:o.youTubePlaylistId,scr:o},"large blue button",u,o.cardType,this.handleCardClick)),i&&r.createElement("div",{key:"cards",className:"dots"},n.map(((e,i)=>r.createElement("button",{key:"dot"+i,className:`ui button empty circular label  clear ${i===t&&"active"}`,onClick:s(i),"aria-label":lf("View {0} hero image",e.title||e.name),title:lf("View {0} hero image",e.title||e.name)}))))))}}b.fetchedImages={};class v extends s.Component{constructor(e){super(e),this.prevGalleries=[],this.hasFetchErrors=!1,this.state={},this.closeDetail=this.closeDetail.bind(this),this.closeDetailOnEscape=this.closeDetailOnEscape.bind(this),this.reload=this.reload.bind(this),this.newProject=this.newProject.bind(this),this.showScriptManager=this.showScriptManager.bind(this),this.handleCardClick=this.handleCardClick.bind(this)}componentDidMount(){this.props.parent.state.header&&this.latestProject&&this.latestProject.element&&this.latestProject.element.focus()}fetchGallery(e){let t=this.getData(`gallery:${encodeURIComponent(e)}`);if(t)if(t instanceof Error)this.hasFetchErrors=!0;else if(this.prevGalleries=pxt.Util.concat(t.map((e=>e.cards))),this.props.shuffle){const e=this.prevGalleries.pop(),t=(new Date).toDateString();this.prevGalleries.sort(((e,i)=>ts.pxtc.Util.codalHash16(e.name+t)-ts.pxtc.Util.codalHash16(i.name+t))),e&&this.prevGalleries.push(e)}return this.prevGalleries||[]}fetchLocalData(){return this.getData("headers:")||[]}newProject(){pxt.tickEvent("projects.new",void 0,{interactiveConsent:!0}),pxt.appTarget.appTheme.nameProjectFirst||pxt.appTarget.appTheme.chooseLanguageRestrictionOnNewProject?this.props.parent.askForProjectCreationOptionsAsync().then((e=>{const{name:t,languageRestriction:i}=e;this.props.parent.newProject({name:t,languageRestriction:i})})):this.props.parent.newProject({})}showScriptManager(){pxt.tickEvent("projects.showscriptmanager",void 0,{interactiveConsent:!0}),this.props.parent.showScriptManager()}closeDetail(){const{name:e}=this.props;pxt.tickEvent("projects.detail.close"),this.props.setSelected(e,void 0)}getCarouselDOM(){return o.findDOMNode(this.refs.carousel)}getDetailDOM(){return o.findDOMNode(this.refs.detailView)}closeDetailOnEscape(e){l.keyCodeFromEvent(e)==l.ESC_KEY&&(this.closeDetail(),document.removeEventListener("keydown",this.closeDetailOnEscape),e.preventDefault())}UNSAFE_componentWillReceiveProps(e){null!=e.selectedIndex&&document.addEventListener("keydown",this.closeDetailOnEscape)}reload(){this.setState({})}handleCardClick(e,t,i){const{name:n}=this.props;!this.props.setSelected||t&&t.directOpen?this.props.onClick(t):(pxt.tickEvent("projects.detail.open",{name:null==t?void 0:t.name,url:null==t?void 0:t.url,cardType:null==t?void 0:t.cardType,editor:null==t?void 0:t.editor},{interactiveConsent:!0}),this.props.setSelected(n,i))}renderCore(){const{name:e,path:t,selectedIndex:i}=this.props,n=pxt.appTarget.appTheme;if(t){this.hasFetchErrors=!1;const e=this.fetchGallery(t);if(this.hasFetchErrors)return r.createElement("div",{className:"ui carouselouter"},r.createElement("div",{role:"button",className:"carouselcontainer",tabIndex:0,onClick:this.reload},r.createElement("p",{className:"ui grey inverted segment"},lf("Oops, please connect to the Internet and try again."))));{const n=e[i],o=e.some((e=>e.tags&&0!=e.tags.length));return r.createElement("div",null,r.createElement(p.Carousel,{ref:"carousel",tickId:t,bleedPercent:20,selectedIndex:i},e.map(((e,i)=>r.createElement(y,{className:"example",key:t+(e.youTubeId||e.name||e.url),name:e.name,url:e.url,imageUrl:e.imageUrl,youTubeId:e.youTubeId,youTubePlaylistId:e.youTubePlaylistId,buttonLabel:e.buttonLabel,label:e.label,labelClass:e.labelClass,tags:e.tags,scr:e,index:i,onCardClick:this.handleCardClick,cardType:e.cardType,tallCard:o,tutorialStep:e.tutorialStep,tutorialLength:e.tutorialLength})))),n&&r.createElement("div",{ref:"detailView",className:"detailview"},r.createElement(a.CloseButton,{onClick:this.closeDetail}),r.createElement(k,{parent:this.props.parent,name:n.name,key:"detail"+n.name,description:n.description,url:n.url,imageUrl:n.imageUrl,largeImageUrl:n.largeImageUrl,videoUrl:n.videoUrl,youTubeId:n.youTubeId,youTubePlaylistId:n.youTubePlaylistId,buttonLabel:n.buttonLabel,scr:n,onClick:this.props.onClick,cardType:n.cardType,tags:n.tags,otherActions:n.otherActions})))}}{const e=this.fetchLocalData(),t=pxt.appTarget.appTheme&&!pxt.appTarget.appTheme.hideNewProjectButton,i=n.scriptManager&&e.length>v.NUM_PROJECTS_HOMESCREEN,o=u.hasIdentity()&&!u.loggedIn()&&pxt.storage.getLocal(u.HAS_USED_CLOUD),s=e.filter((e=>{var t,i;return!(null===(i=null===(t=e.tutorial)||void 0===t?void 0:t.metadata)||void 0===i?void 0:i.hideIteration)})).slice(0,v.NUM_PROJECTS_HOMESCREEN);return r.createElement(p.Carousel,{tickId:"myprojects",bleedPercent:20},t&&r.createElement("div",{role:"button",className:"ui card link buttoncard newprojectcard",title:lf("Creates a new empty project"),onClick:this.newProject,onKeyDown:f.fireClickOnEnter},r.createElement("div",{className:"content"},r.createElement(a.Icon,{icon:"huge add circle"}),r.createElement("span",{className:"header"},lf("New Project")))),o&&r.createElement("div",{role:"button",className:"ui card link buttoncard cloudprojectscard",title:lf("Sign in to see cloud projects"),onClick:e=>this.props.parent.showLoginDialog(),onKeyDown:f.fireClickOnEnter},r.createElement("div",{className:"content"},r.createElement(a.Icon,{icon:"huge xicon cloud-profile"}),r.createElement("span",{className:"header"},lf("Cloud Projects")))),s.map(((e,t)=>{const i=e.tutorial?e.tutorial.tutorialStep:e.tutorialCompleted?e.tutorialCompleted.steps-1:void 0,n=e.tutorial?e.tutorial.tutorialStepInfo.length:e.tutorialCompleted?e.tutorialCompleted.steps:void 0,o=pxt.github.parseRepoId(e.githubId);return r.createElement(y,{key:"local"+e.id+e.recentUse,cardType:"file",name:o&&pxt.github.join(o.project,o.fileName)||e.name,time:e.modificationTime,url:e.pubId&&e.pubCurrent?"/"+e.pubId:"",scr:e,index:t,onCardClick:this.handleCardClick,tutorialStep:i,tutorialLength:n,projectId:e.id})})),i&&r.createElement("div",{role:"button",className:"ui card link buttoncard scriptmanagercard",title:lf("See all projects"),onClick:this.showScriptManager,onKeyDown:f.fireClickOnEnter},r.createElement("div",{className:"content"},r.createElement(a.Icon,{icon:"huge right angle"}),r.createElement("span",{className:"header"},lf("See all projects")))))}}}i.ProjectsCarousel=v,v.NUM_PROJECTS_HOMESCREEN=8;class y extends a.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleLabelClick=this.handleLabelClick.bind(this)}handleClick(e){this.props.onCardClick(e,this.props.scr,this.props.index,this.props.id)}handleLabelClick(e){this.props.onLabelClick(e,this.props.scr,this.props.index,this.props.id)}renderCore(){let e=this.props,{scr:t,onCardClick:i,onLabelClick:o,onClick:s,cardType:a,imageUrl:l,className:c}=e,u=n(e,["scr","onCardClick","onLabelClick","onClick","cardType","imageUrl","className"]);return c=c||"",t&&"file"==a&&(t.githubId?c="file github "+c:t.extensionUnderTest?c="file test "+c:t.board?(c="file board "+c,l=pxt.bundledSvg(t.board)):c=t.editor?"file "+t.editor:"file "+c),r.createElement(d.CodeCardView,Object.assign({role:"button",className:c,imageUrl:l,cardType:a},u,{onClick:this.handleClick,onLabelClicked:o?this.handleLabelClick:void 0}))}}i.ProjectsCodeCard=y;class k extends s.Component{constructor(e){super(e),this.state={},this.handleDetailClick=this.handleDetailClick.bind(this),this.handleOpenForumUrlInEditor=this.handleOpenForumUrlInEditor.bind(this),this.linkRef=r.createRef()}isLink(e){return x(this.props,e)}getUrl(){return E(this.props)}getClickLabel(e){const{youTubeId:t,youTubePlaylistId:i}=this.props;return w(e,t,i)}getActionEditor(e,t){switch(e){case"tutorial":case"example":return t&&t.editor?t.editor:"blocks";case"codeExample":return t&&t.editor?t.editor:"js";case"sharedExample":return null==t?void 0:t.editor;default:return null}}getActionIcon(e,t,i){const{youTubeId:n,youTubePlaylistId:o}=this.props;let s="file text";switch(t){case"tutorial":case"example":s="xicon blocks",i&&(s=`xicon ${i}`);break;case"codeExample":s=`xicon ${i||"js"}`;break;case"sharedExample":s="pencil",i&&(s=`xicon ${i}`);break;case"forumUrl":s="comments";break;case"forumExample":s="pencil";break;case"template":default:(n||o)&&(s="youtube")}return this.isLink(t)&&"forumExample"!=t?r.createElement(a.Link,{role:"presentation",className:"link button attached",icon:s,href:this.getUrl(),target:"_blank",tabIndex:-1}):r.createElement(a.Item,{role:"presentation",className:"button attached",icon:s,onClick:e,tabIndex:-1})}getActionTitle(e){switch(e){case"py":return"Python";case"js":return"JavaScript";case"blocks":return lf("Blocks");default:return null}}getActionCard(e,t,i,n,o,s){const a=this.getActionEditor(t,o),l=this.getActionTitle(a);return r.createElement("div",{className:`card-action ui items ${a||""}`,key:s},this.getActionIcon(i,t,a),l&&r.createElement("div",{className:"card-action-title"},l),C(this.props,"button attached approve large",e,t,i,n,l,this.linkRef))}handleDetailClick(){const{scr:e,onClick:t}=this.props;pxt.tickEvent("projects.actions.details",{name:e.name,url:e.url,cardType:e.cardType,editor:e.editor},{interactiveConsent:!0}),t(e)}handleActionClick(e){const{scr:t,onClick:i}=this.props;return pxt.tickEvent("projects.actions.click",{name:t.name,url:t.url,cardType:t.cardType,editor:t.editor},{interactiveConsent:!0}),()=>i(t,e)}handleOpenForumUrlInEditor(){pxt.tickEvent("projects.actions.forum",void 0,{interactiveConsent:!0});const{url:e}=this.props;pxt.discourse.extractSharedIdFromPostUrl(e).then((e=>{e?window.location.hash="pub:"+e:l.warningNotification(lf("Oops, we could not find the program in the forum."))})).catch(l.handleNetworkError)}isYouTubeOnline(){const{youTubeId:e,youTubePlaylistId:t}=this.props;return(e||t)&&this.getData("ping:https://www.youtube.com/favicon.ico")}componentDidMount(){this.linkRef&&this.linkRef.current&&this.linkRef.current.focus()}renderCore(){const{name:e,description:t,largeImageUrl:i,videoUrl:n,youTubeId:o,youTubePlaylistId:s,buttonLabel:l,cardType:c,tags:d,otherActions:p}=this.props,h=this.getData(u.HIGHCONTRAST),f=pxt.appTarget.appTheme.tagColors||{},m=t&&t.split("\n"),g=!h&&(i||o&&`https://img.youtube.com/vi/${o}/0.jpg`),b=!h&&!pxt.BrowserUtils.isElectron()&&!pxt.BrowserUtils.isIOS()&&n,v=!pxt.appTarget.appTheme.hideHomeDetailsVideo,y=pxt.youtube.watchUrl(o,s);let k;return k=l?ts.pxtc.Util.rlf(l):this.getClickLabel(c),r.createElement("div",{className:"ui grid stackable padded"},v&&(b||g)&&r.createElement("div",{className:"imagewrapper"},b?r.createElement("video",{className:"video",src:b,autoPlay:!0,controls:!1,loop:!0,playsInline:!0}):r.createElement("div",{className:"image",style:{backgroundImage:`url("${g}")`}})),r.createElement("div",{className:"column six wide"},r.createElement("div",{className:"segment"},r.createElement("div",{className:"header"}," ",e," "),d&&r.createElement("div",{className:"ui labels"},d.map((e=>r.createElement("div",{className:`ui ${f[e]||""} label`},pxt.Util.rlf(e))))),m&&m.map(((e,t)=>r.createElement("p",{key:`line${t}`,className:"detail"},e))),!!c&&y&&this.isYouTubeOnline()&&r.createElement(a.Link,{href:y,target:"_blank",icon:"play",text:lf("Play Video Lesson"),className:"yt-button button attached approve large inverted",title:lf("Open YouTube video in new window")}))),r.createElement("div",{className:"actions column ten wide"},r.createElement("div",{className:"segment"},this.getActionCard(k,c,this.handleDetailClick,!0),p&&p.map(((e,t)=>{let i=this.handleActionClick(e),n=e.cardType?this.getClickLabel(e.cardType):k;return this.getActionCard(n,e.cardType||c,i,!1,e,`action${t}`)})),"forumUrl"===c&&(!p||0==p.length)&&!pxt.BrowserUtils.isPxtElectron()&&this.getActionCard(lf("Open in Editor"),"forumExample",this.handleOpenForumUrlInEditor))))}}function w(e,t,i){return"tutorial"==e?lf("Start Tutorial"):"codeExample"==e||"example"==e?lf("Open Example"):"forumUrl"==e?lf("Open in Forum"):"sharedExample"==e?lf("Open in Editor"):"template"==e?lf("New Project"):t?lf("Watch Video"):i?lf("Watch Playlist"):lf("Show Instructions")}function x(e,t){const{cardType:i,url:n,youTubeId:r,youTubePlaylistId:o}=e;return function(e){switch(e){case"file":case"example":case"codeExample":case"sharedExample":case"tutorial":case"side":case"template":case"package":case"hw":return!1;case"forumUrl":default:return!0}}(t||i)&&(r||o||n)}function E(e){const{url:t,youTubeId:i,youTubePlaylistId:n}=e;return!i&&!n||t?/^https:\/\//i.test(t)||/^\//i.test(t)?t:"":pxt.youtube.watchUrl(i,n)}function C(e,t,i,n,o,s,l,c){const u=x(e,n)&&"forumExample"!=n,d=u?lf("Open link in new window"):lf("Open in {0}",l||lf("Editor"));return u?r.createElement(a.Link,{href:E(e),refCallback:s?c:void 0,target:"_blank",text:i,className:t,title:d,ariaLabel:d,autoFocus:s}):r.createElement(a.Button,{text:i,className:t,onClick:o,onKeyDown:f.fireClickOnEnter,autoFocus:s,title:d,ariaLabel:d})}function S(e,t,i,n){let r=n&&n.editor||"blocks";"js"==r&&(r="ts");const o=n?n.url:i.url,s=(null==n?void 0:n.cardType)||i.cardType,a=r+"prj";switch(pxt.tickEvent(`${t}.gallery`,{name:i.name,cardType:s,editor:r}),s){case"template":const t=pxt.Util.clone(pxt.appTarget.blocksprj);t.config.dependencies={},c(i.name,o,!0,pxt.BLOCKS_PROJECT_NAME,t);break;case"example":c(i.name,o,!0,a);break;case"codeExample":c(i.name,o,!1,a);break;case"side":e.newEmptyProject(i.name,o);break;case"tutorial":e.startActivity({activity:"tutorial",path:o,title:i.name,editor:a});break;case"sharedExample":console.log("shared example");let n=pxt.github.normalizeRepoId(o)||pxt.Cloud.parseScriptId(o);n?window.location.hash="pub:"+n:l.errorNotification(lf("Sorry, the project url looks invalid."));break;case"link":window.open(/^https:\/\//i.test(o)||/^\//i.test(o)?o:"","_blank");break;default:const r=/^\/#tutorial:([a-z0A-Z0-9\-\/]+)$/.exec(o);if(r)e.startActivity({activity:"tutorial",path:r[1]});else{if(i.youTubeId&&!o)return;if(/^https:\/\//i.test(o))return;if(o){if(/^\//i.test(o))return;l.errorNotification(lf("Sorry, the project url looks invalid."))}else e.newEmptyProject(i.name.toLowerCase())}}function c(t,i,n,r,o){return e.startActivity({activity:"example",path:i,title:t,editor:r,importOptions:{path:i,name:t,loadBlocks:n,prj:o}})}}i.ProjectsDetail=k;class _ extends s.Component{constructor(e){super(e),this.state={visible:!1},this.close=this.close.bind(this),this.importHex=this.importHex.bind(this),this.importUrl=this.importUrl.bind(this),this.cloneGithub=this.cloneGithub.bind(this)}hide(){this.setState({visible:!1})}close(){this.setState({visible:!1})}show(){this.setState({visible:!0})}importHex(){pxt.tickEvent("projects.import",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.showImportFileDialog()}importUrl(){pxt.tickEvent("projects.importurl",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.showImportUrlDialog()}async cloneGithub(){pxt.tickEvent("github.projects.clone",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.showImportGithubDialog()}renderCore(){var e,t,i;const{visible:n}=this.state,o=pxt.appTarget.appTheme,s=pxt.appTarget.appTheme.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),l=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),c=pxt.appTarget.cloud&&pxt.appTarget.cloud.sharing&&pxt.appTarget.cloud.importing,u=this.props.parent.createModalClasses("importdialog"),p=o.githubEditor&&!pxt.winrt.isWinRT()&&!pxt.BrowserUtils.isPxtElectron()&&(null===(i=null===(t=null===(e=pxt.appTarget)||void 0===e?void 0:e.cloud)||void 0===t?void 0:t.cloudProviders)||void 0===i?void 0:i.github),h=pxt.appTarget.compile&&!s&&!l;let f=h?1:0;f+=c?1:0;const m=1===(f+=p?1:0)?"one":2===f?"two":"three";return r.createElement(a.Modal,{isOpen:n,className:u,size:"small",onClose:this.close,dimmer:!0,closeIcon:!0,header:lf("Import"),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},r.createElement("div",{className:`ui ${m} cards`},h&&r.createElement(d.CodeCardView,{ariaLabel:lf("Open files from your computer"),role:"button",key:"import",icon:"upload",iconColor:"secondary",name:lf("Import File..."),description:lf("Open files from your computer"),onClick:this.importHex}),c&&r.createElement(d.CodeCardView,{ariaLabel:lf("Open a shared project URL or GitHub repo"),role:"button",key:"importurl",icon:"cloud download",iconColor:"secondary",name:lf("Import URL..."),description:lf("Open a shared project URL or GitHub repo"),onClick:this.importUrl}),p&&r.createElement(d.CodeCardView,{ariaLabel:lf("Clone or create your own GitHub repository"),role:"button",key:"importgithub",icon:"github",iconColor:"secondary",name:lf("Your GitHub Repo..."),description:lf("Clone or create your own GitHub repository"),onClick:this.cloneGithub})))}}i.ImportDialog=_;class T extends s.Component{constructor(e){super(e),this.state={visible:!1,emoji:""},this.hide=this.hide.bind(this),this.handleChange=this.handleChange.bind(this),this.save=this.save.bind(this),this.skip=this.skip.bind(this)}hide(){this.setState({visible:!1})}show(){pxt.tickEvent("exitandsave.show",void 0,{interactiveConsent:!1}),this.setState({projectName:this.props.parent.state.projectName,visible:!0})}handleChange(e){this.setState({projectName:e,emoji:N(e)})}skip(){pxt.tickEvent("exitandsave.skip",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.openHome()}save(){const{projectName:e}=this.state;this.hide();let t=Promise.resolve();e&&this.props.parent.state.projectName!=e&&(pxt.tickEvent("exitandsave.projectrename",{length:e&&e.length},{interactiveConsent:!0}),t=t.then((()=>this.props.parent.updateHeaderNameAsync(e)))),t.then((()=>{this.props.parent.openHome()}))}renderCore(){const{visible:e,projectName:t}=this.state,i=pxt.BrowserUtils.isMobile(),n=[{label:lf("Save"),onclick:this.save,icon:"check",className:"approve positive"},{label:lf("Skip"),onclick:this.skip}],o=this.props.parent.createModalClasses("exitandsave"),s=lf("Give your project a name.");return r.createElement(a.Modal,{isOpen:e,className:o,size:"tiny",onClose:this.hide,dimmer:!0,buttons:n,closeIcon:!0,header:lf("Project has no name {0}",this.state.emoji),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},r.createElement("div",null,r.createElement("p",null,s),r.createElement("div",{className:"ui form"},r.createElement(a.Input,{ref:"filenameinput",id:"projectNameInput",ariaLabel:s,autoComplete:!1,value:t||"",onChange:this.handleChange,onEnter:this.save,selectOnMount:!i,autoFocus:!i}))))}}i.ExitAndSaveDialog=T;class A extends s.Component{constructor(e){super(e),this.hide=()=>{this.setState({visible:!1})},this.show=()=>{pxt.tickEvent("newprojectdialog.show",void 0,{interactiveConsent:!1}),this.setState({name:"",emoji:"",visible:!0,languageRestriction:""})},this.handleTextChange=e=>{this.setState({name:e,emoji:N(e)})},this.handleLanguageChange=e=>{this.setState({languageRestriction:e})},this.save=()=>{const{name:e,languageRestriction:t}=this.state;this.hide(),this.createProjectCb&&this.createProjectCb({name:e,languageRestriction:t}),pxt.tickEvent("newprojectdialog.projectcreate",{language:t},{interactiveConsent:!0}),this.createProjectCb=null},this.onExpandedMenuHide=()=>{pxt.tickEvent("newprojectdialog.codeoptions.hide"),this.setState({languageRestriction:""})},this.onExpandedMenuShow=()=>{pxt.tickEvent("newprojectdialog.codeoptions.show")},this.state={visible:!1,emoji:"",languageRestriction:""}}promptUserAsync(){return this.show(),new Promise((e=>{this.createProjectCb=e}))}renderCore(){const{visible:e,name:t,emoji:i}=this.state,{python:n,chooseLanguageRestrictionOnNewProject:o}=pxt.appTarget.appTheme,s=[{label:lf("Create"),onclick:this.save,icon:"check",className:"approve positive"}],l=pxt.BrowserUtils.isMobile(),c=[{value:"",display:n?lf("Blocks, {0}, and {1}","JavaScript","Python"):lf("Blocks and {0}","JavaScript")},n&&{value:"python-only",display:lf("{0} Only","Python")},{value:"javascript-only",display:lf("{0} Only","JavaScript")}],u=this.props.parent.createModalClasses("newproject"),d=lf("Give your project a name.");return r.createElement(a.Modal,{isOpen:e,className:u,size:"tiny",onClose:this.hide,dimmer:!0,buttons:s,closeIcon:!0,header:lf("Create a Project {0}",i),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},r.createElement("div",null,r.createElement("p",null,d),r.createElement("div",{className:"ui form"},r.createElement(a.Input,{ref:"filenameinput",id:"projectNameInput",ariaLabel:d,autoComplete:!1,value:t||"",onChange:this.handleTextChange,onEnter:this.save,selectOnMount:!l,autoFocus:!l}))),o&&r.createElement("div",null,r.createElement("br",null),r.createElement(a.ExpandableMenu,{title:lf("Code options"),onShow:this.onExpandedMenuShow,onHide:this.onExpandedMenuHide},r.createElement(a.Select,{options:c,onChange:this.handleLanguageChange,"aria-label":lf("Select Language")}))))}}function N(e){const t=lf("Untitled");let i="";if(e&&-1===t.indexOf(e)){const t=["","","",""];i=t[Math.min(e.length,t.length)-1];const n=e.length>>1;if(n>t.length)for(let e=0;e<Math.min(2,n-t.length);++e)i+=t[t.length-1]}return i}i.NewProjectDialog=A;class I extends s.Component{constructor(e){super(e),this.prevGalleries=[],this.state={visible:!1,skipDownload:!1},this.close=this.close.bind(this)}hide(){this.setState({visible:!1})}close(){this.setState({visible:!1})}show(e){this.setState({visible:!0,skipDownload:!!e})}fetchGallery(){let e=this.getData(`gallery:${encodeURIComponent("/hardware")}`);return e&&(e instanceof Error||(this.prevGalleries=pxt.Util.concat(e.map((e=>e.cards))).filter((e=>!!e.variant)))),this.prevGalleries||[]}setHwVariant(e,t){pxt.tickEvent("projects.choosehwvariant",{hwid:e.name,card:t?t.name:e.name},{interactiveConsent:!0}),this.hide(),pxt.setHwVariant(e.name,t?t.name:e.description||e.name);let i=this.props.parent;i.reloadHeaderAsync().then((()=>!this.state.skipDownload&&i.compile()))}renderCore(){const{visible:e}=this.state;if(!e)return r.createElement("div",null);const t=pxt.getHwVariants();for(const e of t){e.card||(e.card={name:e.description});const t=e;e.card.onClick=()=>this.setHwVariant(t,null)}let i=this.fetchGallery();for(const e of i){const i=t.find((t=>t.name==e.variant)),n=e;i?e.onClick=()=>this.setHwVariant(i,n):pxt.reportError("hw","invalid variant")}return i=i.filter((e=>!!e.onClick)),r.createElement(a.Modal,{isOpen:e,className:"hardwaredialog",size:"large",onClose:this.close,dimmer:!0,closeIcon:!0,header:lf("Choose your hardware"),closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},r.createElement("div",{className:"group"},r.createElement("div",{className:"ui cards centered",role:"listbox"},i.map((e=>r.createElement(d.CodeCardView,{key:"card"+e.name,name:e.name,ariaLabel:e.name,description:e.description,imageUrl:e.imageUrl,learnMoreUrl:e.url,onClick:e.onClick}))),t.map((e=>r.createElement(d.CodeCardView,{key:"variant"+e.name,name:e.card.name,ariaLabel:e.card.name,description:e.card.description,imageUrl:e.card.imageUrl,learnMoreUrl:e.card.learnMoreUrl,onClick:e.card.onClick}))))),r.createElement("p",null,r.createElement("br",null),r.createElement("br",null),lf("No hardware? Or want to add some?")," ",r.createElement("a",{className:"small",href:"/hardware",target:"_blank",rel:"noopener noreferrer","aria-label":lf("Learn more about hardware")},lf("Learn more!"))))}}i.ChooseHwDialog=I},{"./auth":20,"./carousel":25,"./cloudsync":27,"./codecard":29,"./core":78,"./data":81,"./dialogs":88,"./sui":143,"./util":149,react:335,"react-dom":291}],124:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Editor=void 0;const n=e("react"),r=e("./package"),o=e("./srceditor"),s=e("./sui"),a=e("./core"),l=e("./data");var c=pxt.Util;const u=e("./util");class d extends o.Editor{constructor(e){super(e),this.parent=e,this.config={},this.changeMade=!1,this.handleNameInputRef=e=>{this.nameInput=e},this.saveOnClick=e=>{this.save()},this.editSettingsText=this.editSettingsText.bind(this),this.save=this.save.bind(this),this.setFileName=this.setFileName.bind(this),this.isUserConfigActive=this.isUserConfigActive.bind(this),this.applyUserConfig=this.applyUserConfig.bind(this),this.goBack=this.goBack.bind(this)}goBack(){pxt.tickEvent("pxtjson.backButton",void 0,{interactiveConsent:!0}),this.parent.openPreviousEditor()}prepare(){this.isReady=!0}getId(){return"pxtJsonEditor"}hasEditorToolbar(){return!1}save(e){const t=this.config;if(this.isSaving=!0,!t.name)return a.errorNotification(lf("Please choose a project name. It can't be blank.")),void(this.isSaving=!1);r.mainEditorPkg().lookupFile("this/"+pxt.CONFIG_NAME).setContentAsync(pxt.Package.stringifyConfig(t)).then((()=>{r.mainPkg.config.name=t.name,this.parent.setState({projectName:t.name}),this.parent.forceUpdate(),c.nextTick(this.changeCallback),this.isSaving=!1,this.changeMade=!0,e||this.parent.openPreviousEditor(),a.resetFocus()}))}setFileName(e){this.config.name=e,this.parent.forceUpdate()}optionaldepConfig(){let e={};return r.mainPkg.sortedDeps().filter((e=>e.config&&e.config.yotta&&e.config.yotta.optionalConfig)).forEach((t=>c.jsonMergeFrom(e,t.config.yotta.optionalConfig))),e}isUserConfigActive(e){let t=this.optionaldepConfig();this.config.yotta&&this.config.yotta.config&&c.jsonMergeFrom(t,this.config.yotta.config),t=c.jsonFlatten(t);const i=c.jsonFlatten(e.config);return!Object.keys(i).some((e=>null===i[e]?!!t[e]:t[e]!==i[e]))}applyUserConfig(e){c.jsonFlatten(this.optionaldepConfig());const t=c.jsonFlatten(this.config.yotta?this.config.yotta.config:{}),i=c.jsonFlatten(e.config);this.isUserConfigActive(e)?Object.keys(i).forEach((e=>{delete t[e]})):Object.keys(i).forEach((e=>t[e]=i[e])),Object.keys(t).length?(this.config.yotta||(this.config.yotta={}),this.config.yotta.config=c.jsonUnFlatten(t)):this.config.yotta&&(delete this.config.yotta.config,Object.keys(this.config.yotta).length||delete this.config.yotta),this.save(!0)}display(){if(!this.isVisible)return;const e=this.config;let t=[];return r.allEditorPkgs().map((e=>e.getKsPkg())).filter((e=>!!e&&e.isLoaded&&!!e.config&&!!e.config.yotta&&!!e.config.yotta.userConfigs)).forEach((e=>t=t.concat(e.config.yotta.userConfigs))),n.createElement("div",{className:"ui content"},n.createElement("div",{className:"ui small header"},n.createElement("div",{className:"content"},n.createElement(s.Button,{autoFocus:!0,title:lf("Go back"),tabIndex:0,onClick:this.goBack,onKeyDown:u.fireClickOnEnter},n.createElement(s.Icon,{icon:"arrow left"}),n.createElement("span",{className:"ui text landscape only"},lf("Go back"))))),n.createElement("div",{className:"ui segment form text"},n.createElement(s.Input,{ref:this.handleNameInputRef,id:"fileNameInput",label:lf("Name"),ariaLabel:lf("Type a name for your project"),value:e.name||"",onChange:this.setFileName,autoComplete:!1}),t.map((e=>n.createElement(p,{key:`userconfig-${e.description}`,uc:e,isUserConfigActive:this.isUserConfigActive,applyUserConfig:this.applyUserConfig}))),n.createElement(s.Field,null,n.createElement(s.Button,{text:lf("Save"),className:"green "+(this.isSaving?"disabled":""),onClick:this.saveOnClick}),n.createElement(s.Button,{text:lf("Edit Settings As text"),onClick:this.editSettingsText}))))}isIncomplete(){return!this.changeMade}editSettingsText(){this.changeMade=!1,this.parent.editText()}getCurrentSource(){return pxt.Package.stringifyConfig(this.config)}acceptsFile(e){if(e.name!=pxt.CONFIG_NAME)return!1;if(e.isReadonly())return!1;try{return JSON.parse(e.content),!0}catch(e){return!1}}loadFileAsync(e){return this.config=JSON.parse(e.content),this.nameInput&&this.nameInput.clearValue(),this.setDiagnostics(e,this.snapshotState()),this.changeMade=!1,Promise.resolve()}unloadFileAsync(){var e;return this.changeMade&&!(null===(e=this.parent.state)||void 0===e?void 0:e.home)?this.parent.reloadHeaderAsync():Promise.resolve()}}i.Editor=d;class p extends l.Component{constructor(e){super(e),this.state={},this.isUserConfigActive=this.isUserConfigActive.bind(this),this.applyUserConfig=this.applyUserConfig.bind(this)}isUserConfigActive(){const{applyUserConfig:e,isUserConfigActive:t,uc:i}=this.props;return t(i)}applyUserConfig(){const{applyUserConfig:e,isUserConfigActive:t,uc:i}=this.props;e(i)}renderCore(){const{uc:e}=this.props,t=this.isUserConfigActive();return n.createElement(s.Checkbox,{key:`userconfig-${e.description}`,inputLabel:pxt.Util.rlf(e.description),checked:t,onChange:this.applyUserConfig})}}},{"./core":78,"./data":81,"./package":122,"./srceditor":142,"./sui":143,"./util":149,react:335}],125:[function(e,t,i){"use strict";let n;Object.defineProperty(i,"__esModule",{value:!0}),i.renderAsync=void 0,i.renderAsync=function(e){return(n||(n=pxt.BrowserUtils.loadScriptAsync("qrcode/qrcode.min.js").then((()=>"undefined"!=typeof qrcode)).catch((e=>!1))),n).then((t=>{if(!t)return;const i=qrcode(0,"L");let n=/^(https.*\/)([0-9-]+)$/.exec(e);return n?(i.addData(n[1].toUpperCase(),"Alphanumeric"),i.addData(n[2].replace(/-/g,""),"Numeric")):(n=/^(https.*\/)(_[a-zA-Z0-9]+)$/.exec(e))?(i.addData(n[1].toUpperCase(),"Alphanumeric"),i.addData(n[2],"Byte")):i.addData(e,"Byte"),i.make(),i.createDataURL(5,5)})).catch((e=>{pxt.reportException(e)}))}},{}],126:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.loadGifEncoderAsync=i.GifEncoder=i.encodeBlobAsync=i.saveAsync=void 0;const n=e("./workspace"),r=e("./data");function o(e,t){let i=0,n=0,r=0,o=0;t.height>t.width?(i=0,o=(r=t.width)/e.width*e.height,n=(t.height-o)/2):(n=0,r=(o=t.height)/e.height*e.width,i=(t.width-r)/2),e.getContext("2d").drawImage(t,i,n,r,o,0,0,e.width,e.height)}function s(){return pxt.BrowserUtils.loadImageAsync(pxt.appTarget.appTheme.logo).then((e=>{const t=document.createElement("canvas");t.width=160,t.height=120;const i=t.getContext("2d"),n=pxt.appTarget.appTheme.accentColor;return n&&(i.fillStyle=n,i.fillRect(0,0,t.width,t.height)),o(t,e),t})).catch((()=>function(){const e=document.createElement("canvas");e.width=160,e.height=120;const t=e.getContext("2d");return t.fillStyle="#33b",t.fillRect(0,0,160,120),t.font="30px monospace",t.fillStyle="#fff",t.fillText(":(",60,70),Promise.resolve(e)}()))}i.saveAsync=function(e,t){return pxt.BrowserUtils.loadImageAsync(t).then((i=>{const s=function(e){let t=null;if(e&&e.width>0&&e.height>0){const i=document.createElement("canvas");i.width=305,i.height=200,o(i,e),t=i.toDataURL("image/jpeg",85)}return t}(i);return n.saveScreenshotAsync(e,t,s).then((()=>{r.invalidateHeader("header",e)}))}))},i.encodeBlobAsync=function(e,t,i){return(t?pxt.BrowserUtils.loadCanvasAsync(t):s()).catch((()=>s())).then((t=>function(e,t){const i=e.width,n=e.height,r=document.createElement("canvas");r.width=i+16+16,r.height=n+16+16+32;const o=r.getContext("2d");o.imageSmoothingEnabled=!1,o.fillStyle="white",o.fillRect(0,0,r.width,r.height),o.drawImage(e,16,16);const s=pxt.appTarget.thumbnailName||pxt.appTarget.name;if(s){const e=12;o.fillStyle="black",o.font="10px monospace",o.fillText(s,16,e,i-16)}if(t){const e=32+n+4;o.fillStyle="black",o.font="13px monospace",o.fillText(t,16,e,i-16)}{const e=32+n+4+16;o.fillStyle="#444",o.font="10px monospace";const t=pxt.appTarget.appTheme.homeUrl.replace(/^https:\/\//,"").replace(/\/$/,"");o.fillText(t,16,e,i)}return r}(t,e))).then((e=>pxt.Util.encodeBlobAsync(e,i).toDataURL("image/png")))};class a{constructor(e){this.options=e,this.scale=1,this.cancellationToken=new pxt.Util.CancellationToken,this.options.maxFrames||(this.options.maxFrames=64),e.scale&&(this.scale=e.scale)}start(){pxt.debug("gif: start encoder"),this.gif=new GIF(this.options),this.time=-1,this.cancellationToken=new pxt.Util.CancellationToken,this.cancellationToken.startOperation(),this.renderPromise=void 0}cancel(){if(pxt.debug("gif: cancel"),!this.cancellationToken.isCancelled()){if(this.cancellationToken.cancel(),this.gif&&this.gif.running)try{this.gif.abort()}catch(e){}this.clean()}}clean(){this.gif&&this.gif.freeWorkers&&(this.gif.freeWorkers.forEach((e=>e.terminate())),this.gif.freeWorkers=[]),this.gif=void 0,this.time=-1}addFrame(e,t){if(this.cancellationToken.isCancelled()||this.renderPromise)return!1;const i=pxt.Util.now();return this.time<0&&(this.time=i),void 0===t&&(t=i-this.time),1!=this.scale&&(e=pxt.BrowserUtils.scaleImageData(e,this.scale)),pxt.debug(`gif: frame ${t}ms`),this.gif.addFrame(e,{delay:t}),this.time=i,this.gif.frames.length>this.options.maxFrames}renderAsync(){if(this.cancellationToken.isCancelled())return Promise.resolve(void 0);const e=()=>this.renderGifAsync().then((t=>{if(this.cancellationToken.throwIfCancelled(),this.options.maxLength&&t.length>this.options.maxLength){const i=Math.floor(this.gif.frames.length*this.options.maxLength/t.length)-1;return pxt.log(`gif: size too large (${t.length/1e3|0}kb) reducing frames to ${i}`),i<=0?void pxt.log("gif: simulator image too large, cannot have a single frame"):(this.gif.frames=this.gif.frames.slice(0,i),e())}return pxt.log(`gif: rendered ${this.gif.frames.length} frames to ${t.length/1e3|0}kb`),t}));return pxt.debug(`gif: render ${this.gif.frames.length} frames`),this.renderPromise||(this.renderPromise=e().finally((()=>this.clean())).catch((e=>{pxt.debug("rendering failed"),pxt.debug(e)}))),this.renderPromise}renderGifAsync(){return this.cancellationToken.throwIfCancelled(),new Promise(((e,t)=>{this.gif.on("finished",(t=>{this.gif.running=!1,e(t)})),this.gif.on("abort",(()=>{pxt.debug("gif: abort"),e(void 0)})),this.gif.render()})).then((e=>ts.pxtc.Util.blobReadAsDataURL(e)))}}i.GifEncoder=a,i.loadGifEncoderAsync=function(){if(!pxt.webConfig.gifworkerjs)return Promise.resolve(void 0);const e={workers:1,dither:!1,workerScript:pxt.webConfig.gifworkerjs,quality:pxt.appTarget.appTheme.simGifQuality||16,transparent:pxt.appTarget.appTheme.simGifTransparent,maxFrames:pxt.appTarget.appTheme.simGifMaxFrames||64,maxLength:pxt.appTarget.appTheme.simScreenshotMaxUriLength||3e5,scale:2};return pxt.BrowserUtils.loadScriptAsync("gifjs/gif.js").then((()=>new a(e)))}},{"./data":81,"./workspace":151}],127:[function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};Object.defineProperty(i,"__esModule",{value:!0}),i.ScriptManagerDialog=void 0;const r=e("react"),o=e("./data"),s=e("./sui"),a=e("./core"),l=e("./workspace"),c=e("./compiler"),u=e("./components/searchInput"),d=e("./projects"),p=e("./util");class h extends o.Component{constructor(e){super(e),this.handleKeyDown=e=>{const t=a.keyCodeFromEvent(e);(pxt.BrowserUtils.isMac()?e.metaKey:e.ctrlKey)&&65===t&&this.handleSelectAll(e)},this.handleAreaClick=()=>{this.setState({selected:{}})},this.handleSelectAll=e=>{let{selected:t}=this.state;const i=this.getSortedHeaders();i.length>0&&i.length==Object.keys(t).length?t={}:i.forEach(((e,i)=>{t[this.getId(e)]=1})),this.setState({selected:t}),e.stopPropagation(),e.preventDefault()},this.toggleSortName=e=>{let{sortedBy:t,sortedAsc:i}=this.state;i=!("name"==t&&!e&&i),this.setState({sortedBy:"name",sortedAsc:i})},this.toggleSortTime=e=>{let{sortedAsc:t,sortedBy:i}=this.state;t="time"==i&&!e&&!t,this.setState({sortedBy:"time",sortedAsc:t})},this.handleSortName=e=>{e.stopPropagation(),this.toggleSortName(!0)},this.handleSortTime=e=>{e.stopPropagation(),this.toggleSortTime(!0)},this.handleToggleSortName=e=>{e.stopPropagation(),this.toggleSortName(!1)},this.handleToggleSortTime=e=>{e.stopPropagation(),this.toggleSortTime(!1)},this.handleSwitchSortDirection=e=>{e.stopPropagation();const{sortedAsc:t}=this.state;this.setState({sortedAsc:!t})},this.state={visible:!1,selected:{},markedNew:{},view:"grid",sortedBy:"time",sortedAsc:!1},this.close=this.close.bind(this),this.handleCardClick=this.handleCardClick.bind(this),this.handleDelete=this.handleDelete.bind(this),this.handleOpen=this.handleOpen.bind(this),this.handleOpenNewTab=this.handleOpenNewTab.bind(this),this.handleOpenNewLinkedTab=this.handleOpenNewLinkedTab.bind(this),this.handleDuplicate=this.handleDuplicate.bind(this),this.handleSwitchView=this.handleSwitchView.bind(this),this.handleSearch=this.handleSearch.bind(this),this.handleCheckboxClick=this.handleCheckboxClick.bind(this)}hide(){this.setState({visible:!1,searchFor:void 0})}close(){this.setState({visible:!1,searchFor:void 0}),this.props.onClose&&this.props.onClose()}show(){this.setState({visible:!0}),c.projectSearchClear()}fetchLocalData(){return this.getData(`headers:${this.state.searchFor||""}`)}handleCardClick(e,t,i,n,r){const o=e.shiftKey,s=r&&!o||(pxt.BrowserUtils.isMac()?e.metaKey:e.ctrlKey);let{selected:a,multiSelect:l,multiSelectStart:c}=this.state;if(!o||!s){if(s)a[n]?delete a[n]:a[n]=1,a[n]&&(c=i);else if(o){const e=this.getSortedHeaders();a={};for(let t=Math.min(i,c);t<=Math.max(i,c);t++)a[this.getId(e[t])]=1;l=!0}else l&&(a={},l=!1);o||s||(1==Object.keys(a).length&&a[n]?delete a[n]:((a={})[n]=1,c=i)),this.setState({selected:a,multiSelect:l,multiSelectStart:c}),e.stopPropagation(),e.preventDefault()}}handleCheckboxClick(e,t,i,n){this.handleCardClick(e,t,i,n,!0),e.preventDefault(),e.stopPropagation()}handleDelete(){let{selected:e}=this.state;const t=this.getSortedHeaders(),i=Object.keys(e).length;a.confirmDelete(1==i?t.find((t=>Object.keys(e)[0].includes(t.id))).name:i.toString(),(()=>{const i=[];return t.forEach(((t,n)=>{e[this.getId(t)]&&(t.isDeleted=!0,i.push(l.forceSaveAsync(t,{})))})),this.setState({selected:{}}),Promise.all(i).then((()=>{o.clearCache()}))}),i>1)}handleOpen(){pxt.tickEvent("scriptmanager.open",void 0,{interactiveConsent:!0});const e=this.getSelectedHeader();a.showLoading("changeheader",lf("loading...")),this.props.parent.loadHeaderAsync(e).then((()=>{a.hideLoading("changeheader")}))}handleOpenNewTab(){pxt.tickEvent("scriptmanager.newtab",void 0,{interactiveConsent:!0});const e=this.getSelectedHeader();this.props.parent.openNewTab(e,!1)}handleOpenNewLinkedTab(){pxt.tickEvent("scriptmanager.newlinkedtab",void 0,{interactiveConsent:!0});const e=this.getSelectedHeader();this.props.parent.openNewTab(e,!0)}handleDuplicate(){pxt.tickEvent("scriptmanager.dup",void 0,{interactiveConsent:!0});const e=this.getSelectedHeader(),t={header:lf("Choose a new name for your project"),agreeLbl:lf("Duplicate"),agreeClass:"green approve positive",agreeIcon:"clone",initialValue:l.createDuplicateName(e),placeholder:lf("Enter your project name here"),size:"tiny"};return a.promptAsync(t).then((t=>{if(null===t)return!1;let i;return l.duplicateAsync(e,t).then((e=>(i=this.getId(e),l.saveAsync(e)))).then((()=>(o.invalidate(`headers:${this.state.searchFor}`),this.setState({selected:{},markedNew:{[i]:1},sortedBy:"time",sortedAsc:!1}),setTimeout((()=>{this.setState({markedNew:{}})}),5e3),!0)))}))}handleSwitchView(){const e="grid"==this.state.view?"list":"grid";this.setState({view:e})}handleSearch(e){this.setState({searchFor:e,selected:{}})}getSelectedHeader(){const{selected:e}=this.state;if(1!==Object.keys(e).length)return null;const t=Object.keys(e)[0];return this.fetchLocalData().find((e=>t.includes(e.id)))}getSortedHeaders(){const{sortedBy:e,sortedAsc:t}=this.state;return(this.fetchLocalData()||[]).filter((e=>{var t,i;return!(null===(i=null===(t=e.tutorial)||void 0===t?void 0:t.metadata)||void 0===i?void 0:i.hideIteration)})).sort(this.getSortingFunction(e,t))}getSortingFunction(e,t){return(i,n)=>"time"===e?t?i.modificationTime-n.modificationTime:n.modificationTime-i.modificationTime:t?i.name.localeCompare(n.name):n.name.localeCompare(i.name)}getId(e){return"local"+e.id+e.recentUse}renderCore(){const{visible:e,selected:t,markedNew:i,view:n,searchFor:o,sortedBy:a,sortedAsc:l}=this.state;if(!e)return r.createElement("div",null);const c="dark"==pxt.appTarget.appTheme.baseTheme;let h=this.getSortedHeaders()||[];h=h.filter((e=>!e.isDeleted));const m=!!o||h.length>0,g=h.length>0&&h.length==Object.keys(t).length,b=pxt.appTarget.appTheme.openProjectNewTab&&!pxt.BrowserUtils.isElectron()&&!pxt.BrowserUtils.isUwpEdge()&&!pxt.BrowserUtils.isIOS(),v=b&&pxt.appTarget.appTheme.openProjectNewDependentTab&&!/nestededitorsim=1/.test(window.location.href);let y;if(m){if((y=[]).push(r.createElement(u.SearchInput,{key:"search",ariaMessage:lf("{0} result matching '{1}'",h.length,o),placeholder:lf("Search..."),className:"mobile hide",searchHandler:this.handleSearch,disabled:!1,style:{flexGrow:1},searchOnChange:!0})),Object.keys(t).length>0){if(1==Object.keys(t).length){const e=r.createElement(s.Button,{key:"edit",icon:"edit outline",className:"icon",text:lf("Open"),textClass:"landscape only",title:lf("Open Project"),onClick:this.handleOpen});b?y.push(r.createElement("div",{className:"ui buttons"},e,r.createElement(s.DropdownMenu,{className:"floating button",icon:"dropdown"},r.createElement(s.Item,{key:"editnewtab",icon:"external alternate",className:"icon",text:lf("New Tab"),title:lf("Open Project in a new tab"),onClick:this.handleOpenNewTab}),v&&r.createElement(s.Item,{key:"editnewlinkedtab",icon:"external alternate",className:"icon",text:lf("New Connected Tab"),title:lf("Open Project in a new tab with a connected simulator"),onClick:this.handleOpenNewLinkedTab})))):y.push(e),y.push(r.createElement(s.Button,{key:"clone",icon:"clone outline",className:"icon",text:lf("Duplicate"),textClass:"landscape only",title:lf("Duplicate Project"),onClick:this.handleDuplicate}))}y.push(r.createElement(s.Button,{key:"delete",icon:"trash",className:"icon red",text:lf("Delete"),textClass:"landscape only",title:lf("Delete Project"),onClick:this.handleDelete})),y.push(r.createElement("div",{key:"divider",className:"divider"}))}y.push(r.createElement(s.Button,{key:"view",icon:"grid"==n?"th list":"grid layout",className:"icon",title:`${"grid"==n?lf("List view"):lf("Grid view")}`,onClick:this.handleSwitchView}))}return r.createElement(s.Modal,{isOpen:e,className:"scriptmanager",size:"fullscreen",onClose:this.close,dimmer:!0,header:lf("My Projects"),closeIcon:!0,headerActions:y,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},m?void 0:r.createElement("div",{className:"empty-content"},r.createElement("h2",{className:"ui center aligned header "+(c?"inverted":"")},r.createElement("div",{className:"content"},lf("It's empty in here"),r.createElement("div",{className:"sub header"},lf("Go back to create a new project"))))),m&&"grid"==n?r.createElement("div",{role:"button",className:"ui container fluid",style:{height:"100%"},onClick:this.handleAreaClick,onKeyDown:this.handleKeyDown},r.createElement("div",{className:"sort-by"},r.createElement("div",{role:"menu",className:"ui compact buttons"},r.createElement(s.DropdownMenu,{role:"menuitem",text:"time"==a?lf("Last Modified"):lf("Name"),title:lf("Sort by dropdown"),className:"inline button "+(c?"inverted":""),displayLeft:!0},r.createElement(s.Item,{role:"menuitem",icon:"name"==a?"check":void 0,className:`${"name"!=a?"no-icon":""} ${c?"inverted":""}`,text:lf("Name"),tabIndex:-1,onClick:this.handleSortName}),r.createElement(s.Item,{role:"menuitem",icon:"time"==a?"check":void 0,className:`${"time"!=a?"no-icon":""} ${c?"inverted":""}`,text:lf("Last Modified"),tabIndex:-1,onClick:this.handleSortTime})),r.createElement(s.Button,{role:"menuitem",icon:"arrow "+(l?"up":"down"),className:""+(c?"inverted":""),onClick:this.handleSwitchSortDirection,title:lf("Switch sort order to {0}",l?lf("descending"):lf("ascending"))}))),r.createElement("div",{className:"ui cards"},h.sort(this.getSortingFunction(a,l)).map(((e,n)=>{const o=this.getId(e),s=!!i[o],a=!!t[o],l=s&&!a;let u=`circle outline ${a?"check":""} ${a?"green":"grey"} ${c?"inverted":""}`;l&&(u=void 0);const p=l?"orange right ribbon label":"right corner label large selected-label",h=l?lf("New"):void 0;return r.createElement(d.ProjectsCodeCard,{key:o,id:o,cardType:"file",className:"file "+(s?"warning":a?"positive":""),name:e.name,time:e.recentUse,url:e.pubId&&e.pubCurrent?"/"+e.pubId:"",scr:e,index:n,labelIcon:u,labelClass:p,label:h,onCardClick:this.handleCardClick,onLabelClick:this.handleCheckboxClick,projectId:e.id})})))):void 0,m&&"list"==n?r.createElement("div",{role:"table",className:"ui container",style:{height:"100%"},onClick:this.handleAreaClick,onKeyDown:this.handleKeyDown},r.createElement("table",{className:"ui definition unstackable table "+(c?"inverted":"")},r.createElement("thead",{className:"full-width"},r.createElement("tr",null,r.createElement("th",{onClick:this.handleSelectAll,tabIndex:0,onKeyDown:p.fireClickOnEnter,title:g?lf("De-select all projects"):lf("Select all projects"),style:{cursor:"pointer"}},r.createElement(s.Icon,{icon:"circle outline large "+(g?"check":"")})),r.createElement("th",{onClick:this.handleToggleSortName,tabIndex:0,onKeyDown:p.fireClickOnEnter,title:lf("Sort by Name {0}",l?lf("ascending"):lf("descending")),style:{cursor:"pointer"}},lf("Name")," ","name"==a?r.createElement(s.Icon,{icon:"arrow "+(l?"up":"down")}):void 0),r.createElement("th",{onClick:this.handleToggleSortTime,tabIndex:0,onKeyDown:p.fireClickOnEnter,title:lf("Sort by Last Modified {0}",l?lf("ascending"):lf("descending")),style:{cursor:"pointer"}},lf("Last Modified")," ","time"==a?r.createElement(s.Icon,{icon:"arrow "+(l?"up":"down")}):void 0))),r.createElement("tbody",null,h.sort(this.getSortingFunction(a,l)).map(((e,n)=>{const o=this.getId(e),s=!!i[o],a=!!t[o],l=s&&!a;return r.createElement(f,{key:o,id:o,selected:a,onRowClicked:this.handleCardClick,index:n,scr:e,markedNew:l},r.createElement("td",null,e.name),r.createElement("td",null,pxt.Util.timeSince(e.recentUse)))}))))):void 0)}}i.ScriptManagerDialog=h;class f extends s.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.handleCheckboxClick=this.handleCheckboxClick.bind(this)}handleClick(e){this.props.onRowClicked(e,this.props.scr,this.props.index)}handleCheckboxClick(e){this.props.onRowClicked(e,this.props.scr,this.props.index,this.props.id,!0),e.preventDefault(),e.stopPropagation()}renderCore(){const e=this.props,{scr:t,onRowClicked:i,onClick:o,selected:a,markedNew:l,children:c}=e,u=n(e,["scr","onRowClicked","onClick","selected","markedNew","children"]);return r.createElement("tr",Object.assign({tabIndex:0},u,{onKeyDown:p.fireClickOnEnter,onClick:this.handleClick,style:{cursor:"pointer"},className:""+(l?"warning":a?"positive":"")}),r.createElement("td",{className:"collapsing",onClick:this.handleCheckboxClick},r.createElement(s.Icon,{icon:"circle outline large "+(a?"check green":l?"black":"")})),c)}}},{"./compiler":30,"./components/searchInput":71,"./core":78,"./data":81,"./projects":123,"./sui":143,"./util":149,"./workspace":151,react:335}],128:[function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};Object.defineProperty(i,"__esModule",{value:!0}),i.ScriptSearch=i.ScriptSearchMode=void 0;const r=e("react"),o=e("react-dom"),s=e("./data"),a=e("./sui"),l=e("./package"),c=e("./core"),u=e("./codecard"),d=e("./electron"),p=e("./workspace"),h=e("./components/searchInput");var f,m;(m=f=i.ScriptSearchMode||(i.ScriptSearchMode={}))[m.Extensions=0]="Extensions",m[m.Boards=1]="Boards",m[m.Experiments=2]="Experiments";class g extends s.Component{constructor(e){super(e),this.state={searchFor:"",visible:!1,mode:f.Extensions,closeIcon:!0},this.hide=this.hide.bind(this),this.handleSearch=this.handleSearch.bind(this),this.addUrl=this.addUrl.bind(this),this.addBundle=this.addBundle.bind(this),this.installGh=this.installGh.bind(this),this.addLocal=this.addLocal.bind(this),this.toggleExperiment=this.toggleExperiment.bind(this),this.importExtensionFile=this.importExtensionFile.bind(this),this.backOnHide=this.backOnHide.bind(this)}hide(e,t){this.setState({visible:!1}),!0===t&&this.props.parent.openPreviousEditor(),this.state.mode==f.Experiments&&this.state.experimentsState!==pxt.editor.experiments.state()&&this.props.parent.reloadEditor()}afterHide(){const e=this.state.resolve;e&&(this.setState({resolve:void 0}),e())}showExtensions(e){this.setState({visible:!0,defaultSearch:e||"",searchFor:e||"",mode:f.Extensions,closeIcon:!0,features:void 0,resolve:void 0})}showBoardsAsync(e,t){return new Promise(((i,n)=>{this.setState({visible:!0,defaultSearch:void 0,searchFor:"",mode:f.Boards,closeIcon:!!t,features:e,resolve:i})}))}showExperiments(){this.setState({visible:!0,defaultSearch:void 0,searchFor:"",mode:f.Experiments,closeIcon:!0,experimentsState:pxt.editor.experiments.state(),features:void 0,resolve:void 0})}fetchUrlData(){const e={data:[],status:s.FetchStatus.Complete};if(!this.state.searchFor||this.state.mode!=f.Extensions)return e;const t=pxt.Cloud.parseScriptId(this.state.searchFor);if(!t)return e;const i=this.getDataWithStatus(`cloud-search:${t}`);return(!i.data||i.data&&404===i.data.statusCode)&&(i.data=[]),Array.isArray(i.data)||(i.data=[i.data]),i}fetchGhData(){const e={data:[],status:s.FetchStatus.Complete};if(this.state.mode!=f.Extensions)return e;const t=pxt.appTarget.cloud||{};if(!t.packages)return e;let i=t.githubPackages?this.state.searchFor:void 0;if(!i){const e=this.getDataWithStatus("target-config:"),t=e.data;e.status===s.FetchStatus.Complete&&t&&t.packages&&t.packages.preferredRepos&&(i=t.packages.preferredRepos.join("|"))}if(!i)return e;const n=this.getDataWithStatus(`gh-search:${i}`);return n.data&&404!==n.data.statusCode||(n.data=[]),n}fetchLocalRepositories(){if(this.state.mode!=f.Extensions)return[];let e=this.state.searchFor;const{header:t}=this.props.parent.state;let i=p.getHeaders();return/localdependencies=1/i.test(window.location.href)||(i=i.filter((e=>!!e.githubId))),t&&(i=i.filter((e=>e.id!=t.id))),e&&(e=e.toLocaleLowerCase(),i=i.filter((t=>t.name.toLocaleLowerCase().indexOf(e)>-1))),i}fetchBundled(){if(this.state.mode!=f.Boards&&this.state.mode!=f.Extensions)return[];const e=this.state.searchFor,t=pxt.appTarget.bundledpkgs,i=this.state.mode==f.Boards,n=this.state.features;return Object.keys(t).filter((e=>!/prj$/.test(e))).map((e=>JSON.parse(t[e]["pxt.json"]))).filter((e=>!e.hidden)).filter((t=>!(!e&&t.searchOnly))).filter((t=>!e||t.name.toLowerCase().indexOf(e.toLowerCase())>-1)).filter((e=>i||!l.mainPkg.deps[e.name]||l.mainPkg.deps[e.name].cppOnly)).filter((e=>!/---/.test(e.name))).filter((e=>i==!!e.core)).filter((e=>!n||n.every((t=>e.features&&e.features.indexOf(t)>-1))))}fetchExperiments(){return this.state.mode!=f.Experiments?[]:pxt.editor.experiments.all()}shouldComponentUpdate(e,t,i){return this.state.visible!=t.visible||this.state.searchFor!=t.searchFor||this.state.mode!=t.mode}componentDidUpdate(){let e=o.findDOMNode(this.refs.searchInput);e&&e.focus()}handleSearch(e){const t=/^\/@(.*)$/.exec(e);let i=t&&t[1];if(i)if("devtools"===i&&pxt.BrowserUtils.isPxtElectron())d.openDevTools(),this.hide(),this.afterHide();else{let e=pxt.appTarget.appTheme.homeUrl;/\/$/.test(e)||(e+="/"),i=i.replace(/^\//,""),pxt.winrt.releaseAllDevicesAsync().then((()=>{window.location.href=e+i}))}else this.setState({searchFor:e})}addUrl(e){return this.hide(null,this.backOnHide()),l.mainEditorPkg().setDependencyAsync(e.name,"pub:"+e.id).then((()=>this.props.parent.reloadHeaderAsync())).finally((()=>this.afterHide()))}addBundle(e){pxt.tickEvent("packages.bundled",{name:e.name}),this.hide(null,this.backOnHide()),this.addDepIfNoConflict(e,"*").finally((()=>this.afterHide()))}addLocal(e){pxt.tickEvent("packages.local"),this.hide(null,this.backOnHide()),p.getTextAsync(e.id).then((t=>{let i=JSON.parse(t[pxt.CONFIG_NAME]);return this.addDepIfNoConflict(i,"workspace:"+e.id)})).finally((()=>this.afterHide()))}async installGh(e){let t;pxt.tickEvent("packages.github",{name:e.fullName}),this.hide(null,this.backOnHide());try{c.showLoading("downloadingpackage",lf("downloading extension...")),t=await pxt.github.downloadLatestPackageAsync(e)}catch(e){c.handleNetworkError(e)}finally{c.hideLoading("downloadingpackage")}return await this.addDepIfNoConflict(t.config,t.version)}async addDepIfNoConflict(e,t){try{this.hide(null,this.backOnHide()),c.showLoading("installingextension",lf("installing extension...")),await l.mainEditorPkg().addDependencyAsync(e,t,this.state.mode==f.Boards)&&this.props.parent.reloadHeaderAsync()}finally{c.hideLoading("installingextension"),this.afterHide()}}toggleExperiment(e){pxt.editor.experiments.toggle(e),pxt.tickEvent("experiments.toggle",{experiment:e.id,enabled:pxt.editor.experiments.isEnabled(e)?1:0},{interactiveConsent:!0}),this.forceUpdate()}importExtensionFile(){pxt.tickEvent("extensions.import",void 0,{interactiveConsent:!0}),this.hide(null,this.backOnHide()),this.props.parent.showImportFileDialog({extension:!0})}backOnHide(){return this.props.parent.isPxtJsonEditor()}renderCore(){const{mode:e,closeIcon:t,visible:i,searchFor:n,experimentsState:o,defaultSearch:l}=this.state;if(!i)return r.createElement("div",null);const c=this.fetchBundled(),d=this.fetchGhData(),p=this.fetchUrlData(),m=this.fetchLocalRepositories(),g=this.fetchExperiments(),v=n&&(d.status===s.FetchStatus.Pending||p.status===s.FetchStatus.Pending),y=pxt.appTarget.appTheme.disableFileAccessinMaciOs&&(pxt.BrowserUtils.isIOS()||pxt.BrowserUtils.isMac()),k=pxt.appTarget.appTheme.disableFileAccessinAndroid&&pxt.BrowserUtils.isAndroid(),w=e==f.Extensions&&pxt.appTarget.appTheme.importExtensionFiles&&!y&&!k&&!n,x=window.location.href.replace(/\/(#|$|\?)/,"/beta$1"),E=e==f.Experiments&&x!=window.location.href;c.sort(((e,t)=>{if(e.core!=t.core)return e.core?-1:1;const i=pxt.isPkgBeta(e);if(i!=pxt.isPkgBeta(t))return i?1:-1;const n=void 0===e.weight?50:e.weight,r=void 0===t.weight?50:t.weight;return n!=r?-n+r:pxt.Util.strcmp(e.name,t.name)}));const C=e==f.Boards?lf("Boards"):e==f.Experiments?lf("Experiments"):lf("Extensions"),S=e==f.Boards?lf("Change development board"):e==f.Experiments?lf("Turn on and off experimental features"):lf("Add an extension to the project"),_=e==f.Boards?"/boards":e==f.Experiments?"/experiments":"/extensions",T=e==f.Experiments&&o!=pxt.editor.experiments.state(),A=this.props.parent.createModalClasses("searchdialog"),N=e=>e.name.replace(/^pxt-/,""),I=lf("Search or enter project URL...");return r.createElement(a.Modal,{isOpen:i,dimmer:!0,className:A,size:"fullscreen",onClose:this.hide,closeIcon:t,header:C,helpUrl:_,closeOnDimmerClick:!0,closeOnEscape:!0,description:S},r.createElement("div",{className:"ui"},e==f.Experiments?r.createElement("div",{className:"ui message info"},r.createElement("div",{className:"header"},lf("WARNING: EXPERIMENTAL FEATURES AHEAD!")),lf("Try out these features and tell us what you think!")):void 0,e==f.Extensions?r.createElement(h.SearchInput,{key:"search",defaultValue:l,ariaMessage:lf("{0} result matching '{1}'",c.length+d.data.length+p.data.length,n),placeholder:I,"aria-label":I,searchHandler:this.handleSearch,inputClassName:"fluid",autoFocus:!0,disabled:v}):void 0,v?r.createElement("div",{className:"ui medium active centered inline loader"}):r.createElement("div",{className:"ui cards centered","aria-label":lf("Extension search results")},p.data.map((e=>r.createElement(b,{key:"url"+e.id,name:e.name,description:e.description,url:"/"+e.id,scr:e,onCardClick:this.addUrl,role:"button"}))),m.map((e=>r.createElement(b,{key:"local"+e.id,name:e.name,description:lf("Local copy of {0} hosted on github.com",e.githubId),url:"https://github.com/"+e.githubId,imageUrl:e.icon,scr:e,onCardClick:this.addLocal,label:lf("Local"),title:lf("Local GitHub extension"),labelClass:"blue right ribbon",role:"button"}))),c.map((e=>r.createElement(b,{key:"bundled"+e.name,name:e.name,description:e.description,imageUrl:e.icon,scr:e,onCardClick:this.addBundle,label:pxt.isPkgBeta(e)?lf("Beta"):void 0,role:"button"}))),d.data.filter((e=>e.status==pxt.github.GitRepoStatus.Approved)).map((e=>r.createElement(b,{name:N(e),description:e.description,key:"gha"+e.fullName,scr:e,onCardClick:this.installGh,url:"github:"+e.fullName,imageUrl:pxt.github.repoIconUrl(e),label:pxt.isPkgBeta(e)?lf("Beta"):void 0,role:"button",learnMoreUrl:`/pkg/${e.fullName}`}))),d.data.filter((e=>e.status!=pxt.github.GitRepoStatus.Approved)).map((e=>r.createElement(b,{name:N(e),description:e.description||"",extracontent:lf("User-provided extension, not endorsed by Microsoft."),key:"ghd"+e.fullName,scr:e,onCardClick:this.installGh,imageUrl:pxt.github.repoIconUrl(e),label:pxt.isPkgBeta(e)?lf("Beta"):void 0,url:"github:"+e.fullName,role:"button",learnMoreUrl:`/pkg/${e.fullName}`}))),g.map((e=>r.createElement(b,{name:e.name,scr:e,imageUrl:`/static/experiments/${e.id.toLowerCase()}.png`,description:e.description,key:"exp"+e.id,role:"button",label:pxt.editor.experiments.isEnabled(e)?lf("Enabled"):lf("Disabled"),labelClass:pxt.editor.experiments.isEnabled(e)?"green right ribbon":"grey right ribbon",onCardClick:this.toggleExperiment,feedbackUrl:e.feedbackUrl}))),w&&r.createElement(u.CodeCardView,{ariaLabel:lf("Open files from your computer"),role:"button",key:"import",icon:"upload ui cardimage",iconColor:"secondary",name:lf("Import File..."),description:lf("Open files from your computer"),onClick:this.importExtensionFile}),E&&r.createElement(u.CodeCardView,{ariaLabel:lf("Open the next version of the editor"),role:"button",key:"beta",icon:"lab ui cardimage",iconColor:"secondary",name:lf("Beta Editor"),label:lf("Beta"),labelClass:"red right ribbon",description:lf("Open the next version of the editor"),url:x})),n&&!v&&c.length+d.data.length+p.data.length===0?r.createElement("div",{className:"ui items"},r.createElement("div",{className:"ui item"},lf("We couldn't find any extensions matching '{0}'",n))):void 0),T?r.createElement("div",{className:"ui warning message"},r.createElement("div",{className:"header"},lf("Experiments changed")),lf("The editor will reload when leaving this page.")):void 0)}}i.ScriptSearch=g;class b extends a.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){const{scr:e,onCardClick:t}=this.props;t(e)}renderCore(){const e=this.props,{onCardClick:t,onClick:i,scr:o}=e,s=n(e,["onCardClick","onClick","scr"]);return r.createElement(u.CodeCardView,Object.assign({},s,{onClick:this.handleClick}))}}},{"./codecard":29,"./components/searchInput":71,"./core":78,"./data":81,"./electron":91,"./package":122,"./sui":143,"./workspace":151,react:335,"react-dom":291}],129:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ResourceImporter=i.StartPauseButton=i.Editor=void 0;const n=e("react"),r=e("smoothie"),o=e("./core"),s=e("./srceditor"),a=e("./sui"),l=e("./data");var c=pxt.Util;const u=e("./util");class d extends s.Editor{constructor(e){super(e),this.parent=e,this.savedMessageQueue=[],this.maxSavedMessages=1e3,this.charts=[],this.chartIdx=0,this.sourceMap={},this.serialInputDataBuffer="",this.maxSerialInputDataLength=255,this.isSim=!0,this.maxConsoleEntries=500,this.active=!0,this.rawDataBuffer="",this.maxBufferLength=1e4,this.csvHeaders=[],this.highContrast=!1,this.handleStartPauseRef=e=>{this.startPauseButton=e},this.handleChartRootRef=e=>{this.chartRoot=e},this.handleConsoleRootRef=e=>{this.consoleRoot=e},window.addEventListener("message",this.processEvent.bind(this),!1);const t=pxt.appTarget.serial&&pxt.appTarget.serial.editorTheme;this.lineColors=t&&t.lineColors||["#e00","#00e","#0e0"],this.hcLineColors=["#000"],this.currentLineColors=this.lineColors,this.goBack=this.goBack.bind(this),this.toggleRecording=this.toggleRecording.bind(this),this.downloadRaw=this.downloadRaw.bind(this),this.downloadCSV=this.downloadCSV.bind(this)}getId(){return"serialEditor"}hasHistory(){return!1}hasEditorToolbar(){return!1}setVisible(e){const t=o.getHighContrastOnce();t!==this.highContrast&&this.setHighContrast(t),this.isVisible=e,this.isVisible?(this.processQueuedMessages(),this.startRecording()):(this.pauseRecording(),this.clear())}setHighContrast(e){e!==this.highContrast&&(this.highContrast=e,this.currentLineColors=e?this.hcLineColors:this.lineColors,this.clear())}acceptsFile(e){return e.name===pxt.SERIAL_EDITOR_FILE}setSim(e){this.isSim!=e&&(this.isSim=e,this.clear())}simStateChanged(){this.charts.forEach((e=>e.setRealtimeData(this.wantRealtimeData())))}wantRealtimeData(){return!this.isSim||this.parent.isSimulatorRunning()}saveMessageForLater(e){this.savedMessageQueue.push(e),this.savedMessageQueue.length>this.maxSavedMessages&&this.savedMessageQueue.shift()}processQueuedMessages(){this.savedMessageQueue.forEach((e=>this.processMessage(e))),this.savedMessageQueue=[]}processEvent(e){let t=e.data;"serial"===t.type?this.processEventCore(t):"bulkserial"===t.type&&t.data.forEach((e=>{this.processEventCore({type:"serial",data:e.data,receivedTime:e.time,sim:t.sim,id:t.id})}))}processEventCore(e){e.receivedTime=e.receivedTime||c.now(),this.active?this.processMessage(e):this.saveMessageForLater(e)}mapSource(e){if(!this.sourceMap[e]){const t=Object.keys(this.sourceMap).length+1;this.sourceMap[e]=lf("source")+t.toString()}return this.sourceMap[e]}processMessage(e){if(!!e.sim!=this.isSim)return;const t=e.data||"",i=e.id||"?",n=e.receivedTime||c.now();this.appendRawData(t);const r=this.mapSource(i),o=this.chunkDataIntoLines(t);for(const e of o)this.processMessageLine(e,r,n)}processMessageLine(e,t,i){if(/^\s*\{[^}]+\}\s*$/.test(e))try{const t=JSON.parse(e),n=parseInt(t.t),r=this.mapSource(t.s),o=t.n||"",s=parseFloat(t.v);isNaN(n)||isNaN(s)||this.appendGraphEntry(r,o,s,i)}catch(e){}else if(/^\s*(-?\d+(\.\d*)?(e[\+\-]\d+)?)(\s*,\s*(-?\d+(\.\d*)?(e[\+\-]\d+)?))+\s*,?\s*$/.test(e))e.split(/\s*,\s*/).map((e=>parseFloat(e))).filter((e=>!isNaN(e))).forEach(((e,n)=>{const r="data."+(this.csvHeaders[n]||n);this.appendGraphEntry(t,r,e,i)}));else if(/^\s*[\s\w]+(\s*,\s*[\w\s]+)+\s*,?\s*$/.test(e))this.csvHeaders=e.split(/\s*,\s*/).map((e=>e.trim()));else{const n=/^\s*(([^:]+):)?\s*(-?\d+(\.\d*)?(e[\+\-]\d+)?)/i.exec(e);if(n){const e=n[2]||"",r=parseFloat(n[3]);isNaN(r)||this.appendGraphEntry(t,e,r,i)}}this.appendConsoleEntry(e)}appendRawData(e){this.rawDataBuffer+=e,this.rawDataBuffer.length>this.maxBufferLength&&this.rawDataBuffer.slice(this.rawDataBuffer.length/4)}appendGraphEntry(e,t,i,n){let r=this.charts.find((i=>i.shouldContain(e,t)));r||((r=new h(e,t,this.chartIdx,this.currentLineColors)).setRealtimeData(this.wantRealtimeData()),this.chartIdx++,this.charts.push(r),this.chartRoot.appendChild(r.getElement()),pxt.BrowserUtils.removeClass(this.chartRoot,"nochart"),this.consoleRoot&&pxt.BrowserUtils.removeClass(this.consoleRoot,"nochart"),1==this.charts.length&&this.parent.forceUpdate()),r.addPoint(t,i,n)}chunkDataIntoLines(e){let t=[];for(let i=0;i<e.length;++i){const n=e[i];this.serialInputDataBuffer+=n,"\n"!==n&&this.serialInputDataBuffer.length<this.maxSerialInputDataLength||("\n"===n?(this.serialInputDataBuffer=this.serialInputDataBuffer.replace(/\s+$/,""),this.serialInputDataBuffer.length&&t.push(this.serialInputDataBuffer)):t.push(this.serialInputDataBuffer),this.serialInputDataBuffer="")}return t}appendConsoleEntry(e){if(e.length>=this.maxSerialInputDataLength){let t=document.createElement("span");t.appendChild(document.createTextNode(e)),this.consoleRoot.appendChild(t)}else{let t=this.consoleRoot.lastChild,i=document.createElement("div");if(t&&t.lastChild.textContent==e)if(2==t.childNodes.length){let e=parseInt(t.firstChild.textContent);t.firstChild.textContent=(e+1).toString()}else{let e=document.createElement("a");e.className="ui horizontal label",e.textContent="2",t.insertBefore(e,t.lastChild)}else i.appendChild(document.createTextNode(e)),this.consoleRoot.appendChild(i)}for(this.consoleRoot.scrollTop=this.consoleRoot.scrollHeight;this.consoleRoot.childElementCount>this.maxConsoleEntries;)this.consoleRoot.removeChild(this.consoleRoot.firstChild);this.consoleRoot&&this.consoleRoot.childElementCount>0&&(this.chartRoot&&pxt.BrowserUtils.removeClass(this.chartRoot,"noconsole"),this.consoleRoot&&pxt.BrowserUtils.removeClass(this.consoleRoot,"noconsole"))}pauseRecording(){this.active=!1,this.startPauseButton&&this.startPauseButton.setState({active:this.active}),this.charts.forEach((e=>e.stop()))}startRecording(){this.active=!0,this.startPauseButton&&this.startPauseButton.setState({active:this.active}),this.charts.forEach((e=>e.start()))}toggleRecording(){pxt.tickEvent("serial.toggleRecording",void 0,{interactiveConsent:!0}),this.active?this.pauseRecording():this.startRecording()}clearNode(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}clear(){this.chartRoot&&(this.clearNode(this.chartRoot),pxt.BrowserUtils.addClass(this.chartRoot,"noconsole"),pxt.BrowserUtils.addClass(this.chartRoot,"nochart")),this.consoleRoot&&(this.clearNode(this.consoleRoot),pxt.BrowserUtils.addClass(this.consoleRoot,"noconsole"),pxt.BrowserUtils.addClass(this.consoleRoot,"nochart")),this.charts=[],this.serialInputDataBuffer="",this.rawDataBuffer="",this.savedMessageQueue=[],this.sourceMap={},this.csvHeaders=[]}isCSV(e,t){if(t.length<2)return!1;for(let i=0;i<t.length;++i)if(t[i].length!=e)return!1;for(let i=0;i<e;++i){let e=t[0][i][0];for(let n=1;n<t.length;++n)if(t[n][i][0]!=e)return!1}return!0}downloadCSV(){const e=lf("{id:csvseparator}\t");let t=[];if(!this.charts.length||!this.charts.some((e=>Object.keys(e.datas).length>0)))return void o.confirmAsync({header:lf("No data to export"),hideAgree:!0,disagreeLbl:lf("Ok"),body:lf("You must generate some serial data before you can export it.")});this.charts.forEach((i=>{const n=[];Object.keys(i.datas).forEach((e=>n.push({name:e,line:i.datas[e]})));const r=n.map((e=>e.line)),o=r.length>0?r.map((e=>e.length)).reduce(((e,t)=>Math.max(e,t))):0;if(this.isCSV(o,r)){let s=`time (${i.source})${e}`+n.map((e=>e.name)).join(e)+e;t[0]=t[0]?t[0]+e+s:s;for(let i=0;i<o;++i){const n=(r[0][i][0]-r[0][0][0])/1e3+e+r.map((e=>e[i][1])).join(e)+e;t[i+1]=t[i+1]?t[i+1]+e+n:n}}else{let s=n.map((t=>`time (${i.source})${e}${t.name}`)).join(e);t[0]=t[0]?t[0]+e+s:s;for(let i=0;i<o;++i){const n=r.map((t=>i<t.length?`${(t[i][0]-t[0][0])/1e3}${e}${t[i][1]}`:e)).join(e);t[i+1]=t[i+1]?t[i+1]+e+n:n}}})),t.unshift(`sep=${e}`);const i=t.join("\r\n");o.infoNotification(lf("Exporting data...."));const n=new Date(Date.now()).toString().replace(/[^\d]+/g,"-").replace(/(^-|-$)/g,"");pxt.commands.browserDownloadAsync(c.toUTF8(i),pxt.appTarget.id+"-"+lf("{id:csvfilename}data")+"-"+n+".csv","text/csv")}downloadRaw(){o.infoNotification(lf("Exporting text...."));const e=new Date(Date.now()).toString().replace(/[^\d]+/g,"-").replace(/(^-|-$)/g,"");let t=this.rawDataBuffer;pxt.BrowserUtils.isWindows()&&(t=t.replace(/[^\r]\n/g,"\r\n")),pxt.commands.browserDownloadAsync(c.toUTF8(t),pxt.appTarget.id+"-"+lf("{id:csvfilename}console")+"-"+e+".txt","text/plain")}goBack(){pxt.tickEvent("serial.backButton",void 0,{interactiveConsent:!0}),this.parent.openPreviousEditor()}display(){var e;return n.createElement("div",{id:"serialArea"},n.createElement("div",{id:"serialHeader",className:"ui serialHeader"},n.createElement("div",{className:"leftHeaderWrapper"},n.createElement("div",{className:"leftHeader"},n.createElement(a.Button,{title:lf("Go back"),tabIndex:0,onClick:this.goBack,onKeyDown:u.fireClickOnEnter},n.createElement(a.Icon,{icon:"arrow left"}),n.createElement("span",{className:"ui text landscape only"},lf("Go back"))))),n.createElement("div",{className:"rightHeader"},n.createElement(a.Button,{title:lf("Copy text"),className:"ui icon button editorExport",ariaLabel:lf("Copy text"),onClick:this.downloadRaw},n.createElement(a.Icon,{icon:"copy"})),n.createElement(a.Button,{title:lf("Export data"),className:"ui icon blue button editorExport",ariaLabel:lf("Export data"),onClick:this.downloadCSV},n.createElement(a.Icon,{icon:"download"})),n.createElement(p,{ref:this.handleStartPauseRef,active:this.active,toggle:this.toggleRecording}),n.createElement("span",{className:"ui small header"},this.isSim?lf("Simulator"):lf("Device")))),0==(null===(e=this.charts)||void 0===e?void 0:e.length)&&n.createElement("div",{id:"serialPlaceholder",className:"ui segment"},n.createElement("div",{className:"ui bottom left attached no-select label seriallabel"},lf("Values will be logged when the {0} sends data",this.isSim?lf("simulator"):lf("device")))),n.createElement("div",{id:"serialCharts",ref:this.handleChartRootRef}),n.createElement("div",{id:"serialConsole",ref:this.handleConsoleRootRef}))}domUpdate(){}}i.Editor=d;class p extends l.PureComponent{constructor(e){super(e),this.state={active:this.props.active}}renderCore(){const{toggle:e}=this.props,{active:t}=this.state;return n.createElement(a.Button,{title:t?lf("Pause recording"):lf("Start recording"),className:`ui left floated icon button ${t?"green":"red circular"} toggleRecord`,onClick:e},n.createElement(a.Icon,{icon:t?"pause icon":"circle icon"}))}}i.StartPauseButton=p;class h{constructor(e,t,i,n){this.rootElement=document.createElement("div"),this.lines={},this.datas={};const o=pxt.appTarget.serial&&pxt.appTarget.serial.editorTheme,s={interpolation:"bezier",labels:{disabled:!1,fillStyle:"black",fontSize:14},responsive:!0,millisPerPixel:20,grid:{verticalSections:0,borderVisible:!1,millisPerLine:5e3,fillStyle:o&&o.gridFillStyle||"transparent",strokeStyle:o&&o.gridStrokeStyle||"#fff"},tooltip:!0,tooltipFormatter:(e,t)=>this.tooltip(e,t)};this.lineColors=n,this.chartIdx=i,this.chart=new r.SmoothieChart(s),this.rootElement.className="ui segment",this.source=e,this.variable=t.replace(/\..*$/,""),this.rootElement.appendChild(this.makeLabel()),this.rootElement.appendChild(this.makeCanvas())}tooltip(e,t){return t.map((e=>{const t=e.series.timeSeries.__name;return`<span>${t?t+": ":""}${e.value}</span>`})).join("<br/>")}getLine(e){let t=this.lines[e];if(!t){const i=this.lineColors[this.chartIdx++%this.lineColors.length];this.lines[e]=t=new r.TimeSeries,t.__name=c.htmlEscape(e.substring(this.variable.length+1)),this.chart.addTimeSeries(t,{strokeStyle:i,lineWidth:3}),this.datas[e]=[]}return t}makeLabel(){return this.label=document.createElement("div"),this.label.className="ui orange bottom left attached no-select label seriallabel",this.label.innerText=this.variable||"...",this.label}makeCanvas(){let e=document.createElement("canvas");return this.chart.streamTo(e),this.canvas=e,e}getCanvas(){return this.canvas}getElement(){return this.rootElement}shouldContain(e,t){return this.source==e&&this.variable==t.replace(/\..*$/,"")}addPoint(e,t,i){if(this.getLine(e).append(i,t),1==Object.keys(this.lines).length){const e=pxsim.Math_.roundWithPrecision(t,2).toString();this.label.innerText=this.variable?`${this.variable}: ${e}`:e}else this.label.innerText=this.variable||"";const n=this.datas[e];n.push([i,t]),n.length>4e3&&n.splice(0,n.length/4)}start(){this.chart.start()}stop(){this.chart.stop()}setRealtimeData(e){this.chart.options.nonRealtimeData=!e}}i.ResourceImporter=class{canImport(e){return"text/plain"==e.type}importAsync(e,t){return ts.pxtc.Util.fileReadAsTextAsync(t).then((e=>{if(!e)return void o.errorNotification(lf("Ooops, could not read file"));const i=e.split(/\n/g).map((e=>{const i=/^\s*(\d+)>/.exec(e);return i&&(e=e.substr(i[0].length)),{type:"serial",data:e+"\n",id:t.name,receivedTime:i?parseFloat(i[1]):void 0}}));if(!i.length)return;const n=c.now(),r=i.filter((e=>!!e.receivedTime));if(r.length){const e=r[r.length-1].receivedTime||0;r.forEach((t=>t.receivedTime+=n-e))}i.forEach((e=>window.postMessage(e,"*")))}))}}},{"./core":78,"./data":81,"./srceditor":142,"./sui":143,"./util":149,react:335,smoothie:377}],130:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SerialIndicator=void 0;const n=e("react"),r=e("./data"),o=e("./util");class s extends r.Component{constructor(e){super(e),this.state={active:!1}}componentDidMount(){window.addEventListener("message",this.setActive.bind(this))}componentWillUnmount(){window.addEventListener("message",this.setActive.bind(this))}setActive(e){let t=e.data;if(!this.state.active&&("serial"===t.type||"bulkserial"===t.type)&&!!t.sim===this.props.isSim){this.setState({active:!0});const e=this.props.parent;this.props.isSim?e.setState({simSerialActive:!0}):e.setState({deviceSerialActive:!0})}}active(){return!!this.state.active}clear(){this.setState({active:!1})}renderCore(){return this.active()?n.createElement("div",{role:"button",title:lf("Open console"),className:"ui label circular",tabIndex:0,onClick:this.props.onClick,onKeyDown:o.fireClickOnEnter},n.createElement("div",{className:"detail"},n.createElement("img",{alt:lf("Animated bar chart"),className:"barcharticon",src:pxt.Util.pathJoin(pxt.webConfig.commitCdnUrl,"images/Bars_black.gif")})),n.createElement("span",null,lf("Show console")),n.createElement("div",{className:"detail"},this.props.isSim?lf("Simulator"):lf("Device"))):n.createElement("div",null)}}i.SerialIndicator=s},{"./data":81,"./util":149,react:335}],131:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ShareEditor=i.ShareRecordingState=i.ShareMode=void 0;const n=e("react"),r=e("./data"),o=e("./sui"),s=e("./simulator"),a=e("./screenshot"),l=e("./qr"),c=e("./util");var u,d,p;(p=u=i.ShareMode||(i.ShareMode={}))[p.Code=0]="Code",p[p.Url=1]="Url",p[p.Editor=2]="Editor",p[p.Simulator=3]="Simulator",function(e){e[e.None=0]="None",e[e.ScreenshotSnap=1]="ScreenshotSnap",e[e.GifLoading=2]="GifLoading",e[e.GifRecording=3]="GifRecording",e[e.GifRendering=4]="GifRendering"}(d=i.ShareRecordingState||(i.ShareRecordingState={}));class h extends r.Component{constructor(e){super(e),this.screenshotAsync=()=>this.props.parent.requestScreenshotAsync().then((e=>{const t={recordingState:d.None,recordError:void 0};e?t.screenshotUri=e:t.recordError=lf("Oops, screenshot failed. Please try again."),this.setState(t)})),this.handleKeyDown=e=>{const{visible:t}=this.state,i=pxt.appTarget.appTheme,n=e.key.toLocaleLowerCase();!t||document.activeElement&&"INPUT"===document.activeElement.tagName||(i.simScreenshotKey&&n===i.simScreenshotKey.toLocaleLowerCase()?this.handleScreenshotClick():i.simGifKey&&n===i.simGifKey.toLocaleLowerCase()&&this.handleRecordClick())},this.state={pubId:void 0,visible:!1,screenshotUri:void 0,recordingState:d.None,recordError:void 0,title:void 0},this.hide=this.hide.bind(this),this.setAdvancedMode=this.setAdvancedMode.bind(this),this.handleProjectNameChange=this.handleProjectNameChange.bind(this),this.restartSimulator=this.restartSimulator.bind(this),this.handleRecordClick=this.handleRecordClick.bind(this),this.handleScreenshotClick=this.handleScreenshotClick.bind(this),this.handleScreenshotMessage=this.handleScreenshotMessage.bind(this),this.handleCreateGitHubRepository=this.handleCreateGitHubRepository.bind(this),this.handleQrCodeClick=this.handleQrCodeClick.bind(this)}hide(){if(this.state.qrCodeExpanded){pxt.tickEvent("share.qrtoggle");const{qrCodeExpanded:e}=this.state;this.setState({qrCodeExpanded:!e})}else this._gifEncoder&&(this._gifEncoder.cancel(),this._gifEncoder=void 0),this.loanedSimulator&&(s.driver.unloanSimulator(),this.loanedSimulator=void 0,this.props.parent.popScreenshotHandler(),s.driver.stopRecording()),this.setState({visible:!1,screenshotUri:void 0,projectName:void 0,projectNameChanged:!1,recordingState:d.None,recordError:void 0,qrCodeUri:void 0,title:void 0})}show(e){const{header:t}=this.props.parent.state;if(!t)return;const i=pxt.appTarget.cloud&&pxt.appTarget.cloud.thumbnails&&(pxt.appTarget.appTheme.simScreenshot||pxt.appTarget.appTheme.simGif);i&&(this.loanedSimulator=s.driver.loanSimulator(),this.props.parent.pushScreenshotHandler(this.handleScreenshotMessage)),this.setState({thumbnails:i,visible:!0,mode:u.Code,pubId:void 0,sharingError:void 0,screenshotUri:void 0,qrCodeUri:void 0,qrCodeExpanded:!1,title:e,projectName:t.name},i?()=>this.props.parent.startSimulator():void 0)}handleScreenshotMessage(e){const{visible:t}=this.state;if(e&&t)if("start"!==e.event)if("stop"!=e.event)this.state.recordingState==d.GifRecording?this._gifEncoder.addFrame(e.data,e.delay)&&this.gifRender():this.state.recordingState==d.ScreenshotSnap||this.state.recordingState===d.None?this.setState({screenshotUri:pxt.BrowserUtils.imageDataToPNG(e.data),recordingState:d.None,recordError:void 0}):s.driver.stopRecording();else switch(this.state.recordingState){case d.GifRecording:this.gifRender()}else switch(this.state.recordingState){case d.None:this.gifRecord()}}UNSAFE_componentWillReceiveProps(e){const t={};this.state.projectNameChanged||e.parent.state.projectName==this.state.projectName||(t.projectName=e.parent.state.projectName),e.loading!=this.state.loading&&(t.loading=e.loading),Object.keys(t).length>0&&this.setState(t)}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}shouldComponentUpdate(e,t,i){return this.state.visible!=t.visible||this.state.mode!=t.mode||this.state.pubId!=t.pubId||this.state.sharingError!==t.sharingError||this.state.projectName!=t.projectName||this.state.projectNameChanged!=t.projectNameChanged||this.state.loading!=t.loading||this.state.recordingState!=t.recordingState||this.state.screenshotUri!=t.screenshotUri||this.state.qrCodeUri!=t.qrCodeUri||this.state.qrCodeExpanded!=t.qrCodeExpanded||this.state.title!=t.title}setAdvancedMode(e){this.setState({mode:e})}handleProjectNameChange(e){this.setState({projectName:e,projectNameChanged:!0})}restartSimulator(){pxt.tickEvent("share.restart",void 0,{interactiveConsent:!0}),this.props.parent.restartSimulator()}handleQrCodeClick(e){pxt.tickEvent("share.qrtoggle"),e.stopPropagation();const{qrCodeExpanded:t}=this.state;this.setState({qrCodeExpanded:!t})}handleScreenshotClick(){pxt.tickEvent("share.takescreenshot",{view:"computer",collapsedTo:""+!this.props.parent.state.collapseEditorTools},{interactiveConsent:!0}),this.state.recordingState==d.None&&this.setState({recordingState:d.ScreenshotSnap,recordError:void 0},(()=>this.screenshotAsync()))}handleRecordClick(){switch(this.state.recordingState){case d.None:this.gifRecord();break;case d.GifRecording:this.gifRender()}}loadEncoderAsync(){return this._gifEncoder?Promise.resolve(this._gifEncoder):a.loadGifEncoderAsync().then((e=>this._gifEncoder=e))}gifRecord(){pxt.tickEvent("share.gifrecord",{view:"computer",collapsedTo:""+!this.props.parent.state.collapseEditorTools},{interactiveConsent:!0}),this.state.recordingState==d.None&&this.setState({recordingState:d.GifLoading,screenshotUri:void 0},(()=>this.loadEncoderAsync().then((e=>{if(e){e.start();const t=pxt.appTarget.appTheme.simGifWidth||160;this.setState({recordingState:d.GifRecording},(()=>s.driver.startRecording(t)))}else this.setState({recordingState:d.None,recordError:lf("Oops, gif encoder could not load. Please try again.")})})).catch((e=>{pxt.reportException(e),this.setState({recordingState:d.None,recordError:lf("Oops, gif recording failed. Please try again.")}),this._gifEncoder&&this._gifEncoder.cancel()}))))}gifRender(){pxt.debug("render gif"),s.driver.stopRecording(),this._gifEncoder&&this.setState({recordingState:d.GifRendering,recordError:void 0},(()=>{this.props.parent.stopSimulator(),this._gifEncoder.renderAsync().then((e=>{pxt.log(`gif: ${e?e.length:0} chars`);const t=pxt.appTarget.appTheme.simScreenshotMaxUriLength;let i;e&&(t&&e.length>t?(pxt.tickEvent("gif.toobig",{size:e.length}),e=void 0,i=lf("Gif is too big, try recording a shorter time.")):pxt.tickEvent("gif.ok",{size:e.length})),this.setState({recordingState:d.None,screenshotUri:e,recordError:i}),pxt.Util.delay(1e3).then((()=>this.props.parent.startSimulator()))}))}))}handleCreateGitHubRepository(){pxt.tickEvent("share.github.create",void 0,{interactiveConsent:!0}),this.hide(),this.props.parent.createGitHubRepositoryAsync()}renderCore(){var e,t,i;const{visible:r,projectName:s,loading:a,recordingState:p,screenshotUri:h,thumbnails:g,recordError:b,pubId:v,qrCodeUri:y,qrCodeExpanded:k,title:w,sharingError:x}=this.state,E=pxt.appTarget.appTheme,C=this.props.parent.state.header,S=!!E.hideShareEmbed||k,_=E.socialOptions,T=!!_&&!pxt.BrowserUtils.isUwpEdge()&&!k,A=!!v;let N=this.state.mode,I="",O="",P=pxt.appTarget.appTheme.shareUrl||"https://makecode.com/";/\/$/.test(P)||(P+="/");let D=pxt.appTarget.appTheme.embedUrl;/\/$/.test(D)||(D+="/");const L=pxt.webConfig.verprefix||"";if(C&&A){I=`${P}${v}`;let e=`${D}${L}#pub:${v}`;switch(N){case u.Code:O=pxt.docs.codeEmbedUrl(`${D}${L}`,v);break;case u.Editor:O=pxt.docs.embedUrl(`${D}${L}`,"pub",v);break;case u.Simulator:let t="81.97%",i=`${L}---run`;pxt.webConfig.runUrl&&(i=pxt.webConfig.isStatic?pxt.webConfig.runUrl:pxt.webConfig.runUrl.replace(pxt.webConfig.relprefix,"/---")),pxt.appTarget.simulator&&(t=(100/pxt.appTarget.simulator.aspectRatio).toPrecision(4)+"%");const n=D+i.replace(/^\//,"");O=pxt.docs.runUrl(n,t,v);break;case u.Url:O=e}}const R=[{mode:u.Code,label:lf("Code")},{mode:u.Editor,label:lf("Editor")},{mode:u.Simulator,label:lf("Simulator")}],M=A?void 0:lf("Publish project"),B=a&&!this.state.sharingError;let j=[];M&&j.push({label:M,onclick:()=>{pxt.tickEvent("menu.embed.publish",void 0,{interactiveConsent:!0}),this.setState({sharingError:void 0,loading:!0});let e=Promise.resolve();s&&this.props.parent.state.projectName!=s&&(e=this.props.parent.updateHeaderNameAsync(s)),E.simScreenshot&&!h&&(e=e.then(this.screenshotAsync)),e.then((()=>this.props.parent.anonymousPublishAsync(this.state.screenshotUri))).then((e=>{this.setState({pubId:e,qrCodeUri:void 0,qrCodeExpanded:!1}),pxt.appTarget.appTheme.qrCode&&l.renderAsync(`${P}${e}`).then((t=>{this.state.pubId==e&&this.setState({qrCodeUri:t})})),this.forceUpdate()})).catch((e=>{pxt.tickEvent("menu.embed.error",{code:e.statusCode}),this.setState({pubId:void 0,sharingError:e,qrCodeUri:void 0,qrCodeExpanded:!1})})),this.forceUpdate()},icon:"share alternate",loading:B,className:"primary",disabled:p!=d.None});const U=!!pxt.options.light,F=lf("You need to publish your project to share it or embed it in other web pages.")+" "+lf("You acknowledge having consent to publish this project."),H=B||p!=d.None,q=this.loanedSimulator&&E.simScreenshotKey?lf("Take Screenshot (shortcut: {0})",E.simScreenshotKey):lf("Take Screenshot"),z=E.simScreenshot,G=!U&&!!E.simGif,$=p==d.GifRecording,V=p==d.GifRendering,W=$?"stop":"circle",K=$?E.simGifKey?lf("Stop recording (shortcut: {0})",E.simGifKey):lf("Stop recording"):V?lf("Cancel rendering"):E.simGifKey?lf("Start recording (shortcut: {0})",E.simGifKey):lf("Start recording"),J=$?"glow":"",Y=B,X=p==d.GifLoading||V,Q=b||($?lf("Recording in progress..."):V?lf("Rendering gif..."):void 0),Z=b?"warning":"",ee=x&&413===x.statusCode&&(null===(i=null===(t=null===(e=pxt.appTarget)||void 0===e?void 0:e.cloud)||void 0===t?void 0:t.cloudProviders)||void 0===i?void 0:i.github),te=x&&!ee,ie=!!y&&k,ne=this.props.parent.createModalClasses("sharedialog");return n.createElement(o.Modal,{isOpen:r,className:ne,size:g?"":"small",onClose:this.hide,dimmer:!0,header:w||lf("Share Project"),closeIcon:!0,buttons:j,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},n.createElement("div",{className:"ui form"},M&&!this.loanedSimulator?n.createElement("div",{className:"ui field"},n.createElement("div",null,n.createElement(o.Input,{ref:"filenameinput",placeholder:lf("Name"),autoFocus:!pxt.BrowserUtils.isMobile(),id:"projectNameInput",ariaLabel:lf("Type a name for your project"),autoComplete:!1,value:s||"",onChange:this.handleProjectNameChange}))):void 0,M&&this.loanedSimulator?n.createElement("div",{className:"ui fields"},n.createElement("div",{id:"shareLoanedSimulator",className:`simulator ui six wide field landscape only ${J}`}),n.createElement("div",{className:"ui ten wide field"},n.createElement(o.Input,{ref:"filenameinput",placeholder:lf("Name"),autoFocus:!pxt.BrowserUtils.isMobile(),id:"projectNameInput",ariaLabel:lf("Type a name for your project"),autoComplete:!1,value:s||"",onChange:this.handleProjectNameChange}),n.createElement("label",null),n.createElement("div",{className:"ui buttons landscape only"},n.createElement(o.Button,{icon:"refresh",title:lf("Restart"),ariaLabel:lf("Restart"),onClick:this.restartSimulator,disabled:H}),z?n.createElement(o.Button,{icon:"camera",title:q,ariaLabel:q,onClick:this.handleScreenshotClick,disabled:H}):void 0,G?n.createElement(o.Button,{icon:W,title:K,loading:X,onClick:this.handleRecordClick,disabled:Y}):void 0),h||Q?n.createElement("div",{className:`ui ${Z} segment landscape only`},h&&!Q?n.createElement("img",{className:"ui small centered image",src:h,alt:lf("Recorded gif")}):n.createElement("p",{className:"no-select"},Q)):void 0,n.createElement("p",{className:"ui tiny message info"},F))):void 0,M&&!this.loanedSimulator?n.createElement("p",{className:"ui tiny message info"},F):void 0,ee&&n.createElement("p",{className:"ui orange inverted segment"},lf("Oops! Your project is too big. You can create a GitHub repository to share it."),n.createElement(o.Button,{className:"inverted basic",text:lf("Create"),icon:"github",onClick:this.handleCreateGitHubRepository})),te&&n.createElement("p",{className:"ui red inverted segment"},lf("Oops! There was an error. Please ensure you are connected to the Internet and try again.")),I&&A?n.createElement("div",null,!ie&&n.createElement("p",null,lf("Your project is ready! Use the address below to share your projects.")),!ie&&n.createElement(o.Input,{id:"projectUri",class:"mini",readOnly:!0,lines:1,value:I,copy:!0,autoFocus:!pxt.BrowserUtils.isMobile(),selectOnClick:!0,"aria-describedby":"projectUriLabel",autoComplete:!1}),!ie&&n.createElement("label",{htmlFor:"projectUri",id:"projectUriLabel",className:"accessible-hidden"},lf("This is the read-only internet address of your project.")),!!y&&n.createElement("img",{className:`ui ${ie?"huge":"small"} image ${k?"centered":"floated right"} button pixelart`,alt:lf("QR Code of the saved program"),src:y,onClick:this.handleQrCodeClick,title:lf("Click to expand or collapse."),tabIndex:0,"aria-label":lf("QR Code of the saved program"),onKeyDown:c.fireClickOnEnter}),T?n.createElement("div",{className:"social-icons"},n.createElement(f,{url:I,ariaLabel:"Facebook",type:"facebook",heading:lf("Share on Facebook")}),n.createElement(f,{url:I,ariaLabel:"Twitter",type:"twitter",heading:lf("Share on Twitter")}),_.discourse?n.createElement(f,{url:I,icon:"comments",ariaLabel:lf("Post to Forum"),type:"discourse",heading:lf("Share on Forum")}):void 0):void 0):void 0,A&&!S&&n.createElement("div",null,n.createElement("div",{className:"ui divider"}),n.createElement(o.ExpandableMenu,{title:lf("Embed")},n.createElement(o.Menu,{pointing:!0,secondary:!0},R.map((e=>n.createElement(m,Object.assign({key:`tab${e.label}`,onClick:this.setAdvancedMode,currentMode:N},e))))),n.createElement(o.Field,null,n.createElement(o.Input,{id:"embedCode",class:"mini",readOnly:!0,lines:4,value:O,copy:A,disabled:!A,selectOnClick:!0,autoComplete:!1}),n.createElement("label",{htmlFor:"embedCode",id:"embedCodeLabel",className:"accessible-hidden"},lf("This is the read-only code for the selected tab.")))))))}componentDidUpdate(){const e=document.getElementById("shareLoanedSimulator");e&&this.loanedSimulator&&!this.loanedSimulator.parentNode&&e.appendChild(this.loanedSimulator)}}i.ShareEditor=h;class f extends r.Component{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this)}handleClick(e){const{type:t,url:i,heading:n}=this.props,r=pxt.appTarget.appTheme.socialOptions;pxt.tickEvent(`share.${t}`,void 0,{interactiveConsent:!0});let o="";switch(t){case"facebook":o=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(i)}`;break;case"twitter":{let e=lf("Check out what I made!");r.twitterHandle&&r.orgTwitterHandle?e=lf("Check out what I made with @{0} and @{1}!",r.twitterHandle,r.orgTwitterHandle):r.twitterHandle?e=lf("Check out what I made with @{0}!",r.twitterHandle):r.orgTwitterHandle&&(e=lf("Check out what I made with @{0}!",r.orgTwitterHandle)),o=`https://twitter.com/intent/tweet?url=${encodeURIComponent(i)}&text=${encodeURIComponent(e)}`+(r.hashtags?`&hashtags=${encodeURIComponent(r.hashtags)}`:"")+(r.related?`&related=${encodeURIComponent(r.related)}`:"");break}case"discourse":o=`${r.discourse||"https://forum.makecode.com/"}new-topic?title=${encodeURIComponent(i)}`,r.discourseCategory&&(o+=`&category=${encodeURIComponent(r.discourseCategory)}`)}pxt.BrowserUtils.popupWindow(o,n,600,600),e.preventDefault()}renderCore(){const{type:e,label:t,ariaLabel:i,icon:r}=this.props;return n.createElement("a",{role:"button",className:`ui button large ${t?"labeled":""} icon ${e}`,tabIndex:0,"aria-label":i,onClick:this.handleClick,onKeyDown:c.fireClickOnEnter},n.createElement(o.Icon,{icon:r||e}),t)}}class m extends o.StatelessUIElement{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}handleClick(){this.props.onClick(this.props.mode)}renderCore(){const{label:e,mode:t,currentMode:i}=this.props;return n.createElement(o.MenuItem,{id:`tab${t}`,active:i==t,tabIndex:0,name:e,onClick:this.handleClick})}}},{"./data":81,"./qr":125,"./screenshot":126,"./simulator":135,"./sui":143,"./util":149,react:335}],132:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SidebarTutorialCard=i.SidebarTutorialHint=void 0;const n=e("react"),r=e("./sui"),o=e("./marked"),s=e("./tutorial"),a=e("./util");class l extends s.TutorialHint{constructor(e){super(e)}renderCore(){const e=this.props.parent.state.tutorialOptions,{tutorialName:t,tutorialReady:i,tutorialStepInfo:s,tutorialStep:l,tutorialStepExpanded:c,metadata:u}=e,d=s[l],p=d.hintContentMd,h=d.showDialog,f=d.contentMd,m=this.props.parent.createModalClasses("hintdialog");let g=l<s.length-1?this.next:this.closeHint;const b=[{label:lf("Start"),onclick:g,className:"green"}];return n.createElement("div",{id:"callout",className:"callout-container"},n.createElement(r.Button,{className:"callout-hint ui circular label blue hintbutton",icon:"lightbulb outline",tabIndex:-1,onKeyDown:a.fireClickOnEnter}),h?n.createElement(r.Modal,{isOpen:!0,className:m,closeIcon:!1,header:t,buttons:b,onClose:g,dimmer:!0,longer:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},n.createElement(o.MarkedContent,{markdown:f,parent:this.props.parent})):n.createElement("div",{className:"callout-wrapper"},n.createElement("div",{className:"callout-hint-header"},"Hint:"),n.createElement("div",{className:"callout-hint-text"},n.createElement(o.MarkedContent,{markdown:p,unboxSnippets:!0,parent:this.props.parent}))))}}i.SidebarTutorialHint=l;class c extends s.TutorialCard{constructor(e){super(e)}renderCore(){const e=this.props.parent.state.tutorialOptions,{tutorialName:t,tutorialStepInfo:i,tutorialStep:r}=e,s=i[r],c=!!i[r].hintContentMd||i[r].showDialog,u=s.headerContentMd,d=s.showDialog;let p="",h="";return c&&(p+=lf("Press Space or Enter to show a hint."),lf("Click to show a hint!")),n.createElement("div",{id:"sidebar"},n.createElement("div",{className:"tutorialTitle"},n.createElement("p",null,t)),n.createElement("div",{ref:"tutorialmessage",className:"tutorialMessage",role:"alert","aria-label":p,tabIndex:c?0:-1,onKeyDown:c?a.fireClickOnEnter:void 0},n.createElement("div",{className:"content"},!d&&n.createElement(o.MarkedContent,{className:"no-select",markdown:u,parent:this.props.parent,onDidRender:this.onMarkdownDidRender}))),c&&n.createElement(l,{parent:this.props.parent}))}}i.SidebarTutorialCard=c},{"./marked":111,"./sui":143,"./tutorial":146,"./util":149,react:335}],133:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Sidepanel=void 0;const n=e("react"),r=e("./data"),o=e("./filelist"),s=e("./keymap"),a=e("./serialindicator"),l=e("./simtoolbar"),c=e("./simulator"),u=e("./sui"),d=e("./components/core/TabContent"),p=e("./components/core/TabPane"),h=e("./components/tutorial/TutorialContainer"),f=e("./util"),m="tab-tutorial",g="tab-simulator";class b extends r.Component{constructor(e){super(e),this.showSimulatorTab=()=>{this.props.showMiniSim(!1),this.setState({activeTab:g,height:void 0}),c.driver.focus()},this.showTutorialTab=()=>{this.props.showMiniSim(!0),this.setState({activeTab:m})},this.handleSimSerialClick=()=>{this.props.openSerial(!0)},this.handleDeviceSerialClick=()=>{this.props.openSerial(!1)},this.handleSimOverlayClick=()=>{const{tutorialOptions:e,handleFullscreenButtonClick:t}=this.props;!e||pxt.BrowserUtils.useOldTutorialLayout()?t():this.showSimulatorTab()},this.handleSimPanelRef=e=>{this.simPanelRef=e,e&&"undefined"!=typeof ResizeObserver&&new ResizeObserver((()=>{var t,i;e.scrollHeight>e.clientHeight?null===(t=this.simPanelRef)||void 0===t||t.classList.remove("invisibleScrollbar"):null===(i=this.simPanelRef)||void 0===i||i.classList.add("invisibleScrollbar")})).observe(e)},this.setComponentHeight=e=>{e!=this.state.height&&this.setState({height:e})},this.tutorialExitButton=()=>n.createElement("div",{className:"tutorial-exit","aria-label":lf("Exit tutorial"),tabIndex:0,onClick:()=>this.props.parent.exitTutorial(),onKeyDown:f.fireClickOnEnter},lf("Exit Tutorial"))}UNSAFE_componentWillReceiveProps(e){var t,i;!this.props.tutorialOptions&&e.tutorialOptions||this.props.inHome&&!e.inHome&&e.tutorialOptions||(null===(t=this.props.tutorialOptions)||void 0===t?void 0:t.tutorial)&&(null===(i=e.tutorialOptions)||void 0===i?void 0:i.tutorial)&&this.props.tutorialOptions.tutorial!==e.tutorialOptions.tutorial?this.showTutorialTab():(!this.props.inHome&&e.inHome||this.props.tutorialOptions&&!e.tutorialOptions)&&this.showSimulatorTab()}componentDidUpdate(e,t){(this.state.height||t.height)&&this.state.height!=t.height&&this.props.setEditorOffset()}renderCore(){var e,t;const{parent:i,inHome:r,showKeymap:c,showSerialButtons:f,showFileList:b,showFullscreenButton:v,collapseEditorTools:y,simSerialActive:k,deviceSerialActive:w,tutorialOptions:x,handleHardwareDebugClick:E,onTutorialStepChange:C,onTutorialComplete:S}=this.props,{activeTab:_,height:T}=this.state,A=(null==x?void 0:x.tutorial)&&!pxt.BrowserUtils.useOldTutorialLayout(),N=pxt.appTarget.appTheme.lockedEditor,I=!(null===(e=pxt.appTarget.simulator)||void 0===e?void 0:e.headless),O=I?"6.5rem":"3rem",P=n.createElement(u.Button,{icon:"arrow circle left",text:lf("Back"),onClick:this.showTutorialTab}),D=n.createElement(u.Button,{icon:"arrow circle right",text:lf("Next"),onClick:this.showTutorialTab});return n.createElement("div",{id:"simulator",className:"simulator"},n.createElement(p.TabPane,{id:"editorSidebar",activeTabName:_,style:T?{height:`calc(${T}px + ${O})`}:void 0},I&&n.createElement(d.TabContent,{name:g,icon:"xicon gamepad",onSelected:this.showSimulatorTab,ariaLabel:lf("Open the simulator tab")},A&&!N&&this.tutorialExitButton(),n.createElement("div",{className:"ui items simPanel",ref:this.handleSimPanelRef},n.createElement("div",{id:"boardview",className:"ui vertical editorFloat",role:"region","aria-label":lf("Simulator"),tabIndex:r?-1:0}),n.createElement(l.SimulatorToolbar,{parent:i,collapsed:y,simSerialActive:k,devSerialActive:w,showSimulatorSidebar:this.showSimulatorTab}),c&&n.createElement(s.Keymap,{parent:i}),n.createElement("div",{className:"ui item portrait hide hidefullscreen"},pxt.options.debug&&n.createElement(u.Button,{key:"hwdebugbtn",className:"teal",icon:"xicon chip",text:"Dev Debug",onClick:E})),f&&n.createElement("div",{id:"serialPreview",className:"ui editorFloat portrait hide hidefullscreen"},n.createElement(a.SerialIndicator,{ref:"simIndicator",isSim:!0,onClick:this.handleSimSerialClick,parent:i}),n.createElement(a.SerialIndicator,{ref:"devIndicator",isSim:!1,onClick:this.handleDeviceSerialClick,parent:i})),b&&n.createElement(o.FileList,{parent:i}),v&&n.createElement("div",{id:"miniSimOverlay",role:"button",title:lf("Open in fullscreen"),onClick:this.handleSimOverlayClick})),A&&n.createElement("div",{className:"tutorial-controls"},P,n.createElement(u.Button,{icon:"lightbulb",disabled:!0,className:"tutorial-hint"}),D)),x&&n.createElement(d.TabContent,{name:m,icon:"icon tasks",showBadge:_!==m,onSelected:this.showTutorialTab,ariaLabel:lf("Open the tutorial tab")},n.createElement(h.TutorialContainer,{parent:i,tutorialId:x.tutorial,name:x.tutorialName,steps:x.tutorialStepInfo,currentStep:x.tutorialStep,tutorialOptions:x,hideIteration:null===(t=x.metadata)||void 0===t?void 0:t.hideIteration,hasTemplate:!!x.templateCode,onTutorialStepChange:C,onTutorialComplete:S,setParentHeight:this.setComponentHeight}))))}}i.Sidepanel=b},{"./components/core/TabContent":69,"./components/core/TabPane":70,"./components/tutorial/TutorialContainer":73,"./data":81,"./filelist":95,"./keymap":108,"./serialindicator":130,"./simtoolbar":134,"./simulator":135,"./sui":143,"./util":149,react:335}],134:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PlayButton=i.SimulatorToolbar=void 0;const n=e("react"),r=e("./data"),o=e("./sui");class s extends r.Component{constructor(e){super(e),this.state={},pxt.BrowserUtils.isIOS()&&this.props.parent.setMute(!0),this.toggleMute=this.toggleMute.bind(this),this.restartSimulator=this.restartSimulator.bind(this),this.openInstructions=this.openInstructions.bind(this),this.startStopSimulator=this.startStopSimulator.bind(this),this.toggleSimulatorFullscreen=this.toggleSimulatorFullscreen.bind(this),this.toggleSimulatorCollapse=this.toggleSimulatorCollapse.bind(this),this.openDeviceSimulator=this.openDeviceSimulator.bind(this),this.openDeviceSerial=this.openDeviceSerial.bind(this),this.takeScreenshot=this.takeScreenshot.bind(this),this.toggleDebug=this.toggleDebug.bind(this)}openInstructions(){pxt.tickEvent("simulator.make",void 0,{interactiveConsent:!0}),this.props.parent.openInstructions()}startStopSimulator(){pxt.tickEvent("simulator.startstop",void 0,{interactiveConsent:!0}),this.props.parent.startStopSimulator({clickTrigger:!0})}restartSimulator(){pxt.tickEvent("simulator.restart",void 0,{interactiveConsent:!0}),this.props.parent.restartSimulator()}toggleDebug(){pxt.tickEvent("simulator.debug",void 0,{interactiveConsent:!0}),this.props.parent.toggleDebugging()}toggleMute(){pxt.tickEvent("simulator.mute",{view:"computer",muteTo:""+!this.props.parent.state.mute},{interactiveConsent:!0}),this.props.parent.toggleMute()}toggleSimulatorFullscreen(){pxt.tickEvent("simulator.fullscreen",{view:"computer",fullScreenTo:""+!this.props.parent.state.fullscreen},{interactiveConsent:!0}),this.props.parent.toggleSimulatorFullscreen()}toggleSimulatorCollapse(){pxt.tickEvent("simulator.toggleCollapse",{view:"computer",collapsedTo:""+!this.props.parent.state.collapseEditorTools},{interactiveConsent:!0}),this.props.parent.toggleSimulatorCollapse()}openDeviceSerial(){pxt.tickEvent("simulator.fullscreen.serial.simulator",{},{interactiveConsent:!0}),this.props.parent.toggleSimulatorFullscreen(),this.props.parent.openDeviceSerial()}openDeviceSimulator(){pxt.tickEvent("simulator.fullscreen.serial.device",{},{interactiveConsent:!0}),this.props.parent.toggleSimulatorFullscreen(),this.props.parent.openSimSerial()}takeScreenshot(){pxt.tickEvent("simulator.takescreenshot",{view:"computer",collapsedTo:""+!this.props.parent.state.collapseEditorTools},{interactiveConsent:!0}),this.props.parent.downloadScreenshotAsync()}renderCore(){const{collapsed:e,devSerialActive:t,parent:i,simSerialActive:r,showSimulatorSidebar:s}=this.props,l=i.state;if(!l.currFile||l.home)return n.createElement("div",null);const c=pxt.appTarget.appTheme,u=pxt.appTarget.simulator,d=pxt.shell.isSandboxMode(),p=!d&&l.showParts&&c.instructions,h=l.simState,f=h==pxt.editor.SimState.Running,m=h==pxt.editor.SimState.Starting,g=h==pxt.editor.SimState.Pending,b=l.fullscreen,v=l.mute,y=!!l.tutorialOptions&&!!l.tutorialOptions.tutorial,k=y&&!pxt.BrowserUtils.useOldTutorialLayout(),w=i.isBlocksActive()||i.isJavaScriptActive()||i.isPythonActive(),x=!u.hideRestart,E=c.debugger&&!y&&!pxt.BrowserUtils.isIE(),C=l.debugging,S=!u.hideFullscreen&&!d,_=c.hasAudio,T=u.headless,A=!!c.simScreenshot,N=l.screenshoting?"loading":"",I=!m&&!g&&w,O=!C&&!m&&!g,P=!c.bigRunButton,D=lf("Open assembly instructions"),L=lf("Restart the simulator"),R=lf("Toggle debug mode"),M=lf("View simulator keyboard shortcuts"),B=lf("Show simulator in sidebar"),j=b?lf("Exit fullscreen mode"):lf("Launch in fullscreen"),U=v?lf("Unmute audio"):lf("Mute audio"),F=c.simScreenshotKey?lf("Take Screenshot (shortcut {0})",c.simScreenshotKey):lf("Take Screenshot"),H=e?lf("Show the simulator"):lf("Hide the simulator"),q=lf("Open simulator console"),z=lf("Open device console"),G=b&&(r||t);return n.createElement("aside",{className:"ui item grid centered simtoolbar"+(d?"":" portrait "),role:"complementary","aria-label":lf("Simulator toolbar")},n.createElement("div",{className:"ui icon tiny buttons",style:{padding:"0"}},k&&n.createElement(o.Button,{key:"simsidebarbtn",className:"sidebar-button tablet only",icon:"external flipped",title:B,onClick:s}),p&&n.createElement(o.Button,{disabled:C,icon:"configure",className:"secondary",title:D,onClick:this.openInstructions}),!c.bigRunButton&&n.createElement(a,{parent:i,simState:l.simState,debugging:l.debugging}),S&&n.createElement(o.Button,{key:"fullscreenbtn",className:"fullscreen-button tablet only hidefullscreen",icon:"xicon fullscreen",title:j,onClick:this.toggleSimulatorFullscreen}),x&&n.createElement(o.Button,{disabled:!O,key:"restartbtn",className:"restart-button",icon:"refresh",title:L,onClick:this.restartSimulator}),E&&n.createElement(o.Button,{disabled:!I,key:"debugbtn",className:"debug-button "+(C?"orange":""),icon:"icon bug",title:R,onClick:this.toggleDebug}),P&&n.createElement(o.Button,{className:"expand-button portrait only editortools-btn hidefullscreen",icon:""+(e?"play":"stop"),title:H,onClick:this.toggleSimulatorCollapse})),!T&&n.createElement("div",{className:"ui icon tiny buttons computer only",style:{padding:"0"}},_&&n.createElement(o.Button,{key:"mutebtn",className:"mute-button "+(v?"red":""),icon:""+(v?"volume off":"volume up"),title:U,onClick:this.toggleMute}),u.keymap&&n.createElement(o.Button,{key:"keymap",className:"keymap-button",icon:"keyboard",title:M,onClick:i.toggleKeymap})),G&&n.createElement("div",{className:"ui item tiny buttons full-screen-console"},r&&n.createElement(o.Button,{icon:"list",className:"purple",title:q,onClick:this.openDeviceSimulator}),t&&n.createElement(o.Button,{icon:"usb",className:"purple",title:z,onClick:this.openDeviceSerial})),!T&&n.createElement("div",{className:"ui icon tiny buttons computer only",style:{padding:"0"}},A&&n.createElement(o.Button,{disabled:!f,key:"screenshotbtn",className:`screenshot-button ${N}`,icon:"icon camera left",title:F,onClick:this.takeScreenshot}),S&&n.createElement(o.Button,{key:"fullscreenbtn",className:"fullscreen-button",icon:"xicon "+(b?"fullscreencollapse":"fullscreen"),title:j,onClick:this.toggleSimulatorFullscreen})))}}i.SimulatorToolbar=s;class a extends o.StatelessUIElement{constructor(e){super(e),this.startStopSimulator=()=>{pxt.tickEvent("simulator.startstop",void 0,{interactiveConsent:!0}),this.props.parent.startStopSimulator({clickTrigger:!0})}}renderCore(){const e=this.props.simState,t=e==pxt.editor.SimState.Running,i=e==pxt.editor.SimState.Starting,r=e==pxt.editor.SimState.Pending,s=!this.props.debugging&&!i&&!r,a=(()=>{switch(e){case pxt.editor.SimState.Stopped:return lf("Start the simulator");case pxt.editor.SimState.Pending:case pxt.editor.SimState.Starting:return lf("Starting the simulator");case pxt.editor.SimState.Running:return lf("Stop the simulator")}})();return n.createElement(o.Button,{disabled:!s,key:"runbtn",className:`play-button ${this.props.className||""} ${t?"stop":"play"}`,icon:t?"stop":"play green",title:a,onClick:this.startStopSimulator})}}i.PlayButton=a},{"./data":81,"./sui":143,react:335}],135:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.dbgStepOut=i.dbgStepInto=i.dbgStepOver=i.dbgPauseResume=i.proxy=i.setTraceInterval=i.unhide=i.hide=i.suspend=i.stop=i.mute=i.run=i.setPending=i.setDirty=i.setState=i.init=i.setTranslations=i.simTranslations=i.driver=i.SLOW_TRACE_INTERVAL=i.FAST_TRACE_INTERVAL=void 0;const n=e("./core"),r=e("./coretsx");var o=pxt.U;let s,a;i.FAST_TRACE_INTERVAL=100,i.SLOW_TRACE_INTERVAL=500;let l={};function c(e,t){pxt.editor.shouldPostHostMessages()&&pxt.editor.postHostMessageAsync({type:"pxthost",action:"simevent",subtype:e,exception:t})}i.setTranslations=function(e){i.simTranslations!==e&&(i.simTranslations=e,d())},i.init=function(e,t){var u,d;if(!e)return;pxsim.U.clear(e);const h=document.createElement("div");h.id="simulators",h.className="simulator",e.appendChild(h);const f=document.createElement("div");f.id="debugger",f.className="ui item landscape only",e.appendChild(f);const m=/nestededitorsim=1/i.test(window.location.href);let g=null;if(window.parent!==window){const e=new URLSearchParams(window.location.search).get("parentOrigin");if(e)try{g=new URL(e).origin}catch(t){console.error(`Invalid parent origin: ${e}`)}}let b={restart:()=>t.restartSimulator(),revealElement:e=>{if(pxt.options.light||i.driver.isLoanedSimulator(e))return;const t=pxt.appTarget.appTheme.simAnimationEnter||"fly right in";e.style.animationDuration="500ms";const n=`${t} visible transition animating`;pxsim.U.addClass(e,n),pxt.Util.delay(500).then((()=>{pxsim.U.removeClass(e,n),e.style.animationDuration="",pxt.BrowserUtils.isEdge()&&r.dialogIsShowing()&&(document.body.style.display="none",requestAnimationFrame((()=>{document.body.style.display="block"})))}))},removeElement:(e,t)=>{if(pxt.appTarget.simulator.headless)pxsim.U.addClass(e,"simHeadless"),t&&t();else{if(pxt.options.light)return t&&t(),void pxsim.U.remove(e);const i=pxt.appTarget.appTheme.simAnimationExit||"fly right out";e.style.animationDuration="500ms";const n=`${i} visible transition animating`;pxsim.U.addClass(e,n),pxt.Util.delay(500).then((()=>{pxsim.U.removeClass(e,"animating"),e.style.animationDuration="",t&&t(),pxsim.U.remove(e)}))}},unhideElement:e=>{pxsim.U.removeClass(e,"simHeadless")},onDebuggerBreakpoint:function(e){let t=!1;if(s){let i=0,n=e.breakpointId;for(;!t;){if(n){const i=a.breakpoints[n];t=s.highlightStatement(i,e)}if(!t){i++;const t=e.stackframes?e.stackframes[i]:void 0;if(!t)break;n=t.breakpointId}}}e.exceptionMessage||!s||t?(!t&&e.exceptionMessage&&(pxt.debug(`runtime error: ${e.exceptionMessage}`),pxt.debug(e.exceptionStack),s&&s.orphanException(e)),c("stopped",e.exceptionMessage)):i.driver.resume(pxsim.SimulatorDebuggerCommand.StepInto)},onTraceMessage:function(e){let t=a.breakpoints[e.breakpointId];s&&s.highlightStatement(t,e)},onDebuggerWarning:function(e){for(let t of e.breakpointIds){let e=a.breakpoints[t];if(e&&!o.startsWith("pxt_modules/",e.fileName)){s&&s.highlightStatement(e);break}}},onDebuggerResume:function(){c("resumed"),s&&s.highlightStatement(null)},onStateChanged:function(e){e===pxsim.SimulatorState.Stopped?c("stopped"):e===pxsim.SimulatorState.Running&&this.onDebuggerResume(),t.onStateChanged(e)},onSimulatorReady:function(){pxt.perf.recordMilestone("simulator ready"),pxt.perf.perfReportLogged||pxt.perf.report()},onSimulatorCommand:e=>{switch(e.command){case"setstate":t.setState(e.stateKey,e.stateValue);break;case"restart":t.restartSimulator();break;case"reload":p(!0),t.restartSimulator();break;case"modal":if(p(),!(pxt.shell.isSandboxMode()||e.displayOnceId&&l[e.displayOnceId])){const t={header:e.header,body:e.body,size:"large",copyable:e.copyable,disagreeLbl:lf("Close"),modalContext:e.modalContext},i=pxt.appTarget.simulator.trustedUrls,r=e.linkButtonHref&&i&&-1!==i.indexOf(e.linkButtonHref);r?t.agreeLbl=e.linkButtonLabel:t.hideAgree=!0,l[e.displayOnceId]=!0,n.confirmAsync(t).then((t=>{r&&1==t&&window.open(e.linkButtonHref,"_blank")}))}}},onTopLevelCodeEnd:()=>{c("toplevelfinished")},stoppedClass:pxt.appTarget.simulator&&pxt.appTarget.simulator.stoppedClass,invalidatedClass:pxt.appTarget.simulator&&pxt.appTarget.simulator.invalidatedClass,nestedEditorSim:m,parentOrigin:g,messageSimulators:null===(d=null===(u=pxt.appTarget)||void 0===u?void 0:u.simulator)||void 0===d?void 0:d.messageSimulators};i.driver=new pxsim.SimulatorDriver(document.getElementById("simulators"),b),s=t};let u=!1;function d(){i.driver&&i.driver.setDirty()}function p(e,t){i.driver&&(i.driver.stopSound(),i.driver.stop(e,t))}i.setState=function(e,t){s&&s.editor!=e&&(s.editor=e,s.highlightStatement(null)),u=t},i.setDirty=d,i.setPending=function(){i.driver&&i.driver.setPending()},i.run=function(e,t,n,r,o){const s=pxt.appTarget.simulator.boardDefinition,{js:l,fnArgs:u,parts:d,usedBuiltinParts:p}=pxtc.buildSimJsInfo(n);a=n;const{mute:h,highContrast:f,light:m,clickTrigger:g,storedState:b,autoRun:v}=r,y=pxt.BrowserUtils.isIpcRenderer()||void 0,k=e.dependencies(),w={boardDefinition:s,mute:h,parts:d,builtinParts:p,debug:t,trace:o,fnArgs:u,highContrast:f,light:m,aspectRatio:d.length?pxt.appTarget.simulator.partsAspectRatio:pxt.appTarget.simulator.aspectRatio,partDefinitions:e.computePartDefinitions(d),cdnUrl:pxt.webConfig.commitCdnUrl,localizedStrings:i.simTranslations,refCountingDebug:pxt.options.debug,version:e.version(),clickTrigger:g,breakOnStart:t,storedState:b,autoRun:v,ipc:y,dependencies:k};c("started"),i.driver.run(l,w)},i.mute=function(e){i.driver&&i.driver.mute(e)},i.stop=p,i.suspend=function(){i.driver&&i.driver.suspend()},i.hide=function(e){i.driver&&i.driver.hide(e)},i.unhide=function(){i.driver&&i.driver.unhide()},i.setTraceInterval=function(e){i.driver&&i.driver.setTraceInterval(e)},i.proxy=function(e){i.driver&&i.driver.postMessage(e)},i.dbgPauseResume=function(){i.driver.state==pxsim.SimulatorState.Paused?i.driver.resume(pxsim.SimulatorDebuggerCommand.Resume):i.driver.state==pxsim.SimulatorState.Running&&i.driver.resume(pxsim.SimulatorDebuggerCommand.Pause)},i.dbgStepOver=function(){i.driver.state==pxsim.SimulatorState.Paused&&i.driver.resume(pxsim.SimulatorDebuggerCommand.StepOver)},i.dbgStepInto=function(){i.driver.state==pxsim.SimulatorState.Paused&&i.driver.resume(pxsim.SimulatorDebuggerCommand.StepInto)},i.dbgStepOut=function(){i.driver.state==pxsim.SimulatorState.Paused&&i.driver.resume(pxsim.SimulatorDebuggerCommand.StepOut)}},{"./core":78,"./coretsx":79}],136:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.isSnippetInputAnswerTypeDropdown=i.isSnippetInputAnswerTypeYesNo=i.isSnippetInputAnswerTypeNumber=i.isSnippetInputAnswerTypeOther=i.isSnippetInputAnswerSingular=i.initializeSnippetExtensions=i.SnippetBuilder=void 0;const n=e("react"),r=e("./data"),o=e("./sui"),s=e("./marked"),a=e("./compiler"),l=e("react-dom"),c=e("./package"),u=e("./core"),d=e("./snippetBuilderInputHandler");class p extends r.Component{constructor(e){super(e),this.generateOutputMarkdown=pxt.Util.debounce((()=>{const{config:e,tsOutput:t}=this.state;let i=`\`\`\`${e.outputType}\n`;i+=this.replaceTokens(this.highlightEditedBlocks(t)),i+="\n```",this.setState({mdOutput:i})}),300,!1),this.onChange=e=>t=>{let i=this.getCurrentQuestion();this.setState((n=>{let r=Object.assign(Object.assign({},n.answers),{[e]:t});return{answers:r,tsOutput:this.updateOutput(i,r,n.tsOutput)}}),this.generateOutputMarkdown)},this.state={visible:!1,answers:{},history:[0],defaults:{},config:e.config,tsOutput:[e.config.initialOutput]},this.cleanup=this.cleanup.bind(this),this.hide=this.hide.bind(this),this.cancel=this.cancel.bind(this),this.confirm=this.confirm.bind(this),this.backPage=this.backPage.bind(this),this.nextPage=this.nextPage.bind(this),this.handleModalKeyDown=this.handleModalKeyDown.bind(this)}buildDefaults(){const{config:e}=this.state,t={};for(const i of e.questions){const{inputs:e}=i;for(const i of e)if(h(i)){const{defaultAnswer:e,answerToken:n}=i;t[n]=e}else{const{defaultAnswers:e,answerTokens:n}=i;for(let i=0;i<n.length;i++){const r=n[i],o=e[i];t[r]=o}}}this.setState({answers:t,defaults:t},this.generateOutputMarkdown)}toggleActionButton(){let e;e=this.isLastQuestion()?{label:lf("Done"),onclick:this.confirm,icon:"check",className:"approve positive"}:{label:lf("Next"),onclick:this.nextPage,icon:"arrow right",className:"arrow right"},this.state.actions[1]!==e&&this.setState({actions:[this.state.actions[0],e]})}initializeActionButtons(){const e=[{label:lf("Back"),onclick:this.backPage,icon:"arrow left",className:"arrow left",labelPosition:"left"},{label:lf("Next"),onclick:this.nextPage,icon:"arrow right",className:"arrow right"}];this.setState({actions:e})}componentDidMount(){this.buildDefaults()}replaceTokens(e){const{answers:t,defaults:i}=this.state;let n=e.join("\n");const r=Object.keys(i);for(let e of r){const r=t[e]||i[e];n=n.split(`$${e}`).join(r)}return n}highlightEditedBlocks(e){const t=this.getCurrentQuestion().inputs.reduce(((e,t)=>h(t)?pxt.Util.concat([e,[t.answerToken]]):pxt.Util.concat([e,t.answerTokens])),[]);return e.reduce(((e,i)=>{for(const n of t)if(-1!==i.indexOf(n))return pxt.Util.concat([e,["// @highlight",i]]);return pxt.Util.concat([e,[i]])}),[])}hide(){this.setState({visible:!1})}show(){pxt.tickEvent("snippet.builder.show",null,{interactiveConsent:!0}),this.initializeActionButtons(),this.setState({visible:!0})}cleanup(){this.setState({answers:{},history:[0],tsOutput:[this.props.config.initialOutput]}),Blockly.hideChaff()}cancel(){const{name:e}=this.state.config;pxt.tickEvent("snippet.builder.cancel",{snippet:e,page:this.getCurrentPage()},{interactiveConsent:!0}),this.hide(),this.cleanup()}injectBlocksToWorkspace(){const{tsOutput:e}=this.state,{mainWorkspace:t}=this.props,{outputBehavior:i}=this.state.config;a.getBlocksAsync().then((t=>a.decompileBlocksSnippetAsync(this.replaceTokens(e),t))).then((e=>{const n=Blockly.Xml.textToDom(e.outfiles[pxt.MAIN_BLOCKS]),r=pxt.blocks.findRootBlocks(n);let o=t.getTopBlocks(!0);"replace"===i&&(o.forEach((e=>{e.dispose(!1)})),o=[]);let s=r.map((e=>{let t=o.filter((t=>e.getAttribute("type")===t.type));return t.length?{newB:e,exB:t[0]}:{newB:e,exB:null}})),a=s.filter((e=>!!e.exB)),l=s.filter((e=>!e.exB));a.forEach((function(e){let{newB:i,exB:n}=e;const r=pxt.blocks.findRootBlock(i),o=Blockly.Xml.domToBlock(r,t);n.getInput("HANDLER").connection.connect(o.previousConnection)})),l.forEach((function(e){let{newB:i}=e;Blockly.Xml.domToBlock(i,t)})),o.length<=1&&pxt.blocks.layout.flow(t,{useViewWidth:!0})})).catch((e=>{throw u.errorNotification(e),new Error("Failed to decompile snippet output")}))}confirm(){const{name:e}=this.state.config;pxt.tickEvent("snippet.builder.back.page",{snippet:e,page:this.getCurrentPage()},{interactiveConsent:!0}),this.injectBlocksToWorkspace(),Blockly.hideChaff(),this.hide()}getCurrentPage(){const{history:e}=this.state;return e[e.length-1]}getCurrentQuestion(){const{config:e}=this.state;return e.questions[this.getCurrentPage()]}getNextQuestionNumber(){const{answers:e,defaults:t}=this.state,i=this.getCurrentQuestion();if(i.goto){const{parameters:n}=i.goto;if(n)for(const i of n){const{answer:n,token:r}=i;if(n&&r&&(n===e[r]||!e[r]&&n===t[r]))return i.question}return i.goto.question}return null}getNextQuestion(){const{config:e}=this.state,t=this.getNextQuestionNumber();return t?e.questions[t]:null}isLastQuestion(){return!this.getCurrentQuestion().goto}nextPage(){const{config:e,history:t}=this.state,i=this.getCurrentQuestion().goto;if(this.isLastQuestion())this.confirm();else if(i){const i=this.getNextQuestion();let n=this.updateOutput(i,this.state.answers,this.state.tsOutput);const r=this.getNextQuestionNumber();this.setState({history:[...t,r],tsOutput:n},this.toggleActionButton),pxt.tickEvent("snippet.builder.next.page",{snippet:e.name,page:r},{interactiveConsent:!0}),this.generateOutputMarkdown()}}backPage(){const{history:e,config:t}=this.state;e.length>1&&this.setState({history:e.slice(0,e.length-1)},(()=>{this.toggleActionButton(),pxt.tickEvent("snippet.builder.back.page",{snippet:t.name,page:this.getCurrentPage()},{interactiveConsent:!0}),this.generateOutputMarkdown()}))}handleModalKeyDown(e){13!==e.keyCode&&39!==e.keyCode||this.nextPage(),37===e.keyCode&&this.backPage()}updateOutput(e,t,i){let n=!1;if(e.outputConditionalOnAnswer){let i=e.outputConditionalOnAnswer;e.inputs.map((e=>h(e)?[e.answerToken]:e.answerTokens)).reduce(((e,t)=>[...e,...t]),[]).every((e=>t[e]!=i))&&(n=!0)}let r=!!e.output,o=r&&-1!==i.indexOf(e.output),s=i;return n||o||!r?n&&o&&(s=i.filter((t=>t!==e.output))):s=pxt.Util.concat([i,[e.output]]),s}renderCore(){const{visible:e,answers:t,config:i,mdOutput:r,actions:a,defaults:l}=this.state,{parent:c}=this.props,u=this.getCurrentQuestion();let p=0===this.getCurrentPage();return n.createElement(o.Modal,{isOpen:e,className:"snippet-builder full-screen-no-bg "+(p?"no-back-btn":""),overlayClassName:"snippet-builder-modal-overlay",closeOnEscape:!0,closeIcon:!0,closeOnDimmerClick:!1,closeOnDocumentClick:!1,dimmer:!0,buttons:a,header:i.name,onClose:this.cancel,onKeyDown:this.handleModalKeyDown},n.createElement("div",{className:"snippet-builder-inner"},u&&n.createElement("div",{className:"snippet-question"},n.createElement("div",{className:"ui segment raised"},n.createElement("h3",null,pxt.Util.rlf(u.title)),n.createElement("div",{className:"ui equal width grid"},u.inputs.map(((e,i)=>n.createElement("span",{className:"column",key:`span-${i}`},n.createElement(d.InputHandler,{onChange:h(e)?this.onChange(e.answerToken):this.onChange,input:e,value:h(e)?t[e.answerToken]:t[e.answerTokens[0]],onEnter:this.nextPage,key:h(e)?e.answerToken:e.answerTokens[0]}))))),u.errorMessage&&n.createElement("p",{className:"snippet-error"},u.errorMessage)),u.hint&&n.createElement("div",{className:"snippet hint ui segment"},pxt.Util.rlf(u.hint).split("\n").reduce(((e,t)=>[...e,e.length?n.createElement("br",null):"",t]),[]))),n.createElement("div",{className:"snippet output-section"},r&&n.createElement(s.MarkedContent,{className:"snippet-markdown-content",markdown:r,parent:c}))))}}function h(e){return void 0!==e.answerToken}i.SnippetBuilder=p,i.initializeSnippetExtensions=function(e,t,i,r){(function(){let e=pxt.Util.concat(c.allEditorPkgs().map((e=>e.sortedFiles()))),t=e.filter((e=>"pxtsnippets.json"===e.name)).map((e=>pxt.Util.jsonTryParse(e.content)));const i=e.filter((e=>e.name.endsWith(".snippetts")));return t=t.map((e=>e.map((e=>{if(e.initialOutput.startsWith("file:")){let t=e.initialOutput.slice("file:".length,e.initialOutput.length);if(1!=i.filter((e=>e.name===t)).length)return pxt.reportError("snippetbuilder",`invalid external .ts file path: ${t}`),null}return e})).filter((e=>!!e)))),pxt.Util.concat(t)})().filter((t=>t.namespace==e)).forEach((e=>{t.push({name:`SNIPPET${name}_BUTTON`,type:"button",attributes:{blockId:`SNIPPET${name}_BUTTON`,label:e.label?pxt.Util.rlf(e.label):pxt.Util.lf("Editor"),weight:101,group:e.group&&e.group},callback:()=>{!function(e,t,i){const r=document.createElement("div"),o=document.body.appendChild(r),s={parent:i,mainWorkspace:t,config:e};l.render(n.createElement(p,s),o).show()}(e,i,r)}})}))},i.isSnippetInputAnswerSingular=h,i.isSnippetInputAnswerTypeOther=function(e){return"number"!==e.type},i.isSnippetInputAnswerTypeNumber=function(e){return void 0!==e.max},i.isSnippetInputAnswerTypeYesNo=function(e){return"yesno"===e.type},i.isSnippetInputAnswerTypeDropdown=function(e){return void 0!==e.options}},{"./compiler":30,"./core":78,"./data":81,"./marked":111,"./package":122,"./snippetBuilderInputHandler":137,"./sui":143,react:335,"react-dom":291}],137:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.InputHandler=void 0;const n=e("react"),r=e("./data"),o=e("./components/ImageEditor/ImageEditor"),s=e("./sui"),a=e("./snippetBuilderPositionPicker"),l=e("./snippetBuilder");class c extends r.Component{constructor(e){super(e),this.textOnChange=e=>this.props.onChange(e),this.variableNameOnChange=e=>this.props.onChange(ts.pxtc.escapeIdentifier(e)),this.state={isFocused:!1}}renderInput(){const{value:e,input:t,onChange:i}=this.props;switch(t.type){case"dropdown":return n.createElement(u,{input:t,value:e,onChange:i});case"yesno":return n.createElement(p,{input:t,onChange:i});case"spriteEditor":if(l.isSnippetInputAnswerTypeOther(t)){const t=pxt.sprite.imageLiteralToBitmap(e);return n.createElement(o.ImageEditor,{singleFrame:!0,asset:{internalID:0,type:"image",id:"",jresData:"",meta:{},bitmap:t.data()},onChange:i})}case"number":return n.createElement(d,{input:t,value:e,onChange:i,autoFocus:!0});case"positionPicker":if(!l.isSnippetInputAnswerSingular(t))return n.createElement(a.PositionPicker,{defaultX:parseInt(t.defaultAnswers[0]),defaultY:parseInt(t.defaultAnswers[1]),input:t,onChange:i});case"text":case"variableName":default:if(l.isSnippetInputAnswerTypeOther(t))return n.createElement(s.Input,{label:t.label&&t.label,value:e||"",onChange:"variableName"==t.type?this.variableNameOnChange:this.textOnChange,autoFocus:!0,selectOnMount:!0})}return null}renderCore(){return this.renderInput()}}i.InputHandler=c;class u extends r.Component{constructor(e){super(e),this.onChange=e=>()=>{const{onChange:t}=this.props;t(e)},this.onChange=this.onChange.bind(this)}renderCore(){const{value:e,input:t}=this.props;return l.isSnippetInputAnswerTypeDropdown(t)?n.createElement(s.DropdownMenu,{className:"inline button",role:"menuitem",text:e.length?pxt.Util.rlf(t.options[e]):pxt.Util.rlf(t.options[Object.keys(t.options)[0]]),icon:"dropdown"},Object.keys(t.options).map((e=>n.createElement(s.Item,{role:"menuitem",value:e,key:t.options[e],text:pxt.Util.rlf(t.options[e]),onClick:this.onChange(e)})))):null}}class d extends r.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e){const{onChange:t}=this.props;t(e.target.value)}renderCore(){const{input:e,value:t,autoFocus:i}=this.props;return l.isSnippetInputAnswerTypeNumber(e)?n.createElement("div",{className:"slider-outer"},n.createElement("span",null,e.label&&e.label),n.createElement("div",null,n.createElement("input",{type:"range",autoFocus:i,className:"slider blocklyMockSlider",role:"slider",max:e.max,min:e.min,value:t,onChange:this.onChange,"aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":+t,style:{marginLeft:0}}),n.createElement(s.Input,{value:t,onChange:this.props.onChange,class:"snippet slider-input"}))):null}}class p extends r.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e){const{onChange:t}=this.props;return()=>t(e)}renderCore(){const{input:e}=this.props;return l.isSnippetInputAnswerTypeYesNo(e)?n.createElement("div",null,n.createElement(s.Button,{text:"Yes",title:"Yes",onClick:this.onChange("true")}),n.createElement(s.Button,{text:"No",title:"No",onClick:this.onChange("false")})):null}}},{"./components/ImageEditor/ImageEditor":38,"./data":81,"./snippetBuilder":136,"./snippetBuilderPositionPicker":138,"./sui":143,react:335}],138:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PositionPicker=void 0;const n=e("react"),r=e("./data"),o=e("./snippetBuilder"),s=e("./sui"),a=e("./snippetBuilderSimulatorDisplay");class l extends r.Component{constructor(e){super(e),this.onChange=e=>t=>{const{input:i,onChange:n}=this.props;if(!o.isSnippetInputAnswerSingular(i)){const r=this.state;let o=parseInt(t);if(isNaN(o)||o<0)return;this.setState({x:e?this.unScalePointX(o):r.x,y:e?r.y:this.unScalePointY(o)},(()=>{const t=this.getScaledPoints();e&&n(i.answerTokens[0])(t.x.toString()),e||n(i.answerTokens[1])(t.y.toString()),this.setState({dotVisible:!0})}))}},this.state={x:this.unScalePointX(this.props.defaultX||80),y:this.unScalePointY(this.props.defaultY||60),dotVisible:!1},this.setDot=this.setDot.bind(this),this.onChange=this.onChange.bind(this),this.setScale=this.setScale.bind(this)}componentWillUnmount(){window.removeEventListener("resize",this.setScale)}componentDidMount(){this.setScale(),window.addEventListener("resize",this.setScale)}setScale(){const e=window.innerHeight,t=window.innerWidth;let i=e>t?t/2100:e/1003;i<.71?i=.71:i>1.01&&(i=1.01),this.setState({scale:i})}getScale(e,t){const{scale:i}=this.state;return t*i/e}getXScale(){return this.getScale(160,309)}getYScale(){return this.getScale(120,227)}scalePoint(e,t){return isNaN(e)?0:Math.round(e/t)}scalePointX(e){return this.scalePoint(e,this.getXScale())}scalePointY(e){return this.scalePoint(e,this.getYScale())}unScalePoint(e,t){return isNaN(e)?0:Math.round(e*t)}unScalePointX(e){return this.unScalePoint(e,this.getXScale())}unScalePointY(e){return this.unScalePoint(e,this.getYScale())}getScaledPoints(){const{x:e,y:t}=this.state;return{x:this.scalePointX(e),y:this.scalePointY(t)}}scalePixel(e){const{scale:t}=this.state;return e*t+"px"}setDot(e){const{input:t,onChange:i}=this.props,n=e.nativeEvent.offsetX,r=e.nativeEvent.offsetY;this.setState({dotVisible:!0,x:Math.round(n),y:Math.round(r)},(()=>{if(!o.isSnippetInputAnswerSingular(t)){const e=this.getScaledPoints();i(t.answerTokens[0])(e.x.toString()),i(t.answerTokens[1])(e.y.toString())}}))}renderCore(){const{dotVisible:e,x:t,y:i,scale:r}=this.state,o=this.getScaledPoints();return n.createElement("div",null,n.createElement("div",{className:"ui grid"},n.createElement("div",{className:"column"},n.createElement(s.Input,{class:"position-picker preview-input",value:o.x.toString(),onChange:this.onChange(!0)})),n.createElement("div",{className:"column"},n.createElement(s.Input,{class:"position-picker preview-input",value:o.y.toString(),onChange:this.onChange(!1)}))),n.createElement(a.SimulatorDisplay,{scale:r},n.createElement("div",{ref:"positionPickerContainer",className:"position-picker container",onClick:this.setDot,style:{left:this.scalePixel(28),top:this.scalePixel(28),width:this.scalePixel(309),height:this.scalePixel(227),margin:"8px",maxWidth:this.scalePixel(309),maxHeight:this.scalePixel(227)},role:"grid"},e&&n.createElement("div",{className:"position-picker dot",style:{top:`${i}px`,left:`${t}px`}}))))}}i.PositionPicker=l},{"./data":81,"./snippetBuilder":136,"./snippetBuilderSimulatorDisplay":139,"./sui":143,react:335}],139:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SimulatorDisplay=void 0;const n=e("react"),r=e("./data");class o extends r.Component{scalePixel(e,t){const{scale:i}=this.props;return`${e*i}${!t&&"px"}`}renderCore(){const{children:e,scale:t}=this.props,i=n.createElement("svg",{height:"127.2",width:"127.2",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:"0px",top:this.scalePixel(297.85)},visibility:"visible"},n.createElement("g",{transform:"translate(18.80933368822642 18.80933368822642) scale(3.7618667376452843)"},n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 23.813 24.362",width:"23.813",height:"24.362"},n.createElement("path",{fill:"#f290c1",d:"M11.906 0c-2.431 0-3.304.092-3.59.378-.29.29-.378 1.21-.378 3.969v3.591h-3.59c-2.76 0-3.68.087-3.97.378C.092 8.602 0 9.474 0 11.9c0 3.051.032 3.237.65 3.855.62.62.797.65 3.968.65h3.32v3.583c0 2.49.1 3.697.33 3.958.48.544 6.688.56 7.23.018.29-.29.377-1.21.377-3.968v-3.591h3.32c3.171 0 3.348-.03 3.969-.65.618-.618.649-.804.649-3.855 0-2.426-.092-3.298-.378-3.584-.288-.288-1.174-.378-3.704-.378h-3.327V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416 0-.98-.65-1.172-3.969-1.172z"}),n.createElement("path",{fill:"#f291bd",d:"M11.906 0c-2.431 0-3.304.092-3.59.378-.29.29-.378 1.21-.378 3.969v3.591h-3.59c-2.76 0-3.68.087-3.97.378C.092 8.602 0 9.474 0 11.9c0 3.051.032 3.237.65 3.855.62.62.797.65 3.968.65h3.32v3.583c0 2.49.1 3.697.33 3.958.48.544 6.688.56 7.23.018.29-.29.377-1.21.377-3.968v-3.591h3.241c3.027-.001 3.29-.042 3.97-.627.719-.619.727-.66.727-3.855 0-2.446-.092-3.321-.378-3.607-.288-.288-1.174-.378-3.704-.378h-3.327V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416 0-.98-.65-1.172-3.969-1.172zm1.799.534c.188-.002.635.288.992.645.626.626.649.781.649 4.234 0 2.368-.096 3.583-.283 3.583-.19 0-.263-1.135-.222-3.438.058-3.3.035-3.46-.552-3.969-.336-.292-.504-.532-.372-.534.131-.002.06-.12-.159-.26-.283-.184-.298-.258-.053-.261zm-4.488.525c.12 0 .22.178.22.397 0 .45-.019.466-.264.22-.247-.246-.22-.617.044-.617zm-.561 6.398c.044-.018.099.08.19.283.114.254.138.641.054.86-.169.44-.962.549-.962.132 0-.146.11-.265.246-.265s.293-.268.35-.595c.046-.261.078-.396.122-.415zM22.4 8.997c.24 0 .883.755.883 1.039 0 .387-.45.357-.704-.048-.25-.399-.356-.992-.18-.992zM.936 9.63c.027-.006.051 0 .071.02.082.081 0 .295-.18.474-.261.26-.292.23-.148-.148.074-.196.176-.327.257-.346zm21.876 2.83c.038-.01.107.097.234.315.151.26.234.595.185.745-.142.424-.477-.054-.468-.666.003-.254.01-.383.049-.394zm-22.071.88a.16.16 0 0 1 .053.02c.145.09.264.336.264.546 0 .21-.119.381-.264.381-.146 0-.265-.245-.265-.545 0-.262.091-.426.212-.403zm3.214 1.5c1.97-.026 4.558.11 4.762.355.137.166.27 1.781.296 3.59.03 2.222-.05 3.319-.25 3.385-.208.07-.296-.931-.296-3.363v-3.462H5.012c-2.294 0-3.4-.09-3.288-.271.089-.144 1.049-.218 2.231-.234zm5.258 7.66c.128.001.393.127.725.378.387.292.416.387.116.386-.218 0-.55-.176-.738-.388-.22-.25-.23-.375-.103-.375z"}),n.createElement("path",{fill:"#a3809c",d:"M12.012 0C7.81 0 7.938-.139 7.938 4.407v3.531H4.453c-4.58 0-4.453-.113-4.452 3.943 0 2.844.045 3.122.625 3.796.622.723.65.728 3.97.728h3.342v3.609c0 3.126.062 3.655.463 3.96.318.241 1.374.354 3.38.36 4.184.012 4.094.108 4.094-4.372v-3.557h3.271c3.182 0 3.29-.02 3.969-.698.675-.675.697-.798.69-3.77-.006-2.135-.116-3.214-.36-3.536-.302-.398-.821-.463-3.696-.463h-3.345V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416C15.875.199 15.22 0 12.012 0zm-.106.53c1.92 0 2.208.067 2.79.65.621.62.65.797.65 3.968v3.32h3.32c3.171 0 3.348.028 3.968.649.575.574.65.879.65 2.646 0 1.154-.112 1.996-.265 1.996-.15 0-.265-.75-.265-1.718 0-1.386-.111-1.846-.576-2.381-.56-.644-.678-.664-3.97-.664h-3.391V5.677c0-3.171-.029-3.348-.65-3.969-.547-.547-.902-.65-2.26-.65-1.359 0-1.714.103-2.261.65-.62.62-.65.798-.65 3.97v3.318h-3.32c-3.17 0-3.347.03-3.968.65-.568.568-.65.886-.65 2.532 0 1.28.122 2.005.379 2.261.29.29 1.21.378 3.969.378h3.59v3.394c0 3.205.034 3.425.612 3.968.45.422.944.576 1.852.576.682 0 1.24.119 1.24.264 0 .148-.673.258-1.521.249-1.253-.014-1.627-.129-2.117-.652-.552-.59-.595-.878-.595-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.579-.578-.65-.874-.65-2.711.001-1.787.084-2.16.627-2.79.62-.723.65-.728 3.968-.728h3.343V5.148c0-3.171.029-3.348.65-3.969.582-.582.87-.65 2.79-.65zM9.782 11.668c.154.024.358.267.56.723.182.412.668.898 1.08 1.08.412.183.749.441.749.575 0 .133-.281.242-.625.242-.807 0-2.02-1.214-2.02-2.02 0-.426.102-.623.256-.6z"}),n.createElement("path",{fill:"#a8769a",d:"M12.06 0C7.84 0 7.939-.105 7.939 4.425v3.513H4.5c-4.598 0-4.5-.086-4.5 3.991 0 2.976.023 3.104.697 3.778.678.678.787.698 3.969.698h3.27v3.485c0 2.87.078 3.57.439 3.968.374.413.865.484 3.356.484 2.633 0 2.978-.057 3.53-.576.58-.543.613-.763.613-3.968v-3.394l3.241-.008c4.438-.011 4.697-.266 4.697-4.618 0-3.822-.02-3.84-4.234-3.84h-3.175V4.763c0-1.94-.103-3.175-.264-3.175-.146 0-.265-.187-.265-.416 0-.97-.657-1.172-3.814-1.172zm-.154.53c1.92 0 2.208.067 2.79.65.621.62.65.797.65 3.968v3.32h3.32c3.171 0 3.348.028 3.968.649.575.574.65.879.65 2.646 0 1.737-.062 1.996-.471 1.996-.26 0-.643.238-.852.529-.348.482-.685.53-3.763.53h-3.381l-.034 1.653c-.018.91-.04 2.424-.047 3.366-.011 1.42-.117 1.817-.616 2.316-.33.33-.786.602-1.01.602-.225 0-.41.119-.41.264 0 .148-.673.258-1.521.249-1.253-.014-1.627-.129-2.117-.652-.552-.59-.595-.878-.595-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.583-.582-.65-.87-.65-2.79s.067-2.207.65-2.79c.62-.62.797-.649 3.969-.649h3.319V5.148c0-3.171.029-3.348.65-3.969.582-.582.87-.65 2.79-.65zm0 2.116c-.617 0-.793.117-.793.529 0 .291-.12.53-.265.53-.145 0-.265.237-.265.528 0 .291-.119.53-.264.53-.146 0-.265.238-.265.529 0 .29-.119.529-.264.529-.146 0-.28.208-.3.463-.019.254-.127.046-.24-.463l-.206-.926.042.926.042.926 2.646.147c1.455.081 2.735.17 2.844.199.251.064.26-1.072.013-1.714-.167-.433-.202-.419-.331.13-.128.541-.232.448-.877-.794-.402-.774-.73-1.557-.727-1.738.002-.192-.329-.331-.79-.331zm9.525 6.35c-.013.013.067.12.231.33.346.441.563.582.563.364 0-.055-.208-.264-.463-.463-.21-.165-.317-.245-.33-.231zm-14.874.021c-.772-.016-.951.065-.831.377.111.29-.285.596-1.455 1.125-1.343.607-1.608.834-1.609 1.387-.001.56.264.78 1.722 1.432 1.728.772 1.875 1.067.643 1.288-.364.065.35.115 1.588.11 1.237-.005 1.802-.055 1.257-.112l-.993-.104v-2.608c0-1.838.098-2.647.331-2.741.182-.073-.112-.143-.653-.154zm5.365.464c-.676.022-1.35.282-1.77.772-.651.756-.817 1.389-.364 1.389.144 0 .41-.238.592-.53.426-.68 1.271-.673 2.152.02.85.668.931 1.812.168 2.362-.29.21-.529.474-.529.587 0 .383.718.21 1.42-.342.93-.732.996-2.67.121-3.602-.434-.462-1.113-.678-1.79-.656zm5.23.044c-.229 0-.313 4.58-.089 4.804.071.071 1.017-.296 2.1-.816 1.73-.83 1.973-1.034 1.987-1.673.01-.4-.1-.728-.244-.728-.143 0-.997-.357-1.898-.793-.901-.437-1.737-.794-1.856-.794zm-15.98 3.386c-.034.018-.058.178-.062.45-.005.437.05.648.122.469.073-.18.077-.537.01-.794-.025-.097-.05-.136-.07-.125zm1.704 1.673a2.998 2.998 0 0 0-.558.046c-.329.063-.122.117.46.12.582.003.852-.049.599-.115a2.182 2.182 0 0 0-.501-.05zm10.134 2.282c-.297.002-.625.008-.97.02-1.538.051-2.515.193-2.515.364 0 .154.387 1.092.86 2.084.721 1.513.967 1.804 1.521 1.81.568.004.793-.279 1.588-2.005.51-1.105.956-2.083.993-2.174.028-.067-.585-.104-1.477-.099zm-3.946 4.427a.043.043 0 0 0-.03.012c-.062.063.037.296.221.517.472.57.6.501.216-.114-.155-.249-.325-.419-.407-.415z"}),n.createElement("path",{fill:"#2f99a1",d:"M12.093.009C9.408 0 9.198.039 8.587.65c-.62.62-.65.797-.65 3.969v3.319H4.619c-3.171 0-3.348.029-3.968.65-.608.607-.65.83-.65 3.44 0 1.683.105 2.79.265 2.79.145 0 .264.237.264.528 0 .353.177.53.53.53.29 0 .529.119.529.264 0 .162 1.234.265 3.175.265h3.175v3.316c0 3.075.043 3.364.595 3.953.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.62-.62.65-.798.65-3.97v-3.318h3.174c1.94 0 3.175-.103 3.175-.265 0-.145.19-.265.422-.265.232 0 .484-.238.56-.529.076-.29.244-.529.372-.529.129 0 .234-1.255.234-2.79 0-2.61-.042-2.832-.65-3.44-.62-.62-.796-.649-3.98-.649H15.85l.053-3.579c.067-4.471.184-4.338-3.811-4.35zm-.114.52c2.033 0 2.26.055 2.79.664.527.606.577.952.577 3.969v3.305h3.32c3.171 0 3.348.03 3.968.65.575.574.65.879.65 2.646 0 1.737-.062 1.996-.471 1.996-.26 0-.643.238-.852.529-.348.482-.685.53-3.763.53h-3.381v3.318c0 3.172-.029 3.349-.65 3.97-.356.356-.833.649-1.058.649-.224 0-.409.119-.409.264 0 .148-.673.258-1.521.249-1.253-.014-1.627-.129-2.117-.652-.552-.59-.595-.878-.595-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.583-.582-.65-.87-.65-2.79s.067-2.207.65-2.79c.62-.62.797-.649 3.969-.649h3.319V5.148c0-3.171.029-3.348.65-3.969.585-.586.865-.65 2.862-.65zm-.044 2.117c-.286 0-.788.7-1.425 1.989-.542 1.094-.985 2.046-.985 2.116 0 .07 1.072.129 2.381.129 1.31 0 2.382-.048 2.382-.105 0-.058-.43-1.01-.956-2.117-.627-1.321-1.107-2.012-1.397-2.012zm-5.138 6.88c-.046 0-.727.31-1.513.69-.787.379-1.702.793-2.034.92-1.142.433-.72 1.126 1.314 2.153 1.055.532 2.008.974 2.117.983.109.01.198-1.056.198-2.365 0-1.31-.037-2.382-.082-2.382zm5.103 0c-1.12 0-1.536.25-2.068 1.244-.376.702-.384.872-.042.872.145 0 .264-.14.264-.31 0-.17.193-.523.429-.783.41-.454.468-.453 1.415.03.567.29 1.165.874 1.408 1.375.386.797.386.91 0 1.338-.233.256-.583.467-.779.467-.196 0-.356.119-.356.264 0 .346.15.334.858-.066.932-.525 1.241-1.052 1.25-2.128.012-1.409-.912-2.304-2.38-2.304zm5.162 0c-.07 0-.129 1.071-.129 2.38 0 1.31.058 2.382.129 2.382.07 0 1.023-.443 2.116-.984 1.206-.597 1.989-1.147 1.989-1.397s-.783-.8-1.989-1.398c-1.093-.54-2.046-.984-2.116-.984zm-5.156 7.408c-1.31 0-2.38.058-2.38.128s.444 1.026.987 2.124c.657 1.328 1.122 1.971 1.39 1.922.346-.064 2.353-3.421 2.376-3.976.005-.109-1.063-.198-2.373-.198z"}),n.createElement("path",{fill:"#96266c",d:"M12.093.009C9.408 0 9.198.039 8.587.65c-.62.62-.65.797-.65 3.969v3.319H4.619c-3.171 0-3.348.029-3.968.65-.608.607-.65.83-.65 3.44 0 1.683.105 2.79.265 2.79.145 0 .264.237.264.528 0 .353.177.53.53.53.29 0 .529.119.529.264 0 .162 1.234.265 3.175.265h3.175v3.316c0 3.075.043 3.364.595 3.953.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.62-.62.65-.798.65-3.97v-3.318h3.174c1.94 0 3.175-.103 3.175-.265 0-.145.19-.265.422-.265.232 0 .484-.238.56-.529.076-.29.244-.529.372-.529.129 0 .234-1.255.234-2.79 0-2.61-.042-2.832-.65-3.44-.62-.62-.796-.649-3.98-.649H15.85l.053-3.579c.067-4.471.184-4.338-3.811-4.35zm-.114.52c2.033 0 2.26.055 2.79.664.527.606.577.952.577 3.969v3.305h3.32c3.171 0 3.348.03 3.968.65.583.582.65.87.65 2.79s-.067 2.207-.65 2.79c-.62.62-.797.65-3.968.65h-3.32v3.318c0 3.172-.029 3.349-.65 3.97-.588.588-.854.647-2.843.633-1.965-.015-2.258-.083-2.79-.652-.553-.59-.596-.878-.596-3.953v-3.317h-3.32c-3.17 0-3.348-.029-3.968-.65-.583-.582-.65-.87-.65-2.79s.067-2.207.65-2.79c.62-.62.797-.649 3.969-.649h3.319V5.148c0-3.171.029-3.348.65-3.969.585-.586.865-.65 2.862-.65zm-.044 2.117c-.286 0-.788.7-1.425 1.989-.542 1.094-.985 2.046-.985 2.116 0 .07 1.072.129 2.381.129 1.31 0 2.382-.048 2.382-.105 0-.058-.43-1.01-.956-2.117-.627-1.321-1.107-2.012-1.397-2.012zm-5.138 6.88c-.046 0-.727.31-1.513.69-.787.379-1.702.793-2.034.92-1.142.433-.72 1.126 1.314 2.153 1.055.532 2.008.974 2.117.983.109.01.198-1.056.198-2.365 0-1.31-.037-2.382-.082-2.382zm5.103 0c-1.12 0-1.536.25-2.068 1.244-.376.702-.384.872-.042.872.145 0 .264-.14.264-.31 0-.17.193-.523.429-.783.41-.454.468-.453 1.415.03.567.29 1.165.874 1.408 1.375.386.797.386.91 0 1.338-.233.256-.583.467-.779.467-.196 0-.356.119-.356.264 0 .346.15.334.858-.066.932-.525 1.241-1.052 1.25-2.128.012-1.409-.912-2.304-2.38-2.304zm5.162 0c-.07 0-.129 1.071-.129 2.38 0 1.31.058 2.382.129 2.382.07 0 1.023-.443 2.116-.984 1.206-.597 1.989-1.147 1.989-1.397s-.783-.8-1.989-1.398c-1.093-.54-2.046-.984-2.116-.984zm-5.156 7.408c-1.31 0-2.38.058-2.38.128s.444 1.026.987 2.124c.657 1.328 1.122 1.971 1.39 1.922.346-.064 2.353-3.421 2.376-3.976.005-.109-1.063-.198-2.373-.198z"}),n.createElement("path",{fill:"#5b3b6a",d:"M12.093.009C9.408 0 9.198.039 8.587.65c-.62.62-.65.797-.65 3.969v3.319H4.619c-3.171 0-3.348.029-3.968.65-.608.607-.65.83-.65 3.44 0 1.683.105 2.79.265 2.79.145 0 .264.237.264.528 0 .353.177.53.53.53.29 0 .529.119.529.264 0 .162 1.234.265 3.175.265h3.175v3.316c0 3.075.043 3.364.595 3.953.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.62-.62.65-.798.65-3.97v-3.318h3.174c1.94 0 3.175-.103 3.175-.265 0-.145.19-.265.422-.265.232 0 .484-.238.56-.529.076-.29.244-.529.372-.529.129 0 .234-1.255.234-2.79 0-2.61-.042-2.832-.65-3.44-.62-.62-.797-.649-3.968-.649h-3.32v-3.61c0-3.126-.062-3.655-.463-3.96-.317-.24-1.364-.353-3.319-.36zm-.112.52c1.973 0 2.277.067 2.79.613.528.562.575.887.575 3.969v3.356h3.394c3.205 0 3.425.034 3.968.612.495.527.575.919.575 2.79 0 1.96-.064 2.243-.649 2.828-.62.62-.797.65-3.968.65h-3.32v3.318c0 3.172-.029 3.349-.65 3.97-.585.585-.865.649-2.863.649-1.974 0-2.278-.067-2.79-.613-.529-.562-.576-.886-.576-3.968v-3.357H5.074c-3.205 0-3.426-.034-3.969-.612-.498-.53-.576-.917-.576-2.863 0-2.072.053-2.296.664-2.827.605-.527.951-.577 3.969-.577h3.305V5.148c0-3.171.029-3.348.65-3.969.585-.586.865-.65 2.864-.65zm-.046 2.117c-.286 0-.788.7-1.425 1.989-.542 1.094-.985 2.046-.985 2.116 0 .07 1.072.129 2.381.129 1.31 0 2.382-.048 2.382-.105 0-.058-.43-1.01-.956-2.117-.627-1.321-1.107-2.012-1.397-2.012zm-5.138 6.88c-.046 0-.727.31-1.513.69-.787.379-1.702.793-2.034.92-1.142.433-.72 1.126 1.314 2.153 1.055.532 2.008.974 2.117.983.109.009.198-1.056.198-2.365 0-1.31-.037-2.382-.082-2.382zm5.103 0c-1.12 0-1.536.25-2.068 1.244-.376.702-.384.872-.042.872.145 0 .264-.14.264-.31 0-.17.193-.523.429-.783.41-.454.468-.453 1.415.03.567.29 1.165.874 1.408 1.375.386.797.386.91 0 1.338-.233.256-.583.467-.779.467-.196 0-.356.119-.356.264 0 .346.15.334.858-.066.932-.525 1.241-1.052 1.25-2.128.012-1.409-.912-2.304-2.38-2.304zm5.162 0c-.07 0-.129 1.071-.129 2.38 0 1.31.058 2.382.129 2.382.07 0 1.023-.443 2.116-.984 1.206-.597 1.989-1.147 1.989-1.397s-.783-.8-1.989-1.398c-1.093-.54-2.046-.984-2.116-.984zm-5.156 7.408c-1.31 0-2.38.057-2.38.127s.444 1.027.987 2.125c.657 1.328 1.122 1.971 1.39 1.922.346-.064 2.353-3.421 2.376-3.976.005-.109-1.063-.198-2.373-.198z"}),n.createElement("path",{d:"M9.763 0c-.295.002-.765.24-1.176.65-.357.357-.65.714-.65.794 0 .323.437.111.794-.385.21-.291.594-.53.853-.53.258 0 .47-.118.47-.264 0-.182-.114-.265-.29-.265zm4.286 0c-.177 0-.29.083-.29.265 0 .146.187.265.415.265 1.002 0 1.172.63 1.172 4.346 0 2.218.101 3.591.265 3.591.163 0 .264-1.37.264-3.584 0-3.452-.023-3.607-.649-4.233-.41-.41-.882-.648-1.177-.65zM4.883 7.938c-3.452 0-3.608.024-4.233.65C.293 8.945 0 9.42 0 9.646c0 .225.12.409.265.409.145 0 .264-.188.264-.416 0-1.002.632-1.172 4.347-1.172 2.218 0 3.59-.101 3.59-.264 0-.164-1.37-.265-3.583-.265zm18.04.612a.168.168 0 0 0-.115.054c-.102.11-.037.253.145.318s.33.347.33.626.12.507.265.507c.146 0 .265-.188.265-.416 0-.459-.579-1.112-.89-1.089zM.265 13.76c-.485 0-.273.81.385 1.467.62.62.797.65 3.968.65h3.32v3.58c0 3.35.038 3.623.595 4.218.552.59.796.637 3.32.652 2.55.015 2.765-.025 3.373-.633.626-.626.65-.781.65-4.234v-3.584h3.391c3.291 0 3.41-.02 3.969-.663.603-.693.766-1.453.312-1.453-.145 0-.265.187-.265.416 0 1.001-.63 1.171-4.346 1.171h-3.591v3.591c0 3.716-.17 4.347-1.172 4.347-.228 0-.416.119-.416.264 0 .152-.793.265-1.852.265-1.058 0-1.852-.113-1.852-.265 0-.145-.186-.264-.415-.264-1.002 0-1.172-.631-1.172-4.347v-3.59h-3.59c-3.716 0-4.348-.17-4.348-1.172 0-.229-.119-.416-.264-.416z"})),n.createElement("rect",{className:"controller-button-overlay",x:"7.937666666666666",y:"0",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}),n.createElement("rect",{className:"controller-button-overlay",x:"15.875333333333332",y:"7.937666666666666",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}),n.createElement("rect",{className:"controller-button-overlay",x:"7.937666666666666",y:"15.875333333333332",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}),n.createElement("rect",{className:"controller-button-overlay",x:"0",y:"7.937666666666666",rx:"1",ry:"1",fill:"black",fillOpacity:"0",width:"7.937666666666666px",height:"7.937666666666666px"}))),r=n.createElement("svg",{height:"127.2",width:"127.2",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:this.scalePixel(240.8),top:this.scalePixel(297.85)},visibility:"visible"},n.createElement("g",{transform:"translate(17.15858198888469 17.15858198888469) scale(3.4317163977769383)"},n.createElement("g",{transform:"translate(13.533000000000001 2.2554999999999996)"},n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 13.533 13.246",width:"13.533",height:"13.246"},n.createElement("path",{fill:"#ff8135",stroke:"#5c406c",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:".861",d:"M13.099 6.602c.1 2.457-1.61 4.712-3.813 5.662a6.152 6.152 0 0 1-4.661.175C1.38 11.444-.431 7.43.85 4.317c.68-1.583 1.982-2.925 3.63-3.485 2.494-.914 5.612-.248 7.246 1.923a6.112 6.112 0 0 1 1.372 3.847z"}),n.createElement("path",{fill:"#e5cdc4",fillRule:"evenodd",stroke:"#e5cdc4",strokeWidth:".265",d:"M2.454 2.619C.284 4.916 1.146 7.611 1.146 7.611c.792-4.598 3.68-6.217 8.39-6.006 0 0-4.269-1.965-7.082 1.014z"}),n.createElement("path",{fill:"#af4282",d:"M8.745 9.825h1.423l-1.72-6.914H7.027L2.542 9.825h1.412c.444-.507.61-1.53 1.45-1.304H8.42l.326 1.304zm-.602-2.519H5.574c.621-.807 1.397-2.523 1.92-2.76l.649 2.76z",fontFamily:"Nexa Bold",fontSize:"15.875",fontWeight:"400",letterSpacing:"0",style:{lineHeight:"125%"},wordSpacing:"0"})),n.createElement("circle",{className:"controller-button-overlay",cx:"6.766500000000001",cy:"6.766500000000001",r:"6.766500000000001",fill:"black",fillOpacity:"0"})),n.createElement("g",{transform:"translate(0 13.533000000000001)"},n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 13.533 13.246",width:"13.533",height:"13.246"},n.createElement("path",{fill:"#ff91c4",stroke:"#5c406c",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:".861",d:"M13.099 6.602c.1 2.457-1.61 4.712-3.813 5.662a6.152 6.152 0 0 1-4.661.175C1.38 11.444-.431 7.43.85 4.317c.68-1.583 1.982-2.925 3.63-3.485 2.494-.914 5.612-.248 7.246 1.923a6.112 6.112 0 0 1 1.372 3.847z"}),n.createElement("path",{fill:"#e5cdc4",fillRule:"evenodd",stroke:"#e5cdc4",strokeWidth:".265",d:"M2.454 2.619C.284 4.916 1.051 7.563 1.051 7.563c.793-4.597 3.823-6.169 8.533-5.958 0 0-4.317-1.965-7.13 1.014z"}),n.createElement("path",{fill:"#af4282",d:"M5.337 7.226c.909.088 1.876-.201 2.736.21.288.113.37.493.32.773-.143.515-.716.742-1.197.817-.607-.047-1.91.169-2.181-.227-.058-.371.217-.697.222-1.073l.1-.5zM5.88 4.49c.81.122 1.664-.209 2.444.123.263.119.537.35.451.67-.591 1.227-2.213.797-3.21.797l.315-1.59zm2.233-1.186h-3.28L3.45 10.22c1.523-.054 3.064.132 4.572-.152 1.117-.305 1.976-1.536 1.666-2.692-.146-.282-.515-.448-.562-.79.088-.354.606-.278.717-.652.452-.693.41-1.769-.288-2.287-.42-.274-.95-.333-1.442-.342z",fontFamily:"Nexa Bold",fontSize:"15.875",fontWeight:"400",letterSpacing:"0",style:{lineHeight:"125%"},wordSpacing:"0"})),n.createElement("circle",{className:"controller-button-overlay",cx:"6.766500000000001",cy:"6.766500000000001",r:"6.766500000000001",fill:"black",fillOpacity:"0"})))),o=n.createElement("svg",{visibility:"visible",width:"70px",height:"26.25px",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:this.scalePixel(105.25),top:this.scalePixel(284)}},n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16.937 6.35"},n.createElement("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .806-.072.806.073 0 .17 1.912.36 5.969.36s6.334 0 6.334-.169c0-.145.184-.264.41-.264.224 0 .7-.293 1.057-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472z",fill:"#f290c1"}),n.createElement("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .806.008.806.153 0 .17 1.418-.021 5.376-.021 3.85 0 6.693.297 6.795.132.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm13.915.983l.595.366c.385.237.595.623.595 1.096 0 .401-.06.73-.132.73-.135 0-.187-.708-.066-.898.036-.058-.172-.372-.463-.7zM.898 3.543c.097.003.164.108.164.278 0 .465-.158.533-.385.166-.084-.136-.031-.321.117-.413a.188.188 0 0 1 .104-.032zm.6.502c.039-.013.065.073.073.254.011.255.11.45.22.432.108-.017 2.103-.009 4.43.019 2.704.031 4.043.134 3.705.283-.291.128-2.22.227-4.288.22-3.826-.013-4.575-.204-4.225-1.077.033-.08.061-.123.085-.131z",fill:"#f291bd"}),n.createElement("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 1.076.04 1.076.185 0 .17 1.807.09 5.765.09 3.85 0 6.034.154 6.136-.011.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm1.1.53H15.11l.65.649c.639.64.9 1.996.384 1.996-.146 0-.265-.178-.265-.395 0-.217-.26-.693-.577-1.058l-.576-.664H8.873c-6.265 0-6.941.117-7.496 1.293-.44.931-.4 1.181.298 1.836.575.54.865.575 4.762.575 2.59 0 4.15.1 4.15.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.924-.986-.797-3.218.34-4.26z",fill:"#a3809c"}),n.createElement("path",{d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.826.65 1.043.65.216 0 .386.232.542.241.535.03.73.005 1.13-.049.4-.055 3.114.04 6.344-.023l5.872-.115.676-.677c.577-.577.676-.912.676-2.288 0-1.358-.101-1.713-.649-2.26l-.65-.65H8.472zm.766.53h13.04l.65.649c.742.742.92 2.157.239 1.895-.234-.09-.342-.045-.25.102.088.143-.139.558-.504.923-.591.591-.881.663-2.66.663-1.154 0-1.997.112-1.997.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.863-.92-.714-3.018.251-4.05zm12.487.528c-.013.014.067.121.231.331.2.255.408.463.463.463.218 0 .078-.217-.363-.563-.21-.164-.317-.244-.33-.23zM1.184 3.44c-.117 0 .066.297.408.661.341.364.714.661.827.661.113 0 .39.053.054-.311-.337-.364-1.171-1.011-1.289-1.011zM6.09 4.528c-.6 0-1.2.013-1.654.039-.91.051-.165.094 1.654.094s2.563-.043 1.653-.094a31.07 31.07 0 0 0-1.653-.04z",fill:"#a8769a"}),n.createElement("path",{d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.143.008.728-.64c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.885.886.815 1.583-.269 2.666-.884.884-.703.965-2.624.965-1.153 0-2.28.064-2.28.217 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.845-.902-.819-2.572.054-3.444z",fill:"#2f99a1"}),n.createElement("path",{d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.016.103.855-.735c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.477.478.648.935.648 1.731 0 .797-.17 1.254-.649 1.732l-.65.65-6.692-.016-6.693-.017-.595-.635c-.845-.904-.755-2.749.118-3.62z",fill:"#5b3b6a"}),n.createElement("path",{d:"M16.673 1.587c-.12-.084-.265.542-.265 1.203 0 .924-.15 1.353-.649 1.852l-.65.65-13.228-.19-.698-.46c-.356-.357-.506-.943-.506-1.17 0-.224-.262-.297-.407-.297-.533 0-.005 1.371.833 2.25l.622.359 6.69.019 6.689.018.917-.917c.777-.777.917-1.101.917-2.117 0-.66-.034-1.037-.153-1.12z"}),n.createElement("text",{style:{lineHeight:"1.25"},x:"2.765",y:"2.203",fontWeight:"400",fontSize:"5.333",fontFamily:"sans-serif",letterSpacing:"0",wordSpacing:"0"}),n.createElement("g",{"aria-label":"reset",style:{lineHeight:1.25},fontWeight:"400",fontSize:"4.667",fontFamily:"Arial Rounded MT Bold",letterSpacing:"0",wordSpacing:"0",fill:"#5b3b6a"},n.createElement("path",{d:"M3.417 3.587v.52c0 .125-.03.22-.088.284a.298.298 0 0 1-.226.093.285.285 0 0 1-.221-.095c-.058-.064-.087-.158-.087-.283V2.374c0-.28.101-.419.303-.419.104 0 .178.033.224.098a.54.54 0 0 1 .075.29c.074-.128.15-.225.228-.29a.478.478 0 0 1 .314-.098c.13 0 .258.033.38.098.124.065.185.152.185.26a.249.249 0 0 1-.08.19.242.242 0 0 1-.168.072.815.815 0 0 1-.166-.041.74.74 0 0 0-.23-.043.335.335 0 0 0-.224.073c-.058.047-.055.165-.087.26-.032.093-.101.158-.113.289-.013.129-.019.287-.019.474zM6.464 3.372H5.247c.002.142.03.266.084.374.057.108.13.19.221.244a.59.59 0 0 0 .306.082c.074 0 .094-.04.155-.057.062-.018.138-.093.196-.13.058-.037.11-.046.16-.088.048-.043.143-.053.22-.126a.204.204 0 0 1 .137-.041c.064 0 .115.017.155.052.04.035.06.085.06.149a.41.41 0 0 1-.067.198.798.798 0 0 1-.2.216c-.089.069-.2.126-.335.171a1.432 1.432 0 0 1-.463.068c-.4 0-.758-.05-.98-.278-.221-.228-.285-.6-.285-.99 0-.185.028-.355.082-.511.055-.158.135-.293.24-.406.105-.112.234-.198.387-.257.153-.061.324-.091.51-.091.244 0 .452.051.625.155.175.101.305.234.392.396.086.163.13.328.13.497 0 .156-.045.258-.135.305a.85.85 0 0 1-.378.068zM5.247 3.02l1.049-.016c-.016-.212.006-.355-.094-.46a.51.51 0 0 0-.392-.16.5.5 0 0 0-.383.162c-.099.107-.159.265-.18.474zM9.506 3.671a.768.768 0 0 1-.125.442.776.776 0 0 1-.372.278c-.162.062-.36.093-.595.093-.223 0-.414-.034-.574-.102a.841.841 0 0 1-.353-.255.521.521 0 0 1-.114-.31.25.25 0 0 1 .257-.248c.066 0 .116.015.151.047a.524.524 0 0 1 .1.135c.064.11.076.146.165.2.266-.033.433.05.587.05.124 0 .067.053.146-.002.08-.056.12-.12.12-.191 0-.11-.041-.19-.125-.24a1.515 1.515 0 0 0-.407-.143 3.538 3.538 0 0 1-.524-.166.873.873 0 0 1-.322-.233.53.53 0 0 1-.12-.353c0-.125.037-.242.111-.353a.76.76 0 0 1 .328-.265c.146-.066.322-.1.527-.1.16 0 .305.017.433.05.129.034.236.079.32.135a.645.645 0 0 1 .197.187.361.361 0 0 1 .068.2.23.23 0 0 1-.073.176c-.047.045-.114.068-.203.068a.254.254 0 0 1-.164-.055 1.116 1.116 0 0 1-.152-.164.562.562 0 0 0-.167-.146.524.524 0 0 0-.26-.054.503.503 0 0 0-.28.073c-.074.047-.111.106-.111.177 0 .066.027.12.082.162.054.041.192.06.284.087.093.027.157.076.32.116.192.047.35.103.471.169a.767.767 0 0 1 .278.232c.064.088.096.19.096.303zM11.773 3.372l-1.121.064c.001.141-.066.202-.011.31.056.108.13.19.22.244a.59.59 0 0 0 .306.082.764.764 0 0 0 .203-.025.71.71 0 0 0 .18-.082c.058-.038.11-.078.16-.12l.189-.174a.204.204 0 0 1 .136-.041c.064 0 .116.017.155.052.04.035.06.085.06.149a.41.41 0 0 1-.067.198.797.797 0 0 1-.2.216c-.088.069-.2.126-.335.171a1.432 1.432 0 0 1-.463.068c-.4 0-.71-.113-.932-.341-.221-.228-.332-.537-.332-.928 0-.184.027-.354.082-.51.054-.158.134-.293.239-.406.105-.112.234-.198.387-.257.154-.061.324-.091.51-.091.244 0 .452.051.625.155.175.101.305.234.392.396.087.163.13.328.13.497 0 .156-.045.258-.135.305a.85.85 0 0 1-.378.068zm-1.217-.353h1.128c-.015-.212-.073-.371-.173-.476-.099-.106-.182-.064-.344-.064-.155 0-.267.006-.367.114-.099.106-.222.217-.244.426zM12.842 2.01h.068v-.374c0-.1.003-.178.007-.235a.362.362 0 0 1 .046-.148.272.272 0 0 1 .104-.102.307.307 0 0 1 .367.048c.043.04.07.088.08.145.012.057-.006.36.002.464l.016.202h.228c.088 0 .155.021.2.064.048.04.071.094.071.16 0 .083-.033.141-.1.175-.065.033-.208-.048-.283.05l-.108.143c-.082.381 0 .762 0 1.144 0 .097-.005.03.001.082a.245.245 0 0 0 .055.128c.03.032.08.048.146.048a.82.82 0 0 0 .148-.019.729.729 0 0 1 .146-.02c.05 0 .095.02.134.061.041.04.062.09.062.149 0 .1-.055.177-.164.23-.11.053-.267.08-.472.08-.194 0-.342-.033-.442-.099a.46.46 0 0 1-.198-.27c-.03-.116-.101-.27-.093-.463.015-.398-.12-.343.047-1.194h-.082c-.09 0-.158-.022-.205-.064a.209.209 0 0 1-.07-.162c0-.065.024-.118.072-.16a.326.326 0 0 1 .217-.063z"}))),n.createElement("rect",{className:"controller-button-overlay",width:"100%",height:"100%",fill:"black",fillOpacity:"0",rx:"10",ry:"10"})),s=n.createElement("svg",{visibility:"visible",width:"70px",height:"26.25px",style:{transform:`scale(${t})`,transformOrigin:"0 0",position:"absolute",left:this.scalePixel(192.75),top:this.scalePixel(284)}},n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16.937 6.35"},n.createElement("path",{fill:"#f290c1",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .409.119.409.264 0 .17 2.293.265 6.35.265 4.057 0 6.35-.096 6.35-.265 0-.145.184-.264.41-.264.224 0 .7-.293 1.057-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472z"}),n.createElement("path",{fill:"#f291bd",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .409.119.409.264 0 .17 2.244.265 6.202.265 3.85 0 6.264-.1 6.366-.265.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm13.915.983l.595.366c.385.237.595.623.595 1.096 0 .401-.06.73-.132.73-.135 0-.187-.708-.066-.898.036-.058-.172-.372-.463-.7zM.898 3.543c.097.003.164.108.164.278 0 .465-.158.533-.385.166-.084-.136-.031-.321.117-.413a.188.188 0 0 1 .104-.032zm.6.502c.039-.013.065.073.073.254.011.255.11.45.22.432.108-.017 2.103-.009 4.43.019 2.704.031 4.043.134 3.705.283-.291.128-2.22.227-4.288.22-3.826-.013-4.575-.204-4.225-1.077.033-.08.061-.123.085-.131z"}),n.createElement("path",{fill:"#a3809c",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.833.65 1.058.65.225 0 .409.119.409.264 0 .17 2.244.265 6.202.265 3.85 0 6.264-.1 6.366-.265.09-.145.34-.264.557-.264.216 0 .685-.293 1.042-.65.548-.547.65-.902.65-2.26 0-1.359-.102-1.714-.65-2.261l-.65-.65H8.472zm1.1.53H15.11l.65.649c.639.64.9 1.996.384 1.996-.146 0-.265-.178-.265-.395 0-.217-.26-.693-.577-1.058l-.576-.664H8.873c-6.265 0-6.941.117-7.496 1.293-.44.931-.4 1.181.298 1.836.575.54.865.575 4.762.575 2.59 0 4.15.1 4.15.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.924-.986-.797-2.193.34-3.236z"}),n.createElement("path",{fill:"#a8769a",d:"M1.303 0l-.65.65c-.547.547-.649.902-.649 2.26 0 1.359.102 1.714.65 2.261.357.357.826.65 1.043.65.216 0 .46.108.542.241.082.133.476.196.876.142.4-.055 3.368-.151 6.598-.214l5.872-.115.676-.677c.577-.577.676-.912.676-2.288 0-1.358-.101-1.713-.649-2.26l-.65-.65H8.472zm.766.53h13.04l.65.649c.742.742.92 2.157.239 1.895-.234-.09-.342-.045-.25.102.088.143-.139.558-.504.923-.591.591-.881.663-2.66.663-1.154 0-1.997.112-1.997.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.863-.92-.793-2.239.172-3.272zm12.487.528c-.013.014.067.121.231.331.2.255.408.463.463.463.218 0 .078-.217-.363-.563-.21-.164-.317-.244-.33-.23zM1.184 3.44c-.117 0 .066.297.408.661.341.364.714.661.827.661.113 0-.07-.297-.407-.661-.337-.364-.71-.661-.828-.661zM6.09 4.528c-.6 0-1.2.013-1.654.039-.91.051-.165.094 1.654.094s2.563-.043 1.653-.094a31.07 31.07 0 0 0-1.653-.04z"}),n.createElement("path",{fill:"#2f99a1",d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.143.008.728-.64c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.885.886.815 1.583-.269 2.666-.884.884-.989.917-2.91.917-1.153 0-1.994.112-1.994.265 0 .167-1.642.259-4.431.249-4.328-.016-4.446-.032-5.027-.653-.845-.902-.819-2.572.054-3.444z"}),n.createElement("path",{fill:"#5b3b6a",d:"M1.303 0l-.65.65c-.546.547-.649.902-.649 2.258 0 1.303.113 1.73.595 2.245l.596.635 7.144.008 7.143.008.728-.64c.644-.567.727-.826.727-2.253 0-1.359-.101-1.714-.649-2.261l-.65-.65H8.472zm.53.53H15.11l.65.649c.477.478.648.935.648 1.731 0 .797-.17 1.254-.649 1.732l-.65.65-6.692-.016-6.693-.017-.595-.635C.284 3.72.31 2.05 1.183 1.179z"}),n.createElement("path",{d:"M16.673 1.587c-.146 0-.265.542-.265 1.203 0 .924-.15 1.353-.649 1.852l-.65.65H1.833l-.65-.65C.827 4.285.534 3.81.534 3.584c0-.225-.119-.409-.264-.409-.533 0-.243.831.595 1.709l.86.9 6.69.019 6.689.018.917-.917c.777-.777.917-1.101.917-2.117 0-.66-.119-1.2-.264-1.2z"}),n.createElement("path",{fill:"#5b3b6a",d:"M3.773 1.723c-.1.007-.2.056-.304.175-.243.263-.34-.344-.645-.087-.219.159-.07.434-.108.658v1.597h.56c.051-.533-.12-1.11.123-1.61.36-.45 1.038.15.82.609.04.378-.212 1.192.456 1.001h.105c.056-.535-.13-1.11.133-1.612.335-.39.855.064.83.478.034.347-.282.99.169 1.135.545.15.278-.472.348-.78-.008-.428.044-.943-.287-1.27-.348-.327-.983-.361-1.302.025-.313.015-.599-.34-.898-.319zm4.12.001c-.599.022-1.183.496-1.174 1.125-.051.62.434 1.27 1.082 1.27.367.008.959.003 1.073-.427-.266-.54-.722.142-1.15-.112-.45-.06-.384-.634.083-.451.419.035.842-.01 1.263.007.127-.605-.26-1.348-.923-1.392a1.13 1.13 0 0 0-.255-.02zm1.927.028c-.04-.012-.09-.002-.154.047-.34.104-.115.567-.174.837v1.431h.555c.06-.543-.157-1.163.19-1.642.384-.399 1.11.097.933.6.106.316-.215.898.167 1.042h.393c-.056-.651.16-1.385-.237-1.963-.328-.396-1.002-.468-1.362-.076-.147.001-.19-.238-.311-.276zm2.315.054c.05.645-.141 1.359.213 1.944.299.387.96.513 1.314.132.25-.084.356.443.641.157.17-.234.03-.55.07-.826V1.806h-.555c-.06.543.156 1.163-.19 1.642-.385.398-1.11-.097-.933-.601-.106-.318.256-1.05-.27-1.041h-.29zm-4.228.424c.268-.015.542.11.618.389-.382.126-.79.025-1.183.054h-.028c.06-.275.324-.429.593-.443z",fontFamily:"Nexa Bold",fontSize:"15.875",fontWeight:"400",letterSpacing:"0",style:{lineHeight:"125%"},wordSpacing:"0"})),n.createElement("rect",{className:"controller-button-overlay",width:"100%",height:"100%",fill:"black",fillOpacity:"0",rx:"10",ry:"10"}));return n.createElement("div",{className:"simulator-display",id:"wrap",style:{transform:`scale(${t})`,transformOrigin:"0 0",width:this.scalePixel(368),height:this.scalePixel(432.938)}},n.createElement("div",{className:"debug-stats",id:"debug-stats"}),n.createElement("div",{className:"screen-back",id:"screen-back"}),n.createElement("div",{id:"screen"},n.createElement("div",{id:"paint-surface-container",style:{top:this.scalePixel(12),left:this.scalePixel(12)}},n.createElement("canvas",{id:"paint-surface",width:"160",height:"120",className:"borders",style:{transform:`scale(${t})`,transformOrigin:"0 0",height:229,width:312,left:this.scalePixel(28),top:this.scalePixel(20),clipPath:"polygon(0px 5.33333px, 5.33333px 0px, 338.667px/1.2) 0px, 344px 5.33333px, 344px 256.667px, 338.667px 262px, 5.33333px 262px, 0px 256.667px)"}})),n.createElement("div",{id:"controls",className:"no-focus"},i,r,o,s),e),n.createElement("div",{id:"instructions"}))}}i.SimulatorDisplay=o},{"./data":81,react:335}],140:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.tryInit=void 0;var n=pxt.Cloud,r=pxt.Util;let o,s={};function a(e){let t=r.lookup(s,e.result.socket);t?t.onOOB(e):console.error("Dropping data for "+e.result.socket)}i.tryInit=function(){pxt.BrowserUtils.isLocalHost()&&n.localToken&&(pxt.mkTCPSocket=(e,t)=>new l(e,t))};class l{constructor(e,t){this.host=e,this.port=t,this.onData=e=>{},this.onError=e=>{}}onOOB(e){if("data"==e.op){const t=r.stringToUint8Array(atob(e.result.data));this.onData(t)}else"close"==e.op&&(this.sockId=null,delete s[e.result.socket])}error(e){let t=new Error(r.lf("TCP error on socket {0}:{1} ({2})",this.host,this.port,e));throw this.onError(t),t}disconnectAsync(){return this.sockId?o.opAsync("close",{socket:this.sockId}).then((()=>{this.sockId=null})):Promise.resolve()}sendPacketAsync(e){return this.sockId||r.userError("Not connected"),o.opAsync("send",{socket:this.sockId,data:r.toHex(e),encoding:"hex"})}sendSerialAsync(e,t){return Promise.reject(new Error("No serial on socket"))}connectAsync(){return o||(pxt.BrowserUtils.isLocalHost()&&n.localToken||r.userError(lf("TCP sockets not available here")),pxt.debug("initializing tcp pipe"),o=pxt.worker.makeWebSocket(`ws://localhost:${pxt.options.wsPort}/${n.localToken}/tcp`,a)),this.sockId?Promise.resolve():o.opAsync("open",{host:this.host,port:this.port}).then((e=>{e.socket||this.error(e.errorMessage),this.sockId=e.socket,s[this.sockId]=this}))}}},{}],141:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.initTutorial=i.click=i.tutorialNext=i.tutorialStep=void 0;const n=e("./audio"),r={};function o(e){const t=(pxt.appTarget.appTheme.sounds||{})[e];if(pxt.options.light||!t)return Promise.resolve(void 0);let i=r[t];if(i)return Promise.resolve(i);const o=pxt.webConfig.commitCdnUrl+"sounds/"+t;return pxt.Util.requestAsync({url:o,headers:{Accept:"audio/"+t.slice(-3)},responseArrayBuffer:!0}).then((e=>n.loadAsync(e.buffer))).then((e=>r[t]=e))}function s(e){pxt.options.light||o(e).then((e=>e?n.play(e,.2):void 0))}i.tutorialStep=function(){s("tutorialStep")},i.tutorialNext=function(){s("tutorialNext")},i.click=function(){s("click")},i.initTutorial=function(){pxt.options.light||Promise.all([o("tutorialStep"),o("tutorialNext"),o("click")])}},{"./audio":19}],142:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Editor=void 0;const n=e("./core"),r=e("react");i.Editor=class{constructor(e){this.parent=e,this.isVisible=!1,this.changeCallback=()=>{},this.isReady=!1}setVisible(e){this.isVisible=e}simStateChanged(){}acceptsFile(e){return!1}getViewState(){return{}}getCurrentSource(){return this.currSource}getStyle(e){let t={display:this.isVisible?"block":"none"};return Object.assign(t,e)}getId(){return"editor"}displayOuter(e){return r.createElement("div",{className:"full-abs",key:this.getId(),id:this.getId(),style:this.getStyle(e)},this.display())}display(){return null}beforeCompile(){}prepare(){this.isReady=!0}resize(e){}snapshotState(){return null}unloadFileAsync(){return Promise.resolve()}isIncomplete(){return!1}hasHistory(){return!0}hasUndo(){return!0}hasRedo(){return!0}undo(){}redo(){}zoomIn(){}zoomOut(){}setScale(e){}closeFlyout(){}clearCaches(){}loadFileAsync(e,t){return this.currSource=e.content,this.setDiagnostics(e,this.snapshotState()),Promise.resolve()}domUpdate(){}setDiagnostics(e,t){}setViewState(e){}saveToTypeScriptAsync(e=!1){return Promise.resolve(void 0)}highlightStatement(e,t){return!1}clearHighlightedStatements(){}setHighContrast(e){}hasEditorToolbar(){return!0}filterToolbox(e){}insertBreakpoint(){}updateBreakpoints(){}getBreakpoints(){return[]}updateToolbox(){}onExceptionDetected(e){n.warningNotification(lf("Program Error: {0}",null==e?void 0:e.exceptionMessage))}validateTutorialCode(e){}}},{"./core":78,react:335}],143:[function(e,t,i){"use strict";var n=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i};Object.defineProperty(i,"__esModule",{value:!0}),i.PlainCheckbox=i.ProgressCircle=i.Tooltip=i.Loader=i.Dimmer=i.Modal=i.Menu=i.MenuItem=i.Icon=i.Checkbox=i.Input=i.Field=i.helpIconLink=i.Link=i.CloseButton=i.Button=i.ButtonMenuItem=i.Item=i.Select=i.ExpandableMenu=i.DropdownMenu=i.StatelessUIElement=i.UIElement=i.genericContent=i.cx=i.appElement=void 0;const r=e("react"),o=e("react-dom"),s=e("react-modal"),a=e("react-tooltip"),l=e("./data"),c=e("./core"),u=e("./auth"),d=e("./util");function p(e){return e.filter((e=>!!e&&""!=e.trim())).join(" ")}function h(e,t,i=!1){return`${e} ${i?"":t.icon&&t.text?"icon icon-and-text":t.icon?"icon":""} ${t.inverted?"inverted":""} ${t.className||""}`}function f(e){let t=[e.icon?r.createElement(i.Icon,{key:"iconkey",icon:e.icon+(e.text?" icon-and-text ":"")+(e.iconClass?" "+e.iconClass:"")}):null,e.text?r.createElement("span",{key:"textkey",className:"ui text"+(e.textClass?" "+e.textClass:"")},e.text):null];return e.icon&&e.rightIcon&&(t=t.reverse()),t}i.appElement=document.getElementById("content"),i.cx=p,i.genericContent=f;class m extends l.Component{}i.UIElement=m;class g extends l.PureComponent{}i.StatelessUIElement=g;i.DropdownMenu=class extends m{constructor(){super(...arguments),this.navigateToNextElement=(e,t,i)=>{const n=this.refs.dropdown,r=c.keyCodeFromEvent(e),o=e.currentTarget;40===r?(e.preventDefault(),e.stopPropagation(),i&&this.focus(i)):38===r?(e.preventDefault(),e.stopPropagation(),t?this.focus(t):(n.focus(),this.setState({open:!1}))):r!==c.SPACE_KEY&&r!==c.ENTER_KEY||(e.preventDefault(),e.stopPropagation(),o.click())},this.closeOnEscape=e=>{c.keyCodeFromEvent(e)===c.ESC_KEY&&(e.preventDefault(),this.refs.dropdown.focus(),this.isMouseDown=!0,this.hide())},this.handleClick=e=>{this.props.onClick&&!this.props.onClick()||this.toggle(),e.stopPropagation()},this.handleClose=()=>{this.isMouseDown=!1;const e=document.activeElement===this.refs.dropdown;this.setState({focus:e})},this.handleMouseDown=e=>{this.isMouseDown=!0,document.addEventListener(pxsim.pointerEvents.up,this.handleDocumentMouseUp)},this.handleDocumentMouseUp=e=>{this.isMouseDown=!1,document.removeEventListener(pxsim.pointerEvents.up,this.handleDocumentMouseUp)},this.handleFocus=e=>{const{focus:t}=this.state;t||this.setState({focus:!0})},this.handleBlur=e=>{this.isMouseDown||setTimeout((()=>{let e=this.isChildFocused();this.setState({focus:e})}),1)},this.captureMouseEvent=e=>{e.stopPropagation()},this.handleKeyDown=e=>{const t=c.keyCodeFromEvent(e);40===t?(e.preventDefault(),this.focusFirst=!0,this.show()):t!==c.SPACE_KEY&&t!==c.ENTER_KEY||(e.preventDefault(),this.toggle())}}show(){this.setState({open:!0,focus:!0})}hide(){this.setState({open:!1})}toggle(){this.state.open?this.hide():this.show()}focus(e){this.setActive(e),e.focus()}blur(e){this.isActive(e)&&pxt.BrowserUtils.removeClass(e,"active")}setActive(e){this.isActive(e)||pxt.BrowserUtils.addClass(e,"active")}isActive(e){return e&&pxt.BrowserUtils.containsClass(e,"active")}getChildren(){const e=this.refs.menu,t=[];for(let i=0;i<e.childNodes.length;i++){const n=e.childNodes[i];pxt.BrowserUtils.containsClass(n,"divider")||pxt.BrowserUtils.containsClass(n,"mobile")&&!pxt.BrowserUtils.isMobile()||t.push(n)}return t}isChildFocused(){return this.refs.menu.contains(document.activeElement)}componentDidMount(){const e=this.getChildren();for(let t=0;t<e.length;t++){const i=t>0?e[t-1]:void 0,n=e[t],r=t<e.length?e[t+1]:void 0;n.addEventListener("keydown",(e=>{this.navigateToNextElement(e,i,r)})),n.addEventListener("focus",(e=>{this.setActive(n)})),n.addEventListener("blur",(e=>{this.blur(n)})),t==e.length-1&&n.addEventListener("keydown",(e=>{const t=c.keyCodeFromEvent(e);e.shiftKey||t!==c.TAB_KEY||this.hide()}))}}componentDidUpdate(e,t){const i=this.getChildren();for(let e=0;e<i.length;e++)i[e].tabIndex=this.state.open?0:-1;if(t.open!=this.state.open&&this.state.open){const e=this.refs.dropdown,t=this.refs.menu;e.offsetLeft+t.offsetWidth>window.innerWidth&&pxt.BrowserUtils.addClass(t,"left")}!t.focus&&this.state.focus||t.focus&&!this.state.focus&&(this.isMouseDown||this.hide()),!t.open&&this.state.open?document.addEventListener("keydown",this.closeOnEscape):t.open&&!this.state.open&&(document.removeEventListener("keydown",this.closeOnEscape),this.handleClose()),this.focusFirst&&i.length>0&&(this.focus(i[0]),this.focusFirst=!1)}renderCore(){const{disabled:e,title:t,role:i,icon:n,className:o,titleContent:s,children:a,displayAbove:l,displayLeft:c,displayRight:u,dataTooltip:d}=this.props,{open:h}=this.state,m={role:i||"combobox","aria-disabled":e,"aria-haspopup":!!e,"aria-expanded":h},g={role:"menu","aria-label":lf("Dropdown menu {0}",t),"aria-hidden":!!h},b=p(["ui",h?"active visible":"","dropdown",n?"icon":"",o||"",l?"menuAbove":"",u?"menuRight":"",c?"menuLeft":""]),v=p(["menu",h?"visible transition":""]);return r.createElement("div",Object.assign({role:"listbox",ref:"dropdown",title:t},m,{id:this.props.id,className:b,"data-tooltip":d,onMouseDown:this.handleMouseDown,onClick:this.handleClick,onKeyDown:this.handleKeyDown,onFocus:this.handleFocus,onBlur:this.handleBlur,tabIndex:0}),s||f(this.props),r.createElement("div",Object.assign({ref:"menu"},g,{className:v,role:"menu",onMouseDown:this.captureMouseEvent,onClick:this.captureMouseEvent}),a))}};i.ExpandableMenu=class extends m{constructor(){super(...arguments),this.hide=()=>{this.setState({expanded:!1});const{onHide:e}=this.props;e&&e()},this.show=()=>{this.setState({expanded:!0});const{onShow:e}=this.props;e&&e()},this.toggleExpanded=()=>{const{expanded:e}=this.state;e?this.hide():this.show()}}render(){const{title:e,children:t}=this.props,{expanded:i}=this.state;return r.createElement("div",{className:"expandable-menu"},r.createElement(k,{className:"no-select menu-header",icon:"no-select chevron "+(i?"down":"right"),text:e,ariaExpanded:i,onClick:this.toggleExpanded,role:"button"}),i&&r.createElement("div",{className:"expanded-items"},t))}};i.Select=class extends m{constructor(e){super(e),this.handleOnChange=e=>{const{onChange:t}=this.props;this.setState({selected:e.target.value}),t&&t(e.target.value)};const{options:t}=e;this.state={selected:t[0]&&t[0].value+""}}render(){const{options:e,label:t,"aria-label":i}=this.props,{selected:n}=this.state;return r.createElement("div",null,t&&`${t} `,r.createElement("select",{value:n,className:"ui dropdown",onChange:this.handleOnChange,"aria-label":i},e.map((e=>e&&r.createElement("option",{"aria-selected":n===e.value,value:e.value,key:e.value},e.display||e.value)))))}};class b extends l.Component{renderCore(){const{text:e,title:t,ariaLabel:i,ariaHidden:n}=this.props;return r.createElement("div",{className:h("ui item link",this.props,!0)+" "+(this.props.active?"active":""),role:this.props.role,"aria-label":i||t||e,"aria-selected":this.props.active,"aria-hidden":n,title:t||e,tabIndex:this.props.tabIndex||0,key:this.props.value,"data-value":this.props.value,onClick:this.props.onClick,onMouseDown:this.props.onMouseDown,onTouchStart:this.props.onMouseDown,onMouseUp:this.props.onMouseUp,onTouchEnd:this.props.onMouseUp,onMouseLeave:this.props.onMouseLeave,onKeyDown:this.props.onKeyDown||d.fireClickOnEnter},f(this.props),this.props.children)}}i.Item=b;i.ButtonMenuItem=class extends m{renderCore(){return r.createElement("div",{className:h("ui item link",this.props,!0)+" "+(this.props.active?"active":""),role:this.props.role,title:this.props.title||this.props.text,tabIndex:this.props.tabIndex||0,key:this.props.value,"data-value":this.props.value,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown||d.fireClickOnEnter},r.createElement("div",{className:h("ui button",this.props)},f(this.props),this.props.children))}};class v extends g{renderCore(){const{labelPosition:e,color:t,size:i,disabled:n,loading:o}=this.props,s=p([t,i,n||o?"disabled":"",o?"loading":"",h("ui button",this.props)]),a=r.createElement("button",{className:s,id:this.props.id,role:this.props.role,title:this.props.title,tabIndex:this.props.tabIndex||0,"aria-label":this.props.ariaLabel,"aria-expanded":this.props.ariaExpanded,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown,autoFocus:this.props.autoFocus},f(this.props),this.props.children);return this.props.tooltipId&&!pxt.BrowserUtils.isIOS()?r.createElement(A,{id:this.props.tooltipId,content:this.props.tooltip||this.props.title,place:this.props.tooltipPlace,delayShow:this.props.tooltipDelayShow},a):a}}i.Button=v;class y extends g{renderCore(){const{onClick:e}=this.props;return r.createElement("div",{role:"button",className:"closeIcon",tabIndex:0,onClick:e,onKeyDown:d.fireClickOnEnter,"aria-label":lf("Close")},r.createElement(i.Icon,{icon:"close remove circle"}))}}i.CloseButton=y;class k extends g{renderCore(){return r.createElement("a",{className:h("ui",this.props)+(this.props.loading?" loading":"")+(this.props.disabled?" disabled":""),id:this.props.id,href:this.props.href,target:this.props.target,rel:this.props.rel||(this.props.target?"noopener noreferrer":""),download:this.props.download,ref:this.props.refCallback,role:this.props.role,title:this.props.title,tabIndex:this.props.tabIndex||0,"aria-label":this.props.ariaLabel,"aria-expanded":this.props.ariaExpanded,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown||d.fireClickOnEnter},f(this.props),this.props.children)}}i.Link=k,i.helpIconLink=function(e,t){return r.createElement(k,{className:"help-link",href:e,icon:"help circle",target:"_blank",role:"link",title:t})};class w extends l.Component{renderCore(){return r.createElement("div",{className:"field"},this.props.label?r.createElement("label",{htmlFor:this.props.ariaLabel?void 0:this.props.htmlFor},this.props.label):null,this.props.ariaLabel&&this.props.htmlFor?r.createElement("label",{htmlFor:this.props.htmlFor,className:"accessible-hidden"},this.props.ariaLabel):"",this.props.children)}}i.Field=w;class x extends l.Component{constructor(e){super(e),this.state={value:e.value},this.copy=this.copy.bind(this),this.handleClick=this.handleClick.bind(this),this.handleChange=this.handleChange.bind(this),this.handleEnterPressed=this.handleEnterPressed.bind(this)}componentDidMount(){const{selectOnMount:e,autoFocus:t}=this.props;e&&t&&this.refs.inputField.select()}UNSAFE_componentWillReceiveProps(e){this.setState({value:e.value})}clearValue(){this.setState({value:void 0})}copy(){this.setState({copied:!1});const e=this.props,t=o.findDOMNode(this);if(e.lines&&1!=e.lines){const e=t.getElementsByTagName("textarea")[0];e.focus(),e.setSelectionRange(0,9999)}else{const e=t.getElementsByTagName("input")[0];e.focus(),e.setSelectionRange(0,9999)}try{const e=document.execCommand("copy");pxt.debug("copy: "+e),this.setState({copied:!!e})}catch(e){this.setState({copied:!1})}}handleClick(e){this.props.selectOnClick&&e.target.setSelectionRange(0,9999)}handleChange(e){const t=e.target.value;this.props.readOnly||this.state&&this.state.value===t||this.setState({value:t,copied:!1}),this.props.onChange&&this.props.onChange(t)}handleEnterPressed(e){if(c.keyCodeFromEvent(e)===c.ENTER_KEY){const{onEnter:t}=this.props;t&&(e.preventDefault(),t())}}renderCore(){const e=this.props,{copy:t,error:i,ariaLabel:n,id:o,label:s,inputLabel:a,lines:l,autoFocus:c,placeholder:u,readOnly:d,autoComplete:p}=e,{value:h,copied:f}=this.state,m=t&&document.queryCommandSupported("copy")?r.createElement(v,{className:`ui right labeled ${f?"green":"primary"} icon button`,text:f?lf("Copied!"):lf("Copy"),icon:"copy",onClick:this.copy}):null;return r.createElement(w,{ariaLabel:n,htmlFor:o,label:s},r.createElement("div",{className:"ui input"+(e.inputLabel?" labelled":"")+(t?" action fluid":"")+(e.disabled?" disabled":"")},a?r.createElement("div",{className:"ui label"},a):"",l&&1!=l?r.createElement("textarea",{id:o,className:"ui input "+(e.class||"")+(a?" labelled":""),rows:l,placeholder:u,value:h||"",readOnly:!!d,onClick:this.handleClick,onChange:this.handleChange,onKeyDown:this.handleEnterPressed}):r.createElement("input",{ref:"inputField",autoFocus:c,id:o,className:e.class||"",type:e.type||"text",placeholder:u,value:h||"",readOnly:!!d,onClick:this.handleClick,onChange:this.handleChange,onKeyDown:this.handleEnterPressed,autoComplete:p?"":"off",autoCorrect:p?"":"off",autoCapitalize:p?"":"off",spellCheck:p}),m),i?r.createElement("div",{className:"ui yellow message"},i):void 0)}}i.Input=x;class E extends l.Component{constructor(e){super(e),this.state={},this.handleChange=this.handleChange.bind(this)}handleChange(e){this.props.onChange(e.currentTarget.checked)}renderCore(){const e=this.props;return r.createElement(w,{label:e.label},r.createElement("div",{className:"ui toggle checkbox"},r.createElement("input",{type:"checkbox",checked:e.checked,"aria-checked":e.checked,"aria-label":e.label||e.inputLabel,onChange:this.handleChange}),e.inputLabel?r.createElement("label",null,e.inputLabel):void 0))}}i.Checkbox=E;i.Icon=e=>{const{icon:t,className:i,onClick:o,onKeyDown:s,children:a}=e,l=n(e,["icon","className","onClick","onKeyDown","children"]);return r.createElement("i",Object.assign({className:`icon ${t} ${i||""}`,onClick:o,onKeyDown:s||d.fireClickOnEnter,"aria-hidden":!0,role:"presentation"},l),a)};class C extends l.Component{constructor(e){super(e),this.handleClick=e=>{const{onClick:t}=this.props;t&&t(e,this.props)}}renderCore(){const{active:e,children:t,className:n,color:o,content:s,fitted:a,header:l,icon:c,link:u,name:h,onClick:f,position:m,ariaControls:g,id:b,tabIndex:v,dataTooltip:y}=this.props,k=p([o,m,e?"active":"",!0===c||c&&!h&&!s?"icon":"",l?"header":"",u||f?"link":"",a?1==a?`${a}`:`fitted ${a}`:"","item",n]);return t?r.createElement("div",{role:"menuitem",className:k,onClick:this.handleClick},t):r.createElement("div",{id:b,key:b,tabIndex:null!=v?v:-1,className:k,onClick:this.handleClick,onKeyDown:d.fireClickOnEnter,role:"tab","aria-controls":g,"aria-selected":e,"aria-label":`${s||h}`,"data-tooltip":y},c?r.createElement(i.Icon,{icon:c}):void 0,s||h)}}i.MenuItem=C;class S extends l.Component{constructor(e){super(e),this.handleKeyboardNavigation=e=>{const t=c.keyCodeFromEvent(e);let i=37===t||38===t,n=39===t||40===t;if(!i&&!n)return;let r,o=this.child(".item"),s=-1,a=0;for(;-1===s&&a<o.length;)pxt.BrowserUtils.containsClass(o[a],"active")&&(s=a),a++;-1!==s&&(i&&!pxt.Util.isUserLanguageRtl()||n&&pxt.Util.isUserLanguageRtl()?r=0===s?o[o.length-1]:o[s-1]:(n&&!pxt.Util.isUserLanguageRtl()||i&&pxt.Util.isUserLanguageRtl())&&(r=s===o.length-1?o[0]:o[s+1]),void 0!==r&&(r.click(),r.focus()))}}componentDidMount(){this.child(".item").forEach(((e,t)=>{e.onkeydown=this.handleKeyboardNavigation}))}renderCore(){const{attached:e,borderless:t,children:i,className:n,color:o,compact:s,fixed:a,floated:l,fluid:c,icon:u,inverted:d,pagination:h,pointing:f,secondary:m,size:g,stackable:b,tabular:v,text:y,vertical:k}=this.props,w=p(["ui",o,g,t?"borderless":"",s?"compact":"",c?"fluid":"",d?"inverted":"",h?"pagination":"",f?"pointing":"",m?"secondary":"",b?"stackable":"",y?"text":"",k?"vertical":"",e?1==e?"attached":`${e} attached `:"",l?1==l?"floated":`${l} floated`:"",u?1==u?"icon":`${u} icon`:"",v?1==v?"tabular":`${v} tabular`:"",a?`tabular ${v}`:"",n,"menu"]);return r.createElement("div",{className:w,role:"tablist"},i)}}i.Menu=S;class _ extends l.Component{constructor(e){super(e),this.setPositionAndClassNames=()=>{const{dimmer:e}=this.props;let t;e&&(t="dimmable dimmed","blurring"===e&&(t+=" blurring"));const i={},n=this.getRef();if(n){const{height:e}=n.getBoundingClientRect(),r=-Math.round(e/2),o=e>=window.innerHeight;this.state.marginTop!==r&&(i.marginTop=r),this.state.scrolling!==o&&(i.scrolling=o),o&&(t+=" scrolling")}this.state.mountClasses!==t&&(i.mountClasses=t),Object.keys(i).length>0&&(this.setState(i),this.props.onPositionChanged&&this.props.onPositionChanged(this.props)),this.animationRequestId=requestAnimationFrame(this.setPositionAndClassNames)},this.id=ts.pxtc.Util.guidGen(),this.state={},this.onRequestClose=this.onRequestClose.bind(this),this.afterOpen=this.afterOpen.bind(this)}afterOpen(){const{modalDidOpen:e}=this.props;this.setState({scrolling:!1}),this.setPositionAndClassNames(),e&&e(this.getRef())}onClose(){cancelAnimationFrame(this.animationRequestId)}getRef(){const e=this.refs.modal;return e&&e.node&&e.node.firstChild&&e.node.firstChild.firstChild}componentWillUnmount(){cancelAnimationFrame(this.animationRequestId)}onRequestClose(){const{onClose:e}=this.props;this.onClose(),e()}renderCore(){var e,t;const o=this.props,{isOpen:a,size:l,longer:c,basic:h,className:f,onClose:m,closeIcon:g,children:b,onKeyDown:w,header:x,headerIcon:E,headerClass:C,headerActions:S,helpUrl:_,description:A,closeOnDimmerClick:N,closeOnDocumentClick:I,closeOnEscape:O,shouldCloseOnEsc:P,shouldCloseOnOverlayClick:D,shouldFocusAfterRender:L,overlayClassName:R}=o,M=n(o,["isOpen","size","longer","basic","className","onClose","closeIcon","children","onKeyDown","header","headerIcon","headerClass","headerActions","helpUrl","description","closeOnDimmerClick","closeOnDocumentClick","closeOnEscape","shouldCloseOnEsc","shouldCloseOnOverlayClick","shouldFocusAfterRender","overlayClassName"]),{marginTop:B,scrolling:j,mountClasses:U}=this.state,F="fullscreen"==l,H=F&&!!g,q=p(["ui",l,c?"longer":"",h?"basic":"",j?"scrolling":"",g?"closable":"","modal transition visible active",f]),z=p([this.getData(u.HIGHCONTRAST)?"hc":"",U]),G={labelledby:x?this.id+"title":void 0,describedby:!F&&A?this.id+"description":this.id+"desc"},$={content:{marginTop:B}};return r.createElement(s,Object.assign({isOpen:a,ref:"modal",appElement:i.appElement,onRequestClose:this.onRequestClose,onAfterOpen:this.afterOpen,shouldReturnFocusAfterClose:!0,shouldFocusAfterRender:L,shouldCloseOnEsc:P||O,shouldCloseOnOverlayClick:D||I||N,portalClassName:z,overlayClassName:`ui page modals dimmer transition ${R} ${a?"visible active":""}`,className:q,style:$,role:"dialog",aria:G},M),x||H||_?r.createElement("div",{id:this.id+"title",className:"header "+(C||"")},E&&r.createElement(i.Icon,{icon:E}),r.createElement("h3",{className:"header-title",style:{margin:`0 ${_?"-20rem":"0"} 0 ${H?"-20rem":"0"}`}},x),H?r.createElement("div",{className:"header-close"},r.createElement(v,{className:"back-button large",title:lf("Go back"),onClick:m,tabIndex:0,onKeyDown:d.fireClickOnEnter},r.createElement(i.Icon,{icon:"arrow left"}),r.createElement("span",{className:"ui text landscape only"},lf("Go back")))):void 0,_?r.createElement("div",{className:"header-help"},r.createElement("a",{className:"ui icon help-button",href:_,target:"_docs",role:"link","aria-label":lf("Help on {0} dialog",x),title:lf("Help on {0} dialog",x)},r.createElement(i.Icon,{icon:"help"}))):void 0):void 0,F&&S?r.createElement("div",{className:"header-actions"},S):void 0,!F&&A?r.createElement("label",{id:this.id+"description",className:"accessible-hidden"},A):void 0,r.createElement("div",{id:this.id+"desc",className:`${c?"scrolling":""} ${S?"has-actions":""} content`},b),!F&&(this.props.actions&&this.props.actions.length||this.props.buttons&&this.props.buttons.length)?r.createElement("div",{className:"actions"},null===(e=this.props.actions)||void 0===e?void 0:e.map(((e,t)=>r.createElement("div",{key:`action_left_${t}`,className:"left-action"},e))),null===(t=this.props.buttons)||void 0===t?void 0:t.map((e=>e.url?r.createElement(k,{key:`action_${e.label}`,icon:e.icon,text:e.label,title:e.title||e.label,className:`ui button approve ${e.icon?"icon right":""} ${e.label&&!e.urlButton?"labeled":""} ${e.className||""} ${e.loading?"loading disabled":""} ${e.disabled?"disabled":""}`,href:e.url,target:e.fileName?void 0:"_blank",download:e.fileName?pxt.Util.htmlEscape(e.fileName):void 0}):r.createElement(T,Object.assign({key:`action_${e.label}`},e,{labelPosition:e.labelPosition}))))):void 0,!F&&g&&r.createElement(y,{onClick:m}))}}i.Modal=_;class T extends l.PureComponent{constructor(e){super(e),this.state={},this.handleClick=this.handleClick.bind(this)}handleClick(){!this.props.disabled&&this.props.onclick&&this.props.onclick()}renderCore(){const e=this.props;return r.createElement(v,{icon:e.icon,text:e.label,labelPosition:e.labelPosition,className:`approve ${e.icon?`icon ${e.labelPosition?e.labelPosition:"right"} labeled`:""} ${e.className||""} ${e.loading?"loading disabled":""} ${e.disabled?"disabled":""}`,onClick:this.handleClick,onKeyDown:d.fireClickOnEnter,ariaLabel:this.props.ariaLabel?this.props.ariaLabel:this.props.label,title:this.props.title})}}i.Dimmer=class extends m{render(){const e=this.props,{disabled:t,inverted:o,page:a,simple:l,closable:c,onClose:u,active:d,children:h}=e,f=n(e,["disabled","inverted","page","simple","closable","onClose","active","children"]),m=p(["ui dimmer",d?"active transition visible":"",t?"disabled":"",o?"inverted":"",a?"page":"",l?"simple":""]);return r.createElement(s,Object.assign({appElement:i.appElement,style:{content:{background:"none",border:"0"}},shouldCloseOnOverlayClick:c,onRequestClose:u,overlayClassName:m,role:"dialog"},f),h)}};i.Loader=class extends m{render(){const{active:e,children:t,disabled:i,inverted:n,size:o,className:s}=this.props,a=p(["ui loader",o,e?"active":"",i?"disabled":"",n?"inverted":"",t?"text":"",s]);return r.createElement("div",{className:a},t)}};class A extends r.Component{constructor(e){super(e),this.state={}}render(){const e=this.props,{id:t,content:i,className:o}=e,s=n(e,["id","content","className"]);return r.createElement("div",null,r.createElement("div",{"data-tip":"tooltip","data-for":t},this.props.children),r.createElement(a,Object.assign({id:t,className:`pxt-tooltip ${o||""}`,effect:"solid"},s),i))}}i.Tooltip=A;class N extends r.Component{constructor(e){super(e),this.radius=100/(2*Math.PI),this.view=2*this.radius+this.props.stroke}getPathStyle(){return{strokeWidth:this.props.stroke}}render(){let e=this.props,t=this.radius;return r.createElement("div",{className:"progresscircle"},r.createElement("svg",{viewBox:`0 0 ${this.view} ${this.view}`,"aria-labelledby":"circletitle",role:"img"},r.createElement("title",{id:"circletitle"},"Currently on step ",e.progress," of ",e.steps),r.createElement("path",{style:this.getPathStyle(),strokeDasharray:`${Math.round(100*e.progress/e.steps)}, 100`,d:`M${this.view/2} ${e.stroke/2} a ${t} ${t} 0 0 1 0 ${2*t} a ${t} ${t} 0 0 1 0 -${2*t}`})))}}i.ProgressCircle=N;class I extends l.Component{constructor(e){super(e),this.state={isChecked:this.props.isChecked},this.setCheckedBit=this.setCheckedBit.bind(this)}setCheckedBit(){let e=!this.state.isChecked;this.props.onChange(e),this.setState({isChecked:e})}renderCore(){return r.createElement(E,{inputLabel:this.props.label,checked:this.state.isChecked,onChange:this.setCheckedBit})}}i.PlainCheckbox=I},{"./auth":20,"./core":78,"./data":81,"./util":149,react:335,"react-dom":291,"react-modal":304,"react-tooltip":328}],144:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ToolboxStyle=i.ToolboxTrashIcon=i.ToolboxSearch=i.TreeGroup=i.TreeItem=i.TreeSeparator=i.TreeRow=i.CategoryItem=i.Toolbox=i.CategoryNameID=void 0;const n=e("react"),r=e("./data"),o=e("./sui"),s=e("./core"),a=e("./coretsx");var l=pxt.Util;const c=e("./util");var u;(u=i.CategoryNameID||(i.CategoryNameID={})).Loops="loops",u.Logic="logic",u.Variables="variables",u.Maths="Math",u.Functions="functions",u.Arrays="arrays",u.Text="text",u.Extensions="addpackage";const d="monaco";class p extends r.Component{constructor(e){super(e),this.handleRootElementRef=e=>{this.rootElement=e},this.state={categories:[],visible:!1,loading:!1,showAdvanced:!1,shouldAnimate:!pxt.shell.getToolboxAnimation()},this.setSelection=this.setSelection.bind(this),this.advancedClicked=this.advancedClicked.bind(this),this.recoverToolbox=this.recoverToolbox.bind(this)}getElement(){return this.rootElement}hide(){this.setState({visible:!1})}showLoading(){this.setState({visible:!0,loading:!0})}show(){this.setState({visible:!0})}setSelectedItem(e){this.selectedItem=e}setPreviousItem(){if(this.selectedIndex>0){const e=--this.selectedIndex;let t=this.items[e];this.setSelection(t,e)}else if(this.state.showSearchBox){const e=this.refs.searchbox;e&&e.focus()}}setNextItem(){if(this.items.length-1>this.selectedIndex){const e=++this.selectedIndex;this.setSelection(this.items[e],e)}}setSearch(){const e=this.refs.searchbox;e&&e.focus()}clear(){this.clearSelection(),this.selectedIndex=0,this.selectedTreeRow=void 0}clearSelection(){this.setState({selectedItem:void 0,focusSearch:!1})}clearExpandedItem(){this.setState({expandedItem:void 0})}clearSearch(){this.setState({hasSearch:!1,searchBlocks:void 0,focusSearch:!1})}setSelection(e,t,i){const{editorname:n,parent:r}=this.props,{nameid:o,subns:s,customClick:a}=e;pxt.tickEvent(`${n}.toolbox.click`,void 0,{interactiveConsent:!0});let l=s?o+s:o;if(this.state.selectedItem!=l||i){let i=!1;if(a&&(i=a(r)))return;i||(this.setState({selectedItem:l,expandedItem:o,focusSearch:!1}),this.selectedIndex=t,this.selectedTreeRow=e,e.advanced&&!this.state.showAdvanced&&this.showAdvanced(),a||this.showFlyout(e))}else this.clearSelection(),this.closeFlyout()}focus(){if(this.rootElement)if(this.selectedItem&&this.selectedItem.getTreeRow()){const e=this.selectedItem.props.treeRow,t=this.items.indexOf(e);this.setSelection(e,t,!0)}else this.selectFirstItem()}selectFirstItem(){this.items[0]&&this.setSelection(this.items[0],0,!0)}moveFocusToFlyout(){const{parent:e}=this.props;e.moveFocusToFlyout()}UNSAFE_componentWillReceiveProps(e){(this.props.editorname==d&&e.editorname!=d||e.editorname==d&&e.parent.parent.state.fullscreen&&this.state.shouldAnimate)&&(pxt.shell.setToolboxAnimation(),this.setState({shouldAnimate:!1}))}componentDidUpdate(e,t){t.visible==this.state.visible&&t.loading==this.state.loading&&t.showAdvanced==this.state.showAdvanced&&this.state.expandedItem==t.expandedItem||this.props.parent.resize(),this.state.hasSearch&&this.state.searchBlocks!=t.searchBlocks?this.refreshSearchItem():t.hasSearch&&!this.state.hasSearch&&"search"==this.state.selectedItem&&this.closeFlyout()}componentDidCatch(e,t){const{editorname:i}=this.props;pxt.tickEvent(`${i}.toolbox.crashed`,{error:e}),this.setState({hasError:!0})}componentWillUnmount(){this.props.editorname==d&&pxt.shell.setToolboxAnimation()}recoverToolbox(){this.setState({hasError:!1})}advancedClicked(){const{editorname:e}=this.props;pxt.tickEvent(`${e}.advanced`,void 0,{interactiveConsent:!0}),this.showAdvanced()}showAdvanced(){const{parent:e}=this.props;this.selectedItem&&this.selectedItem.props.treeRow&&this.selectedItem.props.treeRow.advanced&&(this.clear(),this.closeFlyout()),this.setState({showAdvanced:!this.state.showAdvanced})}getSearchBlocks(){const{parent:e}=this.props,{searchBlocks:t}=this.state;return t.map((e=>({name:e.qName,attributes:{blockId:e.id},builtinBlock:e.builtinBlock,builtinField:e.field})))}refreshSelection(){const{parent:e}=this.props;this.state.selectedItem&&this.selectedTreeRow&&(this.selectedTreeRow.customClick?this.selectedTreeRow.customClick(e):this.showFlyout(this.selectedTreeRow))}refreshSearchItem(){const e=v.getSearchTreeRow();this.showFlyout(e)}showFlyout(e){const{parent:t}=this.props;t.showFlyout(e)}closeFlyout(){const{parent:e}=this.props;e.closeFlyout()}hasAdvancedCategories(){const{categories:e}=this.state;return e.some((e=>e.advanced))}getNonAdvancedCategories(){const{categories:e}=this.state;return e.filter((e=>!e.advanced))}getAdvancedCategories(){const{categories:e}=this.state;return e.filter((e=>e.advanced))}getAllCategoriesList(e){const{categories:t,hasSearch:i,expandedItem:n}=this.state,r=[];return i&&r.push(v.getSearchTreeRow()),t.forEach((t=>{r.push(t),t.subcategories&&(!e||e&&t.nameid==n)&&t.subcategories.forEach((e=>{r.push(e)}))})),r}shouldComponentUpdate(e,t){return this.state!=t}isRtl(){const{editorname:e}=this.props;return"monaco"!=e&&l.isUserLanguageRtl()}renderCore(){const{editorname:e,parent:t}=this.props,{showAdvanced:i,visible:r,loading:s,selectedItem:a,expandedItem:l,hasSearch:c,showSearchBox:u,hasError:d}=this.state;if(!r)return n.createElement("div",{style:{display:"none"}});const p=pxt.appTarget.appTheme,f=t.parent.state.tutorialOptions,g=!!f&&!!f.tutorial,b=!!p.topBlocks&&!g;if(s||d)return n.createElement("div",null,n.createElement("div",{className:"blocklyTreeRoot"},n.createElement("div",{className:"blocklyTreeRow",style:{opacity:0}})),s?n.createElement("div",{className:"ui active dimmer"},n.createElement("div",{className:"ui loader indeterminate"})):void 0,d?n.createElement("div",{className:"ui"},lf("Toolbox crashed.."),n.createElement(o.Button,{icon:"refresh",onClick:this.recoverToolbox,text:lf("Reload"),className:"fluid"})):void 0);const y=this.hasAdvancedCategories();let w=this.getNonAdvancedCategories();const x=y?this.getAdvancedCategories():[];this.items=this.getAllCategoriesList();const E=v.getSearchTreeRow(),C={nameid:"topblocks",name:lf("{id:category}Basic"),color:pxt.toolbox.getNamespaceColor("topblocks"),icon:pxt.toolbox.getNamespaceIcon("topblocks")},S=pxt.appTarget.appTheme,_=o.cx(["pxtToolbox",S.invertedToolbox?"invertedToolbox":"",S.coloredToolbox?"coloredToolbox":""]);let T=0,A=0;return n.createElement("div",{ref:this.handleRootElementRef,className:_,id:`${e}EditorToolbox`},n.createElement(k,{categories:this.items}),u?n.createElement(v,{ref:"searchbox",parent:t,toolbox:this,editorname:e}):void 0,n.createElement("div",{className:"blocklyTreeRoot"},n.createElement("div",{role:"tree"},c?n.createElement(h,{key:"search",toolbox:this,index:T++,selected:"search"==a,treeRow:E,onCategoryClick:this.setSelection}):void 0,b?n.createElement(h,{key:"topblocks",toolbox:this,selected:"topblocks"==a,treeRow:C,onCategoryClick:this.setSelection}):void 0,w.map((e=>n.createElement(h,{key:e.nameid,toolbox:this,index:T++,selected:a==e.nameid,childrenVisible:l==e.nameid,treeRow:e,onCategoryClick:this.setSelection,topRowIndex:A++,shouldAnimate:this.state.shouldAnimate},e.subcategories?e.subcategories.map((e=>n.createElement(h,{key:e.nameid+e.subns,index:T++,toolbox:this,selected:a==e.nameid+e.subns,treeRow:e,onCategoryClick:this.setSelection}))):void 0))),y?n.createElement(m,{key:"advancedseparator"}):void 0,y?n.createElement(h,{toolbox:this,treeRow:{nameid:"",name:pxt.toolbox.advancedTitle(),color:pxt.toolbox.getNamespaceColor("advanced"),icon:pxt.toolbox.getNamespaceIcon(i?"advancedexpanded":"advancedcollapsed")},onCategoryClick:this.advancedClicked,topRowIndex:A++}):void 0,i?x.map((e=>n.createElement(h,{key:e.nameid,toolbox:this,index:T++,selected:a==e.nameid,childrenVisible:l==e.nameid,treeRow:e,onCategoryClick:this.setSelection},e.subcategories?e.subcategories.map((e=>n.createElement(h,{key:e.nameid,toolbox:this,index:T++,selected:a==e.nameid+e.subns,treeRow:e,onCategoryClick:this.setSelection}))):void 0))):void 0)))}}i.Toolbox=p;class h extends r.Component{constructor(e){super(e),this.handleTreeRowRef=e=>{this.treeRowElement=e},this.state={selected:e.selected},this.handleClick=this.handleClick.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}getTreeRow(){return this.treeRowElement}UNSAFE_componentWillReceiveProps(e){const t={};null!=e.selected&&(t.selected=e.selected),Object.keys(t).length>0&&this.setState(t)}componentDidUpdate(e,t){const{toolbox:i}=this.props;this.state.selected&&(this.props.toolbox.setSelectedItem(this),i.state.focusSearch||a.dialogIsShowing()||this.focusElement())}focusElement(){this.treeRowElement.focus()}handleClick(e){const{treeRow:t,onCategoryClick:i,index:n}=this.props;i&&i(t,n),e.preventDefault(),e.stopPropagation()}handleKeyDown(e){var t,i;const{toolbox:n}=this.props,r=l.isUserLanguageRtl(),o=Blockly.getMainWorkspace(),a=o.keyboardAccessibilityMode,u=a&&(null===(i=null===(t=n.props.parent.navigationController)||void 0===t?void 0:t.navigation)||void 0===i?void 0:i.getState(o)),d=a?83:40,p=a?87:38,h=a?65:37,f=a?68:39,m=s.keyCodeFromEvent(e);a&&"toolbox"!=u?a&&"flyout"==u&&(m==h&&!r||m==f&&r)&&(this.focusElement(),e.stopPropagation()):m==d?this.nextItem():m==p?this.previousItem():m==f&&!r||m==h&&r?n.moveFocusToFlyout():27==m?n.closeFlyout():m==s.ENTER_KEY||m==s.SPACE_KEY?c.fireClickOnEnter.call(this,e):m==s.TAB_KEY||37==m||39==m||17==m||16==m||91==m||a||n.setSearch()}previousItem(){const{toolbox:e,childrenVisible:t}=this.props,i=e.props.editorname;pxt.tickEvent(`${i}.toolbox.keyboard.prev"`,void 0,{interactiveConsent:!0}),e.setPreviousItem()}nextItem(){const{toolbox:e,childrenVisible:t}=this.props,i=e.props.editorname;pxt.tickEvent(`${i}.toolbox.keyboard.next"`,void 0,{interactiveConsent:!0}),e.setNextItem()}renderCore(){const{toolbox:e,childrenVisible:t}=this.props,{selected:i}=this.state;return n.createElement(g,null,n.createElement(f,Object.assign({ref:this.handleTreeRowRef,isRtl:e.isRtl()},this.props,{selected:i,onClick:this.handleClick,onKeyDown:this.handleKeyDown})),n.createElement(b,{visible:t},this.props.children))}}i.CategoryItem=h;class f extends r.Component{constructor(e){super(e),this.baseAnimationDelay=1,this.animationDelay=.15,this.handleTreeRowRef=e=>{this.treeRow=e},this.state={},this.onmouseenter=this.onmouseenter.bind(this),this.onmouseleave=this.onmouseleave.bind(this)}focus(){this.treeRow&&this.treeRow.focus()}getProperties(){const{treeRow:e}=this.props;return e}onmouseenter(){const e=pxt.appTarget.appTheme,t=this.getMetaColor(),i=e.blocklyOptions&&e.blocklyOptions.toolboxOptions&&e.blocklyOptions.toolboxOptions.invertedMultiplier||.3;e.invertedToolbox&&(this.treeRow.style.backgroundColor=pxt.toolbox.fadeColor(t||"#ddd",i,!1))}onmouseleave(){const e=pxt.appTarget.appTheme,t=this.getMetaColor();e.invertedToolbox&&(this.treeRow.style.backgroundColor=t||"#ddd")}getMetaColor(){const{color:e}=this.props.treeRow;return pxt.toolbox.convertColor(e)||pxt.toolbox.getNamespaceColor("default")}renderCore(){const{selected:e,onClick:t,onKeyDown:i,isRtl:r,topRowIndex:o}=this.props,{nameid:s,subns:a,name:u,icon:d}=this.props.treeRow,p=pxt.appTarget.appTheme,h=this.getMetaColor(),f=p.blocklyOptions&&p.blocklyOptions.toolboxOptions&&p.blocklyOptions.toolboxOptions.invertedMultiplier||.3;let m={paddingLeft:"0px"},g="blocklyTreeRow";if(p.invertedToolbox)m.backgroundColor=h||"#ddd",m.color="#fff";else{p.coloredToolbox&&(m.color=`${h}`);const e=`8px solid ${h}`;r?m.borderRight=e:m.borderLeft=e,o&&this.props.shouldAnimate&&(m.animationDelay=`${o*this.animationDelay+this.baseAnimationDelay}s`,g+=" blocklyTreeAnimate")}e&&(g+=" blocklyTreeSelected",p.invertedToolbox?m.backgroundColor=`${pxt.toolbox.fadeColor(h,f,!1)}`:m.backgroundColor=h||"#ddd",m.color="#fff");const b=`blocklyTreeIcon${a?"more":d?(s||d).toLowerCase():"Default"}`.replace(/\s/g,"");let v,y=a?pxt.toolbox.getNamespaceIcon("more"):d||pxt.toolbox.getNamespaceIcon("default");y.length>1&&(v=n.createElement("style",null,`.blocklyTreeIcon.${b} {\n                    background-image: url("${l.pathJoin(pxt.webConfig.commitCdnUrl,encodeURI(d))}")!important;\n                    width: 30px;\n                    height: 100%;\n                    background-size: 20px !important;\n                    background-repeat: no-repeat !important;\n                    background-position: 50% 50% !important;\n                }`),y=void 0);const k=u||l.capitalize(a||s);return n.createElement("div",{role:"button",ref:this.handleTreeRowRef,className:g,style:m,tabIndex:0,"aria-label":lf("Toggle category {0}",k),"aria-expanded":e,onMouseEnter:this.onmouseenter,onMouseLeave:this.onmouseleave,onClick:t,onContextMenu:t,onKeyDown:i||c.fireClickOnEnter},n.createElement("span",{className:"blocklyTreeIcon",role:"presentation"}),v,n.createElement("span",{style:{display:"inline-block"},className:`blocklyTreeIcon ${b}`,role:"presentation"},y),n.createElement("span",{className:"blocklyTreeLabel"},k))}}i.TreeRow=f;class m extends r.Component{renderCore(){return n.createElement(g,null,n.createElement("div",{className:"blocklyTreeSeparator"},n.createElement("span",{style:{display:"inline-block"},role:"presentation"})))}}i.TreeSeparator=m;class g extends r.Component{renderCore(){const{selected:e}=this.props;return n.createElement("div",{role:"treeitem","aria-selected":e},this.props.children)}}i.TreeItem=g;class b extends r.Component{renderCore(){const{visible:e}=this.props;return this.props.children?n.createElement("div",{role:"tree",style:{backgroundPosition:"0px 0px",display:e?"":"none"}},this.props.children):n.createElement("div",null)}}i.TreeGroup=b;class v extends r.Component{constructor(e){super(e),this.search=l.debounce((()=>{this.searchImmediate()}),300,!1),this.state={},this.searchImmediate=this.searchImmediate.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleChange=this.handleChange.bind(this)}static getSearchTreeRow(){return{nameid:"search",name:lf("{id:category}Search"),color:pxt.toolbox.getNamespaceColor("search"),icon:pxt.toolbox.getNamespaceIcon("search")}}handleChange(){this.search()}handleKeyDown(e){const{toolbox:t}=this.props;40===("number"==typeof e.which?e.which:e.keyCode)&&t.selectFirstItem()}focus(){this.refs.searchInput.focus()}searchImmediate(){const{parent:e,toolbox:t,editorname:i}=this.props,n=this.refs.searchInput.value;let r="",o=!1;pxt.tickEvent(`${i}.search`,void 0,{interactiveConsent:!0}),e.searchAsync(n).then((e=>{r=0==e.length?lf("No search results..."):lf("{0} result matching '{1}'",e.length,n.toLowerCase()),o=""!=n;const i={};i.hasSearch=o,i.searchBlocks=e,i.focusSearch=!0,o&&(i.selectedItem="search"),t.setState(i),this.setState({searchAccessibilityLabel:r})}))}renderCore(){const{searchAccessibilityLabel:e}=this.state;return n.createElement("div",{id:"blocklySearchArea"},n.createElement("div",{id:"blocklySearchInput",className:"ui fluid icon input",role:"search"},n.createElement("input",{ref:"searchInput",type:"text",placeholder:lf("Search..."),onFocus:this.searchImmediate,onKeyDown:this.handleKeyDown,onChange:this.handleChange,id:"blocklySearchInputField",className:"blocklySearchInputField","aria-label":lf("Search"),autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}),n.createElement("i",{className:"search icon",role:"presentation","aria-hidden":"true"}),n.createElement("div",{className:"accessible-hidden",id:"blocklySearchLabel","aria-live":"polite"}," ",e," ")))}}i.ToolboxSearch=v;class y extends r.Component{constructor(e){super(e)}getStyle(){let e={opacity:0,display:"none"};if(this.props.flyoutOnly){let t=document.querySelector(".blocklyFlyout");t&&(e.left=t.clientWidth/2,e.transform="translateX(-45%)")}return e}renderCore(){return n.createElement("div",{id:"blocklyTrashIcon",style:this.getStyle()},n.createElement("i",{className:"trash icon","aria-hidden":"true"}))}}i.ToolboxTrashIcon=y;class k extends r.Component{renderCore(){const{categories:e}=this.props;return n.createElement("style",null,e.filter((e=>!!e.color)).map((e=>`span.docs.inlineblock.${e.nameid.toLowerCase()} {\n                    background-color: ${e.color};\n                    border-color: ${pxt.toolbox.fadeColor(e.color,.1,!1)};\n                }`)))}}i.ToolboxStyle=k},{"./core":78,"./coretsx":79,"./data":81,"./sui":143,"./util":149,react:335}],145:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ToolboxEditor=void 0;const n=e("./srceditor"),r=e("./compiler");class o extends n.Editor{constructor(){super(...arguments),this.extensionsMap={},this.subcategoryMap={},this.topBlocks=[]}shouldShowBlock(e,t,i){var n;const r=this.parent.state.editorState&&this.parent.state.editorState.filters;if(r){const o=r.blocks&&(r.blocks[e]||this.blockIdMap&&(null===(n=this.blockIdMap[e])||void 0===n?void 0:n.some((e=>r.blocks[e])))),s=r.namespaces&&r.namespaces[t];if(null!=o&&o==pxt.editor.FilterState.Hidden&&!i)return!1;if(null!=o)return!0;if(null!=s&&s==pxt.editor.FilterState.Hidden)return!1;if(null!=s)return!0;if(null!=r.defaultState&&r.defaultState==pxt.editor.FilterState.Hidden&&!i)return!1}return!0}shouldShowCustomCategory(e){const t=this.parent.state.editorState&&this.parent.state.editorState.filters;return!t||!("variables"!==e||t.blocks&&!t.blocks.variables_set&&!t.blocks.variables_get&&!t.blocks.variables_change||t.namespaces&&t.namespaces.variables===pxt.editor.FilterState.Disabled)||!("functions"!==e||t.blocks&&!t.blocks.function_definition&&!t.blocks.procedures_defnoreturn&&!t.blocks.procedures_callnoreturn||t.namespaces&&t.namespaces.functions===pxt.editor.FilterState.Disabled)}getSearchSubset(){if(!this.searchSubset&&this.blockInfo){this.searchSubset={};const e=this.searchSubset;let t=pxt.blocks.blockDefinitions();for(const i in t){const n=t[i];this.shouldShowBlock(i,n.category)&&(e[i]=!0)}this.blockInfo.blocks.forEach((t=>{let i=(t.attributes.blockNamespace||t.namespace).split(".")[0];t.attributes.debug&&!pxt.options.debug||t.attributes.blockHidden||t.attributes.deprecated&&null==this.parent.state.tutorialOptions||this.shouldShowBlock(t.attributes.blockId,i)&&(e[t.attributes.blockId]=!0)}))}return this.searchSubset}searchAsync(e){const t={term:e,subset:this.getSearchSubset()};return r.apiSearchAsync(t).then((e=>e)).then((t=>(pxt.debug("searching for: "+e),t)))}clearCaches(){super.clearCaches(),this.searchSubset=void 0,this.blockGroupsCache=void 0}getAllCategories(){return this.getToolboxCategories(!1).concat(this.getToolboxCategories(!0))}getToolboxCategories(e){if(!this.blockInfo)return[];let t=this;return function(e,i){return e.sort((([,e],[,t])=>(t&&t.weight||50)>=(e&&e.weight||50)?1:-1)).map((([e,n])=>{const r=t.isBuiltIn(e),o=r?t.getBuiltinCategory(e):void 0,s=t.getBlocksForCategory(e).filter((i=>t.shouldShowBlock(i.attributes.blockId,e))),a=t.extensionsMap[e],l=o&&o.customClick;let c;if((n.subcategories&&n.subcategories.length||t.subcategoryMap[e])&&(c=function(e,i,n){return i.map((i=>{const r=e[0],o=e[1],s=t.getBlocksForCategory(r,i).filter((e=>t.shouldShowBlock(e.attributes.blockId,r)));if(!s.length)return;const a=pxt.Util.rlf(`{id:subcategory}${i}`);return{nameid:r,name:a,subns:i,color:o.color,icon:o.icon,groups:o.groups,groupIcons:o.groupIcons,groupHelp:o.groupHelp,labelLineWidth:o.labelLineWidth,blocks:s,advanced:n}})).filter((e=>!!e))}([e,n],n.subcategories||Object.keys(t.subcategoryMap[e]),i)),!(s.length||a||l||c&&c.length))return;if(l&&!t.shouldShowCustomCategory(e))return;let u={nameid:e,name:n.block?n.block:void 0,color:n.color,icon:n.icon,groups:n.groups,groupIcons:n.groupIcons,groupHelp:n.groupHelp,labelLineWidth:n.labelLineWidth,blocks:s,subcategories:c,advanced:i};return r&&(u.name=o.name,u.icon=n.icon?pxt.toolbox.getNamespaceIcon(n.icon)||n.icon:pxt.toolbox.getNamespaceIcon(e),u.groups=o.groups||n.groups,u.customClick=o.customClick),u})).filter((e=>!!e))}(this.getNamespaces().map((e=>[e,t.getNamespaceAttrs(e)])).filter((([,i])=>!(i.deprecated&&null==t.parent.state.tutorialOptions)&&(e?i.advanced:!i.advanced))),e)}moveFocusToFlyout(){}abstractShowFlyout(e){const{nameid:t,name:i,subns:n,icon:r,color:o,labelLineWidth:s,blocks:a}=e,l=this.parent.state.tutorialOptions&&!!this.parent.state.tutorialOptions.tutorial;if(!a||!a.length)return!1;pxt.appTarget.appTheme.hideFlyoutHeadings||this.showFlyoutHeadingLabel(t,i,n,r,o);let c=this.getBlockGroups(e);for(let e=0;e<c.length;++e){let i=c[e];i.blocks&&i.blocks.length&&(i.name==pxt.DEFAULT_GROUP_NAME||l||1==c.length||this.showFlyoutGroupLabel(i.name,i.icon,s,i.hasHelp?"help":""),this.showFlyoutBlocks(t,o,i.blocks))}return!0}getNamespaceAttrs(e){const t=this.blockInfo.apis.byQName[e];if(t)return t.attributes;if(this.extensionsMap[e]){const t=this.extensionsMap[e];return{weight:0,blockId:t.name,color:t.extension.color||"#7f8c8d",advanced:t.extension.advanced||!1,callingConvention:0,paramDefl:{}}}}getNamespaces(){const e=[];return this.extensions.forEach((t=>{const i=t.config,n=i.name,r=i.extension.namespace||n;this.extensionsMap[r]||(this.extensionsMap[r]=i),e.filter((e=>e==r))||e.push(n)})),e}getTopBlocks(){return this.topBlocks.sort(((e,t)=>{const i=e.attributes.topblockWeight||e.attributes.weight||50;return(t.attributes.topblockWeight||t.attributes.weight||50)>=i?1:-1}))}getBlockGroups(e){var t,i;const n=e.nameid+(e.subns||"");if(this.blockGroupsCache||(this.blockGroupsCache={}),!this.blockGroupsCache[n]){const{groups:r,groupIcons:o,groupHelp:s,blocks:a}=e;let l=r||[];a.forEach((e=>{let t=e.attributes&&e.attributes.group||pxt.DEFAULT_GROUP_NAME;l.indexOf(t)<0&&l.push(t)}));let c=[];if(l)for(let e=0;e<l.length;e++){let t=l[e],i=a.filter((e=>(e.attributes.group||pxt.DEFAULT_GROUP_NAME)==t)).sort(((e,t)=>(t.attributes.weight||50)+(t.attributes.advanced?0:1e3)>(e.attributes.weight||50)+(e.attributes.advanced?0:1e3)?1:-1));i&&i.length>0&&c.push({name:t,icon:o&&o[e]||"",hasHelp:s&&!!s[e],blocks:i})}if(null===(i=null===(t=this.parent.state)||void 0===t?void 0:t.editorState)||void 0===i?void 0:i.filters)return c;this.blockGroupsCache[n]=c}return this.blockGroupsCache[n]}}i.ToolboxEditor=o},{"./compiler":30,"./srceditor":142}],146:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WorkspaceHeader=i.TutorialCard=i.TutorialHint=i.TutorialStepCircle=i.TutorialMenuItemLink=i.TutorialMenuItem=i.TutorialMenu=i.getUsedBlocksAsync=void 0;const n=e("react"),r=e("react-dom"),o=e("./data"),s=e("./sui"),a=e("./sounds"),l=e("./core"),c=e("./marked"),u=e("./compiler"),d=e("./hinttooltip"),p=e("./editortoolbar"),h=e("./immersivereader"),f=e("./tutorialCodeValidation"),m=e("./util");function g(e,t,i,n,r=!1){const o={},s={};return u.getBlocksAsync().then((t=>(pxt.blocks.initializeAndInject(t),"python"==i?u.decompilePySnippetstoXmlAsync(e):u.decompileSnippetstoXmlAsync(e)))).then((i=>{var a;if((null==i?void 0:i.length)>0){let l;for(let n=0;n<i.length;n++){const r=i[n],c=pxt.BrowserUtils.getTutorialCodeHash([e[n]]);if(!(l=pxt.blocks.loadWorkspaceXml(r)))throw pxt.debug(`used blocks xml failed to load\n${r}`),new Error("blocksXml failed to load");const u=l.getAllBlocks(!1);o[c]={};for(let i=0;i<u.length;++i){const r=u[i];"typescript_statement"==r.type?pxt.tickEvent("tutorial.usedblocks.greyblock",{tutorial:t,code:null===(a=e[n])||void 0===a?void 0:a.substring(0,2e3)}):r.isShadow()||(o[c][r.type]||(o[c][r.type]=0),o[c][r.type]=o[c][r.type]+1,s[r.type]=1)}}null==l||l.dispose(),pxt.options.debug&&pxt.debug(JSON.stringify(o,null,2));try{n&&!r&&n.setAsync(t,o,e)}catch(e){pxt.log("Unable to cache used blocks in DB")}pxt.tickEvent("tutorial.usedblocks.computed",{tutorial:t})}else if((null==e?void 0:e.length)>0)throw new Error("Failed to decompile");return{snippetBlocks:o,usedBlocks:s}})).catch((e=>{throw pxt.reportException(e),new Error("Failed to decompile tutorial")}))}i.getUsedBlocksAsync=function(e,t,i,n=!1){var r;if(!e)return Promise.resolve(void 0);if((null===(r=pxt.appTarget)||void 0===r?void 0:r.tutorialInfo)&&!n){const i=pxt.BrowserUtils.getTutorialCodeHash(e);if(pxt.appTarget.tutorialInfo[i])return pxt.tickEvent("tutorial.usedblocks.cached",{tutorial:t}),Promise.resolve(pxt.appTarget.tutorialInfo[i])}return pxt.BrowserUtils.tutorialInfoDbAsync().then((r=>r.getAsync(t,e).then((o=>(null==o?void 0:o.blocks)&&Object.keys(o.blocks).length>0&&!n?(pxt.tickEvent("tutorial.usedblocks.indexeddb",{tutorial:t}),(null==o?void 0:o.snippets)||g(e,t,i,r,n),Promise.resolve({snippetBlocks:o.snippets,usedBlocks:o.blocks})):g(e,t,i,r,n))).catch((o=>g(e,t,i,r,n))))).catch((r=>g(e,t,i,null,n)))};class b extends o.Component{constructor(e){super(e);let t=this.props.parent.state.tutorialOptions;this.hasActivities=t&&t.tutorialActivityInfo&&t.tutorialActivityInfo.length>1}renderCore(){var e;let t=this.props.parent.state.tutorialOptions;const i=null===(e=t.tutorialStepInfo)||void 0===e?void 0:e[t.tutorialStep].headerContentMd,r=pxt.appTarget.appTheme.immersiveReader;return this.hasActivities?n.createElement("div",{className:"menu tutorial-menu"},n.createElement(k,{parent:this.props.parent}),r&&n.createElement(h.ImmersiveReaderButton,{content:i,tutorialOptions:t})):t.tutorialStepInfo.length<8?n.createElement("div",{className:"menu tutorial-menu"},n.createElement(v,{parent:this.props.parent}),r&&n.createElement(h.ImmersiveReaderButton,{content:i,tutorialOptions:t})):n.createElement("div",{className:"menu tutorial-menu"},n.createElement(v,{parent:this.props.parent,className:"mobile hide"}),n.createElement(k,{parent:this.props.parent,className:"mobile only"}),r&&n.createElement(h.ImmersiveReaderButton,{content:i,tutorialOptions:t}))}}i.TutorialMenu=b;class v extends o.Component{constructor(e){super(e),this.openTutorialStep=this.openTutorialStep.bind(this)}openTutorialStep(e){let t=this.props.parent.state.tutorialOptions;pxt.tickEvent("tutorial.step",{tutorial:t.tutorial,step:e},{interactiveConsent:!0}),this.props.parent.setTutorialStep(e)}renderCore(){const{tutorialReady:e,tutorialStepInfo:t,tutorialStep:i}=this.props.parent.state.tutorialOptions,r=i;if(!e)return n.createElement("div",null);function o(e){return t.length<8||0==e||e==t.length-1||Math.abs(e-r)<2?"":"mobile hide"}return n.createElement("div",{className:`ui item ${this.props.className}`},n.createElement("div",{className:"ui item tutorial-menuitem",role:"menubar"},t.map(((t,i)=>i==r?n.createElement("span",{className:"step-label",key:"tutorialStep"+i},n.createElement(y,{index:i,className:`ui circular label ${r==i?"blue selected":"inverted"} ${e?"":"disabled"}`,ariaLabel:lf("Tutorial step {0}. This is the current step",i+1),onClick:this.openTutorialStep},i+1)):n.createElement("span",{className:`ui step-label ${o(i)}`,key:"tutorialStep"+i,"data-tooltip":`${i+1}`,"data-inverted":"","data-position":"bottom center"},n.createElement(y,{index:i,className:`ui empty circular label ${e?"":"disabled"} clear`,ariaLabel:lf("Tutorial step {0}",i+1),onClick:this.openTutorialStep}))))))}}i.TutorialMenuItem=v;class y extends o.Component{constructor(){super(...arguments),this.handleClick=()=>{this.props.onClick(this.props.index)}}renderCore(){const{className:e,ariaLabel:t,index:i}=this.props;return n.createElement("a",{className:e,role:"menuitem","aria-label":t,tabIndex:0,onClick:this.handleClick,onKeyDown:m.fireClickOnEnter},this.props.children)}}i.TutorialMenuItemLink=y;class k extends o.Component{constructor(e){super(e),this.handleNextClick=()=>{let e=this.props.parent.state.tutorialOptions;this.openTutorialStep(e.tutorialStep+1)},this.handlePrevClick=()=>{let e=this.props.parent.state.tutorialOptions;this.openTutorialStep(e.tutorialStep-1)},this.openTutorialStep=this.openTutorialStep.bind(this)}openTutorialStep(e){let t=this.props.parent.state.tutorialOptions;pxt.tickEvent("tutorial.step",{tutorial:t.tutorial,step:e},{interactiveConsent:!0}),this.props.parent.setTutorialStep(e)}renderCore(){const{tutorialReady:e,tutorialStepInfo:t,tutorialStep:i}=this.props.parent.state.tutorialOptions,r=i,o=e&&0!=r,a=e&&r!=t.length-1;return e?n.createElement("div",{id:"tutorialsteps",className:`ui item ${this.props.className}`},n.createElement("div",{className:"ui item",role:"menubar"},n.createElement(s.Button,{role:"button",icon:"left chevron",disabled:!o,className:"prevbutton left "+(o?"":"disabled"),text:lf("Back"),textClass:"widedesktop only",ariaLabel:lf("Go to the previous step of the tutorial."),onClick:this.handlePrevClick,onKeyDown:m.fireClickOnEnter}),n.createElement("span",{className:"step-label",key:"tutorialStep"+r},n.createElement(s.ProgressCircle,{progress:r+1,steps:t.length,stroke:4.5}),n.createElement("span",{className:"ui circular label blue selected "+(e?"":"disabled"),"aria-label":lf("You are currently at tutorial step {0}.")},i+1)),n.createElement(s.Button,{role:"button",icon:"right chevron",disabled:!a,rightIcon:!0,className:"nextbutton right "+(a?"":"disabled"),text:lf("Next"),textClass:"widedesktop only",ariaLabel:lf("Go to the next step of the tutorial."),onClick:this.handleNextClick,onKeyDown:m.fireClickOnEnter}))):n.createElement("div",null)}}i.TutorialStepCircle=k;class w extends o.Component{constructor(e){super(e),this.setRef=e=>{this.elementRef=e},this.next=this.next.bind(this),this.showHint=this.showHint.bind(this),this.closeHint=this.closeHint.bind(this)}next(){const e=this.props.parent.state.tutorialOptions,{tutorialStep:t,tutorial:i}=e;this.setState({visible:!1});const n=t+1;pxt.tickEvent("tutorial.hint.next",{tutorial:i,step:n}),this.props.parent.setTutorialStep(n)}showHint(e,t){e&&Blockly.hideChaff(),this.setState({visible:e,showFullText:t})}closeHint(){this.showHint(!1,this.state.showFullText)}renderCore(){const{visible:e}=this.state,t=this.props.parent.state.tutorialOptions,{tutorialReady:i,tutorialStepInfo:r,tutorialStep:o,tutorialName:a}=t;if(!i)return n.createElement("div",null);const l=r[o],u=l.hintContentMd,d=l.contentMd,p=t.metadata.hideIteration,f=t.metadata.flyoutOnly,m=pxt.appTarget.appTheme.immersiveReader;if(l.showDialog){let i=o<r.length-1?this.next:this.closeHint,l=[];m&&l.push({className:"immersive-reader-button",onclick:()=>{h.launchImmersiveReader(d,t)},ariaLabel:lf("Launch Immersive Reader"),title:lf("Launch Immersive Reader")}),l.push({label:p&&f?lf("Start"):lf("Ok"),onclick:i,icon:"check",className:"green"});const u=this.props.parent.createModalClasses("hintdialog");return n.createElement(s.Modal,{isOpen:e,className:u,closeIcon:!1,header:a,buttons:l,onClose:i,dimmer:!0,longer:!0,closeOnDimmerClick:!0,closeOnDocumentClick:!0,closeOnEscape:!0},n.createElement(c.MarkedContent,{markdown:d,parent:this.props.parent}))}return u?n.createElement("div",{className:"tutorialhint no-select "+(e?"":"hidden"),ref:this.setRef},n.createElement(c.MarkedContent,{markdown:this.state.showFullText?d:u,unboxSnippets:!0,parent:this.props.parent})):n.createElement("div",null)}}i.TutorialHint=w;class x extends o.Component{constructor(e){super(e),this.closeLightboxOnEscape=e=>{27===l.keyCodeFromEvent(e)&&this.closeLightbox()},this.lastStep=-1;const t=this.props.parent.state.tutorialOptions;this.prevStep=t.tutorialStep,this.state={showSeeMore:!1,showHint:t.tutorialStepInfo[this.prevStep].showHint,showTutorialValidationMessage:!1},this.toggleHint=this.toggleHint.bind(this),this.closeHint=this.closeHint.bind(this),this.hintOnClick=this.hintOnClick.bind(this),this.closeLightbox=this.closeLightbox.bind(this),this.tutorialCardKeyDown=this.tutorialCardKeyDown.bind(this),this.okButtonKeyDown=this.okButtonKeyDown.bind(this),this.previousTutorialStep=this.previousTutorialStep.bind(this),this.nextTutorialStep=this.nextTutorialStep.bind(this),this.finishTutorial=this.finishTutorial.bind(this),this.toggleExpanded=this.toggleExpanded.bind(this),this.onMarkdownDidRender=this.onMarkdownDidRender.bind(this),this.handleResize=this.handleResize.bind(this),this.showTutorialValidationMessageOnClick=this.showTutorialValidationMessageOnClick.bind(this),this.closeTutorialValidationMessage=this.closeTutorialValidationMessage.bind(this),this.doubleClickedNextStep=this.doubleClickedNextStep.bind(this),this.validationTelemetry=this.validationTelemetry.bind(this)}previousTutorialStep(){this.showHint(!1);let e=this.props.parent.state.tutorialOptions;const t=e.tutorialStep-1;e.tutorialStep=t,pxt.tickEvent("tutorial.previous",{tutorial:e.tutorial,step:t},{interactiveConsent:!0}),this.props.parent.setTutorialStep(t),this.setState({showTutorialValidationMessage:!1})}nextTutorialStep(){this.showHint(!1);let e=this.props.parent.state.tutorialOptions;const t=e.tutorialStep+1;e.tutorialStep=t,pxt.tickEvent("tutorial.next",{tutorial:e.tutorial,step:t},{interactiveConsent:!0}),this.props.parent.setTutorialStep(t),e.metadata.tutorialCodeValidation&&this.state.showTutorialValidationMessage&&this.setState({showTutorialValidationMessage:!1})}doubleClickedNextStep(){this.validationTelemetry("next"),this.nextTutorialStep()}finishTutorial(){this.closeLightbox(),this.removeHintOnClick(),this.props.parent.completeTutorialAsync()}closeLightbox(){a.tutorialNext(),document.documentElement.removeEventListener("keydown",this.closeLightboxOnEscape),this.props.parent.hideLightbox()}UNSAFE_componentWillUpdate(){document.documentElement.addEventListener("keydown",this.closeLightboxOnEscape)}tutorialCardKeyDown(e){if(l.keyCodeFromEvent(e)==l.TAB_KEY){e.preventDefault();const t=this.refs.tutorialok;r.findDOMNode(t).focus()}}okButtonKeyDown(e){l.keyCodeFromEvent(e)==l.TAB_KEY&&(e.preventDefault(),this.refs.tutorialmessage.focus())}componentDidUpdate(e,t){const i=this.props.parent.state.tutorialOptions,n=this.refs.tutorialmessage,r=this.props.parent.state.tutorialOptions.tutorialStep;if(r!=this.lastStep){const e=`fade ${r<this.lastStep?"right":"left"} in visible transition animating`;n.style.animationDuration="500ms",this.lastStep=r,pxsim.U.addClass(n,e),pxt.Util.delay(500).then((()=>pxsim.U.removeClass(n,e)))}this.prevStep!=r&&(this.setShowSeeMore(i.autoexpandStep),this.prevStep=r,this.setState({showHint:i.tutorialStepInfo[r].showDialog||i.tutorialStepInfo[r].showHint}))}handleResize(){const e=this.props.parent.state.tutorialOptions;this.setShowSeeMore(e.autoexpandStep)}componentDidMount(){this.setShowSeeMore(this.props.parent.state.tutorialOptions.autoexpandStep),this.resizeDebouncer=pxt.Util.debounce(this.handleResize,500),window.addEventListener("resize",this.resizeDebouncer)}onMarkdownDidRender(){this.setShowSeeMore(this.props.parent.state.tutorialOptions.autoexpandStep)}componentWillUnmount(){c.MarkedContent.clearBlockSnippetCache(),this.lastStep=-1,this.props.parent.stopPokeUserActivity(),this.removeHintOnClick(),window.removeEventListener("resize",this.resizeDebouncer)}removeHintOnClick(){document.removeEventListener("click",this.closeHint)}toggleExpanded(e){e.stopPropagation(),e.preventDefault();const t=this.props.parent.state.tutorialOptions,{tutorialStepExpanded:i}=t;return this.props.parent.setTutorialInstructionsExpanded(!i),!1}hasHint(){const e=this.props.parent.state.tutorialOptions,{tutorialReady:t,tutorialStepInfo:i,tutorialStep:n}=e;return!!t&&(!!i[n].hintContentMd||i[n].showDialog)}hintOnClick(e){const t=this.props.parent.state.tutorialOptions;if(!t)return void pxt.reportError("tutorial","leaking hintonclick");e&&e.stopPropagation();const{tutorialStepInfo:i,tutorialStep:n}=t,r=i[n],o=n<i.length-1&&r&&!!r.showDialog;this.props.parent.clearUserPoke(),o||this.toggleHint()}showTutorialValidationMessageOnClick(e){this.setState({showTutorialValidationMessage:!0})}expandedHintOnClick(e){e.stopPropagation()}setShowSeeMore(e){const t=this.refs.tutorialmessage;let i=!1;t&&t.firstElementChild&&t.firstElementChild.firstElementChild&&(i=t.clientHeight<=t.firstElementChild.firstElementChild.scrollHeight)&&(this.cardHeight=t.firstElementChild.firstElementChild.scrollHeight,e&&this.props.parent.setTutorialInstructionsExpanded(!0)),this.setState({showSeeMore:i}),this.props.parent.setEditorOffset()}getCardHeight(){return this.cardHeight}getExpandedCardStyle(e){return{[e]:`calc(${this.getCardHeight()}px + 2rem)`}}toggleHint(e){this.showHint(!this.state.showHint,e)}closeHint(e){this.showHint(!1)}showHint(e,t){if(this.removeHintOnClick(),this.closeLightbox(),!this.hasHint())return;const i=this.refs.tutorialhint;if(!i)return;const n=this.props.parent.state.tutorialOptions.tutorialStep;if(e){i.elementRef&&i.elementRef.addEventListener("click",this.expandedHintOnClick),this.setState({showHint:!0}),this.props.parent.stopPokeUserActivity();const e=this.props.parent.state.tutorialOptions;e.tutorialStepInfo[e.tutorialStep].showDialog||document.addEventListener("click",this.closeHint),pxt.tickEvent("tutorial.showhint",{tutorial:e.tutorial,step:e.tutorialStep}),this.props.parent.setHintSeen(n)}else i.elementRef&&i.elementRef.removeEventListener("click",this.expandedHintOnClick),this.setState({showHint:!1}),this.props.parent.pokeUserActivity();i.showHint(e,t),e&&this.setState({showTutorialValidationMessage:!1})}closeTutorialValidationMessage(){this.setState({showTutorialValidationMessage:!1})}isCodeValidated(e){if(null!=e){for(let t=0;t<e.length;t++)if(e[t].ruleTurnOn&&!e[t].ruleStatus)return!1;return!0}return!1}areStrictRulesPresent(e){var t;return null!==(t=null==e?void 0:e.some((e=>e.ruleTurnOn&&e.isStrict)))&&void 0!==t&&t}validationTelemetry(e){const{tutorialName:t,tutorialStepInfo:i,tutorialStep:n}=this.props.parent.state.tutorialOptions,r=i[n].listOfValidationRules;if(null!=r){const i={tutorial:t,step:n};for(let t=0;t<r.length;t++)if(r[t].ruleTurnOn){i.ruleName=r[t].ruleName;let n="tutorial.validation."+e+(r[t].ruleStatus?".pass":".fail");pxt.tickEvent(n,i)}}}renderCore(){const e=this.props.parent.state.tutorialOptions,{tutorialReady:t,tutorialStepInfo:i,tutorialStep:r,tutorialStepExpanded:o,metadata:a}=e;if(!t)return n.createElement("div",null);const l=i[r],u=!!pxt.appTarget.appTheme.lockedEditor,p=r,h=i.length,g=a&&a.hideIteration,b=t&&0!=p&&!g,v=t&&p!=h-1&&!g,y=!u&&p==h-1&&!g,k=this.hasHint(),x=l.headerContentMd,E=l.showDialog,C=null!=l.listOfValidationRules,S=this.isCodeValidated(l.listOfValidationRules),_=this.state.showTutorialValidationMessage&&C,T=this.areStrictRulesPresent(l.listOfValidationRules),A=!C||!T||S&&T?this.nextTutorialStep:this.state.showTutorialValidationMessage?this.doubleClickedNextStep:this.showTutorialValidationMessageOnClick,N=lf("Press Space or Enter to show a hint."),I=lf("Click to show a hint!");let O=this.hintOnClick;(pxt.BrowserUtils.isEdge()||pxt.BrowserUtils.isIE())&&this.state.showHint&&!E&&(O=null);const P=pxt.Util.isUserLanguageRtl();return n.createElement("div",{id:"tutorialcard",className:`ui ${o?"tutorialExpanded":""} ${t?"tutorialReady":""} ${this.state.showSeeMore?"seemore":""}  ${this.state.showHint?"":"showTooltip"} ${k?"hasHint":""}`,style:o?this.getExpandedCardStyle("height"):null},k&&this.state.showHint&&!E&&n.createElement("div",{className:"mask",role:"region",onClick:this.closeHint}),n.createElement("div",{className:"ui buttons"},b?n.createElement(s.Button,{icon:(P?"right":"left")+" chevron large",className:"prevbutton left attached "+(b?"":"disabled"),text:lf("Back"),textClass:"widedesktop only",ariaLabel:lf("Go to the previous step of the tutorial."),onClick:this.previousTutorialStep,onKeyDown:m.fireClickOnEnter}):void 0,n.createElement("div",{className:"ui segment attached tutorialsegment"},n.createElement("div",{ref:"tutorialmessage",className:"tutorialmessage",role:"alert"},n.createElement("div",{className:"content"},!E&&n.createElement(c.MarkedContent,{className:"no-select",tabIndex:0,markdown:x,parent:this.props.parent,onDidRender:this.onMarkdownDidRender}))),n.createElement("div",{className:"avatar-container"},!E&&k&&n.createElement(s.Button,{className:"ui circular label blue hintbutton hidelightbox "+(this.props.pokeUser?"shake flash":""),icon:"lightbulb","aria-label":N,title:I,onClick:O,onKeyDown:m.fireClickOnEnter}),!E&&k&&n.createElement(d.HintTooltip,{ref:"hinttooltip",pokeUser:this.props.pokeUser,text:I,onClick:O}),n.createElement(w,{ref:"tutorialhint",parent:this.props.parent})),this.state.showSeeMore&&!o&&n.createElement(s.Button,{className:"fluid compact lightgrey",icon:"chevron down",tabIndex:0,text:lf("More..."),onClick:this.toggleExpanded,onKeyDown:m.fireClickOnEnter}),this.state.showSeeMore&&o&&n.createElement(s.Button,{className:"fluid compact lightgrey",icon:"chevron up",tabIndex:0,text:lf("Less..."),onClick:this.toggleExpanded,onKeyDown:m.fireClickOnEnter})),v?n.createElement(s.Button,{icon:(P?"left":"right")+" chevron large",className:`nextbutton right attached ${v?"":"disabled"}  ${S?"isValidated":""}`,text:lf("Next"),textClass:"widedesktop only",ariaLabel:lf("Go to the next step of the tutorial."),onClick:A,onKeyDown:m.fireClickOnEnter}):void 0,_&&n.createElement(f.ShowValidationMessage,{onYesButtonClick:this.nextTutorialStep,onNoButtonClick:this.closeTutorialValidationMessage,initialVisible:this.state.showTutorialValidationMessage,isTutorialCodeInvalid:!S,ruleComponents:l.listOfValidationRules,areStrictRulesPresent:T,validationTelemetry:this.validationTelemetry,parent:this.props.parent}),y?n.createElement(s.Button,{icon:"left checkmark",className:"orange right attached "+(t?"":"disabled"),text:lf("Finish"),ariaLabel:lf("Finish the tutorial."),onClick:this.finishTutorial,onKeyDown:m.fireClickOnEnter}):void 0))}}i.TutorialCard=x;class E extends o.Component{constructor(e){super(e),this.flyoutWidth=0,this.flyoutTitle=lf("Toolbox"),this.workspaceWidth=0,this.handleResize=this.handleResize.bind(this),this.state={windowSize:window.innerWidth}}handleResize(){this.setState({windowSize:window.innerWidth})}componentDidMount(){window.addEventListener("resize",this.handleResize),window.addEventListener("wheel",this.handleResize),window.addEventListener("pointermove",this.handleResize)}componentWillUnmount(){window.removeEventListener("resize",this.handleResize),window.removeEventListener("wheel",this.handleResize),window.removeEventListener("pointermove",this.handleResize)}UNSAFE_componentWillUpdate(){const e=document.querySelector(".blocklyFlyout");e&&(this.flyoutWidth=e.getBoundingClientRect().width);const t=document.querySelector("#blocksArea");t&&(this.workspaceWidth=t.clientWidth-this.flyoutWidth-4)}headerStyle(){return{width:this.flyoutWidth}}workspaceStyle(){return{width:this.workspaceWidth}}renderCore(){return n.createElement("div",{id:"headers"},n.createElement("div",{id:"flyoutHeader",style:this.headerStyle()},n.createElement("div",{id:"flyoutHeaderTitle",className:"no-select"},this.flyoutTitle)),n.createElement("div",{id:"workspaceHeader",style:this.workspaceStyle()},n.createElement(p.SmallEditorToolbar,{parent:this.props.parent})))}}i.WorkspaceHeader=E},{"./compiler":30,"./core":78,"./data":81,"./editortoolbar":90,"./hinttooltip":103,"./immersivereader":107,"./marked":111,"./sounds":141,"./sui":143,"./tutorialCodeValidation":147,"./util":149,react:335,"react-dom":291}],147:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ShowValidationMessage=void 0;const n=e("react"),r=e("./data"),o=e("./sui"),s=e("./compiler"),a=e("./util");class l extends r.Component{constructor(e){super(e),this.renderedBlockCache={},this.state={visible:this.props.initialVisible,ruleBlocks:{}}}showTutorialValidationMessage(e){this.setState({visible:e})}moveOnToNextTutorialStep(){this.props.validationTelemetry("continue"),this.props.onYesButtonClick(),this.showTutorialValidationMessage(!1)}stayOnThisTutorialStep(){this.props.validationTelemetry("edit"),this.props.onNoButtonClick()}componentDidMount(){this.props.ruleComponents.forEach((e=>{var t,i;e.blockIds&&!(null===(i=null===(t=this.state.ruleBlocks)||void 0===t?void 0:t[e.ruleName])||void 0===i?void 0:i.length)&&this.getRuleBlocksAsync(e)}))}UNSAFE_componentWillReceiveProps(e,t){e.ruleComponents.forEach((e=>{var i,n,r,o,s;const a=this.props.ruleComponents.find((t=>t.ruleName==e.ruleName));(e.blockIds&&e.blockIds.sort().toString()!=(null===(n=null===(i=null==a?void 0:a.blockIds)||void 0===i?void 0:i.sort())||void 0===n?void 0:n.toString())||(null===(r=e.blockIds)||void 0===r?void 0:r.length)!=(null===(s=null===(o=t.ruleBlocks)||void 0===o?void 0:o[e.ruleName])||void 0===s?void 0:s.length))&&this.getRuleBlocksAsync(e)}))}renderRule(e,t){var i;const r=null===(i=this.state.ruleBlocks)||void 0===i?void 0:i[e.ruleName];return r?n.createElement("div",null,n.createElement("div",{className:"codeValidationPopUpText"},e.ruleTurnOn&&!e.ruleStatus?e.ruleMessage:""),n.createElement("div",{className:"validationRendering"},r.map(((e,t)=>n.createElement("div",null," ",n.createElement("img",{key:t+e,src:e,alt:"block rendered"})))))):n.createElement("p",{key:t+e.ruleName},e.ruleTurnOn&&!e.ruleStatus?e.ruleMessage:"")}getRuleBlocksAsync(e){e.blockIds&&s.getBlocksAsync().then((t=>Promise.all(e.blockIds.map((e=>{if(this.renderedBlockCache[e])return Promise.resolve(this.renderedBlockCache[e]);if(!t.blocksById[e])return Promise.resolve(void 0);const i=pxt.blocks.blockSymbol(e);if(i){const e=pxt.blocks.compileInfo(i),n=pxt.blocks.createToolboxBlock(t,i,e),r=pxt.blocks.render(`<xml xmlns="https://developers.google.com/blockly/xml">${n.outerHTML}</xml>`,{snippetMode:!0,splitSvg:!1}),o=r.getAttribute("viewBox").split(/\s+/).map((e=>parseInt(e)));return pxt.blocks.layout.blocklyToSvgAsync(r,o[0],o[1],o[2],o[3]).then((e=>e?pxt.BrowserUtils.encodeToPngAsync(e.xml,{width:e.width,height:e.height,pixelDensity:1}):Promise.resolve(void 0)))}return Promise.resolve(void 0)}))).then((t=>{this.setState({ruleBlocks:Object.assign(Object.assign({},this.state.ruleBlocks),{[e.ruleName]:t.filter((e=>!!e))})})}))))}renderCore(){const e=this.props.isTutorialCodeInvalid,t=this.props.ruleComponents,i=null!=t,r=this.props.areStrictRulesPresent;return n.createElement("div",null,this.state.visible&&n.createElement("div",{className:"mask",role:"region",onClick:this.props.onNoButtonClick}),n.createElement("div",{className:"tutorialCodeValidation no-select "+(!e||e&&!r?"hidden":"")},n.createElement("div",null,i&&t.map(((e,t)=>this.renderRule(e,t)))),n.createElement("div",{className:"codeValidationPopUpText"},lf("Do you still want to continue?")),n.createElement("div",{className:"moveOnButtons"},n.createElement(o.Button,{className:"yes",ariaLabel:lf("yes button for tutorial code validation"),onClick:this.moveOnToNextTutorialStep.bind(this),onKeyDown:a.fireClickOnEnter}," ",lf("Continue Anyway")," "),n.createElement(o.Button,{className:"no",ariaLabel:lf("no button for tutorial code validation"),onClick:this.stayOnThisTutorialStep.bind(this),onKeyDown:a.fireClickOnEnter}," ",lf("Keep Editing")," "))))}}i.ShowValidationMessage=l},{"./compiler":30,"./data":81,"./sui":143,"./util":149,react:335}],148:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ProfileDialog=void 0;const n=e("react"),r=e("./sui"),o=e("./core"),s=e("./auth"),a=e("./cloudsync"),l=e("../../react-common/components/profile/Profile"),c=e("../../react-common/components/util");class u extends s.Component{constructor(e){super(e),this.hide=()=>{this.setState({visible:!1})},this.handleTabClick=e=>{this.setState({location:e})},this.onLogoutClicked=()=>{pxt.tickEvent("pxt.profile.signout"),s.logoutAsync()},this.onDeleteProfileClicked=()=>{pxt.tickEvent("pxt.profile.delete"),this.deleteProfileAsync()},this.onEmailCheckClicked=e=>{this.setState({emailSelected:c.CheckboxStatus.Waiting}),s.setEmailPrefAsync(e).then((t=>{var i;t.success?(o.infoNotification(lf("Settings saved")),this.setState({emailSelected:(null===(i=t.res)||void 0===i?void 0:i.email)?c.CheckboxStatus.Selected:c.CheckboxStatus.Unselected})):(o.errorNotification(lf("Oops, something went wrong")),this.setState({emailSelected:e?c.CheckboxStatus.Unselected:c.CheckboxStatus.Selected}))}))},this.deleteProfileAsync=async()=>{this.getData(s.USER_PROFILE),await o.confirmAsync({header:lf("Delete Profile"),body:lf("Are you sure? This cannot be reversed! Your cloud-saved projects will be converted to local projects on this device."),agreeClass:"red",agreeIcon:"trash",agreeLbl:lf("Confirm"),disagreeLbl:lf("Back to safety"),disagreeIcon:"arrow right",confirmationCheckbox:lf("I understand this is permanent. No undo.")})&&(await s.deleteProfileAsync(),this.hide(),o.infoNotification(lf("Profile deleted!")))};const t=s.userPreferences();this.state={visible:e.visible,location:"my-stuff",emailSelected:(null==t?void 0:t.email)?c.CheckboxStatus.Selected:c.CheckboxStatus.Unselected},pxt.targetConfigAsync().then((e=>{this.setState({notification:e.profileNotification})}))}show(e){e=null!=e?e:"my-stuff",this.setState({visible:!0,location:e})}avatarPicUrl(){var e,t,i,n;const r=this.getUserProfile();return null!==(t=null===(e=null==r?void 0:r.idp)||void 0===e?void 0:e.pictureUrl)&&void 0!==t?t:null===(n=null===(i=null==r?void 0:r.idp)||void 0===i?void 0:i.picture)||void 0===n?void 0:n.dataUrl}renderCore(){var e;if(!this.isLoggedIn())return null;const t=this.getUserProfile(),i=this.getUserPreferences(),{emailSelected:s}=(a.githubProvider().user(),this.state);return n.createElement(r.Modal,{isOpen:this.state.visible,className:"ui profiledialog",size:"fullscreen",onClose:this.hide,dimmer:!0,closeIcon:!0,header:null===(e=null==t?void 0:t.idp)||void 0===e?void 0:e.displayName,closeOnDimmerClick:!1,closeOnDocumentClick:!1,closeOnEscape:!1},n.createElement(l.Profile,{user:{profile:t,preferences:i},signOut:this.onLogoutClicked,deleteProfile:this.onDeleteProfileClicked,notification:this.state.notification,showModalAsync:o.dialogAsync,onClickedEmail:this.onEmailCheckClicked,checkedEmail:s}))}}i.ProfileDialog=u},{"../../react-common/components/profile/Profile":10,"../../react-common/components/util":13,"./auth":20,"./cloudsync":27,"./core":78,"./sui":143,react:335}],149:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.fireClickOnEnter=void 0,i.fireClickOnEnter=function(e){const t="number"==typeof e.which?e.which:e.keyCode;13!==t&&32!==t||(e.preventDefault(),e.currentTarget.click())}},{}],150:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.renderUnpairDialog=i.webUsbPairLegacyDialogAsync=i.webUsbPairThemedDialogAsync=i.webUsbPairDialogAsync=void 0;const n=e("react"),r=e("./core");async function o(e,t){const i=l();if(!await function(e){const t=c().connectDeviceImage,i=l(),r=t?"two":"one";return s(e,(()=>n.createElement("div",{className:`ui ${r} column grid padded download-dialog`},n.createElement("div",{className:"column"},n.createElement("div",{className:"ui"},n.createElement("div",{className:"content"},n.createElement("div",{className:"description"},lf("First, make sure your {0} is connected to your computer with a USB cable.",i))))),t&&n.createElement("div",{className:"column"},n.createElement("div",{className:"ui"},n.createElement("div",{className:"image download-dialog-image"},n.createElement("img",{alt:lf("Image connecting {0} to a computer",i),className:"ui medium rounded image",src:t})))))),lf("Next"),lf("Connect your {0}",i),"downloaddialog.button.connectusb")}(t))return 0;if(!await function(e){const t=l();let i,r=c().webUSBDeviceNames;r&&r.length||(r=[t]),1===r.length||r.length>3?i=lf("Pair your {0} to the computer by selecting {1} from the popup that appears after you press the 'Next' button below.",t,"{1}"):2===r.length?i=lf("Pair your {0} to the computer by selecting {1} or {2} from the popup that appears after you press the 'Next' button below.",t,"{1}","{2}"):3===r.length&&(i=lf("Pair your {0} to the computer by selecting {1}, {2}, or {3} from the popup that appears after you press the 'Next' button below.",t,"{1}","{2}","{3}"));const o=i.split(/\{\d\}/),a=[];let u=r.map((e=>n.createElement("span",{className:"download-device-name"},"'",e,"'")));for(;u.length;)if(a.push(o.shift()),u.length>1&&1===o.length){for(let e=0;e<u.length;e++)a.push(u[e]),e<u.length-1&&a.push(", ");u=[]}else a.push(u.shift());a.push(...o);const d=c().selectDeviceImage,p=d?"two":"one";return s(e,(()=>n.createElement("div",{className:`ui ${p} column grid padded download-dialog`},n.createElement("div",{className:"column"},n.createElement("div",{className:"ui"},n.createElement("div",{className:"content"},n.createElement("div",{className:"description"},a)))),d&&n.createElement("div",{className:"column"},n.createElement("div",{className:"ui"},n.createElement("div",{className:"image download-dialog-image"},n.createElement("img",{alt:lf("Image selecting {0} from a list of web usb devices",t),className:"ui medium rounded image",src:d})))))),lf("Next"),lf("Connect your {0}",t),"downloaddialog.button.pickusbdevice")}(t))return 0;let a;r.showLoading("pair",lf('Select your {0} and press "Connect".',i));try{a=await e()}catch(e){r.errorNotification(lf("Pairing error: {0}",e.message)),a=!1}finally{r.hideLoading("pair")}return a?await function(e){const t=l(),i=c().connectionSuccessImage,r=i?"two":"one";return s(e,(()=>n.createElement("div",{className:`ui ${r} column grid padded download-dialog`},n.createElement("div",{className:"column"},n.createElement("div",{className:"ui"},n.createElement("div",{className:"content"},n.createElement("div",{className:"description"},lf("Your {0} is connected! Pressing 'Download' will now automatically copy your code to your {0}.",t),n.createElement("br",null),n.createElement("br",null),lf("If you need to unpair this {0}, you can do so through the '' menu next to the 'Download' button",t))))),i&&n.createElement("div",{className:"column"},n.createElement("div",{className:"ui"},n.createElement("div",{className:"image download-dialog-image"},n.createElement("img",{alt:lf("Image of {0}",t),className:"ui medium rounded image",src:i})))))),lf("Done"),lf("Connected to {0}",t),"downloaddialog.button.webusbsuccess",void 0,"large circle check purple")}(t):await function(e){const t=l();let i;i=c().minimumFirmwareVersion?lf("Make sure your {0} firmware is version {1} or above.",t,c().minimumFirmwareVersion):lf("Make sure your {0} has the latest firmware.",t);const r=c().checkUSBCableImage||c().connectDeviceImage,o=c().checkFirmwareVersionImage;return s(e,(()=>n.createElement("div",null,n.createElement("div",{className:"ui content download-troubleshoot-header"},lf("We couldn't find your {0}. Here's a few ways to fix that:",t)),n.createElement("div",{className:"download-troubleshoot"},n.createElement("div",{className:"download-column"},r&&n.createElement("div",{className:"download-row image-row"},n.createElement("img",{alt:lf("Image connecting {0} to a computer",t),src:r})),n.createElement("div",{className:"download-row"},lf("Check the USB cable connecting your {0} to your computer.",t))),n.createElement("div",{className:"download-column"},o&&n.createElement("div",{className:"download-row image-row"},n.createElement("img",{alt:lf("Image depicting the firmware of {0}",t),src:o})),n.createElement("div",{className:"download-row"},i,n.createElement("br",null),n.createElement("a",{target:"_blank",href:c().firmwareHelpURL,rel:"noopener noreferrer"},lf("Learn more about firmware.",t))))))),lf("Try Again"),lf("Connect failed"),"downloaddialog.button.webusbfailed",c().troubleshootWebUSBHelpURL,"exclamation triangle purple")}(t)&&await o(e,t),a?1:0}function s(e,t,i,n,o,s,a){let l=!1;return e({header:n,jsxd:t,hasCloseIcon:!0,hideAgree:!0,className:"downloaddialog",helpUrl:s,bigHelpButton:!!s,headerIcon:a?a+" header-inline-icon":void 0,buttons:[{label:i,className:"primary",onclick:()=>{pxt.tickEvent(o),r.hideDialog(),l=!0}}]}).then((()=>l))}function a(e,t){let i=!1;const o=pxt.appTarget.appTheme.boardName||lf("device"),s=pxt.appTarget.appTheme.usbDocs,a=()=>{var e,t;const r=i&&function(){var e,t,i;const n=null===(i=null===(t=null===(e=pxt.appTarget)||void 0===e?void 0:e.simulator)||void 0===t?void 0:t.boardDefinition)||void 0===i?void 0:i.id;if(n){const e=pxt.appTarget.bundledpkgs[n];if(e){const t=pxt.Package.parseAndValidConfig(e[pxt.CONFIG_NAME]);if(t)return t.firmwareUrl}}}();return(null===(e=pxt.commands)||void 0===e?void 0:e.renderUsbPairDialog)?null===(t=pxt.commands)||void 0===t?void 0:t.renderUsbPairDialog(r,i):n.createElement("div",{className:`ui ${r?"four":"three"} column grid stackable`},r&&n.createElement("div",{className:"column firmware"},n.createElement("div",{className:"ui"},n.createElement("div",{className:"content"},n.createElement("div",{className:"description"},lf("Update Firmware"),n.createElement("br",null),n.createElement("a",{href:r,target:"_blank",rel:"noopener noreferrer"},lf("Check your firmware version and update if needed")))))),n.createElement("div",{className:"column"},n.createElement("div",{className:"ui"},n.createElement("div",{className:"content"},n.createElement("div",{className:"description"},n.createElement("span",{className:"ui yellow circular label"},"1"),lf("Connect {0} to your computer with a USB cable",o),n.createElement("br",null))))),n.createElement("div",{className:"column"},n.createElement("div",{className:"ui"},n.createElement("div",{className:"content"},n.createElement("div",{className:"description"},n.createElement("span",{className:"ui blue circular label"},"2"),lf("Select the device in the pairing dialog"))))),n.createElement("div",{className:"column"},n.createElement("div",{className:"ui"},n.createElement("div",{className:"content"},n.createElement("div",{className:"description"},n.createElement("span",{className:"ui blue circular label"},"3"),lf('Press "Connect"'))))))};return new Promise(((n,o)=>{const c=l(),u=()=>({header:lf("Connect to your {0}",c),jsxd:a,hasCloseIcon:!0,hideAgree:!0,helpUrl:s,className:"downloaddialog",buttons:[{label:lf("Connect device"),icon:"usb",className:"primary",onclick:()=>{r.showLoading("pair",lf('Select your {0} and press "Connect".',c)),e().finally((()=>{r.hideLoading("pair"),r.hideDialog()})).then((e=>{e||i?n(e?1:0):(i=!0,r.forceUpdate(),t(u()))})).catch((e=>{pxt.reportException(e),r.errorNotification(lf("Pairing error: {0}",e.message)),n(0)}))}}]});t(u())}))}function l(){return pxt.appTarget.appTheme.boardName||lf("device")}function c(){return pxt.appTarget.appTheme.downloadDialogTheme||{}}i.webUsbPairDialogAsync=function(e,t){return pxt.appTarget.appTheme.downloadDialogTheme?o(e,t):a(e,t)},i.webUsbPairThemedDialogAsync=o,i.webUsbPairLegacyDialogAsync=a,i.renderUnpairDialog=function(){const e=l();return{header:lf("How to unpair your {0}",e),jsx:n.createElement("div",null,n.createElement("p",null,lf("You can unpair your {0} if the WebUSB download is malfunctioning. Click on the lock icon and uncheck your device.",e)),n.createElement("img",{className:"ui image centered medium",src:"./static/webusb/unpair.gif",alt:lf("A gif showing how to unpair the {0}",e)})),helpUrl:pxt.appTarget.appTheme.usbDocs&&pxt.appTarget.appTheme.usbDocs+"/webusb#unpair"}}},{"./core":78,react:335}],151:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.listAssetsAsync=i.saveAssetAsync=i.loadedAsync=i.resetAsync=i.syncAsync=i.installByIdAsync=i.downloadFilesByIdAsync=i.importGithubAsync=i.initializeGithubRepoAsync=i.prepareConfigForGithub=i.recomputeHeaderFlagsAsync=i.exportToGithubAsync=i.mergeUpstreamAsync=i.restoreCommitAsync=i.commitAsync=i.bumpAsync=i.bumpedVersion=i.prAsync=i.hasMergeConflictMarkersAsync=i.revertAllAsync=i.pullAsync=i.hasPullAsync=i.PullStatus=i.getPublishedScriptAsync=i.fixupFileNames=i.saveScreenshotAsync=i.createDuplicateName=i.duplicateAsync=i.installAsync=i.importAsync=i.saveAsync=i.partialSaveAsync=i.forceSaveAsync=i.anonymousPublishAsync=i.getTextAsync=i.initAsync=i.getLastCloudSync=i.getHeaderLastCloudSync=i.isHeaderSessionOutdated=i.acquireHeaderSession=i.computeSessionId=i.isHeadersSessionOutdated=i.getHeader=i.restoreFromBackupAsync=i.makeBackupAsync=i.getHeaders=i.setupWorkspace=i.copyProjectToLegacyEditor=i.gitsha=i.getWorkspaceType=void 0,i.dbgHdrToString=i.fireEvent=i.isBrowserWorkspace=void 0;const n=e("./db"),r=e("./core"),o=e("./data"),s=e("./browserworkspace"),a=e("./fileworkspace"),l=e("./memoryworkspace"),c=e("./iframeworkspace"),u=e("./cloudsync"),d=e("./idbworkspace"),p=e("./compiler"),h=e("./auth"),f=e("./cloud");var m=pxt.Util,g=pxt.Cloud;const b=e("crypto-js/sha1");let v,y,k=[],w=new m.PromiseQueue;function x(e){return k.find((t=>t.header.id==e||t.header.path==e))}function E(e,t="utf-8"){if("base64"==t){const t=atob(e);return b("blob "+t.length+"\0"+t)+""}return b("blob "+m.toUTF8(e).length+"\0"+e)+""}async function C(e){if(pxt.BrowserUtils.isWinRT())return;pxt.log(`workspace: error '${e}', switching from ${y} to memory workspace`);const t=pxt.appTarget.appTheme.disableMemoryWorkspaceWarning||v===l.provider||pxt.shell.isSandboxMode()||pxt.shell.isReadOnly()||pxt.BrowserUtils.isIFrame();pxt.tickEvent("workspace.syncerror",{ws:y,reason:e,expected:t?1:0}),t||await r.confirmAsync({header:lf("Warning! Project Auto-Save Disabled"),body:lf("We are unable to save your projects at this time. You can still manually save your project via direct download, or sharing your project."),agreeLbl:lf("Continue"),headerIcon:"warning",agreeClass:"cancel",agreeIcon:"cancel",helpUrl:"/browsers/no-auto-save",className:"auto-save-disabled-warning",hasCloseIcon:!0}),v=l.provider,y="mem"}function S(e=!1,t=!0){var i;N();const n=null===(i=h.userProfile())||void 0===i?void 0:i.id;let r=k.map((e=>e.header)).filter((t=>(e||!t.isDeleted)&&!t.isBackup&&(!t.cloudUserId||t.cloudUserId===n)));return t&&(r=r.filter((e=>!!e.isSkillmapProject===pxt.BrowserUtils.isSkillmapEditor()))),r.sort(((e,t)=>{const i=e.cloudUserId?Math.min(e.cloudLastSyncTime,e.modificationTime):e.modificationTime;return(t.cloudUserId?Math.min(t.cloudLastSyncTime,t.modificationTime):t.modificationTime)-i})),r}function _(e){N();let t=x(e);return t&&!t.header.isDeleted?t.header:null}i.getWorkspaceType=function(){return y},i.gitsha=E,i.copyProjectToLegacyEditor=function(e,t){return ce()?s.copyProjectToLegacyEditor(e,t):Promise.reject("Copy operation only works in browser workspace")},i.setupWorkspace=function(e){switch(m.assert(!v,"workspace set twice"),pxt.log(`workspace: ${e}`),y=null!=e?e:"browser",e){case"fs":case"file":v=a.provider;break;case"mem":case"memory":v=l.provider;break;case"iframe":v=c.provider;break;case"uwp":a.setApiAsync(pxt.winrt.workspace.fileApiAsync),v=pxt.winrt.workspace.getProvider(a.provider);break;case"idb":v=d.provider;break;case"browser":default:v=s.provider}},i.getHeaders=S,i.makeBackupAsync=function(e,t){let i=m.flatClone(e);return i.id=m.guidGen(),delete i._rev,delete i._id,i.isBackup=!0,F(i,t).then((()=>(e.backupRef=i.id,j(i)))).then((()=>i))},i.restoreFromBackupAsync=function(e){if(!e.backupRef||e.isDeleted)return Promise.resolve();const t=e.backupRef;return B(t).then((t=>(delete e.backupRef,j(e,t)))).then((()=>{const e=_(t);return e.isDeleted=!0,j(e)})).catch((()=>(delete e.backupRef,j(e))))},i.getHeader=_;let T="";function A(){return pxt.storage.getLocal("workspacesessionid")!=T}function N(){return A()?le().then((()=>{})):Promise.resolve()}function I(e){return e.length+" "+e.map((e=>e.modificationTime)).reduce(((e,t)=>Math.max(e,t)),0).toString()}function O(){T=I(k.map((e=>e.header))),A()&&(pxt.storage.setLocal("workspacesessionid",T),pxt.debug(`workspace: refreshed headers session to ${T}`),o.invalidate("header:*"),o.invalidate("text:*"))}i.isHeadersSessionOutdated=A,i.computeSessionId=I;const P=pxt.Util.guidGen();function D(e){e&&pxt.storage.removeLocal("workspaceheadersessionid:"+e.id)}function L(e){if(!e)return!1;const t=pxt.storage.getLocal("workspaceheadersessionid:"+e.id);return t&&t!=P}function R(e){L(e)&&(pxt.tickEvent("workspace.conflict.header"),r.errorNotification(lf("This project is already opened elsewhere.")),pxt.debug(`saved session ID: ${pxt.storage.getLocal("workspaceheadersessionid:"+e.id)}`),pxt.debug(`our session ID: ${P}`),pxt.Util.assert(!1,"trying to access outdated session"))}function M(e){return e.cloudLastSyncTime||0}function B(e){return N().then((()=>{let t=x(e);return t?t.text?Promise.resolve(t.text):w.enqueue(e,(()=>v.getAsync(t.header).then((e=>(t.text||(t.text=z(e.text)),t.version=e.version,t.text))))):Promise.resolve(null)}))}function j(e,t,i){return D(e),U(e,t,i)}async function U(e,t,i){var n;if(pxt.debug(`workspace.saveAsync ${pe(e)}`),e.isDeleted&&D(e),R(e),m.assert(e.target==pxt.appTarget.id),e.temporary)return Promise.resolve();let r=x(e.id);const s=!r;s&&(r={header:e,text:t,version:null},k.push(r));const a=!i&&!t,l=!i&&(e.isDeleted||t&&(()=>{if(s)return!0;const i=function(e,t){const i=e.header||{},n=t.header||{},r=e.text||{},o=t.text||{},s=m.unique([...Object.keys(i),...Object.keys(n)],(e=>e)).filter((e=>((e,t)=>JSON.stringify(e)!==JSON.stringify(t))(i[e],n[e]))),a=s.filter((e=>e in i&&!(e in n))).map((e=>({kind:"del",key:e,oldVal:i[e]}))),l=s.filter((e=>!(e in i)&&e in n)).map((e=>({kind:"add",key:e,newVal:n[e]}))),c=s.filter((e=>e in i&&e in n)).map((e=>({kind:"mod",key:e,oldVal:i[e],newVal:n[e]}))),u=m.unique([...Object.keys(r),...Object.keys(o)],(e=>e)).filter((e=>r[e]!==o[e]));return{header:[...a,...l,...c],files:[...u.filter((e=>e in r&&!(e in o)&&!!t.text)).map((e=>({kind:"del",key:e,oldVal:r[e].length}))),...u.filter((e=>!(e in r)&&e in o)).map((e=>({kind:"add",key:e,newVal:o[e].length}))),...u.filter((e=>e in r&&e in o)).map((e=>({kind:"mod",key:e,oldVal:r[e].length,newVal:o[e].length})))]}}(r,{header:e,text:t}),n=[J,pxt.SIMSTATE_JSON,pxt.SERIAL_EDITOR_FILE],o=["recentUse","modificationTime","cloudCurrent","_rev","_id","cloudVersion"],a={header:i.header.filter((e=>o.indexOf(e.key)<0)),files:i.files.filter((e=>n.indexOf(e.key)<0))},l=a.header.length>0||a.files.length>0;return l&&(pxt.debug("user changes:"),pxt.debug(function(e){const t=e=>"\t"+e,i=e=>`${e.kind} ${e.key}: (${e.oldVal||""}) => (${e.newVal||""})`;let n="";const r=e.header.filter((e=>"del"===e.kind)),o=e.header.filter((e=>"add"===e.kind)),s=e.header.filter((e=>"mod"===e.kind));n+=`HEADER (+${o.length}-${r.length}~${s.length})`,n+="\n",n+=e.header.map(i).map(t).join("\n"),n+="\n";const a=e.files.filter((e=>"del"===e.kind)),l=e.files.filter((e=>"add"===e.kind)),c=e.files.filter((e=>"mod"===e.kind));return n+=`FILES (+${l.length}-${a.length}~${c.length})`,n+="\n",n+=e.files.map(i).map(t).join("\n"),n+"\n"}(a))),l})());if((a||l)&&(e.pubCurrent=!1,e.cloudCurrent=!1,e.modificationTime=m.nowSeconds(),e.targetVersion=e.targetVersion||"0.0.0",h.hasIdentity()&&h.loggedIn()&&(e.cloudUserId=null===(n=h.userProfile())||void 0===n?void 0:n.id)),i||(e.recentUse=m.nowSeconds()),s||(Object.assign(r.header,e),Object.keys(r.header).filter((t=>void 0===e[t])).forEach((e=>delete r.header[e])),e=r.header),t&&(r.text=t),(t||e.isDeleted)&&(e.saveId=null),t&&pxt.appTarget.simulator&&pxt.appTarget.simulator.dynamicBoardDefinition){const i=pxt.Package.parseAndValidConfig(t[pxt.CONFIG_NAME]);i&&i.dependencies&&(e.board=Object.keys(i.dependencies).filter((e=>!!pxt.bundledSvg(e)))[0])}return w.enqueue(e.id,(async()=>{let i;await function(e){return void 0!==e.version?Promise.resolve():v.getAsync(e.header).then((t=>{e.version=t.version}))}(r);const n=t?r.text:null;try{i=await v.setAsync(e,r.version,n)}catch(t){await C("write failed"),i=await v.setAsync(e,t.version,n)}!i&&t&&pxt.debug("write rejected due to version conflict!"),t&&(r.version=i),l&&(e.pubCurrent=!1,e.cloudCurrent=!1,e.saveId=null),(t||e.isDeleted)&&(o.invalidate("text:"+e.id),o.invalidate("pkg-git-status:"+e.id)),o.invalidateHeader("header",e),s&&o.invalidate("headers:"),O()}))}function F(e,t,i=!1){return e.path=function(e){let t=e.name.replace(/[^a-zA-Z0-9]+/g," ").trim().replace(/ /g,"-");if(t||(t="Untitled"),x(t)){let e=2;for(;x(t+"-"+e);)e++;t+="-"+e}return t}(e),j(e,t,i)}function H(e,t,i=!1){m.assert(e.target==pxt.appTarget.id);const n=e;i||(n.id=ts.pxtc.Util.guidGen()),n.recentUse=m.nowSeconds(),n.modificationTime=n.recentUse;const r=pxt.Package.parseAndValidConfig(t[pxt.CONFIG_NAME]);return r&&r.preferredEditor&&(n.editor=r.preferredEditor,pxt.shell.setEditorLanguagePref(r.preferredEditor)),pxt.github.cacheProjectDependenciesAsync(r).then((()=>F(n,t))).then((()=>n))}function q(e){let t=e.name.indexOf("#")>-1?e.name.substring(0,e.name.lastIndexOf("#")).trim():e.name,i=m.toDictionary(k.filter((e=>!e.header.isDeleted)),(e=>e.header.name)),n=2;for(;i.hasOwnProperty(t+" #"+n);)n++;return t+" #"+n}function z(e){return e?(["kind.json","yelm.json"].forEach((t=>{!e[pxt.CONFIG_NAME]&&e[t]&&(e[pxt.CONFIG_NAME]=e[t],delete e[t])})),e):e}i.acquireHeaderSession=function(e){e&&pxt.storage.setLocal("workspaceheadersessionid:"+e.id,P)},i.isHeaderSessionOutdated=L,i.getHeaderLastCloudSync=M,i.getLastCloudSync=function(){var e;if(!h.loggedIn())return 0;const t=null===(e=h.userProfile())||void 0===e?void 0:e.id,i=S(!0).filter((e=>e.cloudUserId&&e.cloudUserId===t));return i.length?Math.min(...i.map(M)):0},i.initAsync=function(){return v||(v=s.provider,y="browser"),le().then((e=>function(){const e=k.map((e=>e.header)),t={};return e.filter((e=>e.backupRef)).forEach((e=>t[e.backupRef]=!0)),Promise.all(e.filter((e=>e.isBackup&&!t[e.id])).map((e=>(e.isDeleted=!0,j(e)))))}().then((()=>e)))).then((e=>(pxt.perf.recordMilestone("workspace init finished"),e)))},i.getTextAsync=B,i.anonymousPublishAsync=function(e,t,i,n){R(e);const r={};let o,s;if(e.saveId=r,n){const e=/^data:(image\/(png|gif));base64,([a-zA-Z0-9+/]+=*)$/.exec(n);e&&(o=e[3],s=e[1])}const a=JSON.stringify(t,null,2)+"\n",l={name:e.name,target:e.target,targetVersion:e.targetVersion,description:i.description||lf("Made with  in {0}.",pxt.appTarget.title||pxt.appTarget.name),editor:e.editor,text:t,meta:{versions:pxt.appTarget.versions,blocksHeight:i.blocksHeight,blocksWidth:i.blocksWidth},thumbnailBuffer:o,thumbnailMimeType:s};return pxt.debug(`publishing script; ${a.length} bytes`),g.privatePostAsync("scripts",l,!0).then((t=>(t.shortid&&(t.id=t.shortid),e.pubId=t.shortid,e.pubCurrent=e.saveId===r,e.meta=t.meta,pxt.debug(`published; id /${e.pubId}`),U(e).then((()=>t)))))},i.forceSaveAsync=j,i.partialSaveAsync=async function(e,t,i){const n=x(e);if(!n)return pxt.log("Failed to save to unknown project: "+e),void pxt.tickEvent("workspace.invalidSaveToUnknownProject");const r=Object.assign({},await B(e));return r[t]=i,U(n.header,r)},i.saveAsync=U,i.importAsync=F,i.installAsync=H,i.duplicateAsync=async function(e,t){const i=await B(e.id);t||(t=q(e));let n=m.flatClone(e);const r=m.flatClone(i);n.id=m.guidGen(),n.name=t;const o=JSON.parse(i[pxt.CONFIG_NAME]);return o.name=n.name,r[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(o),delete n._rev,delete n._id,delete n.githubCurrent,delete n.githubId,delete n.githubTag,n.cloudVersion&&pxt.tickEvent("identity.duplicatingCloudProject"),F(n=f.excludeLocalOnlyMetadataFields(n),r).then((()=>n))},i.createDuplicateName=q,i.saveScreenshotAsync=function(e,t,i){return R(e),v.saveScreenshotAsync?v.saveScreenshotAsync(e,t,i):Promise.resolve()},i.fixupFileNames=z;const G=new m.PromiseQueue,$=new n.Table("script");async function V(e){pxt.github.isGithubId(e)&&(e=pxt.github.normalizeRepoId(e));const t=await pxt.packagesConfigAsync(),i=encodeURIComponent(pxt.github.upgradedPackageId(t,e));return await G.enqueue(i,(async()=>{let n;try{n=(await $.getAsync(i)).files}catch(o){n=pxt.github.isGithubId(e)?(await pxt.github.downloadPackageAsync(e,t)).files:await g.downloadScriptFilesAsync(e).catch(r.handleNetworkError);try{await $.setAsync({id:i,files:n})}catch(e){pxt.log("Unable to cache script in DB")}}return z(n)}))}var W,K;i.getPublishedScriptAsync=V,(K=W=i.PullStatus||(i.PullStatus={}))[K.NoSourceControl=0]="NoSourceControl",K[K.UpToDate=1]="UpToDate",K[K.GotChanges=2]="GotChanges",K[K.NeedsCommit=3]="NeedsCommit",K[K.BranchNotFound=4]="BranchNotFound";const J=pxt.github.GIT_JSON;async function Y(e,t=!1){let i=await B(e.id);await re(e,i);let n=i[J];if(!n)return W.NoSourceControl;let r=JSON.parse(n),o=pxt.github.parseRepoId(r.repo);const s=o.tag,a=await pxt.github.getRefAsync(o.slug,s);if(!a){const e=await pxt.github.listRefsAsync(o.slug,"heads");return e&&e.length?W.BranchNotFound:W.NoSourceControl}if(a==r.commit.sha)return W.UpToDate;if(t)return W.GotChanges;try{return await ne(e,{repo:r.repo,sha:a,files:i,tryDiff3:!0}),W.GotChanges}catch(e){if(e.isMergeError)return W.NeedsCommit;throw e}}function X(e){let t=pxt.semver.parse(e.version,"0.0.0");return t.patch++,pxt.semver.stringify(t)}i.hasPullAsync=async function(e){return await Y(e,!0)==W.GotChanges},i.pullAsync=Y,i.revertAllAsync=async function(e){const t=(await B(e.id))[J];if(!t)return W.NoSourceControl;const i=JSON.parse(t),n=pxt.github.parseRepoId(e.githubId),r=i.commit,o=pxt.github.lookupFile(n,r,pxt.CONFIG_NAME),s=pxt.Package.parseAndValidConfig(o&&o.blobContent);if(!s)return W.NoSourceControl;const a={};a[J]=t,a[pxt.CONFIG_NAME]=o.blobContent;for(const e of s.files.concat(s.testFiles)){const t=pxt.github.lookupFile(n,r,e);if(!t||void 0===t.blobContent)return pxt.log(`cannot revert ${e}, corrupted based commit`),W.NoSourceControl;a[e]=t.blobContent}return await j(e,a),W.UpToDate},i.hasMergeConflictMarkersAsync=async function(e){const t=await B(e.id);return!!Object.keys(t).find((e=>pxt.diff.hasMergeConflictMarker(t[e])))},i.prAsync=async function(e,t,i){let n=pxt.github.parseRepoId(e.githubId);const r=await pxt.github.getNewBranchNameAsync(n.slug,"merge-");await pxt.github.createNewBranchAsync(n.slug,r,t);const o=await pxt.github.createPRFromBranchAsync(n.slug,n.tag,r,i);let s=await pxt.github.getRefAsync(n.slug,n.tag);return await ne(e,{repo:e.githubId,sha:s,files:{}}),o},i.bumpedVersion=X,i.bumpAsync=async function(e,t=""){R(e);const i=await B(e.id),n=pxt.Package.parseAndValidConfig(i[pxt.CONFIG_NAME]);n.version=t||X(n);const r="v"+n.version;if(n.dependencies){const t=pxt.github.parseRepoId(e.githubId);Object.keys(n.dependencies).forEach((e=>{const i=n.dependencies[e],r=/^github:/.test(i)&&pxt.github.parseRepoId(i);r&&t.slug===r.slug&&(n.dependencies[e]=`github:${pxt.github.join(t.slug,r.fileName)}`,pxt.debug(`patching dep ${e} to ${n.dependencies[e]}`))}))}return i[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(n),await U(e,i),await te(e,{message:n.version,createRelease:r,binaryJs:!0})};const Q=".github/makecode/blocksdiff.png",Z="assets/js/binary.js",ee="assets/version.txt";async function te(e,t={}){await u.ensureGitHubTokenAsync();let i=await B(e.id),n=i[J];n||m.userError(lf("Not a git extension."));let r=JSON.parse(n),s=pxt.github.parseRepoId(r.repo),a=pxt.Package.parseAndValidConfig(i[pxt.CONFIG_NAME]),l={base_tree:r.commit.tree.sha,tree:[]};const c=t.filenamesToCommit||pxt.allPkgFiles(a),d=[J,pxt.SIMSTATE_JSON,pxt.SERIAL_EDITOR_FILE];for(const e of c.filter((e=>d.indexOf(e)<0))){const t=i[e];await y(e,t)}let h;if(0==l.tree.length&&m.userError(lf("Nothing to commit!")),t&&l.tree.find((e=>e.path==pxt.MAIN_BLOCKS))){if(t.blocksScreenshotAsync){const e=await t.blocksScreenshotAsync();e&&await y(".github/makecode/blocks.png",e)}if(t.blocksDiffScreenshotAsync){const e=await t.blocksDiffScreenshotAsync();e&&(h=await y(Q,e))}}if(pxt.appTarget.appTheme.githubCompiledJs&&t.binaryJs&&(!s.tag||"master"==s.tag)){const e=a.version||"0.0.0",t={jsMetaVersion:e},i=await p.compileAsync(t);if(i&&i.success&&i.outfiles[pxtc.BINARY_JS]&&(await y(Z,i.outfiles[pxtc.BINARY_JS]),await y(ee,e),!a.disableTargetTemplateFiles)){const e=pxt.template.targetTemplateFiles();if(e)for(const t of Object.keys(e))await y(t,e[t])}}let f=await pxt.github.createObjectAsync(s.slug,"tree",l),g={message:t.message||lf("Update {0}",l.tree.map((e=>e.path)).filter((e=>!/\.github\/makecode\//.test(e))).join(", ")),parents:[r.commit.sha],tree:f};r.mergeSha&&g.parents.push(r.mergeSha);let b=await pxt.github.createObjectAsync(s.slug,"commit",g),v=b;return await pxt.github.fastForwardAsync(s.slug,s.tag,b)||(v=await pxt.github.mergeAsync(s.slug,s.tag,b)),null==v?b:(o.invalidate("gh-commits:*"),h&&await pxt.github.postCommitComment(s.slug,b,`![${lf("Difference between blocks")}](https://raw.githubusercontent.com/${pxt.github.join(s.slug,b,s.fileName,Q)}`),await ne(e,{repo:r.repo,sha:v,files:i,saveTag:t.createRelease}),t.createRelease&&(await pxt.github.createReleaseAsync(s.slug,t.createRelease,v),await pxt.github.enablePagesAsync(s.slug),await pxt.github.listRefsAsync(s.slug,"tags",!0,!0)),"");async function y(e,i){const n={content:i,encoding:"utf-8"};e==pxt.CONFIG_NAME&&(n.content=oe(n.content,!!t.createRelease));const o=/^data:([^;]+);base64,/.exec(i);o&&(n.encoding="base64",n.content=i.substr(o[0].length));const a=E(n.content,n.encoding),c=pxt.github.lookupFile(s,r.commit,e);let u;if(!c||c.sha!=a){if("utf-8"==n.encoding&&pxt.diff.hasMergeConflictMarker(n.content))throw function(){const e=new Error("Merge conflict marker error");return e.isMergeConflictMarkerError=!0,e}();u=await pxt.github.createObjectAsync(s.slug,"blob",n),"utf-8"==n.encoding&&m.assert(u==a,`sha not matching ${u} != ${a}`);const t=pxt.github.join(s.fileName,e);l.tree.push({path:t,mode:"100644",type:"blob",sha:u,url:void 0})}return u}}function ie(){const e=new Error("Merge error");return e.isMergeError=!0,e}async function ne(e,t){var i;const{repo:n,sha:r,files:o,justJSON:s}=t,a=pxt.github.parseRepoId(n),l=await pxt.github.getCommitAsync(a.slug,r);let c=JSON.parse(o[J]||"{}");c.commit||(c={repo:n,commit:null});const u={};let d=0,p=!1;const h=async e=>{u[e]=!0;const i=pxt.github.lookupFile(a,l,e),n=pxt.github.lookupFile(a,c.commit,e),h=null!=o[e]&&(!n||n.blobContent!=o[e]);if(!i)return t.tryDiff3&&h?o[e]:(s||(o[e]=""),"");let f=n?n.blobContent:o[e];if(null!=f&&E(f)==i.sha)return i.blobContent=f,t.tryDiff3||t.justJSON||(o[e]=f),f;if(f=await pxt.github.downloadTextAsync(a.fullName,r,e),i.blobContent=f,E(f)!=i.sha&&E(`\ufeff${f}`)!==i.sha&&m.userError(lf("Corrupt SHA1 on download of '{0}'.",e)),t.tryDiff3&&h)if(e==pxt.CONFIG_NAME){if(!(f=pxt.diff.mergeDiff3Config(o[e],n.blobContent,i.blobContent)))throw ie()}else if(/\.blocks$/.test(e)){const t=pxt.blocks.mergeXml(o[e],n.blobContent,i.blobContent);p=p||!t,f=t||""}else if(e==Z||e==ee||e==pxt.TUTORIAL_INFO_FILE||e==pxt.ASSETS_FILE)f=o[e];else{const t=pxt.diff.diff3(o[e],n.blobContent,i.blobContent,lf("local changes"),lf("remote changes (pulled from Github)"));if(!t)throw ie();if(d+=t.numConflicts,t.numConflicts&&!/\.ts$/.test(e))throw ie();f=t.merged}return s||(o[e]=f),f},f=pxt.Package.parseAndValidConfig(o[pxt.CONFIG_NAME]),g=await h(pxt.CONFIG_NAME);let b=pxt.Package.parseAndValidConfig(g);if(b||(e&&m.userError(lf("Invalid pxt.json file.")),pxt.debug("github: reconstructing pxt.json"),b=pxt.diff.reconstructConfig(a,o,l,pxt.appTarget.blocksprj||pxt.appTarget.tsprj),o[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(b)),f){let e=0;Object.keys(b.dependencies).filter((e=>/^github:/.test(b.dependencies[e])&&f.dependencies[e])).forEach((t=>{if(pxt.github.parseRepoId(b.dependencies[t])){const i=f.dependencies[t];b.dependencies[t]=i,e++}})),e&&(o[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(b))}for(const e of pxt.allPkgFiles(b).slice(1))await h(e);if(b.name||(b.name=(a.fileName||a.project||a.fullName).replace(/[^\w\-]/g,""),s||(o[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(b))),!s){if(p&&d)throw ie();for(let e of Object.keys(o))"."==e[0]||u[e]||delete o[e]}l.tag=t.saveTag,c.mergeSha=void 0,c.commit=l,o[J]=JSON.stringify(c,null,4);const v=(null===(i=b.targetVersions)||void 0===i?void 0:i.targetId)===pxt.appTarget.id&&b.targetVersions.target?b.targetVersions.target:pxt.appTarget.versions.target;return e?(e.name=b.name,await j(e,o)):e=await H({name:b.name,githubId:n,pubId:"",pubCurrent:!1,meta:{},editor:pxt.BLOCKS_PROJECT_NAME,target:pxt.appTarget.id,targetVersion:v},o),e}async function re(e,t){R(e),e.githubCurrent=!1;const i=JSON.parse(t[J]||"{}");if(e.githubId=i&&i.repo,e.githubTag=i&&i.commit&&i.commit.tag,!e.githubId)return;if(!i.commit||!i.commit.tree)return;const n=pxt.github.parseRepoId(e.githubId);let r=!0,o=!1;for(let e of Object.keys(t)){if(e==J||e==pxt.SIMSTATE_JSON||e==pxt.SERIAL_EDITOR_FILE)continue;let s=pxt.github.lookupFile(n,i.commit,e);if(!s||"blob"!=s.type){r=!1;continue}null==s.blobContent&&(o=!0);let a=t[e];e==pxt.CONFIG_NAME&&(a=oe(a)),a&&s.sha!=E(a)&&(r=!1)}if(e.githubCurrent=r,o&&await ne(e,{repo:i.repo,sha:i.commit.sha,files:t,justJSON:!0}),null==i.isFork){const n=pxt.github.parseRepoId(i.repo),r=await pxt.github.repoAsync(n.fullName,null);r&&(i.isFork=!!r.fork,t[J]=JSON.stringify(i,null,4),await U(e,t))}}function oe(e,t){const i=pxt.Package.parseAndValidConfig(e);if(!i)return e;delete i.installedVersion,delete i.additionalFilePath,delete i.additionalFilePaths;const n=i.supportedTargets||[];n.indexOf(pxt.appTarget.id)<0&&(n.push(pxt.appTarget.id),n.sort(),i.supportedTargets=n),i.targetVersions=Object.assign(Object.assign({},i.targetVersions),{target:pxt.appTarget.versions.target,targetId:pxt.appTarget.id});const r=Object.keys(i.dependencies).filter((e=>/^(file|workspace):/.test(i.dependencies[e])));for(const e of r)o(e);return pxt.Package.stringifyConfig(i);function o(e){const n=i.dependencies[e],r=_(n.substring(n.indexOf(":")+1));if(r)if(r.githubId){const n=pxt.github.parseRepoId(r.githubId);t&&!/^v\d+/.test(r.githubTag)&&m.userError(lf("You need to create a release for dependency {0}.",e));const o=r.githubTag||n.tag;i.dependencies[e]=`github:${n.fullName}#${o}`}else t&&m.userError(lf("Dependency {0} is a local project.",e))}}async function se(e,t,i,n){await u.ensureGitHubTokenAsync();let r=pxt.github.parseRepoId(t),o=r.fullName.replace(/.*\//,""),s=await B(e.id);const a=pxt.template.packageFiles(o);if(pxt.template.packageFilesFixup(a,{repo:r.fullName,repoowner:r.owner,reponame:r.project,repotag:r.tag}),i)m.jsonMergeFrom(s,a);else{pxt.Package.parseAndValidConfig(s[pxt.CONFIG_NAME])||delete s[pxt.CONFIG_NAME];let e=a[pxt.README_FILE];const t=s[pxt.README_FILE];(e||t)&&(e=[t,e].filter((e=>!!e)).join("\n\n")),m.jsonMergeFrom(a,s),s=a,e&&(s[pxt.README_FILE]=e)}const l=pxt.Package.parseAndValidConfig(s[pxt.CONFIG_NAME]),c=l.files;c.filter((e=>/\.ts$/.test(e))).length||Object.keys(s).filter((e=>/\.(blocks|ts|py|asm|md|json)$/.test(e))).filter((e=>e!=pxt.CONFIG_NAME)).forEach((e=>c.push(e)));const d=l.testFiles||(l.testFiles=[]);s["test.ts"]&&d.indexOf("test.ts")<0&&d.push("test.ts"),s[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(l),await j(e,s),await te(e,{message:lf("Initial files for MakeCode project"),filenamesToCommit:Object.keys(s),binaryJs:n}),s=await B(e.id);const p=pxt.allPkgFiles(pxt.Package.parseAndValidConfig(s[pxt.CONFIG_NAME])),h=[J,pxt.SIMSTATE_JSON,pxt.SERIAL_EDITOR_FILE,pxt.CONFIG_NAME];Object.keys(s).filter((e=>h.indexOf(e)<0&&p.indexOf(e)<0)).forEach((e=>delete s[e])),await U(e,s);try{await pxt.github.enablePagesAsync(r.slug)}catch(e){pxt.reportException(e)}return e}let ae;function le(){return pxt.debug("workspace: sync"),ae||(ae=v.listAsync().catch((e=>C("sync failed").then((()=>v.listAsync())))).then((e=>{const t=m.toDictionary(k||[],(e=>e.header.id));k=e.map((e=>{let i=t[e.id];return i?JSON.stringify(i.header)!==JSON.stringify(e)&&(m.jsonCopyFrom(i.header,e),i.text=void 0,i.version=void 0,o.invalidateHeader("header",e),o.invalidateHeader("text",e),o.invalidateHeader("pkg-git-status",e),o.invalidate("gh-commits:*")):i={header:e,text:void 0,version:void 0},i})),u.syncAsync()})).then((()=>(O(),v.getSyncState?v.getSyncState():null))).finally((()=>{ae=void 0})))}function ce(){return v===s.provider}i.commitAsync=te,i.restoreCommitAsync=async function(e,t){await u.ensureGitHubTokenAsync();const i=await B(e.id),n=i[J],r=JSON.parse(n),o=pxt.github.parseRepoId(r.repo),s=new Date(Date.parse(t.committer.date)),a={message:lf("Restore '{0} {1}'",s.toLocaleString(),t.message),parents:[r.commit.sha],tree:t.tree.sha},l=await pxt.github.createObjectAsync(o.slug,"commit",a);await pxt.github.fastForwardAsync(o.slug,o.tag,l),await ne(e,{repo:r.repo,sha:l,files:i})},i.mergeUpstreamAsync=async function(e,t){return Promise.resolve()},i.exportToGithubAsync=async function(e,t){const i=pxt.github.parseRepoId(t),n=pxt.template.packageFiles(e.name);await pxt.github.putFileAsync(i.fullName,".gitignore",n[".gitignore"]);const r=await pxt.github.getRefAsync(i.slug,i.tag),o=await pxt.github.getCommitAsync(i.slug,r),s=await B(e.id);s[J]=JSON.stringify({repo:t,commit:o});const a=s[pxt.MAIN_BLOCKS];if(a){const e=pxt.blocks.loadWorkspaceXml(a,!0);if(e){const t=pxt.blocks.saveWorkspaceXml(e,!0);t&&(s[pxt.MAIN_BLOCKS]=t)}}await j(e,s),await se(e,t,!1,!0)},i.recomputeHeaderFlagsAsync=re,i.prepareConfigForGithub=oe,i.initializeGithubRepoAsync=se,i.importGithubAsync=async function(e){const t=pxt.github.normalizeRepoId(e).replace(/^github:/,""),i=pxt.github.parseRepoId(t);let n="",o=!1,s=!1;try{n=await pxt.github.getRefAsync(i.slug,i.tag);const e=await pxt.github.getCommitAsync(i.slug,n),t=pxt.github.join(i.fileName,pxt.CONFIG_NAME);if(!e.tree.tree.find((e=>e.path==t))&&(pxt.debug("github: detected import non-makecode project"),pxt.shell.isReadOnly()&&m.userError(lf("This repository looks empty.")),o=!0,s=!1,!await r.confirmAsync({header:i.fileName?lf("Add a nested extension to existing GitHub repository?"):lf("Initialize GitHub repository for MakeCode?"),body:i.fileName?lf("We need to add a few files under the /{0} folder to your GitHub repository https://github.com/{1} to create the nested extension.",i.fileName,i.slug):lf("We need to add a few files to your GitHub repository https://github.com/{0} to make it work with MakeCode.",i.fullName),agreeLbl:lf("Ok"),hasCloseIcon:!0,helpUrl:"/github/import"})))return Promise.resolve(void 0)}catch(e){409==e.statusCode?(pxt.debug("github: detected import empty project"),pxt.shell.isReadOnly()&&m.userError(lf("This repository looks empty.")),await u.ensureGitHubTokenAsync(),await pxt.github.putFileAsync(i.fullName,".gitignore","# Initial\n"),o=!0,s=!0,n=await pxt.github.getRefAsync(i.slug,i.tag)):404==e.statusCode&&(r.errorNotification(lf("Sorry, that repository looks invalid.")),m.userError(lf("No such repository or branch.")))}const a=await ne(null,{repo:t,sha:n,files:{}});return a&&o&&await se(a,t,s,!1),a},i.downloadFilesByIdAsync=function(e){return g.privateGetAsync(e,!0).then((e=>V(e.id)))},i.installByIdAsync=function(e){return g.privateGetAsync(e,!0).then((t=>V(t.id).then((i=>H({name:t.name,pubId:e,pubCurrent:!0,meta:t.meta,editor:t.editor,target:t.target,targetVersion:t.targetVersion||t.meta&&t.meta.versions&&t.meta.versions.target},i)))))},i.syncAsync=le,i.resetAsync=function(){return k=[],v.resetAsync().then(u.resetAsync).then(n.destroyAsync).then(pxt.BrowserUtils.clearTranslationDbAsync).then(pxt.BrowserUtils.clearTutorialInfoDbAsync).then(p.clearApiInfoDbAsync).then((()=>{pxt.storage.clearLocal(),o.clearCache(),g.localToken&&pxt.storage.setLocal("local_token",g.localToken)})).then((()=>le())).then((()=>{}))},i.loadedAsync=function(){return v.loadedAsync?v.loadedAsync():Promise.resolve()},i.saveAssetAsync=function(e,t,i){return v.saveAssetAsync?v.saveAssetAsync(e,t,i):Promise.reject(new Error(lf("Assets not supported here.")))},i.listAssetsAsync=function(e){return v.listAssetsAsync?v.listAssetsAsync(e):Promise.resolve([])},i.isBrowserWorkspace=ce,i.fireEvent=function(e){if(v.fireEvent)return v.fireEvent(e)};const ue={};let de=1;function pe(e){return e?`${e.name} ${e.id.substr(0,4)}..v${function(e){return e?(ue[e]||(ue[e]="#"+de,de+=1),ue[e]):"#0"}(e.cloudVersion)}@${e.modificationTime%100}-${m.timeSince(e.modificationTime)}`:"#null"}i.dbgHdrToString=pe,o.mountVirtualApi("header",{getSync:e=>"*"==(e=o.stripProtocol(e))?S():_(e)}),o.mountVirtualApi("headers",{getAsync:e=>{e=o.stripProtocol(e);const t=S();return e?p.projectSearchAsync({term:e,headers:t}).then((e=>e)).then((e=>{let i=m.toDictionary(e||[],(e=>e.id));return t.filter((e=>i[e.id]))})):Promise.resolve(t)},expirationTime:e=>5e3,onInvalidated:()=>{p.projectSearchClear()}}),o.mountVirtualApi("text",{getAsync:e=>{const t=/^[\w\-]+:([^\/]+)(\/(.*))?/.exec(e);return B(t[1]).then((e=>t[3]?e[t[3]]:e))}})},{"./auth":20,"./browserworkspace":24,"./cloud":26,"./cloudsync":27,"./compiler":30,"./core":78,"./data":81,"./db":82,"./fileworkspace":96,"./idbworkspace":104,"./iframeworkspace":106,"./memoryworkspace":112,"crypto-js/sha1":172}],152:[function(e,t,i){t.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},t.exports.__esModule=!0,t.exports.default=t.exports},{}],153:[function(e,t,i){function n(){return t.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},t.exports.__esModule=!0,t.exports.default=t.exports,n.apply(this,arguments)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},{}],154:[function(e,t,i){var n=e("./setPrototypeOf.js");t.exports=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n(e,t)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./setPrototypeOf.js":158}],155:[function(e,t,i){t.exports=function(e){return e&&e.__esModule?e:{default:e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],156:[function(e,t,i){var n=e("./typeof.js").default;function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(r=function(e){return e?i:t})(e)}t.exports=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var i=r(t);if(i&&i.has(e))return i.get(e);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var l=s?Object.getOwnPropertyDescriptor(e,a):null;l&&(l.get||l.set)?Object.defineProperty(o,a,l):o[a]=e[a]}return o.default=e,i&&i.set(e,o),o},t.exports.__esModule=!0,t.exports.default=t.exports},{"./typeof.js":159}],157:[function(e,t,i){t.exports=function(e,t){if(null==e)return{};var i,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)i=o[n],t.indexOf(i)>=0||(r[i]=e[i]);return r},t.exports.__esModule=!0,t.exports.default=t.exports},{}],158:[function(e,t,i){function n(e,i){return t.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t.exports.__esModule=!0,t.exports.default=t.exports,n(e,i)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},{}],159:[function(e,t,i){function n(e){return t.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},{}],160:[function(e,t,i){var n,r;n=window,r=function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CookiePolicy=void 0,function(e){e[e.Disable=0]="Disable",e[e.Enable=1]="Enable"}(t.CookiePolicy||(t.CookiePolicy={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CookiePolicy=t.launchAsync=t.close=t.renderButtons=void 0;var n=i(2);Object.defineProperty(t,"renderButtons",{enumerable:!0,get:function(){return n.renderButtons}});var r=i(3);Object.defineProperty(t,"close",{enumerable:!0,get:function(){return r.close}}),Object.defineProperty(t,"launchAsync",{enumerable:!0,get:function(){return r.launchAsync}});var o=i(0);Object.defineProperty(t,"CookiePolicy",{enumerable:!0,get:function(){return o.CookiePolicy}}),"undefined"!=typeof window&&window.addEventListener("load",(function(){var e;window.hasOwnProperty("Promise")||((e=document.createElement("script")).src="https://contentstorage.onenote.office.net/onenoteltir/permanent-static-resources/promise-polyfill.min.js",document.head.appendChild(e)),n.renderButtons()}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderButtons=void 0;var n={af:"Indompelende leser",am:"    ",ar:" ",as:" ",az:"mmersiv Oxuyucu",be:" ",bg:" ",bn:" ","bn-bd":" ",bs:"Koncentrirani italac",ca:"Lector immersiu",cs:"Asistivn teka","cy-gb":"Darllenydd Ymdrwythol",da:"Forenklet lser",de:"Plastischer Reader",el:"  ",en:"Immersive Reader",es:"Lector inmersivo",et:"Svaluger",eu:"Irakurgailu murgiltzailea",fa:" ",fi:"Syventv lukuohjelma",fil:"Immersive Reader",fr:"Lecteur immersif","ga-ie":"Litheoir tumthach",gd:"An leughadair r-nsach",gl:"Lector avanzado",gu:" ",ha:"Mai karatu Mai barbazawa",he:"  ",hi:" ",hr:"Stopljeni ita",hu:"Modern olvas",hy:" ",id:"Pembaca Imersif",ig:"g Kenziptara",is:"Agengilegt lestrarumhverfi",it:"Strumento di lettura immersiva",ja:" ",ka:" ",kk:"  ",km:"",kn:" ",ko:" ",kok:"  ","ku-arab":" ",ky:" ",lb:"Immersive Reader",lo:"",lt:"traukianti skaitytuv",lv:"Trskata lastjs",mi:"Ppnui Rumaki",mk:" ",ml:" ",mn:" ",mr:" ",ms:"Pembaca Imersif",mt:"Qarrej Immersiv",ne:" ",nl:"Insluitende lezer","nn-no":"Engasjerande lesar",no:"Engasjerende leser",nso:"Go Bala ka Mongwalo o Mokoto",or:" ",pa:" ","pa-arab":"   ",pl:"Czytnik immersyjny",prs:" ",pt:"Leitura Avanada",quc:"Nim ucholajil sik'inel uwach",quz:"Wankisqa awiq",ro:"Immersive Reader",ru:"  ",rw:"Insakazasoma",sd:" ",si:"  ",sk:"Imerzn taka",sl:"Potopni bralnik",sq:"Lexuesi kredhs","sr-cyrl-ba":" ","sr-cyrl-rs":" ","sr-latn-rs":"Koncentrisani italac",sv:"Avancerad lsare",sw:"Kisomaji cha Kuzamisha",ta:" ",te:"   ","tg-cyrl-tj":" ",th:"",ti:"   ",tk:"Giilein okajy",tn:"Sebadi sa Imesife",tr:"Tam Ekran Okuyucu",tt:"   ","ug-cn":" ",uk:"  ",ur:"  ",uz:"Immersiv mutolaa vositasi",vi:"Trnh c Chn thc",wo:"Jngukaay bu Rafet",xh:"Isifundi Esikhulu",yo:"w Almtn",zh:"","zh-hant":"",zu:"Isifundi Sokuzizwisa"};function r(e){var t=document.createElement("img");t.src="https://contentstorage.onenote.office.net/onenoteltir/permanent-static-resources/immersive-reader-icon.svg";var i=e.getAttribute("data-icon-px-size")||"20";t.style.height=t.style.width=i+"px",t.style.verticalAlign="middle",t.style.marginTop="-2px";var n=e.getAttribute("data-locale")||"en";t.alt=a(n),e.appendChild(t)}function o(e){var t=document.createElement("span");t.style.marginLeft="8px",e.appendChild(t)}function s(e){var t=document.createElement("span"),i=e.getAttribute("data-locale")||"en";t.textContent=a(i),e.appendChild(t)}function a(e){return e=e.toLowerCase(),n[e]?n[e]:"zh-hk"===e||"zh-mo"===e||"zh-tw"===e?n["zh-hant"]:(e=e.substring(0,e.lastIndexOf("-")),n[e]?n[e]:(e=e.substring(0,e.lastIndexOf("-")),n[e]?n[e]:n.en))}t.renderButtons=function(e){var t=document.createElement("style");t.innerHTML=".immersive-reader-button{cursor:pointer;display:inline-block;padding:5px;} .immersive-reader-button:hover{background:rgba(0,0,0,.05);border-radius:2px",document.head.appendChild(t);var i=[].slice.call(document.getElementsByClassName("immersive-reader-button"));e&&e.elements&&(i=e.elements);for(var n=0,l=i;n<l.length;n++){var c=l[n];c.setAttribute("role","button");var u=c.getAttribute("data-locale")||"en";switch(c.setAttribute("aria-label",a(u)),c.getAttribute("data-button-style")||"icon"){case"icon":r(c);break;case"text":s(c);break;case"iconAndText":r(c),o(c),s(c)}}}},function(e,t,i){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.isValidSubdomain=t.close=t.launchAsync=void 0;var r=i(0),o=i(4),s={};s[o.ErrorCode.TokenExpired]="The access token supplied is expired.",s[o.ErrorCode.Throttled]="You have exceeded your quota.",s[o.ErrorCode.ServerError]="An error occurred when calling the server to process the text.",s[o.ErrorCode.InvalidSubdomain]="The subdomain supplied is invalid.";var a=!1;function l(e){return!!e&&new RegExp("^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9])$").test(e)}t.launchAsync=function(e,t,i,c){return a?Promise.reject("Immersive Reader is already launching"):new Promise((function(u,d){if(e)if(i)if(i.chunks)if(i.chunks.length)if(l(t)||c&&c.customDomain){a=!0;var p=Date.now();(c=n({uiZIndex:1e3,timeout:15e3,useWebview:!1,allowFullscreen:!0,hideExitButton:!1,cookiePolicy:r.CookiePolicy.Disable},c)).uiZIndex&&"number"==typeof c.uiZIndex||(c.uiZIndex=1e3);var h=null,f=document.createElement("div"),m=c.useWebview?document.createElement("webview"):document.createElement("iframe");m.allow="autoplay";var g=document.createElement("style");g.innerHTML="body{height:100%;overflow:hidden;}";var b=function(){h&&(window.clearTimeout(h),h=null)},v=function(){document.body.contains(f)&&document.body.removeChild(f),window.removeEventListener("message",k),b(),g.parentNode&&g.parentNode.removeChild(g)},y=function(){if(v(),c.onExit)try{c.onExit()}catch(e){}};v();var k=function(n){if(n&&n.data&&"string"==typeof n.data)if("ImmersiveReader-ReadyForContent"===n.data){b();var r={cogSvcsAccessToken:e,cogSvcsSubdomain:t,request:i,launchToPostMessageSentDurationInMs:Date.now()-p,disableFirstRun:c.disableFirstRun,readAloudOptions:c.readAloudOptions,translationOptions:c.translationOptions,displayOptions:c.displayOptions,sendPreferences:!!c.onPreferencesChanged,preferences:c.preferences};m.contentWindow.postMessage(JSON.stringify({messageType:"Content",messageValue:r}),"*")}else if("ImmersiveReader-Exit"===n.data)y();else if(n.data.startsWith("ImmersiveReader-LaunchResponse:")){var l=null,h=null,g=null;try{g=JSON.parse(n.data.substring("ImmersiveReader-LaunchResponse:".length))}catch(e){}g&&g.success?l={container:f,sessionId:g.sessionId,charactersProcessed:g.meteredContentSize}:h=g&&!g.success?{code:g.errorCode,message:s[g.errorCode],sessionId:g.sessionId}:{code:o.ErrorCode.ServerError,message:s[o.ErrorCode.ServerError]},a=!1,l?(b(),u(l)):h&&(y(),d(h))}else if(n.data.startsWith("ImmersiveReader-Preferences:")&&c.onPreferencesChanged&&"function"==typeof c.onPreferencesChanged)try{c.onPreferencesChanged(n.data.substring("ImmersiveReader-Preferences:".length))}catch(e){}};window.addEventListener("message",k),h=window.setTimeout((function(){v(),a=!1,d({code:o.ErrorCode.Timeout,message:"Page failed to load after timeout ("+c.timeout+" ms)"})}),c.timeout),c.allowFullscreen&&m.setAttribute("allowfullscreen",""),m.style.cssText="position: static; width: 100vw; height: 100vh; left: 0; top: 0; border-width: 0",c.useWebview&&m.addEventListener("loadstop",(function(){m.contentWindow.postMessage(JSON.stringify({messageType:"WebviewHost"}),"*")}));var w=(c.customDomain?c.customDomain:"https://"+t+".cognitiveservices.azure.com/immersivereader/webapp/v1.0/")+"reader?exitCallback=ImmersiveReader-Exit&sdkPlatform=js&sdkVersion=1.1.0";w+="&cookiePolicy="+(c.cookiePolicy===r.CookiePolicy.Enable?"enable":"disable"),c.hideExitButton&&(w+="&hideExitButton=true"),c.uiLang&&(w+="&omkt="+c.uiLang),m.src=w,f.style.cssText="position: fixed; width: 100vw; height: 100vh; left: 0; top: 0; border-width: 0; -webkit-perspective: 1px; z-index: "+c.uiZIndex+"; background: white; overflow: hidden",f.appendChild(m),document.body.appendChild(f),document.head.appendChild(g)}else d({code:o.ErrorCode.InvalidSubdomain,message:s[o.ErrorCode.InvalidSubdomain]});else d({code:o.ErrorCode.BadArgument,message:"Chunks must not be empty"});else d({code:o.ErrorCode.BadArgument,message:"Chunks must not be null"});else d({code:o.ErrorCode.BadArgument,message:"Content must not be null"});else d({code:o.ErrorCode.BadArgument,message:"Token must not be null"})}))},t.close=function(){window.postMessage("ImmersiveReader-Exit","*")},t.isValidSubdomain=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorCode=void 0,function(e){e.BadArgument="BadArgument",e.Timeout="Timeout",e.TokenExpired="TokenExpired",e.Throttled="Throttled",e.ServerError="ServerError",e.InvalidSubdomain="InvalidSubdomain"}(t.ErrorCode||(t.ErrorCode={}))}])},"object"==typeof i&&"object"==typeof t?t.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof i?i.ImmersiveReader=r():n.ImmersiveReader=r()},{}],161:[function(e,t,i){"use strict";t.exports=function(e){return function(){var t=arguments.length;if(t){for(var i=[],n=-1;++n<t;)i[n]=arguments[n];return e.call(this,i)}return e.call(this,[])}}},{}],162:[function(e,t,i){(function(i){(function(){"use strict";var n=e("object-assign");function r(e,t){if(e===t)return 0;for(var i=e.length,n=t.length,r=0,o=Math.min(i,n);r<o;++r)if(e[r]!==t[r]){i=e[r],n=t[r];break}return i<n?-1:n<i?1:0}function o(e){return i.Buffer&&"function"==typeof i.Buffer.isBuffer?i.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var s=e("util/"),a=Object.prototype.hasOwnProperty,l=Array.prototype.slice,c="foo"===function(){}.name;function u(e){return Object.prototype.toString.call(e)}function d(e){return!o(e)&&"function"==typeof i.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer)))}var p=t.exports=v,h=/\s*function\s+([^\(\s]*)\s*/;function f(e){if(s.isFunction(e)){if(c)return e.name;var t=e.toString().match(h);return t&&t[1]}}function m(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function g(e){if(c||!s.isFunction(e))return s.inspect(e);var t=f(e);return"[Function"+(t?": "+t:"")+"]"}function b(e,t,i,n,r){throw new p.AssertionError({message:i,actual:e,expected:t,operator:n,stackStartFunction:r})}function v(e,t){e||b(e,!0,t,"==",p.ok)}function y(e,t,i,n){if(e===t)return!0;if(o(e)&&o(t))return 0===r(e,t);if(s.isDate(e)&&s.isDate(t))return e.getTime()===t.getTime();if(s.isRegExp(e)&&s.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(d(e)&&d(t)&&u(e)===u(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===r(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(o(e)!==o(t))return!1;var a=(n=n||{actual:[],expected:[]}).actual.indexOf(e);return-1!==a&&a===n.expected.indexOf(t)||(n.actual.push(e),n.expected.push(t),function(e,t,i,n){if(null==e||null==t)return!1;if(s.isPrimitive(e)||s.isPrimitive(t))return e===t;if(i&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var r=k(e),o=k(t);if(r&&!o||!r&&o)return!1;if(r)return y(e=l.call(e),t=l.call(t),i);var a,c,u=E(e),d=E(t);if(u.length!==d.length)return!1;for(u.sort(),d.sort(),c=u.length-1;c>=0;c--)if(u[c]!==d[c])return!1;for(c=u.length-1;c>=0;c--)if(!y(e[a=u[c]],t[a],i,n))return!1;return!0}(e,t,i,n))}return i?e===t:e==t}function k(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function w(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function x(e,t,i,n){var r;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof i&&(n=i,i=null),r=function(e){var t;try{e()}catch(e){t=e}return t}(t),n=(i&&i.name?" ("+i.name+").":".")+(n?" "+n:"."),e&&!r&&b(r,i,"Missing expected exception"+n);var o="string"==typeof n,a=!e&&r&&!i;if((!e&&s.isError(r)&&o&&w(r,i)||a)&&b(r,i,"Got unwanted exception"+n),e&&r&&i&&!w(r,i)||!e&&r)throw r}p.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return m(g(e.actual),128)+" "+e.operator+" "+m(g(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||b;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var i=new Error;if(i.stack){var n=i.stack,r=f(t),o=n.indexOf("\n"+r);if(o>=0){var s=n.indexOf("\n",o+1);n=n.substring(s+1)}this.stack=n}}},s.inherits(p.AssertionError,Error),p.fail=b,p.ok=v,p.equal=function(e,t,i){e!=t&&b(e,t,i,"==",p.equal)},p.notEqual=function(e,t,i){e==t&&b(e,t,i,"!=",p.notEqual)},p.deepEqual=function(e,t,i){y(e,t,!1)||b(e,t,i,"deepEqual",p.deepEqual)},p.deepStrictEqual=function(e,t,i){y(e,t,!0)||b(e,t,i,"deepStrictEqual",p.deepStrictEqual)},p.notDeepEqual=function(e,t,i){y(e,t,!1)&&b(e,t,i,"notDeepEqual",p.notDeepEqual)},p.notDeepStrictEqual=function e(t,i,n){y(t,i,!0)&&b(t,i,n,"notDeepStrictEqual",e)},p.strictEqual=function(e,t,i){e!==t&&b(e,t,i,"===",p.strictEqual)},p.notStrictEqual=function(e,t,i){e===t&&b(e,t,i,"!==",p.notStrictEqual)},p.throws=function(e,t,i){x(!0,e,t,i)},p.doesNotThrow=function(e,t,i){x(!1,e,t,i)},p.ifError=function(e){if(e)throw e},p.strict=n((function e(t,i){t||b(t,!0,i,"==",e)}),p,{equal:p.strictEqual,deepEqual:p.deepStrictEqual,notEqual:p.notStrictEqual,notDeepEqual:p.notDeepStrictEqual}),p.strict.strict=p.strict;var E=Object.keys||function(e){var t=[];for(var i in e)a.call(e,i)&&t.push(i);return t}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"object-assign":260,"util/":165}],163:[function(e,t,i){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},{}],164:[function(e,t,i){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],165:[function(e,t,i){(function(t,n){(function(){var r=/%[sdj%]/g;i.format=function(e){if(!b(e)){for(var t=[],i=0;i<arguments.length;i++)t.push(a(arguments[i]));return t.join(" ")}i=1;for(var n=arguments,o=n.length,s=String(e).replace(r,(function(e){if("%%"===e)return"%";if(i>=o)return e;switch(e){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(e){return"[Circular]"}default:return e}})),l=n[i];i<o;l=n[++i])m(l)||!k(l)?s+=" "+l:s+=" "+a(l);return s},i.deprecate=function(e,r){if(v(n.process))return function(){return i.deprecate(e,r).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(r);t.traceDeprecation?console.trace(r):console.error(r),o=!0}return e.apply(this,arguments)}};var o,s={};function a(e,t){var n={seen:[],stylize:c};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),f(t)?n.showHidden=t:t&&i._extend(n,t),v(n.showHidden)&&(n.showHidden=!1),v(n.depth)&&(n.depth=2),v(n.colors)&&(n.colors=!1),v(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=l),u(n,e,n.depth)}function l(e,t){var i=a.styles[t];return i?"["+a.colors[i][0]+"m"+e+"["+a.colors[i][1]+"m":e}function c(e,t){return e}function u(e,t,n){if(e.customInspect&&t&&E(t.inspect)&&t.inspect!==i.inspect&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(n,e);return b(r)||(r=u(e,r,n)),r}var o=function(e,t){if(v(t))return e.stylize("undefined","undefined");if(b(t)){var i="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(i,"string")}return g(t)?e.stylize(""+t,"number"):f(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}(e,t);if(o)return o;var s=Object.keys(t),a=function(e){var t={};return e.forEach((function(e,i){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),x(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return d(t);if(0===s.length){if(E(t)){var l=t.name?": "+t.name:"";return e.stylize("[Function"+l+"]","special")}if(y(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(w(t))return e.stylize(Date.prototype.toString.call(t),"date");if(x(t))return d(t)}var c,k="",C=!1,S=["{","}"];return h(t)&&(C=!0,S=["[","]"]),E(t)&&(k=" [Function"+(t.name?": "+t.name:"")+"]"),y(t)&&(k=" "+RegExp.prototype.toString.call(t)),w(t)&&(k=" "+Date.prototype.toUTCString.call(t)),x(t)&&(k=" "+d(t)),0!==s.length||C&&0!=t.length?n<0?y(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=C?function(e,t,i,n,r){for(var o=[],s=0,a=t.length;s<a;++s)A(t,String(s))?o.push(p(e,t,i,n,String(s),!0)):o.push("");return r.forEach((function(r){r.match(/^\d+$/)||o.push(p(e,t,i,n,r,!0))})),o}(e,t,n,a,s):s.map((function(i){return p(e,t,n,a,i,C)})),e.seen.pop(),function(e,t,i){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?i[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+i[1]:i[0]+t+" "+e.join(", ")+" "+i[1]}(c,k,S)):S[0]+k+S[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,i,n,r,o){var s,a,l;if((l=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?a=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(a=e.stylize("[Setter]","special")),A(n,r)||(s="["+r+"]"),a||(e.seen.indexOf(l.value)<0?(a=m(i)?u(e,l.value,null):u(e,l.value,i-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),v(s)){if(o&&r.match(/^\d+$/))return a;(s=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function h(e){return Array.isArray(e)}function f(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function b(e){return"string"==typeof e}function v(e){return void 0===e}function y(e){return k(e)&&"[object RegExp]"===C(e)}function k(e){return"object"==typeof e&&null!==e}function w(e){return k(e)&&"[object Date]"===C(e)}function x(e){return k(e)&&("[object Error]"===C(e)||e instanceof Error)}function E(e){return"function"==typeof e}function C(e){return Object.prototype.toString.call(e)}function S(e){return e<10?"0"+e.toString(10):e.toString(10)}i.debuglog=function(e){if(v(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!s[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var n=t.pid;s[e]=function(){var t=i.format.apply(i,arguments);console.error("%s %d: %s",e,n,t)}}else s[e]=function(){};return s[e]},i.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},i.isArray=h,i.isBoolean=f,i.isNull=m,i.isNullOrUndefined=function(e){return null==e},i.isNumber=g,i.isString=b,i.isSymbol=function(e){return"symbol"==typeof e},i.isUndefined=v,i.isRegExp=y,i.isObject=k,i.isDate=w,i.isError=x,i.isFunction=E,i.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},i.isBuffer=e("./support/isBuffer");var _=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function T(){var e=new Date,t=[S(e.getHours()),S(e.getMinutes()),S(e.getSeconds())].join(":");return[e.getDate(),_[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}i.log=function(){console.log("%s - %s",T(),i.format.apply(i,arguments))},i.inherits=e("inherits"),i._extend=function(e,t){if(!t||!k(t))return e;for(var i=Object.keys(t),n=i.length;n--;)e[i[n]]=t[i[n]];return e}}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":164,_process:285,inherits:163}],166:[function(e,t,i){"use strict";i.byteLength=function(e){var t=c(e),i=t[0],n=t[1];return 3*(i+n)/4-n},i.toByteArray=function(e){var t,i,n=c(e),s=n[0],a=n[1],l=new o(function(e,t,i){return 3*(t+i)/4-i}(0,s,a)),u=0,d=a>0?s-4:s;for(i=0;i<d;i+=4)t=r[e.charCodeAt(i)]<<18|r[e.charCodeAt(i+1)]<<12|r[e.charCodeAt(i+2)]<<6|r[e.charCodeAt(i+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;return 2===a&&(t=r[e.charCodeAt(i)]<<2|r[e.charCodeAt(i+1)]>>4,l[u++]=255&t),1===a&&(t=r[e.charCodeAt(i)]<<10|r[e.charCodeAt(i+1)]<<4|r[e.charCodeAt(i+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t),l},i.fromByteArray=function(e){for(var t,i=e.length,r=i%3,o=[],s=0,a=i-r;s<a;s+=16383)o.push(d(e,s,s+16383>a?a:s+16383));return 1===r?(t=e[i-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===r&&(t=(e[i-2]<<8)+e[i-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),o.join("")};for(var n=[],r=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=s.length;a<l;++a)n[a]=s[a],r[s.charCodeAt(a)]=a;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.indexOf("=");return-1===i&&(i=t),[i,i===t?0:4-i%4]}function u(e){return n[e>>18&63]+n[e>>12&63]+n[e>>6&63]+n[63&e]}function d(e,t,i){for(var n,r=[],o=t;o<i;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),r.push(u(n));return r.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},{}],167:[function(e,t,i){},{}],168:[function(e,t,i){(function(t){(function(){"use strict";var t=e("base64-js"),n=e("ieee754"),r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;i.Buffer=a,i.SlowBuffer=function(e){return+e!=e&&(e=0),a.alloc(+e)},i.INSPECT_MAX_BYTES=50;var o=2147483647;function s(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,a.prototype),t}function a(e,t,i){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,i)}function l(e,t,i){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!a.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var i=0|f(e,t),n=s(i),r=n.write(e,t);return r!==i&&(n=n.slice(0,r)),n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(F(e,Uint8Array)){var t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(F(e,ArrayBuffer)||e&&F(e.buffer,ArrayBuffer))return p(e,t,i);if("undefined"!=typeof SharedArrayBuffer&&(F(e,SharedArrayBuffer)||e&&F(e.buffer,SharedArrayBuffer)))return p(e,t,i);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return a.from(n,t,i);var r=function(e){if(a.isBuffer(e)){var t=0|h(e.length),i=s(t);return 0===i.length||e.copy(i,0,0,t),i}return void 0!==e.length?"number"!=typeof e.length||H(e.length)?s(0):d(e):"Buffer"===e.type&&Array.isArray(e.data)?d(e.data):void 0}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return a.from(e[Symbol.toPrimitive]("string"),t,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return c(e),s(e<0?0:0|h(e))}function d(e){for(var t=e.length<0?0:0|h(e.length),i=s(t),n=0;n<t;n+=1)i[n]=255&e[n];return i}function p(e,t,i){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(i||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,t):new Uint8Array(e,t,i),Object.setPrototypeOf(n,a.prototype),n}function h(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function f(e,t){if(a.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||F(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var i=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===i)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return j(e).length;default:if(r)return n?-1:B(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,i){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return N(this,t,i);case"utf8":case"utf-8":return S(this,t,i);case"ascii":return T(this,t,i);case"latin1":case"binary":return A(this,t,i);case"base64":return C(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,i);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function g(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function b(e,t,i,n,r){if(0===e.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),H(i=+i)&&(i=r?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(r)return-1;i=e.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof t&&(t=a.from(t,n)),a.isBuffer(t))return 0===t.length?-1:v(e,t,i,n,r);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):v(e,[t],i,n,r);throw new TypeError("val must be string, number or Buffer")}function v(e,t,i,n,r){var o,s=1,a=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,i/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(r){var u=-1;for(o=i;o<a;o++)if(c(e,o)===c(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===l)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(i+l>a&&(i=a-l),o=i;o>=0;o--){for(var d=!0,p=0;p<l;p++)if(c(e,o+p)!==c(t,p)){d=!1;break}if(d)return o}return-1}function y(e,t,i,n){i=Number(i)||0;var r=e.length-i;n?(n=Number(n))>r&&(n=r):n=r;var o=t.length;n>o/2&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(H(a))return s;e[i+s]=a}return s}function k(e,t,i,n){return U(B(t,e.length-i),e,i,n)}function w(e,t,i,n){return U(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,n)}function x(e,t,i,n){return U(j(t),e,i,n)}function E(e,t,i,n){return U(function(e,t){for(var i,n,r,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(i=e.charCodeAt(s))>>8,r=i%256,o.push(r),o.push(n);return o}(t,e.length-i),e,i,n)}function C(e,i,n){return 0===i&&n===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(i,n))}function S(e,t,i){i=Math.min(e.length,i);for(var n=[],r=t;r<i;){var o,s,a,l,c=e[r],u=null,d=c>239?4:c>223?3:c>191?2:1;if(r+d<=i)switch(d){case 1:c<128&&(u=c);break;case 2:128==(192&(o=e[r+1]))&&(l=(31&c)<<6|63&o)>127&&(u=l);break;case 3:o=e[r+1],s=e[r+2],128==(192&o)&&128==(192&s)&&(l=(15&c)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:o=e[r+1],s=e[r+2],a=e[r+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(l=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(u=l)}null===u?(u=65533,d=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),r+=d}return function(e){var t=e.length;if(t<=_)return String.fromCharCode.apply(String,e);for(var i="",n=0;n<t;)i+=String.fromCharCode.apply(String,e.slice(n,n+=_));return i}(n)}i.kMaxLength=o,a.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(e,t,i){return l(e,t,i)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(e,t,i){return function(e,t,i){return c(e),e<=0?s(e):void 0!==t?"string"==typeof i?s(e).fill(t,i):s(e).fill(t):s(e)}(e,t,i)},a.allocUnsafe=function(e){return u(e)},a.allocUnsafeSlow=function(e){return u(e)},a.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==a.prototype},a.compare=function(e,t){if(F(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),F(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var i=e.length,n=t.length,r=0,o=Math.min(i,n);r<o;++r)if(e[r]!==t[r]){i=e[r],n=t[r];break}return i<n?-1:n<i?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var i;if(void 0===t)for(t=0,i=0;i<e.length;++i)t+=e[i].length;var n=a.allocUnsafe(t),r=0;for(i=0;i<e.length;++i){var o=e[i];if(F(o,Uint8Array))r+o.length>n.length?a.from(o).copy(n,r):Uint8Array.prototype.set.call(n,o,r);else{if(!a.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,r)}r+=o.length}return n},a.byteLength=f,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},a.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?S(this,0,e):m.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",t=i.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(e,t,i,n,r){if(F(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),t<0||i>e.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&t>=i)return 0;if(n>=r)return-1;if(t>=i)return 1;if(this===e)return 0;for(var o=(r>>>=0)-(n>>>=0),s=(i>>>=0)-(t>>>=0),l=Math.min(o,s),c=this.slice(n,r),u=e.slice(t,i),d=0;d<l;++d)if(c[d]!==u[d]){o=c[d],s=u[d];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},a.prototype.indexOf=function(e,t,i){return b(this,e,t,i,!0)},a.prototype.lastIndexOf=function(e,t,i){return b(this,e,t,i,!1)},a.prototype.write=function(e,t,i,n){if(void 0===t)n="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)n=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(i)?(i>>>=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-t;if((void 0===i||i>r)&&(i=r),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return y(this,e,t,i);case"utf8":case"utf-8":return k(this,e,t,i);case"ascii":case"latin1":case"binary":return w(this,e,t,i);case"base64":return x(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,i);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var _=4096;function T(e,t,i){var n="";i=Math.min(e.length,i);for(var r=t;r<i;++r)n+=String.fromCharCode(127&e[r]);return n}function A(e,t,i){var n="";i=Math.min(e.length,i);for(var r=t;r<i;++r)n+=String.fromCharCode(e[r]);return n}function N(e,t,i){var n=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>n)&&(i=n);for(var r="",o=t;o<i;++o)r+=q[e[o]];return r}function I(e,t,i){for(var n=e.slice(t,i),r="",o=0;o<n.length-1;o+=2)r+=String.fromCharCode(n[o]+256*n[o+1]);return r}function O(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function P(e,t,i,n,r,o){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(i+n>e.length)throw new RangeError("Index out of range")}function D(e,t,i,n,r,o){if(i+n>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function L(e,t,i,r,o){return t=+t,i>>>=0,o||D(e,0,i,4),n.write(e,t,i,r,23,4),i+4}function R(e,t,i,r,o){return t=+t,i>>>=0,o||D(e,0,i,8),n.write(e,t,i,r,52,8),i+8}a.prototype.slice=function(e,t){var i=this.length;(e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,a.prototype),n},a.prototype.readUintLE=a.prototype.readUIntLE=function(e,t,i){e>>>=0,t>>>=0,i||O(e,t,this.length);for(var n=this[e],r=1,o=0;++o<t&&(r*=256);)n+=this[e+o]*r;return n},a.prototype.readUintBE=a.prototype.readUIntBE=function(e,t,i){e>>>=0,t>>>=0,i||O(e,t,this.length);for(var n=this[e+--t],r=1;t>0&&(r*=256);)n+=this[e+--t]*r;return n},a.prototype.readUint8=a.prototype.readUInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),this[e]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(e,t){return e>>>=0,t||O(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,i){e>>>=0,t>>>=0,i||O(e,t,this.length);for(var n=this[e],r=1,o=0;++o<t&&(r*=256);)n+=this[e+o]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*t)),n},a.prototype.readIntBE=function(e,t,i){e>>>=0,t>>>=0,i||O(e,t,this.length);for(var n=t,r=1,o=this[e+--n];n>0&&(r*=256);)o+=this[e+--n]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},a.prototype.readInt8=function(e,t){return e>>>=0,t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},a.prototype.readInt16LE=function(e,t){e>>>=0,t||O(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},a.prototype.readInt16BE=function(e,t){e>>>=0,t||O(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},a.prototype.readInt32LE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return e>>>=0,t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return e>>>=0,t||O(e,4,this.length),n.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return e>>>=0,t||O(e,4,this.length),n.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return e>>>=0,t||O(e,8,this.length),n.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return e>>>=0,t||O(e,8,this.length),n.read(this,e,!1,52,8)},a.prototype.writeUintLE=a.prototype.writeUIntLE=function(e,t,i,n){e=+e,t>>>=0,i>>>=0,n||P(this,e,t,i,Math.pow(2,8*i)-1,0);var r=1,o=0;for(this[t]=255&e;++o<i&&(r*=256);)this[t+o]=e/r&255;return t+i},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(e,t,i,n){e=+e,t>>>=0,i>>>=0,n||P(this,e,t,i,Math.pow(2,8*i)-1,0);var r=i-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+i},a.prototype.writeUint8=a.prototype.writeUInt8=function(e,t,i){return e=+e,t>>>=0,i||P(this,e,t,1,255,0),this[t]=255&e,t+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(e,t,i){return e=+e,t>>>=0,i||P(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(e,t,i){return e=+e,t>>>=0,i||P(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(e,t,i){return e=+e,t>>>=0,i||P(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(e,t,i){return e=+e,t>>>=0,i||P(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeIntLE=function(e,t,i,n){if(e=+e,t>>>=0,!n){var r=Math.pow(2,8*i-1);P(this,e,t,i,r-1,-r)}var o=0,s=1,a=0;for(this[t]=255&e;++o<i&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+i},a.prototype.writeIntBE=function(e,t,i,n){if(e=+e,t>>>=0,!n){var r=Math.pow(2,8*i-1);P(this,e,t,i,r-1,-r)}var o=i-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+i},a.prototype.writeInt8=function(e,t,i){return e=+e,t>>>=0,i||P(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,i){return e=+e,t>>>=0,i||P(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeInt16BE=function(e,t,i){return e=+e,t>>>=0,i||P(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeInt32LE=function(e,t,i){return e=+e,t>>>=0,i||P(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a.prototype.writeInt32BE=function(e,t,i){return e=+e,t>>>=0,i||P(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeFloatLE=function(e,t,i){return L(this,e,t,!0,i)},a.prototype.writeFloatBE=function(e,t,i){return L(this,e,t,!1,i)},a.prototype.writeDoubleLE=function(e,t,i){return R(this,e,t,!0,i)},a.prototype.writeDoubleBE=function(e,t,i){return R(this,e,t,!1,i)},a.prototype.copy=function(e,t,i,n){if(!a.isBuffer(e))throw new TypeError("argument should be a Buffer");if(i||(i=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-i&&(n=e.length-t+i);var r=n-i;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,i,n):Uint8Array.prototype.set.call(e,this.subarray(i,n),t),r},a.prototype.fill=function(e,t,i,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!a.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var r=e.charCodeAt(0);("utf8"===n&&r<128||"latin1"===n)&&(e=r)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;var o;if(t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(o=t;o<i;++o)this[o]=e;else{var s=a.isBuffer(e)?e:a.from(e,n),l=s.length;if(0===l)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<i-t;++o)this[o+t]=s[o%l]}return this};var M=/[^+/0-9A-Za-z-_]/g;function B(e,t){var i;t=t||1/0;for(var n=e.length,r=null,o=[],s=0;s<n;++s){if((i=e.charCodeAt(s))>55295&&i<57344){if(!r){if(i>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}r=i;continue}if(i<56320){(t-=3)>-1&&o.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,i<128){if((t-=1)<0)break;o.push(i)}else if(i<2048){if((t-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function j(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function U(e,t,i,n){for(var r=0;r<n&&!(r+i>=t.length||r>=e.length);++r)t[r+i]=e[r];return r}function F(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function H(e){return e!=e}var q=function(){for(var e=new Array(256),t=0;t<16;++t)for(var i=16*t,n=0;n<16;++n)e[i+n]="0123456789abcdef"[t]+"0123456789abcdef"[n];return e}()}).call(this)}).call(this,e("buffer").Buffer)},{"base64-js":166,buffer:168,ieee754:199}],169:[function(e,t,i){!function(){"use strict";var e={}.hasOwnProperty;function i(){for(var t=[],n=0;n<arguments.length;n++){var r=arguments[n];if(r){var o=typeof r;if("string"===o||"number"===o)t.push(r);else if(Array.isArray(r)){if(r.length){var s=i.apply(null,r);s&&t.push(s)}}else if("object"===o)if(r.toString===Object.prototype.toString)for(var a in r)e.call(r,a)&&r[a]&&t.push(a);else t.push(r.toString())}}return t.join(" ")}void 0!==t&&t.exports?(i.default=i,t.exports=i):"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("classnames",[],(function(){return i})):window.classNames=i}()},{}],170:[function(e,t,i){function n(e){return Object.prototype.toString.call(e)}i.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},i.isBoolean=function(e){return"boolean"==typeof e},i.isNull=function(e){return null===e},i.isNullOrUndefined=function(e){return null==e},i.isNumber=function(e){return"number"==typeof e},i.isString=function(e){return"string"==typeof e},i.isSymbol=function(e){return"symbol"==typeof e},i.isUndefined=function(e){return void 0===e},i.isRegExp=function(e){return"[object RegExp]"===n(e)},i.isObject=function(e){return"object"==typeof e&&null!==e},i.isDate=function(e){return"[object Date]"===n(e)},i.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},i.isFunction=function(e){return"function"==typeof e},i.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},i.isBuffer=e("buffer").Buffer.isBuffer},{buffer:168}],171:[function(e,t,i){var n,r;n=this,r=function(){var e=e||function(e,t){var i=Object.create||function(){function e(){}return function(t){var i;return e.prototype=t,i=new e,e.prototype=null,i}}(),n={},r=n.lib={},o=r.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=r.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,i=e.words,n=this.sigBytes,r=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<r;o++){var s=i[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=s<<24-(n+o)%4*8}else for(o=0;o<r;o+=4)t[n+o>>>2]=i[o>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var i,n=[],r=function(t){t=t;var i=987654321,n=4294967295;return function(){var r=((i=36969*(65535&i)+(i>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return r/=4294967296,(r+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var a=r(4294967296*(i||e.random()));i=987654071*a(),n.push(4294967296*a()|0)}return new s.init(n,t)}}),a=n.enc={},l=a.Hex={stringify:function(e){for(var t=e.words,i=e.sigBytes,n=[],r=0;r<i;r++){var o=t[r>>>2]>>>24-r%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n+=2)i[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new s.init(i,t/2)}},c=a.Latin1={stringify:function(e){for(var t=e.words,i=e.sigBytes,n=[],r=0;r<i;r++){var o=t[r>>>2]>>>24-r%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new s.init(i,t)}},u=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},d=r.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i=this._data,n=i.words,r=i.sigBytes,o=this.blockSize,a=r/(4*o),l=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,c=e.min(4*l,r);if(l){for(var u=0;u<l;u+=o)this._doProcessBlock(n,u);var d=n.splice(0,l);i.sigBytes-=c}return new s.init(d,c)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),p=(r.Hasher=d.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new p.HMAC.init(e,i).finalize(t)}}}),n.algo={});return n}(Math);return e},"object"==typeof i?t.exports=i=r():"function"==typeof define&&define.amd?define([],r):n.CryptoJS=r()},{}],172:[function(e,t,i){var n,r;n=this,r=function(e){var t,i,n,r,o,s,a;return i=(t=e).lib,n=i.WordArray,r=i.Hasher,o=t.algo,s=[],a=o.SHA1=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var i=this._hash.words,n=i[0],r=i[1],o=i[2],a=i[3],l=i[4],c=0;c<80;c++){if(c<16)s[c]=0|e[t+c];else{var u=s[c-3]^s[c-8]^s[c-14]^s[c-16];s[c]=u<<1|u>>>31}var d=(n<<5|n>>>27)+l+s[c];d+=c<20?1518500249+(r&o|~r&a):c<40?1859775393+(r^o^a):c<60?(r&o|r&a|o&a)-1894007588:(r^o^a)-899497514,l=a,a=o,o=r<<30|r>>>2,r=n,n=d}i[0]=i[0]+n|0,i[1]=i[1]+r|0,i[2]=i[2]+o|0,i[3]=i[3]+a|0,i[4]=i[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(i/4294967296),t[15+(n+64>>>9<<4)]=i,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}}),t.SHA1=r._createHelper(a),t.HmacSHA1=r._createHmacHelper(a),e.SHA1},"object"==typeof i?t.exports=i=r(e("./core")):"function"==typeof define&&define.amd?define(["./core"],r):r(n.CryptoJS)},{"./core":171}],173:[function(e,t,i){t.exports={elementNames:{altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient",textpath:"textPath"},attributeNames:{definitionurl:"definitionURL",attributename:"attributeName",attributetype:"attributeType",basefrequency:"baseFrequency",baseprofile:"baseProfile",calcmode:"calcMode",clippathunits:"clipPathUnits",diffuseconstant:"diffuseConstant",edgemode:"edgeMode",filterunits:"filterUnits",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",limitingconeangle:"limitingConeAngle",markerheight:"markerHeight",markerunits:"markerUnits",markerwidth:"markerWidth",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",numoctaves:"numOctaves",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",refx:"refX",refy:"refY",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",specularconstant:"specularConstant",specularexponent:"specularExponent",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stitchtiles:"stitchTiles",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textlength:"textLength",viewbox:"viewBox",viewtarget:"viewTarget",xchannelselector:"xChannelSelector",ychannelselector:"yChannelSelector",zoomandpan:"zoomAndPan"}}},{}],174:[function(e,t,i){var n=e("domelementtype"),r=e("entities"),o=e("./foreignNames.json");o.elementNames.__proto__=null,o.attributeNames.__proto__=null;var s={__proto__:null,style:!0,script:!0,xmp:!0,iframe:!0,noembed:!0,noframes:!0,plaintext:!0,noscript:!0};var a={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},l=t.exports=function(e,t){Array.isArray(e)||e.cheerio||(e=[e]),t=t||{};for(var i="",r=0;r<e.length;r++){var o=e[r];"root"===o.type?i+=l(o.children,t):n.isTag(o)?i+=u(o,t):o.type===n.Directive?i+=d(o):o.type===n.Comment?i+=f(o):o.type===n.CDATA?i+=h(o):i+=p(o,t)}return i},c=["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"];function u(e,t){"foreign"===t.xmlMode&&(e.name=o.elementNames[e.name]||e.name,e.parent&&c.indexOf(e.parent.name)>=0&&(t=Object.assign({},t,{xmlMode:!1}))),!t.xmlMode&&["svg","math"].indexOf(e.name)>=0&&(t=Object.assign({},t,{xmlMode:"foreign"}));var i="<"+e.name,n=function(e,t){if(e){var i,n="";for(var s in e)i=e[s],n&&(n+=" "),"foreign"===t.xmlMode&&(s=o.attributeNames[s]||s),n+=s,(null!==i&&""!==i||t.xmlMode)&&(n+='="'+(t.decodeEntities?r.encodeXML(i):i.replace(/\"/g,"&quot;"))+'"');return n}}(e.attribs,t);return n&&(i+=" "+n),!t.xmlMode||e.children&&0!==e.children.length?(i+=">",e.children&&(i+=l(e.children,t)),a[e.name]&&!t.xmlMode||(i+="</"+e.name+">")):i+="/>",i}function d(e){return"<"+e.data+">"}function p(e,t){var i=e.data||"";return!t.decodeEntities||e.parent&&e.parent.name in s||(i=r.encodeXML(i)),i}function h(e){return"<![CDATA["+e.children[0].data+"]]>"}function f(e){return"\x3c!--"+e.data+"--\x3e"}},{"./foreignNames.json":173,domelementtype:175,entities:188}],175:[function(e,t,i){"use strict";var n,r;Object.defineProperty(i,"__esModule",{value:!0}),i.Doctype=i.CDATA=i.Tag=i.Style=i.Script=i.Comment=i.Directive=i.Text=i.Root=i.isTag=i.ElementType=void 0,(r=n=i.ElementType||(i.ElementType={})).Root="root",r.Text="text",r.Directive="directive",r.Comment="comment",r.Script="script",r.Style="style",r.Tag="tag",r.CDATA="cdata",r.Doctype="doctype",i.isTag=function(e){return e.type===n.Tag||e.type===n.Script||e.type===n.Style},i.Root=n.Root,i.Text=n.Text,i.Directive=n.Directive,i.Comment=n.Comment,i.Script=n.Script,i.Style=n.Style,i.Tag=n.Tag,i.CDATA=n.CDATA,i.Doctype=n.Doctype},{}],176:[function(e,t,i){t.exports={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag",CDATA:"cdata",Doctype:"doctype",isTag:function(e){return"tag"===e.type||"script"===e.type||"style"===e.type}}},{}],177:[function(e,t,i){var n=t.exports;[e("./lib/stringify"),e("./lib/traversal"),e("./lib/manipulation"),e("./lib/querying"),e("./lib/legacy"),e("./lib/helpers")].forEach((function(e){Object.keys(e).forEach((function(t){n[t]=e[t].bind(n)}))}))},{"./lib/helpers":178,"./lib/legacy":179,"./lib/manipulation":180,"./lib/querying":181,"./lib/stringify":182,"./lib/traversal":183}],178:[function(e,t,i){i.removeSubsets=function(e){for(var t,i,n,r=e.length;--r>-1;){for(t=i=e[r],e[r]=null,n=!0;i;){if(e.indexOf(i)>-1){n=!1,e.splice(r,1);break}i=i.parent}n&&(e[r]=t)}return e};var n=1,r=2,o=4,s=8,a=16,l=i.compareDocumentPosition=function(e,t){var i,l,c,u,d,p,h=[],f=[];if(e===t)return 0;for(i=e;i;)h.unshift(i),i=i.parent;for(i=t;i;)f.unshift(i),i=i.parent;for(p=0;h[p]===f[p];)p++;return 0===p?n:(c=(l=h[p-1]).children,u=h[p],d=f[p],c.indexOf(u)>c.indexOf(d)?l===t?o|a:o:l===e?r|s:r)};i.uniqueSort=function(e){var t,i,n=e.length;for(e=e.slice();--n>-1;)t=e[n],(i=e.indexOf(t))>-1&&i<n&&e.splice(n,1);return e.sort((function(e,t){var i=l(e,t);return i&r?-1:i&o?1:0})),e}},{}],179:[function(e,t,i){var n=e("domelementtype"),r=i.isTag=n.isTag;i.testElement=function(e,t){for(var i in e)if(e.hasOwnProperty(i))if("tag_name"===i){if(!r(t)||!e.tag_name(t.name))return!1}else if("tag_type"===i){if(!e.tag_type(t.type))return!1}else if("tag_contains"===i){if(r(t)||!e.tag_contains(t.data))return!1}else if(!t.attribs||!e[i](t.attribs[i]))return!1;return!0};var o={tag_name:function(e){return"function"==typeof e?function(t){return r(t)&&e(t.name)}:"*"===e?r:function(t){return r(t)&&t.name===e}},tag_type:function(e){return"function"==typeof e?function(t){return e(t.type)}:function(t){return t.type===e}},tag_contains:function(e){return"function"==typeof e?function(t){return!r(t)&&e(t.data)}:function(t){return!r(t)&&t.data===e}}};function s(e,t){return"function"==typeof t?function(i){return i.attribs&&t(i.attribs[e])}:function(i){return i.attribs&&i.attribs[e]===t}}function a(e,t){return function(i){return e(i)||t(i)}}i.getElements=function(e,t,i,n){var r=Object.keys(e).map((function(t){var i=e[t];return t in o?o[t](i):s(t,i)}));return 0===r.length?[]:this.filter(r.reduce(a),t,i,n)},i.getElementById=function(e,t,i){return Array.isArray(t)||(t=[t]),this.findOne(s("id",e),t,!1!==i)},i.getElementsByTagName=function(e,t,i,n){return this.filter(o.tag_name(e),t,i,n)},i.getElementsByTagType=function(e,t,i,n){return this.filter(o.tag_type(e),t,i,n)}},{domelementtype:176}],180:[function(e,t,i){i.removeElement=function(e){if(e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.parent){var t=e.parent.children;t.splice(t.lastIndexOf(e),1)}},i.replaceElement=function(e,t){var i=t.prev=e.prev;i&&(i.next=t);var n=t.next=e.next;n&&(n.prev=t);var r=t.parent=e.parent;if(r){var o=r.children;o[o.lastIndexOf(e)]=t}},i.appendChild=function(e,t){if(t.parent=e,1!==e.children.push(t)){var i=e.children[e.children.length-2];i.next=t,t.prev=i,t.next=null}},i.append=function(e,t){var i=e.parent,n=e.next;if(t.next=n,t.prev=e,e.next=t,t.parent=i,n){if(n.prev=t,i){var r=i.children;r.splice(r.lastIndexOf(n),0,t)}}else i&&i.children.push(t)},i.prepend=function(e,t){var i=e.parent;if(i){var n=i.children;n.splice(n.lastIndexOf(e),0,t)}e.prev&&(e.prev.next=t),t.parent=i,t.prev=e.prev,t.next=e,e.prev=t}},{}],181:[function(e,t,i){var n=e("domelementtype").isTag;function r(e,t,i,n){for(var o,s=[],a=0,l=t.length;a<l&&!(e(t[a])&&(s.push(t[a]),--n<=0))&&(o=t[a].children,!(i&&o&&o.length>0&&(o=r(e,o,i,n),s=s.concat(o),(n-=o.length)<=0)));a++);return s}t.exports={filter:function(e,t,i,n){return Array.isArray(t)||(t=[t]),"number"==typeof n&&isFinite(n)||(n=1/0),r(e,t,!1!==i,n)},find:r,findOneChild:function(e,t){for(var i=0,n=t.length;i<n;i++)if(e(t[i]))return t[i];return null},findOne:function e(t,i){for(var r=null,o=0,s=i.length;o<s&&!r;o++)n(i[o])&&(t(i[o])?r=i[o]:i[o].children.length>0&&(r=e(t,i[o].children)));return r},existsOne:function e(t,i){for(var r=0,o=i.length;r<o;r++)if(n(i[r])&&(t(i[r])||i[r].children.length>0&&e(t,i[r].children)))return!0;return!1},findAll:function(e,t){for(var i=[],r=t.slice();r.length;){var o=r.shift();n(o)&&(o.children&&o.children.length>0&&r.unshift.apply(r,o.children),e(o)&&i.push(o))}return i}}},{domelementtype:176}],182:[function(e,t,i){var n=e("domelementtype"),r=e("dom-serializer"),o=n.isTag;t.exports={getInnerHTML:function(e,t){return e.children?e.children.map((function(e){return r(e,t)})).join(""):""},getOuterHTML:r,getText:function e(t){return Array.isArray(t)?t.map(e).join(""):o(t)?"br"===t.name?"\n":e(t.children):t.type===n.CDATA?e(t.children):t.type===n.Text?t.data:""}}},{"dom-serializer":174,domelementtype:176}],183:[function(e,t,i){var n=i.getChildren=function(e){return e.children},r=i.getParent=function(e){return e.parent};i.getSiblings=function(e){var t=r(e);return t?n(t):[e]},i.getAttributeValue=function(e,t){return e.attribs&&e.attribs[t]},i.hasAttrib=function(e,t){return!!e.attribs&&hasOwnProperty.call(e.attribs,t)},i.getName=function(e){return e.name}},{}],184:[function(e,t,i){"use strict";function n(e){if(this._capacity=o(e),this._length=0,this._front=0,r(e)){for(var t=e.length,i=0;i<t;++i)this[i]=e[i];this._length=t}}n.prototype.toArray=function(){for(var e=this._length,t=new Array(e),i=this._front,n=this._capacity,r=0;r<e;++r)t[r]=this[i+r&n-1];return t},n.prototype.push=function(e){var t=arguments.length,i=this._length;if(t>1){var n=this._capacity;if(i+t>n){for(var r=0;r<t;++r)this._checkCapacity(i+1),this[o=this._front+i&this._capacity-1]=arguments[r],i++,this._length=i;return i}var o=this._front;for(r=0;r<t;++r)this[o+i&n-1]=arguments[r],o++;return this._length=i+t,i+t}return 0===t?i:(this._checkCapacity(i+1),this[r=this._front+i&this._capacity-1]=e,this._length=i+1,i+1)},n.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,i=this[t];return this[t]=void 0,this._length=e-1,i}},n.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,i=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,i}},n.prototype.unshift=function(e){var t=this._length,i=arguments.length;if(i>1){if(t+i>(r=this._capacity)){for(var n=i-1;n>=0;n--){this._checkCapacity(t+1);var r=this._capacity;this[s=(this._front-1&r-1^r)-r]=arguments[n],t++,this._length=t,this._front=s}return t}var o=this._front;for(n=i-1;n>=0;n--){var s;this[s=(o-1&r-1^r)-r]=arguments[n],o=s}return this._front=o,this._length=t+i,t+i}return 0===i?t:(this._checkCapacity(t+1),r=this._capacity,this[n=(this._front-1&r-1^r)-r]=e,this._length=t+1,this._front=n,t+1)},n.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},n.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},n.prototype.get=function(e){var t=e;if(t===(0|t)){var i=this._length;if(t<0&&(t+=i),!(t<0||t>=i))return this[this._front+t&this._capacity-1]}},n.prototype.isEmpty=function(){return 0===this._length},n.prototype.clear=function(){for(var e=this._length,t=this._front,i=this._capacity,n=0;n<e;++n)this[t+n&i-1]=void 0;this._length=0,this._front=0},n.prototype.toString=function(){return this.toArray().toString()},n.prototype.valueOf=n.prototype.toString,n.prototype.removeFront=n.prototype.shift,n.prototype.removeBack=n.prototype.pop,n.prototype.insertFront=n.prototype.unshift,n.prototype.insertBack=n.prototype.push,n.prototype.enqueue=n.prototype.push,n.prototype.dequeue=n.prototype.shift,n.prototype.toJSON=n.prototype.toArray,Object.defineProperty(n.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),n.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(o(1.5*this._capacity+16))},n.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var i=this._front,n=this._length;i+n>t&&function(e,t,i,n,r){for(var o=0;o<r;++o)i[o+n]=e[o+t],e[o+t]=void 0}(this,0,this,t,i+n&t-1)};var r=Array.isArray;function o(e){if("number"!=typeof e){if(!r(e))return 16;e=e.length}return function(e){return e>>>=0,e-=1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,1+(e|e>>16)}(Math.min(Math.max(16,e),1073741824))}t.exports=n},{}],185:[function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0}),i.decodeHTML=i.decodeHTMLStrict=i.decodeXML=void 0;var r=n(e("./maps/entities.json")),o=n(e("./maps/legacy.json")),s=n(e("./maps/xml.json")),a=n(e("./decode_codepoint")),l=/&(?:[a-zA-Z0-9]+|#[xX][\da-fA-F]+|#\d+);/g;function c(e){var t=d(e);return function(e){return String(e).replace(l,t)}}i.decodeXML=c(s.default),i.decodeHTMLStrict=c(r.default);var u=function(e,t){return e<t?1:-1};function d(e){return function(t){if("#"===t.charAt(1)){var i=t.charAt(2);return"X"===i||"x"===i?a.default(parseInt(t.substr(3),16)):a.default(parseInt(t.substr(2),10))}return e[t.slice(1,-1)]||t}}i.decodeHTML=function(){for(var e=Object.keys(o.default).sort(u),t=Object.keys(r.default).sort(u),i=0,n=0;i<t.length;i++)e[n]===t[i]?(t[i]+=";?",n++):t[i]+=";";var s=new RegExp("&(?:"+t.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),a=d(r.default);function l(e){return";"!==e.substr(-1)&&(e+=";"),a(e)}return function(e){return String(e).replace(s,l)}}()},{"./decode_codepoint":186,"./maps/entities.json":190,"./maps/legacy.json":191,"./maps/xml.json":192}],186:[function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0});var r=n(e("./maps/decode.json")),o=String.fromCodePoint||function(e){var t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+String.fromCharCode(e)};i.default=function(e){return e>=55296&&e<=57343||e>1114111?"":(e in r.default&&(e=r.default[e]),o(e))}},{"./maps/decode.json":189}],187:[function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0}),i.escapeUTF8=i.escape=i.encodeNonAsciiHTML=i.encodeHTML=i.encodeXML=void 0;var r=u(n(e("./maps/xml.json")).default),o=d(r);i.encodeXML=g(r);var s,a,l=u(n(e("./maps/entities.json")).default),c=d(l);function u(e){return Object.keys(e).sort().reduce((function(t,i){return t[e[i]]="&"+i+";",t}),{})}function d(e){for(var t=[],i=[],n=0,r=Object.keys(e);n<r.length;n++){var o=r[n];1===o.length?t.push("\\"+o):i.push(o)}t.sort();for(var s=0;s<t.length-1;s++){for(var a=s;a<t.length-1&&t[a].charCodeAt(1)+1===t[a+1].charCodeAt(1);)a+=1;var l=1+a-s;l<3||t.splice(s,l,t[s]+"-"+t[a])}return i.unshift("["+t.join("")+"]"),new RegExp(i.join("|"),"g")}i.encodeHTML=(s=l,a=c,function(e){return e.replace(a,(function(e){return s[e]})).replace(p,f)}),i.encodeNonAsciiHTML=g(l);var p=/(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g,h=null!=String.prototype.codePointAt?function(e){return e.codePointAt(0)}:function(e){return 1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)-56320+65536};function f(e){return"&#x"+(e.length>1?h(e):e.charCodeAt(0)).toString(16).toUpperCase()+";"}var m=new RegExp(o.source+"|"+p.source,"g");function g(e){return function(t){return t.replace(m,(function(t){return e[t]||f(t)}))}}i.escape=function(e){return e.replace(m,f)},i.escapeUTF8=function(e){return e.replace(o,f)}},{"./maps/entities.json":190,"./maps/xml.json":192}],188:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.decodeXMLStrict=i.decodeHTML5Strict=i.decodeHTML4Strict=i.decodeHTML5=i.decodeHTML4=i.decodeHTMLStrict=i.decodeHTML=i.decodeXML=i.encodeHTML5=i.encodeHTML4=i.escapeUTF8=i.escape=i.encodeNonAsciiHTML=i.encodeHTML=i.encodeXML=i.encode=i.decodeStrict=i.decode=void 0;var n=e("./decode"),r=e("./encode");i.decode=function(e,t){return(!t||t<=0?n.decodeXML:n.decodeHTML)(e)},i.decodeStrict=function(e,t){return(!t||t<=0?n.decodeXML:n.decodeHTMLStrict)(e)},i.encode=function(e,t){return(!t||t<=0?r.encodeXML:r.encodeHTML)(e)};var o=e("./encode");Object.defineProperty(i,"encodeXML",{enumerable:!0,get:function(){return o.encodeXML}}),Object.defineProperty(i,"encodeHTML",{enumerable:!0,get:function(){return o.encodeHTML}}),Object.defineProperty(i,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return o.encodeNonAsciiHTML}}),Object.defineProperty(i,"escape",{enumerable:!0,get:function(){return o.escape}}),Object.defineProperty(i,"escapeUTF8",{enumerable:!0,get:function(){return o.escapeUTF8}}),Object.defineProperty(i,"encodeHTML4",{enumerable:!0,get:function(){return o.encodeHTML}}),Object.defineProperty(i,"encodeHTML5",{enumerable:!0,get:function(){return o.encodeHTML}});var s=e("./decode");Object.defineProperty(i,"decodeXML",{enumerable:!0,get:function(){return s.decodeXML}}),Object.defineProperty(i,"decodeHTML",{enumerable:!0,get:function(){return s.decodeHTML}}),Object.defineProperty(i,"decodeHTMLStrict",{enumerable:!0,get:function(){return s.decodeHTMLStrict}}),Object.defineProperty(i,"decodeHTML4",{enumerable:!0,get:function(){return s.decodeHTML}}),Object.defineProperty(i,"decodeHTML5",{enumerable:!0,get:function(){return s.decodeHTML}}),Object.defineProperty(i,"decodeHTML4Strict",{enumerable:!0,get:function(){return s.decodeHTMLStrict}}),Object.defineProperty(i,"decodeHTML5Strict",{enumerable:!0,get:function(){return s.decodeHTMLStrict}}),Object.defineProperty(i,"decodeXMLStrict",{enumerable:!0,get:function(){return s.decodeXML}})},{"./decode":185,"./encode":187}],189:[function(e,t,i){t.exports={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376}},{}],190:[function(e,t,i){t.exports={Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",amp:"&",AMP:"&",andand:"",And:"",and:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angmsd:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",apacir:"",ap:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",barwed:"",Barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",because:"",Because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxdl:"",boxdL:"",boxDl:"",boxDL:"",boxdr:"",boxdR:"",boxDr:"",boxDR:"",boxh:"",boxH:"",boxhd:"",boxHd:"",boxhD:"",boxHD:"",boxhu:"",boxHu:"",boxhU:"",boxHU:"",boxminus:"",boxplus:"",boxtimes:"",boxul:"",boxuL:"",boxUl:"",boxUL:"",boxur:"",boxuR:"",boxUr:"",boxUR:"",boxv:"",boxV:"",boxvh:"",boxvH:"",boxVh:"",boxVH:"",boxvl:"",boxvL:"",boxVl:"",boxVL:"",boxvr:"",boxvR:"",boxVr:"",boxVR:"",bprime:"",breve:"",Breve:"",brvbar:"",bscr:"",Bscr:"",bsemi:"",bsim:"",bsime:"",bsolb:"",bsol:"\\",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",capand:"",capbrcup:"",capcap:"",cap:"",Cap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",centerdot:"",CenterDot:"",cfr:"",Cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cir:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",colon:":",Colon:"",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",conint:"",Conint:"",ContourIntegral:"",copf:"",Copf:"",coprod:"",Coproduct:"",copy:"",COPY:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",cross:"",Cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",cupbrcap:"",cupcap:"",CupCap:"",cup:"",Cup:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",dagger:"",Dagger:"",daleth:"",darr:"",Darr:"",dArr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",ddagger:"",ddarr:"",DD:"",dd:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",diamond:"",Diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrowBar:"",downarrow:"",DownArrow:"",Downarrow:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVectorBar:"",DownLeftVector:"",DownRightTeeVector:"",DownRightVectorBar:"",DownRightVector:"",DownTeeArrow:"",DownTee:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",Ecirc:"",ecirc:"",ecir:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",edot:"",eDot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp13:"",emsp14:"",emsp:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",escr:"",Escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",exponentiale:"",ExponentialE:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",forall:"",ForAll:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",fscr:"",Fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",ge:"",gE:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",gescc:"",ges:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",gg:"",Gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gla:"",gl:"",glE:"",glj:"",gnap:"",gnapprox:"",gne:"",gnE:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",gtcc:"",gtcir:"",gt:">",GT:">",Gt:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",harrcir:"",harr:"",hArr:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",hfr:"",Hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",hopf:"",Hopf:"",horbar:"",HorizontalLine:"",hscr:"",Hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",ifr:"",Ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",Im:"",imof:"",imped:"",Implies:"",incare:"",in:"",infin:"",infintie:"",inodot:"",intcal:"",int:"",Int:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",iscr:"",Iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",lang:"",Lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",larrb:"",larrbfs:"",larr:"",Larr:"",lArr:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",latail:"",lAtail:"",lat:"",late:"",lates:"",lbarr:"",lBarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",le:"",lE:"",LeftAngleBracket:"",LeftArrowBar:"",leftarrow:"",LeftArrow:"",Leftarrow:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVectorBar:"",LeftDownVector:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",leftrightarrow:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTeeArrow:"",LeftTee:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangleBar:"",LeftTriangle:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVectorBar:"",LeftUpVector:"",LeftVectorBar:"",LeftVector:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",lescc:"",les:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",llarr:"",ll:"",Ll:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoustache:"",lmoust:"",lnap:"",lnapprox:"",lne:"",lnE:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",longleftarrow:"",LongLeftArrow:"",Longleftarrow:"",longleftrightarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longmapsto:"",longrightarrow:"",LongRightArrow:"",Longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",lscr:"",Lscr:"",lsh:"",Lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",ltcc:"",ltcir:"",lt:"<",LT:"<",Lt:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",midast:"*",midcir:"",mid:"",middot:"",minusb:"",minus:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",mscr:"",Mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natural:"",naturals:"",natur:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",nearhk:"",nearr:"",neArr:"",nearrow:"",ne:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:"\n",nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nharr:"",nhArr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlarr:"",nlArr:"",nldr:"",nlE:"",nle:"",nleftarrow:"",nLeftarrow:"",nleftrightarrow:"",nLeftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",nopf:"",Nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangleBar:"",NotLeftTriangle:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangleBar:"",NotRightTriangle:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",nparallel:"",npar:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",nprec:"",npreceq:"",npre:"",nrarrc:"",nrarr:"",nrArr:"",nrarrw:"",nrightarrow:"",nRightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nvdash:"",nvDash:"",nVdash:"",nVDash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwarr:"",nwArr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",Ocirc:"",ocirc:"",ocir:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",orarr:"",Or:"",or:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",otimesas:"",Otimes:"",otimes:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",para:"",parallel:"",par:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plusacir:"",plusb:"",pluscir:"",plus:"+",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",popf:"",Popf:"",pound:"",prap:"",Pr:"",pr:"",prcue:"",precapprox:"",prec:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",pre:"",prE:"",precsim:"",prime:"",Prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportional:"",Proportion:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",qopf:"",Qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",quot:'"',QUOT:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",rang:"",Rang:"",rangd:"",range:"",rangle:"",raquo:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarr:"",Rarr:"",rArr:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",ratail:"",rAtail:"",ratio:"",rationals:"",rbarr:"",rBarr:"",RBarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",real:"",realine:"",realpart:"",reals:"",Re:"",rect:"",reg:"",REG:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",rfr:"",Rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrowBar:"",rightarrow:"",RightArrow:"",Rightarrow:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVectorBar:"",RightDownVector:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTeeArrow:"",RightTee:"",RightTeeVector:"",rightthreetimes:"",RightTriangleBar:"",RightTriangle:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVectorBar:"",RightUpVector:"",RightVectorBar:"",RightVector:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoustache:"",rmoust:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",ropf:"",Ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",rscr:"",Rscr:"",rsh:"",Rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",scap:"",Scaron:"",scaron:"",Sc:"",sc:"",sccue:"",sce:"",scE:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdotb:"",sdot:"",sdote:"",searhk:"",searr:"",seArr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",solbar:"",solb:"",sol:"/",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",square:"",Square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squ:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",sub:"",Sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",subset:"",Subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succapprox:"",succ:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",sum:"",Sum:"",sung:"",sup1:"",sup2:"",sup3:"",sup:"",Sup:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",supset:"",Supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swarr:"",swArr:"",swarrow:"",swnwar:"",szlig:"",Tab:"\t",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",therefore:"",Therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",ThinSpace:"",thinsp:"",thkap:"",thksim:"",THORN:"",thorn:"",tilde:"",Tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",timesbar:"",timesb:"",times:"",timesd:"",tint:"",toea:"",topbot:"",topcir:"",top:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",trade:"",TRADE:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",uarr:"",Uarr:"",uArr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrowBar:"",uparrow:"",UpArrow:"",Uparrow:"",UpArrowDownArrow:"",updownarrow:"",UpDownArrow:"",Updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",upsi:"",Upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTeeArrow:"",UpTee:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",varr:"",vArr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",vBar:"",Vbar:"",vBarv:"",Vcy:"",vcy:"",vdash:"",vDash:"",Vdash:"",VDash:"",Vdashl:"",veebar:"",vee:"",Vee:"",veeeq:"",vellip:"",verbar:"|",Verbar:"",vert:"|",Vert:"",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",wedge:"",Wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xharr:"",xhArr:"",Xi:"",xi:"",xlarr:"",xlArr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrarr:"",xrArr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",yuml:"",Yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",zfr:"",Zfr:"",ZHcy:"",zhcy:"",zigrarr:"",zopf:"",Zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}},{}],191:[function(e,t,i){t.exports={Aacute:"",aacute:"",Acirc:"",acirc:"",acute:"",AElig:"",aelig:"",Agrave:"",agrave:"",amp:"&",AMP:"&",Aring:"",aring:"",Atilde:"",atilde:"",Auml:"",auml:"",brvbar:"",Ccedil:"",ccedil:"",cedil:"",cent:"",copy:"",COPY:"",curren:"",deg:"",divide:"",Eacute:"",eacute:"",Ecirc:"",ecirc:"",Egrave:"",egrave:"",ETH:"",eth:"",Euml:"",euml:"",frac12:"",frac14:"",frac34:"",gt:">",GT:">",Iacute:"",iacute:"",Icirc:"",icirc:"",iexcl:"",Igrave:"",igrave:"",iquest:"",Iuml:"",iuml:"",laquo:"",lt:"<",LT:"<",macr:"",micro:"",middot:"",nbsp:"",not:"",Ntilde:"",ntilde:"",Oacute:"",oacute:"",Ocirc:"",ocirc:"",Ograve:"",ograve:"",ordf:"",ordm:"",Oslash:"",oslash:"",Otilde:"",otilde:"",Ouml:"",ouml:"",para:"",plusmn:"",pound:"",quot:'"',QUOT:'"',raquo:"",reg:"",REG:"",sect:"",shy:"",sup1:"",sup2:"",sup3:"",szlig:"",THORN:"",thorn:"",times:"",Uacute:"",uacute:"",Ucirc:"",ucirc:"",Ugrave:"",ugrave:"",uml:"",Uuml:"",uuml:"",Yacute:"",yacute:"",yen:"",yuml:""}},{}],192:[function(e,t,i){t.exports={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}},{}],193:[function(e,t,i){var n=e("prr");function r(e,t,i){t&&"string"!=typeof t&&(t=t.message||t.name),n(this,{type:e,name:e,cause:"string"!=typeof t?t:i,message:t},"ewr")}function o(e,t){Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),r.call(this,"CustomError",e,t)}o.prototype=new Error,t.exports=function(e){var t=function(t,i){return function(e,t,i){var n=function(i,o){r.call(this,t,i,o),"FilesystemError"==t&&(this.code=this.cause.code,this.path=this.cause.path,this.errno=this.cause.errno,this.message=(e.errno[this.cause.errno]?e.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")),Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,n)};return n.prototype=i?new i:new o,n}(e,t,i)};return{CustomError:o,FilesystemError:t("FilesystemError"),createError:t}}},{prr:289}],194:[function(e,t,i){var n=t.exports.all=[{errno:-2,code:"ENOENT",description:"no such file or directory"},{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];t.exports.errno={},t.exports.code={},n.forEach((function(e){t.exports.errno[e.errno]=e,t.exports.code[e.code]=e})),t.exports.custom=e("./custom")(t.exports),t.exports.create=t.exports.custom.createError},{"./custom":193}],195:[function(e,t,i){var n=Object.create||function(e){var t=function(){};return t.prototype=e,new t},r=Object.keys||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return i},o=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function s(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=n(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0;var a,l=10;try{var c={};Object.defineProperty&&Object.defineProperty(c,"x",{value:0}),a=0===c.x}catch(e){a=!1}function u(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function d(e,t,i){if(t)e.call(i);else for(var n=e.length,r=w(e,n),o=0;o<n;++o)r[o].call(i)}function p(e,t,i,n){if(t)e.call(i,n);else for(var r=e.length,o=w(e,r),s=0;s<r;++s)o[s].call(i,n)}function h(e,t,i,n,r){if(t)e.call(i,n,r);else for(var o=e.length,s=w(e,o),a=0;a<o;++a)s[a].call(i,n,r)}function f(e,t,i,n,r,o){if(t)e.call(i,n,r,o);else for(var s=e.length,a=w(e,s),l=0;l<s;++l)a[l].call(i,n,r,o)}function m(e,t,i,n){if(t)e.apply(i,n);else for(var r=e.length,o=w(e,r),s=0;s<r;++s)o[s].apply(i,n)}function g(e,t,i,r){var o,s,a;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),a=s[t]):(s=e._events=n(null),e._eventsCount=0),a){if("function"==typeof a?a=s[t]=r?[i,a]:[a,i]:r?a.unshift(i):a.push(i),!a.warned&&(o=u(e))&&o>0&&a.length>o){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",l.name,l.message)}}else a=s[t]=i,++e._eventsCount;return e}function b(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function v(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=o.call(b,n);return r.listener=i,n.wrapFn=r,r}function y(e,t,i){var n=e._events;if(!n)return[];var r=n[t];return r?"function"==typeof r?i?[r.listener||r]:[r]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(r):w(r,r.length):[]}function k(e){var t=this._events;if(t){var i=t[e];if("function"==typeof i)return 1;if(i)return i.length}return 0}function w(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}a?Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');l=e}}):s.defaultMaxListeners=l,s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(e){var t,i,n,r,o,s,a="error"===e;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var l=new Error('Unhandled "error" event. ('+t+")");throw l.context=t,l}if(!(i=s[e]))return!1;var c="function"==typeof i;switch(n=arguments.length){case 1:d(i,c,this);break;case 2:p(i,c,this,arguments[1]);break;case 3:h(i,c,this,arguments[1],arguments[2]);break;case 4:f(i,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(n-1),o=1;o<n;o++)r[o-1]=arguments[o];m(i,c,this,r)}return!0},s.prototype.addListener=function(e,t){return g(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return g(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,v(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,v(this,e,t)),this},s.prototype.removeListener=function(e,t){var i,r,o,s,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=n(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(o=-1,s=i.length-1;s>=0;s--)if(i[s]===t||i[s].listener===t){a=i[s].listener,o=s;break}if(o<0)return this;0===o?i.shift():function(e,t){for(var i=t,n=i+1,r=e.length;n<r;i+=1,n+=1)e[i]=e[n];e.pop()}(i,o),1===i.length&&(r[e]=i[0]),r.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.removeAllListeners=function(e){var t,i,o;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=n(null),this._eventsCount=0):i[e]&&(0==--this._eventsCount?this._events=n(null):delete i[e]),this;if(0===arguments.length){var s,a=r(i);for(o=0;o<a.length;++o)"removeListener"!==(s=a[o])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=n(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(t)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this},s.prototype.listeners=function(e){return y(this,e,!0)},s.prototype.rawListeners=function(e){return y(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):k.call(e,t)},s.prototype.listenerCount=k,s.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],196:[function(e,t,i){!function(){"use strict";var e=!("undefined"==typeof window||!window.document||!window.document.createElement),i={canUseDOM:e,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:e&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:e&&!!window.screen};"function"==typeof define&&"object"==typeof define.amd&&define.amd?define((function(){return i})):void 0!==t&&t.exports?t.exports=i:window.ExecutionEnvironment=i}()},{}],197:[function(e,t,i){"use strict";t.exports=function(e){return new a(e||m,null)};function n(e,t,i,n,r,o){this._color=e,this.key=t,this.value=i,this.left=n,this.right=r,this._count=o}function r(e){return new n(e._color,e.key,e.value,e.left,e.right,e._count)}function o(e,t){return new n(e,t.key,t.value,t.left,t.right,t._count)}function s(e){e._count=1+(e.left?e.left._count:0)+(e.right?e.right._count:0)}function a(e,t){this._compare=e,this.root=t}var l=a.prototype;function c(e,t){var i;return t.left&&(i=c(e,t.left))?i:(i=e(t.key,t.value))||(t.right?c(e,t.right):void 0)}function u(e,t,i,n){if(t(e,n.key)<=0){var r;if(n.left&&(r=u(e,t,i,n.left)))return r;if(r=i(n.key,n.value))return r}if(n.right)return u(e,t,i,n.right)}function d(e,t,i,n,r){var o,s=i(e,r.key),a=i(t,r.key);if(s<=0){if(r.left&&(o=d(e,t,i,n,r.left)))return o;if(a>0&&(o=n(r.key,r.value)))return o}if(a>0&&r.right)return d(e,t,i,n,r.right)}function p(e,t){this.tree=e,this._stack=t}Object.defineProperty(l,"keys",{get:function(){var e=[];return this.forEach((function(t,i){e.push(t)})),e}}),Object.defineProperty(l,"values",{get:function(){var e=[];return this.forEach((function(t,i){e.push(i)})),e}}),Object.defineProperty(l,"length",{get:function(){return this.root?this.root._count:0}}),l.insert=function(e,t){for(var i=this._compare,r=this.root,l=[],c=[];r;){var u=i(e,r.key);l.push(r),c.push(u),r=u<=0?r.left:r.right}l.push(new n(0,e,t,null,null,1));for(var d=l.length-2;d>=0;--d)r=l[d],c[d]<=0?l[d]=new n(r._color,r.key,r.value,l[d+1],r.right,r._count+1):l[d]=new n(r._color,r.key,r.value,r.left,l[d+1],r._count+1);for(d=l.length-1;d>1;--d){var p=l[d-1];if(r=l[d],1===p._color||1===r._color)break;var h=l[d-2];if(h.left===p)if(p.left===r){if(!(f=h.right)||0!==f._color){h._color=0,h.left=p.right,p._color=1,p.right=h,l[d-2]=p,l[d-1]=r,s(h),s(p),d>=3&&((m=l[d-3]).left===h?m.left=p:m.right=p);break}p._color=1,h.right=o(1,f),h._color=0,d-=1}else{if(!(f=h.right)||0!==f._color){p.right=r.left,h._color=0,h.left=r.right,r._color=1,r.left=p,r.right=h,l[d-2]=r,l[d-1]=p,s(h),s(p),s(r),d>=3&&((m=l[d-3]).left===h?m.left=r:m.right=r);break}p._color=1,h.right=o(1,f),h._color=0,d-=1}else if(p.right===r){if(!(f=h.left)||0!==f._color){h._color=0,h.right=p.left,p._color=1,p.left=h,l[d-2]=p,l[d-1]=r,s(h),s(p),d>=3&&((m=l[d-3]).right===h?m.right=p:m.left=p);break}p._color=1,h.left=o(1,f),h._color=0,d-=1}else{var f;if(!(f=h.left)||0!==f._color){var m;p.left=r.right,h._color=0,h.right=r.left,r._color=1,r.right=p,r.left=h,l[d-2]=r,l[d-1]=p,s(h),s(p),s(r),d>=3&&((m=l[d-3]).right===h?m.right=r:m.left=r);break}p._color=1,h.left=o(1,f),h._color=0,d-=1}}return l[0]._color=1,new a(i,l[0])},l.forEach=function(e,t,i){if(this.root)switch(arguments.length){case 1:return c(e,this.root);case 2:return u(t,this._compare,e,this.root);case 3:if(this._compare(t,i)>=0)return;return d(t,i,this._compare,e,this.root)}},Object.defineProperty(l,"begin",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.left;return new p(this,e)}}),Object.defineProperty(l,"end",{get:function(){for(var e=[],t=this.root;t;)e.push(t),t=t.right;return new p(this,e)}}),l.at=function(e){if(e<0)return new p(this,[]);for(var t=this.root,i=[];;){if(i.push(t),t.left){if(e<t.left._count){t=t.left;continue}e-=t.left._count}if(!e)return new p(this,i);if(e-=1,!t.right)break;if(e>=t.right._count)break;t=t.right}return new p(this,[])},l.ge=function(e){for(var t=this._compare,i=this.root,n=[],r=0;i;){var o=t(e,i.key);n.push(i),o<=0&&(r=n.length),i=o<=0?i.left:i.right}return n.length=r,new p(this,n)},l.gt=function(e){for(var t=this._compare,i=this.root,n=[],r=0;i;){var o=t(e,i.key);n.push(i),o<0&&(r=n.length),i=o<0?i.left:i.right}return n.length=r,new p(this,n)},l.lt=function(e){for(var t=this._compare,i=this.root,n=[],r=0;i;){var o=t(e,i.key);n.push(i),o>0&&(r=n.length),i=o<=0?i.left:i.right}return n.length=r,new p(this,n)},l.le=function(e){for(var t=this._compare,i=this.root,n=[],r=0;i;){var o=t(e,i.key);n.push(i),o>=0&&(r=n.length),i=o<0?i.left:i.right}return n.length=r,new p(this,n)},l.find=function(e){for(var t=this._compare,i=this.root,n=[];i;){var r=t(e,i.key);if(n.push(i),0===r)return new p(this,n);i=r<=0?i.left:i.right}return new p(this,[])},l.remove=function(e){var t=this.find(e);return t?t.remove():this},l.get=function(e){for(var t=this._compare,i=this.root;i;){var n=t(e,i.key);if(0===n)return i.value;i=n<=0?i.left:i.right}};var h=p.prototype;function f(e,t){e.key=t.key,e.value=t.value,e.left=t.left,e.right=t.right,e._color=t._color,e._count=t._count}function m(e,t){return e<t?-1:e>t?1:0}Object.defineProperty(h,"valid",{get:function(){return this._stack.length>0}}),Object.defineProperty(h,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0}),h.clone=function(){return new p(this.tree,this._stack.slice())},h.remove=function(){var e=this._stack;if(0===e.length)return this.tree;var t=new Array(e.length),i=e[e.length-1];t[t.length-1]=new n(i._color,i.key,i.value,i.left,i.right,i._count);for(var l=e.length-2;l>=0;--l)(i=e[l]).left===e[l+1]?t[l]=new n(i._color,i.key,i.value,t[l+1],i.right,i._count):t[l]=new n(i._color,i.key,i.value,i.left,t[l+1],i._count);if((i=t[t.length-1]).left&&i.right){var c=t.length;for(i=i.left;i.right;)t.push(i),i=i.right;var u=t[c-1];for(t.push(new n(i._color,u.key,u.value,i.left,i.right,i._count)),t[c-1].key=i.key,t[c-1].value=i.value,l=t.length-2;l>=c;--l)i=t[l],t[l]=new n(i._color,i.key,i.value,i.left,t[l+1],i._count);t[c-1].left=t[c]}if(0===(i=t[t.length-1])._color){var d=t[t.length-2];for(d.left===i?d.left=null:d.right===i&&(d.right=null),t.pop(),l=0;l<t.length;++l)t[l]._count--;return new a(this.tree._compare,t[0])}if(i.left||i.right){for(i.left?f(i,i.left):i.right&&f(i,i.right),i._color=1,l=0;l<t.length-1;++l)t[l]._count--;return new a(this.tree._compare,t[0])}if(1===t.length)return new a(this.tree._compare,null);for(l=0;l<t.length;++l)t[l]._count--;var p=t[t.length-2];return function(e){for(var t,i,n,a,l=e.length-1;l>=0;--l){if(t=e[l],0===l)return void(t._color=1);if((i=e[l-1]).left===t){if((n=i.right).right&&0===n.right._color)return a=(n=i.right=r(n)).right=r(n.right),i.right=n.left,n.left=i,n.right=a,n._color=i._color,t._color=1,i._color=1,a._color=1,s(i),s(n),l>1&&((c=e[l-2]).left===i?c.left=n:c.right=n),void(e[l-1]=n);if(n.left&&0===n.left._color)return a=(n=i.right=r(n)).left=r(n.left),i.right=a.left,n.left=a.right,a.left=i,a.right=n,a._color=i._color,i._color=1,n._color=1,t._color=1,s(i),s(n),s(a),l>1&&((c=e[l-2]).left===i?c.left=a:c.right=a),void(e[l-1]=a);if(1===n._color){if(0===i._color)return i._color=1,void(i.right=o(0,n));i.right=o(0,n);continue}n=r(n),i.right=n.left,n.left=i,n._color=i._color,i._color=0,s(i),s(n),l>1&&((c=e[l-2]).left===i?c.left=n:c.right=n),e[l-1]=n,e[l]=i,l+1<e.length?e[l+1]=t:e.push(t),l+=2}else{if((n=i.left).left&&0===n.left._color)return a=(n=i.left=r(n)).left=r(n.left),i.left=n.right,n.right=i,n.left=a,n._color=i._color,t._color=1,i._color=1,a._color=1,s(i),s(n),l>1&&((c=e[l-2]).right===i?c.right=n:c.left=n),void(e[l-1]=n);if(n.right&&0===n.right._color)return a=(n=i.left=r(n)).right=r(n.right),i.left=a.right,n.right=a.left,a.right=i,a.left=n,a._color=i._color,i._color=1,n._color=1,t._color=1,s(i),s(n),s(a),l>1&&((c=e[l-2]).right===i?c.right=a:c.left=a),void(e[l-1]=a);if(1===n._color){if(0===i._color)return i._color=1,void(i.left=o(0,n));i.left=o(0,n);continue}var c;n=r(n),i.left=n.right,n.right=i,n._color=i._color,i._color=0,s(i),s(n),l>1&&((c=e[l-2]).right===i?c.right=n:c.left=n),e[l-1]=n,e[l]=i,l+1<e.length?e[l+1]=t:e.push(t),l+=2}}}(t),p.left===i?p.left=null:p.right=null,new a(this.tree._compare,t[0])},Object.defineProperty(h,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0}),Object.defineProperty(h,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0}),Object.defineProperty(h,"index",{get:function(){var e=0,t=this._stack;if(0===t.length){var i=this.tree.root;return i?i._count:0}t[t.length-1].left&&(e=t[t.length-1].left._count);for(var n=t.length-2;n>=0;--n)t[n+1]===t[n].right&&(++e,t[n].left&&(e+=t[n].left._count));return e},enumerable:!0}),h.next=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.right)for(t=t.right;t;)e.push(t),t=t.left;else for(e.pop();e.length>0&&e[e.length-1].right===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(h,"hasNext",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].right)return!0;for(var t=e.length-1;t>0;--t)if(e[t-1].left===e[t])return!0;return!1}}),h.update=function(e){var t=this._stack;if(0===t.length)throw new Error("Can't update empty node!");var i=new Array(t.length),r=t[t.length-1];i[i.length-1]=new n(r._color,r.key,e,r.left,r.right,r._count);for(var o=t.length-2;o>=0;--o)(r=t[o]).left===t[o+1]?i[o]=new n(r._color,r.key,r.value,i[o+1],r.right,r._count):i[o]=new n(r._color,r.key,r.value,r.left,i[o+1],r._count);return new a(this.tree._compare,i[0])},h.prev=function(){var e=this._stack;if(0!==e.length){var t=e[e.length-1];if(t.left)for(t=t.left;t;)e.push(t),t=t.right;else for(e.pop();e.length>0&&e[e.length-1].left===t;)t=e[e.length-1],e.pop()}},Object.defineProperty(h,"hasPrev",{get:function(){var e=this._stack;if(0===e.length)return!1;if(e[e.length-1].left)return!0;for(var t=e.length-1;t>0;--t)if(e[t-1].right===e[t])return!0;return!1}})},{}],198:[function(e,t,i){"use strict";var n=e("react-is"),r={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a={};function l(e){return n.isMemo(e)?s:a[e.$$typeof]||r}a[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a[n.Memo]=s;var c=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,h=Object.getPrototypeOf,f=Object.prototype;t.exports=function e(t,i,n){if("string"!=typeof i){if(f){var r=h(i);r&&r!==f&&e(t,r,n)}var s=u(i);d&&(s=s.concat(d(i)));for(var a=l(t),m=l(i),g=0;g<s.length;++g){var b=s[g];if(!(o[b]||n&&n[b]||m&&m[b]||a&&a[b])){var v=p(i,b);try{c(t,b,v)}catch(t){}}}}return t}},{"react-is":295}],199:[function(e,t,i){i.read=function(e,t,i,n,r){var o,s,a=8*r-n-1,l=(1<<a)-1,c=l>>1,u=-7,d=i?r-1:0,p=i?-1:1,h=e[t+d];for(d+=p,o=h&(1<<-u)-1,h>>=-u,u+=a;u>0;o=256*o+e[t+d],d+=p,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=n;u>0;s=256*s+e[t+d],d+=p,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,n),o-=c}return(h?-1:1)*s*Math.pow(2,o-n)},i.write=function(e,t,i,n,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,d=u>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:o-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+d>=1?p/l:p*Math.pow(2,1-d))*l>=2&&(s++,l/=2),s+d>=u?(a=0,s=u):s+d>=1?(a=(t*l-1)*Math.pow(2,r),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,r),s=0));r>=8;e[i+h]=255&a,h+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[i+h]=255&s,h+=f,s/=256,c-=8);e[i+h-f]|=128*m}},{}],200:[function(e,t,i){(function(e){(function(){"use strict";var i,n,r=e.MutationObserver||e.WebKitMutationObserver;if(r){var o=0,s=new r(u),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),i=function(){a.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)i="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var l=new e.MessageChannel;l.port1.onmessage=u,i=function(){l.port2.postMessage(0)}}var c=[];function u(){var e,t;n=!0;for(var i=c.length;i;){for(t=c,c=[],e=-1;++e<i;)t[e]();i=c.length}n=!1}t.exports=function(e){1!==c.push(e)||n||i()}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],201:[function(e,t,i){"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}}},{}],202:[function(e,t,i){"use strict";t.exports=function(e,t,i,n,r,o,s,a){if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[i,n,r,o,s,a],u=0;(l=new Error(t.replace(/%s/g,(function(){return c[u++]})))).name="Invariant Violation"}throw l.framesToPop=1,l}}},{}],203:[function(e,t,i){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(n(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}(e)||!!e._isBuffer)}},{}],204:[function(e,t,i){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],205:[function(e,t,i){var n=e("./lib/encodings");function r(e){if(!(this instanceof r))return new r(e);this.opts=e||{},this.encodings=n}t.exports=r,r.prototype._encoding=function(e){return"string"==typeof e&&(e=n[e]),e||(e=n.id),e},r.prototype._keyEncoding=function(e,t){return this._encoding(t&&t.keyEncoding||e&&e.keyEncoding||this.opts.keyEncoding)},r.prototype._valueEncoding=function(e,t){return this._encoding(t&&(t.valueEncoding||t.encoding)||e&&(e.valueEncoding||e.encoding)||this.opts.valueEncoding||this.opts.encoding)},r.prototype.encodeKey=function(e,t,i){return this._keyEncoding(t,i).encode(e)},r.prototype.encodeValue=function(e,t,i){return this._valueEncoding(t,i).encode(e)},r.prototype.decodeKey=function(e,t){return this._keyEncoding(t).decode(e)},r.prototype.decodeValue=function(e,t){return this._valueEncoding(t).decode(e)},r.prototype.encodeBatch=function(e,t){var i=this;return e.map((function(e){var n={type:e.type,key:i.encodeKey(e.key,t,e)};return i.keyAsBuffer(t,e)&&(n.keyEncoding="binary"),e.prefix&&(n.prefix=e.prefix),"value"in e&&(n.value=i.encodeValue(e.value,t,e),i.valueAsBuffer(t,e)&&(n.valueEncoding="binary")),n}))};var o=["lt","gt","lte","gte","start","end"];r.prototype.encodeLtgt=function(e){var t=this,i={};return Object.keys(e).forEach((function(n){i[n]=o.indexOf(n)>-1?t.encodeKey(e[n],e):e[n]})),i},r.prototype.createStreamDecoder=function(e){var t=this;return e.keys&&e.values?function(i,n){return{key:t.decodeKey(i,e),value:t.decodeValue(n,e)}}:e.keys?function(i){return t.decodeKey(i,e)}:e.values?function(i,n){return t.decodeValue(n,e)}:function(){}},r.prototype.keyAsBuffer=function(e){return this._keyEncoding(e).buffer},r.prototype.valueAsBuffer=function(e){return this._valueEncoding(e).buffer}},{"./lib/encodings":206}],206:[function(e,t,i){(function(e){(function(){i.utf8=i["utf-8"]={encode:function(e){return n(e)?e:String(e)},decode:t,buffer:!1,type:"utf8"},i.json={encode:JSON.stringify,decode:JSON.parse,buffer:!1,type:"json"},i.binary={encode:function(t){return n(t)?t:e.from(t)},decode:t,buffer:!0,type:"binary"},i.none={encode:t,decode:t,buffer:!1,type:"id"},i.id=i.none;function t(e){return e}function n(t){return null==t||e.isBuffer(t)}["hex","ascii","base64","ucs2","ucs-2","utf16le","utf-16le"].forEach((function(t){i[t]={encode:function(i){return n(i)?i:e.from(i,t)},decode:function(e){return e.toString(t)},buffer:!0,type:t}}))}).call(this)}).call(this,e("buffer").Buffer)},{buffer:168}],207:[function(e,t,i){var n=e("errno").create,r=n("LevelUPError"),o=n("NotFoundError",r);o.prototype.notFound=!0,o.prototype.status=404,t.exports={LevelUPError:r,InitializationError:n("InitializationError",r),OpenError:n("OpenError",r),ReadError:n("ReadError",r),WriteError:n("WriteError",r),NotFoundError:o,EncodingError:n("EncodingError",r)}},{errno:194}],208:[function(e,t,i){var n=e("inherits"),r=e("readable-stream").Readable,o=e("xtend");function s(e,t){if(!(this instanceof s))return new s(e,t);t=t||{},r.call(this,o(t,{objectMode:!0})),this._iterator=e,this._options=t,this.on("end",this.destroy.bind(this,null,null))}t.exports=s,n(s,r),s.prototype._read=function(){var e=this,t=this._options;this.destroyed||this._iterator.next((function(i,n,r){if(!e.destroyed)return i?e.destroy(i):void(void 0===n&&void 0===r?e.push(null):!1!==t.keys&&!1===t.values?e.push(n):!1===t.keys&&!1!==t.values?e.push(r):e.push({key:n,value:r}))}))},s.prototype._destroy=function(e,t){this._iterator.end((function(i){t(e||i)}))}},{inherits:201,"readable-stream":223,xtend:399}],209:[function(e,t,i){"use strict";var n={};function r(e,t,i){i||(i=Error);var r=function(e){function i(i,n,r){return e.call(this,function(e,i,n){return"string"==typeof t?t:t(e,i,n)}(i,n,r))||this}return function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(i,e),i}(i);r.prototype.name=i.name,r.prototype.code=e,n[e]=r}function o(e,t){if(Array.isArray(e)){var i=e.length;return e=e.map((function(e){return String(e)})),i>2?"one of ".concat(t," ").concat(e.slice(0,i-1).join(", "),", or ")+e[i-1]:2===i?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}r("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),r("ERR_INVALID_ARG_TYPE",(function(e,t,i){var n,r;if("string"==typeof t&&function(e,t,i){return e.substr(!i||i<0?0:+i,t.length)===t}(t,"not ")?(n="must not be",t=t.replace(/^not /,"")):n="must be",function(e,t,i){return(void 0===i||i>e.length)&&(i=e.length),e.substring(i-t.length,i)===t}(e," argument"))r="The ".concat(e," ").concat(n," ").concat(o(t,"type"));else{var s=function(e,t,i){return"number"!=typeof i&&(i=0),!(i+t.length>e.length)&&-1!==e.indexOf(t,i)}(e,".")?"property":"argument";r='The "'.concat(e,'" ').concat(s," ").concat(n," ").concat(o(t,"type"))}return r+". Received type ".concat(typeof i)}),TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.codes=n},{}],210:[function(e,t,i){(function(i){(function(){"use strict";var n=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t};t.exports=c;var r=e("./_stream_readable"),o=e("./_stream_writable");e("inherits")(c,r);for(var s=n(o.prototype),a=0;a<s.length;a++){var l=s[a];c.prototype[l]||(c.prototype[l]=o.prototype[l])}function c(e){if(!(this instanceof c))return new c(e);r.call(this,e),o.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||i.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this)}).call(this,e("_process"))},{"./_stream_readable":212,"./_stream_writable":214,_process:285,inherits:201}],211:[function(e,t,i){"use strict";t.exports=r;var n=e("./_stream_transform");function r(e){if(!(this instanceof r))return new r(e);n.call(this,e)}e("inherits")(r,n),r.prototype._transform=function(e,t,i){i(null,e)}},{"./_stream_transform":213,inherits:201}],212:[function(e,t,i){(function(i,n){(function(){"use strict";var r;t.exports=S,S.ReadableState=C;e("events").EventEmitter;var o=function(e,t){return e.listeners(t).length},s=e("./internal/streams/stream"),a=e("buffer").Buffer,l=n.Uint8Array||function(){};var c,u=e("util");c=u&&u.debuglog?u.debuglog("stream"):function(){};var d,p,h,f=e("./internal/streams/buffer_list"),m=e("./internal/streams/destroy"),g=e("./internal/streams/state").getHighWaterMark,b=e("../errors").codes,v=b.ERR_INVALID_ARG_TYPE,y=b.ERR_STREAM_PUSH_AFTER_EOF,k=b.ERR_METHOD_NOT_IMPLEMENTED,w=b.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;e("inherits")(S,s);var x=m.errorOrDestroy,E=["error","close","destroy","pause","resume"];function C(t,i,n){r=r||e("./_stream_duplex"),t=t||{},"boolean"!=typeof n&&(n=i instanceof r),this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=g(this,t,"readableHighWaterMark",n),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(d||(d=e("string_decoder/").StringDecoder),this.decoder=new d(t.encoding),this.encoding=t.encoding)}function S(t){if(r=r||e("./_stream_duplex"),!(this instanceof S))return new S(t);var i=this instanceof r;this._readableState=new C(t,this,i),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),s.call(this)}function _(e,t,i,n,r){c("readableAddChunk",t);var o,s=e._readableState;if(null===t)s.reading=!1,function(e,t){if(c("onEofChunk"),!t.ended){if(t.decoder){var i=t.decoder.end();i&&i.length&&(t.buffer.push(i),t.length+=t.objectMode?1:i.length)}t.ended=!0,t.sync?I(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,O(e)))}}(e,s);else if(r||(o=function(e,t){var i;return function(e){return a.isBuffer(e)||e instanceof l}(t)||"string"==typeof t||void 0===t||e.objectMode||(i=new v("chunk",["string","Buffer","Uint8Array"],t)),i}(s,t)),o)x(e,o);else if(s.objectMode||t&&t.length>0)if("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===a.prototype||(t=function(e){return a.from(e)}(t)),n)s.endEmitted?x(e,new w):T(e,s,t,!0);else if(s.ended)x(e,new y);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!i?(t=s.decoder.write(t),s.objectMode||0!==t.length?T(e,s,t,!1):P(e,s)):T(e,s,t,!1)}else n||(s.reading=!1,P(e,s));return!s.ended&&(s.length<s.highWaterMark||0===s.length)}function T(e,t,i,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",i)):(t.length+=t.objectMode?1:i.length,n?t.buffer.unshift(i):t.buffer.push(i),t.needReadable&&I(e)),P(e,t)}Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),S.prototype.destroy=m.destroy,S.prototype._undestroy=m.undestroy,S.prototype._destroy=function(e,t){t(e)},S.prototype.push=function(e,t){var i,n=this._readableState;return n.objectMode?i=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=a.from(e,t),t=""),i=!0),_(this,e,t,!1,i)},S.prototype.unshift=function(e){return _(this,e,null,!0,!1)},S.prototype.isPaused=function(){return!1===this._readableState.flowing},S.prototype.setEncoding=function(t){d||(d=e("string_decoder/").StringDecoder);var i=new d(t);this._readableState.decoder=i,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,r="";null!==n;)r+=i.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==r&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var A=1073741824;function N(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=A?e=A:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function I(e){var t=e._readableState;c("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(c("emitReadable",t.flowing),t.emittedReadable=!0,i.nextTick(O,e))}function O(e){var t=e._readableState;c("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,B(e)}function P(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(D,e,t))}function D(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var i=t.length;if(c("maybeReadMore read 0"),e.read(0),i===t.length)break}t.readingMore=!1}function L(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function R(e){c("readable nexttick read 0"),e.read(0)}function M(e,t){c("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),B(e),t.flowing&&!t.reading&&e.read(0)}function B(e){var t=e._readableState;for(c("flow",t.flowing);t.flowing&&null!==e.read(););}function j(e,t){return 0===t.length?null:(t.objectMode?i=t.buffer.shift():!e||e>=t.length?(i=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):i=t.buffer.consume(e,t.decoder),i);var i}function U(e){var t=e._readableState;c("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,i.nextTick(F,t,e))}function F(e,t){if(c("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var i=t._writableState;(!i||i.autoDestroy&&i.finished)&&t.destroy()}}function H(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1}S.prototype.read=function(e){c("read",e),e=parseInt(e,10);var t=this._readableState,i=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return c("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?U(this):I(this),null;if(0===(e=N(e,t))&&t.ended)return 0===t.length&&U(this),null;var n,r=t.needReadable;return c("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&c("length less than watermark",r=!0),t.ended||t.reading?c("reading or ended",r=!1):r&&(c("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=N(i,t))),null===(n=e>0?j(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),i!==e&&t.ended&&U(this)),null!==n&&this.emit("data",n),n},S.prototype._read=function(e){x(this,new k("_read()"))},S.prototype.pipe=function(e,t){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=e;break;case 1:r.pipes=[r.pipes,e];break;default:r.pipes.push(e)}r.pipesCount+=1,c("pipe count=%d opts=%j",r.pipesCount,t);var s=t&&!1===t.end||e===i.stdout||e===i.stderr?m:a;function a(){c("onend"),e.end()}r.endEmitted?i.nextTick(s):n.once("end",s),e.on("unpipe",(function t(i,o){c("onunpipe"),i===n&&o&&!1===o.hasUnpiped&&(o.hasUnpiped=!0,c("cleanup"),e.removeListener("close",h),e.removeListener("finish",f),e.removeListener("drain",l),e.removeListener("error",p),e.removeListener("unpipe",t),n.removeListener("end",a),n.removeListener("end",m),n.removeListener("data",d),u=!0,!r.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}));var l=function(e){return function(){var t=e._readableState;c("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,"data")&&(t.flowing=!0,B(e))}}(n);e.on("drain",l);var u=!1;function d(t){c("ondata");var i=e.write(t);c("dest.write",i),!1===i&&((1===r.pipesCount&&r.pipes===e||r.pipesCount>1&&-1!==H(r.pipes,e))&&!u&&(c("false write response, pause",r.awaitDrain),r.awaitDrain++),n.pause())}function p(t){c("onerror",t),m(),e.removeListener("error",p),0===o(e,"error")&&x(e,t)}function h(){e.removeListener("finish",f),m()}function f(){c("onfinish"),e.removeListener("close",h),m()}function m(){c("unpipe"),n.unpipe(e)}return n.on("data",d),function(e,t,i){if("function"==typeof e.prependListener)return e.prependListener(t,i);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(i):e._events[t]=[i,e._events[t]]:e.on(t,i)}(e,"error",p),e.once("close",h),e.once("finish",f),e.emit("pipe",n),r.flowing||(c("pipe resume"),n.resume()),e},S.prototype.unpipe=function(e){var t=this._readableState,i={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,i)),this;if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<r;o++)n[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=H(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,i)),this},S.prototype.on=function(e,t){var n=s.prototype.on.call(this,e,t),r=this._readableState;return"data"===e?(r.readableListening=this.listenerCount("readable")>0,!1!==r.flowing&&this.resume()):"readable"===e&&(r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.flowing=!1,r.emittedReadable=!1,c("on readable",r.length,r.reading),r.length?I(this):r.reading||i.nextTick(R,this))),n},S.prototype.addListener=S.prototype.on,S.prototype.removeListener=function(e,t){var n=s.prototype.removeListener.call(this,e,t);return"readable"===e&&i.nextTick(L,this),n},S.prototype.removeAllListeners=function(e){var t=s.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||i.nextTick(L,this),t},S.prototype.resume=function(){var e=this._readableState;return e.flowing||(c("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(M,e,t))}(this,e)),e.paused=!1,this},S.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},S.prototype.wrap=function(e){var t=this,i=this._readableState,n=!1;for(var r in e.on("end",(function(){if(c("wrapped end"),i.decoder&&!i.ended){var e=i.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(r){c("wrapped data"),i.decoder&&(r=i.decoder.write(r)),i.objectMode&&null==r||(i.objectMode||r&&r.length)&&(t.push(r)||(n=!0,e.pause()))})),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var o=0;o<E.length;o++)e.on(E[o],this.emit.bind(this,E[o]));return this._read=function(t){c("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(S.prototype[Symbol.asyncIterator]=function(){return void 0===p&&(p=e("./internal/streams/async_iterator")),p(this)}),Object.defineProperty(S.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(S.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(S.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),S._fromList=j,Object.defineProperty(S.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(S.from=function(t,i){return void 0===h&&(h=e("./internal/streams/from")),h(S,t,i)})}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":209,"./_stream_duplex":210,"./internal/streams/async_iterator":215,"./internal/streams/buffer_list":216,"./internal/streams/destroy":217,"./internal/streams/from":219,"./internal/streams/state":221,"./internal/streams/stream":222,_process:285,buffer:168,events:195,inherits:201,"string_decoder/":380,util:167}],213:[function(e,t,i){"use strict";t.exports=u;var n=e("../errors").codes,r=n.ERR_METHOD_NOT_IMPLEMENTED,o=n.ERR_MULTIPLE_CALLBACK,s=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=n.ERR_TRANSFORM_WITH_LENGTH_0,l=e("./_stream_duplex");function c(e,t){var i=this._transformState;i.transforming=!1;var n=i.writecb;if(null===n)return this.emit("error",new o);i.writechunk=null,i.writecb=null,null!=t&&this.push(t),n(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function u(e){if(!(this instanceof u))return new u(e);l.call(this,e),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?p(this,null,null):this._flush((function(t,i){p(e,t,i)}))}function p(e,t,i){if(t)return e.emit("error",t);if(null!=i&&e.push(i),e._writableState.length)throw new a;if(e._transformState.transforming)throw new s;return e.push(null)}e("inherits")(u,l),u.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},u.prototype._transform=function(e,t,i){i(new r("_transform()"))},u.prototype._write=function(e,t,i){var n=this._transformState;if(n.writecb=i,n.writechunk=e,n.writeencoding=t,!n.transforming){var r=this._readableState;(n.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},u.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},u.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,(function(e){t(e)}))}},{"../errors":209,"./_stream_duplex":210,inherits:201}],214:[function(e,t,i){(function(i,n){(function(){"use strict";function r(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,i){var n=e.entry;for(e.entry=null;n;){var r=n.callback;t.pendingcb--,r(i),n=n.next}t.corkedRequestsFree.next=e}(t,e)}}var o;t.exports=S,S.WritableState=C;var s={deprecate:e("util-deprecate")},a=e("./internal/streams/stream"),l=e("buffer").Buffer,c=n.Uint8Array||function(){};var u,d=e("./internal/streams/destroy"),p=e("./internal/streams/state").getHighWaterMark,h=e("../errors").codes,f=h.ERR_INVALID_ARG_TYPE,m=h.ERR_METHOD_NOT_IMPLEMENTED,g=h.ERR_MULTIPLE_CALLBACK,b=h.ERR_STREAM_CANNOT_PIPE,v=h.ERR_STREAM_DESTROYED,y=h.ERR_STREAM_NULL_VALUES,k=h.ERR_STREAM_WRITE_AFTER_END,w=h.ERR_UNKNOWN_ENCODING,x=d.errorOrDestroy;function E(){}function C(t,n,s){o=o||e("./_stream_duplex"),t=t||{},"boolean"!=typeof s&&(s=n instanceof o),this.objectMode=!!t.objectMode,s&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=p(this,t,"writableHighWaterMark",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===t.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,o=n.writecb;if("function"!=typeof o)throw new g;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,o){--t.pendingcb,n?(i.nextTick(o,r),i.nextTick(P,e,t),e._writableState.errorEmitted=!0,x(e,r)):(o(r),e._writableState.errorEmitted=!0,x(e,r),P(e,t))}(e,n,r,t,o);else{var s=I(n)||e.destroyed;s||n.corked||n.bufferProcessing||!n.bufferedRequest||N(e,n),r?i.nextTick(A,e,n,s,o):A(e,n,s,o)}}(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new r(this)}function S(t){var i=this instanceof(o=o||e("./_stream_duplex"));if(!i&&!u.call(S,this))return new S(t);this._writableState=new C(t,this,i),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),a.call(this)}function _(e,t,i,n,r,o){if(!i){var s=function(e,t,i){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=l.from(t,i)),t}(t,n,r);n!==s&&(i=!0,r="buffer",n=s)}var a=t.objectMode?1:n.length;t.length+=a;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:r,isBuf:i,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else T(e,t,!1,a,n,r,o);return c}function T(e,t,i,n,r,o,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new v("write")):i?e._writev(r,t.onwrite):e._write(r,o,t.onwrite),t.sync=!1}function A(e,t,i,n){i||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),P(e,t)}function N(e,t){t.bufferProcessing=!0;var i=t.bufferedRequest;if(e._writev&&i&&i.next){var n=t.bufferedRequestCount,o=new Array(n),s=t.corkedRequestsFree;s.entry=i;for(var a=0,l=!0;i;)o[a]=i,i.isBuf||(l=!1),i=i.next,a+=1;o.allBuffers=l,T(e,t,!0,t.length,o,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new r(t),t.bufferedRequestCount=0}else{for(;i;){var c=i.chunk,u=i.encoding,d=i.callback;if(T(e,t,!1,t.objectMode?1:c.length,c,u,d),i=i.next,t.bufferedRequestCount--,t.writing)break}null===i&&(t.lastBufferedRequest=null)}t.bufferedRequest=i,t.bufferProcessing=!1}function I(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function O(e,t){e._final((function(i){t.pendingcb--,i&&x(e,i),t.prefinished=!0,e.emit("prefinish"),P(e,t)}))}function P(e,t){var n=I(t);if(n&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,i.nextTick(O,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var r=e._readableState;(!r||r.autoDestroy&&r.endEmitted)&&e.destroy()}return n}e("inherits")(S,a),C.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(C.prototype,"buffer",{get:s.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(u=Function.prototype[Symbol.hasInstance],Object.defineProperty(S,Symbol.hasInstance,{value:function(e){return!!u.call(this,e)||this===S&&e&&e._writableState instanceof C}})):u=function(e){return e instanceof this},S.prototype.pipe=function(){x(this,new b)},S.prototype.write=function(e,t,n){var r=this._writableState,o=!1,s=!r.objectMode&&function(e){return l.isBuffer(e)||e instanceof c}(e);return s&&!l.isBuffer(e)&&(e=function(e){return l.from(e)}(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=E),r.ending?function(e,t){var n=new k;x(e,n),i.nextTick(t,n)}(this,n):(s||function(e,t,n,r){var o;return null===n?o=new y:"string"==typeof n||t.objectMode||(o=new f("chunk",["string","Buffer"],n)),!o||(x(e,o),i.nextTick(r,o),!1)}(this,r,e,n))&&(r.pendingcb++,o=_(this,r,s,e,t,n)),o},S.prototype.cork=function(){this._writableState.corked++},S.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||N(this,e))},S.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new w(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(S.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(S.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),S.prototype._write=function(e,t,i){i(new m("_write()"))},S.prototype._writev=null,S.prototype.end=function(e,t,n){var r=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||function(e,t,n){t.ending=!0,P(e,t),n&&(t.finished?i.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n),this},Object.defineProperty(S.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),S.prototype.destroy=d.destroy,S.prototype._undestroy=d.undestroy,S.prototype._destroy=function(e,t){t(e)}}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":209,"./_stream_duplex":210,"./internal/streams/destroy":217,"./internal/streams/state":221,"./internal/streams/stream":222,_process:285,buffer:168,inherits:201,"util-deprecate":393}],215:[function(e,t,i){(function(i){(function(){"use strict";var n;function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var o=e("./end-of-stream"),s=Symbol("lastResolve"),a=Symbol("lastReject"),l=Symbol("error"),c=Symbol("ended"),u=Symbol("lastPromise"),d=Symbol("handlePromise"),p=Symbol("stream");function h(e,t){return{value:e,done:t}}function f(e){var t=e[s];if(null!==t){var i=e[p].read();null!==i&&(e[u]=null,e[s]=null,e[a]=null,t(h(i,!1)))}}function m(e){i.nextTick(f,e)}var g=Object.getPrototypeOf((function(){})),b=Object.setPrototypeOf((r(n={get stream(){return this[p]},next:function(){var e=this,t=this[l];if(null!==t)return Promise.reject(t);if(this[c])return Promise.resolve(h(void 0,!0));if(this[p].destroyed)return new Promise((function(t,n){i.nextTick((function(){e[l]?n(e[l]):t(h(void 0,!0))}))}));var n,r=this[u];if(r)n=new Promise(function(e,t){return function(i,n){e.then((function(){t[c]?i(h(void 0,!0)):t[d](i,n)}),n)}}(r,this));else{var o=this[p].read();if(null!==o)return Promise.resolve(h(o,!1));n=new Promise(this[d])}return this[u]=n,n}},Symbol.asyncIterator,(function(){return this})),r(n,"return",(function(){var e=this;return new Promise((function(t,i){e[p].destroy(null,(function(e){e?i(e):t(h(void 0,!0))}))}))})),n),g);t.exports=function(e){var t,i=Object.create(b,(r(t={},p,{value:e,writable:!0}),r(t,s,{value:null,writable:!0}),r(t,a,{value:null,writable:!0}),r(t,l,{value:null,writable:!0}),r(t,c,{value:e._readableState.endEmitted,writable:!0}),r(t,d,{value:function(e,t){var n=i[p].read();n?(i[u]=null,i[s]=null,i[a]=null,e(h(n,!1))):(i[s]=e,i[a]=t)},writable:!0}),t));return i[u]=null,o(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=i[a];return null!==t&&(i[u]=null,i[s]=null,i[a]=null,t(e)),void(i[l]=e)}var n=i[s];null!==n&&(i[u]=null,i[s]=null,i[a]=null,n(h(void 0,!0))),i[c]=!0})),e.on("readable",m.bind(null,i)),i}}).call(this)}).call(this,e("_process"))},{"./end-of-stream":218,_process:285}],216:[function(e,t,i){"use strict";function n(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=e("buffer").Buffer,a=e("util").inspect,l=a&&a.custom||"inspect";function c(e,t,i){s.prototype.copy.call(e,t,i)}t.exports=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.head=null,this.tail=null,this.length=0}return function(e,t,i){t&&o(e.prototype,t),i&&o(e,i)}(e,[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,i=""+t.data;t=t.next;)i+=e+t.data;return i}},{key:"concat",value:function(e){if(0===this.length)return s.alloc(0);for(var t=s.allocUnsafe(e>>>0),i=this.head,n=0;i;)c(i.data,t,n),n+=i.data.length,i=i.next;return t}},{key:"consume",value:function(e,t){var i;return e<this.head.data.length?(i=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):i=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,i=1,n=t.data;for(e-=n.length;t=t.next;){var r=t.data,o=e>r.length?r.length:e;if(o===r.length?n+=r:n+=r.slice(0,e),0==(e-=o)){o===r.length?(++i,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=r.slice(o));break}++i}return this.length-=i,n}},{key:"_getBuffer",value:function(e){var t=s.allocUnsafe(e),i=this.head,n=1;for(i.data.copy(t),e-=i.data.length;i=i.next;){var r=i.data,o=e>r.length?r.length:e;if(r.copy(t,t.length-e,0,o),0==(e-=o)){o===r.length?(++n,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=r.slice(o));break}++n}return this.length-=n,t}},{key:l,value:function(e,t){return a(this,function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?n(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}]),e}()},{buffer:168,util:167}],217:[function(e,t,i){(function(e){(function(){"use strict";function i(e,t){r(e,t),n(e)}function n(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function r(e,t){e.emit("error",t)}t.exports={destroy:function(t,o){var s=this,a=this._readableState&&this._readableState.destroyed,l=this._writableState&&this._writableState.destroyed;return a||l?(o?o(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,e.nextTick(r,this,t)):e.nextTick(r,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!o&&t?s._writableState?s._writableState.errorEmitted?e.nextTick(n,s):(s._writableState.errorEmitted=!0,e.nextTick(i,s,t)):e.nextTick(i,s,t):o?(e.nextTick(n,s),o(t)):e.nextTick(n,s)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var i=e._readableState,n=e._writableState;i&&i.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}}).call(this)}).call(this,e("_process"))},{_process:285}],218:[function(e,t,i){"use strict";var n=e("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function r(){}t.exports=function e(t,i,o){if("function"==typeof i)return e(t,null,i);i||(i={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];e.apply(this,n)}}}(o||r);var s=i.readable||!1!==i.readable&&t.readable,a=i.writable||!1!==i.writable&&t.writable,l=function(){t.writable||u()},c=t._writableState&&t._writableState.finished,u=function(){a=!1,c=!0,s||o.call(t)},d=t._readableState&&t._readableState.endEmitted,p=function(){s=!1,d=!0,a||o.call(t)},h=function(e){o.call(t,e)},f=function(){var e;return s&&!d?(t._readableState&&t._readableState.ended||(e=new n),o.call(t,e)):a&&!c?(t._writableState&&t._writableState.ended||(e=new n),o.call(t,e)):void 0},m=function(){t.req.on("finish",u)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",u),t.on("abort",f),t.req?m():t.on("request",m)):a&&!t._writableState&&(t.on("end",l),t.on("close",l)),t.on("end",p),t.on("finish",u),!1!==i.error&&t.on("error",h),t.on("close",f),function(){t.removeListener("complete",u),t.removeListener("abort",f),t.removeListener("request",m),t.req&&t.req.removeListener("finish",u),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",u),t.removeListener("end",p),t.removeListener("error",h),t.removeListener("close",f)}}},{"../../../errors":209}],219:[function(e,t,i){t.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],220:[function(e,t,i){"use strict";var n;var r=e("../../../errors").codes,o=r.ERR_MISSING_ARGS,s=r.ERR_STREAM_DESTROYED;function a(e){if(e)throw e}function l(t,i,r,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var a=!1;t.on("close",(function(){a=!0})),void 0===n&&(n=e("./end-of-stream")),n(t,{readable:i,writable:r},(function(e){if(e)return o(e);a=!0,o()}));var l=!1;return function(e){if(!a&&!l)return l=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void o(e||new s("pipe"))}}function c(e){e()}function u(e,t){return e.pipe(t)}function d(e){return e.length?"function"!=typeof e[e.length-1]?a:e.pop():a}t.exports=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var n,r=d(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new o("streams");var s=t.map((function(e,i){var o=i<t.length-1;return l(e,o,i>0,(function(e){n||(n=e),e&&s.forEach(c),o||(s.forEach(c),r(n))}))}));return t.reduce(u)}},{"../../../errors":209,"./end-of-stream":218}],221:[function(e,t,i){"use strict";var n=e("../../../errors").codes.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(e,t,i,r){var o=function(e,t,i){return null!=e.highWaterMark?e.highWaterMark:t?e[i]:null}(t,r,i);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new n(r?i:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},{"../../../errors":209}],222:[function(e,t,i){t.exports=e("events").EventEmitter},{events:195}],223:[function(e,t,i){(i=t.exports=e("./lib/_stream_readable.js")).Stream=i,i.Readable=i,i.Writable=e("./lib/_stream_writable.js"),i.Duplex=e("./lib/_stream_duplex.js"),i.Transform=e("./lib/_stream_transform.js"),i.PassThrough=e("./lib/_stream_passthrough.js"),i.finished=e("./lib/internal/streams/end-of-stream.js"),i.pipeline=e("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":210,"./lib/_stream_passthrough.js":211,"./lib/_stream_readable.js":212,"./lib/_stream_transform.js":213,"./lib/_stream_writable.js":214,"./lib/internal/streams/end-of-stream.js":218,"./lib/internal/streams/pipeline.js":220}],224:[function(e,t,i){var n=e("level-errors").WriteError,r=e("./promisify"),o=e("./common").getCallback,s=e("./common").getOptions;function a(e){this._levelup=e,this.batch=e.db.batch(),this.ops=[],this.length=0}a.prototype.put=function(e,t){try{this.batch.put(e,t)}catch(e){throw new n(e)}return this.ops.push({type:"put",key:e,value:t}),this.length++,this},a.prototype.del=function(e){try{this.batch.del(e)}catch(e){throw new n(e)}return this.ops.push({type:"del",key:e}),this.length++,this},a.prototype.clear=function(){try{this.batch.clear()}catch(e){throw new n(e)}return this.ops=[],this.length=0,this},a.prototype.write=function(e,t){var i,a=this._levelup,l=this.ops;(t=o(e,t))||(i=(t=r()).promise),e=s(e);try{this.batch.write(e,(function(e){if(e)return t(new n(e));a.emit("batch",l),t()}))}catch(e){throw new n(e)}return i},t.exports=a},{"./common":225,"./promisify":227,"level-errors":207}],225:[function(e,t,i){i.getCallback=function(e,t){return"function"==typeof e?e:t},i.getOptions=function(e){return"object"==typeof e&&null!==e?e:{}}},{}],226:[function(e,t,i){(function(i){(function(){var n=e("events").EventEmitter,r=e("util").inherits,o=e("xtend"),s=e("deferred-leveldown"),a=e("level-iterator-stream"),l=e("./batch"),c=e("level-errors"),u=e("assert"),d=e("./promisify"),p=e("./common").getCallback,h=e("./common").getOptions,f=c.WriteError,m=c.ReadError,g=c.NotFoundError,b=c.OpenError,v=c.InitializationError;function y(e,t,r){if(!(this instanceof y))return new y(e,t,r);var o;if(n.call(this),this.setMaxListeners(1/0),"function"==typeof t&&(r=t,t={}),t=t||{},!e||"object"!=typeof e){if(o=new v("First argument must be an abstract-leveldown compliant store"),"function"==typeof r)return i.nextTick(r,o);throw o}u.strictEqual(typeof e.status,"string",".status required, old abstract-leveldown"),this.options=h(t),this._db=e,this.db=new s(e),this.open(r)}function k(e,t){if(!e._isOpening()&&!e.isOpen())return i.nextTick(t,new m("Database is not open")),!0}y.prototype.emit=n.prototype.emit,y.prototype.once=n.prototype.once,r(y,n),y.prototype.open=function(e,t){var n,r=this;return"function"==typeof e&&(t=e,e=null),t||(n=(t=d()).promise),e||(e=this.options),this.isOpen()?(i.nextTick(t,null,r),n):this._isOpening()?(this.once("open",(function(){t(null,r)})),n):(this.emit("opening"),this.db.open(e,(function(e){if(e)return t(new b(e));r.db=r._db,t(null,r),r.emit("open"),r.emit("ready")})),n)},y.prototype.close=function(e){var t,n=this;return e||(t=(e=d()).promise),this.isOpen()?(this.db.close((function(){n.emit("closed"),e.apply(null,arguments)})),this.emit("closing"),this.db=new s(this._db)):this.isClosed()?i.nextTick(e):"closing"===this.db.status?this.once("closed",e):this._isOpening()&&this.once("open",(function(){n.close(e)})),t},y.prototype.isOpen=function(){return"open"===this.db.status},y.prototype._isOpening=function(){return"opening"===this.db.status},y.prototype.isClosed=function(){return/^clos|new/.test(this.db.status)},y.prototype.get=function(e,t,i){if(null==e)throw new m("get() requires a key argument");var n;return(i=p(t,i))||(n=(i=d()).promise),k(this,i)||(t=h(t),this.db.get(e,t,(function(t,n){if(t)return t=/notfound/i.test(t)||t.notFound?new g("Key not found in database ["+e+"]",t):new m(t),i(t);i(null,n)}))),n},y.prototype.put=function(e,t,i,n){if(null==e)throw new f("put() requires a key argument");var r,o=this;return(n=p(i,n))||(r=(n=d()).promise),k(this,n)||(i=h(i),this.db.put(e,t,i,(function(i){if(i)return n(new f(i));o.emit("put",e,t),n()}))),r},y.prototype.del=function(e,t,i){if(null==e)throw new f("del() requires a key argument");var n,r=this;return(i=p(t,i))||(n=(i=d()).promise),k(this,i)||(t=h(t),this.db.del(e,t,(function(t){if(t)return i(new f(t));r.emit("del",e),i()}))),n},y.prototype.batch=function(e,t,i){if(!arguments.length)return new l(this);if(!Array.isArray(e))throw new f("batch() requires an array argument");var n,r=this;return(i=p(t,i))||(n=(i=d()).promise),k(this,i)||(t=h(t),this.db.batch(e,t,(function(t){if(t)return i(new f(t));r.emit("batch",e),i()}))),n},y.prototype.iterator=function(e){return this.db.iterator(e)},y.prototype.readStream=y.prototype.createReadStream=function(e){return"number"!=typeof(e=o({keys:!0,values:!0},e)).limit&&(e.limit=-1),new a(this.db.iterator(e),e)},y.prototype.keyStream=y.prototype.createKeyStream=function(e){return this.createReadStream(o(e,{keys:!0,values:!1}))},y.prototype.valueStream=y.prototype.createValueStream=function(e){return this.createReadStream(o(e,{keys:!1,values:!0}))},y.prototype.toString=function(){return"LevelUP"},y.errors=c,t.exports=y.default=y}).call(this)}).call(this,e("_process"))},{"./batch":224,"./common":225,"./promisify":227,_process:285,assert:162,"deferred-leveldown":233,events:195,"level-errors":207,"level-iterator-stream":208,util:396,xtend:399}],227:[function(e,t,i){t.exports=function(){var e,t=new Promise((function(t,i){e=function(e,n){e?i(e):t(n)}}));return e.promise=t,e}},{}],228:[function(e,t,i){function n(e){if("object"!=typeof e||null===e)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=e,this._operations=[],this._written=!1}n.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},n.prototype.put=function(e,t){this._checkWritten();var i=this.db._checkKey(e)||this.db._checkValue(t);if(i)throw i;return e=this.db._serializeKey(e),t=this.db._serializeValue(t),this._put(e,t),this},n.prototype._put=function(e,t){this._operations.push({type:"put",key:e,value:t})},n.prototype.del=function(e){this._checkWritten();var t=this.db._checkKey(e);if(t)throw t;return e=this.db._serializeKey(e),this._del(e),this},n.prototype._del=function(e){this._operations.push({type:"del",key:e})},n.prototype.clear=function(){return this._checkWritten(),this._clear(),this},n.prototype._clear=function(){this._operations=[]},n.prototype.write=function(e,t){if(this._checkWritten(),"function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("write() requires a callback argument");"object"==typeof e&&null!==e||(e={}),this._written=!0,this._write(e,t)},n.prototype._write=function(e,t){this.db._batch(this._operations,e,t)},t.exports=n},{}],229:[function(e,t,i){(function(e){(function(){function i(e){if("object"!=typeof e||null===e)throw new TypeError("First argument must be an abstract-leveldown compliant store");this.db=e,this._ended=!1,this._nexting=!1}i.prototype.next=function(t){var i=this;if("function"!=typeof t)throw new Error("next() requires a callback argument");return i._ended?(e.nextTick(t,new Error("cannot call next() after end()")),i):i._nexting?(e.nextTick(t,new Error("cannot call next() before previous next() has completed")),i):(i._nexting=!0,i._next((function(){i._nexting=!1,t.apply(null,arguments)})),i)},i.prototype._next=function(t){e.nextTick(t)},i.prototype.seek=function(e){if(this._ended)throw new Error("cannot call seek() after end()");if(this._nexting)throw new Error("cannot call seek() before next() has completed");e=this.db._serializeKey(e),this._seek(e)},i.prototype._seek=function(e){},i.prototype.end=function(t){if("function"!=typeof t)throw new Error("end() requires a callback argument");if(this._ended)return e.nextTick(t,new Error("end() already called on iterator"));this._ended=!0,this._end(t)},i.prototype._end=function(t){e.nextTick(t)},t.exports=i}).call(this)}).call(this,e("_process"))},{_process:285}],230:[function(e,t,i){(function(i,n){(function(){var r=e("xtend"),o=e("./abstract-iterator"),s=e("./abstract-chained-batch"),a=Object.prototype.hasOwnProperty,l="start end gt gte lt lte".split(" ");function c(){this.status="new"}function u(e){return-1!==l.indexOf(e)}c.prototype.open=function(e,t){var i=this,n=this.status;if("function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("open() requires a callback argument");"object"==typeof e&&null!==e||(e={}),e.createIfMissing=!1!==e.createIfMissing,e.errorIfExists=!!e.errorIfExists,this.status="opening",this._open(e,(function(e){if(e)return i.status=n,t(e);i.status="open",t()}))},c.prototype._open=function(e,t){n.nextTick(t)},c.prototype.close=function(e){var t=this,i=this.status;if("function"!=typeof e)throw new Error("close() requires a callback argument");this.status="closing",this._close((function(n){if(n)return t.status=i,e(n);t.status="closed",e()}))},c.prototype._close=function(e){n.nextTick(e)},c.prototype.get=function(e,t,i){if("function"==typeof t&&(i=t),"function"!=typeof i)throw new Error("get() requires a callback argument");var r=this._checkKey(e);if(r)return n.nextTick(i,r);e=this._serializeKey(e),"object"==typeof t&&null!==t||(t={}),t.asBuffer=!1!==t.asBuffer,this._get(e,t,i)},c.prototype._get=function(e,t,i){n.nextTick((function(){i(new Error("NotFound"))}))},c.prototype.put=function(e,t,i,r){if("function"==typeof i&&(r=i),"function"!=typeof r)throw new Error("put() requires a callback argument");var o=this._checkKey(e)||this._checkValue(t);if(o)return n.nextTick(r,o);e=this._serializeKey(e),t=this._serializeValue(t),"object"==typeof i&&null!==i||(i={}),this._put(e,t,i,r)},c.prototype._put=function(e,t,i,r){n.nextTick(r)},c.prototype.del=function(e,t,i){if("function"==typeof t&&(i=t),"function"!=typeof i)throw new Error("del() requires a callback argument");var r=this._checkKey(e);if(r)return n.nextTick(i,r);e=this._serializeKey(e),"object"==typeof t&&null!==t||(t={}),this._del(e,t,i)},c.prototype._del=function(e,t,i){n.nextTick(i)},c.prototype.batch=function(e,t,i){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(i=t),"function"==typeof e&&(i=e),"function"!=typeof i)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return n.nextTick(i,new Error("batch(array) requires an array argument"));if(0===e.length)return n.nextTick(i);"object"==typeof t&&null!==t||(t={});for(var o=new Array(e.length),s=0;s<e.length;s++){if("object"!=typeof e[s]||null===e[s])return n.nextTick(i,new Error("batch(array) element must be an object and not `null`"));var a=r(e[s]);if("put"!==a.type&&"del"!==a.type)return n.nextTick(i,new Error("`type` must be 'put' or 'del'"));var l=this._checkKey(a.key);if(l)return n.nextTick(i,l);if(a.key=this._serializeKey(a.key),"put"===a.type){var c=this._checkValue(a.value);if(c)return n.nextTick(i,c);a.value=this._serializeValue(a.value)}o[s]=a}this._batch(o,t,i)},c.prototype._batch=function(e,t,i){n.nextTick(i)},c.prototype._setupIteratorOptions=function(e){return(e=function(e,t){var i={};for(var n in t)if(a.call(t,n)){var r=t[n];u(n)&&(r=e._serializeKey(r)),i[n]=r}return i}(this,e)).reverse=!!e.reverse,e.keys=!1!==e.keys,e.values=!1!==e.values,e.limit="limit"in e?e.limit:-1,e.keyAsBuffer=!1!==e.keyAsBuffer,e.valueAsBuffer=!1!==e.valueAsBuffer,e},c.prototype.iterator=function(e){return"object"==typeof e&&null!==e||(e={}),e=this._setupIteratorOptions(e),this._iterator(e)},c.prototype._iterator=function(e){return new o(this)},c.prototype._chainedBatch=function(){return new s(this)},c.prototype._serializeKey=function(e){return e},c.prototype._serializeValue=function(e){return e},c.prototype._checkKey=function(e){return null==e?new Error("key cannot be `null` or `undefined`"):i.isBuffer(e)&&0===e.length?new Error("key cannot be an empty Buffer"):""===e?new Error("key cannot be an empty String"):Array.isArray(e)&&0===e.length?new Error("key cannot be an empty Array"):void 0},c.prototype._checkValue=function(e){if(null==e)return new Error("value cannot be `null` or `undefined`")},t.exports=c}).call(this)}).call(this,{isBuffer:e("../../../is-buffer/index.js")},e("_process"))},{"../../../is-buffer/index.js":203,"./abstract-chained-batch":228,"./abstract-iterator":229,_process:285,xtend:399}],231:[function(e,t,i){i.AbstractLevelDOWN=e("./abstract-leveldown"),i.AbstractIterator=e("./abstract-iterator"),i.AbstractChainedBatch=e("./abstract-chained-batch")},{"./abstract-chained-batch":228,"./abstract-iterator":229,"./abstract-leveldown":230}],232:[function(e,t,i){var n=e("abstract-leveldown").AbstractIterator;function r(e){n.call(this,e),this._options=e,this._iterator=null,this._operations=[]}e("inherits")(r,n),r.prototype.setDb=function(e){var t=this._iterator=e.iterator(this._options);this._operations.forEach((function(e){t[e.method].apply(t,e.args)}))},r.prototype._operation=function(e,t){if(this._iterator)return this._iterator[e].apply(this._iterator,t);this._operations.push({method:e,args:t})},"next end".split(" ").forEach((function(e){r.prototype["_"+e]=function(){this._operation(e,arguments)}})),r.prototype.seek=function(){this._operation("seek",arguments)},t.exports=r},{"abstract-leveldown":231,inherits:201}],233:[function(e,t,i){var n=e("abstract-leveldown").AbstractLevelDOWN,r=e("inherits"),o=e("./deferred-iterator"),s="put get del batch".split(" ");function a(e){n.call(this,""),this._db=e,this._operations=[],this._iterators=[],l(this)}function l(e){s.forEach((function(t){e["_"+t]=function(){this._operations.push({method:t,args:arguments})}})),"function"==typeof e._db.approximateSize&&(e.approximateSize=function(){this._operations.push({method:"approximateSize",args:arguments})}),e._iterator=function(e){var t=new o(e);return this._iterators.push(t),t}}r(a,n),a.prototype._open=function(e,t){var i=this;this._db.open(e,(function(e){if(e)return t(e);i._operations.forEach((function(e){i._db[e.method].apply(i._db,e.args)})),i._operations=[],i._iterators.forEach((function(e){e.setDb(i._db)})),i._iterators=[],function(e){s.concat("iterator").forEach((function(t){e["_"+t]=function(){return this._db[t].apply(this._db,arguments)}})),e._db.approximateSize&&(e.approximateSize=function(){return this._db.approximateSize.apply(this._db,arguments)})}(i),t()}))},a.prototype._close=function(e){var t=this;this._db.close((function(i){if(i)return e(i);l(t),e()}))},a.prototype._serializeKey=function(e){return e},a.prototype._serializeValue=function(e){return e},t.exports=a,t.exports.DeferredIterator=o},{"./deferred-iterator":232,"abstract-leveldown":231,inherits:201}],234:[function(e,t,i){var n=e("./_root").Symbol;t.exports=n},{"./_root":241}],235:[function(e,t,i){var n=e("./_Symbol"),r=e("./_getRawTag"),o=e("./_objectToString"),s=n?n.toStringTag:void 0;t.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?r(e):o(e)}},{"./_Symbol":234,"./_getRawTag":238,"./_objectToString":239}],236:[function(e,t,i){(function(e){(function(){var i="object"==typeof e&&e&&e.Object===Object&&e;t.exports=i}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],237:[function(e,t,i){var n=e("./_overArg")(Object.getPrototypeOf,Object);t.exports=n},{"./_overArg":240}],238:[function(e,t,i){var n=e("./_Symbol"),r=Object.prototype,o=r.hasOwnProperty,s=r.toString,a=n?n.toStringTag:void 0;t.exports=function(e){var t=o.call(e,a),i=e[a];try{e[a]=void 0;var n=!0}catch(e){}var r=s.call(e);return n&&(t?e[a]=i:delete e[a]),r}},{"./_Symbol":234}],239:[function(e,t,i){var n=Object.prototype.toString;t.exports=function(e){return n.call(e)}},{}],240:[function(e,t,i){t.exports=function(e,t){return function(i){return e(t(i))}}},{}],241:[function(e,t,i){var n=e("./_freeGlobal"),r="object"==typeof self&&self&&self.Object===Object&&self,o=n||r||Function("return this")();t.exports=o},{"./_freeGlobal":236}],242:[function(e,t,i){t.exports=function(e){return null!=e&&"object"==typeof e}},{}],243:[function(e,t,i){var n=e("./_baseGetTag"),r=e("./_getPrototype"),o=e("./isObjectLike"),s=Function.prototype,a=Object.prototype,l=s.toString,c=a.hasOwnProperty,u=l.call(Object);t.exports=function(e){if(!o(e)||"[object Object]"!=n(e))return!1;var t=r(e);if(null===t)return!0;var i=c.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&l.call(i)==u}},{"./_baseGetTag":235,"./_getPrototype":237,"./isObjectLike":242}],244:[function(e,t,i){(function(e){(function(){function t(e){return void 0!==e&&""!==e}function n(e,t){return Object.hasOwnProperty.call(e,t)}function r(e,t){return Object.hasOwnProperty.call(e,t)&&t}i.compare=function(t,i){if(e.isBuffer(t)){for(var n=Math.min(t.length,i.length),r=0;r<n;r++){var o=t[r]-i[r];if(o)return o}return t.length-i.length}return t<i?-1:t>i?1:0};var o=i.lowerBoundKey=function(e){return r(e,"gt")||r(e,"gte")||r(e,"min")||(e.reverse?r(e,"end"):r(e,"start"))||void 0},s=i.lowerBound=function(e,t){var i=o(e);return i?e[i]:t},a=i.lowerBoundInclusive=function(e){return!n(e,"gt")},l=i.upperBoundInclusive=function(e){return!n(e,"lt")},c=i.lowerBoundExclusive=function(e){return!a(e)},u=i.upperBoundExclusive=function(e){return!l(e)},d=i.upperBoundKey=function(e){return r(e,"lt")||r(e,"lte")||r(e,"max")||(e.reverse?r(e,"start"):r(e,"end"))||void 0},p=i.upperBound=function(e,t){var i=d(e);return i?e[i]:t};function h(e){return e}i.start=function(e,t){return e.reverse?p(e,t):s(e,t)},i.end=function(e,t){return e.reverse?s(e,t):p(e,t)},i.startInclusive=function(e){return e.reverse?l(e):a(e)},i.endInclusive=function(e){return e.reverse?a(e):l(e)},i.toLtgt=function(e,t,r,o,s){t=t||{},r=r||h;var a=arguments.length>3,l=i.lowerBoundKey(e),c=i.upperBoundKey(e);return l?"gt"===l?t.gt=r(e.gt,!1):t.gte=r(e[l],!1):a&&(t.gte=r(o,!1)),c?"lt"===c?t.lt=r(e.lt,!0):t.lte=r(e[c],!0):a&&(t.lte=r(s,!0)),null!=e.reverse&&(t.reverse=!!e.reverse),n(t,"max")&&delete t.max,n(t,"min")&&delete t.min,n(t,"start")&&delete t.start,n(t,"end")&&delete t.end,t},i.contains=function(e,n,r){r=r||i.compare;var o=s(e);if(t(o)&&((a=r(n,o))<0||0===a&&c(e)))return!1;var a,l=p(e);return!t(l)||!((a=r(n,l))>0||0===a&&u(e))},i.filter=function(e,t){return function(n){return i.contains(e,n,t)}}}).call(this)}).call(this,{isBuffer:e("../is-buffer/index.js")})},{"../is-buffer/index.js":203}],245:[function(e,t,i){(function(e){(function(){!function(e){"use strict";var n={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:g,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:g,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ {0,3}\[(label)\]: *\n? *<?([^\s>]+)>?(?:(?: +\n? *| *\n *)(title))? *(?:\n+|$)/,table:g,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,paragraph:/^([^\n]+(?:\n?(?!hr|heading|lheading| {0,3}>|tag)[^\n]+)+)/,text:/^[^\n]+/};function r(e){this.tokens=[],this.tokens.links={},this.options=e||v.defaults,this.rules=n.normal,this.options.gfm&&(this.options.tables?this.rules=n.tables:this.rules=n.gfm)}n._label=/(?:\\[\[\]]|[^\[\]])+/,n._title=/(?:"(?:\\"|[^"]|"[^"\n]*")*"|'\n?(?:[^'\n]+\n?)*'|\([^()]*\))/,n.def=p(n.def).replace("label",n._label).replace("title",n._title).getRegex(),n.bullet=/(?:[*+-]|\d+\.)/,n.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,n.item=p(n.item,"gm").replace(/bull/g,n.bullet).getRegex(),n.list=p(n.list).replace(/bull/g,n.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+n.def.source+")").getRegex(),n._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b",n.html=p(n.html).replace("comment",/<!--[\s\S]*?-->/).replace("closed",/<(tag)[\s\S]+?<\/\1>/).replace("closing",/<tag(?:"[^"]*"|'[^']*'|\s[^'"\/>\s]*)*?\/?>/).replace(/tag/g,n._tag).getRegex(),n.paragraph=p(n.paragraph).replace("hr",n.hr).replace("heading",n.heading).replace("lheading",n.lheading).replace("tag","<"+n._tag).getRegex(),n.blockquote=p(n.blockquote).replace("paragraph",n.paragraph).getRegex(),n.normal=b({},n),n.gfm=b({},n.normal,{fences:/^ *(`{3,}|~{3,})[ \.]*(\S+)? *\n([\s\S]*?)\n? *\1 *(?:\n+|$)/,paragraph:/^/,heading:/^ *(#{1,6}) +([^\n]+?) *#* *(?:\n+|$)/}),n.gfm.paragraph=p(n.paragraph).replace("(?!","(?!"+n.gfm.fences.source.replace("\\1","\\2")+"|"+n.list.source.replace("\\1","\\3")+"|").getRegex(),n.tables=b({},n.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),r.rules=n,r.lex=function(e,t){return new r(t).lex(e)},r.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},r.prototype.token=function(e,t){var i,r,o,s,a,l,c,u,d,p,h;for(e=e.replace(/^ +$/gm,"");e;)if((o=this.rules.newline.exec(e))&&(e=e.substring(o[0].length),o[0].length>1&&this.tokens.push({type:"space"})),o=this.rules.code.exec(e))e=e.substring(o[0].length),o=o[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?o:o.replace(/\n+$/,"")});else if(o=this.rules.fences.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"code",lang:o[2],text:o[3]||""});else if(o=this.rules.heading.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"heading",depth:o[1].length,text:o[2]});else if(t&&(o=this.rules.nptable.exec(e))){for(e=e.substring(o[0].length),l={type:"table",header:o[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:o[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:o[3].replace(/\n$/,"").split("\n")},u=0;u<l.align.length;u++)/^ *-+: *$/.test(l.align[u])?l.align[u]="right":/^ *:-+: *$/.test(l.align[u])?l.align[u]="center":/^ *:-+ *$/.test(l.align[u])?l.align[u]="left":l.align[u]=null;for(u=0;u<l.cells.length;u++)l.cells[u]=l.cells[u].split(/ *\| */);this.tokens.push(l)}else if(o=this.rules.hr.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"hr"});else if(o=this.rules.blockquote.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"blockquote_start"}),o=o[0].replace(/^ *> ?/gm,""),this.token(o,t),this.tokens.push({type:"blockquote_end"});else if(o=this.rules.list.exec(e)){for(e=e.substring(o[0].length),h=(s=o[2]).length>1,this.tokens.push({type:"list_start",ordered:h,start:h?+s:""}),i=!1,p=(o=o[0].match(this.rules.item)).length,u=0;u<p;u++)c=(l=o[u]).length,~(l=l.replace(/^ *([*+-]|\d+\.) +/,"")).indexOf("\n ")&&(c-=l.length,l=this.options.pedantic?l.replace(/^ {1,4}/gm,""):l.replace(new RegExp("^ {1,"+c+"}","gm"),"")),this.options.smartLists&&u!==p-1&&(s===(a=n.bullet.exec(o[u+1])[0])||s.length>1&&a.length>1||(e=o.slice(u+1).join("\n")+e,u=p-1)),r=i||/\n\n(?!\s*$)/.test(l),u!==p-1&&(i="\n"===l.charAt(l.length-1),r||(r=i)),this.tokens.push({type:r?"loose_item_start":"list_item_start"}),this.token(l,!1),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(o=this.rules.html.exec(e))e=e.substring(o[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:!this.options.sanitizer&&("pre"===o[1]||"script"===o[1]||"style"===o[1]),text:o[0]});else if(t&&(o=this.rules.def.exec(e)))e=e.substring(o[0].length),o[3]&&(o[3]=o[3].substring(1,o[3].length-1)),d=o[1].toLowerCase(),this.tokens.links[d]||(this.tokens.links[d]={href:o[2],title:o[3]});else if(t&&(o=this.rules.table.exec(e))){for(e=e.substring(o[0].length),l={type:"table",header:o[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:o[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:o[3].replace(/(?: *\| *)?\n$/,"").split("\n")},u=0;u<l.align.length;u++)/^ *-+: *$/.test(l.align[u])?l.align[u]="right":/^ *:-+: *$/.test(l.align[u])?l.align[u]="center":/^ *:-+ *$/.test(l.align[u])?l.align[u]="left":l.align[u]=null;for(u=0;u<l.cells.length;u++)l.cells[u]=l.cells[u].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(l)}else if(o=this.rules.lheading.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"heading",depth:"="===o[2]?1:2,text:o[1]});else if(t&&(o=this.rules.paragraph.exec(e)))e=e.substring(o[0].length),this.tokens.push({type:"paragraph",text:"\n"===o[1].charAt(o[1].length-1)?o[1].slice(0,-1):o[1]});else if(o=this.rules.text.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"text",text:o[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var o={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:g,tag:/^<!--[\s\S]*?-->|^<\/?[a-zA-Z0-9\-]+(?:"[^"]*"|'[^']*'|\s[^<'">\/\s]*)*?\/?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^_([^\s_](?:[^_]|__)+?[^\s_])_\b|^\*((?:\*\*|[^*])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`]?)\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:g,text:/^[\s\S]+?(?=[\\<!\[`*]|\b_| {2,}\n|$)/};function s(e,t){if(this.options=t||v.defaults,this.links=e,this.rules=o.normal,this.renderer=this.options.renderer||new a,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=o.breaks:this.rules=o.gfm:this.options.pedantic&&(this.rules=o.pedantic)}function a(e){this.options=e||{}}function l(){}function c(e){this.tokens=[],this.token=null,this.options=e||v.defaults,this.options.renderer=this.options.renderer||new a,this.renderer=this.options.renderer,this.renderer.options=this.options}function u(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function d(e){return e.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,(function(e,t){return"colon"===(t=t.toLowerCase())?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""}))}function p(e,t){return e=e.source,t=t||"",{replace:function(t,i){return i=(i=i.source||i).replace(/(^|[^\[])\^/g,"$1"),e=e.replace(t,i),this},getRegex:function(){return new RegExp(e,t)}}}function h(e,t){return f[" "+e]||(/^[^:]+:\/*[^/]*$/.test(e)?f[" "+e]=e+"/":f[" "+e]=e.replace(/[^/]*$/,"")),e=f[" "+e],"//"===t.slice(0,2)?e.replace(/:[\s\S]*/,":")+t:"/"===t.charAt(0)?e.replace(/(:\/*[^/]*)[\s\S]*/,"$1")+t:e+t}o._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,o._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,o.autolink=p(o.autolink).replace("scheme",o._scheme).replace("email",o._email).getRegex(),o._inside=/(?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]]|\](?=[^\[]*\]))*/,o._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,o.link=p(o.link).replace("inside",o._inside).replace("href",o._href).getRegex(),o.reflink=p(o.reflink).replace("inside",o._inside).getRegex(),o.normal=b({},o),o.pedantic=b({},o.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),o.gfm=b({},o.normal,{escape:p(o.escape).replace("])","~|])").getRegex(),url:p(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("email",o._email).getRegex(),_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:p(o.text).replace("]|","~]|").replace("|","|https?://|ftp://|www\\.|[a-zA-Z0-9.!#$%&'*+/=?^_`{\\|}~-]+@|").getRegex()}),o.breaks=b({},o.gfm,{br:p(o.br).replace("{2,}","*").getRegex(),text:p(o.gfm.text).replace("{2,}","*").getRegex()}),s.rules=o,s.output=function(e,t,i){return new s(t,i).output(e)},s.prototype.output=function(e){for(var t,i,n,r,o="";e;)if(r=this.rules.escape.exec(e))e=e.substring(r[0].length),o+=r[1];else if(r=this.rules.autolink.exec(e))e=e.substring(r[0].length),n="@"===r[2]?"mailto:"+(i=u(this.mangle(r[1]))):i=u(r[1]),o+=this.renderer.link(n,null,i);else if(this.inLink||!(r=this.rules.url.exec(e))){if(r=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(r[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(r[0])&&(this.inLink=!1),e=e.substring(r[0].length),o+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):u(r[0]):r[0];else if(r=this.rules.link.exec(e))e=e.substring(r[0].length),this.inLink=!0,o+=this.outputLink(r,{href:r[2],title:r[3]}),this.inLink=!1;else if((r=this.rules.reflink.exec(e))||(r=this.rules.nolink.exec(e))){if(e=e.substring(r[0].length),t=(r[2]||r[1]).replace(/\s+/g," "),!(t=this.links[t.toLowerCase()])||!t.href){o+=r[0].charAt(0),e=r[0].substring(1)+e;continue}this.inLink=!0,o+=this.outputLink(r,t),this.inLink=!1}else if(r=this.rules.strong.exec(e))e=e.substring(r[0].length),o+=this.renderer.strong(this.output(r[2]||r[1]));else if(r=this.rules.em.exec(e))e=e.substring(r[0].length),o+=this.renderer.em(this.output(r[2]||r[1]));else if(r=this.rules.code.exec(e))e=e.substring(r[0].length),o+=this.renderer.codespan(u(r[2].trim(),!0));else if(r=this.rules.br.exec(e))e=e.substring(r[0].length),o+=this.renderer.br();else if(r=this.rules.del.exec(e))e=e.substring(r[0].length),o+=this.renderer.del(this.output(r[1]));else if(r=this.rules.text.exec(e))e=e.substring(r[0].length),o+=this.renderer.text(u(this.smartypants(r[0])));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}else r[0]=this.rules._backpedal.exec(r[0])[0],e=e.substring(r[0].length),"@"===r[2]?n="mailto:"+(i=u(r[0])):(i=u(r[0]),n="www."===r[1]?"http://"+i:i),o+=this.renderer.link(n,null,i);return o},s.prototype.outputLink=function(e,t){var i=u(t.href),n=t.title?u(t.title):null;return"!"!==e[0].charAt(0)?this.renderer.link(i,n,this.output(e[1])):this.renderer.image(i,n,u(e[1]))},s.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/---/g,"").replace(/--/g,"").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1").replace(/'/g,"").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1").replace(/"/g,"").replace(/\.{3}/g,""):e},s.prototype.mangle=function(e){if(!this.options.mangle)return e;for(var t,i="",n=e.length,r=0;r<n;r++)t=e.charCodeAt(r),Math.random()>.5&&(t="x"+t.toString(16)),i+="&#"+t+";";return i},a.prototype.code=function(e,t,i){if(this.options.highlight){var n=this.options.highlight(e,t);null!=n&&n!==e&&(i=!0,e=n)}return t?'<pre><code class="'+this.options.langPrefix+u(t,!0)+'">'+(i?e:u(e,!0))+"\n</code></pre>\n":"<pre><code>"+(i?e:u(e,!0))+"\n</code></pre>"},a.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},a.prototype.html=function(e){return e},a.prototype.heading=function(e,t,i){return"<h"+t+' id="'+this.options.headerPrefix+i.toLowerCase().replace(/[^\w]+/g,"-")+'">'+e+"</h"+t+">\n"},a.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},a.prototype.list=function(e,t,i){var n=t?"ol":"ul";return"<"+n+(t&&1!==i?' start="'+i+'"':"")+">\n"+e+"</"+n+">\n"},a.prototype.listitem=function(e){return"<li>"+e+"</li>\n"},a.prototype.paragraph=function(e){return"<p>"+e+"</p>\n"},a.prototype.table=function(e,t){return"<table>\n<thead>\n"+e+"</thead>\n<tbody>\n"+t+"</tbody>\n</table>\n"},a.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},a.prototype.tablecell=function(e,t){var i=t.header?"th":"td";return(t.align?"<"+i+' style="text-align:'+t.align+'">':"<"+i+">")+e+"</"+i+">\n"},a.prototype.strong=function(e){return"<strong>"+e+"</strong>"},a.prototype.em=function(e){return"<em>"+e+"</em>"},a.prototype.codespan=function(e){return"<code>"+e+"</code>"},a.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},a.prototype.del=function(e){return"<del>"+e+"</del>"},a.prototype.link=function(e,t,i){if(this.options.sanitize){try{var n=decodeURIComponent(d(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return i}if(0===n.indexOf("javascript:")||0===n.indexOf("vbscript:")||0===n.indexOf("data:"))return i}this.options.baseUrl&&!m.test(e)&&(e=h(this.options.baseUrl,e));var r='<a href="'+e+'"';return t&&(r+=' title="'+t+'"'),r+">"+i+"</a>"},a.prototype.image=function(e,t,i){this.options.baseUrl&&!m.test(e)&&(e=h(this.options.baseUrl,e));var n='<img src="'+e+'" alt="'+i+'"';return t&&(n+=' title="'+t+'"'),n+(this.options.xhtml?"/>":">")},a.prototype.text=function(e){return e},l.prototype.strong=l.prototype.em=l.prototype.codespan=l.prototype.del=l.prototype.text=function(e){return e},l.prototype.link=l.prototype.image=function(e,t,i){return""+i},l.prototype.br=function(){return""},c.parse=function(e,t){return new c(t).parse(e)},c.prototype.parse=function(e){this.inline=new s(e.links,this.options),this.inlineText=new s(e.links,b({},this.options,{renderer:new l})),this.tokens=e.reverse();for(var t="";this.next();)t+=this.tok();return t},c.prototype.next=function(){return this.token=this.tokens.pop()},c.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},c.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},c.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,d(this.inlineText.output(this.token.text)));case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var e,t,i,n,r="",o="";for(i="",e=0;e<this.token.header.length;e++)i+=this.renderer.tablecell(this.inline.output(this.token.header[e]),{header:!0,align:this.token.align[e]});for(r+=this.renderer.tablerow(i),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],i="",n=0;n<t.length;n++)i+=this.renderer.tablecell(this.inline.output(t[n]),{header:!1,align:this.token.align[n]});o+=this.renderer.tablerow(i)}return this.renderer.table(r,o);case"blockquote_start":for(o="";"blockquote_end"!==this.next().type;)o+=this.tok();return this.renderer.blockquote(o);case"list_start":o="";for(var s=this.token.ordered,a=this.token.start;"list_end"!==this.next().type;)o+=this.tok();return this.renderer.list(o,s,a);case"list_item_start":for(o="";"list_item_end"!==this.next().type;)o+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(o);case"loose_item_start":for(o="";"list_item_end"!==this.next().type;)o+=this.tok();return this.renderer.listitem(o);case"html":var l=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(l);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}};var f={},m=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function g(){}function b(e){for(var t,i,n=1;n<arguments.length;n++)for(i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}function v(e,t,i){if(null==e)throw new Error("marked(): input parameter is undefined or null");if("string"!=typeof e)throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected");if(i||"function"==typeof t){i||(i=t,t=null);var n,o,s=(t=b({},v.defaults,t||{})).highlight,a=0;try{n=r.lex(e,t)}catch(e){return i(e)}o=n.length;var l=function(e){if(e)return t.highlight=s,i(e);var r;try{r=c.parse(n,t)}catch(t){e=t}return t.highlight=s,e?i(e):i(null,r)};if(!s||s.length<3)return l();if(delete t.highlight,!o)return l();for(;a<n.length;a++)!function(e){"code"!==e.type?--o||l():s(e.text,e.lang,(function(t,i){return t?l(t):null==i||i===e.text?--o||l():(e.text=i,e.escaped=!0,void(--o||l()))}))}(n[a])}else try{return t&&(t=b({},v.defaults,t)),c.parse(r.lex(e,t),t)}catch(e){if(e.message+="\nPlease report this to https://github.com/markedjs/marked.",(t||v.defaults).silent)return"<p>An error occurred:</p><pre>"+u(e.message+"",!0)+"</pre>";throw e}}g.exec=g,v.options=v.setOptions=function(e){return b(v.defaults,e),v},v.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,sanitizer:null,mangle:!0,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new a,xhtml:!1,baseUrl:null},v.Parser=c,v.parser=c.parse,v.Renderer=a,v.TextRenderer=l,v.Lexer=r,v.lexer=r.lex,v.InlineLexer=s,v.inlineLexer=s.output,v.parse=v,void 0!==t&&"object"==typeof i?t.exports=v:"function"==typeof define&&define.amd?define((function(){return v})):e.marked=v}(this||("undefined"!=typeof window?window:e))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],246:[function(e,t,i){t.exports=e("immediate")},{immediate:253}],247:[function(e,t,i){(function(i){(function(){var n=e("inherits"),r=e("abstract-leveldown").AbstractLevelDOWN,o=e("abstract-leveldown").AbstractIterator,s=e("ltgt"),a=e("functional-red-black-tree"),l={},c=e("./immediate");function u(e){return s.compare(e,this._end)>0}function d(e){return s.compare(e,this._end)>=0}function p(e){return s.compare(e,this._end)<0}function h(e){return s.compare(e,this._end)<=0}function f(e,t){o.call(this,e),this._limit=t.limit,-1===this._limit&&(this._limit=1/0);var i=e._store[e._location];this.keyAsBuffer=!1!==t.keyAsBuffer,this.valueAsBuffer=!1!==t.valueAsBuffer,this._reverse=t.reverse,this._options=t,this._done=0,this._reverse?(this._incr="prev",this._start=s.upperBound(t),this._end=s.lowerBound(t),void 0===this._start?this._tree=i.end:s.upperBoundInclusive(t)?this._tree=i.le(this._start):this._tree=i.lt(this._start),this._end&&(s.lowerBoundInclusive(t)?this._test=d:this._test=u)):(this._incr="next",this._start=s.lowerBound(t),this._end=s.upperBound(t),void 0===this._start?this._tree=i.begin:s.lowerBoundInclusive(t)?this._tree=i.ge(this._start):this._tree=i.gt(this._start),this._end&&(s.upperBoundInclusive(t)?this._test=h:this._test=p))}function m(e){if(!(this instanceof m))return new m(e);r.call(this,"string"==typeof e?e:""),this._location=this.location?"$"+this.location:"_tree",this._store=this.location?l:this,this._store[this._location]=this._store[this._location]||a(s.compare)}n(f,o),f.prototype._next=function(e){var t,n;return this._done++>=this._limit?c(e):this._tree.valid?(t=this._tree.key,n=this._tree.value,this._test(t)?(this.keyAsBuffer&&(t=new i(t)),this.valueAsBuffer&&(n=new i(n)),this._tree[this._incr](),void c((function(){e(null,t,n)}))):c(e)):c(e)},f.prototype._test=function(){return!0},m.clearGlobalStore=function(e){e?Object.keys(l).forEach((function(e){delete l[e]})):l={}},n(m,r),m.prototype._open=function(e,t){var i=this;c((function(){t(null,i)}))},m.prototype._put=function(e,t,i,n){null==t&&(t="");var r=this._store[this._location].find(e);r.valid?this._store[this._location]=r.update(t):this._store[this._location]=this._store[this._location].insert(e,t),c(n)},m.prototype._get=function(e,t,n){var r=this._store[this._location].get(e);if(void 0===r)return c((function(){n(new Error("NotFound"))}));!1===t.asBuffer||this._isBuffer(r)||(r=new i(String(r))),c((function(){n(null,r)}))},m.prototype._del=function(e,t,i){this._store[this._location]=this._store[this._location].remove(e),c(i)},m.prototype._batch=function(e,t,i){for(var n,r,o,s=-1,a=e.length,l=this._store[this._location];++s<a;)e[s]&&(n=this._isBuffer(e[s].key)?e[s].key:String(e[s].key),o=l.find(n),"put"===e[s].type?(r=this._isBuffer(e[s].value)?e[s].value:String(e[s].value),l=o.valid?o.update(r):l.insert(n,r)):l=o.remove());this._store[this._location]=l,c(i)},m.prototype._iterator=function(e){return new f(this,e)},m.prototype._isBuffer=function(e){return i.isBuffer(e)},m.destroy=function(e,t){var i="$"+e;i in l&&delete l[i],c(t)},t.exports=m}).call(this)}).call(this,e("buffer").Buffer)},{"./immediate":246,"abstract-leveldown":251,buffer:168,"functional-red-black-tree":197,inherits:201,ltgt:259}],248:[function(e,t,i){(function(e){(function(){function i(e){this._db=e,this._operations=[],this._written=!1}i.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")},i.prototype.put=function(e,t){this._checkWritten();var i=this._db._checkKey(e,"key",this._db._isBuffer);if(i)throw i;return this._db._isBuffer(e)||(e=String(e)),this._db._isBuffer(t)||(t=String(t)),"function"==typeof this._put?this._put(e,t):this._operations.push({type:"put",key:e,value:t}),this},i.prototype.del=function(e){this._checkWritten();var t=this._db._checkKey(e,"key",this._db._isBuffer);if(t)throw t;return this._db._isBuffer(e)||(e=String(e)),"function"==typeof this._del?this._del(e):this._operations.push({type:"del",key:e}),this},i.prototype.clear=function(){return this._checkWritten(),this._operations=[],"function"==typeof this._clear&&this._clear(),this},i.prototype.write=function(t,i){if(this._checkWritten(),"function"==typeof t&&(i=t),"function"!=typeof i)throw new Error("write() requires a callback argument");return"object"!=typeof t&&(t={}),this._written=!0,"function"==typeof this._write?this._write(i):"function"==typeof this._db._batch?this._db._batch(this._operations,t,i):void e.nextTick(i)},t.exports=i}).call(this)}).call(this,e("_process"))},{_process:285}],249:[function(e,t,i){(function(e){(function(){function i(e){this.db=e,this._ended=!1,this._nexting=!1}i.prototype.next=function(t){var i=this;if("function"!=typeof t)throw new Error("next() requires a callback argument");return i._ended?t(new Error("cannot call next() after end()")):i._nexting?t(new Error("cannot call next() before previous next() has completed")):(i._nexting=!0,"function"==typeof i._next?i._next((function(){i._nexting=!1,t.apply(null,arguments)})):void e.nextTick((function(){i._nexting=!1,t()})))},i.prototype.end=function(t){if("function"!=typeof t)throw new Error("end() requires a callback argument");return this._ended?t(new Error("end() already called on iterator")):(this._ended=!0,"function"==typeof this._end?this._end(t):void e.nextTick(t))},t.exports=i}).call(this)}).call(this,e("_process"))},{_process:285}],250:[function(e,t,i){(function(i,n){(function(){var r=e("xtend"),o=e("./abstract-iterator"),s=e("./abstract-chained-batch");function a(e){if(!arguments.length||void 0===e)throw new Error("constructor requires at least a location argument");if("string"!=typeof e)throw new Error("constructor requires a location string argument");this.location=e,this.status="new"}a.prototype.open=function(e,t){var i=this,r=this.status;if("function"==typeof e&&(t=e),"function"!=typeof t)throw new Error("open() requires a callback argument");"object"!=typeof e&&(e={}),e.createIfMissing=0!=e.createIfMissing,e.errorIfExists=!!e.errorIfExists,"function"==typeof this._open?(this.status="opening",this._open(e,(function(e){if(e)return i.status=r,t(e);i.status="open",t()}))):(this.status="open",n.nextTick(t))},a.prototype.close=function(e){var t=this,i=this.status;if("function"!=typeof e)throw new Error("close() requires a callback argument");"function"==typeof this._close?(this.status="closing",this._close((function(n){if(n)return t.status=i,e(n);t.status="closed",e()}))):(this.status="closed",n.nextTick(e))},a.prototype.get=function(e,t,i){var r;if("function"==typeof t&&(i=t),"function"!=typeof i)throw new Error("get() requires a callback argument");return(r=this._checkKey(e,"key",this._isBuffer))?i(r):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),t.asBuffer=0!=t.asBuffer,"function"==typeof this._get?this._get(e,t,i):void n.nextTick((function(){i(new Error("NotFound"))})))},a.prototype.put=function(e,t,i,r){var o;if("function"==typeof i&&(r=i),"function"!=typeof r)throw new Error("put() requires a callback argument");return(o=this._checkKey(e,"key",this._isBuffer))?r(o):(this._isBuffer(e)||(e=String(e)),null==t||this._isBuffer(t)||n.browser||(t=String(t)),"object"!=typeof i&&(i={}),"function"==typeof this._put?this._put(e,t,i,r):void n.nextTick(r))},a.prototype.del=function(e,t,i){var r;if("function"==typeof t&&(i=t),"function"!=typeof i)throw new Error("del() requires a callback argument");return(r=this._checkKey(e,"key",this._isBuffer))?i(r):(this._isBuffer(e)||(e=String(e)),"object"!=typeof t&&(t={}),"function"==typeof this._del?this._del(e,t,i):void n.nextTick(i))},a.prototype.batch=function(e,t,i){if(!arguments.length)return this._chainedBatch();if("function"==typeof t&&(i=t),"function"==typeof e&&(i=e),"function"!=typeof i)throw new Error("batch(array) requires a callback argument");if(!Array.isArray(e))return i(new Error("batch(array) requires an array argument"));t&&"object"==typeof t||(t={});for(var r,o,s=0,a=e.length;s<a;s++)if("object"==typeof(r=e[s])){if(o=this._checkKey(r.type,"type",this._isBuffer))return i(o);if(o=this._checkKey(r.key,"key",this._isBuffer))return i(o)}if("function"==typeof this._batch)return this._batch(e,t,i);n.nextTick(i)},a.prototype.approximateSize=function(e,t,i){if(null==e||null==t||"function"==typeof e||"function"==typeof t)throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments");if("function"!=typeof i)throw new Error("approximateSize() requires a callback argument");if(this._isBuffer(e)||(e=String(e)),this._isBuffer(t)||(t=String(t)),"function"==typeof this._approximateSize)return this._approximateSize(e,t,i);n.nextTick((function(){i(null,0)}))},a.prototype._setupIteratorOptions=function(e){var t=this;return e=r(e),["start","end","gt","gte","lt","lte"].forEach((function(i){e[i]&&t._isBuffer(e[i])&&0===e[i].length&&delete e[i]})),e.reverse=!!e.reverse,e.keys=0!=e.keys,e.values=0!=e.values,e.limit="limit"in e?e.limit:-1,e.keyAsBuffer=0!=e.keyAsBuffer,e.valueAsBuffer=0!=e.valueAsBuffer,e},a.prototype.iterator=function(e){return"object"!=typeof e&&(e={}),e=this._setupIteratorOptions(e),"function"==typeof this._iterator?this._iterator(e):new o(this)},a.prototype._chainedBatch=function(){return new s(this)},a.prototype._isBuffer=function(e){return i.isBuffer(e)},a.prototype._checkKey=function(e,t){if(null==e)return new Error(t+" cannot be `null` or `undefined`");if(this._isBuffer(e)){if(0===e.length)return new Error(t+" cannot be an empty Buffer")}else if(""===String(e))return new Error(t+" cannot be an empty String")},t.exports=a}).call(this)}).call(this,{isBuffer:e("../../../is-buffer/index.js")},e("_process"))},{"../../../is-buffer/index.js":203,"./abstract-chained-batch":248,"./abstract-iterator":249,_process:285,xtend:399}],251:[function(e,t,i){i.AbstractLevelDOWN=e("./abstract-leveldown"),i.AbstractIterator=e("./abstract-iterator"),i.AbstractChainedBatch=e("./abstract-chained-batch"),i.isLevelDOWN=e("./is-leveldown")},{"./abstract-chained-batch":248,"./abstract-iterator":249,"./abstract-leveldown":250,"./is-leveldown":252}],252:[function(e,t,i){var n=e("./abstract-leveldown");t.exports=function(e){return!(!e||"object"!=typeof e)&&Object.keys(n.prototype).filter((function(e){return"_"!=e[0]&&"approximateSize"!=e})).every((function(t){return"function"==typeof e[t]}))}},{"./abstract-leveldown":250}],253:[function(e,t,i){"use strict";var n,r,o,s=[e("./nextTick"),e("./queueMicrotask"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],a=-1,l=[],c=!1;function u(){n&&r&&(n=!1,r.length?l=r.concat(l):a=-1,l.length&&d())}function d(){if(!n){c=!1,n=!0;for(var e=l.length,t=setTimeout(u);e;){for(r=l,l=[];r&&++a<e;)r[a].run();a=-1,e=l.length}r=null,a=-1,n=!1,clearTimeout(t)}}for(var p=-1,h=s.length;++p<h;)if(s[p]&&s[p].test&&s[p].test()){o=s[p].install(d);break}function f(e,t){this.fun=e,this.array=t}f.prototype.run=function(){var e=this.fun,t=this.array;switch(t.length){case 0:return e();case 1:return e(t[0]);case 2:return e(t[0],t[1]);case 3:return e(t[0],t[1],t[2]);default:return e.apply(null,t)}},t.exports=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];l.push(new f(e,t)),c||n||(c=!0,o())}},{"./messageChannel":254,"./mutation.js":255,"./nextTick":167,"./queueMicrotask":256,"./stateChange":257,"./timeout":258}],254:[function(e,t,i){(function(e){(function(){"use strict";i.test=function(){return!e.setImmediate&&void 0!==e.MessageChannel},i.install=function(t){var i=new e.MessageChannel;return i.port1.onmessage=t,function(){i.port2.postMessage(0)}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],255:[function(e,t,i){(function(e){(function(){"use strict";var t=e.MutationObserver||e.WebKitMutationObserver;i.test=function(){return t},i.install=function(i){var n=0,r=new t(i),o=e.document.createTextNode("");return r.observe(o,{characterData:!0}),function(){o.data=n=++n%2}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],256:[function(e,t,i){(function(e){(function(){"use strict";i.test=function(){return"function"==typeof e.queueMicrotask},i.install=function(t){return function(){e.queueMicrotask(t)}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],257:[function(e,t,i){(function(e){(function(){"use strict";i.test=function(){return"document"in e&&"onreadystatechange"in e.document.createElement("script")},i.install=function(t){return function(){var i=e.document.createElement("script");return i.onreadystatechange=function(){t(),i.onreadystatechange=null,i.parentNode.removeChild(i),i=null},e.document.documentElement.appendChild(i),t}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],258:[function(e,t,i){"use strict";i.test=function(){return!0},i.install=function(e){return function(){setTimeout(e,0)}}},{}],259:[function(e,t,i){(function(e){(function(){function t(e,t){return Object.hasOwnProperty.call(e,t)}function n(e){return void 0!==e&&""!==e}function t(e,t){return Object.hasOwnProperty.call(e,t)}function r(e,t){return Object.hasOwnProperty.call(e,t)&&t}i.compare=function(t,i){if(e.isBuffer(t)){for(var n=Math.min(t.length,i.length),r=0;r<n;r++){var o=t[r]-i[r];if(o)return o}return t.length-i.length}return t<i?-1:t>i?1:0};var o=i.lowerBoundKey=function(e){return r(e,"gt")||r(e,"gte")||r(e,"min")||(e.reverse?r(e,"end"):r(e,"start"))||void 0},s=i.lowerBound=function(e){var t=o(e);return t&&e[t]},a=i.lowerBoundInclusive=function(e){return!t(e,"gt")},l=i.upperBoundInclusive=function(e){return!t(e,"lt")},c=i.lowerBoundExclusive=function(e){return!a(e)},u=i.upperBoundExclusive=function(e){return!l(e)},d=i.upperBoundKey=function(e){return r(e,"lt")||r(e,"lte")||r(e,"max")||(e.reverse?r(e,"start"):r(e,"end"))||void 0},p=i.upperBound=function(e){var t=d(e);return t&&e[t]};function h(e){return e}i.toLtgt=function(e,n,r,o,s){n=n||{},r=r||h;var a=arguments.length>3,l=i.lowerBoundKey(e),c=i.upperBoundKey(e);return l?"gt"===l?n.gt=r(e.gt,!1):n.gte=r(e[l],!1):a&&(n.gte=r(o,!1)),c?"lt"===c?n.lt=r(e.lt,!0):n.lte=r(e[c],!0):a&&(n.lte=r(s,!0)),null!=e.reverse&&(n.reverse=!!e.reverse),t(n,"max")&&delete n.max,t(n,"min")&&delete n.min,t(n,"start")&&delete n.start,t(n,"end")&&delete n.end,n},i.contains=function(e,t,r){r=r||i.compare;var o=s(e);if(n(o)&&((a=r(t,o))<0||0===a&&c(e)))return!1;var a,l=p(e);return!n(l)||!((a=r(t,l))>0||0===a&&u(e))},i.filter=function(e,t){return function(n){return i.contains(e,n,t)}}}).call(this)}).call(this,{isBuffer:e("../../../is-buffer/index.js")})},{"../../../is-buffer/index.js":203}],260:[function(e,t,i){"use strict";var n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function s(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},i=0;i<10;i++)t["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var i,a,l=s(e),c=1;c<arguments.length;c++){for(var u in i=Object(arguments[c]))r.call(i,u)&&(l[u]=i[u]);if(n){a=n(i);for(var d=0;d<a.length;d++)o.call(i,a[d])&&(l[a[d]]=i[a[d]])}}return l}},{}],261:[function(e,t,i){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=n(e("levelup")),o=n(e("sublevel-pouchdb")),s=e("through2"),a=n(e("argsarray")),l=n(e("double-ended-queue")),c=n(e("buffer-from")),u=e("pouchdb-adapter-utils"),d=e("pouchdb-merge"),p=e("pouchdb-json"),h=e("pouchdb-md5"),f=e("pouchdb-binary-utils"),m=e("pouchdb-collections"),g=e("pouchdb-utils"),b=e("pouchdb-errors");function v(e,t){var i=new Uint8Array(e);return f.blob([i],{type:t})}function y(e,t){f.readAsBinaryString(e,t)}function k(e,t){var i=t.prefix()[0],n=e._cache,r=n.get(i);return r||(r=new m.Map,n.set(i,r)),r}function w(){this._batch=[],this._cache=new m.Map}w.prototype.get=function(e,t,i){var n=k(this,e),r=n.get(t);return r?g.nextTick((function(){i(null,r)})):null===r?g.nextTick((function(){i({name:"NotFoundError"})})):void e.get(t,(function(e,r){if(e)return"NotFoundError"===e.name&&n.set(t,null),i(e);n.set(t,r),i(null,r)}))},w.prototype.batch=function(e){for(var t=0,i=e.length;t<i;t++){var n=e[t],r=k(this,n.prefix);"put"===n.type?r.set(n.key,n.value):r.set(n.key,null)}this._batch=this._batch.concat(e)},w.prototype.execute=function(e,t){for(var i=new m.Set,n=[],r=this._batch.length-1;r>=0;r--){var o=this._batch[r],s=o.prefix.prefix()[0]+""+o.key;i.has(s)||(i.add(s),n.push(o))}e.batch(n,t)};var x=new m.Map,E="_local_last_update_seq",C="_local_doc_count",S="_local_uuid",_={encode:p.safeJsonStringify,decode:p.safeJsonParse,buffer:!1,type:"cheap-json"},T=new g.changesHandler;function A(e){return"winningRev"in e?e.winningRev:d.winningRev(e)}function N(e,t){return"deleted"in e?e.deleted:u.isDeleted(e,t)}function I(e,t,i){var n=[];return e.forEach((function(e){e.doc&&e.doc._attachments&&Object.keys(e.doc._attachments).forEach((function(t){var i=e.doc._attachments[t];"data"in i||n.push(i)}))})),Promise.all(n.map((function(e){return function(e,t,i){var n=e.content_type;return new Promise((function(r,o){t.binaryStore.get(e.digest,(function(t,s){var a;if(t){if("NotFoundError"!==t.name)return o(t);a=i.binary?f.binaryStringToBlobOrBuffer("",n):""}else a=i.binary?v(s,n):s.toString("base64");delete e.stub,delete e.length,e.data=a,r()}))}))}(e,t,i)})))}t.exports=function(e,t){e=g.clone(e);var i,n,p=this,k={},O=e.revs_limit,P=e.name;void 0===e.createIfMissing&&(e.createIfMissing=!0);var D,L=e.db,R=g.functionName(L);function M(){k.docStore=n.sublevel("document-store",{valueEncoding:_}),k.bySeqStore=n.sublevel("by-sequence",{valueEncoding:"json"}),k.attachmentStore=n.sublevel("attach-store",{valueEncoding:"json"}),k.binaryStore=n.sublevel("attach-binary-store",{valueEncoding:"binary"}),k.localStore=n.sublevel("local-store",{valueEncoding:"json"}),k.metaStore=n.sublevel("meta-store",{valueEncoding:"json"}),"object"==typeof e.migrate?e.migrate.doMigrationTwo(n,k,B):B()}function B(){k.metaStore.get(E,(function(e,r){void 0===n._updateSeq&&(n._updateSeq=r||0),k.metaStore.get(C,(function(e,r){n._docCount=e?0:r,k.metaStore.get(S,(function(e,n){i=e?g.uuid():n,k.metaStore.put(S,i,(function(){g.nextTick((function(){t(null,p)}))}))}))}))}))}function j(e,t){try{e.apply(null,t)}catch(e){t[t.length-1](e)}}function U(){var e=n._queue.peekFront();"read"===e.type?function(e){for(var t=[e],i=1,r=n._queue.get(i);void 0!==r&&"read"===r.type;)t.push(r),i++,r=n._queue.get(i);var o=0;t.forEach((function(e){var i=e.args,r=i[i.length-1];i[i.length-1]=a((function(e){r.apply(null,e),++o===t.length&&g.nextTick((function(){t.forEach((function(){n._queue.shift()})),n._queue.length&&U()}))})),j(e.fun,i)}))}(e):function(e){var t=e.args,i=t[t.length-1];t[t.length-1]=a((function(e){i.apply(null,e),g.nextTick((function(){n._queue.shift(),n._queue.length&&U()}))})),j(e.fun,t)}(e)}function F(e){return a((function(t){n._queue.push({fun:e,args:t,type:"write"}),1===n._queue.length&&g.nextTick(U)}))}function H(e){return a((function(t){n._queue.push({fun:e,args:t,type:"read"}),1===n._queue.length&&g.nextTick(U)}))}function q(e){return("0000000000000000"+e).slice(-16)}function z(e,t){"destroy"in L?L.destroy(e,t):t(null)}x.has(R)?D=x.get(R):(D=new m.Map,x.set(R,D)),D.has(P)?(n=D.get(P),M()):D.set(P,o(r(L(P),e,(function(i){if(i)return D.delete(P),t(i);(n=D.get(P))._docCount=-1,n._queue=new l,"object"==typeof e.migrate?e.migrate.doMigrationOne(P,n,M):M()})))),p._remote=!1,p.type=function(){return"leveldb"},p._id=function(e){e(null,i)},p._info=function(e){var t={doc_count:n._docCount,update_seq:n._updateSeq,backend_adapter:g.functionName(L)};return g.nextTick((function(){e(null,t)}))},p._get=H((function(e,t,i){t=g.clone(t),k.docStore.get(e,(function(e,n){if(e||!n)return i(b.createError(b.MISSING_DOC,"missing"));var r;if(t.rev)r=t.latest?d.latest(t.rev,n):t.rev;else if(r=A(n),N(n,r))return i(b.createError(b.MISSING_DOC,"deleted"));var o=n.rev_map[r];k.bySeqStore.get(q(o),(function(e,t){if(!t)return i(b.createError(b.MISSING_DOC));if("_id"in t&&t._id!==n.id)return i(new Error("wrong doc returned"));if(t._id=n.id,"_rev"in t){if(t._rev!==r)return i(new Error("wrong doc returned"))}else t._rev=r;return i(null,{doc:t,metadata:n})}))}))})),p._getAttachment=function(e,t,i,n,r){var o=i.digest,s=i.content_type;k.binaryStore.get(o,(function(e,t){if(e)return"NotFoundError"!==e.name?r(e):r(null,n.binary?function(e){return f.blob([""],{type:e})}(s):"");n.binary?r(null,v(t,s)):r(null,t.toString("base64"))}))},p._bulkDocs=F((function(e,t,i){var r=t.new_edits,o=new Array(e.docs.length),s=new m.Map,a=new m.Map,l=new w,v=0,x=n._updateSeq,S=e.docs,_=S.map((function(e){if(e._id&&u.isLocalId(e._id))return e;var t=u.parseDoc(e,r,p.__opts);return t.metadata&&!t.metadata.rev_map&&(t.metadata.rev_map={}),t})),A=_.filter((function(e){return e.error}));if(A.length)return i(A[0]);function N(e,t){var i=Promise.resolve();e.forEach((function(e,t){i=i.then((function(){return new Promise((function(i,n){p._doCompactionNoLock(t,e,{ctx:l},(function(e){if(e)return n(e);i()}))}))}))})),i.then((function(){t()}),t)}function I(){N(a,(function(e){if(e&&M(e),p.auto_compaction)return t=M,i=new m.Map,s.forEach((function(e,t){i.set(t,d.compactTree(e))})),void N(i,t);var t,i;M()}))}function D(e,t,n,r,u,d,p,m){v+=d;var g=null,w=0;e.metadata.winningRev=t,e.metadata.deleted=n,e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,r&&(e.data._deleted=!0),e.stemmedRevs.length&&a.set(e.metadata.id,e.stemmedRevs);var E=e.data._attachments?Object.keys(e.data._attachments):[];function C(e){w++,g||(e?m(g=e):w===E.length&&I())}function S(e,t,i){return function(n){h.binaryMd5(n,function(e,t,i,n){return function(r){!function(e,t,i,n,r){var o=e.data._attachments[i];delete o.data,o.digest=t,o.length=n.length;var s=e.metadata.id,a=e.metadata.rev;o.revpos=parseInt(a,10),R(s,a,t,(function(e,i){return e||0===n.length?r(e):i?(l.batch([{type:"put",prefix:k.binaryStore,key:t,value:c(n,"binary")}]),void r()):r(e)}))}(e,"md5-"+r,t,i,n)}}(e,t,n,i))}}for(var _=0;_<E.length;_++){var T,A=E[_],N=e.data._attachments[A];if(N.stub)R(e.data._id,e.data._rev,N.digest,C);else if("string"==typeof N.data){try{T=f.atob(N.data)}catch(e){return void i(b.createError(b.BAD_ARG,"Attachment is not a valid base64 string"))}S(e,A,C)(T)}else y(N.data,S(e,A,C))}function I(){var t=e.metadata.rev_map[e.metadata.rev];if(t)return m();t=++x,e.metadata.rev_map[e.metadata.rev]=e.metadata.seq=t;var i=[{key:q(t),value:e.data,prefix:k.bySeqStore,type:"put"},{key:e.metadata.id,value:e.metadata,prefix:k.docStore,type:"put"}];l.batch(i),o[p]={ok:!0,id:e.metadata.id,rev:e.metadata.rev},s.set(e.metadata.id,e.metadata),m()}E.length||I()}var L={};function R(e,t,i,n){function r(n){var r=[e,t].join("@"),o={};return n?n.refs&&(o.refs=n.refs,o.refs[r]=!0):(o.refs={},o.refs[r]=!0),new Promise((function(e){l.batch([{type:"put",prefix:k.attachmentStore,key:i,value:o}]),e(!n)}))}var o=L[i]||Promise.resolve();L[i]=o.then((function(){return new Promise((function(e,t){l.get(k.attachmentStore,i,(function(i,n){if(i&&"NotFoundError"!==i.name)return t(i);e(n)}))})).then(r).then((function(e){n(null,e)}),n)}))}function M(e){if(e)return g.nextTick((function(){i(e)}));l.batch([{prefix:k.metaStore,type:"put",key:E,value:x},{prefix:k.metaStore,type:"put",key:C,value:n._docCount+v}]),l.execute(n,(function(e){if(e)return i(e);n._docCount+=v,n._updateSeq=x,T.notify(P),g.nextTick((function(){i(null,o)}))}))}if(!_.length)return i(null,[]);!function(e){var t=[];if(S.forEach((function(e){e&&e._attachments&&Object.keys(e._attachments).forEach((function(i){var n=e._attachments[i];n.stub&&t.push(n.digest)}))})),!t.length)return e();var i,n=0;t.forEach((function(r){!function(e,t){l.get(k.attachmentStore,e,(function(i){if(i){var n=b.createError(b.MISSING_STUB,"unknown stub attachment with digest "+e);t(n)}else t()}))}(r,(function(r){r&&!i&&(i=r),++n===t.length&&e(i)}))}))}((function(e){if(e)return i(e);!function(e){var t,i=0;function n(){if(++i===S.length)return e(t)}S.forEach((function(e){if(e._id&&u.isLocalId(e._id))return n();l.get(k.docStore,e._id,(function(i,r){i?"NotFoundError"!==i.name&&(t=i):s.set(e._id,r),n()}))}))}((function(e){if(e)return i(e);u.processDocs(O,_,p,s,l,o,D,t,I)}))}))})),p._allDocs=function(e,t){return"keys"in e?u.allDocsKeysQuery(this,e):H((function(e,t){e=g.clone(e),function(e){n.isClosed()?e(new Error("database is closed")):e(null,n._docCount)}((function(i,r){if(i)return t(i);var o,a={},l=e.skip||0;if(e.startkey&&(a.gte=e.startkey),e.endkey&&(a.lte=e.endkey),e.key&&(a.gte=a.lte=e.key),e.descending){a.reverse=!0;var c=a.lte;a.lte=a.gte,a.gte=c}if("number"==typeof e.limit&&(o=e.limit),0===o||"gte"in a&&"lte"in a&&a.gte>a.lte){var u={total_rows:r,offset:e.skip,rows:[]};return e.update_seq&&(u.update_seq=n._updateSeq),t(null,u)}var p=[],h=k.docStore.readStream(a),f=s.obj((function(t,i,n){var r=t.value,s=A(r),a=N(r,s);if(a){if("ok"!==e.deleted)return void n()}else{if(l-- >0)return void n();if("number"==typeof o&&o--<=0)return h.unpipe(),h.destroy(),void n()}function c(t){var i={id:r.id,key:r.id,value:{rev:s}};if(e.include_docs){if(i.doc=t,i.doc._rev=i.value.rev,e.conflicts){var o=d.collectConflicts(r);o.length&&(i.doc._conflicts=o)}for(var l in i.doc._attachments)i.doc._attachments.hasOwnProperty(l)&&(i.doc._attachments[l].stub=!0)}if(!1===e.inclusive_end&&r.id===e.endkey)return n();if(a){if("ok"!==e.deleted)return n();i.value.deleted=!0,i.doc=null}p.push(i),n()}if(e.include_docs){var u=r.rev_map[s];k.bySeqStore.get(q(u),(function(e,t){c(t)}))}else c()}),(function(i){Promise.resolve().then((function(){if(e.include_docs&&e.attachments)return I(p,k,e)})).then((function(){var i={total_rows:r,offset:e.skip,rows:p};e.update_seq&&(i.update_seq=n._updateSeq),t(null,i)}),t),i()})).on("unpipe",(function(){f.end()}));h.on("error",t),h.pipe(f)}))}))(e,t)},p._changes=function(e){if((e=g.clone(e)).continuous){var t=P+":"+g.uuid();return T.addListener(P,t,p,e),T.notify(P),{cancel:function(){T.removeListener(P,t)}}}var i,r=e.descending,o=[],a=e.since||0,l=0,c={reverse:r};"limit"in e&&e.limit>0&&(i=e.limit),c.reverse||(c.start=q(e.since||0));var d=e.doc_ids&&new m.Set(e.doc_ids),h=g.filterChange(e),f=new m.Map;function b(){e.done=!0,e.return_docs&&e.limit&&e.limit<o.length&&(o.length=e.limit),v.unpipe(y),v.destroy(),e.continuous||e.cancelled||(e.include_docs&&e.attachments&&e.return_docs?I(o,k,e).then((function(){e.complete(null,{results:o,last_seq:a})})):e.complete(null,{results:o,last_seq:a}))}var v=k.bySeqStore.readStream(c),y=s.obj((function(t,s,c){if(i&&l>=i)return b(),c();if(e.cancelled||e.done)return c();var p,m,g=(p=t.key,parseInt(p,10)),v=t.value;if(g===e.since&&!r)return c();if(d&&!d.has(v._id))return c();function y(t){var i=A(t);function n(i){var n=e.processChange(i,t,e);n.seq=t.seq;var r=h(n);if("object"==typeof r)return e.complete(r);r&&(l++,e.attachments&&e.include_docs?I([n],k,e).then((function(){e.onChange(n)})):e.onChange(n),e.return_docs&&o.push(n)),c()}if(t.seq!==g)return c();if(a=g,i===v._rev)return n(v);var r=t.rev_map[i];k.bySeqStore.get(q(r),(function(e,t){n(t)}))}if(m=f.get(v._id))return y(m);k.docStore.get(v._id,(function(t,i){if(e.cancelled||e.done||n.isClosed()||u.isLocalId(i.id))return c();f.set(v._id,i),y(i)}))}),(function(t){if(e.cancelled)return t();e.return_docs&&e.limit&&e.limit<o.length&&(o.length=e.limit),t()})).on("unpipe",(function(){y.end(),b()}));return v.pipe(y),{cancel:function(){e.cancelled=!0,b()}}},p._close=function(e){if(n.isClosed())return e(b.createError(b.NOT_OPEN));n.close((function(t){t?e(t):(D.delete(P),e())}))},p._getRevisionTree=function(e,t){k.docStore.get(e,(function(e,i){e?t(b.createError(b.MISSING_DOC)):t(null,i.rev_tree)}))},p._doCompaction=F((function(e,t,i,n){p._doCompactionNoLock(e,t,i,n)})),p._doCompactionNoLock=function(e,t,i,r){if("function"==typeof i&&(r=i,i={}),!t.length)return r();var o=i.ctx||new w;o.get(k.docStore,e,(function(s,a){if(s)return r(s);var l=t.map((function(e){var t=a.rev_map[e];return delete a.rev_map[e],t}));d.traverseRevTree(a.rev_tree,(function(e,i,n,r,o){var s=i+"-"+n;-1!==t.indexOf(s)&&(o.status="missing")}));var c=[];c.push({key:a.id,value:a,type:"put",prefix:k.docStore});var u,p={},h=0;function f(i){if(i&&(u=i),++h===t.length){if(u)return r(u);!function(){var i=Object.keys(p);if(!i.length)return g();var n,r=0;function s(e){e&&(n=e),++r===i.length&&g(n)}var a=new m.Map;t.forEach((function(t){a.set(e+"@"+t,!0)})),i.forEach((function(e){o.get(k.attachmentStore,e,(function(t,i){if(t)return"NotFoundError"===t.name?s():s(t);var n=Object.keys(i.refs||{}).filter((function(e){return!a.has(e)})),r={};n.forEach((function(e){r[e]=!0})),n.length?c.push({key:e,type:"put",value:{refs:r},prefix:k.attachmentStore}):c=c.concat([{key:e,type:"del",prefix:k.attachmentStore},{key:e,type:"del",prefix:k.binaryStore}]),s()}))}))}()}}function g(e){return e?r(e):(o.batch(c),i.ctx?r():void o.execute(n,r))}l.forEach((function(e){c.push({key:q(e),type:"del",prefix:k.bySeqStore}),o.get(k.bySeqStore,q(e),(function(e,t){if(e)return"NotFoundError"===e.name?f():f(e);Object.keys(t._attachments||{}).forEach((function(e){var i=t._attachments[e].digest;p[i]=!0})),f()}))}))}))},p._getLocal=function(e,t){k.localStore.get(e,(function(e,i){e?t(b.createError(b.MISSING_DOC)):t(null,i)}))},p._putLocal=function(e,t,i){"function"==typeof t&&(i=t,t={}),t.ctx?p._putLocalNoLock(e,t,i):p._putLocalWithLock(e,t,i)},p._putLocalWithLock=F((function(e,t,i){p._putLocalNoLock(e,t,i)})),p._putLocalNoLock=function(e,t,i){delete e._revisions;var r=e._rev,o=e._id,s=t.ctx||new w;s.get(k.localStore,o,(function(a,l){if(a&&r)return i(b.createError(b.REV_CONFLICT));if(l&&l._rev!==r)return i(b.createError(b.REV_CONFLICT));e._rev=r?"0-"+(parseInt(r.split("-")[1],10)+1):"0-1";var c=[{type:"put",prefix:k.localStore,key:o,value:e}];s.batch(c);var u={ok:!0,id:e._id,rev:e._rev};if(t.ctx)return i(null,u);s.execute(n,(function(e){if(e)return i(e);i(null,u)}))}))},p._removeLocal=function(e,t,i){"function"==typeof t&&(i=t,t={}),t.ctx?p._removeLocalNoLock(e,t,i):p._removeLocalWithLock(e,t,i)},p._removeLocalWithLock=F((function(e,t,i){p._removeLocalNoLock(e,t,i)})),p._removeLocalNoLock=function(e,t,i){var r=t.ctx||new w;r.get(k.localStore,e._id,(function(o,s){if(o)return"NotFoundError"!==o.name?i(o):i(b.createError(b.MISSING_DOC));if(s._rev!==e._rev)return i(b.createError(b.REV_CONFLICT));r.batch([{prefix:k.localStore,type:"del",key:e._id}]);var a={ok:!0,id:e._id,rev:"0-0"};if(t.ctx)return i(null,a);r.execute(n,(function(e){if(e)return i(e);i(null,a)}))}))},p._destroy=function(e,t){var i,n=g.functionName(L);if(!x.has(n))return z(P,t);(i=x.get(n)).has(P)?(T.removeAllListeners(P),i.get(P).close((function(){i.delete(P),z(P,t)}))):z(P,t)}}},{argsarray:161,"buffer-from":262,"double-ended-queue":184,levelup:226,"pouchdb-adapter-utils":265,"pouchdb-binary-utils":266,"pouchdb-collections":267,"pouchdb-errors":268,"pouchdb-json":269,"pouchdb-md5":270,"pouchdb-merge":271,"pouchdb-utils":272,"sublevel-pouchdb":381,through2:263}],262:[function(e,t,i){(function(e){(function(){var i=Object.prototype.toString,n="function"==typeof e.alloc&&"function"==typeof e.allocUnsafe&&"function"==typeof e.from;t.exports=function(t,r,o){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return function(e){return"ArrayBuffer"===i.call(e).slice(8,-1)}(t)?function(t,i,r){i>>>=0;var o=t.byteLength-i;if(o<0)throw new RangeError("'offset' is out of bounds");if(void 0===r)r=o;else if((r>>>=0)>o)throw new RangeError("'length' is out of bounds");return n?e.from(t.slice(i,i+r)):new e(new Uint8Array(t.slice(i,i+r)))}(t,r,o):"string"==typeof t?function(t,i){if("string"==typeof i&&""!==i||(i="utf8"),!e.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');return n?e.from(t,i):new e(t,i)}(t,r):n?e.from(t):new e(t)}}).call(this)}).call(this,e("buffer").Buffer)},{buffer:168}],263:[function(e,t,i){(function(i){(function(){var n=e("readable-stream").Transform,r=e("util").inherits;function o(e){n.call(this,e),this._destroyed=!1}function s(e,t,i){i(null,e)}function a(e){return function(t,i,n){return"function"==typeof t&&(n=i,i=t,t={}),"function"!=typeof i&&(i=s),"function"!=typeof n&&(n=null),e(t,i,n)}}r(o,n),o.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;i.nextTick((function(){e&&t.emit("error",e),t.emit("close")}))}},t.exports=a((function(e,t,i){var n=new o(e);return n._transform=t,i&&(n._flush=i),n})),t.exports.ctor=a((function(e,t,i){function n(t){if(!(this instanceof n))return new n(t);this.options=Object.assign({},e,t),o.call(this,this.options)}return r(n,o),n.prototype._transform=t,i&&(n.prototype._flush=i),n})),t.exports.obj=a((function(e,t,i){var n=new o(Object.assign({objectMode:!0,highWaterMark:16},e));return n._transform=t,i&&(n._flush=i),n}))}).call(this)}).call(this,e("_process"))},{_process:285,"readable-stream":348,util:396}],264:[function(e,t,i){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=e("pouchdb-utils"),o=n(e("pouchdb-adapter-leveldb-core")),s=n(e("memdown"));function a(e,t){var i=r.assign({db:s},e);o.call(this,i,t)}a.valid=function(){return!0},a.use_prefix=!1,t.exports=function(e){e.adapter("memory",a,!0)}},{memdown:247,"pouchdb-adapter-leveldb-core":261,"pouchdb-utils":272}],265:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("pouchdb-utils"),r=e("pouchdb-binary-utils"),o=e("pouchdb-md5"),s=e("pouchdb-collections"),a=e("pouchdb-errors"),l=e("pouchdb-merge");function c(e){return e.reduce((function(e,t){return e[t]=!0,e}),{})}var u=c(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),d=c(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function p(e){if(!/^\d+-/.test(e))return a.createError(a.INVALID_REV);var t=e.indexOf("-"),i=e.substring(0,t),n=e.substring(t+1);return{prefix:parseInt(i,10),id:n}}function h(e,t,i){var r,o,s;i||(i={deterministic_revs:!0});var l={status:"available"};if(e._deleted&&(l.deleted=!0),t)if(e._id||(e._id=n.uuid()),o=n.rev(e,i.deterministic_revs),e._rev){if((s=p(e._rev)).error)return s;e._rev_tree=[{pos:s.prefix,ids:[s.id,{status:"missing"},[[o,l,[]]]]}],r=s.prefix+1}else e._rev_tree=[{pos:1,ids:[o,l,[]]}],r=1;else if(e._revisions&&(e._rev_tree=function(e,t){for(var i=e.start-e.ids.length+1,n=e.ids,r=[n[0],t,[]],o=1,s=n.length;o<s;o++)r=[n[o],{status:"missing"},[r]];return[{pos:i,ids:r}]}(e._revisions,l),r=e._revisions.start,o=e._revisions.ids[0]),!e._rev_tree){if((s=p(e._rev)).error)return s;r=s.prefix,o=s.id,e._rev_tree=[{pos:r,ids:[o,l,[]]}]}n.invalidIdError(e._id),e._rev=r+"-"+o;var c={metadata:{},data:{}};for(var h in e)if(Object.prototype.hasOwnProperty.call(e,h)){var f="_"===h[0];if(f&&!u[h]){var m=a.createError(a.DOC_VALIDATION,h);throw m.message=a.DOC_VALIDATION.message+": "+h,m}f&&!d[h]?c.metadata[h.slice(1)]=e[h]:c.data[h]=e[h]}return c}function f(e,t,i){var n=function(e){try{return r.atob(e)}catch(e){return{error:a.createError(a.BAD_ARG,"Attachment is not a valid base64 string")}}}(e.data);if(n.error)return i(n.error);e.length=n.length,e.data="blob"===t?r.binaryStringToBlobOrBuffer(n,e.content_type):"base64"===t?r.btoa(n):n,o.binaryMd5(n,(function(t){e.digest="md5-"+t,i()}))}function m(e,t,i){if(e.stub)return i();"string"==typeof e.data?f(e,t,i):function(e,t,i){o.binaryMd5(e.data,(function(n){e.digest="md5-"+n,e.length=e.data.size||e.data.length||0,"binary"===t?r.blobOrBufferToBinaryString(e.data,(function(t){e.data=t,i()})):"base64"===t?r.blobOrBufferToBase64(e.data,(function(t){e.data=t,i()})):i()}))}(e,t,i)}function g(e,t,i,n,r,o,s,c){if(l.revExists(t.rev_tree,i.metadata.rev)&&!c)return n[r]=i,o();var u=t.winningRev||l.winningRev(t),d="deleted"in t?t.deleted:l.isDeleted(t,u),p="deleted"in i.metadata?i.metadata.deleted:l.isDeleted(i.metadata),f=/^1-/.test(i.metadata.rev);if(d&&!p&&c&&f){var m=i.data;m._rev=u,m._id=i.metadata.id,i=h(m,c)}var g=l.merge(t.rev_tree,i.metadata.rev_tree[0],e);if(c&&(d&&p&&"new_leaf"!==g.conflicts||!d&&"new_leaf"!==g.conflicts||d&&!p&&"new_branch"===g.conflicts)){var b=a.createError(a.REV_CONFLICT);return n[r]=b,o()}var v=i.metadata.rev;i.metadata.rev_tree=g.tree,i.stemmedRevs=g.stemmedRevs||[],t.rev_map&&(i.metadata.rev_map=t.rev_map);var y=l.winningRev(i.metadata),k=l.isDeleted(i.metadata,y),w=d===k?0:d<k?-1:1;s(i,y,k,v===y?k:l.isDeleted(i.metadata,v),!0,w,r,o)}i.invalidIdError=n.invalidIdError,i.normalizeDdocFunctionName=n.normalizeDdocFunctionName,i.parseDdocFunctionName=n.parseDdocFunctionName,i.isDeleted=l.isDeleted,i.isLocalId=l.isLocalId,i.allDocsKeysQuery=function(e,t){var i=t.keys,r={offset:t.skip};return Promise.all(i.map((function(i){var o=n.assign({key:i,deleted:"ok"},t);return["limit","skip","keys"].forEach((function(e){delete o[e]})),new Promise((function(n,s){e._allDocs(o,(function(e,o){if(e)return s(e);t.update_seq&&void 0!==o.update_seq&&(r.update_seq=o.update_seq),r.total_rows=o.total_rows,n(o.rows[0]||{key:i,error:"not_found"})}))}))}))).then((function(e){return r.rows=e,r}))},i.parseDoc=h,i.preprocessAttachments=function(e,t,i){if(!e.length)return i();var n,r=0;function o(){r++,e.length===r&&(n?i(n):i())}e.forEach((function(e){var i=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],r=0;if(!i.length)return o();function s(e){n=e,++r===i.length&&o()}for(var a in e.data._attachments)e.data._attachments.hasOwnProperty(a)&&m(e.data._attachments[a],t,s)}))},i.processDocs=function(e,t,i,n,r,o,c,u,d){e=e||1e3;var p=u.new_edits,h=new s.Map,f=0,m=t.length;function b(){++f===m&&d&&d()}t.forEach((function(e,t){if(e._id&&l.isLocalId(e._id)){var n=e._deleted?"_removeLocal":"_putLocal";i[n](e,{ctx:r},(function(e,i){o[t]=e||i,b()}))}else{var s=e.metadata.id;h.has(s)?(m--,h.get(s).push([e,t])):h.set(s,[[e,t]])}})),h.forEach((function(t,i){var r=0;function s(){++r<t.length?d():b()}function d(){var d=t[r],h=d[0],f=d[1];if(n.has(i))g(e,n.get(i),h,o,f,s,c,p);else{var m=l.merge([],h.metadata.rev_tree[0],e);h.metadata.rev_tree=m.tree,h.stemmedRevs=m.stemmedRevs||[],function(e,t,i){var n=l.winningRev(e.metadata),r=l.isDeleted(e.metadata,n);if("was_delete"in u&&r)return o[t]=a.createError(a.MISSING_DOC,"deleted"),i();if(p&&function(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}(e)){var s=a.createError(a.REV_CONFLICT);return o[t]=s,i()}c(e,n,r,r,!1,r?0:1,t,i)}(h,f,s)}}d()}))},i.updateDoc=g},{"pouchdb-binary-utils":266,"pouchdb-collections":267,"pouchdb-errors":268,"pouchdb-md5":270,"pouchdb-merge":271,"pouchdb-utils":272}],266:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(e){return atob(e)},r=function(e){return btoa(e)};function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(r){if("TypeError"!==r.name)throw r;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)i.append(e[n]);return i.getBlob(t.type)}}function s(e){for(var t=e.length,i=new ArrayBuffer(t),n=new Uint8Array(i),r=0;r<t;r++)n[r]=e.charCodeAt(r);return i}function a(e,t){return o([s(e)],{type:t})}function l(e,t){var i=new FileReader,n="function"==typeof i.readAsBinaryString;i.onloadend=function(e){var i=e.target.result||"";if(n)return t(i);t(function(e){for(var t="",i=new Uint8Array(e),n=i.byteLength,r=0;r<n;r++)t+=String.fromCharCode(i[r]);return t}(i))},n?i.readAsBinaryString(e):i.readAsArrayBuffer(e)}function c(e,t){l(e,(function(e){t(e)}))}i.atob=n,i.btoa=r,i.base64StringToBlobOrBuffer=function(e,t){return a(n(e),t)},i.binaryStringToArrayBuffer=s,i.binaryStringToBlobOrBuffer=a,i.blob=o,i.blobOrBufferToBase64=function(e,t){c(e,(function(e){t(r(e))}))},i.blobOrBufferToBinaryString=c,i.readAsArrayBuffer=function(e,t){var i=new FileReader;i.onloadend=function(e){var i=e.target.result||new ArrayBuffer(0);t(i)},i.readAsArrayBuffer(e)},i.readAsBinaryString=l,i.typedBuffer=function(){}},{}],267:[function(e,t,i){"use strict";function n(e){return"$"+e}function r(e){return e.substring(1)}function o(){this._store={}}function s(e){if(this._store=new o,e&&Array.isArray(e))for(var t=0,i=e.length;t<i;t++)this.add(e[t])}Object.defineProperty(i,"__esModule",{value:!0}),o.prototype.get=function(e){var t=n(e);return this._store[t]},o.prototype.set=function(e,t){var i=n(e);return this._store[i]=t,!0},o.prototype.has=function(e){return n(e)in this._store},o.prototype.delete=function(e){var t=n(e),i=t in this._store;return delete this._store[t],i},o.prototype.forEach=function(e){for(var t=Object.keys(this._store),i=0,n=t.length;i<n;i++){var o=t[i];e(this._store[o],o=r(o))}},Object.defineProperty(o.prototype,"size",{get:function(){return Object.keys(this._store).length}}),s.prototype.add=function(e){return this._store.set(e,!0)},s.prototype.has=function(e){return this._store.has(e)},s.prototype.forEach=function(e){this._store.forEach((function(t,i){e(i)}))},Object.defineProperty(s.prototype,"size",{get:function(){return this._store.size}}),function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(i.Set=Set,i.Map=Map):(i.Set=s,i.Map=o)},{}],268:[function(e,t,i){"use strict";var n;function r(e,t,i){Error.call(this,i),this.status=e,this.name=t,this.message=i,this.error=!0}Object.defineProperty(i,"__esModule",{value:!0}),((n=e("inherits"))&&"object"==typeof n&&"default"in n?n.default:n)(r,Error),r.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var o=new r(401,"unauthorized","Name or password is incorrect."),s=new r(400,"bad_request","Missing JSON list of 'docs'"),a=new r(404,"not_found","missing"),l=new r(409,"conflict","Document update conflict"),c=new r(400,"bad_request","_id field must contain a string"),u=new r(412,"missing_id","_id is required for puts"),d=new r(400,"bad_request","Only reserved document ids may start with underscore."),p=new r(412,"precondition_failed","Database not open"),h=new r(500,"unknown_error","Database encountered an unknown error"),f=new r(500,"badarg","Some query argument is invalid"),m=new r(400,"invalid_request","Request was invalid"),g=new r(400,"query_parse_error","Some query parameter is invalid"),b=new r(500,"doc_validation","Bad special document member"),v=new r(400,"bad_request","Something wrong with the request"),y=new r(400,"bad_request","Document must be a JSON object"),k=new r(404,"not_found","Database not found"),w=new r(500,"indexed_db_went_bad","unknown"),x=new r(500,"web_sql_went_bad","unknown"),E=new r(500,"levelDB_went_went_bad","unknown"),C=new r(403,"forbidden","Forbidden by design doc validate_doc_update function"),S=new r(400,"bad_request","Invalid rev format"),_=new r(412,"file_exists","The database could not be created, the file already exists."),T=new r(412,"missing_stub","A pre-existing attachment stub wasn't found"),A=new r(413,"invalid_url","Provided URL is invalid");i.UNAUTHORIZED=o,i.MISSING_BULK_DOCS=s,i.MISSING_DOC=a,i.REV_CONFLICT=l,i.INVALID_ID=c,i.MISSING_ID=u,i.RESERVED_ID=d,i.NOT_OPEN=p,i.UNKNOWN_ERROR=h,i.BAD_ARG=f,i.INVALID_REQUEST=m,i.QUERY_PARSE_ERROR=g,i.DOC_VALIDATION=b,i.BAD_REQUEST=v,i.NOT_AN_OBJECT=y,i.DB_MISSING=k,i.WSQ_ERROR=x,i.LDB_ERROR=E,i.FORBIDDEN=C,i.INVALID_REV=S,i.FILE_EXISTS=_,i.MISSING_STUB=T,i.IDB_ERROR=w,i.INVALID_URL=A,i.createError=function(e,t){function i(t){for(var i in e)"function"!=typeof e[i]&&(this[i]=e[i]);void 0!==t&&(this.reason=t)}return i.prototype=r.prototype,new i(t)},i.generateErrorFromResponse=function(e){if("object"!=typeof e){var t=e;(e=h).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}},{inherits:201}],269:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=(n=e("vuvuzela"))&&"object"==typeof n&&"default"in n?n.default:n;i.safeJsonParse=function(e){try{return JSON.parse(e)}catch(t){return r.parse(e)}},i.safeJsonStringify=function(e){try{return JSON.stringify(e)}catch(t){return r.stringify(e)}}},{vuvuzela:397}],270:[function(e,t,i){(function(t){(function(){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=e("pouchdb-binary-utils"),o=(n=e("spark-md5"))&&"object"==typeof n&&"default"in n?n.default:n,s=t.setImmediate||t.setTimeout;function a(e,t,i,n,o){(i>0||n<t.size)&&(t=function(e,t,i){return e.webkitSlice?e.webkitSlice(t,i):e.slice(t,i)}(t,i,n)),r.readAsArrayBuffer(t,(function(t){e.append(t),o()}))}function l(e,t,i,n,r){(i>0||n<t.length)&&(t=t.substring(i,n)),e.appendBinary(t),r()}i.binaryMd5=function(e,t){var i="string"==typeof e,n=i?e.length:e.size,c=Math.min(32768,n),u=Math.ceil(n/c),d=0,p=i?new o:new o.ArrayBuffer,h=i?l:a;function f(){s(g)}function m(){var e=function(e){return r.btoa(e)}(p.end(!0));t(e),p.destroy()}function g(){var t=d*c;h(p,e,t,t+c,++d<u?f:m)}g()},i.stringMd5=function(e){return o.hash(e)}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"pouchdb-binary-utils":266,"spark-md5":378}],271:[function(e,t,i){"use strict";function n(e){for(var t,i,n,r,o=e.rev_tree.slice();r=o.pop();){var s=r.ids,a=s[2],l=r.pos;if(a.length)for(var c=0,u=a.length;c<u;c++)o.push({pos:l+1,ids:a[c]});else{var d=!!s[1].deleted,p=s[0];t&&!(n!==d?n:i!==l?i<l:t<p)||(t=p,i=l,n=d)}}return i+"-"+t}function r(e,t){for(var i,n=e.slice();i=n.pop();)for(var r=i.pos,o=i.ids,s=o[2],a=t(0===s.length,r,o[0],i.ctx,o[1]),l=0,c=s.length;l<c;l++)n.push({pos:r+1,ids:s[l],ctx:a})}function o(e,t){return e.pos-t.pos}function s(e){var t=[];r(e,(function(e,i,n,r,o){e&&t.push({rev:i+"-"+n,pos:i,opts:o})})),t.sort(o).reverse();for(var i=0,n=t.length;i<n;i++)delete t[i].pos;return t}function a(e){for(var t,i=[],n=e.slice();t=n.pop();){var r=t.pos,o=t.ids,s=o[0],a=o[1],l=o[2],c=0===l.length,u=t.history?t.history.slice():[];u.push({id:s,opts:a}),c&&i.push({pos:r+1-u.length,ids:u});for(var d=0,p=l.length;d<p;d++)n.push({pos:r+1,ids:l[d],history:u})}return i.reverse()}function l(e,t){return e.pos-t.pos}function c(e,t,i){var n=function(e,t,i){for(var n,r=0,o=e.length;r<o;)i(e[n=r+o>>>1],t)<0?r=n+1:o=n;return r}(e,t,i);e.splice(n,0,t)}function u(e,t){for(var i,n,r=t,o=e.length;r<o;r++){var s=e[r],a=[s.id,s.opts,[]];n?(n[2].push(a),n=a):i=n=a}return i}function d(e,t){return e[0]<t[0]?-1:1}function p(e,t){for(var i=[{tree1:e,tree2:t}],n=!1;i.length>0;){var r=i.pop(),o=r.tree1,s=r.tree2;(o[1].status||s[1].status)&&(o[1].status="available"===o[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(o[2][0]){for(var l=!1,u=0;u<o[2].length;u++)o[2][u][0]===s[2][a][0]&&(i.push({tree1:o[2][u],tree2:s[2][a]}),l=!0);l||(n="new_branch",c(o[2],s[2][a],d))}else n="new_leaf",o[2][0]=s[2][a]}return{conflicts:n,tree:e}}function h(e,t,i){var n,r=[],o=!1,s=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var a=0,c=e.length;a<c;a++){var u=e[a];if(u.pos===t.pos&&u.ids[0]===t.ids[0])n=p(u.ids,t.ids),r.push({pos:u.pos,ids:n.tree}),o=o||n.conflicts,s=!0;else if(!0!==i){var d=u.pos<t.pos?u:t,h=u.pos<t.pos?t:u,f=h.pos-d.pos,m=[],g=[];for(g.push({ids:d.ids,diff:f,parent:null,parentIdx:null});g.length>0;){var b=g.pop();if(0!==b.diff)for(var v=b.ids[2],y=0,k=v.length;y<k;y++)g.push({ids:v[y],diff:b.diff-1,parent:b.ids,parentIdx:y});else b.ids[0]===h.ids[0]&&m.push(b)}var w=m[0];w?(n=p(w.ids,h.ids),w.parent[2][w.parentIdx]=n.tree,r.push({pos:d.pos,ids:d.ids}),o=o||n.conflicts,s=!0):r.push(u)}else r.push(u)}return s||r.push(t),r.sort(l),{tree:r,conflicts:o||"internal_node"}}function f(e){return e.ids}Object.defineProperty(i,"__esModule",{value:!0}),i.collectConflicts=function(e){for(var t=n(e),i=s(e.rev_tree),r=[],o=0,a=i.length;o<a;o++){var l=i[o];l.rev===t||l.opts.deleted||r.push(l.rev)}return r},i.collectLeaves=s,i.compactTree=function(e){var t=[];return r(e.rev_tree,(function(e,i,n,r,o){"available"!==o.status||e||(t.push(i+"-"+n),o.status="missing")})),t},i.isDeleted=function(e,t){t||(t=n(e));for(var i,r=t.substring(t.indexOf("-")+1),o=e.rev_tree.map(f);i=o.pop();){if(i[0]===r)return!!i[1].deleted;o=o.concat(i[2])}},i.isLocalId=function(e){return/^_local/.test(e)},i.merge=function(e,t,i){var n=h(e,t),o=function(e,t){for(var i,n,o=a(e),s=0,l=o.length;s<l;s++){var c,d=o[s],p=d.ids;if(p.length>t){i||(i={});var f=p.length-t;c={pos:d.pos+f,ids:u(p,f)};for(var m=0;m<f;m++){var g=d.pos+m+"-"+p[m].id;i[g]=!0}}else c={pos:d.pos,ids:u(p,0)};n=n?h(n,c,!0).tree:[c]}return i&&r(n,(function(e,t,n){delete i[t+"-"+n]})),{tree:n,revs:i?Object.keys(i):[]}}(n.tree,i);return{tree:o.tree,stemmedRevs:o.revs,conflicts:n.conflicts}},i.revExists=function(e,t){for(var i,n=e.slice(),r=t.split("-"),o=parseInt(r[0],10),s=r[1];i=n.pop();){if(i.pos===o&&i.ids[0]===s)return!0;for(var a=i.ids[2],l=0,c=a.length;l<c;l++)n.push({pos:i.pos+1,ids:a[l]})}return!1},i.rootToLeaf=a,i.traverseRevTree=r,i.winningRev=n,i.latest=function(e,t){for(var i,n=t.rev_tree.slice();i=n.pop();){var r=i.pos,o=i.ids,s=o[0],a=o[1],l=o[2],c=0===l.length,u=i.history?i.history.slice():[];if(u.push({id:s,pos:r,opts:a}),c)for(var d=0,p=u.length;d<p;d++){var h=u[d];if(h.pos+"-"+h.id===e)return r+"-"+s}for(var f=0,m=l.length;f<m;f++)n.push({pos:r+1,ids:l[f],history:u})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}},{}],272:[function(e,t,i){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(i,"__esModule",{value:!0});var r=n(e("argsarray")),o=e("pouchdb-collections"),s=n(e("inherits")),a=n(e("immediate")),l=e("pouchdb-errors"),c=e("events"),u=n(e("uuid")),d=e("pouchdb-md5");function p(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),i=new Uint8Array(t),n=new Uint8Array(e);return i.set(n),t}(e);var t=e.size,i=e.type;return"function"==typeof e.slice?e.slice(0,t,i):e.webkitSlice(0,t,i)}var h=Function.prototype.toString,f=h.call(Object);function m(e){var t,i,n;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],i=0,n=e.length;i<n;i++)t[i]=m(e[i]);return t}if(e instanceof Date)return e.toISOString();if(function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}(e))return p(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var i=t.constructor;return"function"==typeof i&&i instanceof i&&h.call(i)==f}(e))return e;for(i in t={},e)if(Object.prototype.hasOwnProperty.call(e,i)){var r=m(e[i]);void 0!==r&&(t[i]=r)}return t}function g(e){var t=!1;return r((function(i){if(t)throw new Error("once called more than once");t=!0,e.apply(this,i)}))}function b(e){return r((function(t){t=m(t);var i=this,n="function"==typeof t[t.length-1]&&t.pop(),r=new Promise((function(n,r){var o;try{var s=g((function(e,t){e?r(e):n(t)}));t.push(s),(o=e.apply(i,t))&&"function"==typeof o.then&&n(o)}catch(e){r(e)}}));return n&&r.then((function(e){n(null,e)}),n),r}))}function v(e,t){for(var i={},n=0,r=t.length;n<r;n++){var o=t[n];o in e&&(i[o]=e[o])}return i}var y;function k(e){return e}function w(e){return[{ok:e}]}try{localStorage.setItem("_pouch_check_localstorage",1),y=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){y=!1}function x(){return y}function E(){var e;c.EventEmitter.call(this),this._listeners={},e=this,x()&&addEventListener("storage",(function(t){e.emit(t.key)}))}function C(e){if("undefined"!=typeof console&&"function"==typeof console[e]){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}s(E,c.EventEmitter),E.prototype.addListener=function(e,t,i,n){if(!this._listeners[t]){var r=this,o=!1;this._listeners[t]=s,this.on(e,s)}function s(){if(r._listeners[t])if(o)o="waiting";else{o=!0;var e=v(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);i.changes(e).on("change",(function(e){e.seq>n.since&&!n.cancelled&&(n.since=e.seq,n.onChange(e))})).on("complete",(function(){"waiting"===o&&a(s),o=!1})).on("error",(function(){o=!1}))}}},E.prototype.removeListener=function(e,t){t in this._listeners&&(c.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},E.prototype.notifyLocalWindows=function(e){x()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},E.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var S="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};var _=function(){}.name?function(e){return e.name}:function(e){var t=e.toString().match(/^\s*function\s*(?:(\S+)\s*)?\(/);return t&&t[1]?t[1]:""};function T(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}var A=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],N="queryKey",I=/(?:^|&)([^&=]*)=?([^&]*)/g,O=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function P(e,t,i){return new Promise((function(n,r){e.get(t,(function(o,s){if(o){if(404!==o.status)return r(o);s={}}var a=s._rev,l=i(s);if(!l)return n({updated:!1,rev:a});l._id=t,l._rev=a,n(function(e,t,i){return e.put(t).then((function(e){return{updated:!0,rev:e.rev}}),(function(n){if(409!==n.status)throw n;return P(e,t._id,i)}))}(e,l,i))}))}))}var D=u.v4;i.adapterFun=function(e,t){return b(r((function(i){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var n=this;return function(e,t,i){if(e.constructor.listeners("debug").length){for(var n=["api",e.name,t],r=0;r<i.length-1;r++)n.push(i[r]);e.constructor.emit("debug",n);var o=i[i.length-1];i[i.length-1]=function(i,n){var r=["api",e.name,t];r=r.concat(i?["error",i]:["success",n]),e.constructor.emit("debug",r),o(i,n)}}}(n,e,i),this.taskqueue.isReady?t.apply(this,i):new Promise((function(t,r){n.taskqueue.addTask((function(o){o?r(o):t(n[e].apply(n,i))}))}))})))},i.assign=S,i.bulkGetShim=function(e,t,i){var n=t.docs,r=new o.Map;n.forEach((function(e){r.has(e.id)?r.get(e.id).push(e):r.set(e.id,[e])}));var s=r.size,a=0,l=new Array(s);function c(){var e;++a===s&&(e=[],l.forEach((function(t){t.docs.forEach((function(i){e.push({id:t.id,docs:[i]})}))})),i(null,{results:e}))}var u=[];r.forEach((function(e,t){u.push(t)}));var d=0;!function i(){if(!(d>=u.length)){var n=Math.min(d+6,u.length),o=u.slice(d,n);!function(n,o){n.forEach((function(n,s){var a=o+s,u=r.get(n),d=v(u[0],["atts_since","attachments"]);d.open_revs=u.map((function(e){return e.rev})),d.open_revs=d.open_revs.filter(k);var p=k;0===d.open_revs.length&&(delete d.open_revs,p=w),["revs","attachments","binary","ajax","latest"].forEach((function(e){e in t&&(d[e]=t[e])})),e.get(n,d,(function(e,t){var r,o,s;r=e?[{error:e}]:p(t),o=n,s=r,l[a]={id:o,docs:s},c(),i()}))}))}(o,d),d+=o.length}}()},i.changesHandler=E,i.clone=m,i.defaultBackOff=function(e){var t=0;return e||(t=2e3),function(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!=t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}(e,t)},i.explainError=function(e,t){C("info","The above "+e+" is totally normal. "+t)},i.filterChange=function(e){var t={},i=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(n){n.doc||(n.doc={});var r=i&&function(e,t,i){try{return!e(t,i)}catch(e){var n="Filter function threw: "+e.toString();return l.createError(l.BAD_REQUEST,n)}}(e.filter,n.doc,t);if("object"==typeof r)return r;if(r)return!1;if(e.include_docs){if(!e.attachments)for(var o in n.doc._attachments)n.doc._attachments.hasOwnProperty(o)&&(n.doc._attachments[o].stub=!0)}else delete n.doc;return!0}},i.flatten=function(e){for(var t=[],i=0,n=e.length;i<n;i++)t=t.concat(e[i]);return t},i.functionName=_,i.guardedConsole=C,i.hasLocalStorage=x,i.invalidIdError=function(e){var t;if(e?"string"!=typeof e?t=l.createError(l.INVALID_ID):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=l.createError(l.RESERVED_ID)):t=l.createError(l.MISSING_ID),t)throw t},i.isRemote=function(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(C("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())},i.listenerCount=function(e,t){return"listenerCount"in e?e.listenerCount(t):c.EventEmitter.listenerCount(e,t)},i.nextTick=a,i.normalizeDdocFunctionName=function(e){var t=T(e);return t?t.join("/"):null},i.once=g,i.parseDdocFunctionName=T,i.parseUri=function(e){for(var t=O.exec(e),i={},n=14;n--;){var r=A[n],o=t[n]||"",s=-1!==["user","password"].indexOf(r);i[r]=s?decodeURIComponent(o):o}return i[N]={},i[A[12]].replace(I,(function(e,t,n){t&&(i[N][t]=n)})),i},i.pick=v,i.rev=function(e,t){var i=m(e);return t?(delete i._rev_tree,d.stringMd5(JSON.stringify(i))):u.v4().replace(/-/g,"").toLowerCase()},i.scopeEval=function(e,t){var i=[],n=[];for(var r in t)t.hasOwnProperty(r)&&(i.push(r),n.push(t[r]));return i.push(e),Function.apply(null,i).apply(null,n)},i.toPromise=b,i.upsert=P,i.uuid=D},{argsarray:161,events:195,immediate:200,inherits:201,"pouchdb-collections":267,"pouchdb-errors":268,"pouchdb-md5":270,uuid:273}],273:[function(e,t,i){var n=e("./v1"),r=e("./v4"),o=r;o.v1=n,o.v4=r,t.exports=o},{"./v1":276,"./v4":277}],274:[function(e,t,i){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);t.exports=function(e,t){var i=t||0,r=n;return[r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]]].join("")}},{}],275:[function(e,t,i){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);t.exports=function(){return n(r),r}}else{var o=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},{}],276:[function(e,t,i){var n,r,o=e("./lib/rng"),s=e("./lib/bytesToUuid"),a=0,l=0;t.exports=function(e,t,i){var c=t&&i||0,u=t||[],d=(e=e||{}).node||n,p=void 0!==e.clockseq?e.clockseq:r;if(null==d||null==p){var h=o();null==d&&(d=n=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==p&&(p=r=16383&(h[6]<<8|h[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:l+1,g=f-a+(m-l)/1e4;if(g<0&&void 0===e.clockseq&&(p=p+1&16383),(g<0||f>a)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,l=m,r=p;var b=(1e4*(268435455&(f+=122192928e5))+m)%4294967296;u[c++]=b>>>24&255,u[c++]=b>>>16&255,u[c++]=b>>>8&255,u[c++]=255&b;var v=f/4294967296*1e4&268435455;u[c++]=v>>>8&255,u[c++]=255&v,u[c++]=v>>>24&15|16,u[c++]=v>>>16&255,u[c++]=p>>>8|128,u[c++]=255&p;for(var y=0;y<6;++y)u[c+y]=d[y];return t||s(u)}},{"./lib/bytesToUuid":274,"./lib/rng":275}],277:[function(e,t,i){var n=e("./lib/rng"),r=e("./lib/bytesToUuid");t.exports=function(e,t,i){var o=t&&i||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||r(s)}},{"./lib/bytesToUuid":274,"./lib/rng":275}],278:[function(e,t,i){(function(i,n){(function(){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var o,s,a=r(e("immediate")),l=r(e("uuid")),c=r(e("spark-md5")),u=r(e("vuvuzela")),d=r(e("argsarray")),p=r(e("inherits")),h=e("events");function f(e){return"$"+e}function m(e){return e.substring(1)}function g(){this._store={}}function b(e){if(this._store=new g,e&&Array.isArray(e))for(var t=0,i=e.length;t<i;t++)this.add(e[t])}function v(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),i=new Uint8Array(t),n=new Uint8Array(e);return i.set(n),t}(e);var t=e.size,i=e.type;return"function"==typeof e.slice?e.slice(0,t,i):e.webkitSlice(0,t,i)}g.prototype.get=function(e){var t=f(e);return this._store[t]},g.prototype.set=function(e,t){var i=f(e);return this._store[i]=t,!0},g.prototype.has=function(e){return f(e)in this._store},g.prototype.delete=function(e){var t=f(e),i=t in this._store;return delete this._store[t],i},g.prototype.forEach=function(e){for(var t=Object.keys(this._store),i=0,n=t.length;i<n;i++){var r=t[i];e(this._store[r],r=m(r))}},Object.defineProperty(g.prototype,"size",{get:function(){return Object.keys(this._store).length}}),b.prototype.add=function(e){return this._store.set(e,!0)},b.prototype.has=function(e){return this._store.has(e)},b.prototype.forEach=function(e){this._store.forEach((function(t,i){e(i)}))},Object.defineProperty(b.prototype,"size",{get:function(){return this._store.size}}),function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}()?(o=Set,s=Map):(o=b,s=g);var y=Function.prototype.toString,k=y.call(Object);function w(e){var t,i,n;if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){for(t=[],i=0,n=e.length;i<n;i++)t[i]=w(e[i]);return t}if(e instanceof Date)return e.toISOString();if(function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}(e))return v(e);if(!function(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var i=t.constructor;return"function"==typeof i&&i instanceof i&&y.call(i)==k}(e))return e;for(i in t={},e)if(Object.prototype.hasOwnProperty.call(e,i)){var r=w(e[i]);void 0!==r&&(t[i]=r)}return t}function x(e){var t=!1;return d((function(i){if(t)throw new Error("once called more than once");t=!0,e.apply(this,i)}))}function E(e){return d((function(t){t=w(t);var i=this,n="function"==typeof t[t.length-1]&&t.pop(),r=new Promise((function(n,r){var o;try{var s=x((function(e,t){e?r(e):n(t)}));t.push(s),(o=e.apply(i,t))&&"function"==typeof o.then&&n(o)}catch(e){r(e)}}));return n&&r.then((function(e){n(null,e)}),n),r}))}function C(e,t){return E(d((function(i){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var n=this;return function(e,t,i){if(e.constructor.listeners("debug").length){for(var n=["api",e.name,t],r=0;r<i.length-1;r++)n.push(i[r]);e.constructor.emit("debug",n);var o=i[i.length-1];i[i.length-1]=function(i,n){var r=["api",e.name,t];r=r.concat(i?["error",i]:["success",n]),e.constructor.emit("debug",r),o(i,n)}}}(n,e,i),this.taskqueue.isReady?t.apply(this,i):new Promise((function(t,r){n.taskqueue.addTask((function(o){o?r(o):t(n[e].apply(n,i))}))}))})))}function S(e,t){for(var i={},n=0,r=t.length;n<r;n++){var o=t[n];o in e&&(i[o]=e[o])}return i}var _;function T(e){return e}function A(e){return[{ok:e}]}function N(e,t,i){var n=t.docs,r=new s;n.forEach((function(e){r.has(e.id)?r.get(e.id).push(e):r.set(e.id,[e])}));var o=r.size,a=0,l=new Array(o);function c(){var e;++a===o&&(e=[],l.forEach((function(t){t.docs.forEach((function(i){e.push({id:t.id,docs:[i]})}))})),i(null,{results:e}))}var u=[];r.forEach((function(e,t){u.push(t)}));var d=0;!function i(){if(!(d>=u.length)){var n=Math.min(d+6,u.length),o=u.slice(d,n);!function(n,o){n.forEach((function(n,s){var a=o+s,u=r.get(n),d=S(u[0],["atts_since","attachments"]);d.open_revs=u.map((function(e){return e.rev})),d.open_revs=d.open_revs.filter(T);var p=T;0===d.open_revs.length&&(delete d.open_revs,p=A),["revs","attachments","binary","ajax","latest"].forEach((function(e){e in t&&(d[e]=t[e])})),e.get(n,d,(function(e,t){var r,o,s;r=e?[{error:e}]:p(t),o=n,s=r,l[a]={id:o,docs:s},c(),i()}))}))}(o,d),d+=o.length}}()}try{localStorage.setItem("_pouch_check_localstorage",1),_=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){_=!1}function I(){return _}function O(){var e;h.EventEmitter.call(this),this._listeners={},e=this,I()&&addEventListener("storage",(function(t){e.emit(t.key)}))}function P(e){if("undefined"!=typeof console&&"function"==typeof console[e]){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function D(e){var t=0;return e||(t=2e3),function(e,t){return e=parseInt(e,10)||0,(t=parseInt(t,10))!=t||t<=e?t=(e||1)<<1:t+=1,t>6e5&&(e=3e5,t=6e5),~~((t-e)*Math.random()+e)}(e,t)}function L(e,t){P("info","The above "+e+" is totally normal. "+t)}p(O,h.EventEmitter),O.prototype.addListener=function(e,t,i,n){if(!this._listeners[t]){var r=this,o=!1;this._listeners[t]=s,this.on(e,s)}function s(){if(r._listeners[t])if(o)o="waiting";else{o=!0;var e=S(n,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);i.changes(e).on("change",(function(e){e.seq>n.since&&!n.cancelled&&(n.since=e.seq,n.onChange(e))})).on("complete",(function(){"waiting"===o&&a(s),o=!1})).on("error",(function(){o=!1}))}}},O.prototype.removeListener=function(e,t){t in this._listeners&&(h.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},O.prototype.notifyLocalWindows=function(e){I()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},O.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var R="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};function M(e,t,i){Error.call(this,i),this.status=e,this.name=t,this.message=i,this.error=!0}p(M,Error),M.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new M(401,"unauthorized","Name or password is incorrect.");var B=new M(400,"bad_request","Missing JSON list of 'docs'"),j=new M(404,"not_found","missing"),U=new M(409,"conflict","Document update conflict"),F=new M(400,"bad_request","_id field must contain a string"),H=new M(412,"missing_id","_id is required for puts"),q=new M(400,"bad_request","Only reserved document ids may start with underscore."),z=(new M(412,"precondition_failed","Database not open"),new M(500,"unknown_error","Database encountered an unknown error")),G=new M(500,"badarg","Some query argument is invalid"),$=(new M(400,"invalid_request","Request was invalid"),new M(400,"query_parse_error","Some query parameter is invalid")),V=new M(500,"doc_validation","Bad special document member"),W=new M(400,"bad_request","Something wrong with the request"),K=new M(400,"bad_request","Document must be a JSON object"),J=(new M(404,"not_found","Database not found"),new M(500,"indexed_db_went_bad","unknown")),Y=(new M(500,"web_sql_went_bad","unknown"),new M(500,"levelDB_went_went_bad","unknown"),new M(403,"forbidden","Forbidden by design doc validate_doc_update function"),new M(400,"bad_request","Invalid rev format")),X=(new M(412,"file_exists","The database could not be created, the file already exists."),new M(412,"missing_stub","A pre-existing attachment stub wasn't found"));new M(413,"invalid_url","Provided URL is invalid");function Q(e,t){function i(t){for(var i in e)"function"!=typeof e[i]&&(this[i]=e[i]);void 0!==t&&(this.reason=t)}return i.prototype=M.prototype,new i(t)}function Z(e){if("object"!=typeof e){var t=e;(e=z).data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}function ee(e){var t={},i=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(n){n.doc||(n.doc={});var r=i&&function(e,t,i){try{return!e(t,i)}catch(e){var n="Filter function threw: "+e.toString();return Q(W,n)}}(e.filter,n.doc,t);if("object"==typeof r)return r;if(r)return!1;if(e.include_docs){if(!e.attachments)for(var o in n.doc._attachments)n.doc._attachments.hasOwnProperty(o)&&(n.doc._attachments[o].stub=!0)}else delete n.doc;return!0}}function te(e){for(var t=[],i=0,n=e.length;i<n;i++)t=t.concat(e[i]);return t}function ie(e){var t;if(e?"string"!=typeof e?t=Q(F):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=Q(q)):t=Q(H),t)throw t}function ne(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(P("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())}function re(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function oe(e){var t=re(e);return t?t.join("/"):null}var se=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],ae="queryKey",le=/(?:^|&)([^&=]*)=?([^&]*)/g,ce=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function ue(e){for(var t=ce.exec(e),i={},n=14;n--;){var r=se[n],o=t[n]||"",s=-1!==["user","password"].indexOf(r);i[r]=s?decodeURIComponent(o):o}return i[ae]={},i[se[12]].replace(le,(function(e,t,n){t&&(i[ae][t]=n)})),i}function de(e,t){var i=[],n=[];for(var r in t)t.hasOwnProperty(r)&&(i.push(r),n.push(t[r]));return i.push(e),Function.apply(null,i).apply(null,n)}function pe(e,t,i){return new Promise((function(n,r){e.get(t,(function(o,s){if(o){if(404!==o.status)return r(o);s={}}var a=s._rev,l=i(s);if(!l)return n({updated:!1,rev:a});l._id=t,l._rev=a,n(function(e,t,i){return e.put(t).then((function(e){return{updated:!0,rev:e.rev}}),(function(n){if(409!==n.status)throw n;return pe(e,t._id,i)}))}(e,l,i))}))}))}var he=function(e){return atob(e)},fe=function(e){return btoa(e)};function me(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(r){if("TypeError"!==r.name)throw r;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)i.append(e[n]);return i.getBlob(t.type)}}function ge(e){for(var t=e.length,i=new ArrayBuffer(t),n=new Uint8Array(i),r=0;r<t;r++)n[r]=e.charCodeAt(r);return i}function be(e,t){return me([ge(e)],{type:t})}function ve(e,t){return be(he(e),t)}function ye(e,t){var i=new FileReader,n="function"==typeof i.readAsBinaryString;i.onloadend=function(e){var i=e.target.result||"";if(n)return t(i);t(function(e){for(var t="",i=new Uint8Array(e),n=i.byteLength,r=0;r<n;r++)t+=String.fromCharCode(i[r]);return t}(i))},n?i.readAsBinaryString(e):i.readAsArrayBuffer(e)}function ke(e,t){ye(e,(function(e){t(e)}))}function we(e,t){ke(e,(function(e){t(fe(e))}))}var xe=n.setImmediate||n.setTimeout;function Ee(e,t,i,n,r){(i>0||n<t.size)&&(t=function(e,t,i){return e.webkitSlice?e.webkitSlice(t,i):e.slice(t,i)}(t,i,n)),function(e,t){var i=new FileReader;i.onloadend=function(e){var i=e.target.result||new ArrayBuffer(0);t(i)},i.readAsArrayBuffer(e)}(t,(function(t){e.append(t),r()}))}function Ce(e,t,i,n,r){(i>0||n<t.length)&&(t=t.substring(i,n)),e.appendBinary(t),r()}function Se(e,t){var i="string"==typeof e,n=i?e.length:e.size,r=Math.min(32768,n),o=Math.ceil(n/r),s=0,a=i?new c:new c.ArrayBuffer,l=i?Ce:Ee;function u(){xe(p)}function d(){var e=function(e){return fe(e)}(a.end(!0));t(e),a.destroy()}function p(){var t=s*r;l(a,e,t,t+r,++s<o?u:d)}p()}function _e(e){return c.hash(e)}function Te(e,t){var i=w(e);return t?(delete i._rev_tree,_e(JSON.stringify(i))):l.v4().replace(/-/g,"").toLowerCase()}var Ae=l.v4;function Ne(e){for(var t,i,n,r,o=e.rev_tree.slice();r=o.pop();){var s=r.ids,a=s[2],l=r.pos;if(a.length)for(var c=0,u=a.length;c<u;c++)o.push({pos:l+1,ids:a[c]});else{var d=!!s[1].deleted,p=s[0];t&&!(n!==d?n:i!==l?i<l:t<p)||(t=p,i=l,n=d)}}return i+"-"+t}function Ie(e,t){for(var i,n=e.slice();i=n.pop();)for(var r=i.pos,o=i.ids,s=o[2],a=t(0===s.length,r,o[0],i.ctx,o[1]),l=0,c=s.length;l<c;l++)n.push({pos:r+1,ids:s[l],ctx:a})}function Oe(e,t){return e.pos-t.pos}function Pe(e){var t=[];Ie(e,(function(e,i,n,r,o){e&&t.push({rev:i+"-"+n,pos:i,opts:o})})),t.sort(Oe).reverse();for(var i=0,n=t.length;i<n;i++)delete t[i].pos;return t}function De(e){for(var t=Ne(e),i=Pe(e.rev_tree),n=[],r=0,o=i.length;r<o;r++){var s=i[r];s.rev===t||s.opts.deleted||n.push(s.rev)}return n}function Le(e){for(var t,i=[],n=e.slice();t=n.pop();){var r=t.pos,o=t.ids,s=o[0],a=o[1],l=o[2],c=0===l.length,u=t.history?t.history.slice():[];u.push({id:s,opts:a}),c&&i.push({pos:r+1-u.length,ids:u});for(var d=0,p=l.length;d<p;d++)n.push({pos:r+1,ids:l[d],history:u})}return i.reverse()}function Re(e,t){return e.pos-t.pos}function Me(e,t,i){var n=function(e,t,i){for(var n,r=0,o=e.length;r<o;)i(e[n=r+o>>>1],t)<0?r=n+1:o=n;return r}(e,t,i);e.splice(n,0,t)}function Be(e,t){for(var i,n,r=t,o=e.length;r<o;r++){var s=e[r],a=[s.id,s.opts,[]];n?(n[2].push(a),n=a):i=n=a}return i}function je(e,t){return e[0]<t[0]?-1:1}function Ue(e,t){for(var i=[{tree1:e,tree2:t}],n=!1;i.length>0;){var r=i.pop(),o=r.tree1,s=r.tree2;(o[1].status||s[1].status)&&(o[1].status="available"===o[1].status||"available"===s[1].status?"available":"missing");for(var a=0;a<s[2].length;a++)if(o[2][0]){for(var l=!1,c=0;c<o[2].length;c++)o[2][c][0]===s[2][a][0]&&(i.push({tree1:o[2][c],tree2:s[2][a]}),l=!0);l||(n="new_branch",Me(o[2],s[2][a],je))}else n="new_leaf",o[2][0]=s[2][a]}return{conflicts:n,tree:e}}function Fe(e,t,i){var n,r=[],o=!1,s=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var a=0,l=e.length;a<l;a++){var c=e[a];if(c.pos===t.pos&&c.ids[0]===t.ids[0])n=Ue(c.ids,t.ids),r.push({pos:c.pos,ids:n.tree}),o=o||n.conflicts,s=!0;else if(!0!==i){var u=c.pos<t.pos?c:t,d=c.pos<t.pos?t:c,p=d.pos-u.pos,h=[],f=[];for(f.push({ids:u.ids,diff:p,parent:null,parentIdx:null});f.length>0;){var m=f.pop();if(0!==m.diff)for(var g=m.ids[2],b=0,v=g.length;b<v;b++)f.push({ids:g[b],diff:m.diff-1,parent:m.ids,parentIdx:b});else m.ids[0]===d.ids[0]&&h.push(m)}var y=h[0];y?(n=Ue(y.ids,d.ids),y.parent[2][y.parentIdx]=n.tree,r.push({pos:u.pos,ids:u.ids}),o=o||n.conflicts,s=!0):r.push(c)}else r.push(c)}return s||r.push(t),r.sort(Re),{tree:r,conflicts:o||"internal_node"}}function He(e,t,i){var n=Fe(e,t),r=function(e,t){for(var i,n,r=Le(e),o=0,s=r.length;o<s;o++){var a,l=r[o],c=l.ids;if(c.length>t){i||(i={});var u=c.length-t;a={pos:l.pos+u,ids:Be(c,u)};for(var d=0;d<u;d++){var p=l.pos+d+"-"+c[d].id;i[p]=!0}}else a={pos:l.pos,ids:Be(c,0)};n=n?Fe(n,a,!0).tree:[a]}return i&&Ie(n,(function(e,t,n){delete i[t+"-"+n]})),{tree:n,revs:i?Object.keys(i):[]}}(n.tree,i);return{tree:r.tree,stemmedRevs:r.revs,conflicts:n.conflicts}}function qe(e){return e.ids}function ze(e,t){t||(t=Ne(e));for(var i,n=t.substring(t.indexOf("-")+1),r=e.rev_tree.map(qe);i=r.pop();){if(i[0]===n)return!!i[1].deleted;r=r.concat(i[2])}}function Ge(e){return/^_local/.test(e)}function $e(e,t,i){h.EventEmitter.call(this);var n=this;this.db=e;var r=(t=t?w(t):{}).complete=x((function(t,i){t?function(e,t){return"listenerCount"in e?e.listenerCount(t):h.EventEmitter.listenerCount(e,t)}(n,"error")>0&&n.emit("error",t):n.emit("complete",i),n.removeAllListeners(),e.removeListener("destroyed",o)}));function o(){n.cancel()}i&&(n.on("complete",(function(e){i(null,e)})),n.on("error",i)),e.once("destroyed",o),t.onChange=function(e,t,i){n.isCancelled||function(e,t,i,n){try{e.emit("change",t,i,n)}catch(e){P("error",'Error in .on("change", function):',e)}}(n,e,t,i)};var s=new Promise((function(e,i){t.complete=function(t,n){t?i(t):e(n)}}));n.once("cancel",(function(){e.removeListener("destroyed",o),t.complete(null,{status:"cancelled"})})),this.then=s.then.bind(s),this.catch=s.catch.bind(s),this.then((function(e){r(null,e)}),r),e.taskqueue.isReady?n.validateChanges(t):e.taskqueue.addTask((function(e){e?t.complete(e):n.isCancelled?n.emit("cancel"):n.validateChanges(t)}))}function Ve(e,t,i){var n=[{rev:e._rev}];"all_docs"===i.style&&(n=Pe(t.rev_tree).map((function(e){return{rev:e.rev}})));var r={id:t.id,changes:n,doc:e};return ze(t,e._rev)&&(r.deleted=!0),i.conflicts&&(r.doc._conflicts=De(t),r.doc._conflicts.length||delete r.doc._conflicts),r}function We(e,t){return e<t?-1:e>t?1:0}function Ke(e,t){return function(i,n){i||n[0]&&n[0].error?((i=i||n[0]).docId=t,e(i)):e(null,n.length?n[0]:n)}}function Je(e,t){var i=We(e._id,t._id);return 0!==i?i:We(e._revisions?e._revisions.start:0,t._revisions?t._revisions.start:0)}function Ye(e){var t=e._compactionQueue[0],i=t.opts,n=t.callback;e.get("_local/compaction").catch((function(){return!1})).then((function(t){t&&t.last_seq&&(i.last_seq=t.last_seq),e._compact(i,(function(t,i){t?n(t):n(null,i),a((function(){e._compactionQueue.shift(),e._compactionQueue.length&&Ye(e)}))}))}))}function Xe(){for(var e in h.EventEmitter.call(this),Xe.prototype)"function"==typeof this[e]&&(this[e]=this[e].bind(this))}function Qe(){this.isReady=!1,this.failed=!1,this.queue=[]}function Ze(e,t){if(!(this instanceof Ze))return new Ze(e,t);var i=this;if(t=t||{},e&&"object"==typeof e&&(e=(t=e).name,delete t.name),void 0===t.deterministic_revs&&(t.deterministic_revs=!0),this.__opts=t=w(t),i.auto_compaction=t.auto_compaction,i.prefix=Ze.prefix,"string"!=typeof e)throw new Error("Missing/invalid DB name");var n=function(e,t){var i=e.match(/([a-z-]*):\/\/(.*)/);if(i)return{name:/https?/.test(i[1])?i[1]+"://"+i[2]:i[2],adapter:i[1]};var n=Ze.adapters,r=Ze.preferredAdapters,o=Ze.prefix,s=t.adapter;if(!s)for(var a=0;a<r.length&&"idb"===(s=r[a])&&"websql"in n&&I()&&localStorage["_pouch__websqldb_"+o+e];++a)P("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var l=n[s];return{name:l&&"use_prefix"in l&&!l.use_prefix?e:o+e,adapter:s}}((t.prefix||"")+e,t);if(t.name=n.name,t.adapter=t.adapter||n.adapter,i.name=e,i._adapter=t.adapter,Ze.emit("debug",["adapter","Picked adapter: ",t.adapter]),!Ze.adapters[t.adapter]||!Ze.adapters[t.adapter].valid())throw new Error("Invalid Adapter: "+t.adapter);Xe.call(i),i.taskqueue=new Qe,i.adapter=t.adapter,Ze.adapters[t.adapter].call(i,t,(function(e){if(e)return i.taskqueue.fail(e);(function(e){function t(t){e.removeListener("closed",i),t||e.constructor.emit("destroyed",e.name)}function i(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",i),e.constructor.emit("ref",e)})(i),i.emit("created",i),Ze.emit("created",i.name),i.taskqueue.ready(i)}))}p($e,h.EventEmitter),$e.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},$e.prototype.validateChanges=function(e){var t=e.complete,i=this;Ze._changesFilterPlugin?Ze._changesFilterPlugin.validate(e,(function(n){if(n)return t(n);i.doChanges(e)})):i.doChanges(e)},$e.prototype.doChanges=function(e){var t=this,i=e.complete;if("live"in(e=w(e))&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=Ve,"latest"===e.since&&(e.since="now"),e.since||(e.since=0),"now"!==e.since){if(Ze._changesFilterPlugin){if(Ze._changesFilterPlugin.normalize(e),Ze._changesFilterPlugin.shouldFilter(this,e))return Ze._changesFilterPlugin.filter(this,e)}else["doc_ids","filter","selector","view"].forEach((function(t){t in e&&P("warn",'The "'+t+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')}));"descending"in e||(e.descending=!1),e.limit=0===e.limit?1:e.limit,e.complete=i;var n=this.db._changes(e);if(n&&"function"==typeof n.cancel){var r=t.cancel;t.cancel=d((function(e){n.cancel(),r.apply(this,e)}))}}else this.db.info().then((function(n){t.isCancelled?i(null,{status:"cancelled"}):(e.since=n.update_seq,t.doChanges(e))}),i)},p(Xe,h.EventEmitter),Xe.prototype.post=C("post",(function(e,t,i){if("function"==typeof t&&(i=t,t={}),"object"!=typeof e||Array.isArray(e))return i(Q(K));this.bulkDocs({docs:[e]},t,Ke(i,e._id))})),Xe.prototype.put=C("put",(function(e,t,i){if("function"==typeof t&&(i=t,t={}),"object"!=typeof e||Array.isArray(e))return i(Q(K));if(ie(e._id),Ge(e._id)&&"function"==typeof this._putLocal)return e._deleted?this._removeLocal(e,i):this._putLocal(e,i);var n,r,o,s,a=this;function l(i){"function"==typeof a._put&&!1!==t.new_edits?a._put(e,t,i):a.bulkDocs({docs:[e]},t,Ke(i,e._id))}t.force&&e._rev?(r=(n=e._rev.split("-"))[1],o=parseInt(n[0],10)+1,s=Te(),e._revisions={start:o,ids:[s,r]},e._rev=o+"-"+s,t.new_edits=!1,l((function(t){var n=t?null:{ok:!0,id:e._id,rev:e._rev};i(t,n)}))):l(i)})),Xe.prototype.putAttachment=C("putAttachment",(function(e,t,i,n,r){var o=this;function s(e){var i="_rev"in e?parseInt(e._rev,10):0;return e._attachments=e._attachments||{},e._attachments[t]={content_type:r,data:n,revpos:++i},o.put(e)}return"function"==typeof r&&(r=n,n=i,i=null),void 0===r&&(r=n,n=i,i=null),r||P("warn","Attachment",t,"on document",e,"is missing content_type"),o.get(e).then((function(e){if(e._rev!==i)throw Q(U);return s(e)}),(function(t){if(t.reason===j.message)return s({_id:e});throw t}))})),Xe.prototype.removeAttachment=C("removeAttachment",(function(e,t,i,n){var r=this;r.get(e,(function(e,o){if(e)n(e);else if(o._rev===i){if(!o._attachments)return n();delete o._attachments[t],0===Object.keys(o._attachments).length&&delete o._attachments,r.put(o,n)}else n(Q(U))}))})),Xe.prototype.remove=C("remove",(function(e,t,i,n){var r;"string"==typeof t?(r={_id:e,_rev:t},"function"==typeof i&&(n=i,i={})):(r=e,"function"==typeof t?(n=t,i={}):(n=i,i=t)),(i=i||{}).was_delete=!0;var o={_id:r._id,_rev:r._rev||i.rev,_deleted:!0};if(Ge(o._id)&&"function"==typeof this._removeLocal)return this._removeLocal(r,n);this.bulkDocs({docs:[o]},i,Ke(n,o._id))})),Xe.prototype.revsDiff=C("revsDiff",(function(e,t,i){"function"==typeof t&&(i=t,t={});var n=Object.keys(e);if(!n.length)return i(null,{});var r=0,o=new s;function a(e,t){o.has(e)||o.set(e,{missing:[]}),o.get(e).missing.push(t)}n.map((function(t){this._getRevisionTree(t,(function(s,l){if(s&&404===s.status&&"missing"===s.message)o.set(t,{missing:e[t]});else{if(s)return i(s);!function(t,i){var n=e[t].slice(0);Ie(i,(function(e,i,r,o,s){var l=i+"-"+r,c=n.indexOf(l);-1!==c&&(n.splice(c,1),"available"!==s.status&&a(t,l))})),n.forEach((function(e){a(t,e)}))}(t,l)}if(++r===n.length){var c={};return o.forEach((function(e,t){c[t]=e})),i(null,c)}}))}),this)})),Xe.prototype.bulkGet=C("bulkGet",(function(e,t){N(this,e,t)})),Xe.prototype.compactDocument=C("compactDocument",(function(e,t,i){var n=this;this._getRevisionTree(e,(function(r,o){if(r)return i(r);var s=function(e){var t={},i=[];return Ie(e,(function(e,n,r,o){var s=n+"-"+r;return e&&(t[s]=0),void 0!==o&&i.push({from:o,to:s}),s})),i.reverse(),i.forEach((function(e){void 0===t[e.from]?t[e.from]=1+t[e.to]:t[e.from]=Math.min(t[e.from],1+t[e.to])})),t}(o),a=[],l=[];Object.keys(s).forEach((function(e){s[e]>t&&a.push(e)})),Ie(o,(function(e,t,i,n,r){var o=t+"-"+i;"available"===r.status&&-1!==a.indexOf(o)&&l.push(o)})),n._doCompaction(e,l,i)}))})),Xe.prototype.compact=C("compact",(function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:e,callback:t}),1===this._compactionQueue.length&&Ye(this)})),Xe.prototype._compact=function(e,t){var i=this,n={return_docs:!1,last_seq:e.last_seq||0},r=[];i.changes(n).on("change",(function(e){r.push(i.compactDocument(e.id,0))})).on("complete",(function(e){var n=e.last_seq;Promise.all(r).then((function(){return pe(i,"_local/compaction",(function(e){return(!e.last_seq||e.last_seq<n)&&(e.last_seq=n,e)}))})).then((function(){t(null,{ok:!0})})).catch(t)})).on("error",t)},Xe.prototype.get=C("get",(function(e,t,i){if("function"==typeof t&&(i=t,t={}),"string"!=typeof e)return i(Q(F));if(Ge(e)&&"function"==typeof this._getLocal)return this._getLocal(e,i);var n=[],r=this;function o(){var o=[],s=n.length;if(!s)return i(null,o);n.forEach((function(n){r.get(e,{rev:n,revs:t.revs,latest:t.latest,attachments:t.attachments,binary:t.binary},(function(e,t){if(e)o.push({missing:n});else{for(var r,a=0,l=o.length;a<l;a++)if(o[a].ok&&o[a].ok._rev===t._rev){r=!0;break}r||o.push({ok:t})}--s||i(null,o)}))}))}if(!t.open_revs)return this._get(e,t,(function(n,o){if(n)return n.docId=e,i(n);var s=o.doc,a=o.metadata,l=o.ctx;if(t.conflicts){var c=De(a);c.length&&(s._conflicts=c)}if(ze(a,s._rev)&&(s._deleted=!0),t.revs||t.revs_info){for(var u=s._rev.split("-"),d=parseInt(u[0],10),p=u[1],h=Le(a.rev_tree),f=null,m=0;m<h.length;m++){var g=h[m],b=g.ids.map((function(e){return e.id})).indexOf(p);(b===d-1||!f&&-1!==b)&&(f=g)}if(!f)return(n=new Error("invalid rev tree")).docId=e,i(n);var v=f.ids.map((function(e){return e.id})).indexOf(s._rev.split("-")[1])+1,y=f.ids.length-v;if(f.ids.splice(v,y),f.ids.reverse(),t.revs&&(s._revisions={start:f.pos+f.ids.length-1,ids:f.ids.map((function(e){return e.id}))}),t.revs_info){var k=f.pos+f.ids.length;s._revs_info=f.ids.map((function(e){return{rev:--k+"-"+e.id,status:e.opts.status}}))}}if(t.attachments&&s._attachments){var w=s._attachments,x=Object.keys(w).length;if(0===x)return i(null,s);Object.keys(w).forEach((function(e){this._getAttachment(s._id,e,w[e],{rev:s._rev,binary:t.binary,ctx:l},(function(t,n){var r=s._attachments[e];r.data=n,delete r.stub,delete r.length,--x||i(null,s)}))}),r)}else{if(s._attachments)for(var E in s._attachments)s._attachments.hasOwnProperty(E)&&(s._attachments[E].stub=!0);i(null,s)}}));if("all"===t.open_revs)this._getRevisionTree(e,(function(e,t){if(e)return i(e);n=Pe(t).map((function(e){return e.rev})),o()}));else{if(!Array.isArray(t.open_revs))return i(Q(z,"function_clause"));n=t.open_revs;for(var s=0;s<n.length;s++){var a=n[s];if("string"!=typeof a||!/^\d+-/.test(a))return i(Q(Y))}o()}})),Xe.prototype.getAttachment=C("getAttachment",(function(e,t,i,n){var r=this;i instanceof Function&&(n=i,i={}),this._get(e,i,(function(o,s){return o?n(o):s.doc._attachments&&s.doc._attachments[t]?(i.ctx=s.ctx,i.binary=!0,void r._getAttachment(e,t,s.doc._attachments[t],i,n)):n(Q(j))}))})),Xe.prototype.allDocs=C("allDocs",(function(e,t){if("function"==typeof e&&(t=e,e={}),e.skip=void 0!==e.skip?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return t(new TypeError("options.keys must be an array"));var i=["startkey","endkey","key"].filter((function(t){return t in e}))[0];if(i)return void t(Q($,"Query parameter `"+i+"` is not compatible with multi-get"));if(!ne(this)&&(function(e){var t="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;e.keys=t,e.skip=0,delete e.limit,e.descending&&(t.reverse(),e.descending=!1)}(e),0===e.keys.length))return this._allDocs({limit:0},t)}return this._allDocs(e,t)})),Xe.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),(e=e||{}).return_docs="return_docs"in e?e.return_docs:!e.live,new $e(this,e,t)},Xe.prototype.close=C("close",(function(e){return this._closed=!0,this.emit("closed"),this._close(e)})),Xe.prototype.info=C("info",(function(e){var t=this;this._info((function(i,n){if(i)return e(i);n.db_name=n.db_name||t.name,n.auto_compaction=!(!t.auto_compaction||ne(t)),n.adapter=t.adapter,e(null,n)}))})),Xe.prototype.id=C("id",(function(e){return this._id(e)})),Xe.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},Xe.prototype.bulkDocs=C("bulkDocs",(function(e,t,i){if("function"==typeof t&&(i=t,t={}),t=t||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return i(Q(B));for(var n=0;n<e.docs.length;++n)if("object"!=typeof e.docs[n]||Array.isArray(e.docs[n]))return i(Q(K));var r;if(e.docs.forEach((function(e){e._attachments&&Object.keys(e._attachments).forEach((function(t){r=r||function(e){return"_"===e.charAt(0)&&e+" is not a valid attachment name, attachment names cannot start with '_'"}(t),e._attachments[t].content_type||P("warn","Attachment",t,"on document",e._id,"is missing content_type")}))})),r)return i(Q(W,r));"new_edits"in t||(t.new_edits=!("new_edits"in e)||e.new_edits);var o=this;t.new_edits||ne(o)||e.docs.sort(Je),function(e){for(var t=0;t<e.length;t++){var i=e[t];if(i._deleted)delete i._attachments;else if(i._attachments)for(var n=Object.keys(i._attachments),r=0;r<n.length;r++){var o=n[r];i._attachments[o]=S(i._attachments[o],["data","digest","content_type","length","revpos","stub"])}}}(e.docs);var s=e.docs.map((function(e){return e._id}));return this._bulkDocs(e,t,(function(e,n){if(e)return i(e);if(t.new_edits||(n=n.filter((function(e){return e.error}))),!ne(o))for(var r=0,a=n.length;r<a;r++)n[r].id=n[r].id||s[r];i(null,n)}))})),Xe.prototype.registerDependentDatabase=C("registerDependentDatabase",(function(e,t){var i=new this.constructor(e,this.__opts);pe(this,"_local/_pouch_dependentDbs",(function(t){return t.dependentDbs=t.dependentDbs||{},!t.dependentDbs[e]&&(t.dependentDbs[e]=!0,t)})).then((function(){t(null,{db:i})})).catch(t)})),Xe.prototype.destroy=C("destroy",(function(e,t){"function"==typeof e&&(t=e,e={});var i=this,n=!("use_prefix"in i)||i.use_prefix;function r(){i._destroy(e,(function(e,n){if(e)return t(e);i._destroyed=!0,i.emit("destroyed"),t(null,n||{ok:!0})}))}if(ne(i))return r();i.get("_local/_pouch_dependentDbs",(function(e,o){if(e)return 404!==e.status?t(e):r();var s=o.dependentDbs,a=i.constructor,l=Object.keys(s).map((function(e){var t=n?e.replace(new RegExp("^"+a.prefix),""):e;return new a(t,i.__opts).destroy()}));Promise.all(l).then(r,t)}))})),Qe.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},Qe.prototype.fail=function(e){this.failed=e,this.execute()},Qe.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},Qe.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()},p(Ze,Xe);var et="undefined"!=typeof AbortController?AbortController:function(){return{abort:function(){}}},tt=fetch,it=Headers;Ze.adapters={},Ze.preferredAdapters=[],Ze.prefix="_pouch_";var nt=new h.EventEmitter;(function(e){Object.keys(h.EventEmitter.prototype).forEach((function(t){"function"==typeof h.EventEmitter.prototype[t]&&(e[t]=nt[t].bind(nt))}));var t=e._destructionListeners=new s;e.on("ref",(function(e){t.has(e.name)||t.set(e.name,[]),t.get(e.name).push(e)})),e.on("unref",(function(e){if(t.has(e.name)){var i=t.get(e.name),n=i.indexOf(e);n<0||(i.splice(n,1),i.length>1?t.set(e.name,i):t.delete(e.name))}})),e.on("destroyed",(function(e){if(t.has(e)){var i=t.get(e);t.delete(e),i.forEach((function(e){e.emit("destroyed",!0)}))}}))})(Ze),Ze.adapter=function(e,t,i){t.valid()&&(Ze.adapters[e]=t,i&&Ze.preferredAdapters.push(e))},Ze.plugin=function(e){if("function"==typeof e)e(Ze);else{if("object"!=typeof e||0===Object.keys(e).length)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach((function(t){Ze.prototype[t]=e[t]}))}return this.__defaults&&(Ze.__defaults=R({},this.__defaults)),Ze},Ze.defaults=function(e){function t(e,i){if(!(this instanceof t))return new t(e,i);i=i||{},e&&"object"==typeof e&&(e=(i=e).name,delete i.name),i=R({},t.__defaults,i),Ze.call(this,e,i)}return p(t,Ze),t.preferredAdapters=Ze.preferredAdapters.slice(),Object.keys(Ze).forEach((function(e){e in t||(t[e]=Ze[e])})),t.__defaults=R({},this.__defaults,e),t},Ze.fetch=function(e,t){return tt(e,t)};function rt(e,t){for(var i=e,n=0,r=t.length;n<r&&(i=i[t[n]]);n++);return i}function ot(e){for(var t=[],i="",n=0,r=e.length;n<r;n++){var o=e[n];"."===o?n>0&&"\\"===e[n-1]?i=i.substring(0,i.length-1)+".":(t.push(i),i=""):i+=o}return t.push(i),t}var st=["$or","$nor","$not"];function at(e){return st.indexOf(e)>-1}function lt(e){return Object.keys(e)[0]}function ct(e){var t={};return e.forEach((function(e){Object.keys(e).forEach((function(i){var n=e[i];if("object"!=typeof n&&(n={$eq:n}),at(i))t[i]=n instanceof Array?n.map((function(e){return ct([e])})):ct([n]);else{var r=t[i]=t[i]||{};Object.keys(n).forEach((function(e){var t=n[e];return"$gt"===e||"$gte"===e?function(e,t,i){void 0===i.$eq&&(void 0!==i.$gte?"$gte"===e?t>i.$gte&&(i.$gte=t):t>=i.$gte&&(delete i.$gte,i.$gt=t):void 0!==i.$gt?"$gte"===e?t>i.$gt&&(delete i.$gt,i.$gte=t):t>i.$gt&&(i.$gt=t):i[e]=t)}(e,t,r):"$lt"===e||"$lte"===e?function(e,t,i){void 0===i.$eq&&(void 0!==i.$lte?"$lte"===e?t<i.$lte&&(i.$lte=t):t<=i.$lte&&(delete i.$lte,i.$lt=t):void 0!==i.$lt?"$lte"===e?t<i.$lt&&(delete i.$lt,i.$lte=t):t<i.$lt&&(i.$lt=t):i[e]=t)}(e,t,r):"$ne"===e?function(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}(t,r):"$eq"===e?function(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}(t,r):void(r[e]=t)}))}}))})),t}function ut(e){for(var t in e){if(Array.isArray(e))for(var i in e)e[i].$and&&(e[i]=ct(e[i].$and));var n=e[t];"object"==typeof n&&ut(n)}return e}function dt(e,t){for(var i in e){"$and"===i&&(t=!0);var n=e[i];"object"==typeof n&&(t=dt(n,t))}return t}function pt(e){var t=w(e),i=!1;dt(t,!1)&&("$and"in(t=ut(t))&&(t=ct(t.$and)),i=!0),["$or","$nor"].forEach((function(e){e in t&&t[e].forEach((function(e){for(var t=Object.keys(e),i=0;i<t.length;i++){var n=t[i],r=e[n];"object"==typeof r&&null!==r||(e[n]={$eq:r})}}))})),"$not"in t&&(t.$not=ct([t.$not]));for(var n=Object.keys(t),r=0;r<n.length;r++){var o=n[r],s=t[o];"object"!=typeof s||null===s?s={$eq:s}:"$ne"in s&&!i&&(s.$ne=[s.$ne]),t[o]=s}return t}var ht=-324;function ft(e,t){if(e===t)return 0;e=mt(e),t=mt(t);var i=kt(e),n=kt(t);if(i-n!=0)return i-n;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return function(e,t){return e===t?0:e>t?1:-1}(e,t)}return Array.isArray(e)?function(e,t){for(var i=Math.min(e.length,t.length),n=0;n<i;n++){var r=ft(e[n],t[n]);if(0!==r)return r}return e.length===t.length?0:e.length>t.length?1:-1}(e,t):function(e,t){for(var i=Object.keys(e),n=Object.keys(t),r=Math.min(i.length,n.length),o=0;o<r;o++){var s=ft(i[o],n[o]);if(0!==s)return s;if(0!==(s=ft(e[i[o]],t[n[o]])))return s}return i.length===n.length?0:i.length>n.length?1:-1}(e,t)}function mt(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var i=e.length;e=new Array(i);for(var n=0;n<i;n++)e[n]=mt(t[n])}else{if(e instanceof Date)return e.toJSON();if(null!==e)for(var r in e={},t)if(t.hasOwnProperty(r)){var o=t[r];void 0!==o&&(e[r]=mt(o))}}}return e}function gt(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return function(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),i=parseInt(t[1],10),n=e<0,r=n?"0":"2",o=function(e,t,i){return function(e,t,i){for(var n="",r=i-e.length;n.length<r;)n+=t;return n}(e,t,i)+e}(((n?-i:i)-ht).toString(),"0",3);r+=""+o;var s=Math.abs(parseFloat(t[0]));n&&(s=10-s);var a=s.toFixed(20);return a=a.replace(/\.?0+$/,""),r+""+a}(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),i=t?e:Object.keys(e),n=-1,r=i.length,o="";if(t)for(;++n<r;)o+=bt(i[n]);else for(;++n<r;){var s=i[n];o+=bt(s)+bt(e[s])}return o}return""}function bt(e){return kt(e=mt(e))+""+gt(e)+"\0"}function vt(e,t){var i,n=t;if("1"===e[t])i=0,t++;else{var r="0"===e[t];t++;var o="",s=e.substring(t,t+3),a=parseInt(s,10)+ht;for(r&&(a=-a),t+=3;;){var l=e[t];if("\0"===l)break;o+=l,t++}i=1===(o=o.split(".")).length?parseInt(o,10):parseFloat(o[0]+"."+o[1]),r&&(i-=10),0!==a&&(i=parseFloat(i+"e"+a))}return{num:i,length:t-n}}function yt(e,t){var i=e.pop();if(t.length){var n=t[t.length-1];i===n.element&&(t.pop(),n=t[t.length-1]);var r=n.element,o=n.index;Array.isArray(r)?r.push(i):o===e.length-2?r[e.pop()]=i:e.push(i)}}function kt(e){var t=["boolean","number","string","object"].indexOf(typeof e);return~t?null===e?1:Array.isArray(e)?5:t<3?t+2:t+3:Array.isArray(e)?5:void 0}function wt(e,t,i){if(e=e.filter((function(e){return xt(e.doc,t.selector,i)})),t.sort){var n=function(e){function t(t){return e.map((function(e){var i=ot(lt(e));return rt(t,i)}))}return function(e,i){var n=ft(t(e.doc),t(i.doc));return 0!==n?n:function(e,t){return e<t?-1:e>t?1:0}(e.doc._id,i.doc._id)}}(t.sort);e=e.sort(n),"string"!=typeof t.sort[0]&&"desc"===function(e){return e[lt(e)]}(t.sort[0])&&(e=e.reverse())}if("limit"in t||"skip"in t){var r=t.skip||0,o=("limit"in t?t.limit:e.length)+r;e=e.slice(r,o)}return e}function xt(e,t,i){return i.every((function(i){var n=t[i],r=ot(i),o=rt(e,r);return at(i)?function(e,t,i){return"$or"===e?t.some((function(e){return xt(i,e,Object.keys(e))})):"$not"===e?!xt(i,t,Object.keys(t)):!t.find((function(e){return xt(i,e,Object.keys(e))}))}(i,n,e):Et(n,e,r,o)}))}function Et(e,t,i,n){return!e||("object"==typeof e?Object.keys(e).every((function(r){var o=e[r];return function(e,t,i,n,r){if(!Tt[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return Tt[e](t,i,n,r)}(r,t,o,i,n)})):e===n)}function Ct(e){return null!=e}function St(e){return void 0!==e}function _t(e,t){return t.some((function(t){return e instanceof Array?e.indexOf(t)>-1:e===t}))}var Tt={$elemMatch:function(e,t,i,n){return!!Array.isArray(n)&&0!==n.length&&("object"==typeof n[0]?n.some((function(e){return xt(e,t,Object.keys(t))})):n.some((function(n){return Et(t,e,i,n)})))},$allMatch:function(e,t,i,n){return!!Array.isArray(n)&&0!==n.length&&("object"==typeof n[0]?n.every((function(e){return xt(e,t,Object.keys(t))})):n.every((function(n){return Et(t,e,i,n)})))},$eq:function(e,t,i,n){return St(n)&&0===ft(n,t)},$gte:function(e,t,i,n){return St(n)&&ft(n,t)>=0},$gt:function(e,t,i,n){return St(n)&&ft(n,t)>0},$lte:function(e,t,i,n){return St(n)&&ft(n,t)<=0},$lt:function(e,t,i,n){return St(n)&&ft(n,t)<0},$exists:function(e,t,i,n){return t?St(n):!St(n)},$mod:function(e,t,i,n){return Ct(n)&&function(e,t){var i=t[0],n=t[1];if(0===i)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(i,10)!==i)throw new Error("Divisor is not an integer");if(parseInt(n,10)!==n)throw new Error("Modulus is not an integer");return parseInt(e,10)===e&&e%i===n}(n,t)},$ne:function(e,t,i,n){return t.every((function(e){return 0!==ft(n,e)}))},$in:function(e,t,i,n){return Ct(n)&&_t(n,t)},$nin:function(e,t,i,n){return Ct(n)&&!_t(n,t)},$size:function(e,t,i,n){return Ct(n)&&function(e,t){return e.length===t}(n,t)},$all:function(e,t,i,n){return Array.isArray(n)&&function(e,t){return t.every((function(t){return e.indexOf(t)>-1}))}(n,t)},$regex:function(e,t,i,n){return Ct(n)&&function(e,t){return new RegExp(t).test(e)}(n,t)},$type:function(e,t,i,n){return function(e,t){switch(t){case"null":return null===e;case"boolean":return"boolean"==typeof e;case"number":return"number"==typeof e;case"string":return"string"==typeof e;case"array":return e instanceof Array;case"object":return"[object Object]"==={}.toString.call(e)}throw new Error(t+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}(n,t)}};function At(e,t){if(e.selector&&e.filter&&"_selector"!==e.filter){var i="string"==typeof e.filter?e.filter:"function";return t(new Error('selector invalid for filter "'+i+'"'))}t()}function Nt(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&"string"==typeof e.filter&&("_view"===e.filter?e.view=oe(e.view):e.filter=oe(e.filter))}function It(e,t){return t.filter&&"string"==typeof t.filter&&!t.doc_ids&&!ne(e.db)}function Ot(e,t){var i=t.complete;if("_view"===t.filter){if(!t.view||"string"!=typeof t.view){var n=Q(W,"`view` filter parameter not found or invalid.");return i(n)}var r=re(t.view);e.db.get("_design/"+r[0],(function(n,o){if(e.isCancelled)return i(null,{status:"cancelled"});if(n)return i(Z(n));var s=o&&o.views&&o.views[r[1]]&&o.views[r[1]].map;if(!s)return i(Q(j,o.views?"missing json key: "+r[1]:"missing json key: views"));t.filter=function(e){return de(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{})}(s),e.doChanges(t)}))}else if(t.selector)t.filter=function(e){return function(e,t){if("object"!=typeof t)throw new Error("Selector error: expected a JSON object");var i=wt([{doc:e}],{selector:t=pt(t)},Object.keys(t));return i&&1===i.length}(e,t.selector)},e.doChanges(t);else{var o=re(t.filter);e.db.get("_design/"+o[0],(function(n,r){if(e.isCancelled)return i(null,{status:"cancelled"});if(n)return i(Z(n));var s=r&&r.filters&&r.filters[o[1]];if(!s)return i(Q(j,r&&r.filters?"missing json key: "+o[1]:"missing json key: filters"));t.filter=function(e){return de('"use strict";\nreturn '+e+";",{})}(s),e.doChanges(t)}))}}function Pt(e){return e.reduce((function(e,t){return e[t]=!0,e}),{})}Ze.plugin((function(e){e._changesFilterPlugin={validate:At,normalize:Nt,shouldFilter:It,filter:Ot}})),Ze.version="7.2.1";var Dt=Pt(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Lt=Pt(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Rt(e){if(!/^\d+-/.test(e))return Q(Y);var t=e.indexOf("-"),i=e.substring(0,t),n=e.substring(t+1);return{prefix:parseInt(i,10),id:n}}function Mt(e,t,i){var n,r,o;i||(i={deterministic_revs:!0});var s={status:"available"};if(e._deleted&&(s.deleted=!0),t)if(e._id||(e._id=Ae()),r=Te(e,i.deterministic_revs),e._rev){if((o=Rt(e._rev)).error)return o;e._rev_tree=[{pos:o.prefix,ids:[o.id,{status:"missing"},[[r,s,[]]]]}],n=o.prefix+1}else e._rev_tree=[{pos:1,ids:[r,s,[]]}],n=1;else if(e._revisions&&(e._rev_tree=function(e,t){for(var i=e.start-e.ids.length+1,n=e.ids,r=[n[0],t,[]],o=1,s=n.length;o<s;o++)r=[n[o],{status:"missing"},[r]];return[{pos:i,ids:r}]}(e._revisions,s),n=e._revisions.start,r=e._revisions.ids[0]),!e._rev_tree){if((o=Rt(e._rev)).error)return o;n=o.prefix,r=o.id,e._rev_tree=[{pos:n,ids:[r,s,[]]}]}ie(e._id),e._rev=n+"-"+r;var a={metadata:{},data:{}};for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){var c="_"===l[0];if(c&&!Dt[l]){var u=Q(V,l);throw u.message=V.message+": "+l,u}c&&!Lt[l]?a.metadata[l.slice(1)]=e[l]:a.data[l]=e[l]}return a}function Bt(e,t,i){var n=function(e){try{return he(e)}catch(e){return{error:Q(G,"Attachment is not a valid base64 string")}}}(e.data);if(n.error)return i(n.error);e.length=n.length,e.data="blob"===t?be(n,e.content_type):"base64"===t?fe(n):n,Se(n,(function(t){e.digest="md5-"+t,i()}))}function jt(e,t,i){if(e.stub)return i();"string"==typeof e.data?Bt(e,t,i):function(e,t,i){Se(e.data,(function(n){e.digest="md5-"+n,e.length=e.data.size||e.data.length||0,"binary"===t?ke(e.data,(function(t){e.data=t,i()})):"base64"===t?we(e.data,(function(t){e.data=t,i()})):i()}))}(e,t,i)}function Ut(e,t,i,n,r,o,s,a){if(function(e,t){for(var i,n=e.slice(),r=t.split("-"),o=parseInt(r[0],10),s=r[1];i=n.pop();){if(i.pos===o&&i.ids[0]===s)return!0;for(var a=i.ids[2],l=0,c=a.length;l<c;l++)n.push({pos:i.pos+1,ids:a[l]})}return!1}(t.rev_tree,i.metadata.rev)&&!a)return n[r]=i,o();var l=t.winningRev||Ne(t),c="deleted"in t?t.deleted:ze(t,l),u="deleted"in i.metadata?i.metadata.deleted:ze(i.metadata),d=/^1-/.test(i.metadata.rev);if(c&&!u&&a&&d){var p=i.data;p._rev=l,p._id=i.metadata.id,i=Mt(p,a)}var h=He(t.rev_tree,i.metadata.rev_tree[0],e);if(a&&(c&&u&&"new_leaf"!==h.conflicts||!c&&"new_leaf"!==h.conflicts||c&&!u&&"new_branch"===h.conflicts)){var f=Q(U);return n[r]=f,o()}var m=i.metadata.rev;i.metadata.rev_tree=h.tree,i.stemmedRevs=h.stemmedRevs||[],t.rev_map&&(i.metadata.rev_map=t.rev_map);var g=Ne(i.metadata),b=ze(i.metadata,g),v=c===b?0:c<b?-1:1;s(i,g,b,m===g?b:ze(i.metadata,m),!0,v,r,o)}var Ft="document-store",Ht="by-sequence",qt="attach-store",zt="attach-seq-store",Gt="meta-store",$t="local-store",Vt="detect-blob-support";function Wt(e){try{return JSON.stringify(e)}catch(t){return u.stringify(e)}}function Kt(e){return function(t){var i="unknown_error";t.target&&t.target.error&&(i=t.target.error.name||t.target.error.message),e(Q(J,i,t.type))}}function Jt(e,t,i){return{data:Wt(e),winningRev:t,deletedOrLocal:i?"1":"0",seq:e.seq,id:e.id}}function Yt(e){if(!e)return null;var t=function(e){try{return JSON.parse(e)}catch(t){return u.parse(e)}}(e.data);return t.winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t}function Xt(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function Qt(e,t,i,n){i?n(e?"string"!=typeof e?e:ve(e,t):me([""],{type:t})):e?"string"!=typeof e?ye(e,(function(e){n(fe(e))})):n(e):n("")}function Zt(e,t,i,n){var r=Object.keys(e._attachments||{});if(!r.length)return n&&n();var o=0;function s(){++o===r.length&&n&&n()}r.forEach((function(n){t.attachments&&t.include_docs?function(e,t){var n=e._attachments[t],r=n.digest;i.objectStore(qt).get(r).onsuccess=function(e){n.body=e.target.result.body,s()}}(e,n):(e._attachments[n].stub=!0,s())}))}function ei(e,t){return Promise.all(e.map((function(e){if(e.doc&&e.doc._attachments){var i=Object.keys(e.doc._attachments);return Promise.all(i.map((function(i){var n=e.doc._attachments[i];if("body"in n){var r=n.body,o=n.content_type;return new Promise((function(s){Qt(r,o,t,(function(t){e.doc._attachments[i]=R(S(n,["digest","content_type"]),{data:t}),s()}))}))}})))}})))}function ti(e,t,i){var n=[],r=i.objectStore(Ht),o=i.objectStore(qt),s=i.objectStore(zt),a=e.length;function l(){--a||n.length&&n.forEach((function(e){s.index("digestSeq").count(IDBKeyRange.bound(e+"::",e+"::",!1,!1)).onsuccess=function(t){t.target.result||o.delete(e)}}))}e.forEach((function(e){var i=r.index("_doc_id_rev"),o=t+"::"+e;i.getKey(o).onsuccess=function(e){var t=e.target.result;if("number"!=typeof t)return l();r.delete(t),s.index("seq").openCursor(IDBKeyRange.only(t)).onsuccess=function(e){var t=e.target.result;if(t){var i=t.value.digestSeq.split("::")[0];n.push(i),s.delete(t.primaryKey),t.continue()}else l()}}}))}function ii(e,t,i){try{return{txn:e.transaction(t,i)}}catch(e){return{error:e}}}var ni=new O;function ri(e,t,i,n,r,o){for(var a,l,c,u,d,p,h,f,m=t.docs,g=0,b=m.length;g<b;g++){var v=m[g];v._id&&Ge(v._id)||(v=m[g]=Mt(v,i.new_edits,e)).error&&!h&&(h=v)}if(h)return o(h);var y=!1,k=0,w=new Array(m.length),x=new s,E=!1,C=n._meta.blobSupport?"blob":"base64";function S(){y=!0,_()}function _(){f&&y&&(f.docCount+=k,p.put(f))}function T(){E||(ni.notify(n._meta.name),o(null,w))}function A(e,t,i,n,r,o,s,a){e.metadata.winningRev=t,e.metadata.deleted=i;var l=e.data;if(l._id=e.metadata.id,l._rev=e.metadata.rev,n&&(l._deleted=!0),l._attachments&&Object.keys(l._attachments).length)return function(e,t,i,n,r,o){var s=e.data,a=0,l=Object.keys(s._attachments);function c(){a===l.length&&N(e,t,i,n,r,o)}function d(){a++,c()}l.forEach((function(i){var n=e.data._attachments[i];if(n.stub)a++,c();else{var r=n.data;delete n.data,n.revpos=parseInt(t,10),function(e,t,i){u.count(e).onsuccess=function(n){if(n.target.result)return i();var r={digest:e,body:t};u.put(r).onsuccess=i}}(n.digest,r,d)}}))}(e,t,i,r,s,a);k+=o,_(),N(e,t,i,r,s,a)}function N(e,t,i,r,o,s){var u=e.data,p=e.metadata;function h(o){var s=e.stemmedRevs||[];r&&n.auto_compaction&&(s=s.concat(function(e){var t=[];return Ie(e.rev_tree,(function(e,i,n,r,o){"available"!==o.status||e||(t.push(i+"-"+n),o.status="missing")})),t}(e.metadata))),s&&s.length&&ti(s,e.metadata.id,a),p.seq=o.target.result;var c=Jt(p,t,i);l.put(c).onsuccess=f}function f(){w[o]={ok:!0,id:p.id,rev:p.rev},x.set(e.metadata.id,e.metadata),function(e,t,i){var n=0,r=Object.keys(e.data._attachments||{});if(!r.length)return i();function o(){++n===r.length&&i()}function s(i){var n=e.data._attachments[i].digest,r=d.put({seq:t,digestSeq:n+"::"+t});r.onsuccess=o,r.onerror=function(e){e.preventDefault(),e.stopPropagation(),o()}}for(var a=0;a<r.length;a++)s(r[a])}(e,p.seq,s)}u._doc_id_rev=p.id+"::"+p.rev,delete u._id,delete u._rev;var m=c.put(u);m.onsuccess=h,m.onerror=function(e){e.preventDefault(),e.stopPropagation(),c.index("_doc_id_rev").getKey(u._doc_id_rev).onsuccess=function(e){c.put(u,e.target.result).onsuccess=h}}}!function(e,t,i){if(!e.length)return i();var n,r=0;function o(){r++,e.length===r&&(n?i(n):i())}e.forEach((function(e){var i=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],r=0;if(!i.length)return o();function s(e){n=e,++r===i.length&&o()}for(var a in e.data._attachments)e.data._attachments.hasOwnProperty(a)&&jt(e.data._attachments[a],t,s)}))}(m,C,(function(t){if(t)return o(t);!function(){var t=ii(r,[Ft,Ht,qt,$t,zt,Gt],"readwrite");if(t.error)return o(t.error);(a=t.txn).onabort=Kt(o),a.ontimeout=Kt(o),a.oncomplete=T,l=a.objectStore(Ft),c=a.objectStore(Ht),u=a.objectStore(qt),d=a.objectStore(zt),(p=a.objectStore(Gt)).get(Gt).onsuccess=function(e){f=e.target.result,_()},function(e){var t=[];if(m.forEach((function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach((function(i){var n=e.data._attachments[i];n.stub&&t.push(n.digest)}))})),!t.length)return e();var i,n=0;t.forEach((function(r){!function(e,t){u.get(e).onsuccess=function(i){if(i.target.result)t();else{var n=Q(X,"unknown stub attachment with digest "+e);n.status=412,t(n)}}}(r,(function(r){r&&!i&&(i=r),++n===t.length&&e(i)}))}))}((function(t){if(t)return E=!0,o(t);!function(){if(m.length)for(var t=0,r=0,o=m.length;r<o;r++){var c=m[r];if(c._id&&Ge(c._id))u();else l.get(c.metadata.id).onsuccess=d}function u(){++t===m.length&&function(e,t,i,n,r,o,a,l,c){e=e||1e3;var u=l.new_edits,d=new s,p=0,h=t.length;function f(){++p===h&&c&&c()}t.forEach((function(e,t){if(e._id&&Ge(e._id)){var n=e._deleted?"_removeLocal":"_putLocal";i[n](e,{ctx:r},(function(e,i){o[t]=e||i,f()}))}else{var s=e.metadata.id;d.has(s)?(h--,d.get(s).push([e,t])):d.set(s,[[e,t]])}})),d.forEach((function(t,i){var r=0;function s(){++r<t.length?c():f()}function c(){var c=t[r],d=c[0],p=c[1];if(n.has(i))Ut(e,n.get(i),d,o,p,s,a,u);else{var h=He([],d.metadata.rev_tree[0],e);d.metadata.rev_tree=h.tree,d.stemmedRevs=h.stemmedRevs||[],function(e,t,i){var n=Ne(e.metadata),r=ze(e.metadata,n);if("was_delete"in l&&r)return o[t]=Q(j,"deleted"),i();if(u&&function(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}(e)){var s=Q(U);return o[t]=s,i()}a(e,n,r,r,!1,r?0:1,t,i)}(d,p,s)}}c()}))}(e.revs_limit,m,n,x,a,w,A,i,S)}function d(e){var t=Yt(e.target.result);t&&x.set(t.id,t),u()}}()}))}()}))}function oi(e,t,i,n,r){var o,s,a;function l(e){s=e.target.result,o&&r(o,s,a)}function c(e){o=e.target.result,s&&r(o,s,a)}function u(e){var t=e.target.result;if(!t)return r();r([t.key],[t.value],t)}-1===n&&(n=1e3),"function"==typeof e.getAll&&"function"==typeof e.getAllKeys&&n>1&&!i?(a={continue:function(){if(!o.length)return r();var i,a=o[o.length-1];if(t&&t.upper)try{i=IDBKeyRange.bound(a,t.upper,!0,t.upperOpen)}catch(e){if("DataError"===e.name&&0===e.code)return r()}else i=IDBKeyRange.lowerBound(a,!0);t=i,o=null,s=null,e.getAll(t,n).onsuccess=l,e.getAllKeys(t,n).onsuccess=c}},e.getAll(t,n).onsuccess=l,e.getAllKeys(t,n).onsuccess=c):i?e.openCursor(t,"prev").onsuccess=u:e.openCursor(t).onsuccess=u}function si(e,t,i){var n,r,o="startkey"in e&&e.startkey,s="endkey"in e&&e.endkey,a="key"in e&&e.key,l="keys"in e&&e.keys,c=e.skip||0,u="number"==typeof e.limit?e.limit:-1,d=!1!==e.inclusive_end;if(!l&&(r=(n=function(e,t,i,n,r){try{if(e&&t)return r?IDBKeyRange.bound(t,e,!i,!1):IDBKeyRange.bound(e,t,!1,!i);if(e)return r?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return r?IDBKeyRange.lowerBound(t,!i):IDBKeyRange.upperBound(t,!i);if(n)return IDBKeyRange.only(n)}catch(e){return{error:e}}return null}(o,s,d,a,e.descending))&&n.error)&&("DataError"!==r.name||0!==r.code))return i(Q(J,r.name,r.message));var p=[Ft,Ht,Gt];e.attachments&&p.push(qt);var h=ii(t,p,"readonly");if(h.error)return i(h.error);var f=h.txn;f.oncomplete=function(){e.attachments?ei(w,e.binary).then(S):S()},f.onabort=Kt(i);var m,g,b=f.objectStore(Ft),v=f.objectStore(Ht),y=f.objectStore(Gt),k=v.index("_doc_id_rev"),w=[];function x(t,i){var n={id:i.id,key:i.id,value:{rev:t}};i.deleted?l&&(w.push(n),n.value.deleted=!0,n.doc=null):c--<=0&&(w.push(n),e.include_docs&&function(t,i,n){var r=t.id+"::"+n;k.get(r).onsuccess=function(n){if(i.doc=Xt(n.target.result)||{},e.conflicts){var r=De(t);r.length&&(i.doc._conflicts=r)}Zt(i.doc,e,f)}}(i,n,t))}function E(e){for(var t=0,i=e.length;t<i&&w.length!==u;t++){var n=e[t];if(n.error&&l)w.push(n);else{var r=Yt(n);x(r.winningRev,r)}}}function C(e,t,i){i&&(E(t),w.length<u&&i.continue())}function S(){var t={total_rows:m,offset:e.skip,rows:w};e.update_seq&&void 0!==g&&(t.update_seq=g),i(null,t)}return y.get(Gt).onsuccess=function(e){m=e.target.result.docCount},e.update_seq&&function(e,t){e.openCursor(null,"prev").onsuccess=function(e){var t=e.target.result,i=void 0;return t&&t.key&&(i=t.key),function(e){e.target.result&&e.target.result.length>0&&(g=e.target.result[0])}({target:{result:[i]}})}}(v),r||0===u?void 0:l?function(e,t,i){var n=new Array(e.length),r=0;e.forEach((function(o,s){t.get(o).onsuccess=function(t){t.target.result?n[s]=t.target.result:n[s]={key:o,error:"not_found"},++r===e.length&&i(e,n,{})}}))}(e.keys,b,C):-1===u?function(e,t,i){if("function"!=typeof e.getAll){var n=[];e.openCursor(t).onsuccess=function(e){var t=e.target.result;t?(n.push(t.value),t.continue()):i({target:{result:n}})}}else e.getAll(t).onsuccess=i}(b,n,(function(t){var i=t.target.result;e.descending&&(i=i.reverse()),E(i)})):void oi(b,n,e.descending,u+c,C)}var ai=!1,li=[];function ci(){!ai&&li.length&&(ai=!0,li.shift()())}var ui,di=new s,pi=new s;function hi(e,t){var i=this;!function(e,t,i){li.push((function(){e((function(e,n){(function(e,t,i,n){try{e(t,i)}catch(t){n.emit("error",t)}})(t,e,n,i),ai=!1,a((function(){ci()}))}))})),ci()}((function(t){!function(e,t,i){var n=t.name,r=null;function l(e,t){var i=e.objectStore(Ft);i.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),i.openCursor().onsuccess=function(e){var n=e.target.result;if(n){var r=n.value,o=ze(r);r.deletedOrLocal=o?"1":"0",i.put(r),n.continue()}else t()}}function c(e,t){var i=e.objectStore($t),n=e.objectStore(Ft),r=e.objectStore(Ht);n.openCursor().onsuccess=function(e){var o=e.target.result;if(o){var s=o.value,a=s.id,l=Ge(a),c=Ne(s);if(l){var u=a+"::"+c,d=a+"::",p=a+"::~",h=r.index("_doc_id_rev"),f=IDBKeyRange.bound(d,p,!1,!1),m=h.openCursor(f);m.onsuccess=function(e){if(m=e.target.result){var t=m.value;t._doc_id_rev===u&&i.put(t),r.delete(m.primaryKey),m.continue()}else n.delete(o.primaryKey),o.continue()}}else o.continue()}else t&&t()}}function u(e,t){var i=e.objectStore(Ht),n=e.objectStore(qt),r=e.objectStore(zt);n.count().onsuccess=function(e){if(!e.target.result)return t();i.openCursor().onsuccess=function(e){var i=e.target.result;if(!i)return t();for(var n=i.value,o=i.primaryKey,s=Object.keys(n._attachments||{}),a={},l=0;l<s.length;l++)a[n._attachments[s[l]].digest]=!0;var c=Object.keys(a);for(l=0;l<c.length;l++){var u=c[l];r.put({seq:o,digestSeq:u+"::"+o})}i.continue()}}}function d(e){var t=e.objectStore(Ht),i=e.objectStore(Ft);i.openCursor().onsuccess=function(e){var n=e.target.result;if(n){var r,o,s,a,l,c=(r=n.value).data?Yt(r):(r.deleted="1"===r.deletedOrLocal,r);if(c.winningRev=c.winningRev||Ne(c),c.seq)return u();o=c.id+"::",s=c.id+"::",a=t.index("_doc_id_rev").openCursor(IDBKeyRange.bound(o,s)),l=0,a.onsuccess=function(e){var t=e.target.result;if(!t)return c.seq=l,u();var i=t.primaryKey;i>l&&(l=i),t.continue()}}function u(){var e=Jt(c,c.winningRev,c.deleted);i.put(e).onsuccess=function(){n.continue()}}}}e._meta=null,e._remote=!1,e.type=function(){return"idb"},e._id=E((function(t){t(null,e._meta.instanceId)})),e._bulkDocs=function(i,n,o){ri(t,i,n,e,r,o)},e._get=function(e,t,i){var n,o,s,a=t.ctx;if(!a){var l=ii(r,[Ft,Ht,qt],"readonly");if(l.error)return i(l.error);a=l.txn}function c(){i(s,{doc:n,metadata:o,ctx:a})}a.objectStore(Ft).get(e).onsuccess=function(e){if(!(o=Yt(e.target.result)))return s=Q(j,"missing"),c();var i;if(t.rev)i=t.latest?function(e,t){for(var i,n=t.rev_tree.slice();i=n.pop();){var r=i.pos,o=i.ids,s=o[0],a=o[1],l=o[2],c=0===l.length,u=i.history?i.history.slice():[];if(u.push({id:s,pos:r,opts:a}),c)for(var d=0,p=u.length;d<p;d++){var h=u[d];if(h.pos+"-"+h.id===e)return r+"-"+s}for(var f=0,m=l.length;f<m;f++)n.push({pos:r+1,ids:l[f],history:u})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}(t.rev,o):t.rev;else if(i=o.winningRev,ze(o))return s=Q(j,"deleted"),c();var r=a.objectStore(Ht),l=o.id+"::"+i;r.index("_doc_id_rev").get(l).onsuccess=function(e){if((n=e.target.result)&&(n=Xt(n)),!n)return s=Q(j,"missing"),c();c()}}},e._getAttachment=function(e,t,i,n,o){var s;if(n.ctx)s=n.ctx;else{var a=ii(r,[Ft,Ht,qt],"readonly");if(a.error)return o(a.error);s=a.txn}var l=i.digest,c=i.content_type;s.objectStore(qt).get(l).onsuccess=function(e){Qt(e.target.result.body,c,n.binary,(function(e){o(null,e)}))}},e._info=function(t){var i,n,o=ii(r,[Gt,Ht],"readonly");if(o.error)return t(o.error);var s=o.txn;s.objectStore(Gt).get(Gt).onsuccess=function(e){n=e.target.result.docCount},s.objectStore(Ht).openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;i=t?t.key:0},s.oncomplete=function(){t(null,{doc_count:n,update_seq:i,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(e,t){si(e,r,t)},e._changes=function(t){return function(e,t,i,n){if((e=w(e)).continuous){var r=i+":"+Ae();return ni.addListener(i,r,t,e),ni.notify(i),{cancel:function(){ni.removeListener(i,r)}}}var a=e.doc_ids&&new o(e.doc_ids);e.since=e.since||0;var l=e.since,c="limit"in e?e.limit:-1;0===c&&(c=1);var u,d,p,h,f=[],m=0,g=ee(e),b=new s;function v(e,t,i,n){if(i.seq!==t)return n();if(i.winningRev===e._rev)return n(i,e);var r=e._id+"::"+i.winningRev;h.get(r).onsuccess=function(e){n(i,Xt(e.target.result))}}function y(){e.complete(null,{results:f,last_seq:l})}var k=[Ft,Ht];e.attachments&&k.push(qt);var x=ii(n,k,"readonly");if(x.error)return e.complete(x.error);(u=x.txn).onabort=Kt(e.complete),u.oncomplete=function(){!e.continuous&&e.attachments?ei(f).then(y):y()},d=u.objectStore(Ht),p=u.objectStore(Ft),h=d.index("_doc_id_rev"),oi(d,e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null,e.descending,c,(function(t,i,n){if(n&&t.length){var r=new Array(t.length),o=new Array(t.length),s=0;i.forEach((function(i,l){!function(e,t,i){if(a&&!a.has(e._id))return i();var n=b.get(e._id);if(n)return v(e,t,n,i);p.get(e._id).onsuccess=function(r){n=Yt(r.target.result),b.set(e._id,n),v(e,t,n,i)}}(Xt(i),t[l],(function(i,a){o[l]=i,r[l]=a,++s===t.length&&function(){for(var t=[],i=0,s=r.length;i<s&&m!==c;i++){var a=r[i];if(a){var l=o[i];t.push(d(l,a))}}Promise.all(t).then((function(t){for(var i=0,n=t.length;i<n;i++)t[i]&&e.onChange(t[i])})).catch(e.complete),m!==c&&n.continue()}()}))}))}function d(t,i){var n=e.processChange(i,t,e);l=n.seq=t.seq;var r=g(n);return"object"==typeof r?Promise.reject(r):r?(m++,e.return_docs&&f.push(n),e.attachments&&e.include_docs?new Promise((function(t){Zt(i,e,u,(function(){ei([n],e.binary).then((function(){t(n)}))}))})):Promise.resolve(n)):Promise.resolve()}}))}(t,e,n,r)},e._close=function(e){r.close(),di.delete(n),e()},e._getRevisionTree=function(e,t){var i=ii(r,[Ft],"readonly");if(i.error)return t(i.error);i.txn.objectStore(Ft).get(e).onsuccess=function(e){var i=Yt(e.target.result);i?t(null,i.rev_tree):t(Q(j))}},e._doCompaction=function(e,t,i){var n=ii(r,[Ft,Ht,qt,zt],"readwrite");if(n.error)return i(n.error);var o=n.txn;o.objectStore(Ft).get(e).onsuccess=function(i){var n=Yt(i.target.result);Ie(n.rev_tree,(function(e,i,n,r,o){var s=i+"-"+n;-1!==t.indexOf(s)&&(o.status="missing")})),ti(t,e,o);var r=n.winningRev,s=n.deleted;o.objectStore(Ft).put(Jt(n,r,s))},o.onabort=Kt(i),o.oncomplete=function(){i()}},e._getLocal=function(e,t){var i=ii(r,[$t],"readonly");if(i.error)return t(i.error);var n=i.txn.objectStore($t).get(e);n.onerror=Kt(t),n.onsuccess=function(e){var i=e.target.result;i?(delete i._doc_id_rev,t(null,i)):t(Q(j))}},e._putLocal=function(e,t,i){"function"==typeof t&&(i=t,t={}),delete e._revisions;var n=e._rev,o=e._id;e._rev=n?"0-"+(parseInt(n.split("-")[1],10)+1):"0-1";var s,a=t.ctx;if(!a){var l=ii(r,[$t],"readwrite");if(l.error)return i(l.error);(a=l.txn).onerror=Kt(i),a.oncomplete=function(){s&&i(null,s)}}var c,u=a.objectStore($t);n?(c=u.get(o)).onsuccess=function(r){var o=r.target.result;o&&o._rev===n?u.put(e).onsuccess=function(){s={ok:!0,id:e._id,rev:e._rev},t.ctx&&i(null,s)}:i(Q(U))}:((c=u.add(e)).onerror=function(e){i(Q(U)),e.preventDefault(),e.stopPropagation()},c.onsuccess=function(){s={ok:!0,id:e._id,rev:e._rev},t.ctx&&i(null,s)})},e._removeLocal=function(e,t,i){"function"==typeof t&&(i=t,t={});var n,o=t.ctx;if(!o){var s=ii(r,[$t],"readwrite");if(s.error)return i(s.error);(o=s.txn).oncomplete=function(){n&&i(null,n)}}var a=e._id,l=o.objectStore($t),c=l.get(a);c.onerror=Kt(i),c.onsuccess=function(r){var o=r.target.result;o&&o._rev===e._rev?(l.delete(a),n={ok:!0,id:a,rev:"0-0"},t.ctx&&i(null,n)):i(Q(j))}},e._destroy=function(e,t){ni.removeAllListeners(n);var i=pi.get(n);i&&i.result&&(i.result.close(),di.delete(n));var r=indexedDB.deleteDatabase(n);r.onsuccess=function(){pi.delete(n),I()&&n in localStorage&&delete localStorage[n],t(null,{ok:!0})},r.onerror=Kt(t)};var p=di.get(n);if(p)return r=p.idb,e._meta=p.global,a((function(){i(null,e)}));var h=indexedDB.open(n,5);pi.set(n,h),h.onupgradeneeded=function(e){var t=e.target.result;if(e.oldVersion<1)return function(e){var t=e.createObjectStore(Ft,{keyPath:"id"});e.createObjectStore(Ht,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(qt,{keyPath:"digest"}),e.createObjectStore(Gt,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(Vt),t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),e.createObjectStore($t,{keyPath:"_id"});var i=e.createObjectStore(zt,{autoIncrement:!0});i.createIndex("seq","seq"),i.createIndex("digestSeq","digestSeq",{unique:!0})}(t);var i=e.currentTarget.transaction;e.oldVersion<3&&function(e){e.createObjectStore($t,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}(t),e.oldVersion<4&&function(e){var t=e.createObjectStore(zt,{autoIncrement:!0});t.createIndex("seq","seq"),t.createIndex("digestSeq","digestSeq",{unique:!0})}(t);var n=[l,c,u,d],r=e.oldVersion;!function e(){var t=n[r-1];r++,t&&t(i,e)}()},h.onsuccess=function(t){(r=t.target.result).onversionchange=function(){r.close(),di.delete(n)},r.onabort=function(e){P("error","Database has a global failure",e.target.error),r.close(),di.delete(n)};var o,s,a,l,c=r.transaction([Gt,Vt,Ft],"readwrite"),u=!1;function d(){void 0!==a&&u&&(e._meta={name:n,instanceId:l,blobSupport:a},di.set(n,{idb:r,global:e._meta}),i(null,e))}function p(){if(void 0!==s&&void 0!==o){var e=n+"_id";e in o?l=o[e]:o[e]=l=Ae(),o.docCount=s,c.objectStore(Gt).put(o)}}c.objectStore(Gt).get(Gt).onsuccess=function(e){o=e.target.result||{id:Gt},p()},function(e,t){e.objectStore(Ft).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(e){t(e.target.result)}}(c,(function(e){s=e,p()})),ui||(ui=function(e){return new Promise((function(t){var i=me([""]),n=e.objectStore(Vt).put(i,"key");n.onsuccess=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);t(i||!e||parseInt(e[1],10)>=43)},n.onerror=e.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)}})).catch((function(){return!1}))}(c)),ui.then((function(e){a=e,d()})),c.oncomplete=function(){u=!0,d()},c.onabort=Kt(i)},h.onerror=function(e){var t=e.target.error&&e.target.error.message;t?-1!==t.indexOf("stored database is a higher version")&&(t=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):t="Failed to open indexedDB, are you in private browsing mode?",P("error",t),i(Q(J,t))}}(i,e,t)}),t,i.constructor)}hi.valid=function(){try{return"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}};var fi=5e3,mi={};function gi(e){var t=e.doc||e.ok,i=t&&t._attachments;i&&Object.keys(i).forEach((function(e){var t=i[e];t.data=ve(t.data,t.content_type)}))}function bi(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function vi(e){return e._attachments&&Object.keys(e._attachments)?Promise.all(Object.keys(e._attachments).map((function(t){var i=e._attachments[t];if(i.data&&"string"!=typeof i.data)return new Promise((function(e){we(i.data,e)})).then((function(e){i.data=e}))}))):Promise.resolve()}function yi(e,t){if(function(e){if(!e.prefix)return!1;var t=ue(e.prefix).protocol;return"http"===t||"https"===t}(t)){var i=t.name.substr(t.prefix.length);e=t.prefix.replace(/\/?$/,"/")+encodeURIComponent(i)}var n=ue(e);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});var r=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=r.pop(),-1===n.db.indexOf("%")&&(n.db=encodeURIComponent(n.db)),n.path=r.join("/"),n}function ki(e,t){return wi(e,e.db+"/"+t)}function wi(e,t){var i=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+i+t}function xi(e){return"?"+Object.keys(e).map((function(t){return t+"="+encodeURIComponent(e[t])})).join("&")}function Ei(e,t){var n=this,r=yi(e.name,e),o=ki(r,"");e=w(e);var s,l=function(t,i){if((i=i||{}).headers=i.headers||new it,i.credentials="include",e.auth||r.auth){var n=e.auth||r.auth,o=n.username+":"+n.password,s=fe(unescape(encodeURIComponent(o)));i.headers.set("Authorization","Basic "+s)}var a=e.headers||{};return Object.keys(a).forEach((function(e){i.headers.append(e,a[e])})),function(e){var t="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",i=-1!==t.indexOf("msie"),n=-1!==t.indexOf("trident"),r=-1!==t.indexOf("edge"),o=!("method"in e)||"GET"===e.method;return(i||n||r)&&o}(i)&&(t+=(-1===t.indexOf("?")?"?":"&")+"_nonce="+Date.now()),(e.fetch||tt)(t,i)};function c(e,t){return C(e,d((function(e){p().then((function(){return t.apply(this,e)})).catch((function(t){e.pop()(t)}))}))).bind(n)}function u(e,t,i){var n={};return(t=t||{}).headers=t.headers||new it,t.headers.get("Content-Type")||t.headers.set("Content-Type","application/json"),t.headers.get("Accept")||t.headers.set("Accept","application/json"),l(e,t).then((function(e){return n.ok=e.ok,n.status=e.status,e.json()})).then((function(e){if(n.data=e,!n.ok){n.data.status=n.status;var t=Z(n.data);if(i)return i(t);throw t}if(Array.isArray(n.data)&&(n.data=n.data.map((function(e){return e.error||e.missing?Z(e):e}))),!i)return n;i(null,n.data)}))}function p(){return e.skip_setup?Promise.resolve():s||((s=u(o).catch((function(e){return e&&e.status&&404===e.status?(L(404,"PouchDB is just detecting if the remote exists."),u(o,{method:"PUT"})):Promise.reject(e)})).catch((function(e){return!(!e||!e.status||412!==e.status)||Promise.reject(e)}))).catch((function(){s=null})),s)}function h(e){return e.split("/").map(encodeURIComponent).join("/")}a((function(){t(null,n)})),n._remote=!0,n.type=function(){return"http"},n.id=c("id",(function(e){l(wi(r,"")).then((function(e){return e.json()})).catch((function(){return{}})).then((function(t){var i=t&&t.uuid?t.uuid+r.db:ki(r,"");e(null,i)}))})),n.compact=c("compact",(function(e,t){"function"==typeof e&&(t=e,e={}),e=w(e),u(ki(r,"_compact"),{method:"POST"}).then((function(){!function i(){n.info((function(n,r){r&&!r.compact_running?t(null,{ok:!0}):setTimeout(i,e.interval||200)}))}()}))})),n.bulkGet=C("bulkGet",(function(e,t){var i=this;function n(t){var i={};e.revs&&(i.revs=!0),e.attachments&&(i.attachments=!0),e.latest&&(i.latest=!0),u(ki(r,"_bulk_get"+xi(i)),{method:"POST",body:JSON.stringify({docs:e.docs})}).then((function(i){e.attachments&&e.binary&&i.data.results.forEach((function(e){e.docs.forEach(gi)})),t(null,i.data)})).catch(t)}function o(){var n=Math.ceil(e.docs.length/50),r=0,o=new Array(n);function s(e){return function(i,s){o[e]=s.results,++r===n&&t(null,{results:te(o)})}}for(var a=0;a<n;a++){var l=S(e,["revs","attachments","binary","latest"]);l.docs=e.docs.slice(50*a,Math.min(e.docs.length,50*(a+1))),N(i,l,s(a))}}var s=wi(r,""),a=mi[s];"boolean"!=typeof a?n((function(e,i){e?(mi[s]=!1,L(e.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),o()):(mi[s]=!0,t(null,i))})):a?n(t):o()})),n._info=function(e){p().then((function(){return l(ki(r,""))})).then((function(e){return e.json()})).then((function(t){t.host=ki(r,""),e(null,t)})).catch(e)},n.fetch=function(e,t){return p().then((function(){var i="/"===e.substring(0,1)?wi(r,e.substring(1)):ki(r,e);return l(i,t)}))},n.get=c("get",(function(e,t,i){"function"==typeof t&&(i=t,t={});var n={};function o(e){var i=e._attachments,n=i&&Object.keys(i);if(i&&n.length)return function(e,t){return new Promise((function(i,n){var r,o=0,s=0,a=0,l=e.length;function c(){++a===l?r?n(r):i():p()}function u(){o--,c()}function d(e){o--,r=r||e,c()}function p(){for(;o<t&&s<l;)o++,e[s++]().then(u,d)}p()}))}(n.map((function(n){return function(){return function(n){var o=i[n],s=bi(e._id)+"/"+h(n)+"?rev="+e._rev;return l(ki(r,s)).then((function(e){return"buffer"in e?e.buffer():e.blob()})).then((function(e){if(t.binary){var i=Object.getOwnPropertyDescriptor(e.__proto__,"type");return i&&!i.set||(e.type=o.content_type),e}return new Promise((function(t){we(e,t)}))})).then((function(e){delete o.stub,delete o.length,o.data=e}))}(n)}})),5)}(t=w(t)).revs&&(n.revs=!0),t.revs_info&&(n.revs_info=!0),t.latest&&(n.latest=!0),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),n.open_revs=t.open_revs),t.rev&&(n.rev=t.rev),t.conflicts&&(n.conflicts=t.conflicts),t.update_seq&&(n.update_seq=t.update_seq),e=bi(e),u(ki(r,e+xi(n))).then((function(e){return Promise.resolve().then((function(){if(t.attachments)return i=e.data,Array.isArray(i)?Promise.all(i.map((function(e){if(e.ok)return o(e.ok)}))):o(i);var i})).then((function(){i(null,e.data)}))})).catch((function(t){t.docId=e,i(t)}))})),n.remove=c("remove",(function(e,t,i,n){var o;"string"==typeof t?(o={_id:e,_rev:t},"function"==typeof i&&(n=i,i={})):(o=e,"function"==typeof t?(n=t,i={}):(n=i,i=t));var s=o._rev||i.rev;u(ki(r,bi(o._id))+"?rev="+s,{method:"DELETE"},n).catch(n)})),n.getAttachment=c("getAttachment",(function(e,t,n,o){"function"==typeof n&&(o=n,n={});var s,a=n.rev?"?rev="+n.rev:"",c=ki(r,bi(e))+"/"+h(t)+a;l(c,{method:"GET"}).then((function(e){if(s=e.headers.get("content-type"),e.ok)return void 0===i||i.browser||"function"!=typeof e.buffer?e.blob():e.buffer();throw e})).then((function(e){void 0===i||i.browser||(e.type=s),o(null,e)})).catch((function(e){o(e)}))})),n.removeAttachment=c("removeAttachment",(function(e,t,i,n){u(ki(r,bi(e)+"/"+h(t))+"?rev="+i,{method:"DELETE"},n).catch(n)})),n.putAttachment=c("putAttachment",(function(e,t,i,n,o,s){"function"==typeof o&&(s=o,o=n,n=i,i=null);var a=bi(e)+"/"+h(t),l=ki(r,a);if(i&&(l+="?rev="+i),"string"==typeof n){var c;try{c=he(n)}catch(e){return s(Q(G,"Attachment is not a valid base64 string"))}n=c?be(c,o):""}u(l,{headers:new it({"Content-Type":o}),method:"PUT",body:n},s).catch(s)})),n._bulkDocs=function(e,t,i){e.new_edits=t.new_edits,p().then((function(){return Promise.all(e.docs.map(vi))})).then((function(){return u(ki(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(e)},i)})).catch(i)},n._put=function(e,t,i){p().then((function(){return vi(e)})).then((function(){return u(ki(r,bi(e._id)),{method:"PUT",body:JSON.stringify(e)})})).then((function(e){i(null,e.data)})).catch((function(t){t.docId=e&&e._id,i(t)}))},n.allDocs=c("allDocs",(function(e,t){"function"==typeof e&&(t=e,e={});var i,n={},o="GET";(e=w(e)).conflicts&&(n.conflicts=!0),e.update_seq&&(n.update_seq=!0),e.descending&&(n.descending=!0),e.include_docs&&(n.include_docs=!0),e.attachments&&(n.attachments=!0),e.key&&(n.key=JSON.stringify(e.key)),e.start_key&&(e.startkey=e.start_key),e.startkey&&(n.startkey=JSON.stringify(e.startkey)),e.end_key&&(e.endkey=e.end_key),e.endkey&&(n.endkey=JSON.stringify(e.endkey)),void 0!==e.inclusive_end&&(n.inclusive_end=!!e.inclusive_end),void 0!==e.limit&&(n.limit=e.limit),void 0!==e.skip&&(n.skip=e.skip);var s=xi(n);void 0!==e.keys&&(o="POST",i={keys:e.keys}),u(ki(r,"_all_docs"+s),{method:o,body:JSON.stringify(i)}).then((function(i){e.include_docs&&e.attachments&&e.binary&&i.data.rows.forEach(gi),t(null,i.data)})).catch(t)})),n._changes=function(e){var t="batch_size"in e?e.batch_size:25;!(e=w(e)).continuous||"heartbeat"in e||(e.heartbeat=1e4);var i="timeout"in e?e.timeout:3e4;"timeout"in e&&e.timeout&&i-e.timeout<fi&&(i=e.timeout+fi),"heartbeat"in e&&e.heartbeat&&i-e.heartbeat<fi&&(i=e.heartbeat+fi);var n={};"timeout"in e&&e.timeout&&(n.timeout=e.timeout);var o=void 0!==e.limit&&e.limit,s=o;if(e.style&&(n.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(n.include_docs=!0),e.attachments&&(n.attachments=!0),e.continuous&&(n.feed="longpoll"),e.seq_interval&&(n.seq_interval=e.seq_interval),e.conflicts&&(n.conflicts=!0),e.descending&&(n.descending=!0),e.update_seq&&(n.update_seq=!0),"heartbeat"in e&&e.heartbeat&&(n.heartbeat=e.heartbeat),e.filter&&"string"==typeof e.filter&&(n.filter=e.filter),e.view&&"string"==typeof e.view&&(n.filter="_view",n.view=e.view),e.query_params&&"object"==typeof e.query_params)for(var l in e.query_params)e.query_params.hasOwnProperty(l)&&(n[l]=e.query_params[l]);var c,d="GET";e.doc_ids?(n.filter="_doc_ids",d="POST",c={doc_ids:e.doc_ids}):e.selector&&(n.filter="_selector",d="POST",c={selector:e.selector});var h,f=new et,m=function(i,a){if(!e.aborted){n.since=i,"object"==typeof n.since&&(n.since=JSON.stringify(n.since)),e.descending?o&&(n.limit=s):n.limit=!o||s>t?t:s;var l=ki(r,"_changes"+xi(n)),m={signal:f.signal,method:d,body:JSON.stringify(c)};h=i,e.aborted||p().then((function(){return u(l,m,a)})).catch(a)}},g={results:[]},b=function(i,n){if(!e.aborted){var r=0;if(n&&n.results){r=n.results.length,g.last_seq=n.last_seq;var l=null,c=null;"number"==typeof n.pending&&(l=n.pending),"string"!=typeof g.last_seq&&"number"!=typeof g.last_seq||(c=g.last_seq),e.query_params,n.results=n.results.filter((function(t){s--;var i=ee(e)(t);return i&&(e.include_docs&&e.attachments&&e.binary&&gi(t),e.return_docs&&g.results.push(t),e.onChange(t,l,c)),i}))}else if(i)return e.aborted=!0,void e.complete(i);n&&n.last_seq&&(h=n.last_seq);var u=o&&s<=0||n&&r<t||e.descending;(!e.continuous||o&&s<=0)&&u?e.complete(null,g):a((function(){m(h,b)}))}};return m(e.since||0,b),{cancel:function(){e.aborted=!0,f.abort()}}},n.revsDiff=c("revsDiff",(function(e,t,i){"function"==typeof t&&(i=t,t={}),u(ki(r,"_revs_diff"),{method:"POST",body:JSON.stringify(e)},i).catch(i)})),n._close=function(e){e()},n._destroy=function(e,t){u(ki(r,""),{method:"DELETE"}).then((function(e){t(null,e)})).catch((function(e){404===e.status?t(null,{ok:!0}):t(e)}))}}function Ci(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Ci)}catch(e){}}function Si(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Si)}catch(e){}}function _i(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,_i)}catch(e){}}function Ti(e,t){return t&&e.then((function(e){a((function(){t(null,e)}))}),(function(e){a((function(){t(e)}))})),e}function Ai(e){return d((function(t){var i=t.pop(),n=e.apply(this,t);return"function"==typeof i&&Ti(n,i),n}))}function Ni(e,t){return function(){var i=arguments,n=this;return e.add((function(){return t.apply(n,i)}))}}function Ii(e){var t=new o(e),i=new Array(t.size),n=-1;return t.forEach((function(e){i[++n]=e})),i}function Oi(e){var t=new Array(e.size),i=-1;return e.forEach((function(e,n){t[++i]=n})),t}function Pi(e){return new _i("builtin "+e+" function requires map values to be numbers or number arrays")}function Di(e){for(var t=0,i=0,n=e.length;i<n;i++){var r=e[i];if("number"!=typeof r){if(!Array.isArray(r))throw Pi("_sum");t="number"==typeof t?[t]:t;for(var o=0,s=r.length;o<s;o++){var a=r[o];if("number"!=typeof a)throw Pi("_sum");void 0===t[o]?t.push(a):t[o]+=a}}else"number"==typeof t?t+=r:t[0]+=r}return t}Ei.valid=function(){return!0},p(Ci,Error),p(Si,Error),p(_i,Error);var Li=P.bind(null,"log"),Ri=Array.isArray,Mi=JSON.parse;function Bi(e,t){return de("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:Di,log:Li,isArray:Ri,toJSON:Mi})}function ji(){this.promise=new Promise((function(e){e()}))}function Ui(e){if(!e)return"undefined";switch(typeof e){case"function":case"string":return e.toString();default:return JSON.stringify(e)}}function Fi(e,t,i,n,r,o){var s,a=function(e,t){return Ui(e)+Ui(t)+"undefined"}(i,n);if(!r&&(s=e._cachedViews=e._cachedViews||{})[a])return s[a];var l=e.info().then((function(l){var c=l.db_name+"-mrview-"+(r?"temp":_e(a));return pe(e,"_local/"+o,(function(e){e.views=e.views||{};var i=t;-1===i.indexOf("/")&&(i=t+"/"+t);var n=e.views[i]=e.views[i]||{};if(!n[c])return n[c]=!0,e})).then((function(){return e.registerDependentDatabase(c).then((function(t){var r=t.db;r.auto_compaction=!0;var o={name:c,db:r,sourceDB:e,adapter:e.adapter,mapFun:i,reduceFun:n};return o.db.get("_local/lastSeq").catch((function(e){if(404!==e.status)throw e})).then((function(e){return o.seq=e?e.seq:0,s&&o.db.once("destroyed",(function(){delete s[a]})),o}))}))}))}));return s&&(s[a]=l),l}ji.prototype.add=function(e){return this.promise=this.promise.catch((function(){})).then((function(){return e()})),this.promise},ji.prototype.finish=function(){return this.promise};var Hi={},qi=new ji;function zi(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function Gi(e,t){try{e.emit("error",t)}catch(e){P("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),P("error",t)}}var $i=function(e,t){return Di(t)},Vi=function(e,t){return t.length},Wi=function(e,t){return{sum:Di(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(e){for(var t=0,i=0,n=e.length;i<n;i++){var r=e[i];t+=r*r}return t}(t)}};var Ki=function(e,t,i,n){function r(e,t,i){try{t(i)}catch(t){Gi(e,t)}}function l(e,t,i,n,r){try{return{output:t(i,n,r)}}catch(t){return Gi(e,t),{error:t}}}function c(e,t){var i=ft(e.key,t.key);return 0!==i?i:ft(e.value,t.value)}function u(e,t,i){return i=i||0,"number"==typeof t?e.slice(i,t+i):i>0?e.slice(i):e}function d(e){var t=e.value;return t&&"object"==typeof t&&t._id||e.id}function p(e){return function(t){return e.include_docs&&e.attachments&&e.binary&&function(e){e.rows.forEach((function(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach((function(e){var i=t[e];t[e].data=ve(i.data,i.content_type)}))}))}(t),t}}function h(e,t,i,n){var r=t[e];void 0!==r&&(n&&(r=encodeURIComponent(JSON.stringify(r))),i.push(e+"="+r))}function f(e){if(void 0!==e){var t=Number(e);return isNaN(t)||t!==parseInt(e,10)?e:t}}function m(e,t){var i=e.descending?"endkey":"startkey",n=e.descending?"startkey":"endkey";if(void 0!==e[i]&&void 0!==e[n]&&ft(e[i],e[n])>0)throw new Ci("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(t.reduce&&!1!==e.reduce){if(e.include_docs)throw new Ci("{include_docs:true} is invalid for reduce");if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level)throw new Ci("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach((function(t){var i=function(e){if(e){if("number"!=typeof e)return new Ci('Invalid value for integer: "'+e+'"');if(e<0)return new Ci('Invalid value for positive integer: "'+e+'"')}}(e[t]);if(i)throw i}))}function g(e){return function(t){if(404===t.status)return e;throw t}}function b(e){var t="string"==typeof e?e:e.name,i=Hi[t];return i||(i=Hi[t]=new ji),i}function v(e){return Ni(b(e),(function(){return function(e){var i,n,a=t(e.mapFun,(function(e,t){var r={id:n._id,key:mt(e)};null!=t&&(r.value=mt(t)),i.push(r)})),l=e.seq||0;function u(t,i){return function(){return function(e,t,i){return e.db.get("_local/lastSeq").catch(g({_id:"_local/lastSeq",seq:0})).then((function(n){var r=Oi(t);return Promise.all(r.map((function(i){return function(e,t,i){var n="_local/doc_"+e,r={_id:n,keys:[]},s=i.get(e),a=s[0];return(function(e){return 1===e.length&&/^1-/.test(e[0].rev)}(s[1])?Promise.resolve(r):t.db.get(n).catch(g(r))).then((function(e){return function(e){return e.keys.length?t.db.allDocs({keys:e.keys,include_docs:!0}):Promise.resolve({rows:[]})}(e).then((function(t){return function(e,t){for(var i=[],n=new o,r=0,s=t.rows.length;r<s;r++){var l=t.rows[r].doc;if(l&&(i.push(l),n.add(l._id),l._deleted=!a.has(l._id),!l._deleted)){var c=a.get(l._id);"value"in c&&(l.value=c.value)}}var u=Oi(a);return u.forEach((function(e){if(!n.has(e)){var t={_id:e},r=a.get(e);"value"in r&&(t.value=r.value),i.push(t)}})),e.keys=Ii(u.concat(e.keys)),i.push(e),i}(e,t)}))}))}(i,e,t)}))).then((function(t){var r=te(t);return n.seq=i,r.push(n),e.db.bulkDocs({docs:r})}))}))}(e,t,i)}}var d=new ji;function p(){return e.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:l,limit:50}).then(h)}function h(t){var o=t.results;if(o.length){var h=function(t){for(var o=new s,u=0,d=t.length;u<d;u++){var p=t[u];if("_"!==p.doc._id[0]){i=[],(n=p.doc)._deleted||r(e.sourceDB,a,n),i.sort(c);var h=f(i);o.set(p.doc._id,[h,p.changes])}l=p.seq}return o}(o);if(d.add(u(h,l)),!(o.length<50))return p()}}function f(e){for(var t,i=new s,n=0,r=e.length;n<r;n++){var o=e[n],a=[o.key,o.id];n>0&&0===ft(o.key,t)&&a.push(n),i.set(bt(a),o),t=o.key}return i}return p().then((function(){return d.finish()})).then((function(){e.seq=l}))}(e)}))()}function y(e,t){return Ni(b(e),(function(){return function(e,t){var n,r=e.reduceFun&&!1!==t.reduce,o=t.skip||0;function a(t){return t.include_docs=!0,e.db.allDocs(t).then((function(e){return n=e.total_rows,e.rows.map((function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),i=["id","key","value"];if(!(t<i||t>i))return e.doc.value}var n=function(e){for(var t=[],i=[],n=0;;){var r=e[n++];if("\0"!==r)switch(r){case"1":t.push(null);break;case"2":t.push("1"===e[n]),n++;break;case"3":var o=vt(e,n);t.push(o.num),n+=o.length;break;case"4":for(var s="";;){var a=e[n];if("\0"===a)break;s+=a,n++}s=s.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(s);break;case"5":var l={element:[],index:t.length};t.push(l.element),i.push(l);break;case"6":var c={element:{},index:t.length};t.push(c.element),i.push(c);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+r)}else{if(1===t.length)return t.pop();yt(t,i)}}}(e.doc._id);return{key:n[0],id:n[1],value:"value"in e.doc?e.doc.value:null}}))}))}function c(a){var c;if(c=r?function(e,t,n){0===n.group_level&&delete n.group_level;var r=n.group||n.group_level,o=i(e.reduceFun),s=[],a=isNaN(n.group_level)?Number.POSITIVE_INFINITY:n.group_level;t.forEach((function(e){var t=s[s.length-1],i=r?e.key:null;if(r&&Array.isArray(i)&&(i=i.slice(0,a)),t&&0===ft(t.groupKey,i))return t.keys.push([e.key,e.id]),void t.values.push(e.value);s.push({keys:[[e.key,e.id]],values:[e.value],groupKey:i})})),t=[];for(var c=0,d=s.length;c<d;c++){var p=s[c],h=l(e.sourceDB,o,p.keys,p.values,!1);if(h.error&&h.error instanceof _i)throw h.error;t.push({value:h.error?null:h.output,key:p.groupKey})}return{rows:u(t,n.limit,n.skip)}}(e,a,t):{total_rows:n,offset:o,rows:a},t.update_seq&&(c.update_seq=e.seq),t.include_docs){var p=Ii(a.map(d));return e.sourceDB.allDocs({keys:p,include_docs:!0,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then((function(e){var t=new s;return e.rows.forEach((function(e){t.set(e.id,e.doc)})),a.forEach((function(e){var i=d(e),n=t.get(i);n&&(e.doc=n)})),c}))}return c}if(void 0===t.keys||t.keys.length||(t.limit=0,delete t.keys),void 0!==t.keys){var p=t.keys.map((function(e){var i={startkey:bt([e]),endkey:bt([e,{}])};return t.update_seq&&(i.update_seq=!0),a(i)}));return Promise.all(p).then(te).then(c)}var h,f,m={descending:t.descending};if(t.update_seq&&(m.update_seq=!0),"start_key"in t&&(h=t.start_key),"startkey"in t&&(h=t.startkey),"end_key"in t&&(f=t.end_key),"endkey"in t&&(f=t.endkey),void 0!==h&&(m.startkey=t.descending?bt([h,{}]):bt([h])),void 0!==f){var g=!1!==t.inclusive_end;t.descending&&(g=!g),m.endkey=bt(g?[f,{}]:[f])}if(void 0!==t.key){var b=bt([t.key]),v=bt([t.key,{}]);m.descending?(m.endkey=b,m.startkey=v):(m.startkey=b,m.endkey=v)}return r||("number"==typeof t.limit&&(m.limit=t.limit),m.skip=o),a(m).then(c)}(e,t)}))()}function k(t,i,r){if("function"==typeof t._query)return function(e,t,i){return new Promise((function(n,r){e._query(t,i,(function(e,t){if(e)return r(e);n(t)}))}))}(t,i,r);if(ne(t))return function(e,t,i){var n,r,o,s=[],a="GET";if(h("reduce",i,s),h("include_docs",i,s),h("attachments",i,s),h("limit",i,s),h("descending",i,s),h("group",i,s),h("group_level",i,s),h("skip",i,s),h("stale",i,s),h("conflicts",i,s),h("startkey",i,s,!0),h("start_key",i,s,!0),h("endkey",i,s,!0),h("end_key",i,s,!0),h("inclusive_end",i,s),h("key",i,s,!0),h("update_seq",i,s),s=""===(s=s.join("&"))?"":"?"+s,void 0!==i.keys){var l="keys="+encodeURIComponent(JSON.stringify(i.keys));l.length+s.length+1<=2e3?s+=("?"===s[0]?"&":"?")+l:(a="POST","string"==typeof t?n={keys:i.keys}:t.keys=i.keys)}if("string"==typeof t){var c=zi(t);return e.fetch("_design/"+c[0]+"/_view/"+c[1]+s,{headers:new it({"Content-Type":"application/json"}),method:a,body:JSON.stringify(n)}).then((function(e){return r=e.ok,o=e.status,e.json()})).then((function(e){if(!r)throw e.status=o,Z(e);return e.rows.forEach((function(e){if(e.value&&e.value.error&&"builtin_reduce_error"===e.value.error)throw new Error(e.reason)})),e})).then(p(i))}return n=n||{},Object.keys(t).forEach((function(e){Array.isArray(t[e])?n[e]=t[e]:n[e]=t[e].toString()})),e.fetch("_temp_view"+s,{headers:new it({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(n)}).then((function(e){return r=e.ok,o=e.status,e.json()})).then((function(e){if(!r)throw e.status=o,Z(e);return e})).then(p(i))}(t,i,r);if("string"!=typeof i)return m(r,i),qi.add((function(){return Fi(t,"temp_view/temp_view",i.map,i.reduce,!0,e).then((function(e){return function(e,t){return e.then((function(e){return t().then((function(){return e}))}),(function(e){return t().then((function(){throw e}))}))}(v(e).then((function(){return y(e,r)})),(function(){return e.db.destroy()}))}))})),qi.finish();var o=i,s=zi(o),l=s[0],c=s[1];return t.get("_design/"+l).then((function(i){var s=i.views&&i.views[c];if(!s)throw new Si("ddoc "+i._id+" has no view named "+c);return n(i,c),m(r,s),Fi(t,o,s.map,s.reduce,!1,e).then((function(e){return"ok"===r.stale||"update_after"===r.stale?("update_after"===r.stale&&a((function(){v(e)})),y(e,r)):v(e).then((function(){return y(e,r)}))}))}))}return{query:function(e,t,i){var n=this;"function"==typeof t&&(i=t,t={}),t=t?function(e){return e.group_level=f(e.group_level),e.limit=f(e.limit),e.skip=f(e.skip),e}(t):{},"function"==typeof e&&(e={map:e});var r=Promise.resolve().then((function(){return k(n,e,t)}));return Ti(r,i),r},viewCleanup:Ai((function(){var t=this;return"function"==typeof t._viewCleanup?function(e){return new Promise((function(t,i){e._viewCleanup((function(e,n){if(e)return i(e);t(n)}))}))}(t):ne(t)?function(e){return e.fetch("_view_cleanup",{headers:new it({"Content-Type":"application/json"}),method:"POST"}).then((function(e){return e.json()}))}(t):function(t){return t.get("_local/"+e).then((function(e){var i=new s;Object.keys(e.views).forEach((function(e){var t=zi(e),n="_design/"+t[0],r=t[1],s=i.get(n);s||(s=new o,i.set(n,s)),s.add(r)}));var n={keys:Oi(i),include_docs:!0};return t.allDocs(n).then((function(n){var r={};n.rows.forEach((function(t){var n=t.key.substring(8);i.get(t.key).forEach((function(i){var o=n+"/"+i;e.views[o]||(o=i);var s=Object.keys(e.views[o]),a=t.doc&&t.doc.views&&t.doc.views[i];s.forEach((function(e){r[e]=r[e]||a}))}))}));var o=Object.keys(r).filter((function(e){return!r[e]})).map((function(e){return Ni(b(e),(function(){return new t.constructor(e,t.__opts).destroy()}))()}));return Promise.all(o).then((function(){return{ok:!0}}))}))}),g({ok:!0}))}(t)}))}}("mrviews",(function(e,t){if("function"==typeof e&&2===e.length){var i=e;return function(e){return i(e,t)}}return Bi(e.toString(),t)}),(function(e){var t=e.toString();return function(e){if(/^_sum/.test(e))return $i;if(/^_count/.test(e))return Vi;if(/^_stats/.test(e))return Wi;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}(t)||Bi(t)}),(function(e,t){var i=e.views&&e.views[t];if("string"!=typeof i.map)throw new Si("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof i.map)}));var Ji={query:function(e,t,i){return Ki.query.call(this,e,t,i)},viewCleanup:function(e){return Ki.viewCleanup.call(this,e)}};function Yi(e){return/^1-/.test(e)}function Xi(e,t){var i=Object.keys(t._attachments);return Promise.all(i.map((function(i){return e.getAttachment(t._id,i,{rev:t._rev})})))}function Qi(e,t,i,n){i=w(i);var r=[],o=!0;function s(t){return e.allDocs({keys:t,include_docs:!0,conflicts:!0}).then((function(e){if(n.cancelled)throw new Error("cancelled");e.rows.forEach((function(e){var t;e.deleted||!e.doc||!Yi(e.value.rev)||(t=e.doc)._attachments&&Object.keys(t._attachments).length>0||function(e){return e._conflicts&&e._conflicts.length>0}(e.doc)||(e.doc._conflicts&&delete e.doc._conflicts,r.push(e.doc),delete i[e.id])}))}))}return Promise.resolve().then((function(){var e=Object.keys(i).filter((function(e){var t=i[e].missing;return 1===t.length&&Yi(t[0])}));if(e.length>0)return s(e)})).then((function(){var s=function(e){var t=[];return Object.keys(e).forEach((function(i){e[i].missing.forEach((function(e){t.push({id:i,rev:e})}))})),{docs:t,revs:!0,latest:!0}}(i);if(s.docs.length)return e.bulkGet(s).then((function(i){if(n.cancelled)throw new Error("cancelled");return Promise.all(i.results.map((function(i){return Promise.all(i.docs.map((function(i){var n=i.ok;return i.error&&(o=!1),n&&n._attachments?function(e,t,i){var n=ne(t)&&!ne(e),r=Object.keys(i._attachments);return n?e.get(i._id).then((function(n){return Promise.all(r.map((function(r){return function(e,t,i){return!e._attachments||!e._attachments[i]||e._attachments[i].digest!==t._attachments[i].digest}(n,i,r)?t.getAttachment(i._id,r):e.getAttachment(n._id,r)})))})).catch((function(e){if(404!==e.status)throw e;return Xi(t,i)})):Xi(t,i)}(t,e,n).then((function(e){var t=Object.keys(n._attachments);return e.forEach((function(e,i){var r=n._attachments[t[i]];delete r.stub,delete r.length,r.data=e})),n})):n})))}))).then((function(e){r=r.concat(te(e).filter(Boolean))}))}))})).then((function(){return{ok:o,docs:r}}))}var Zi="pouchdb";function en(e,t,i,n,r){return e.get(t).catch((function(i){if(404===i.status)return"http"!==e.adapter&&"https"!==e.adapter||L(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:n,_id:t,history:[],replicator:Zi,version:1};throw i})).then((function(o){if(!r.cancelled&&o.last_seq!==i)return o.history=(o.history||[]).filter((function(e){return e.session_id!==n})),o.history.unshift({last_seq:i,session_id:n}),o.history=o.history.slice(0,5),o.version=1,o.replicator=Zi,o.session_id=n,o.last_seq=i,e.put(o).catch((function(o){if(409===o.status)return en(e,t,i,n,r);throw o}))}))}function tn(e,t,i,n,r){this.src=e,this.target=t,this.id=i,this.returnValue=n,this.opts=r||{}}tn.prototype.writeCheckpoint=function(e,t){var i=this;return this.updateTarget(e,t).then((function(){return i.updateSource(e,t)}))},tn.prototype.updateTarget=function(e,t){return this.opts.writeTargetCheckpoint?en(this.target,this.id,e,t,this.returnValue):Promise.resolve(!0)},tn.prototype.updateSource=function(e,t){if(this.opts.writeSourceCheckpoint){var i=this;return en(this.src,this.id,e,t,this.returnValue).catch((function(e){if(sn(e))return i.opts.writeSourceCheckpoint=!1,!0;throw e}))}return Promise.resolve(!0)};var nn={undefined:function(e,t){return 0===ft(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return function(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:rn(e.history,t.history)}(t,e).last_seq}};function rn(e,t){var i=e[0],n=e.slice(1),r=t[0],o=t.slice(1);return i&&0!==t.length?on(i.session_id,t)?{last_seq:i.last_seq,history:e}:on(r.session_id,n)?{last_seq:r.last_seq,history:o}:rn(n,o):{last_seq:0,history:[]}}function on(e,t){var i=t[0],n=t.slice(1);return!(!e||0===t.length)&&(e===i.session_id||on(e,n))}function sn(e){return"number"==typeof e.status&&4===Math.floor(e.status/100)}tn.prototype.getCheckpoint=function(){var e=this;return e.opts&&e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?e.src.get(e.id).then((function(e){return e.last_seq||0})).catch((function(e){if(404!==e.status)throw e;return 0})):e.target.get(e.id).then((function(t){return e.opts&&e.opts.writeTargetCheckpoint&&!e.opts.writeSourceCheckpoint?t.last_seq||0:e.src.get(e.id).then((function(e){return t.version!==e.version?0:(i=t.version?t.version.toString():"undefined")in nn?nn[i](t,e):0;var i}),(function(i){if(404===i.status&&t.last_seq)return e.src.put({_id:e.id,last_seq:0}).then((function(){return 0}),(function(i){return sn(i)?(e.opts.writeSourceCheckpoint=!1,t.last_seq):0}));throw i}))})).catch((function(e){if(404!==e.status)throw e;return 0}))};function an(e,t,i){var n=i.doc_ids?i.doc_ids.sort(ft):"",r=i.filter?i.filter.toString():"",o="",s="",a="";return i.selector&&(a=JSON.stringify(i.selector)),i.filter&&i.query_params&&(o=JSON.stringify(function(e){return Object.keys(e).sort(ft).reduce((function(t,i){return t[i]=e[i],t}),{})}(i.query_params))),i.filter&&"_view"===i.filter&&(s=i.view.toString()),Promise.all([e.id(),t.id()]).then((function(e){var t=e[0]+e[1]+r+s+o+n+a;return new Promise((function(e){Se(t,e)}))})).then((function(e){return"_local/"+e.replace(/\//g,".").replace(/\+/g,"_")}))}function ln(e,t,i,n,r){var o,s,l,c=[],u={seq:0,changes:[],docs:[]},d=!1,p=!1,h=!1,f=0,m=i.continuous||i.live||!1,g=i.batch_size||100,b=i.batches_limit||10,v=!1,y=i.doc_ids,k=i.selector,x=[],E=Ae();r=r||{ok:!0,start_time:(new Date).toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var C={};function S(){return l?Promise.resolve():an(e,t,i).then((function(r){s=r;var o;o=!1===i.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===i.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===i.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},l=new tn(e,t,s,n,o)}))}function _(){if(x=[],0!==o.docs.length){var e=o.docs,s={timeout:i.timeout};return t.bulkDocs({docs:e,new_edits:!1},s).then((function(t){if(n.cancelled)throw P(),new Error("cancelled");var i=Object.create(null);t.forEach((function(e){e.error&&(i[e.id]=e)}));var o=Object.keys(i).length;r.doc_write_failures+=o,r.docs_written+=e.length-o,e.forEach((function(e){var t=i[e._id];if(t){r.errors.push(t);var o=(t.name||"").toLowerCase();if("unauthorized"!==o&&"forbidden"!==o)throw t;n.emit("denied",w(t))}else x.push(e)}))}),(function(t){throw r.doc_write_failures+=e.length,t}))}}function T(){if(o.error)throw new Error("There was a problem getting docs.");r.last_seq=f=o.seq;var e=w(r);return x.length&&(e.docs=x,"number"==typeof o.pending&&(e.pending=o.pending,delete o.pending),n.emit("change",e)),d=!0,l.writeCheckpoint(o.seq,E).then((function(){if(d=!1,n.cancelled)throw P(),new Error("cancelled");o=void 0,B()})).catch((function(e){throw U(e),e}))}function A(){return Qi(e,t,o.diffs,n).then((function(e){o.error=!e.ok,e.docs.forEach((function(e){delete o.diffs[e._id],r.docs_read++,o.docs.push(e)}))}))}function N(){var e;n.cancelled||o||(0!==c.length?(o=c.shift(),(e={},o.changes.forEach((function(t){"_user/"!==t.id&&(e[t.id]=t.changes.map((function(e){return e.rev})))})),t.revsDiff(e).then((function(e){if(n.cancelled)throw P(),new Error("cancelled");o.diffs=e}))).then(A).then(_).then(T).then(N).catch((function(e){O("batch processing terminated with error",e)}))):I(!0))}function I(e){0!==u.changes.length?(e||p||u.changes.length>=g)&&(c.push(u),u={seq:0,changes:[],docs:[]},"pending"!==n.state&&"stopped"!==n.state||(n.state="active",n.emit("active")),N()):0!==c.length||o||((m&&C.live||p)&&(n.state="pending",n.emit("paused")),p&&P())}function O(e,t){h||(t.message||(t.message=e),r.ok=!1,r.status="aborting",c=[],u={seq:0,changes:[],docs:[]},P(t))}function P(o){if(!(h||n.cancelled&&(r.status="cancelled",d)))if(r.status=r.status||"complete",r.end_time=(new Date).toISOString(),r.last_seq=f,h=!0,o){(o=Q(o)).result=r;var s=(o.name||"").toLowerCase();"unauthorized"===s||"forbidden"===s?(n.emit("error",o),n.removeAllListeners()):function(e,t,i,n){if(!1===e.retry)return t.emit("error",i),void t.removeAllListeners();if("function"!=typeof e.back_off_function&&(e.back_off_function=D),t.emit("requestError",i),"active"===t.state||"pending"===t.state){t.emit("paused",i),t.state="stopped";var r=function(){e.current_back_off=0};t.once("paused",(function(){t.removeListener("active",r)})),t.once("active",r)}e.current_back_off=e.current_back_off||0,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(n,e.current_back_off)}(i,n,o,(function(){ln(e,t,i,n)}))}else n.emit("complete",r),n.removeAllListeners()}function L(e,t,r){if(n.cancelled)return P();"number"==typeof t&&(u.pending=t),ee(i)(e)&&(u.seq=e.seq||r,u.changes.push(e),a((function(){I(0===c.length&&C.live)})))}function R(e){if(v=!1,n.cancelled)return P();if(e.results.length>0)C.since=e.results[e.results.length-1].seq,B(),I(!0);else{var t=function(){m?(C.live=!0,B()):p=!0,I(!0)};o||0!==e.results.length?t():(d=!0,l.writeCheckpoint(e.last_seq,E).then((function(){d=!1,r.last_seq=f=e.last_seq,t()})).catch(U))}}function M(e){if(v=!1,n.cancelled)return P();O("changes rejected",e)}function B(){if(!v&&!p&&c.length<b){v=!0,n._changes&&(n.removeListener("cancel",n._abortChanges),n._changes.cancel()),n.once("cancel",r);var t=e.changes(C).on("change",L);t.then(o,o),t.then(R).catch(M),i.retry&&(n._changes=t,n._abortChanges=r)}function r(){t.cancel()}function o(){n.removeListener("cancel",r)}}function j(){S().then((function(){if(!n.cancelled)return l.getCheckpoint().then((function(e){C={since:f=e,limit:g,batch_size:g,style:"all_docs",doc_ids:y,selector:k,return_docs:!0},i.filter&&("string"!=typeof i.filter?C.include_docs=!0:C.filter=i.filter),"heartbeat"in i&&(C.heartbeat=i.heartbeat),"timeout"in i&&(C.timeout=i.timeout),i.query_params&&(C.query_params=i.query_params),i.view&&(C.view=i.view),B()}));P()})).catch((function(e){O("getCheckpoint rejected with ",e)}))}function U(e){d=!1,O("writeCheckpoint completed with error",e)}n.ready(e,t),n.cancelled?P():(n._addedListeners||(n.once("cancel",P),"function"==typeof i.complete&&(n.once("error",i.complete),n.once("complete",(function(e){i.complete(null,e)}))),n._addedListeners=!0),void 0===i.since?j():S().then((function(){return d=!0,l.writeCheckpoint(i.since,E)})).then((function(){d=!1,n.cancelled?P():(f=i.since,j())})).catch(U))}function cn(){h.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var e=this,t=new Promise((function(t,i){e.once("complete",t),e.once("error",i)}));e.then=function(e,i){return t.then(e,i)},e.catch=function(e){return t.catch(e)},e.catch((function(){}))}function un(e,t){var i=t.PouchConstructor;return"string"==typeof e?new i(e,t):e}function dn(e,t,i,n){if("function"==typeof i&&(n=i,i={}),void 0===i&&(i={}),i.doc_ids&&!Array.isArray(i.doc_ids))throw Q(W,"`doc_ids` filter parameter is not a list.");i.complete=n,(i=w(i)).continuous=i.continuous||i.live,i.retry="retry"in i&&i.retry,i.PouchConstructor=i.PouchConstructor||this;var r=new cn(i);return ln(un(e,i),un(t,i),i,r),r}function pn(e,t,i,n){return"function"==typeof i&&(n=i,i={}),void 0===i&&(i={}),(i=w(i)).PouchConstructor=i.PouchConstructor||this,new hn(e=un(e,i),t=un(t,i),i,n)}function hn(e,t,i,n){var r=this;this.canceled=!1;var o=i.push?R({},i,i.push):i,s=i.pull?R({},i,i.pull):i;function a(e){r.emit("change",{direction:"pull",change:e})}function l(e){r.emit("change",{direction:"push",change:e})}function c(e){r.emit("denied",{direction:"push",doc:e})}function u(e){r.emit("denied",{direction:"pull",doc:e})}function d(){r.pushPaused=!0,r.pullPaused&&r.emit("paused")}function p(){r.pullPaused=!0,r.pushPaused&&r.emit("paused")}function h(){r.pushPaused=!1,r.pullPaused&&r.emit("active",{direction:"push"})}function f(){r.pullPaused=!1,r.pushPaused&&r.emit("active",{direction:"pull"})}this.push=dn(e,t,o),this.pull=dn(t,e,s),this.pushPaused=!0,this.pullPaused=!0;var m={};function g(e){return function(t,i){("change"===t&&(i===a||i===l)||"denied"===t&&(i===u||i===c)||"paused"===t&&(i===p||i===d)||"active"===t&&(i===f||i===h))&&(t in m||(m[t]={}),m[t][e]=!0,2===Object.keys(m[t]).length&&r.removeAllListeners(t))}}function b(e,t,i){-1==e.listeners(t).indexOf(i)&&e.on(t,i)}i.live&&(this.push.on("complete",r.pull.cancel.bind(r.pull)),this.pull.on("complete",r.push.cancel.bind(r.push))),this.on("newListener",(function(e){"change"===e?(b(r.pull,"change",a),b(r.push,"change",l)):"denied"===e?(b(r.pull,"denied",u),b(r.push,"denied",c)):"active"===e?(b(r.pull,"active",f),b(r.push,"active",h)):"paused"===e&&(b(r.pull,"paused",p),b(r.push,"paused",d))})),this.on("removeListener",(function(e){"change"===e?(r.pull.removeListener("change",a),r.push.removeListener("change",l)):"denied"===e?(r.pull.removeListener("denied",u),r.push.removeListener("denied",c)):"active"===e?(r.pull.removeListener("active",f),r.push.removeListener("active",h)):"paused"===e&&(r.pull.removeListener("paused",p),r.push.removeListener("paused",d))})),this.pull.on("removeListener",g("pull")),this.push.on("removeListener",g("push"));var v=Promise.all([this.push,this.pull]).then((function(e){var t={push:e[0],pull:e[1]};return r.emit("complete",t),n&&n(null,t),r.removeAllListeners(),t}),(function(e){if(r.cancel(),n?n(e):r.emit("error",e),r.removeAllListeners(),n)throw e}));this.then=function(e,t){return v.then(e,t)},this.catch=function(e){return v.catch(e)}}p(cn,h.EventEmitter),cn.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},cn.prototype.ready=function(e,t){var i=this;function n(){i.cancel()}i._readyCalled||(i._readyCalled=!0,e.once("destroyed",n),t.once("destroyed",n),i.once("complete",(function(){e.removeListener("destroyed",n),t.removeListener("destroyed",n)})))},p(hn,h.EventEmitter),hn.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},Ze.plugin((function(e){e.adapter("idb",hi,!0)})).plugin((function(e){e.adapter("http",Ei,!1),e.adapter("https",Ei,!1)})).plugin(Ji).plugin((function(e){e.replicate=dn,e.sync=pn,Object.defineProperty(e.prototype,"replicate",{get:function(){var e=this;return void 0===this.replicateMethods&&(this.replicateMethods={from:function(t,i,n){return e.constructor.replicate(t,e,i,n)},to:function(t,i,n){return e.constructor.replicate(e,t,i,n)}}),this.replicateMethods}}),e.prototype.sync=function(e,t,i){return this.constructor.sync(this,e,t,i)}})),t.exports=Ze}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:285,argsarray:161,events:195,immediate:200,inherits:201,"spark-md5":378,uuid:279,vuvuzela:397}],279:[function(e,t,i){var n=e("./v1"),r=e("./v4"),o=r;o.v1=n,o.v4=r,t.exports=o},{"./v1":282,"./v4":283}],280:[function(e,t,i){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);t.exports=function(e,t){var i=t||0,r=n;return[r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],"-",r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]],r[e[i++]]].join("")}},{}],281:[function(e,t,i){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);t.exports=function(){return n(r),r}}else{var o=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},{}],282:[function(e,t,i){var n,r,o=e("./lib/rng"),s=e("./lib/bytesToUuid"),a=0,l=0;t.exports=function(e,t,i){var c=t&&i||0,u=t||[],d=(e=e||{}).node||n,p=void 0!==e.clockseq?e.clockseq:r;if(null==d||null==p){var h=o();null==d&&(d=n=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==p&&(p=r=16383&(h[6]<<8|h[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:l+1,g=f-a+(m-l)/1e4;if(g<0&&void 0===e.clockseq&&(p=p+1&16383),(g<0||f>a)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=f,l=m,r=p;var b=(1e4*(268435455&(f+=122192928e5))+m)%4294967296;u[c++]=b>>>24&255,u[c++]=b>>>16&255,u[c++]=b>>>8&255,u[c++]=255&b;var v=f/4294967296*1e4&268435455;u[c++]=v>>>8&255,u[c++]=255&v,u[c++]=v>>>24&15|16,u[c++]=v>>>16&255,u[c++]=p>>>8|128,u[c++]=255&p;for(var y=0;y<6;++y)u[c+y]=d[y];return t||s(u)}},{"./lib/bytesToUuid":280,"./lib/rng":281}],283:[function(e,t,i){var n=e("./lib/rng"),r=e("./lib/bytesToUuid");t.exports=function(e,t,i){var o=t&&i||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||r(s)}},{"./lib/bytesToUuid":280,"./lib/rng":281}],284:[function(e,t,i){(function(e){(function(){"use strict";void 0===e||!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function(t,i,n,r){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick((function(){t.call(null,i)}));case 3:return e.nextTick((function(){t.call(null,i,n)}));case 4:return e.nextTick((function(){t.call(null,i,n,r)}));default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return e.nextTick((function(){t.apply(null,o)}))}}}:t.exports=e}).call(this)}).call(this,e("_process"))},{_process:285}],285:[function(e,t,i){var n,r,o=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function l(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c,u=[],d=!1,p=-1;function h(){d&&c&&(d=!1,c.length?u=c.concat(u):p=-1,u.length&&f())}function f(){if(!d){var e=l(h);d=!0;for(var t=u.length;t;){for(c=u,u=[];++p<t;)c&&c[p].run();p=-1,t=u.length}c=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];u.push(new m(e,t)),1!==u.length||d||l(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],286:[function(e,t,i){"use strict";var n=e("./lib/ReactPropTypesSecret");function r(){}function o(){}o.resetWarningCache=r,t.exports=function(){function e(e,t,i,r,o,s){if(s!==n){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var i={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:r};return i.PropTypes=i,i}},{"./lib/ReactPropTypesSecret":288}],287:[function(e,t,i){t.exports=e("./factoryWithThrowingShims")()},{"./factoryWithThrowingShims":286}],288:[function(e,t,i){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},{}],289:[function(e,t,i){var n,r;n=this,r=function(){var e="function"==typeof Object.defineProperty?function(e,t,i){return Object.defineProperty(e,t,i),e}:function(e,t,i){return e[t]=i.value,e};return function(t,i,n,r){var o;if(r=function(e,t){var i="object"==typeof t,n=!i&&"string"==typeof t,r=function(e){return i?!!t[e]:!!n&&t.indexOf(e[0])>-1};return{enumerable:r("enumerable"),configurable:r("configurable"),writable:r("writable"),value:e}}(n,r),"object"==typeof i){for(o in i)Object.hasOwnProperty.call(i,o)&&(r.value=i[o],e(t,o,r));return t}return e(t,i,r)}},void 0!==t&&t.exports?t.exports=r():n.prr=r()},{}],290:[function(e,t,i){"use strict";var n=e("react"),r=e("object-assign"),o=e("scheduler");function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!n)throw Error(s(227));var a=null,l={};function c(){if(a)for(var e in l){var t=l[e],i=a.indexOf(e);if(!(-1<i))throw Error(s(96,e));if(!d[i]){if(!t.extractEvents)throw Error(s(97,e));for(var n in d[i]=t,i=t.eventTypes){var r=void 0,o=i[n],c=t,h=n;if(p.hasOwnProperty(h))throw Error(s(99,h));p[h]=o;var f=o.phasedRegistrationNames;if(f){for(r in f)f.hasOwnProperty(r)&&u(f[r],c,h);r=!0}else o.registrationName?(u(o.registrationName,c,h),r=!0):r=!1;if(!r)throw Error(s(98,n,e))}}}}function u(e,t,i){if(h[e])throw Error(s(100,e));h[e]=t,f[e]=t.eventTypes[i].dependencies}var d=[],p={},h={},f={};function m(e,t,i,n,r,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(e){this.onError(e)}}var g=!1,b=null,v=!1,y=null,k={onError:function(e){g=!0,b=e}};function w(e,t,i,n,r,o,s,a,l){g=!1,b=null,m.apply(k,arguments)}var x=null,E=null,C=null;function S(e,t,i){var n=e.type||"unknown-event";e.currentTarget=C(i),function(e,t,i,n,r,o,a,l,c){if(w.apply(this,arguments),g){if(!g)throw Error(s(198));var u=b;g=!1,b=null,v||(v=!0,y=u)}}(n,t,void 0,e),e.currentTarget=null}function _(e,t){if(null==t)throw Error(s(30));return null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function T(e,t,i){Array.isArray(e)?e.forEach(t,i):e&&t.call(i,e)}var A=null;function N(e){if(e){var t=e._dispatchListeners,i=e._dispatchInstances;if(Array.isArray(t))for(var n=0;n<t.length&&!e.isPropagationStopped();n++)S(e,t[n],i[n]);else t&&S(e,t,i);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function I(e){if(null!==e&&(A=_(A,e)),e=A,A=null,e){if(T(e,N),A)throw Error(s(95));if(v)throw e=y,v=!1,y=null,e}}var O={injectEventPluginOrder:function(e){if(a)throw Error(s(101));a=Array.prototype.slice.call(e),c()},injectEventPluginsByName:function(e){var t,i=!1;for(t in e)if(e.hasOwnProperty(t)){var n=e[t];if(!l.hasOwnProperty(t)||l[t]!==n){if(l[t])throw Error(s(102,t));l[t]=n,i=!0}}i&&c()}};function P(e,t){var i=e.stateNode;if(!i)return null;var n=x(i);if(!n)return null;i=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(i&&"function"!=typeof i)throw Error(s(231,t,typeof i));return i}var D=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;D.hasOwnProperty("ReactCurrentDispatcher")||(D.ReactCurrentDispatcher={current:null}),D.hasOwnProperty("ReactCurrentBatchConfig")||(D.ReactCurrentBatchConfig={suspense:null});var L=/^(.*)[\\\/]/,R="function"==typeof Symbol&&Symbol.for,M=R?Symbol.for("react.element"):60103,B=R?Symbol.for("react.portal"):60106,j=R?Symbol.for("react.fragment"):60107,U=R?Symbol.for("react.strict_mode"):60108,F=R?Symbol.for("react.profiler"):60114,H=R?Symbol.for("react.provider"):60109,q=R?Symbol.for("react.context"):60110,z=R?Symbol.for("react.concurrent_mode"):60111,G=R?Symbol.for("react.forward_ref"):60112,$=R?Symbol.for("react.suspense"):60113,V=R?Symbol.for("react.suspense_list"):60120,W=R?Symbol.for("react.memo"):60115,K=R?Symbol.for("react.lazy"):60116;R&&Symbol.for("react.fundamental"),R&&Symbol.for("react.responder"),R&&Symbol.for("react.scope");var J="function"==typeof Symbol&&Symbol.iterator;function Y(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=J&&e[J]||e["@@iterator"])?e:null}function X(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case j:return"Fragment";case B:return"Portal";case F:return"Profiler";case U:return"StrictMode";case $:return"Suspense";case V:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case q:return"Context.Consumer";case H:return"Context.Provider";case G:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case W:return X(e.type);case K:if(e=1===e._status?e._result:null)return X(e)}return null}function Q(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var i="";break e;default:var n=e._debugOwner,r=e._debugSource,o=X(e.type);i=null,n&&(i=X(n.type)),n=o,o="",r?o=" (at "+r.fileName.replace(L,"")+":"+r.lineNumber+")":i&&(o=" (created by "+i+")"),i="\n    in "+(n||"Unknown")+o}t+=i,e=e.return}while(e);return t}var Z=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),ee=null,te=null,ie=null;function ne(e){if(e=E(e)){if("function"!=typeof ee)throw Error(s(280));var t=x(e.stateNode);ee(e.stateNode,e.type,t)}}function re(e){te?ie?ie.push(e):ie=[e]:te=e}function oe(){if(te){var e=te,t=ie;if(ie=te=null,ne(e),t)for(e=0;e<t.length;e++)ne(t[e])}}function se(e,t){return e(t)}function ae(e,t,i,n){return e(t,i,n)}function le(){}var ce=se,ue=!1,de=!1;function pe(){null===te&&null===ie||(le(),oe())}new Map;var he=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,fe=Object.prototype.hasOwnProperty,me={},ge={};function be(e,t,i,n,r,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=o}var ve={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){ve[e]=new be(e,0,!1,e,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];ve[t]=new be(t,1,!1,e[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){ve[e]=new be(e,2,!1,e.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){ve[e]=new be(e,2,!1,e,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){ve[e]=new be(e,3,!1,e.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(e){ve[e]=new be(e,3,!0,e,null,!1)})),["capture","download"].forEach((function(e){ve[e]=new be(e,4,!1,e,null,!1)})),["cols","rows","size","span"].forEach((function(e){ve[e]=new be(e,6,!1,e,null,!1)})),["rowSpan","start"].forEach((function(e){ve[e]=new be(e,5,!1,e.toLowerCase(),null,!1)}));var ye=/[\-:]([a-z])/g;function ke(e){return e[1].toUpperCase()}function we(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function xe(e,t,i,n){var r=ve.hasOwnProperty(t)?ve[t]:null;(null!==r?0===r.type:!n&&2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1]))||(function(e,t,i,n){if(null==t||function(e,t,i,n){if(null!==i&&0===i.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==i?!i.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,i,n))return!0;if(n)return!1;if(null!==i)switch(i.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,i,r,n)&&(i=null),n||null===r?function(e){return!!fe.call(ge,e)||!fe.call(me,e)&&(he.test(e)?ge[e]=!0:(me[e]=!0,!1))}(t)&&(null===i?e.removeAttribute(t):e.setAttribute(t,""+i)):r.mustUseProperty?e[r.propertyName]=null===i?3!==r.type&&"":i:(t=r.attributeName,n=r.attributeNamespace,null===i?e.removeAttribute(t):(i=3===(r=r.type)||4===r&&!0===i?"":""+i,n?e.setAttributeNS(n,t,i):e.setAttribute(t,i))))}function Ee(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Ce(e){e._valueTracker||(e._valueTracker=function(e){var t=Ee(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==i&&"function"==typeof i.get&&"function"==typeof i.set){var r=i.get,o=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){n=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Se(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),n="";return e&&(n=Ee(e)?e.checked?"true":"false":e.value),(e=n)!==i&&(t.setValue(e),!0)}function _e(e,t){var i=t.checked;return r({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function Te(e,t){var i=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;i=we(null!=t.value?t.value:i),e._wrapperState={initialChecked:n,initialValue:i,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Ae(e,t){null!=(t=t.checked)&&xe(e,"checked",t,!1)}function Ne(e,t){Ae(e,t);var i=we(t.value),n=t.type;if(null!=i)"number"===n?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?Oe(e,t.type,i):t.hasOwnProperty("defaultValue")&&Oe(e,t.type,we(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Ie(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!e.defaultChecked,e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function Oe(e,t,i){"number"===t&&e.ownerDocument.activeElement===e||(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}function Pe(e,t){return e=r({children:void 0},t),(t=function(e){var t="";return n.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function De(e,t,i,n){if(e=e.options,t){t={};for(var r=0;r<i.length;r++)t["$"+i[r]]=!0;for(i=0;i<e.length;i++)r=t.hasOwnProperty("$"+e[i].value),e[i].selected!==r&&(e[i].selected=r),r&&n&&(e[i].defaultSelected=!0)}else{for(i=""+we(i),t=null,r=0;r<e.length;r++){if(e[r].value===i)return e[r].selected=!0,void(n&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function Le(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return r({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Re(e,t){var i=t.value;if(null==i){if(i=t.defaultValue,null!=(t=t.children)){if(null!=i)throw Error(s(92));if(Array.isArray(t)){if(!(1>=t.length))throw Error(s(93));t=t[0]}i=t}null==i&&(i="")}e._wrapperState={initialValue:we(i)}}function Me(e,t){var i=we(t.value),n=we(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue&&e.defaultValue!==i&&(e.defaultValue=i)),null!=n&&(e.defaultValue=""+n)}function Be(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(ye,ke);ve[t]=new be(t,1,!1,e,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(ye,ke);ve[t]=new be(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(ye,ke);ve[t]=new be(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(e){ve[e]=new be(e,1,!1,e.toLowerCase(),null,!1)})),ve.xlinkHref=new be("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(e){ve[e]=new be(e,1,!1,e.toLowerCase(),null,!0)}));var je="http://www.w3.org/1999/xhtml",Ue="http://www.w3.org/2000/svg";function Fe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function He(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?Fe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var qe,ze,Ge=(ze=function(e,t){if(e.namespaceURI!==Ue||"innerHTML"in e)e.innerHTML=t;else{for((qe=qe||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=qe.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,i,n){MSApp.execUnsafeLocalFunction((function(){return ze(e,t)}))}:ze);function $e(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t}function Ve(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Ke={},Je={};function Ye(e){if(Ke[e])return Ke[e];if(!We[e])return e;var t,i=We[e];for(t in i)if(i.hasOwnProperty(t)&&t in Je)return Ke[e]=i[t];return e}Z&&(Je=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);var Xe=Ye("animationend"),Qe=Ye("animationiteration"),Ze=Ye("animationstart"),et=Ye("transitionend"),tt="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" ");function it(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).effectTag)&&(i=t.return),e=t.return}while(e)}return 3===t.tag?i:null}function nt(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function rt(e){if(it(e)!==e)throw Error(s(188))}function ot(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=it(e)))throw Error(s(188));return t!==e?null:e}for(var i=e,n=t;;){var r=i.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(n=r.return)){i=n;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===i)return rt(r),e;if(o===n)return rt(r),t;o=o.sibling}throw Error(s(188))}if(i.return!==n.return)i=r,n=o;else{for(var a=!1,l=r.child;l;){if(l===i){a=!0,i=r,n=o;break}if(l===n){a=!0,n=r,i=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===i){a=!0,i=o,n=r;break}if(l===n){a=!0,n=o,i=r;break}l=l.sibling}if(!a)throw Error(s(189))}}if(i.alternate!==n)throw Error(s(190))}if(3!==i.tag)throw Error(s(188));return i.stateNode.current===i?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}var st,at,lt,ct=!1,ut=[],dt=null,pt=null,ht=null,ft=new Map,mt=new Map,gt=[],bt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),vt="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function yt(e,t,i,n){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|i,nativeEvent:n}}function kt(e,t){switch(e){case"focus":case"blur":dt=null;break;case"dragenter":case"dragleave":pt=null;break;case"mouseover":case"mouseout":ht=null;break;case"pointerover":case"pointerout":ft.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":mt.delete(t.pointerId)}}function wt(e,t,i,n,r){return null===e||e.nativeEvent!==r?(e=yt(t,i,n,r),null!==t&&null!==(t=hn(t))&&at(t),e):(e.eventSystemFlags|=n,e)}function xt(e){var t=pn(e.target);if(null!==t){var i=it(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=nt(i)))return e.blockedOn=t,void o.unstable_runWithPriority(e.priority,(function(){lt(i)}))}else if(3===t&&i.stateNode.hydrate)return void(e.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}e.blockedOn=null}function Et(e){if(null!==e.blockedOn)return!1;var t=Oi(e.topLevelType,e.eventSystemFlags,e.nativeEvent);if(null!==t){var i=hn(t);return null!==i&&at(i),e.blockedOn=t,!1}return!0}function Ct(e,t,i){Et(e)&&i.delete(t)}function St(){for(ct=!1;0<ut.length;){var e=ut[0];if(null!==e.blockedOn){null!==(e=hn(e.blockedOn))&&st(e);break}var t=Oi(e.topLevelType,e.eventSystemFlags,e.nativeEvent);null!==t?e.blockedOn=t:ut.shift()}null!==dt&&Et(dt)&&(dt=null),null!==pt&&Et(pt)&&(pt=null),null!==ht&&Et(ht)&&(ht=null),ft.forEach(Ct),mt.forEach(Ct)}function _t(e,t){e.blockedOn===t&&(e.blockedOn=null,ct||(ct=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,St)))}function Tt(e){function t(t){return _t(t,e)}if(0<ut.length){_t(ut[0],e);for(var i=1;i<ut.length;i++){var n=ut[i];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==dt&&_t(dt,e),null!==pt&&_t(pt,e),null!==ht&&_t(ht,e),ft.forEach(t),mt.forEach(t),i=0;i<gt.length;i++)(n=gt[i]).blockedOn===e&&(n.blockedOn=null);for(;0<gt.length&&null===(i=gt[0]).blockedOn;)xt(i),null===i.blockedOn&&gt.shift()}function At(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function Nt(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function It(e,t,i){(t=P(e,i.dispatchConfig.phasedRegistrationNames[t]))&&(i._dispatchListeners=_(i._dispatchListeners,t),i._dispatchInstances=_(i._dispatchInstances,e))}function Ot(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,i=[];t;)i.push(t),t=Nt(t);for(t=i.length;0<t--;)It(i[t],"captured",e);for(t=0;t<i.length;t++)It(i[t],"bubbled",e)}}function Pt(e,t,i){e&&i&&i.dispatchConfig.registrationName&&(t=P(e,i.dispatchConfig.registrationName))&&(i._dispatchListeners=_(i._dispatchListeners,t),i._dispatchInstances=_(i._dispatchInstances,e))}function Dt(e){e&&e.dispatchConfig.registrationName&&Pt(e._targetInst,null,e)}function Lt(e){T(e,Ot)}function Rt(){return!0}function Mt(){return!1}function Bt(e,t,i,n){for(var r in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=i,e=this.constructor.Interface)e.hasOwnProperty(r)&&((t=e[r])?this[r]=t(i):"target"===r?this.target=n:this[r]=i[r]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?Rt:Mt,this.isPropagationStopped=Mt,this}function jt(e,t,i,n){if(this.eventPool.length){var r=this.eventPool.pop();return this.call(r,e,t,i,n),r}return new this(e,t,i,n)}function Ut(e){if(!(e instanceof this))throw Error(s(279));e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function Ft(e){e.eventPool=[],e.getPooled=jt,e.release=Ut}r(Bt.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Rt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Rt)},persist:function(){this.isPersistent=Rt},isPersistent:Mt,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Mt,this._dispatchInstances=this._dispatchListeners=null}}),Bt.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},Bt.extend=function(e){function t(){}function i(){return n.apply(this,arguments)}var n=this;t.prototype=n.prototype;var o=new t;return r(o,i.prototype),i.prototype=o,i.prototype.constructor=i,i.Interface=r({},n.Interface,e),i.extend=n.extend,Ft(i),i},Ft(Bt);var Ht=Bt.extend({animationName:null,elapsedTime:null,pseudoElement:null}),qt=Bt.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),zt=Bt.extend({view:null,detail:null}),Gt=zt.extend({relatedTarget:null});function $t(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var Vt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Wt={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Kt={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Jt(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Kt[e])&&!!t[e]}function Yt(){return Jt}for(var Xt=zt.extend({key:function(e){if(e.key){var t=Vt[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=$t(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Wt[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Yt,charCode:function(e){return"keypress"===e.type?$t(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?$t(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Qt=0,Zt=0,ei=!1,ti=!1,ii=zt.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Yt,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=Qt;return Qt=e.screenX,ei?"mousemove"===e.type?e.screenX-t:0:(ei=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=Zt;return Zt=e.screenY,ti?"mousemove"===e.type?e.screenY-t:0:(ti=!0,0)}}),ni=ii.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),ri=ii.extend({dataTransfer:null}),oi=zt.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Yt}),si=Bt.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),ai=ii.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),li=[["blur","blur",0],["cancel","cancel",0],["click","click",0],["close","close",0],["contextmenu","contextMenu",0],["copy","copy",0],["cut","cut",0],["auxclick","auxClick",0],["dblclick","doubleClick",0],["dragend","dragEnd",0],["dragstart","dragStart",0],["drop","drop",0],["focus","focus",0],["input","input",0],["invalid","invalid",0],["keydown","keyDown",0],["keypress","keyPress",0],["keyup","keyUp",0],["mousedown","mouseDown",0],["mouseup","mouseUp",0],["paste","paste",0],["pause","pause",0],["play","play",0],["pointercancel","pointerCancel",0],["pointerdown","pointerDown",0],["pointerup","pointerUp",0],["ratechange","rateChange",0],["reset","reset",0],["seeked","seeked",0],["submit","submit",0],["touchcancel","touchCancel",0],["touchend","touchEnd",0],["touchstart","touchStart",0],["volumechange","volumeChange",0],["drag","drag",1],["dragenter","dragEnter",1],["dragexit","dragExit",1],["dragleave","dragLeave",1],["dragover","dragOver",1],["mousemove","mouseMove",1],["mouseout","mouseOut",1],["mouseover","mouseOver",1],["pointermove","pointerMove",1],["pointerout","pointerOut",1],["pointerover","pointerOver",1],["scroll","scroll",1],["toggle","toggle",1],["touchmove","touchMove",1],["wheel","wheel",1],["abort","abort",2],[Xe,"animationEnd",2],[Qe,"animationIteration",2],[Ze,"animationStart",2],["canplay","canPlay",2],["canplaythrough","canPlayThrough",2],["durationchange","durationChange",2],["emptied","emptied",2],["encrypted","encrypted",2],["ended","ended",2],["error","error",2],["gotpointercapture","gotPointerCapture",2],["load","load",2],["loadeddata","loadedData",2],["loadedmetadata","loadedMetadata",2],["loadstart","loadStart",2],["lostpointercapture","lostPointerCapture",2],["playing","playing",2],["progress","progress",2],["seeking","seeking",2],["stalled","stalled",2],["suspend","suspend",2],["timeupdate","timeUpdate",2],[et,"transitionEnd",2],["waiting","waiting",2]],ci={},ui={},di=0;di<li.length;di++){var pi=li[di],hi=pi[0],fi=pi[1],mi=pi[2],gi="on"+(fi[0].toUpperCase()+fi.slice(1)),bi={phasedRegistrationNames:{bubbled:gi,captured:gi+"Capture"},dependencies:[hi],eventPriority:mi};ci[fi]=bi,ui[hi]=bi}var vi={eventTypes:ci,getEventPriority:function(e){return void 0!==(e=ui[e])?e.eventPriority:2},extractEvents:function(e,t,i,n){var r=ui[e];if(!r)return null;switch(e){case"keypress":if(0===$t(i))return null;case"keydown":case"keyup":e=Xt;break;case"blur":case"focus":e=Gt;break;case"click":if(2===i.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=ii;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=ri;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=oi;break;case Xe:case Qe:case Ze:e=Ht;break;case et:e=si;break;case"scroll":e=zt;break;case"wheel":e=ai;break;case"copy":case"cut":case"paste":e=qt;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=ni;break;default:e=Bt}return Lt(t=e.getPooled(r,t,i,n)),t}},yi=o.unstable_UserBlockingPriority,ki=o.unstable_runWithPriority,wi=vi.getEventPriority,xi=[];function Ei(e){var t=e.targetInst,i=t;do{if(!i){e.ancestors.push(i);break}var n=i;if(3===n.tag)n=n.stateNode.containerInfo;else{for(;n.return;)n=n.return;n=3!==n.tag?null:n.stateNode.containerInfo}if(!n)break;5!==(t=i.tag)&&6!==t||e.ancestors.push(i),i=pn(n)}while(i);for(i=0;i<e.ancestors.length;i++){t=e.ancestors[i];var r=At(e.nativeEvent);n=e.topLevelType;for(var o=e.nativeEvent,s=e.eventSystemFlags,a=null,l=0;l<d.length;l++){var c=d[l];c&&(c=c.extractEvents(n,t,o,r,s))&&(a=_(a,c))}I(a)}}var Ci=!0;function Si(e,t){_i(t,e,!1)}function _i(e,t,i){switch(wi(t)){case 0:var n=Ti.bind(null,t,1);break;case 1:n=Ai.bind(null,t,1);break;default:n=Ii.bind(null,t,1)}i?e.addEventListener(t,n,!0):e.addEventListener(t,n,!1)}function Ti(e,t,i){ue||le();var n=Ii,r=ue;ue=!0;try{ae(n,e,t,i)}finally{(ue=r)||pe()}}function Ai(e,t,i){ki(yi,Ii.bind(null,e,t,i))}function Ni(e,t,i,n){if(xi.length){var r=xi.pop();r.topLevelType=e,r.eventSystemFlags=t,r.nativeEvent=i,r.targetInst=n,e=r}else e={topLevelType:e,eventSystemFlags:t,nativeEvent:i,targetInst:n,ancestors:[]};try{if(t=Ei,i=e,de)t(i,void 0);else{de=!0;try{ce(t,i,void 0)}finally{de=!1,pe()}}}finally{e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,xi.length<10&&xi.push(e)}}function Ii(e,t,i){if(Ci)if(0<ut.length&&-1<bt.indexOf(e))e=yt(null,e,t,i),ut.push(e);else{var n=Oi(e,t,i);null===n?kt(e,i):-1<bt.indexOf(e)?(e=yt(n,e,t,i),ut.push(e)):function(e,t,i,n){switch(t){case"focus":return dt=wt(dt,e,t,i,n),!0;case"dragenter":return pt=wt(pt,e,t,i,n),!0;case"mouseover":return ht=wt(ht,e,t,i,n),!0;case"pointerover":var r=n.pointerId;return ft.set(r,wt(ft.get(r)||null,e,t,i,n)),!0;case"gotpointercapture":return r=n.pointerId,mt.set(r,wt(mt.get(r)||null,e,t,i,n)),!0}return!1}(n,e,t,i)||(kt(e,i),Ni(e,t,i,null))}}function Oi(e,t,i){var n=At(i);if(null!==(n=pn(n))){var r=it(n);if(null===r)n=null;else{var o=r.tag;if(13===o){if(null!==(n=nt(r)))return n;n=null}else if(3===o){if(r.stateNode.hydrate)return 3===r.tag?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null)}}return Ni(e,t,i,n),null}function Pi(e){if(!Z)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"==typeof t[e]),t}var Di=new("function"==typeof WeakMap?WeakMap:Map);function Li(e){var t=Di.get(e);return void 0===t&&(t=new Set,Di.set(e,t)),t}function Ri(e,t,i){if(!i.has(e)){switch(e){case"scroll":_i(t,"scroll",!0);break;case"focus":case"blur":_i(t,"focus",!0),_i(t,"blur",!0),i.add("blur"),i.add("focus");break;case"cancel":case"close":Pi(e)&&_i(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===tt.indexOf(e)&&Si(e,t)}i.add(e)}}var Mi={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Bi=["Webkit","ms","Moz","O"];function ji(e,t,i){return null==t||"boolean"==typeof t||""===t?"":i||"number"!=typeof t||0===t||Mi.hasOwnProperty(e)&&Mi[e]?(""+t).trim():t+"px"}function Ui(e,t){for(var i in e=e.style,t)if(t.hasOwnProperty(i)){var n=0===i.indexOf("--"),r=ji(i,t[i],n);"float"===i&&(i="cssFloat"),n?e.setProperty(i,r):e[i]=r}}Object.keys(Mi).forEach((function(e){Bi.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Mi[t]=Mi[e]}))}));var Fi=r({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Hi(e,t){if(t){if(Fi[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(s(62,""))}}function qi(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function zi(e,t){var i=Li(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=f[t];for(var n=0;n<t.length;n++)Ri(t[n],e,i)}function Gi(){}function $i(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Vi(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Wi(e,t){var i,n=Vi(e);for(e=0;n;){if(3===n.nodeType){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Vi(n)}}function Ki(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Ki(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function Ji(){for(var e=window,t=$i();t instanceof e.HTMLIFrameElement;){try{var i="string"==typeof t.contentWindow.location.href}catch(e){i=!1}if(!i)break;t=$i((e=t.contentWindow).document)}return t}function Yi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var Xi="$?",Qi="$!",Zi=null,en=null;function tn(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function nn(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var rn="function"==typeof setTimeout?setTimeout:void 0,on="function"==typeof clearTimeout?clearTimeout:void 0;function sn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function an(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||i===Qi||i===Xi){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var ln=Math.random().toString(36).slice(2),cn="__reactInternalInstance$"+ln,un="__reactEventHandlers$"+ln,dn="__reactContainere$"+ln;function pn(e){var t=e[cn];if(t)return t;for(var i=e.parentNode;i;){if(t=i[dn]||i[cn]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=an(e);null!==e;){if(i=e[cn])return i;e=an(e)}return t}i=(e=i).parentNode}return null}function hn(e){return!(e=e[cn]||e[dn])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function fn(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function mn(e){return e[un]||null}var gn=null,bn=null,vn=null;function yn(){if(vn)return vn;var e,t,i=bn,n=i.length,r="value"in gn?gn.value:gn.textContent,o=r.length;for(e=0;e<n&&i[e]===r[e];e++);var s=n-e;for(t=1;t<=s&&i[n-t]===r[o-t];t++);return vn=r.slice(e,1<t?1-t:void 0)}var kn=Bt.extend({data:null}),wn=Bt.extend({data:null}),xn=[9,13,27,32],En=Z&&"CompositionEvent"in window,Cn=null;Z&&"documentMode"in document&&(Cn=document.documentMode);var Sn=Z&&"TextEvent"in window&&!Cn,_n=Z&&(!En||Cn&&8<Cn&&11>=Cn),Tn=String.fromCharCode(32),An={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},Nn=!1;function In(e,t){switch(e){case"keyup":return-1!==xn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function On(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Pn=!1;var Dn={eventTypes:An,extractEvents:function(e,t,i,n){var r;if(En)e:{switch(e){case"compositionstart":var o=An.compositionStart;break e;case"compositionend":o=An.compositionEnd;break e;case"compositionupdate":o=An.compositionUpdate;break e}o=void 0}else Pn?In(e,i)&&(o=An.compositionEnd):"keydown"===e&&229===i.keyCode&&(o=An.compositionStart);return o?(_n&&"ko"!==i.locale&&(Pn||o!==An.compositionStart?o===An.compositionEnd&&Pn&&(r=yn()):(bn="value"in(gn=n)?gn.value:gn.textContent,Pn=!0)),o=kn.getPooled(o,t,i,n),(r||null!==(r=On(i)))&&(o.data=r),Lt(o),r=o):r=null,(e=Sn?function(e,t){switch(e){case"compositionend":return On(t);case"keypress":return 32!==t.which?null:(Nn=!0,Tn);case"textInput":return(e=t.data)===Tn&&Nn?null:e;default:return null}}(e,i):function(e,t){if(Pn)return"compositionend"===e||!En&&In(e,t)?(e=yn(),vn=bn=gn=null,Pn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return _n&&"ko"!==t.locale?null:t.data;default:return null}}(e,i))?((t=wn.getPooled(An.beforeInput,t,i,n)).data=e,Lt(t)):t=null,null===r?t:null===t?r:[r,t]}},Ln={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Rn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Ln[e.type]:"textarea"===t}var Mn={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function Bn(e,t,i){return(e=Bt.getPooled(Mn.change,e,t,i)).type="change",re(i),Lt(e),e}var jn=null,Un=null;function Fn(e){I(e)}function Hn(e){if(Se(fn(e)))return e}function qn(e,t){if("change"===e)return t}var zn=!1;function Gn(){jn&&(jn.detachEvent("onpropertychange",$n),Un=jn=null)}function $n(e){if("value"===e.propertyName&&Hn(Un))if(e=Bn(Un,e,At(e)),ue)I(e);else{ue=!0;try{se(Fn,e)}finally{ue=!1,pe()}}}function Vn(e,t,i){"focus"===e?(Gn(),Un=i,(jn=t).attachEvent("onpropertychange",$n)):"blur"===e&&Gn()}function Wn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Hn(Un)}function Kn(e,t){if("click"===e)return Hn(t)}function Jn(e,t){if("input"===e||"change"===e)return Hn(t)}Z&&(zn=Pi("input")&&(!document.documentMode||9<document.documentMode));var Yn,Xn={eventTypes:Mn,_isInputEventSupported:zn,extractEvents:function(e,t,i,n){var r=t?fn(t):window,o=r.nodeName&&r.nodeName.toLowerCase();if("select"===o||"input"===o&&"file"===r.type)var s=qn;else if(Rn(r))if(zn)s=Jn;else{s=Wn;var a=Vn}else(o=r.nodeName)&&"input"===o.toLowerCase()&&("checkbox"===r.type||"radio"===r.type)&&(s=Kn);if(s&&(s=s(e,t)))return Bn(s,i,n);a&&a(e,r,t),"blur"===e&&(e=r._wrapperState)&&e.controlled&&"number"===r.type&&Oe(r,"number",r.value)}},Qn={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Zn={eventTypes:Qn,extractEvents:function(e,t,i,n,r){var o="mouseover"===e||"pointerover"===e,s="mouseout"===e||"pointerout"===e;if(o&&0==(32&r)&&(i.relatedTarget||i.fromElement)||!s&&!o)return null;if(r=n.window===n?n:(r=n.ownerDocument)?r.defaultView||r.parentWindow:window,s?(s=t,null!==(t=(t=i.relatedTarget||i.toElement)?pn(t):null)&&(t!==(o=it(t))||5!==t.tag&&6!==t.tag)&&(t=null)):s=null,s===t)return null;if("mouseout"===e||"mouseover"===e)var a=ii,l=Qn.mouseLeave,c=Qn.mouseEnter,u="mouse";else"pointerout"!==e&&"pointerover"!==e||(a=ni,l=Qn.pointerLeave,c=Qn.pointerEnter,u="pointer");if(e=null==s?r:fn(s),r=null==t?r:fn(t),(l=a.getPooled(l,s,i,n)).type=u+"leave",l.target=e,l.relatedTarget=r,(n=a.getPooled(c,t,i,n)).type=u+"enter",n.target=r,n.relatedTarget=e,u=t,(a=s)&&u)e:{for(e=u,s=0,t=c=a;t;t=Nt(t))s++;for(t=0,r=e;r;r=Nt(r))t++;for(;0<s-t;)c=Nt(c),s--;for(;0<t-s;)e=Nt(e),t--;for(;s--;){if(c===e||c===e.alternate)break e;c=Nt(c),e=Nt(e)}c=null}else c=null;for(e=c,c=[];a&&a!==e&&(null===(s=a.alternate)||s!==e);)c.push(a),a=Nt(a);for(a=[];u&&u!==e&&(null===(s=u.alternate)||s!==e);)a.push(u),u=Nt(u);for(u=0;u<c.length;u++)Pt(c[u],"bubbled",l);for(u=a.length;0<u--;)Pt(a[u],"captured",n);return i===Yn?(Yn=null,[l]):(Yn=i,[l,n])}};var er="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},tr=Object.prototype.hasOwnProperty;function ir(e,t){if(er(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++)if(!tr.call(t,i[n])||!er(e[i[n]],t[i[n]]))return!1;return!0}var nr=Z&&"documentMode"in document&&11>=document.documentMode,rr={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},or=null,sr=null,ar=null,lr=!1;function cr(e,t){var i=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return lr||null==or||or!==$i(i)?null:(i="selectionStart"in(i=or)&&Yi(i)?{start:i.selectionStart,end:i.selectionEnd}:{anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},ar&&ir(ar,i)?null:(ar=i,(e=Bt.getPooled(rr.select,sr,e,t)).type="select",e.target=or,Lt(e),e))}var ur={eventTypes:rr,extractEvents:function(e,t,i,n){var r,o=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;if(!(r=!o)){e:{o=Li(o),r=f.onSelect;for(var s=0;s<r.length;s++)if(!o.has(r[s])){o=!1;break e}o=!0}r=!o}if(r)return null;switch(o=t?fn(t):window,e){case"focus":(Rn(o)||"true"===o.contentEditable)&&(or=o,sr=t,ar=null);break;case"blur":ar=sr=or=null;break;case"mousedown":lr=!0;break;case"contextmenu":case"mouseup":case"dragend":return lr=!1,cr(i,n);case"selectionchange":if(nr)break;case"keydown":case"keyup":return cr(i,n)}return null}};O.injectEventPluginOrder("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),x=mn,E=hn,C=fn,O.injectEventPluginsByName({SimpleEventPlugin:vi,EnterLeaveEventPlugin:Zn,ChangeEventPlugin:Xn,SelectEventPlugin:ur,BeforeInputEventPlugin:Dn}),new Set;var dr=[],pr=-1;function hr(e){0>pr||(e.current=dr[pr],dr[pr]=null,pr--)}function fr(e,t){dr[++pr]=e.current,e.current=t}var mr={},gr={current:mr},br={current:!1},vr=mr;function yr(e,t){var i=e.type.contextTypes;if(!i)return mr;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var r,o={};for(r in i)o[r]=t[r];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function kr(e){return null!=e.childContextTypes}function wr(e){hr(br),hr(gr)}function xr(e){hr(br),hr(gr)}function Er(e,t,i){if(gr.current!==mr)throw Error(s(168));fr(gr,t),fr(br,i)}function Cr(e,t,i){var n=e.stateNode;if(e=t.childContextTypes,"function"!=typeof n.getChildContext)return i;for(var o in n=n.getChildContext())if(!(o in e))throw Error(s(108,X(t)||"Unknown",o));return r({},i,{},n)}function Sr(e){var t=e.stateNode;return t=t&&t.__reactInternalMemoizedMergedChildContext||mr,vr=gr.current,fr(gr,t),fr(br,br.current),!0}function _r(e,t,i){var n=e.stateNode;if(!n)throw Error(s(169));i?(t=Cr(e,t,vr),n.__reactInternalMemoizedMergedChildContext=t,hr(br),hr(gr),fr(gr,t)):hr(br),fr(br,i)}var Tr=o.unstable_runWithPriority,Ar=o.unstable_scheduleCallback,Nr=o.unstable_cancelCallback,Ir=o.unstable_shouldYield,Or=o.unstable_requestPaint,Pr=o.unstable_now,Dr=o.unstable_getCurrentPriorityLevel,Lr=o.unstable_ImmediatePriority,Rr=o.unstable_UserBlockingPriority,Mr=o.unstable_NormalPriority,Br=o.unstable_LowPriority,jr=o.unstable_IdlePriority,Ur={},Fr=void 0!==Or?Or:function(){},Hr=null,qr=null,zr=!1,Gr=Pr(),$r=1e4>Gr?Pr:function(){return Pr()-Gr};function Vr(){switch(Dr()){case Lr:return 99;case Rr:return 98;case Mr:return 97;case Br:return 96;case jr:return 95;default:throw Error(s(332))}}function Wr(e){switch(e){case 99:return Lr;case 98:return Rr;case 97:return Mr;case 96:return Br;case 95:return jr;default:throw Error(s(332))}}function Kr(e,t){return e=Wr(e),Tr(e,t)}function Jr(e,t,i){return e=Wr(e),Ar(e,t,i)}function Yr(e){return null===Hr?(Hr=[e],qr=Ar(Lr,Qr)):Hr.push(e),Ur}function Xr(){if(null!==qr){var e=qr;qr=null,Nr(e)}Qr()}function Qr(){if(!zr&&null!==Hr){zr=!0;var e=0;try{var t=Hr;Kr(99,(function(){for(;e<t.length;e++){var i=t[e];do{i=i(!0)}while(null!==i)}})),Hr=null}catch(t){throw null!==Hr&&(Hr=Hr.slice(e+1)),Ar(Lr,Xr),t}finally{zr=!1}}}var Zr=3;function eo(e,t,i){return 1073741821-(1+((1073741821-e+t/10)/(i/=10)|0))*i}function to(e,t){if(e&&e.defaultProps)for(var i in t=r({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}var io={current:null},no=null,ro=null,oo=null;function so(){oo=ro=no=null}function ao(e,t){var i=e.type._context;fr(io,i._currentValue),i._currentValue=t}function lo(e){var t=io.current;hr(io),e.type._context._currentValue=t}function co(e,t){for(;null!==e;){var i=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==i&&i.childExpirationTime<t&&(i.childExpirationTime=t);else{if(!(null!==i&&i.childExpirationTime<t))break;i.childExpirationTime=t}e=e.return}}function uo(e,t){no=e,oo=ro=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(e.expirationTime>=t&&($s=!0),e.firstContext=null)}function po(e,t){if(oo!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(oo=e,t=1073741823),t={context:e,observedBits:t,next:null},null===ro){if(null===no)throw Error(s(308));ro=t,no.dependencies={expirationTime:0,firstContext:t,responders:null}}else ro=ro.next=t;return e._currentValue}var ho=!1;function fo(e){return{baseState:e,firstUpdate:null,lastUpdate:null,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function mo(e){return{baseState:e.baseState,firstUpdate:e.firstUpdate,lastUpdate:e.lastUpdate,firstCapturedUpdate:null,lastCapturedUpdate:null,firstEffect:null,lastEffect:null,firstCapturedEffect:null,lastCapturedEffect:null}}function go(e,t){return{expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null,nextEffect:null}}function bo(e,t){null===e.lastUpdate?e.firstUpdate=e.lastUpdate=t:(e.lastUpdate.next=t,e.lastUpdate=t)}function vo(e,t){var i=e.alternate;if(null===i){var n=e.updateQueue,r=null;null===n&&(n=e.updateQueue=fo(e.memoizedState))}else n=e.updateQueue,r=i.updateQueue,null===n?null===r?(n=e.updateQueue=fo(e.memoizedState),r=i.updateQueue=fo(i.memoizedState)):n=e.updateQueue=mo(r):null===r&&(r=i.updateQueue=mo(n));null===r||n===r?bo(n,t):null===n.lastUpdate||null===r.lastUpdate?(bo(n,t),bo(r,t)):(bo(n,t),r.lastUpdate=t)}function yo(e,t){var i=e.updateQueue;null===(i=null===i?e.updateQueue=fo(e.memoizedState):ko(e,i)).lastCapturedUpdate?i.firstCapturedUpdate=i.lastCapturedUpdate=t:(i.lastCapturedUpdate.next=t,i.lastCapturedUpdate=t)}function ko(e,t){var i=e.alternate;return null!==i&&t===i.updateQueue&&(t=e.updateQueue=mo(t)),t}function wo(e,t,i,n,o,s){switch(i.tag){case 1:return"function"==typeof(e=i.payload)?e.call(s,n,o):e;case 3:e.effectTag=-4097&e.effectTag|64;case 0:if(null==(o="function"==typeof(e=i.payload)?e.call(s,n,o):e))break;return r({},n,o);case 2:ho=!0}return n}function xo(e,t,i,n,r){ho=!1;for(var o=(t=ko(e,t)).baseState,s=null,a=0,l=t.firstUpdate,c=o;null!==l;){var u=l.expirationTime;u<r?(null===s&&(s=l,o=c),a<u&&(a=u)):(bl(u,l.suspenseConfig),c=wo(e,0,l,c,i,n),null!==l.callback&&(e.effectTag|=32,l.nextEffect=null,null===t.lastEffect?t.firstEffect=t.lastEffect=l:(t.lastEffect.nextEffect=l,t.lastEffect=l))),l=l.next}for(u=null,l=t.firstCapturedUpdate;null!==l;){var d=l.expirationTime;d<r?(null===u&&(u=l,null===s&&(o=c)),a<d&&(a=d)):(c=wo(e,0,l,c,i,n),null!==l.callback&&(e.effectTag|=32,l.nextEffect=null,null===t.lastCapturedEffect?t.firstCapturedEffect=t.lastCapturedEffect=l:(t.lastCapturedEffect.nextEffect=l,t.lastCapturedEffect=l))),l=l.next}null===s&&(t.lastUpdate=null),null===u?t.lastCapturedUpdate=null:e.effectTag|=32,null===s&&null===u&&(o=c),t.baseState=o,t.firstUpdate=s,t.firstCapturedUpdate=u,vl(a),e.expirationTime=a,e.memoizedState=c}function Eo(e,t,i){null!==t.firstCapturedUpdate&&(null!==t.lastUpdate&&(t.lastUpdate.next=t.firstCapturedUpdate,t.lastUpdate=t.lastCapturedUpdate),t.firstCapturedUpdate=t.lastCapturedUpdate=null),Co(t.firstEffect,i),t.firstEffect=t.lastEffect=null,Co(t.firstCapturedEffect,i),t.firstCapturedEffect=t.lastCapturedEffect=null}function Co(e,t){for(;null!==e;){var i=e.callback;if(null!==i){e.callback=null;var n=t;if("function"!=typeof i)throw Error(s(191,i));i.call(n)}e=e.nextEffect}}var So=D.ReactCurrentBatchConfig,_o=(new n.Component).refs;function To(e,t,i,n){i=null==(i=i(n,t=e.memoizedState))?t:r({},t,i),e.memoizedState=i,null!==(n=e.updateQueue)&&0===e.expirationTime&&(n.baseState=i)}var Ao={isMounted:function(e){return!!(e=e._reactInternalFiber)&&it(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternalFiber;var n=rl(),r=So.suspense;(r=go(n=ol(n,e,r),r)).payload=t,null!=i&&(r.callback=i),vo(e,r),sl(e,n)},enqueueReplaceState:function(e,t,i){e=e._reactInternalFiber;var n=rl(),r=So.suspense;(r=go(n=ol(n,e,r),r)).tag=1,r.payload=t,null!=i&&(r.callback=i),vo(e,r),sl(e,n)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var i=rl(),n=So.suspense;(n=go(i=ol(i,e,n),n)).tag=2,null!=t&&(n.callback=t),vo(e,n),sl(e,i)}};function No(e,t,i,n,r,o,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,o,s):!(t.prototype&&t.prototype.isPureReactComponent&&ir(i,n)&&ir(r,o))}function Io(e,t,i){var n=!1,r=mr,o=t.contextType;return"object"==typeof o&&null!==o?o=po(o):(r=kr(t)?vr:gr.current,o=(n=null!=(n=t.contextTypes))?yr(e,r):mr),t=new t(i,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Ao,e.stateNode=t,t._reactInternalFiber=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function Oo(e,t,i,n){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,n),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&Ao.enqueueReplaceState(t,t.state,null)}function Po(e,t,i,n){var r=e.stateNode;r.props=i,r.state=e.memoizedState,r.refs=_o;var o=t.contextType;"object"==typeof o&&null!==o?r.context=po(o):(o=kr(t)?vr:gr.current,r.context=yr(e,o)),null!==(o=e.updateQueue)&&(xo(e,o,i,r,n),r.state=e.memoizedState),"function"==typeof(o=t.getDerivedStateFromProps)&&(To(e,t,o,i),r.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof r.getSnapshotBeforeUpdate||"function"!=typeof r.UNSAFE_componentWillMount&&"function"!=typeof r.componentWillMount||(t=r.state,"function"==typeof r.componentWillMount&&r.componentWillMount(),"function"==typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Ao.enqueueReplaceState(r,r.state,null),null!==(o=e.updateQueue)&&(xo(e,o,i,r,n),r.state=e.memoizedState)),"function"==typeof r.componentDidMount&&(e.effectTag|=4)}var Do=Array.isArray;function Lo(e,t,i){if(null!==(e=i.ref)&&"function"!=typeof e&&"object"!=typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(s(309));var n=i.stateNode}if(!n)throw Error(s(147,e));var r=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===r?t.ref:((t=function(e){var t=n.refs;t===_o&&(t=n.refs={}),null===e?delete t[r]:t[r]=e})._stringRef=r,t)}if("string"!=typeof e)throw Error(s(284));if(!i._owner)throw Error(s(290,e))}return e}function Ro(e,t){if("textarea"!==e.type)throw Error(s(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function Mo(e){function t(t,i){if(e){var n=t.lastEffect;null!==n?(n.nextEffect=i,t.lastEffect=i):t.firstEffect=t.lastEffect=i,i.nextEffect=null,i.effectTag=8}}function i(i,n){if(!e)return null;for(;null!==n;)t(i,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t,i){return(e=jl(e,t)).index=0,e.sibling=null,e}function o(t,i,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<i?(t.effectTag=2,i):n:(t.effectTag=2,i):i}function a(t){return e&&null===t.alternate&&(t.effectTag=2),t}function l(e,t,i,n){return null===t||6!==t.tag?((t=Hl(i,e.mode,n)).return=e,t):((t=r(t,i)).return=e,t)}function c(e,t,i,n){return null!==t&&t.elementType===i.type?((n=r(t,i.props)).ref=Lo(e,t,i),n.return=e,n):((n=Ul(i.type,i.key,i.props,null,e.mode,n)).ref=Lo(e,t,i),n.return=e,n)}function u(e,t,i,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?((t=ql(i,e.mode,n)).return=e,t):((t=r(t,i.children||[])).return=e,t)}function d(e,t,i,n,o){return null===t||7!==t.tag?((t=Fl(i,e.mode,n,o)).return=e,t):((t=r(t,i)).return=e,t)}function p(e,t,i){if("string"==typeof t||"number"==typeof t)return(t=Hl(""+t,e.mode,i)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case M:return(i=Ul(t.type,t.key,t.props,null,e.mode,i)).ref=Lo(e,null,t),i.return=e,i;case B:return(t=ql(t,e.mode,i)).return=e,t}if(Do(t)||Y(t))return(t=Fl(t,e.mode,i,null)).return=e,t;Ro(e,t)}return null}function h(e,t,i,n){var r=null!==t?t.key:null;if("string"==typeof i||"number"==typeof i)return null!==r?null:l(e,t,""+i,n);if("object"==typeof i&&null!==i){switch(i.$$typeof){case M:return i.key===r?i.type===j?d(e,t,i.props.children,n,r):c(e,t,i,n):null;case B:return i.key===r?u(e,t,i,n):null}if(Do(i)||Y(i))return null!==r?null:d(e,t,i,n,null);Ro(e,i)}return null}function f(e,t,i,n,r){if("string"==typeof n||"number"==typeof n)return l(t,e=e.get(i)||null,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case M:return e=e.get(null===n.key?i:n.key)||null,n.type===j?d(t,e,n.props.children,r,n.key):c(t,e,n,r);case B:return u(t,e=e.get(null===n.key?i:n.key)||null,n,r)}if(Do(n)||Y(n))return d(t,e=e.get(i)||null,n,r,null);Ro(t,n)}return null}function m(r,s,a,l){for(var c=null,u=null,d=s,m=s=0,g=null;null!==d&&m<a.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var b=h(r,d,a[m],l);if(null===b){null===d&&(d=g);break}e&&d&&null===b.alternate&&t(r,d),s=o(b,s,m),null===u?c=b:u.sibling=b,u=b,d=g}if(m===a.length)return i(r,d),c;if(null===d){for(;m<a.length;m++)null!==(d=p(r,a[m],l))&&(s=o(d,s,m),null===u?c=d:u.sibling=d,u=d);return c}for(d=n(r,d);m<a.length;m++)null!==(g=f(d,r,m,a[m],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),s=o(g,s,m),null===u?c=g:u.sibling=g,u=g);return e&&d.forEach((function(e){return t(r,e)})),c}function g(r,a,l,c){var u=Y(l);if("function"!=typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var d=u=null,m=a,g=a=0,b=null,v=l.next();null!==m&&!v.done;g++,v=l.next()){m.index>g?(b=m,m=null):b=m.sibling;var y=h(r,m,v.value,c);if(null===y){null===m&&(m=b);break}e&&m&&null===y.alternate&&t(r,m),a=o(y,a,g),null===d?u=y:d.sibling=y,d=y,m=b}if(v.done)return i(r,m),u;if(null===m){for(;!v.done;g++,v=l.next())null!==(v=p(r,v.value,c))&&(a=o(v,a,g),null===d?u=v:d.sibling=v,d=v);return u}for(m=n(r,m);!v.done;g++,v=l.next())null!==(v=f(m,r,g,v.value,c))&&(e&&null!==v.alternate&&m.delete(null===v.key?g:v.key),a=o(v,a,g),null===d?u=v:d.sibling=v,d=v);return e&&m.forEach((function(e){return t(r,e)})),u}return function(e,n,o,l){var c="object"==typeof o&&null!==o&&o.type===j&&null===o.key;c&&(o=o.props.children);var u="object"==typeof o&&null!==o;if(u)switch(o.$$typeof){case M:e:{for(u=o.key,c=n;null!==c;){if(c.key===u){if(7===c.tag?o.type===j:c.elementType===o.type){i(e,c.sibling),(n=r(c,o.type===j?o.props.children:o.props)).ref=Lo(e,c,o),n.return=e,e=n;break e}i(e,c);break}t(e,c),c=c.sibling}o.type===j?((n=Fl(o.props.children,e.mode,l,o.key)).return=e,e=n):((l=Ul(o.type,o.key,o.props,null,e.mode,l)).ref=Lo(e,n,o),l.return=e,e=l)}return a(e);case B:e:{for(c=o.key;null!==n;){if(n.key===c){if(4===n.tag&&n.stateNode.containerInfo===o.containerInfo&&n.stateNode.implementation===o.implementation){i(e,n.sibling),(n=r(n,o.children||[])).return=e,e=n;break e}i(e,n);break}t(e,n),n=n.sibling}(n=ql(o,e.mode,l)).return=e,e=n}return a(e)}if("string"==typeof o||"number"==typeof o)return o=""+o,null!==n&&6===n.tag?(i(e,n.sibling),(n=r(n,o)).return=e,e=n):(i(e,n),(n=Hl(o,e.mode,l)).return=e,e=n),a(e);if(Do(o))return m(e,n,o,l);if(Y(o))return g(e,n,o,l);if(u&&Ro(e,o),void 0===o&&!c)switch(e.tag){case 1:case 0:throw e=e.type,Error(s(152,e.displayName||e.name||"Component"))}return i(e,n)}}var Bo=Mo(!0),jo=Mo(!1),Uo={},Fo={current:Uo},Ho={current:Uo},qo={current:Uo};function zo(e){if(e===Uo)throw Error(s(174));return e}function Go(e,t){fr(qo,t),fr(Ho,e),fr(Fo,Uo);var i=t.nodeType;switch(i){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:He(null,"");break;default:t=He(t=(i=8===i?t.parentNode:t).namespaceURI||null,i=i.tagName)}hr(Fo),fr(Fo,t)}function $o(e){hr(Fo),hr(Ho),hr(qo)}function Vo(e){zo(qo.current);var t=zo(Fo.current),i=He(t,e.type);t!==i&&(fr(Ho,e),fr(Fo,i))}function Wo(e){Ho.current===e&&(hr(Fo),hr(Ho))}var Ko={current:0};function Jo(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||i.data===Xi||i.data===Qi))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.effectTag))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function Yo(e,t){return{responder:e,props:t}}var Xo=D.ReactCurrentDispatcher,Qo=D.ReactCurrentBatchConfig,Zo=0,es=null,ts=null,is=null,ns=null,rs=null,os=null,ss=0,as=null,ls=0,cs=!1,us=null,ds=0;function ps(){throw Error(s(321))}function hs(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!er(e[i],t[i]))return!1;return!0}function fs(e,t,i,n,r,o){if(Zo=o,es=t,is=null!==e?e.memoizedState:null,Xo.current=null===is?Ds:Ls,t=i(n,r),cs){do{cs=!1,ds+=1,is=null!==e?e.memoizedState:null,os=ns,as=rs=ts=null,Xo.current=Ls,t=i(n,r)}while(cs);us=null,ds=0}if(Xo.current=Ps,(e=es).memoizedState=ns,e.expirationTime=ss,e.updateQueue=as,e.effectTag|=ls,e=null!==ts&&null!==ts.next,Zo=0,os=rs=ns=is=ts=es=null,ss=0,as=null,ls=0,e)throw Error(s(300));return t}function ms(){Xo.current=Ps,Zo=0,os=rs=ns=is=ts=es=null,ss=0,as=null,ls=0,cs=!1,us=null,ds=0}function gs(){var e={memoizedState:null,baseState:null,queue:null,baseUpdate:null,next:null};return null===rs?ns=rs=e:rs=rs.next=e,rs}function bs(){if(null!==os)os=(rs=os).next,is=null!==(ts=is)?ts.next:null;else{if(null===is)throw Error(s(310));var e={memoizedState:(ts=is).memoizedState,baseState:ts.baseState,queue:ts.queue,baseUpdate:ts.baseUpdate,next:null};rs=null===rs?ns=e:rs.next=e,is=ts.next}return rs}function vs(e,t){return"function"==typeof t?t(e):t}function ys(e){var t=bs(),i=t.queue;if(null===i)throw Error(s(311));if(i.lastRenderedReducer=e,0<ds){var n=i.dispatch;if(null!==us){var r=us.get(i);if(void 0!==r){us.delete(i);var o=t.memoizedState;do{o=e(o,r.action),r=r.next}while(null!==r);return er(o,t.memoizedState)||($s=!0),t.memoizedState=o,t.baseUpdate===i.last&&(t.baseState=o),i.lastRenderedState=o,[o,n]}}return[t.memoizedState,n]}n=i.last;var a=t.baseUpdate;if(o=t.baseState,null!==a?(null!==n&&(n.next=null),n=a.next):n=null!==n?n.next:null,null!==n){var l=r=null,c=n,u=!1;do{var d=c.expirationTime;d<Zo?(u||(u=!0,l=a,r=o),d>ss&&vl(ss=d)):(bl(d,c.suspenseConfig),o=c.eagerReducer===e?c.eagerState:e(o,c.action)),a=c,c=c.next}while(null!==c&&c!==n);u||(l=a,r=o),er(o,t.memoizedState)||($s=!0),t.memoizedState=o,t.baseUpdate=l,t.baseState=r,i.lastRenderedState=o}return[t.memoizedState,i.dispatch]}function ks(e){var t=gs();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={last:null,dispatch:null,lastRenderedReducer:vs,lastRenderedState:e}).dispatch=Os.bind(null,es,e),[t.memoizedState,e]}function ws(e){return ys(vs)}function xs(e,t,i,n){return e={tag:e,create:t,destroy:i,deps:n,next:null},null===as?(as={lastEffect:null}).lastEffect=e.next=e:null===(t=as.lastEffect)?as.lastEffect=e.next=e:(i=t.next,t.next=e,e.next=i,as.lastEffect=e),e}function Es(e,t,i,n){var r=gs();ls|=e,r.memoizedState=xs(t,i,void 0,void 0===n?null:n)}function Cs(e,t,i,n){var r=bs();n=void 0===n?null:n;var o=void 0;if(null!==ts){var s=ts.memoizedState;if(o=s.destroy,null!==n&&hs(n,s.deps))return void xs(0,i,o,n)}ls|=e,r.memoizedState=xs(t,i,o,n)}function Ss(e,t){return Es(516,192,e,t)}function _s(e,t){return Cs(516,192,e,t)}function Ts(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function As(){}function Ns(e,t){return gs().memoizedState=[e,void 0===t?null:t],e}function Is(e,t){var i=bs();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&hs(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function Os(e,t,i){if(!(25>ds))throw Error(s(301));var n=e.alternate;if(e===es||null!==n&&n===es)if(cs=!0,e={expirationTime:Zo,suspenseConfig:null,action:i,eagerReducer:null,eagerState:null,next:null},null===us&&(us=new Map),void 0===(i=us.get(t)))us.set(t,e);else{for(t=i;null!==t.next;)t=t.next;t.next=e}else{var r=rl(),o=So.suspense;o={expirationTime:r=ol(r,e,o),suspenseConfig:o,action:i,eagerReducer:null,eagerState:null,next:null};var a=t.last;if(null===a)o.next=o;else{var l=a.next;null!==l&&(o.next=l),a.next=o}if(t.last=o,0===e.expirationTime&&(null===n||0===n.expirationTime)&&null!==(n=t.lastRenderedReducer))try{var c=t.lastRenderedState,u=n(c,i);if(o.eagerReducer=n,o.eagerState=u,er(u,c))return}catch(e){}sl(e,r)}}var Ps={readContext:po,useCallback:ps,useContext:ps,useEffect:ps,useImperativeHandle:ps,useLayoutEffect:ps,useMemo:ps,useReducer:ps,useRef:ps,useState:ps,useDebugValue:ps,useResponder:ps,useDeferredValue:ps,useTransition:ps},Ds={readContext:po,useCallback:Ns,useContext:po,useEffect:Ss,useImperativeHandle:function(e,t,i){return i=null!=i?i.concat([e]):null,Es(4,36,Ts.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Es(4,36,e,t)},useMemo:function(e,t){var i=gs();return t=void 0===t?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var n=gs();return t=void 0!==i?i(t):t,n.memoizedState=n.baseState=t,e=(e=n.queue={last:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Os.bind(null,es,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},gs().memoizedState=e},useState:ks,useDebugValue:As,useResponder:Yo,useDeferredValue:function(e,t){var i=ks(e),n=i[0],r=i[1];return Ss((function(){o.unstable_next((function(){var i=Qo.suspense;Qo.suspense=void 0===t?null:t;try{r(e)}finally{Qo.suspense=i}}))}),[e,t]),n},useTransition:function(e){var t=ks(!1),i=t[0],n=t[1];return[Ns((function(t){n(!0),o.unstable_next((function(){var i=Qo.suspense;Qo.suspense=void 0===e?null:e;try{n(!1),t()}finally{Qo.suspense=i}}))}),[e,i]),i]}},Ls={readContext:po,useCallback:Is,useContext:po,useEffect:_s,useImperativeHandle:function(e,t,i){return i=null!=i?i.concat([e]):null,Cs(4,36,Ts.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Cs(4,36,e,t)},useMemo:function(e,t){var i=bs();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&hs(t,n[1])?n[0]:(e=e(),i.memoizedState=[e,t],e)},useReducer:ys,useRef:function(){return bs().memoizedState},useState:ws,useDebugValue:As,useResponder:Yo,useDeferredValue:function(e,t){var i=ws(),n=i[0],r=i[1];return _s((function(){o.unstable_next((function(){var i=Qo.suspense;Qo.suspense=void 0===t?null:t;try{r(e)}finally{Qo.suspense=i}}))}),[e,t]),n},useTransition:function(e){var t=ws(),i=t[0],n=t[1];return[Is((function(t){n(!0),o.unstable_next((function(){var i=Qo.suspense;Qo.suspense=void 0===e?null:e;try{n(!1),t()}finally{Qo.suspense=i}}))}),[e,i]),i]}},Rs=null,Ms=null,Bs=!1;function js(e,t){var i=Ml(5,null,null,0);i.elementType="DELETED",i.type="DELETED",i.stateNode=t,i.return=e,i.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=i,e.lastEffect=i):e.firstEffect=e.lastEffect=i}function Us(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function Fs(e){if(Bs){var t=Ms;if(t){var i=t;if(!Us(e,t)){if(!(t=sn(i.nextSibling))||!Us(e,t))return e.effectTag=-1025&e.effectTag|2,Bs=!1,void(Rs=e);js(Rs,i)}Rs=e,Ms=sn(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,Bs=!1,Rs=e}}function Hs(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Rs=e}function qs(e){if(e!==Rs)return!1;if(!Bs)return Hs(e),Bs=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!nn(t,e.memoizedProps))for(t=Ms;t;)js(e,t),t=sn(t.nextSibling);if(Hs(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){Ms=sn(e.nextSibling);break e}t--}else"$"!==i&&i!==Qi&&i!==Xi||t++}e=e.nextSibling}Ms=null}}else Ms=Rs?sn(e.stateNode.nextSibling):null;return!0}function zs(){Ms=Rs=null,Bs=!1}var Gs=D.ReactCurrentOwner,$s=!1;function Vs(e,t,i,n){t.child=null===e?jo(t,null,i,n):Bo(t,e.child,i,n)}function Ws(e,t,i,n,r){i=i.render;var o=t.ref;return uo(t,r),n=fs(e,t,i,n,o,r),null===e||$s?(t.effectTag|=1,Vs(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=r&&(e.expirationTime=0),ca(e,t,r))}function Ks(e,t,i,n,r,o){if(null===e){var s=i.type;return"function"!=typeof s||Bl(s)||void 0!==s.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=Ul(i.type,null,n,null,t.mode,o)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Js(e,t,s,n,r,o))}return s=e.child,r<o&&(r=s.memoizedProps,(i=null!==(i=i.compare)?i:ir)(r,n)&&e.ref===t.ref)?ca(e,t,o):(t.effectTag|=1,(e=jl(s,n)).ref=t.ref,e.return=t,t.child=e)}function Js(e,t,i,n,r,o){return null!==e&&ir(e.memoizedProps,n)&&e.ref===t.ref&&($s=!1,r<o)?ca(e,t,o):Xs(e,t,i,n,o)}function Ys(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.effectTag|=128)}function Xs(e,t,i,n,r){var o=kr(i)?vr:gr.current;return o=yr(t,o),uo(t,r),i=fs(e,t,i,n,o,r),null===e||$s?(t.effectTag|=1,Vs(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=r&&(e.expirationTime=0),ca(e,t,r))}function Qs(e,t,i,n,r){if(kr(i)){var o=!0;Sr(t)}else o=!1;if(uo(t,r),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),Io(t,i,n),Po(t,i,n,r),n=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=i.contextType;c="object"==typeof c&&null!==c?po(c):yr(t,c=kr(i)?vr:gr.current);var u=i.getDerivedStateFromProps,d="function"==typeof u||"function"==typeof s.getSnapshotBeforeUpdate;d||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==n||l!==c)&&Oo(t,s,n,c),ho=!1;var p=t.memoizedState;l=s.state=p;var h=t.updateQueue;null!==h&&(xo(t,h,n,s,r),l=t.memoizedState),a!==n||p!==l||br.current||ho?("function"==typeof u&&(To(t,i,u,n),l=t.memoizedState),(a=ho||No(t,i,a,n,p,l,c))?(d||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||("function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"==typeof s.componentDidMount&&(t.effectTag|=4)):("function"==typeof s.componentDidMount&&(t.effectTag|=4),t.memoizedProps=n,t.memoizedState=l),s.props=n,s.state=l,s.context=c,n=a):("function"==typeof s.componentDidMount&&(t.effectTag|=4),n=!1)}else s=t.stateNode,a=t.memoizedProps,s.props=t.type===t.elementType?a:to(t.type,a),l=s.context,c="object"==typeof(c=i.contextType)&&null!==c?po(c):yr(t,c=kr(i)?vr:gr.current),(d="function"==typeof(u=i.getDerivedStateFromProps)||"function"==typeof s.getSnapshotBeforeUpdate)||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||(a!==n||l!==c)&&Oo(t,s,n,c),ho=!1,l=t.memoizedState,p=s.state=l,null!==(h=t.updateQueue)&&(xo(t,h,n,s,r),p=t.memoizedState),a!==n||l!==p||br.current||ho?("function"==typeof u&&(To(t,i,u,n),p=t.memoizedState),(u=ho||No(t,i,a,n,l,p,c))?(d||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(n,p,c),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(n,p,c)),"function"==typeof s.componentDidUpdate&&(t.effectTag|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=256),t.memoizedProps=n,t.memoizedState=p),s.props=n,s.state=p,s.context=c,n=u):("function"!=typeof s.componentDidUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=4),"function"!=typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&l===e.memoizedState||(t.effectTag|=256),n=!1);return Zs(e,t,i,n,o,r)}function Zs(e,t,i,n,r,o){Ys(e,t);var s=0!=(64&t.effectTag);if(!n&&!s)return r&&_r(t,i,!1),ca(e,t,o);n=t.stateNode,Gs.current=t;var a=s&&"function"!=typeof i.getDerivedStateFromError?null:n.render();return t.effectTag|=1,null!==e&&s?(t.child=Bo(t,e.child,null,o),t.child=Bo(t,null,a,o)):Vs(e,t,a,o),t.memoizedState=n.state,r&&_r(t,i,!0),t.child}function ea(e){var t=e.stateNode;t.pendingContext?Er(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Er(0,t.context,!1),Go(e,t.containerInfo)}var ta,ia,na,ra={dehydrated:null,retryTime:0};function oa(e,t,i){var n,r=t.mode,o=t.pendingProps,s=Ko.current,a=!1;if((n=0!=(64&t.effectTag))||(n=0!=(2&s)&&(null===e||null!==e.memoizedState)),n?(a=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===o.fallback||!0===o.unstable_avoidThisFallback||(s|=1),fr(Ko,1&s),null===e){if(void 0!==o.fallback&&Fs(t),a){if(a=o.fallback,(o=Fl(null,r,0,null)).return=t,0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(i=Fl(a,r,i,null)).return=t,o.sibling=i,t.memoizedState=ra,t.child=o,i}return r=o.children,t.memoizedState=null,t.child=jo(t,null,r,i)}if(null!==e.memoizedState){if(r=(e=e.child).sibling,a){if(o=o.fallback,(i=jl(e,e.pendingProps)).return=t,0==(2&t.mode)&&(a=null!==t.memoizedState?t.child.child:t.child)!==e.child)for(i.child=a;null!==a;)a.return=i,a=a.sibling;return(r=jl(r,o,r.expirationTime)).return=t,i.sibling=r,i.childExpirationTime=0,t.memoizedState=ra,t.child=i,r}return i=Bo(t,e.child,o.children,i),t.memoizedState=null,t.child=i}if(e=e.child,a){if(a=o.fallback,(o=Fl(null,r,0,null)).return=t,o.child=e,null!==e&&(e.return=o),0==(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,o.child=e;null!==e;)e.return=o,e=e.sibling;return(i=Fl(a,r,i,null)).return=t,o.sibling=i,i.effectTag|=2,o.childExpirationTime=0,t.memoizedState=ra,t.child=o,i}return t.memoizedState=null,t.child=Bo(t,e,o.children,i)}function sa(e,t){e.expirationTime<t&&(e.expirationTime=t);var i=e.alternate;null!==i&&i.expirationTime<t&&(i.expirationTime=t),co(e.return,t)}function aa(e,t,i,n,r,o){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,last:n,tail:i,tailExpiration:0,tailMode:r,lastEffect:o}:(s.isBackwards=t,s.rendering=null,s.last=n,s.tail=i,s.tailExpiration=0,s.tailMode=r,s.lastEffect=o)}function la(e,t,i){var n=t.pendingProps,r=n.revealOrder,o=n.tail;if(Vs(e,t,n.children,i),0!=(2&(n=Ko.current)))n=1&n|2,t.effectTag|=64;else{if(null!==e&&0!=(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&sa(e,i);else if(19===e.tag)sa(e,i);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(fr(Ko,n),0==(2&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(i=t.child,r=null;null!==i;)null!==(e=i.alternate)&&null===Jo(e)&&(r=i),i=i.sibling;null===(i=r)?(r=t.child,t.child=null):(r=i.sibling,i.sibling=null),aa(t,!1,r,i,o,t.lastEffect);break;case"backwards":for(i=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===Jo(e)){t.child=r;break}e=r.sibling,r.sibling=i,i=r,r=e}aa(t,!0,i,null,o,t.lastEffect);break;case"together":aa(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ca(e,t,i){null!==e&&(t.dependencies=e.dependencies);var n=t.expirationTime;if(0!==n&&vl(n),t.childExpirationTime<i)return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(i=jl(e=t.child,e.pendingProps,e.expirationTime),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=jl(e,e.pendingProps,e.expirationTime)).return=t;i.sibling=null}return t.child}function ua(e){e.effectTag|=4}function da(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var n=null;null!==i;)null!==i.alternate&&(n=i),i=i.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function pa(e){switch(e.tag){case 1:kr(e.type)&&wr();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if($o(),xr(),0!=(64&(t=e.effectTag)))throw Error(s(285));return e.effectTag=-4097&t|64,e;case 5:return Wo(e),null;case 13:return hr(Ko),4096&(t=e.effectTag)?(e.effectTag=-4097&t|64,e):null;case 19:return hr(Ko),null;case 4:return $o(),null;case 10:return lo(e),null;default:return null}}function ha(e,t){return{value:e,source:t,stack:Q(t)}}ta=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},ia=function(e,t,i,n,o){var s=e.memoizedProps;if(s!==n){var a,l,c=t.stateNode;switch(zo(Fo.current),e=null,i){case"input":s=_e(c,s),n=_e(c,n),e=[];break;case"option":s=Pe(c,s),n=Pe(c,n),e=[];break;case"select":s=r({},s,{value:void 0}),n=r({},n,{value:void 0}),e=[];break;case"textarea":s=Le(c,s),n=Le(c,n),e=[];break;default:"function"!=typeof s.onClick&&"function"==typeof n.onClick&&(c.onclick=Gi)}for(a in Hi(i,n),i=null,s)if(!n.hasOwnProperty(a)&&s.hasOwnProperty(a)&&null!=s[a])if("style"===a)for(l in c=s[a])c.hasOwnProperty(l)&&(i||(i={}),i[l]="");else"dangerouslySetInnerHTML"!==a&&"children"!==a&&"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(h.hasOwnProperty(a)?e||(e=[]):(e=e||[]).push(a,null));for(a in n){var u=n[a];if(c=null!=s?s[a]:void 0,n.hasOwnProperty(a)&&u!==c&&(null!=u||null!=c))if("style"===a)if(c){for(l in c)!c.hasOwnProperty(l)||u&&u.hasOwnProperty(l)||(i||(i={}),i[l]="");for(l in u)u.hasOwnProperty(l)&&c[l]!==u[l]&&(i||(i={}),i[l]=u[l])}else i||(e||(e=[]),e.push(a,i)),i=u;else"dangerouslySetInnerHTML"===a?(u=u?u.__html:void 0,c=c?c.__html:void 0,null!=u&&c!==u&&(e=e||[]).push(a,""+u)):"children"===a?c===u||"string"!=typeof u&&"number"!=typeof u||(e=e||[]).push(a,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&(h.hasOwnProperty(a)?(null!=u&&zi(o,a),e||c===u||(e=[])):(e=e||[]).push(a,u))}i&&(e=e||[]).push("style",i),o=e,(t.updateQueue=o)&&ua(t)}},na=function(e,t,i,n){i!==n&&ua(t)};var fa="function"==typeof WeakSet?WeakSet:Set;function ma(e,t){var i=t.source,n=t.stack;null===n&&null!==i&&(n=Q(i)),null!==i&&X(i.type),t=t.value,null!==e&&1===e.tag&&X(e.type);try{console.error(t)}catch(e){setTimeout((function(){throw e}))}}function ga(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){Il(e,t)}else t.current=null}function ba(e,t){switch(t.tag){case 0:case 11:case 15:va(2,0,t);break;case 1:if(256&t.effectTag&&null!==e){var i=e.memoizedProps,n=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?i:to(t.type,i),n),e.__reactInternalSnapshotBeforeUpdate=t}break;case 3:case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}function va(e,t,i){if(null!==(i=null!==(i=i.updateQueue)?i.lastEffect:null)){var n=i=i.next;do{if(0!=(n.tag&e)){var r=n.destroy;n.destroy=void 0,void 0!==r&&r()}0!=(n.tag&t)&&(r=n.create,n.destroy=r()),n=n.next}while(n!==i)}}function ya(e,t,i){switch("function"==typeof Ll&&Ll(t),t.tag){case 0:case 11:case 14:case 15:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e.next;Kr(97<i?97:i,(function(){var e=n;do{var i=e.destroy;if(void 0!==i){var r=t;try{i()}catch(e){Il(r,e)}}e=e.next}while(e!==n)}))}break;case 1:ga(t),"function"==typeof(i=t.stateNode).componentWillUnmount&&function(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(t){Il(e,t)}}(t,i);break;case 5:ga(t);break;case 4:Ea(e,t,i)}}function ka(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,e.memoizedProps=null,null!==t&&ka(t)}function wa(e){return 5===e.tag||3===e.tag||4===e.tag}function xa(e){e:{for(var t=e.return;null!==t;){if(wa(t)){var i=t;break e}t=t.return}throw Error(s(160))}switch(t=i.stateNode,i.tag){case 5:var n=!1;break;case 3:case 4:t=t.containerInfo,n=!0;break;default:throw Error(s(161))}16&i.effectTag&&($e(t,""),i.effectTag&=-17);e:t:for(i=e;;){for(;null===i.sibling;){if(null===i.return||wa(i.return)){i=null;break e}i=i.return}for(i.sibling.return=i.return,i=i.sibling;5!==i.tag&&6!==i.tag&&18!==i.tag;){if(2&i.effectTag)continue t;if(null===i.child||4===i.tag)continue t;i.child.return=i,i=i.child}if(!(2&i.effectTag)){i=i.stateNode;break e}}for(var r=e;;){var o=5===r.tag||6===r.tag;if(o){var a=o?r.stateNode:r.stateNode.instance;if(i)if(n){var l=a;a=i,8===(o=t).nodeType?o.parentNode.insertBefore(l,a):o.insertBefore(l,a)}else t.insertBefore(a,i);else n?(8===(l=t).nodeType?(o=l.parentNode).insertBefore(a,l):(o=l).appendChild(a),null!=(l=l._reactRootContainer)||null!==o.onclick||(o.onclick=Gi)):t.appendChild(a)}else if(4!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)break;for(;null===r.sibling;){if(null===r.return||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}}function Ea(e,t,i){for(var n,r,o=t,a=!1;;){if(!a){a=o.return;e:for(;;){if(null===a)throw Error(s(160));switch(n=a.stateNode,a.tag){case 5:r=!1;break e;case 3:case 4:n=n.containerInfo,r=!0;break e}a=a.return}a=!0}if(5===o.tag||6===o.tag){e:for(var l=e,c=o,u=i,d=c;;)if(ya(l,d,u),null!==d.child&&4!==d.tag)d.child.return=d,d=d.child;else{if(d===c)break;for(;null===d.sibling;){if(null===d.return||d.return===c)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}r?(l=n,c=o.stateNode,8===l.nodeType?l.parentNode.removeChild(c):l.removeChild(c)):n.removeChild(o.stateNode)}else if(4===o.tag){if(null!==o.child){n=o.stateNode.containerInfo,r=!0,o.child.return=o,o=o.child;continue}}else if(ya(e,o,i),null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;4===(o=o.return).tag&&(a=!1)}o.sibling.return=o.return,o=o.sibling}}function Ca(e,t){switch(t.tag){case 0:case 11:case 14:case 15:va(4,8,t);break;case 1:break;case 5:var i=t.stateNode;if(null!=i){var n=t.memoizedProps,r=null!==e?e.memoizedProps:n;e=t.type;var o=t.updateQueue;if(t.updateQueue=null,null!==o){for(i[un]=n,"input"===e&&"radio"===n.type&&null!=n.name&&Ae(i,n),qi(e,r),t=qi(e,n),r=0;r<o.length;r+=2){var a=o[r],l=o[r+1];"style"===a?Ui(i,l):"dangerouslySetInnerHTML"===a?Ge(i,l):"children"===a?$e(i,l):xe(i,a,l,t)}switch(e){case"input":Ne(i,n);break;case"textarea":Me(i,n);break;case"select":t=i._wrapperState.wasMultiple,i._wrapperState.wasMultiple=!!n.multiple,null!=(e=n.value)?De(i,!!n.multiple,e,!1):t!==!!n.multiple&&(null!=n.defaultValue?De(i,!!n.multiple,n.defaultValue,!0):De(i,!!n.multiple,n.multiple?[]:"",!1))}}}break;case 6:if(null===t.stateNode)throw Error(s(162));t.stateNode.nodeValue=t.memoizedProps;break;case 3:(t=t.stateNode).hydrate&&(t.hydrate=!1,Tt(t.containerInfo));break;case 12:break;case 13:if(i=t,null===t.memoizedState?n=!1:(n=!0,i=t.child,Va=$r()),null!==i)e:for(e=i;;){if(5===e.tag)o=e.stateNode,n?"function"==typeof(o=o.style).setProperty?o.setProperty("display","none","important"):o.display="none":(o=e.stateNode,r=null!=(r=e.memoizedProps.style)&&r.hasOwnProperty("display")?r.display:null,o.style.display=ji("display",r));else if(6===e.tag)e.stateNode.nodeValue=n?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){(o=e.child.sibling).return=e,e=o;continue}if(null!==e.child){e.child.return=e,e=e.child;continue}}if(e===i)break e;for(;null===e.sibling;){if(null===e.return||e.return===i)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}Sa(t);break;case 19:Sa(t);break;case 17:case 20:case 21:break;default:throw Error(s(163))}}function Sa(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var i=e.stateNode;null===i&&(i=e.stateNode=new fa),t.forEach((function(t){var n=Pl.bind(null,e,t);i.has(t)||(i.add(t),t.then(n,n))}))}}var _a="function"==typeof WeakMap?WeakMap:Map;function Ta(e,t,i){(i=go(i,null)).tag=3,i.payload={element:null};var n=t.value;return i.callback=function(){Ka||(Ka=!0,Ja=n),ma(e,t)},i}function Aa(e,t,i){(i=go(i,null)).tag=3;var n=e.type.getDerivedStateFromError;if("function"==typeof n){var r=t.value;i.payload=function(){return ma(e,t),n(r)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(i.callback=function(){"function"!=typeof n&&(null===Ya?Ya=new Set([this]):Ya.add(this),ma(e,t));var i=t.stack;this.componentDidCatch(t.value,{componentStack:null!==i?i:""})}),i}var Na,Ia=Math.ceil,Oa=D.ReactCurrentDispatcher,Pa=D.ReactCurrentOwner,Da=16,La=32,Ra=0,Ma=null,Ba=null,ja=0,Ua=0,Fa=null,Ha=1073741823,qa=1073741823,za=null,Ga=0,$a=!1,Va=0,Wa=null,Ka=!1,Ja=null,Ya=null,Xa=!1,Qa=null,Za=90,el=null,tl=0,il=null,nl=0;function rl(){return 0!=(48&Ra)?1073741821-($r()/10|0):0!==nl?nl:nl=1073741821-($r()/10|0)}function ol(e,t,i){if(0==(2&(t=t.mode)))return 1073741823;var n=Vr();if(0==(4&t))return 99===n?1073741823:1073741822;if(0!=(Ra&Da))return ja;if(null!==i)e=eo(e,0|i.timeoutMs||5e3,250);else switch(n){case 99:e=1073741823;break;case 98:e=eo(e,150,100);break;case 97:case 96:e=eo(e,5e3,250);break;case 95:e=2;break;default:throw Error(s(326))}return null!==Ma&&e===ja&&--e,e}function sl(e,t){if(50<tl)throw tl=0,il=null,Error(s(185));if(null!==(e=al(e,t))){var i=Vr();1073741823===t?0!=(8&Ra)&&0==(48&Ra)?dl(e):(cl(e),0===Ra&&Xr()):cl(e),0==(4&Ra)||98!==i&&99!==i||(null===el?el=new Map([[e,t]]):(void 0===(i=el.get(e))||i>t)&&el.set(e,t))}}function al(e,t){e.expirationTime<t&&(e.expirationTime=t);var i=e.alternate;null!==i&&i.expirationTime<t&&(i.expirationTime=t);var n=e.return,r=null;if(null===n&&3===e.tag)r=e.stateNode;else for(;null!==n;){if(i=n.alternate,n.childExpirationTime<t&&(n.childExpirationTime=t),null!==i&&i.childExpirationTime<t&&(i.childExpirationTime=t),null===n.return&&3===n.tag){r=n.stateNode;break}n=n.return}return null!==r&&(Ma===r&&(vl(t),4===Ua&&$l(r,ja)),Vl(r,t)),r}function ll(e){var t=e.lastExpiredTime;return 0!==t?t:Gl(e,t=e.firstPendingTime)?(t=e.lastPingedTime)>(e=e.nextKnownPendingLevel)?t:e:t}function cl(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=Yr(dl.bind(null,e));else{var t=ll(e),i=e.callbackNode;if(0===t)null!==i&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var n=rl();if(n=1073741823===t?99:1===t||2===t?95:0>=(n=10*(1073741821-t)-10*(1073741821-n))?99:250>=n?98:5250>=n?97:95,null!==i){var r=e.callbackPriority;if(e.callbackExpirationTime===t&&r>=n)return;i!==Ur&&Nr(i)}e.callbackExpirationTime=t,e.callbackPriority=n,t=1073741823===t?Yr(dl.bind(null,e)):Jr(n,ul.bind(null,e),{timeout:10*(1073741821-t)-$r()}),e.callbackNode=t}}}function ul(e,t){if(nl=0,t)return Wl(e,t=rl()),cl(e),null;var i=ll(e);if(0!==i){if(t=e.callbackNode,0!=(48&Ra))throw Error(s(327));if(Tl(),e===Ma&&i===ja||fl(e,i),null!==Ba){var n=Ra;Ra|=Da;for(var r=gl();;)try{kl();break}catch(t){ml(e,t)}if(so(),Ra=n,Oa.current=r,1===Ua)throw t=Fa,fl(e,i),$l(e,i),cl(e),t;if(null===Ba)switch(r=e.finishedWork=e.current.alternate,e.finishedExpirationTime=i,n=Ua,Ma=null,n){case 0:case 1:throw Error(s(345));case 2:Wl(e,2<i?2:i);break;case 3:if($l(e,i),i===(n=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=El(r)),1073741823===Ha&&10<(r=Va+500-$r())){if($a){var o=e.lastPingedTime;if(0===o||o>=i){e.lastPingedTime=i,fl(e,i);break}}if(0!==(o=ll(e))&&o!==i)break;if(0!==n&&n!==i){e.lastPingedTime=n;break}e.timeoutHandle=rn(Cl.bind(null,e),r);break}Cl(e);break;case 4:if($l(e,i),i===(n=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=El(r)),$a&&(0===(r=e.lastPingedTime)||r>=i)){e.lastPingedTime=i,fl(e,i);break}if(0!==(r=ll(e))&&r!==i)break;if(0!==n&&n!==i){e.lastPingedTime=n;break}if(1073741823!==qa?n=10*(1073741821-qa)-$r():1073741823===Ha?n=0:(n=10*(1073741821-Ha)-5e3,0>(n=(r=$r())-n)&&(n=0),(i=10*(1073741821-i)-r)<(n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Ia(n/1960))-n)&&(n=i)),10<n){e.timeoutHandle=rn(Cl.bind(null,e),n);break}Cl(e);break;case 5:if(1073741823!==Ha&&null!==za){o=Ha;var a=za;if(0>=(n=0|a.busyMinDurationMs)?n=0:(r=0|a.busyDelayMs,n=(o=$r()-(10*(1073741821-o)-(0|a.timeoutMs||5e3)))<=r?0:r+n-o),10<n){$l(e,i),e.timeoutHandle=rn(Cl.bind(null,e),n);break}}Cl(e);break;default:throw Error(s(329))}if(cl(e),e.callbackNode===t)return ul.bind(null,e)}}return null}function dl(e){var t=e.lastExpiredTime;if(t=0!==t?t:1073741823,e.finishedExpirationTime===t)Cl(e);else{if(0!=(48&Ra))throw Error(s(327));if(Tl(),e===Ma&&t===ja||fl(e,t),null!==Ba){var i=Ra;Ra|=Da;for(var n=gl();;)try{yl();break}catch(t){ml(e,t)}if(so(),Ra=i,Oa.current=n,1===Ua)throw i=Fa,fl(e,t),$l(e,t),cl(e),i;if(null!==Ba)throw Error(s(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,Ma=null,Cl(e),cl(e)}}return null}function pl(e,t){var i=Ra;Ra|=1;try{return e(t)}finally{0===(Ra=i)&&Xr()}}function hl(e,t){var i=Ra;Ra&=-2,Ra|=8;try{return e(t)}finally{0===(Ra=i)&&Xr()}}function fl(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,on(i)),null!==Ba)for(i=Ba.return;null!==i;){var n=i;switch(n.tag){case 1:null!=n.type.childContextTypes&&wr();break;case 3:$o(),xr();break;case 5:Wo(n);break;case 4:$o();break;case 13:case 19:hr(Ko);break;case 10:lo(n)}i=i.return}Ma=e,Ba=jl(e.current,null),ja=t,Ua=0,Fa=null,qa=Ha=1073741823,za=null,Ga=0,$a=!1}function ml(e,t){for(;;){try{if(so(),ms(),null===Ba||null===Ba.return)return Ua=1,Fa=t,null;e:{var i=e,n=Ba.return,r=Ba,o=t;if(t=ja,r.effectTag|=2048,r.firstEffect=r.lastEffect=null,null!==o&&"object"==typeof o&&"function"==typeof o.then){var s=o,a=0!=(1&Ko.current),l=n;do{var c;if(c=13===l.tag){var u=l.memoizedState;if(null!==u)c=null!==u.dehydrated;else{var d=l.memoizedProps;c=void 0!==d.fallback&&(!0!==d.unstable_avoidThisFallback||!a)}}if(c){var p=l.updateQueue;if(null===p){var h=new Set;h.add(s),l.updateQueue=h}else p.add(s);if(0==(2&l.mode)){if(l.effectTag|=64,r.effectTag&=-2981,1===r.tag)if(null===r.alternate)r.tag=17;else{var f=go(1073741823,null);f.tag=2,vo(r,f)}r.expirationTime=1073741823;break e}o=void 0,r=t;var m=i.pingCache;if(null===m?(m=i.pingCache=new _a,o=new Set,m.set(s,o)):void 0===(o=m.get(s))&&(o=new Set,m.set(s,o)),!o.has(r)){o.add(r);var g=Ol.bind(null,i,s,r);s.then(g,g)}l.effectTag|=4096,l.expirationTime=t;break e}l=l.return}while(null!==l);o=Error((X(r.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+Q(r))}5!==Ua&&(Ua=2),o=ha(o,r),l=n;do{switch(l.tag){case 3:s=o,l.effectTag|=4096,l.expirationTime=t,yo(l,Ta(l,s,t));break e;case 1:s=o;var b=l.type,v=l.stateNode;if(0==(64&l.effectTag)&&("function"==typeof b.getDerivedStateFromError||null!==v&&"function"==typeof v.componentDidCatch&&(null===Ya||!Ya.has(v)))){l.effectTag|=4096,l.expirationTime=t,yo(l,Aa(l,s,t));break e}}l=l.return}while(null!==l)}Ba=xl(Ba)}catch(e){t=e;continue}break}}function gl(){var e=Oa.current;return Oa.current=Ps,null===e?Ps:e}function bl(e,t){e<Ha&&2<e&&(Ha=e),null!==t&&e<qa&&2<e&&(qa=e,za=t)}function vl(e){e>Ga&&(Ga=e)}function yl(){for(;null!==Ba;)Ba=wl(Ba)}function kl(){for(;null!==Ba&&!Ir();)Ba=wl(Ba)}function wl(e){var t=Na(e.alternate,e,ja);return e.memoizedProps=e.pendingProps,null===t&&(t=xl(e)),Pa.current=null,t}function xl(e){Ba=e;do{var t=Ba.alternate;if(e=Ba.return,0==(2048&Ba.effectTag)){e:{var i=t,n=ja,o=(t=Ba).pendingProps;switch(t.tag){case 2:case 16:break;case 15:case 0:break;case 1:kr(t.type)&&wr();break;case 3:$o(),xr(),(o=t.stateNode).pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(null===i||null===i.child)&&qs(t)&&ua(t);break;case 5:Wo(t),n=zo(qo.current);var a=t.type;if(null!==i&&null!=t.stateNode)ia(i,t,a,o,n),i.ref!==t.ref&&(t.effectTag|=128);else if(o){var l=zo(Fo.current);if(qs(t)){var c=(o=t).stateNode;i=o.type;var u=o.memoizedProps,d=n;switch(c[cn]=o,c[un]=u,a=void 0,n=c,i){case"iframe":case"object":case"embed":Si("load",n);break;case"video":case"audio":for(c=0;c<tt.length;c++)Si(tt[c],n);break;case"source":Si("error",n);break;case"img":case"image":case"link":Si("error",n),Si("load",n);break;case"form":Si("reset",n),Si("submit",n);break;case"details":Si("toggle",n);break;case"input":Te(n,u),Si("invalid",n),zi(d,"onChange");break;case"select":n._wrapperState={wasMultiple:!!u.multiple},Si("invalid",n),zi(d,"onChange");break;case"textarea":Re(n,u),Si("invalid",n),zi(d,"onChange")}for(a in Hi(i,u),c=null,u)u.hasOwnProperty(a)&&(l=u[a],"children"===a?"string"==typeof l?n.textContent!==l&&(c=["children",l]):"number"==typeof l&&n.textContent!==""+l&&(c=["children",""+l]):h.hasOwnProperty(a)&&null!=l&&zi(d,a));switch(i){case"input":Ce(n),Ie(n,u,!0);break;case"textarea":Ce(n),Be(n);break;case"select":case"option":break;default:"function"==typeof u.onClick&&(n.onclick=Gi)}a=c,o.updateQueue=a,(o=null!==a)&&ua(t)}else{i=t,d=a,u=o,c=9===n.nodeType?n:n.ownerDocument,l===je&&(l=Fe(d)),l===je?"script"===d?((u=c.createElement("div")).innerHTML="<script><\/script>",c=u.removeChild(u.firstChild)):"string"==typeof u.is?c=c.createElement(d,{is:u.is}):(c=c.createElement(d),"select"===d&&(d=c,u.multiple?d.multiple=!0:u.size&&(d.size=u.size))):c=c.createElementNS(l,d),(u=c)[cn]=i,u[un]=o,ta(u,t),t.stateNode=u;var p=n,f=qi(d=a,i=o);switch(d){case"iframe":case"object":case"embed":Si("load",u),n=i;break;case"video":case"audio":for(n=0;n<tt.length;n++)Si(tt[n],u);n=i;break;case"source":Si("error",u),n=i;break;case"img":case"image":case"link":Si("error",u),Si("load",u),n=i;break;case"form":Si("reset",u),Si("submit",u),n=i;break;case"details":Si("toggle",u),n=i;break;case"input":Te(u,i),n=_e(u,i),Si("invalid",u),zi(p,"onChange");break;case"option":n=Pe(u,i);break;case"select":u._wrapperState={wasMultiple:!!i.multiple},n=r({},i,{value:void 0}),Si("invalid",u),zi(p,"onChange");break;case"textarea":Re(u,i),n=Le(u,i),Si("invalid",u),zi(p,"onChange");break;default:n=i}Hi(d,n),c=void 0,l=d;var m=u,g=n;for(c in g)if(g.hasOwnProperty(c)){var b=g[c];"style"===c?Ui(m,b):"dangerouslySetInnerHTML"===c?null!=(b=b?b.__html:void 0)&&Ge(m,b):"children"===c?"string"==typeof b?("textarea"!==l||""!==b)&&$e(m,b):"number"==typeof b&&$e(m,""+b):"suppressContentEditableWarning"!==c&&"suppressHydrationWarning"!==c&&"autoFocus"!==c&&(h.hasOwnProperty(c)?null!=b&&zi(p,c):null!=b&&xe(m,c,b,f))}switch(d){case"input":Ce(u),Ie(u,i,!1);break;case"textarea":Ce(u),Be(u);break;case"option":null!=i.value&&u.setAttribute("value",""+we(i.value));break;case"select":(n=u).multiple=!!i.multiple,null!=(u=i.value)?De(n,!!i.multiple,u,!1):null!=i.defaultValue&&De(n,!!i.multiple,i.defaultValue,!0);break;default:"function"==typeof n.onClick&&(u.onclick=Gi)}(o=tn(a,o))&&ua(t)}null!==t.ref&&(t.effectTag|=128)}else if(null===t.stateNode)throw Error(s(166));break;case 6:if(i&&null!=t.stateNode)na(0,t,i.memoizedProps,o);else{if("string"!=typeof o&&null===t.stateNode)throw Error(s(166));n=zo(qo.current),zo(Fo.current),qs(t)?(a=(o=t).stateNode,n=o.memoizedProps,a[cn]=o,(o=a.nodeValue!==n)&&ua(t)):(a=t,(o=(9===n.nodeType?n:n.ownerDocument).createTextNode(o))[cn]=a,t.stateNode=o)}break;case 11:break;case 13:if(hr(Ko),o=t.memoizedState,0!=(64&t.effectTag)){t.expirationTime=n;break e}o=null!==o,a=!1,null===i?void 0!==t.memoizedProps.fallback&&qs(t):(a=null!==(n=i.memoizedState),o||null===n||null!==(n=i.child.sibling)&&(null!==(u=t.firstEffect)?(t.firstEffect=n,n.nextEffect=u):(t.firstEffect=t.lastEffect=n,n.nextEffect=null),n.effectTag=8)),o&&!a&&0!=(2&t.mode)&&(null===i&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&Ko.current)?0===Ua&&(Ua=3):(0!==Ua&&3!==Ua||(Ua=4),0!==Ga&&null!==Ma&&($l(Ma,ja),Vl(Ma,Ga)))),(o||a)&&(t.effectTag|=4);break;case 7:case 8:case 12:break;case 4:$o();break;case 10:lo(t);break;case 9:case 14:break;case 17:kr(t.type)&&wr();break;case 19:if(hr(Ko),null===(o=t.memoizedState))break;if(a=0!=(64&t.effectTag),null===(u=o.rendering)){if(a)da(o,!1);else if(0!==Ua||null!==i&&0!=(64&i.effectTag))for(i=t.child;null!==i;){if(null!==(u=Jo(i))){for(t.effectTag|=64,da(o,!1),null!==(a=u.updateQueue)&&(t.updateQueue=a,t.effectTag|=4),null===o.lastEffect&&(t.firstEffect=null),t.lastEffect=o.lastEffect,o=n,a=t.child;null!==a;)i=o,(n=a).effectTag&=2,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null,null===(u=n.alternate)?(n.childExpirationTime=0,n.expirationTime=i,n.child=null,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null):(n.childExpirationTime=u.childExpirationTime,n.expirationTime=u.expirationTime,n.child=u.child,n.memoizedProps=u.memoizedProps,n.memoizedState=u.memoizedState,n.updateQueue=u.updateQueue,i=u.dependencies,n.dependencies=null===i?null:{expirationTime:i.expirationTime,firstContext:i.firstContext,responders:i.responders}),a=a.sibling;fr(Ko,1&Ko.current|2),t=t.child;break e}i=i.sibling}}else{if(!a)if(null!==(i=Jo(u))){if(t.effectTag|=64,a=!0,null!==(n=i.updateQueue)&&(t.updateQueue=n,t.effectTag|=4),da(o,!0),null===o.tail&&"hidden"===o.tailMode){null!==(t=t.lastEffect=o.lastEffect)&&(t.nextEffect=null);break}}else $r()>o.tailExpiration&&1<n&&(t.effectTag|=64,a=!0,da(o,!1),t.expirationTime=t.childExpirationTime=n-1);o.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=o.last)?n.sibling=u:t.child=u,o.last=u)}if(null!==o.tail){0===o.tailExpiration&&(o.tailExpiration=$r()+500),n=o.tail,o.rendering=n,o.tail=n.sibling,o.lastEffect=t.lastEffect,n.sibling=null,o=Ko.current,fr(Ko,o=a?1&o|2:1&o),t=n;break e}break;case 20:case 21:break;default:throw Error(s(156,t.tag))}t=null}if(o=Ba,1===ja||1!==o.childExpirationTime){for(a=0,n=o.child;null!==n;)(i=n.expirationTime)>a&&(a=i),(u=n.childExpirationTime)>a&&(a=u),n=n.sibling;o.childExpirationTime=a}if(null!==t)return t;null!==e&&0==(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=Ba.firstEffect),null!==Ba.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=Ba.firstEffect),e.lastEffect=Ba.lastEffect),1<Ba.effectTag&&(null!==e.lastEffect?e.lastEffect.nextEffect=Ba:e.firstEffect=Ba,e.lastEffect=Ba))}else{if(null!==(t=pa(Ba)))return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(null!==(t=Ba.sibling))return t;Ba=e}while(null!==Ba);return 0===Ua&&(Ua=5),null}function El(e){var t=e.expirationTime;return t>(e=e.childExpirationTime)?t:e}function Cl(e){var t=Vr();return Kr(99,Sl.bind(null,e,t)),null}function Sl(e,t){if(Tl(),0!=(48&Ra))throw Error(s(327));var i=e.finishedWork,n=e.finishedExpirationTime;if(null===i)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,i===e.current)throw Error(s(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var r=El(i);if(e.firstPendingTime=r,n<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:n<=e.firstSuspendedTime&&(e.firstSuspendedTime=n-1),n<=e.lastPingedTime&&(e.lastPingedTime=0),n<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===Ma&&(Ba=Ma=null,ja=0),1<i.effectTag?null!==i.lastEffect?(i.lastEffect.nextEffect=i,r=i.firstEffect):r=i:r=i.firstEffect,null!==r){var o=Ra;Ra|=La,Pa.current=null,Zi=Ci;var a=Ji();if(Yi(a)){if("selectionStart"in a)var l={start:a.selectionStart,end:a.selectionEnd};else e:{var c=(l=(l=a.ownerDocument)&&l.defaultView||window).getSelection&&l.getSelection();if(c&&0!==c.rangeCount){l=c.anchorNode;var u=c.anchorOffset,d=c.focusNode;c=c.focusOffset;try{l.nodeType,d.nodeType}catch(e){l=null;break e}var p=0,h=-1,f=-1,m=0,g=0,b=a,v=null;t:for(;;){for(var y;b!==l||0!==u&&3!==b.nodeType||(h=p+u),b!==d||0!==c&&3!==b.nodeType||(f=p+c),3===b.nodeType&&(p+=b.nodeValue.length),null!==(y=b.firstChild);)v=b,b=y;for(;;){if(b===a)break t;if(v===l&&++m===u&&(h=p),v===d&&++g===c&&(f=p),null!==(y=b.nextSibling))break;v=(b=v).parentNode}b=y}l=-1===h||-1===f?null:{start:h,end:f}}else l=null}l=l||{start:0,end:0}}else l=null;en={focusedElem:a,selectionRange:l},Ci=!1,Wa=r;do{try{_l()}catch(e){if(null===Wa)throw Error(s(330));Il(Wa,e),Wa=Wa.nextEffect}}while(null!==Wa);Wa=r;do{try{for(a=e,l=t;null!==Wa;){var k=Wa.effectTag;if(16&k&&$e(Wa.stateNode,""),128&k){var w=Wa.alternate;if(null!==w){var x=w.ref;null!==x&&("function"==typeof x?x(null):x.current=null)}}switch(1038&k){case 2:xa(Wa),Wa.effectTag&=-3;break;case 6:xa(Wa),Wa.effectTag&=-3,Ca(Wa.alternate,Wa);break;case 1024:Wa.effectTag&=-1025;break;case 1028:Wa.effectTag&=-1025,Ca(Wa.alternate,Wa);break;case 4:Ca(Wa.alternate,Wa);break;case 8:Ea(a,u=Wa,l),ka(u)}Wa=Wa.nextEffect}}catch(e){if(null===Wa)throw Error(s(330));Il(Wa,e),Wa=Wa.nextEffect}}while(null!==Wa);if(x=en,w=Ji(),k=x.focusedElem,l=x.selectionRange,w!==k&&k&&k.ownerDocument&&Ki(k.ownerDocument.documentElement,k)){null!==l&&Yi(k)&&(w=l.start,void 0===(x=l.end)&&(x=w),"selectionStart"in k?(k.selectionStart=w,k.selectionEnd=Math.min(x,k.value.length)):(x=(w=k.ownerDocument||document)&&w.defaultView||window).getSelection&&(x=x.getSelection(),u=k.textContent.length,a=Math.min(l.start,u),l=void 0===l.end?a:Math.min(l.end,u),!x.extend&&a>l&&(u=l,l=a,a=u),u=Wi(k,a),d=Wi(k,l),u&&d&&(1!==x.rangeCount||x.anchorNode!==u.node||x.anchorOffset!==u.offset||x.focusNode!==d.node||x.focusOffset!==d.offset)&&((w=w.createRange()).setStart(u.node,u.offset),x.removeAllRanges(),a>l?(x.addRange(w),x.extend(d.node,d.offset)):(w.setEnd(d.node,d.offset),x.addRange(w))))),w=[];for(x=k;x=x.parentNode;)1===x.nodeType&&w.push({element:x,left:x.scrollLeft,top:x.scrollTop});for("function"==typeof k.focus&&k.focus(),k=0;k<w.length;k++)(x=w[k]).element.scrollLeft=x.left,x.element.scrollTop=x.top}en=null,Ci=!!Zi,Zi=null,e.current=i,Wa=r;do{try{for(k=n;null!==Wa;){var E=Wa.effectTag;if(36&E){var C=Wa.alternate;switch(x=k,(w=Wa).tag){case 0:case 11:case 15:va(16,32,w);break;case 1:var S=w.stateNode;if(4&w.effectTag)if(null===C)S.componentDidMount();else{var _=w.elementType===w.type?C.memoizedProps:to(w.type,C.memoizedProps);S.componentDidUpdate(_,C.memoizedState,S.__reactInternalSnapshotBeforeUpdate)}var T=w.updateQueue;null!==T&&Eo(0,T,S);break;case 3:var A=w.updateQueue;if(null!==A){if(a=null,null!==w.child)switch(w.child.tag){case 5:a=w.child.stateNode;break;case 1:a=w.child.stateNode}Eo(0,A,a)}break;case 5:var N=w.stateNode;null===C&&4&w.effectTag&&tn(w.type,w.memoizedProps)&&N.focus();break;case 6:case 4:case 12:break;case 13:if(null===w.memoizedState){var I=w.alternate;if(null!==I){var O=I.memoizedState;if(null!==O){var P=O.dehydrated;null!==P&&Tt(P)}}}break;case 19:case 17:case 20:case 21:break;default:throw Error(s(163))}}if(128&E){w=void 0;var D=Wa.ref;if(null!==D){var L=Wa.stateNode;switch(Wa.tag){case 5:w=L;break;default:w=L}"function"==typeof D?D(w):D.current=w}}Wa=Wa.nextEffect}}catch(e){if(null===Wa)throw Error(s(330));Il(Wa,e),Wa=Wa.nextEffect}}while(null!==Wa);Wa=null,Fr(),Ra=o}else e.current=i;if(Xa)Xa=!1,Qa=e,Za=t;else for(Wa=r;null!==Wa;)t=Wa.nextEffect,Wa.nextEffect=null,Wa=t;if(0===(t=e.firstPendingTime)&&(Ya=null),1073741823===t?e===il?tl++:(tl=0,il=e):tl=0,"function"==typeof Dl&&Dl(i.stateNode,n),cl(e),Ka)throw Ka=!1,e=Ja,Ja=null,e;return 0!=(8&Ra)||Xr(),null}function _l(){for(;null!==Wa;){var e=Wa.effectTag;0!=(256&e)&&ba(Wa.alternate,Wa),0==(512&e)||Xa||(Xa=!0,Jr(97,(function(){return Tl(),null}))),Wa=Wa.nextEffect}}function Tl(){if(90!==Za){var e=97<Za?97:Za;return Za=90,Kr(e,Al)}}function Al(){if(null===Qa)return!1;var e=Qa;if(Qa=null,0!=(48&Ra))throw Error(s(331));var t=Ra;for(Ra|=La,e=e.current.firstEffect;null!==e;){try{var i=e;if(0!=(512&i.effectTag))switch(i.tag){case 0:case 11:case 15:va(128,0,i),va(0,64,i)}}catch(t){if(null===e)throw Error(s(330));Il(e,t)}i=e.nextEffect,e.nextEffect=null,e=i}return Ra=t,Xr(),!0}function Nl(e,t,i){vo(e,t=Ta(e,t=ha(i,t),1073741823)),null!==(e=al(e,1073741823))&&cl(e)}function Il(e,t){if(3===e.tag)Nl(e,e,t);else for(var i=e.return;null!==i;){if(3===i.tag){Nl(i,e,t);break}if(1===i.tag){var n=i.stateNode;if("function"==typeof i.type.getDerivedStateFromError||"function"==typeof n.componentDidCatch&&(null===Ya||!Ya.has(n))){vo(i,e=Aa(i,e=ha(t,e),1073741823)),null!==(i=al(i,1073741823))&&cl(i);break}}i=i.return}}function Ol(e,t,i){var n=e.pingCache;null!==n&&n.delete(t),Ma===e&&ja===i?4===Ua||3===Ua&&1073741823===Ha&&$r()-Va<500?fl(e,ja):$a=!0:Gl(e,i)&&(0!==(t=e.lastPingedTime)&&t<i||(e.lastPingedTime=i,e.finishedExpirationTime===i&&(e.finishedExpirationTime=0,e.finishedWork=null),cl(e)))}function Pl(e,t){var i=e.stateNode;null!==i&&i.delete(t),0==(t=0)&&(t=ol(t=rl(),e,null)),null!==(e=al(e,t))&&cl(e)}Na=function(e,t,i){var n=t.expirationTime;if(null!==e){var r=t.pendingProps;if(e.memoizedProps!==r||br.current)$s=!0;else{if(n<i){switch($s=!1,t.tag){case 3:ea(t),zs();break;case 5:if(Vo(t),4&t.mode&&1!==i&&r.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:kr(t.type)&&Sr(t);break;case 4:Go(t,t.stateNode.containerInfo);break;case 10:ao(t,t.memoizedProps.value);break;case 13:if(null!==t.memoizedState)return 0!==(n=t.child.childExpirationTime)&&n>=i?oa(e,t,i):(fr(Ko,1&Ko.current),null!==(t=ca(e,t,i))?t.sibling:null);fr(Ko,1&Ko.current);break;case 19:if(n=t.childExpirationTime>=i,0!=(64&e.effectTag)){if(n)return la(e,t,i);t.effectTag|=64}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null),fr(Ko,Ko.current),!n)return null}return ca(e,t,i)}$s=!1}}else $s=!1;switch(t.expirationTime=0,t.tag){case 2:if(n=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,r=yr(t,gr.current),uo(t,i),r=fs(null,t,n,e,r,i),t.effectTag|=1,"object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof){if(t.tag=1,ms(),kr(n)){var o=!0;Sr(t)}else o=!1;t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null;var a=n.getDerivedStateFromProps;"function"==typeof a&&To(t,n,a,e),r.updater=Ao,t.stateNode=r,r._reactInternalFiber=t,Po(t,n,e,i),t=Zs(null,t,n,!0,o,i)}else t.tag=0,Vs(null,t,r,i),t=t.child;return t;case 16:if(r=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,function(e){if(-1===e._status){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}}(r),1!==r._status)throw r._result;switch(r=r._result,t.type=r,o=t.tag=function(e){if("function"==typeof e)return Bl(e)?1:0;if(null!=e){if((e=e.$$typeof)===G)return 11;if(e===W)return 14}return 2}(r),e=to(r,e),o){case 0:t=Xs(null,t,r,e,i);break;case 1:t=Qs(null,t,r,e,i);break;case 11:t=Ws(null,t,r,e,i);break;case 14:t=Ks(null,t,r,to(r.type,e),n,i);break;default:throw Error(s(306,r,""))}return t;case 0:return n=t.type,r=t.pendingProps,Xs(e,t,n,r=t.elementType===n?r:to(n,r),i);case 1:return n=t.type,r=t.pendingProps,Qs(e,t,n,r=t.elementType===n?r:to(n,r),i);case 3:if(ea(t),null===(n=t.updateQueue))throw Error(s(282));if(r=null!==(r=t.memoizedState)?r.element:null,xo(t,n,t.pendingProps,null,i),(n=t.memoizedState.element)===r)zs(),t=ca(e,t,i);else{if((r=t.stateNode.hydrate)&&(Ms=sn(t.stateNode.containerInfo.firstChild),Rs=t,r=Bs=!0),r)for(i=jo(t,null,n,i),t.child=i;i;)i.effectTag=-3&i.effectTag|1024,i=i.sibling;else Vs(e,t,n,i),zs();t=t.child}return t;case 5:return Vo(t),null===e&&Fs(t),n=t.type,r=t.pendingProps,o=null!==e?e.memoizedProps:null,a=r.children,nn(n,r)?a=null:null!==o&&nn(n,o)&&(t.effectTag|=16),Ys(e,t),4&t.mode&&1!==i&&r.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(Vs(e,t,a,i),t=t.child),t;case 6:return null===e&&Fs(t),null;case 13:return oa(e,t,i);case 4:return Go(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=Bo(t,null,n,i):Vs(e,t,n,i),t.child;case 11:return n=t.type,r=t.pendingProps,Ws(e,t,n,r=t.elementType===n?r:to(n,r),i);case 7:return Vs(e,t,t.pendingProps,i),t.child;case 8:case 12:return Vs(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(n=t.type._context,r=t.pendingProps,a=t.memoizedProps,ao(t,o=r.value),null!==a){var l=a.value;if(0==(o=er(l,o)?0:0|("function"==typeof n._calculateChangedBits?n._calculateChangedBits(l,o):1073741823))){if(a.children===r.children&&!br.current){t=ca(e,t,i);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var c=l.dependencies;if(null!==c){a=l.child;for(var u=c.firstContext;null!==u;){if(u.context===n&&0!=(u.observedBits&o)){1===l.tag&&((u=go(i,null)).tag=2,vo(l,u)),l.expirationTime<i&&(l.expirationTime=i),null!==(u=l.alternate)&&u.expirationTime<i&&(u.expirationTime=i),co(l.return,i),c.expirationTime<i&&(c.expirationTime=i);break}u=u.next}}else a=10===l.tag&&l.type===t.type?null:l.child;if(null!==a)a.return=l;else for(a=l;null!==a;){if(a===t){a=null;break}if(null!==(l=a.sibling)){l.return=a.return,a=l;break}a=a.return}l=a}}Vs(e,t,r.children,i),t=t.child}return t;case 9:return r=t.type,n=(o=t.pendingProps).children,uo(t,i),n=n(r=po(r,o.unstable_observedBits)),t.effectTag|=1,Vs(e,t,n,i),t.child;case 14:return o=to(r=t.type,t.pendingProps),Ks(e,t,r,o=to(r.type,o),n,i);case 15:return Js(e,t,t.type,t.pendingProps,n,i);case 17:return n=t.type,r=t.pendingProps,r=t.elementType===n?r:to(n,r),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,kr(n)?(e=!0,Sr(t)):e=!1,uo(t,i),Io(t,n,r),Po(t,n,r,i),Zs(null,t,n,!0,e,i);case 19:return la(e,t,i)}throw Error(s(156,t.tag))};var Dl=null,Ll=null;function Rl(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Ml(e,t,i,n){return new Rl(e,t,i,n)}function Bl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function jl(e,t){var i=e.alternate;return null===i?((i=Ml(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.effectTag=0,i.nextEffect=null,i.firstEffect=null,i.lastEffect=null),i.childExpirationTime=e.childExpirationTime,i.expirationTime=e.expirationTime,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function Ul(e,t,i,n,r,o){var a=2;if(n=e,"function"==typeof e)Bl(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case j:return Fl(i.children,r,o,t);case z:a=8,r|=7;break;case U:a=8,r|=1;break;case F:return(e=Ml(12,i,t,8|r)).elementType=F,e.type=F,e.expirationTime=o,e;case $:return(e=Ml(13,i,t,r)).type=$,e.elementType=$,e.expirationTime=o,e;case V:return(e=Ml(19,i,t,r)).elementType=V,e.expirationTime=o,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case H:a=10;break e;case q:a=9;break e;case G:a=11;break e;case W:a=14;break e;case K:a=16,n=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Ml(a,i,t,r)).elementType=e,t.type=n,t.expirationTime=o,t}function Fl(e,t,i,n){return(e=Ml(7,e,n,t)).expirationTime=i,e}function Hl(e,t,i){return(e=Ml(6,e,null,t)).expirationTime=i,e}function ql(e,t,i){return(t=Ml(4,null!==e.children?e.children:[],e.key,t)).expirationTime=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function zl(e,t,i){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=i,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Gl(e,t){var i=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==i&&i>=t&&e<=t}function $l(e,t){var i=e.firstSuspendedTime,n=e.lastSuspendedTime;i<t&&(e.firstSuspendedTime=t),(n>t||0===i)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function Vl(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var i=e.firstSuspendedTime;0!==i&&(t>=i?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function Wl(e,t){var i=e.lastExpiredTime;(0===i||i>t)&&(e.lastExpiredTime=t)}function Kl(e,t,i,n){var r=t.current,o=rl(),a=So.suspense;o=ol(o,r,a);e:if(i){t:{if(it(i=i._reactInternalFiber)!==i||1!==i.tag)throw Error(s(170));var l=i;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(kr(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(s(171))}if(1===i.tag){var c=i.type;if(kr(c)){i=Cr(i,c,l);break e}}i=l}else i=mr;return null===t.context?t.context=i:t.pendingContext=i,(t=go(o,a)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),vo(r,t),sl(r,o),o}function Jl(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Yl(e,t){null!==(e=e.memoizedState)&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function Xl(e,t){Yl(e,t),(e=e.alternate)&&Yl(e,t)}function Ql(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:B,key:null==n?null:""+n,children:e,containerInfo:t,implementation:i}}function Zl(e,t,i){var n=new zl(e,t,i=null!=i&&!0===i.hydrate),r=Ml(3,null,null,2===t?7:1===t?3:0);n.current=r,r.stateNode=n,e[dn]=n.current,i&&0!==t&&function(e){var t=Li(e);bt.forEach((function(i){Ri(i,e,t)})),vt.forEach((function(i){Ri(i,e,t)}))}(9===e.nodeType?e:e.ownerDocument),this._internalRoot=n}function ec(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function tc(e,t,i,n,r){var o=i._reactRootContainer;if(o){var s=o._internalRoot;if("function"==typeof r){var a=r;r=function(){var e=Jl(s);a.call(e)}}Kl(t,s,e,r)}else{if(o=i._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var i;i=e.lastChild;)e.removeChild(i);return new Zl(e,0,t?{hydrate:!0}:void 0)}(i,n),s=o._internalRoot,"function"==typeof r){var l=r;r=function(){var e=Jl(s);l.call(e)}}hl((function(){Kl(t,s,e,r)}))}return Jl(s)}function ic(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!ec(t))throw Error(s(200));return Ql(e,t,null,i)}st=function(e){if(13===e.tag){var t=eo(rl(),150,100);sl(e,t),Xl(e,t)}},at=function(e){if(13===e.tag){rl();var t=Zr++;sl(e,t),Xl(e,t)}},lt=function(e){if(13===e.tag){var t=rl();sl(e,t=ol(t,e,null)),Xl(e,t)}},ee=function(e,t,i){switch(t){case"input":if(Ne(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var n=i[t];if(n!==e&&n.form===e.form){var r=mn(n);if(!r)throw Error(s(90));Se(n),Ne(n,r)}}}break;case"textarea":Me(e,i);break;case"select":null!=(t=i.value)&&De(e,!!i.multiple,t,!1)}},Zl.prototype.render=function(e,t){Kl(e,this._internalRoot,null,void 0===t?null:t)},Zl.prototype.unmount=function(e){Kl(null,this._internalRoot,null,void 0===e?null:e)},se=pl,ae=function(e,t,i,n){var r=Ra;Ra|=4;try{return Kr(98,e.bind(null,t,i,n))}finally{0===(Ra=r)&&Xr()}},le=function(){0==(49&Ra)&&(function(){if(null!==el){var e=el;el=null,e.forEach((function(e,t){Wl(t,e),cl(t)})),Xr()}}(),Tl())},ce=function(e,t){var i=Ra;Ra|=2;try{return e(t)}finally{0===(Ra=i)&&Xr()}};var nc={createPortal:ic,findDOMNode:function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0===t){if("function"==typeof e.render)throw Error(s(188));throw Error(s(268,Object.keys(e)))}return null===(e=ot(t))?null:e.stateNode},hydrate:function(e,t,i){if(!ec(t))throw Error(s(200));return tc(null,e,t,!0,i)},render:function(e,t,i){if(!ec(t))throw Error(s(200));return tc(null,e,t,!1,i)},unstable_renderSubtreeIntoContainer:function(e,t,i,n){if(!ec(i))throw Error(s(200));if(null==e||void 0===e._reactInternalFiber)throw Error(s(38));return tc(e,t,i,!1,n)},unmountComponentAtNode:function(e){if(!ec(e))throw Error(s(40));return!!e._reactRootContainer&&(hl((function(){tc(null,null,e,!1,(function(){e._reactRootContainer=null}))})),!0)},unstable_createPortal:function(){return ic.apply(void 0,arguments)},unstable_batchedUpdates:pl,flushSync:function(e,t){if(0!=(48&Ra))throw Error(s(187));var i=Ra;Ra|=1;try{return Kr(99,e.bind(null,t))}finally{Ra=i,Xr()}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{Events:[hn,fn,mn,O.injectEventPluginsByName,p,Lt,function(e){T(e,Dt)},re,oe,Ii,I,Tl,{current:!1}]}};!function(e){var t=e.findFiberByHostInstance;!function(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var i=t.inject(e);Dl=function(e){try{t.onCommitFiberRoot(i,e,void 0,64==(64&e.current.effectTag))}catch(e){}},Ll=function(e){try{t.onCommitFiberUnmount(i,e)}catch(e){}}}catch(e){}}(r({},e,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:D.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=ot(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))}({findFiberByHostInstance:pn,bundleType:0,version:"16.11.0",rendererPackageName:"react-dom"});var rc={default:nc},oc=rc&&nc||rc;t.exports=oc.default||oc},{"object-assign":260,react:335,scheduler:293}],291:[function(e,t,i){"use strict";(function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}})(),t.exports=e("./cjs/react-dom.production.min.js")},{"./cjs/react-dom.production.min.js":290}],292:[function(e,t,i){"use strict";var n,r,o,s,a;if(Object.defineProperty(i,"__esModule",{value:!0}),"undefined"==typeof window||"function"!=typeof MessageChannel){var l=null,c=null,u=function(){if(null!==l)try{var e=i.unstable_now();l(!0,e),l=null}catch(e){throw setTimeout(u,0),e}},d=Date.now();i.unstable_now=function(){return Date.now()-d},n=function(e){null!==l?setTimeout(n,0,e):(l=e,setTimeout(u,0))},r=function(e,t){c=setTimeout(e,t)},o=function(){clearTimeout(c)},s=function(){return!1},a=i.unstable_forceFrameRate=function(){}}else{var p=window.performance,h=window.Date,f=window.setTimeout,m=window.clearTimeout,g=window.requestAnimationFrame,b=window.cancelAnimationFrame;if("undefined"!=typeof console&&("function"!=typeof g&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof b&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")),"object"==typeof p&&"function"==typeof p.now)i.unstable_now=function(){return p.now()};else{var v=h.now();i.unstable_now=function(){return h.now()-v}}var y=!1,k=null,w=-1,x=5,E=0;s=function(){return i.unstable_now()>=E},a=function(){},i.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):x=0<e?Math.floor(1e3/e):33.33};var C=new MessageChannel,S=C.port2;C.port1.onmessage=function(){if(null!==k){var e=i.unstable_now();E=e+x;try{k(!0,e)?S.postMessage(null):(y=!1,k=null)}catch(e){throw S.postMessage(null),e}}else y=!1},n=function(e){k=e,y||(y=!0,S.postMessage(null))},r=function(e,t){w=f((function(){e(i.unstable_now())}),t)},o=function(){m(w),w=-1}}function _(e,t){var i=e.length;e.push(t);e:for(;;){var n=Math.floor((i-1)/2),r=e[n];if(!(void 0!==r&&0<N(r,t)))break e;e[n]=t,e[i]=r,i=n}}function T(e){return void 0===(e=e[0])?null:e}function A(e){var t=e[0];if(void 0!==t){var i=e.pop();if(i!==t){e[0]=i;e:for(var n=0,r=e.length;n<r;){var o=2*(n+1)-1,s=e[o],a=o+1,l=e[a];if(void 0!==s&&0>N(s,i))void 0!==l&&0>N(l,s)?(e[n]=l,e[a]=i,n=a):(e[n]=s,e[o]=i,n=o);else{if(!(void 0!==l&&0>N(l,i)))break e;e[n]=l,e[a]=i,n=a}}}return t}return null}function N(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}var I=[],O=[],P=1,D=null,L=3,R=!1,M=!1,B=!1;function j(e){for(var t=T(O);null!==t;){if(null===t.callback)A(O);else{if(!(t.startTime<=e))break;A(O),t.sortIndex=t.expirationTime,_(I,t)}t=T(O)}}function U(e){if(B=!1,j(e),!M)if(null!==T(I))M=!0,n(F);else{var t=T(O);null!==t&&r(U,t.startTime-e)}}function F(e,t){M=!1,B&&(B=!1,o()),R=!0;var n=L;try{for(j(t),D=T(I);null!==D&&(!(D.expirationTime>t)||e&&!s());){var a=D.callback;if(null!==a){D.callback=null,L=D.priorityLevel;var l=a(D.expirationTime<=t);t=i.unstable_now(),"function"==typeof l?D.callback=l:D===T(I)&&A(I),j(t)}else A(I);D=T(I)}if(null!==D)var c=!0;else{var u=T(O);null!==u&&r(U,u.startTime-t),c=!1}return c}finally{D=null,L=n,R=!1}}function H(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var q=a;i.unstable_ImmediatePriority=1,i.unstable_UserBlockingPriority=2,i.unstable_NormalPriority=3,i.unstable_IdlePriority=5,i.unstable_LowPriority=4,i.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=L;L=e;try{return t()}finally{L=i}},i.unstable_next=function(e){switch(L){case 1:case 2:case 3:var t=3;break;default:t=L}var i=L;L=t;try{return e()}finally{L=i}},i.unstable_scheduleCallback=function(e,t,s){var a=i.unstable_now();if("object"==typeof s&&null!==s){var l=s.delay;l="number"==typeof l&&0<l?a+l:a,s="number"==typeof s.timeout?s.timeout:H(e)}else s=H(e),l=a;return e={id:P++,callback:t,priorityLevel:e,startTime:l,expirationTime:s=l+s,sortIndex:-1},l>a?(e.sortIndex=l,_(O,e),null===T(I)&&e===T(O)&&(B?o():B=!0,r(U,l-a))):(e.sortIndex=s,_(I,e),M||R||(M=!0,n(F))),e},i.unstable_cancelCallback=function(e){e.callback=null},i.unstable_wrapCallback=function(e){var t=L;return function(){var i=L;L=t;try{return e.apply(this,arguments)}finally{L=i}}},i.unstable_getCurrentPriorityLevel=function(){return L},i.unstable_shouldYield=function(){var e=i.unstable_now();j(e);var t=T(I);return t!==D&&null!==D&&null!==t&&null!==t.callback&&t.startTime<=e&&t.expirationTime<D.expirationTime||s()},i.unstable_requestPaint=q,i.unstable_continueExecution=function(){M||R||(M=!0,n(F))},i.unstable_pauseExecution=function(){},i.unstable_getFirstCallbackNode=function(){return T(I)},i.unstable_Profiling=null},{}],293:[function(e,t,i){"use strict";t.exports=e("./cjs/scheduler.production.min.js")},{"./cjs/scheduler.production.min.js":292}],294:[function(e,t,i){"use strict";var n="function"==typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,o=n?Symbol.for("react.portal"):60106,s=n?Symbol.for("react.fragment"):60107,a=n?Symbol.for("react.strict_mode"):60108,l=n?Symbol.for("react.profiler"):60114,c=n?Symbol.for("react.provider"):60109,u=n?Symbol.for("react.context"):60110,d=n?Symbol.for("react.async_mode"):60111,p=n?Symbol.for("react.concurrent_mode"):60111,h=n?Symbol.for("react.forward_ref"):60112,f=n?Symbol.for("react.suspense"):60113,m=n?Symbol.for("react.suspense_list"):60120,g=n?Symbol.for("react.memo"):60115,b=n?Symbol.for("react.lazy"):60116,v=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,k=n?Symbol.for("react.responder"):60118,w=n?Symbol.for("react.scope"):60119;function x(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case d:case p:case s:case l:case a:case f:return e;default:switch(e=e&&e.$$typeof){case u:case h:case b:case g:case c:return e;default:return t}}case o:return t}}}function E(e){return x(e)===p}i.AsyncMode=d,i.ConcurrentMode=p,i.ContextConsumer=u,i.ContextProvider=c,i.Element=r,i.ForwardRef=h,i.Fragment=s,i.Lazy=b,i.Memo=g,i.Portal=o,i.Profiler=l,i.StrictMode=a,i.Suspense=f,i.isAsyncMode=function(e){return E(e)||x(e)===d},i.isConcurrentMode=E,i.isContextConsumer=function(e){return x(e)===u},i.isContextProvider=function(e){return x(e)===c},i.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===r},i.isForwardRef=function(e){return x(e)===h},i.isFragment=function(e){return x(e)===s},i.isLazy=function(e){return x(e)===b},i.isMemo=function(e){return x(e)===g},i.isPortal=function(e){return x(e)===o},i.isProfiler=function(e){return x(e)===l},i.isStrictMode=function(e){return x(e)===a},i.isSuspense=function(e){return x(e)===f},i.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===s||e===p||e===l||e===a||e===f||e===m||"object"==typeof e&&null!==e&&(e.$$typeof===b||e.$$typeof===g||e.$$typeof===c||e.$$typeof===u||e.$$typeof===h||e.$$typeof===y||e.$$typeof===k||e.$$typeof===w||e.$$typeof===v)},i.typeOf=x},{}],295:[function(e,t,i){"use strict";t.exports=e("./cjs/react-is.production.min.js")},{"./cjs/react-is.production.min.js":294}],296:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.bodyOpenClassName=i.portalClassName=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=e("react"),s=h(o),a=h(e("react-dom")),l=h(e("prop-types")),c=h(e("./ModalPortal")),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(e("../helpers/ariaAppHider")),d=e("../helpers/safeHTMLElement"),p=h(d);function h(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var g=i.portalClassName="ReactModalPortal",b=i.bodyOpenClassName="ReactModal__Body--open",v=void 0!==a.default.createPortal,y=v?a.default.createPortal:a.default.unstable_renderSubtreeIntoContainer;function k(e){return e()}var w=function(e){function t(){var e,i,r;f(this,t);for(var o=arguments.length,l=Array(o),u=0;u<o;u++)l[u]=arguments[u];return i=r=m(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),r.removePortal=function(){!v&&a.default.unmountComponentAtNode(r.node),k(r.props.parentSelector).removeChild(r.node)},r.portalRef=function(e){r.portal=e},r.renderPortal=function(e){var i=y(r,s.default.createElement(c.default,n({defaultStyles:t.defaultStyles},e)),r.node);r.portalRef(i)},m(r,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),r(t,[{key:"componentDidMount",value:function(){d.canUseDOM&&(v||(this.node=document.createElement("div")),this.node.className=this.props.portalClassName,k(this.props.parentSelector).appendChild(this.node),!v&&this.renderPortal(this.props))}},{key:"componentWillReceiveProps",value:function(e){if(d.canUseDOM){var t=e.isOpen;if(this.props.isOpen||t){var i=k(this.props.parentSelector),n=k(e.parentSelector);n!==i&&(i.removeChild(this.node),n.appendChild(this.node)),!v&&this.renderPortal(e)}}}},{key:"componentWillUpdate",value:function(e){d.canUseDOM&&e.portalClassName!==this.props.portalClassName&&(this.node.className=e.portalClassName)}},{key:"componentWillUnmount",value:function(){if(d.canUseDOM&&this.node&&this.portal){var e=this.portal.state,t=Date.now(),i=e.isOpen&&this.props.closeTimeoutMS&&(e.closesAt||t+this.props.closeTimeoutMS);i?(e.beforeClose||this.portal.closeWithTimeout(),setTimeout(this.removePortal,i-t)):this.removePortal()}}},{key:"render",value:function(){return d.canUseDOM&&v?(!this.node&&v&&(this.node=document.createElement("div")),y(s.default.createElement(c.default,n({ref:this.portalRef,defaultStyles:t.defaultStyles},this.props)),this.node)):null}}],[{key:"setAppElement",value:function(e){u.setElement(e)}}]),t}();w.propTypes={isOpen:l.default.bool.isRequired,style:l.default.shape({content:l.default.object,overlay:l.default.object}),portalClassName:l.default.string,bodyOpenClassName:l.default.string,htmlOpenClassName:l.default.string,className:l.default.oneOfType([l.default.string,l.default.shape({base:l.default.string.isRequired,afterOpen:l.default.string.isRequired,beforeClose:l.default.string.isRequired})]),overlayClassName:l.default.oneOfType([l.default.string,l.default.shape({base:l.default.string.isRequired,afterOpen:l.default.string.isRequired,beforeClose:l.default.string.isRequired})]),appElement:l.default.instanceOf(p.default),onAfterOpen:l.default.func,onRequestClose:l.default.func,closeTimeoutMS:l.default.number,ariaHideApp:l.default.bool,shouldFocusAfterRender:l.default.bool,shouldCloseOnOverlayClick:l.default.bool,shouldReturnFocusAfterClose:l.default.bool,parentSelector:l.default.func,aria:l.default.object,role:l.default.string,contentLabel:l.default.string,shouldCloseOnEsc:l.default.bool,overlayRef:l.default.func,contentRef:l.default.func},w.defaultProps={isOpen:!1,portalClassName:g,bodyOpenClassName:b,ariaHideApp:!0,closeTimeoutMS:0,shouldFocusAfterRender:!0,shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!0,shouldReturnFocusAfterClose:!0,parentSelector:function(){return document.body}},w.defaultStyles={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.75)"},content:{position:"absolute",top:"40px",left:"40px",right:"40px",bottom:"40px",border:"1px solid #ccc",background:"#fff",overflow:"auto",WebkitOverflowScrolling:"touch",borderRadius:"4px",outline:"none",padding:"20px"}},i.default=w},{"../helpers/ariaAppHider":298,"../helpers/safeHTMLElement":301,"./ModalPortal":297,"prop-types":287,react:335,"react-dom":291}],297:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("react"),a=m(s),l=m(e("prop-types")),c=f(e("../helpers/focusManager")),u=m(e("../helpers/scopeTab")),d=f(e("../helpers/ariaAppHider")),p=f(e("../helpers/classList")),h=m(e("../helpers/safeHTMLElement"));function f(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function m(e){return e&&e.__esModule?e:{default:e}}var g={overlay:"ReactModal__Overlay",content:"ReactModal__Content"},b=0,v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.setFocusAfterRender=function(e){i.focusAfterRender=i.props.shouldFocusAfterRender&&e},i.setOverlayRef=function(e){i.overlay=e,i.props.overlayRef&&i.props.overlayRef(e)},i.setContentRef=function(e){i.content=e,i.props.contentRef&&i.props.contentRef(e)},i.afterClose=function(){var e=i.props,t=e.appElement,n=e.ariaHideApp,r=e.htmlOpenClassName,o=e.bodyOpenClassName;p.remove(document.body,o),r&&p.remove(document.getElementsByTagName("html")[0],r),n&&b>0&&0==(b-=1)&&d.show(t),i.props.shouldFocusAfterRender&&(i.props.shouldReturnFocusAfterClose?(c.returnFocus(),c.teardownScopedFocus()):c.popWithoutFocus())},i.open=function(){i.beforeOpen(),i.state.afterOpen&&i.state.beforeClose?(clearTimeout(i.closeTimer),i.setState({beforeClose:!1})):(i.props.shouldFocusAfterRender&&(c.setupScopedFocus(i.node),c.markForFocusLater()),i.setState({isOpen:!0},(function(){i.setState({afterOpen:!0}),i.props.isOpen&&i.props.onAfterOpen&&i.props.onAfterOpen()})))},i.close=function(){i.props.closeTimeoutMS>0?i.closeWithTimeout():i.closeWithoutTimeout()},i.focusContent=function(){return i.content&&!i.contentHasFocus()&&i.content.focus()},i.closeWithTimeout=function(){var e=Date.now()+i.props.closeTimeoutMS;i.setState({beforeClose:!0,closesAt:e},(function(){i.closeTimer=setTimeout(i.closeWithoutTimeout,i.state.closesAt-Date.now())}))},i.closeWithoutTimeout=function(){i.setState({beforeClose:!1,isOpen:!1,afterOpen:!1,closesAt:null},i.afterClose)},i.handleKeyDown=function(e){9===e.keyCode&&(0,u.default)(i.content,e),i.props.shouldCloseOnEsc&&27===e.keyCode&&(e.stopPropagation(),i.requestClose(e))},i.handleOverlayOnClick=function(e){null===i.shouldClose&&(i.shouldClose=!0),i.shouldClose&&i.props.shouldCloseOnOverlayClick&&(i.ownerHandlesClose()?i.requestClose(e):i.focusContent()),i.shouldClose=null,i.moveFromContentToOverlay=null},i.handleOverlayOnMouseUp=function(){null===i.moveFromContentToOverlay&&(i.shouldClose=!1),i.props.shouldCloseOnOverlayClick&&(i.shouldClose=!0)},i.handleContentOnMouseUp=function(){i.shouldClose=!1},i.handleOverlayOnMouseDown=function(e){i.props.shouldCloseOnOverlayClick||e.target!=i.overlay||e.preventDefault(),i.moveFromContentToOverlay=!1},i.handleContentOnClick=function(){i.shouldClose=!1},i.handleContentOnMouseDown=function(){i.shouldClose=!1,i.moveFromContentToOverlay=!1},i.requestClose=function(e){return i.ownerHandlesClose()&&i.props.onRequestClose(e)},i.ownerHandlesClose=function(){return i.props.onRequestClose},i.shouldBeClosed=function(){return!i.state.isOpen&&!i.state.beforeClose},i.contentHasFocus=function(){return document.activeElement===i.content||i.content.contains(document.activeElement)},i.buildClassName=function(e,t){var n="object"===(void 0===t?"undefined":r(t))?t:{base:g[e],afterOpen:g[e]+"--after-open",beforeClose:g[e]+"--before-close"},o=n.base;return i.state.afterOpen&&(o=o+" "+n.afterOpen),i.state.beforeClose&&(o=o+" "+n.beforeClose),"string"==typeof t&&t?o+" "+t:o},i.ariaAttributes=function(e){return Object.keys(e).reduce((function(t,i){return t["aria-"+i]=e[i],t}),{})},i.state={afterOpen:!1,beforeClose:!1},i.shouldClose=null,i.moveFromContentToOverlay=null,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),o(t,[{key:"componentDidMount",value:function(){this.props.isOpen&&(this.setFocusAfterRender(!0),this.open())}},{key:"componentWillReceiveProps",value:function(e){!this.props.isOpen&&e.isOpen?(this.setFocusAfterRender(!0),this.open()):this.props.isOpen&&!e.isOpen&&this.close()}},{key:"componentDidUpdate",value:function(){this.focusAfterRender&&(this.focusContent(),this.setFocusAfterRender(!1))}},{key:"componentWillUnmount",value:function(){this.afterClose(),clearTimeout(this.closeTimer)}},{key:"beforeOpen",value:function(){var e=this.props,t=e.appElement,i=e.ariaHideApp,n=e.htmlOpenClassName,r=e.bodyOpenClassName;p.add(document.body,r),n&&p.add(document.getElementsByTagName("html")[0],n),i&&(b+=1,d.hide(t))}},{key:"render",value:function(){var e=this.props,t=e.className,i=e.overlayClassName,r=e.defaultStyles,o=t?{}:r.content,s=i?{}:r.overlay;return this.shouldBeClosed()?null:a.default.createElement("div",{ref:this.setOverlayRef,className:this.buildClassName("overlay",i),style:n({},s,this.props.style.overlay),onClick:this.handleOverlayOnClick,onMouseDown:this.handleOverlayOnMouseDown,onMouseUp:this.handleOverlayOnMouseUp,"aria-modal":"true"},a.default.createElement("div",n({ref:this.setContentRef,style:n({},o,this.props.style.content),className:this.buildClassName("content",t),tabIndex:"-1",onKeyDown:this.handleKeyDown,onMouseDown:this.handleContentOnMouseDown,onMouseUp:this.handleContentOnMouseUp,onClick:this.handleContentOnClick,role:this.props.role,"aria-label":this.props.contentLabel},this.ariaAttributes(this.props.aria||{})),this.props.children))}}]),t}();v.defaultProps={style:{overlay:{},content:{}}},v.propTypes={isOpen:l.default.bool.isRequired,defaultStyles:l.default.shape({content:l.default.object,overlay:l.default.object}),style:l.default.shape({content:l.default.object,overlay:l.default.object}),className:l.default.oneOfType([l.default.string,l.default.object]),overlayClassName:l.default.oneOfType([l.default.string,l.default.object]),bodyOpenClassName:l.default.string,htmlOpenClassName:l.default.string,ariaHideApp:l.default.bool,appElement:l.default.instanceOf(h.default),onAfterOpen:l.default.func,onRequestClose:l.default.func,closeTimeoutMS:l.default.number,shouldFocusAfterRender:l.default.bool,shouldCloseOnOverlayClick:l.default.bool,shouldReturnFocusAfterClose:l.default.bool,role:l.default.string,contentLabel:l.default.string,aria:l.default.object,children:l.default.node,shouldCloseOnEsc:l.default.bool,overlayRef:l.default.func,contentRef:l.default.func},i.default=v,t.exports=i.default},{"../helpers/ariaAppHider":298,"../helpers/classList":299,"../helpers/focusManager":300,"../helpers/safeHTMLElement":301,"../helpers/scopeTab":302,"prop-types":287,react:335}],298:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.assertNodeList=a,i.setElement=function(e){var t=e;if("string"==typeof t){var i=document.querySelectorAll(t);a(i,t),t="length"in i?i[0]:i}return s=t||s},i.validateElement=l,i.hide=function(e){l(e)&&(e||s).setAttribute("aria-hidden","true")},i.show=function(e){l(e)&&(e||s).removeAttribute("aria-hidden")},i.documentNotReadyOrSSRTesting=function(){s=null},i.resetForTesting=function(){s=null};var n,r=e("warning"),o=(n=r)&&n.__esModule?n:{default:n};var s=null;function a(e,t){if(!e||!e.length)throw new Error("react-modal: No elements were found for selector "+t+".")}function l(e){return!(!e&&!s&&((0,o.default)(!1,["react-modal: App element is not defined.","Please use `Modal.setAppElement(el)` or set `appElement={el}`.","This is needed so screen readers don't see main content","when modal is opened. It is not recommended, but you can opt-out","by setting `ariaHideApp={false}`."].join(" ")),1))}},{warning:398}],299:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.dumpClassLists=function(){};var n={},r={};i.add=function(e,t){return function(e,t,i){i.forEach((function(i){(function(e,t){e[t]||(e[t]=0),e[t]+=1})(t,i),e.add(i)}))}(e.classList,"html"==e.nodeName.toLowerCase()?n:r,t.split(" "))},i.remove=function(e,t){return function(e,t,i){i.forEach((function(i){(function(e,t){e[t]&&(e[t]-=1)})(t,i),0===t[i]&&e.remove(i)}))}(e.classList,"html"==e.nodeName.toLowerCase()?n:r,t.split(" "))}},{}],300:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.handleBlur=c,i.handleFocus=u,i.markForFocusLater=function(){s.push(document.activeElement)},i.returnFocus=function(){var e=null;try{return void(0!==s.length&&(e=s.pop()).focus())}catch(t){console.warn(["You tried to return focus to",e,"but it is not in the DOM anymore"].join(" "))}},i.popWithoutFocus=function(){s.length>0&&s.pop()},i.setupScopedFocus=function(e){a=e,window.addEventListener?(window.addEventListener("blur",c,!1),document.addEventListener("focus",u,!0)):(window.attachEvent("onBlur",c),document.attachEvent("onFocus",u))},i.teardownScopedFocus=function(){a=null,window.addEventListener?(window.removeEventListener("blur",c),document.removeEventListener("focus",u)):(window.detachEvent("onBlur",c),document.detachEvent("onFocus",u))};var n,r=e("../helpers/tabbable"),o=(n=r)&&n.__esModule?n:{default:n};var s=[],a=null,l=!1;function c(){l=!0}function u(){if(l){if(l=!1,!a)return;setTimeout((function(){a.contains(document.activeElement)||((0,o.default)(a)[0]||a).focus()}),0)}}},{"../helpers/tabbable":303}],301:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.canUseDOM=void 0;var n,r=e("exenv");var o=((n=r)&&n.__esModule?n:{default:n}).default,s=o.canUseDOM?window.HTMLElement:{};i.canUseDOM=o.canUseDOM;i.default=s},{exenv:196}],302:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e,t){var i=(0,o.default)(e);if(i.length){var n,r=t.shiftKey,s=i[0],a=i[i.length-1];if(e===document.activeElement){if(!r)return;n=a}if(a!==document.activeElement||r||(n=s),s===document.activeElement&&r&&(n=a),n)return t.preventDefault(),void n.focus();var l=/(\bChrome\b|\bSafari\b)\//.exec(navigator.userAgent);if(null!=l&&"Chrome"!=l[1]&&null==/\biPod\b|\biPad\b/g.exec(navigator.userAgent)){var c=i.indexOf(document.activeElement);c>-1&&(c+=r?-1:1),t.preventDefault(),i[c].focus()}}else t.preventDefault()};var n,r=e("./tabbable"),o=(n=r)&&n.__esModule?n:{default:n};t.exports=i.default},{"./tabbable":303}],303:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){return[].slice.call(e.querySelectorAll("*"),0).filter(s)};var n=/input|select|textarea|button|object/;function r(e){var t=e.offsetWidth<=0&&e.offsetHeight<=0;if(t&&!e.innerHTML)return!0;var i=window.getComputedStyle(e);return t?"visible"!==i.getPropertyValue("overflow"):"none"==i.getPropertyValue("display")}function o(e,t){var i=e.nodeName.toLowerCase();return(n.test(i)&&!e.disabled||"a"===i&&e.href||t)&&function(e){for(var t=e;t&&t!==document.body;){if(r(t))return!1;t=t.parentNode}return!0}(e)}function s(e){var t=e.getAttribute("tabindex");null===t&&(t=void 0);var i=isNaN(t);return(i||t>=0)&&o(e,!i)}t.exports=i.default},{}],304:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,r=e("./components/Modal"),o=(n=r)&&n.__esModule?n:{default:n};i.default=o.default,t.exports=i.default},{"./components/Modal":296}],305:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireWildcard"),r=e("@babel/runtime/helpers/interopRequireDefault");i.__esModule=!0,i.createProvider=c,i.default=void 0;var o=r(e("@babel/runtime/helpers/inheritsLoose")),s=n(e("react")),a=r(e("prop-types")),l=e("../utils/PropTypes");r(e("../utils/warning")),s.default.forwardRef;function c(e){var t;void 0===e&&(e="store");var i=e+"Subscription",n=function(t){(0,o.default)(r,t);var n=r.prototype;function r(i,n){var r;return(r=t.call(this,i,n)||this)[e]=i.store,r}return n.getChildContext=function(){var t;return(t={})[e]=this[e],t[i]=null,t},n.render=function(){return s.Children.only(this.props.children)},r}(s.Component);return n.propTypes={store:l.storeShape.isRequired,children:a.default.element.isRequired},n.childContextTypes=((t={})[e]=l.storeShape.isRequired,t[i]=l.subscriptionShape,t),n}var u=c();i.default=u},{"../utils/PropTypes":315,"../utils/warning":320,"@babel/runtime/helpers/inheritsLoose":154,"@babel/runtime/helpers/interopRequireDefault":155,"@babel/runtime/helpers/interopRequireWildcard":156,"prop-types":287,react:335}],306:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireWildcard"),r=e("@babel/runtime/helpers/interopRequireDefault");i.__esModule=!0,i.default=function(e,t){var i,n;void 0===t&&(t={});var r=t,y=r.getDisplayName,k=void 0===y?function(e){return"ConnectAdvanced("+e+")"}:y,w=r.methodName,x=void 0===w?"connectAdvanced":w,E=r.renderCountProp,C=void 0===E?void 0:E,S=r.shouldHandleStateChanges,_=void 0===S||S,T=r.storeKey,A=void 0===T?"store":T,N=r.withRef,I=void 0!==N&&N,O=(0,l.default)(r,["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef"]),P=A+"Subscription",D=g++,L=((i={})[A]=f.storeShape,i[P]=f.subscriptionShape,i),R=((n={})[P]=f.subscriptionShape,n);return function(t){(0,u.default)((0,p.isValidElementType)(t),"You must pass a component to the function returned by "+x+". Instead received "+JSON.stringify(t));var i=t.displayName||t.name||"Component",n=k(i),r=(0,a.default)({},O,{getDisplayName:k,methodName:x,renderCountProp:C,shouldHandleStateChanges:_,storeKey:A,withRef:I,displayName:n,wrappedComponentName:i,WrappedComponent:t}),l=function(i){function l(e,t){var r;return(r=i.call(this,e,t)||this).version=D,r.state={},r.renderCount=0,r.store=e[A]||t[A],r.propsMode=Boolean(e[A]),r.setWrappedInstance=r.setWrappedInstance.bind((0,s.default)((0,s.default)(r))),(0,u.default)(r.store,'Could not find "'+A+'" in either the context or props of "'+n+'". Either wrap the root component in a <Provider>, or explicitly pass "'+A+'" as a prop to "'+n+'".'),r.initSelector(),r.initSubscription(),r}(0,o.default)(l,i);var c=l.prototype;return c.getChildContext=function(){var e,t=this.propsMode?null:this.subscription;return(e={})[P]=t||this.context[P],e},c.componentDidMount=function(){_&&(this.subscription.trySubscribe(),this.selector.run(this.props),this.selector.shouldComponentUpdate&&this.forceUpdate())},c.componentWillReceiveProps=function(e){this.selector.run(e)},c.shouldComponentUpdate=function(){return this.selector.shouldComponentUpdate},c.componentWillUnmount=function(){this.subscription&&this.subscription.tryUnsubscribe(),this.subscription=null,this.notifyNestedSubs=v,this.store=null,this.selector.run=v,this.selector.shouldComponentUpdate=!1},c.getWrappedInstance=function(){return(0,u.default)(I,"To access the wrapped instance, you need to specify { withRef: true } in the options argument of the "+x+"() call."),this.wrappedInstance},c.setWrappedInstance=function(e){this.wrappedInstance=e},c.initSelector=function(){var t=e(this.store.dispatch,r);this.selector=function(e,t){var i={run:function(n){try{var r=e(t.getState(),n);(r!==i.props||i.error)&&(i.shouldComponentUpdate=!0,i.props=r,i.error=null)}catch(e){i.shouldComponentUpdate=!0,i.error=e}}};return i}(t,this.store),this.selector.run(this.props)},c.initSubscription=function(){if(_){var e=(this.propsMode?this.props:this.context)[P];this.subscription=new h.default(this.store,e,this.onStateChange.bind(this)),this.notifyNestedSubs=this.subscription.notifyNestedSubs.bind(this.subscription)}},c.onStateChange=function(){this.selector.run(this.props),this.selector.shouldComponentUpdate?(this.componentDidUpdate=this.notifyNestedSubsOnComponentDidUpdate,this.setState(b)):this.notifyNestedSubs()},c.notifyNestedSubsOnComponentDidUpdate=function(){this.componentDidUpdate=void 0,this.notifyNestedSubs()},c.isSubscribed=function(){return Boolean(this.subscription)&&this.subscription.isSubscribed()},c.addExtraProps=function(e){if(!(I||C||this.propsMode&&this.subscription))return e;var t=(0,a.default)({},e);return I&&(t.ref=this.setWrappedInstance),C&&(t[C]=this.renderCount++),this.propsMode&&this.subscription&&(t[P]=this.subscription),t},c.render=function(){var e=this.selector;if(e.shouldComponentUpdate=!1,e.error)throw e.error;return(0,d.createElement)(t,this.addExtraProps(e.props))},l}(d.Component);return m&&(l.prototype.UNSAFE_componentWillReceiveProps=l.prototype.componentWillReceiveProps,delete l.prototype.componentWillReceiveProps),l.WrappedComponent=t,l.displayName=n,l.childContextTypes=R,l.contextTypes=L,l.propTypes=L,(0,c.default)(l,t)}};var o=r(e("@babel/runtime/helpers/inheritsLoose")),s=r(e("@babel/runtime/helpers/assertThisInitialized")),a=r(e("@babel/runtime/helpers/extends")),l=r(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),c=r(e("hoist-non-react-statics")),u=r(e("invariant")),d=n(e("react")),p=e("react-is"),h=r(e("../utils/Subscription")),f=e("../utils/PropTypes"),m=void 0!==d.default.forwardRef,g=0,b={};function v(){}},{"../utils/PropTypes":315,"../utils/Subscription":316,"@babel/runtime/helpers/assertThisInitialized":152,"@babel/runtime/helpers/extends":153,"@babel/runtime/helpers/inheritsLoose":154,"@babel/runtime/helpers/interopRequireDefault":155,"@babel/runtime/helpers/interopRequireWildcard":156,"@babel/runtime/helpers/objectWithoutPropertiesLoose":157,"hoist-non-react-statics":198,invariant:202,react:335,"react-is":295}],307:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");i.__esModule=!0,i.createConnect=f,i.default=void 0;var r=n(e("@babel/runtime/helpers/extends")),o=n(e("@babel/runtime/helpers/objectWithoutPropertiesLoose")),s=n(e("../components/connectAdvanced")),a=n(e("../utils/shallowEqual")),l=n(e("./mapDispatchToProps")),c=n(e("./mapStateToProps")),u=n(e("./mergeProps")),d=n(e("./selectorFactory"));function p(e,t,i){for(var n=t.length-1;n>=0;n--){var r=t[n](e);if(r)return r}return function(t,n){throw new Error("Invalid value of type "+typeof e+" for "+i+" argument when connecting component "+n.wrappedComponentName+".")}}function h(e,t){return e===t}function f(e){var t=void 0===e?{}:e,i=t.connectHOC,n=void 0===i?s.default:i,f=t.mapStateToPropsFactories,m=void 0===f?c.default:f,g=t.mapDispatchToPropsFactories,b=void 0===g?l.default:g,v=t.mergePropsFactories,y=void 0===v?u.default:v,k=t.selectorFactory,w=void 0===k?d.default:k;return function(e,t,i,s){void 0===s&&(s={});var l=s,c=l.pure,u=void 0===c||c,d=l.areStatesEqual,f=void 0===d?h:d,g=l.areOwnPropsEqual,v=void 0===g?a.default:g,k=l.areStatePropsEqual,x=void 0===k?a.default:k,E=l.areMergedPropsEqual,C=void 0===E?a.default:E,S=(0,o.default)(l,["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"]),_=p(e,m,"mapStateToProps"),T=p(t,b,"mapDispatchToProps"),A=p(i,y,"mergeProps");return n(w,(0,r.default)({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:_,initMapDispatchToProps:T,initMergeProps:A,pure:u,areStatesEqual:f,areOwnPropsEqual:v,areStatePropsEqual:x,areMergedPropsEqual:C},S))}}var m=f();i.default=m},{"../components/connectAdvanced":306,"../utils/shallowEqual":318,"./mapDispatchToProps":308,"./mapStateToProps":309,"./mergeProps":310,"./selectorFactory":311,"@babel/runtime/helpers/extends":153,"@babel/runtime/helpers/interopRequireDefault":155,"@babel/runtime/helpers/objectWithoutPropertiesLoose":157}],308:[function(e,t,i){"use strict";i.__esModule=!0,i.whenMapDispatchToPropsIsFunction=o,i.whenMapDispatchToPropsIsMissing=s,i.whenMapDispatchToPropsIsObject=a,i.default=void 0;var n=e("redux"),r=e("./wrapMapToProps");function o(e){return"function"==typeof e?(0,r.wrapMapToPropsFunc)(e,"mapDispatchToProps"):void 0}function s(e){return e?void 0:(0,r.wrapMapToPropsConstant)((function(e){return{dispatch:e}}))}function a(e){return e&&"object"==typeof e?(0,r.wrapMapToPropsConstant)((function(t){return(0,n.bindActionCreators)(e,t)})):void 0}var l=[o,s,a];i.default=l},{"./wrapMapToProps":313,redux:356}],309:[function(e,t,i){"use strict";i.__esModule=!0,i.whenMapStateToPropsIsFunction=r,i.whenMapStateToPropsIsMissing=o,i.default=void 0;var n=e("./wrapMapToProps");function r(e){return"function"==typeof e?(0,n.wrapMapToPropsFunc)(e,"mapStateToProps"):void 0}function o(e){return e?void 0:(0,n.wrapMapToPropsConstant)((function(){return{}}))}var s=[r,o];i.default=s},{"./wrapMapToProps":313}],310:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");i.__esModule=!0,i.defaultMergeProps=o,i.wrapMergePropsFunc=s,i.whenMergePropsIsFunction=a,i.whenMergePropsIsOmitted=l,i.default=void 0;var r=n(e("@babel/runtime/helpers/extends"));n(e("../utils/verifyPlainObject"));function o(e,t,i){return(0,r.default)({},i,e,t)}function s(e){return function(t,i){i.displayName;var n,r=i.pure,o=i.areMergedPropsEqual,s=!1;return function(t,i,a){var l=e(t,i,a);return s?r&&o(l,n)||(n=l):(s=!0,n=l),n}}}function a(e){return"function"==typeof e?s(e):void 0}function l(e){return e?void 0:function(){return o}}var c=[a,l];i.default=c},{"../utils/verifyPlainObject":319,"@babel/runtime/helpers/extends":153,"@babel/runtime/helpers/interopRequireDefault":155}],311:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");i.__esModule=!0,i.impureFinalPropsSelectorFactory=o,i.pureFinalPropsSelectorFactory=s,i.default=function(e,t){var i=t.initMapStateToProps,n=t.initMapDispatchToProps,a=t.initMergeProps,l=(0,r.default)(t,["initMapStateToProps","initMapDispatchToProps","initMergeProps"]),c=i(e,l),u=n(e,l),d=a(e,l);return(l.pure?s:o)(c,u,d,e,l)};var r=n(e("@babel/runtime/helpers/objectWithoutPropertiesLoose"));n(e("./verifySubselectors"));function o(e,t,i,n){return function(r,o){return i(e(r,o),t(n,o),o)}}function s(e,t,i,n,r){var o,s,a,l,c,u=r.areStatesEqual,d=r.areOwnPropsEqual,p=r.areStatePropsEqual,h=!1;function f(r,h){var f,m,g=!d(h,s),b=!u(r,o);return o=r,s=h,g&&b?(a=e(o,s),t.dependsOnOwnProps&&(l=t(n,s)),c=i(a,l,s)):g?(e.dependsOnOwnProps&&(a=e(o,s)),t.dependsOnOwnProps&&(l=t(n,s)),c=i(a,l,s)):b?(f=e(o,s),m=!p(f,a),a=f,m&&(c=i(a,l,s)),c):c}return function(r,u){return h?f(r,u):(a=e(o=r,s=u),l=t(n,s),c=i(a,l,s),h=!0,c)}}},{"./verifySubselectors":312,"@babel/runtime/helpers/interopRequireDefault":155,"@babel/runtime/helpers/objectWithoutPropertiesLoose":157}],312:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");i.__esModule=!0,i.default=function(e,t,i,n){o(e,"mapStateToProps",n),o(t,"mapDispatchToProps",n),o(i,"mergeProps",n)};var r=n(e("../utils/warning"));function o(e,t,i){if(!e)throw new Error("Unexpected value for "+t+" in "+i+".");"mapStateToProps"!==t&&"mapDispatchToProps"!==t||e.hasOwnProperty("dependsOnOwnProps")||(0,r.default)("The selector for "+t+" of "+i+" did not specify a value for dependsOnOwnProps.")}},{"../utils/warning":320,"@babel/runtime/helpers/interopRequireDefault":155}],313:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");i.__esModule=!0,i.wrapMapToPropsConstant=function(e){return function(t,i){var n=e(t,i);function r(){return n}return r.dependsOnOwnProps=!1,r}},i.getDependsOnOwnProps=r,i.wrapMapToPropsFunc=function(e,t){return function(t,i){i.displayName;var n=function(e,t){return n.dependsOnOwnProps?n.mapToProps(e,t):n.mapToProps(e)};return n.dependsOnOwnProps=!0,n.mapToProps=function(t,i){n.mapToProps=e,n.dependsOnOwnProps=r(e);var o=n(t,i);return"function"==typeof o&&(n.mapToProps=o,n.dependsOnOwnProps=r(o),o=n(t,i)),o},n}};n(e("../utils/verifyPlainObject"));function r(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}},{"../utils/verifyPlainObject":319,"@babel/runtime/helpers/interopRequireDefault":155}],314:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),r=e("@babel/runtime/helpers/interopRequireWildcard");i.__esModule=!0;var o=r(e("./components/Provider"));i.Provider=o.default,i.createProvider=o.createProvider;var s=n(e("./components/connectAdvanced"));i.connectAdvanced=s.default;var a=n(e("./connect/connect"));i.connect=a.default},{"./components/Provider":305,"./components/connectAdvanced":306,"./connect/connect":307,"@babel/runtime/helpers/interopRequireDefault":155,"@babel/runtime/helpers/interopRequireWildcard":156}],315:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");i.__esModule=!0,i.storeShape=i.subscriptionShape=void 0;var r=n(e("prop-types")),o=r.default.shape({trySubscribe:r.default.func.isRequired,tryUnsubscribe:r.default.func.isRequired,notifyNestedSubs:r.default.func.isRequired,isSubscribed:r.default.func.isRequired});i.subscriptionShape=o;var s=r.default.shape({subscribe:r.default.func.isRequired,dispatch:r.default.func.isRequired,getState:r.default.func.isRequired});i.storeShape=s},{"@babel/runtime/helpers/interopRequireDefault":155,"prop-types":287}],316:[function(e,t,i){"use strict";i.__esModule=!0,i.default=void 0;var n=null,r={notify:function(){}};var o=function(){function e(e,t,i){this.store=e,this.parentSub=t,this.onStateChange=i,this.unsubscribe=null,this.listeners=r}var t=e.prototype;return t.addNestedSub=function(e){return this.trySubscribe(),this.listeners.subscribe(e)},t.notifyNestedSubs=function(){this.listeners.notify()},t.isSubscribed=function(){return Boolean(this.unsubscribe)},t.trySubscribe=function(){this.unsubscribe||(this.unsubscribe=this.parentSub?this.parentSub.addNestedSub(this.onStateChange):this.store.subscribe(this.onStateChange),this.listeners=function(){var e=[],t=[];return{clear:function(){t=n,e=n},notify:function(){for(var i=e=t,n=0;n<i.length;n++)i[n]()},get:function(){return t},subscribe:function(i){var r=!0;return t===e&&(t=e.slice()),t.push(i),function(){r&&e!==n&&(r=!1,t===e&&(t=e.slice()),t.splice(t.indexOf(i),1))}}}}())},t.tryUnsubscribe=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null,this.listeners.clear(),this.listeners=r)},e}();i.default=o},{}],317:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e){if("object"!=typeof e||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var i=t;null!==Object.getPrototypeOf(i);)i=Object.getPrototypeOf(i);return t===i}},{}],318:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e,t){if(r(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),o=Object.keys(t);if(i.length!==o.length)return!1;for(var s=0;s<i.length;s++)if(!n.call(t,i[s])||!r(e[i[s]],t[i[s]]))return!1;return!0};var n=Object.prototype.hasOwnProperty;function r(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}},{}],319:[function(e,t,i){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault");i.__esModule=!0,i.default=function(e,t,i){(0,r.default)(e)||(0,o.default)(i+"() in "+t+" must return a plain object. Instead received "+e+".")};var r=n(e("./isPlainObject")),o=n(e("./warning"))},{"./isPlainObject":317,"./warning":320,"@babel/runtime/helpers/interopRequireDefault":155}],320:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}},{}],321:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default={GLOBAL:{HIDE:"__react_tooltip_hide_event",REBUILD:"__react_tooltip_rebuild_event",SHOW:"__react_tooltip_show_event"}}},{}],322:[function(e,t,i){"use strict";function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){e.prototype.isCustomEvent=function(e){return this.state.event||!!e.getAttribute("data-event")},e.prototype.customBindListener=function(e){var t=this,i=this.state,n=i.event,o=i.eventOff,a=e.getAttribute("data-event")||n,l=e.getAttribute("data-event-off")||o;a.split(" ").forEach((function(i){e.removeEventListener(i,s.get(e,i));var n=r.bind(t,l);s.set(e,i,n),e.addEventListener(i,n,!1)})),l&&l.split(" ").forEach((function(i){e.removeEventListener(i,t.hideTooltip),e.addEventListener(i,t.hideTooltip,!1)}))},e.prototype.customUnbindListener=function(e){var t=this.state,i=t.event,n=t.eventOff,r=i||e.getAttribute("data-event"),o=n||e.getAttribute("data-event-off");e.removeEventListener(r,s.get(e,i)),o&&e.removeEventListener(o,this.hideTooltip)}};var r=function(e,t){var i=this.state.show,n=this.props.id,r=t.currentTarget.getAttribute("data-iscapture"),s=r&&"true"===r||this.props.isCapture,a=t.currentTarget.getAttribute("currentItem");s||t.stopPropagation(),i&&"true"===a?e||this.hideTooltip(t):(t.currentTarget.setAttribute("currentItem","true"),o(t.currentTarget,this.getTargetArray(n)),this.showTooltip(t))},o=function(e,t){for(var i=0;i<t.length;i++)e!==t[i]?t[i].setAttribute("currentItem","false"):t[i].setAttribute("currentItem","true")},s={id:"9b69f92e-d3fe-498b-b1b4-c5e63a51b0cf",set:function(e,t,i){this.id in e?e[this.id][t]=i:Object.defineProperty(e,this.id,{configurable:!0,value:n({},t,i)})},get:function(e,t){var i=e[this.id];if(void 0!==i)return i[t]}}},{}],323:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){e.prototype.getEffect=function(e){return e.getAttribute("data-effect")||this.props.effect||"float"}}},{}],324:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){e.prototype.isCapture=function(e){return e&&"true"===e.getAttribute("data-iscapture")||this.props.isCapture||!1}}},{}],325:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){e.hide=function(e){s(o.default.GLOBAL.HIDE,{target:e})},e.rebuild=function(){s(o.default.GLOBAL.REBUILD)},e.show=function(e){s(o.default.GLOBAL.SHOW,{target:e})},e.prototype.globalRebuild=function(){this.mount&&(this.unbindListener(),this.bindListener())},e.prototype.globalShow=function(e){if(this.mount){var t={currentTarget:e.detail.target};this.showTooltip(t,!0)}},e.prototype.globalHide=function(e){if(this.mount){var t=!!(e&&e.detail&&e.detail.target);this.hideTooltip({currentTarget:t&&e.detail.target},t)}}};var n,r=e("../constant"),o=(n=r)&&n.__esModule?n:{default:n};var s=function(e,t){var i=void 0;"function"==typeof window.CustomEvent?i=new window.CustomEvent(e,{detail:t}):((i=document.createEvent("Event")).initEvent(e,!1,!0),i.detail=t),window.dispatchEvent(i)}},{"../constant":321}],326:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){e.prototype.bindRemovalTracker=function(){var e=this,t=n();if(null!=t){var i=new t((function(t){for(var i=0;i<t.length;i++)for(var n=t[i],r=0;r<n.removedNodes.length;r++)if(n.removedNodes[r]===e.state.currentTarget)return void e.hideTooltip()}));i.observe(window.document,{childList:!0,subtree:!0}),this.removalTracker=i}},e.prototype.unbindRemovalTracker=function(){this.removalTracker&&(this.removalTracker.disconnect(),this.removalTracker=null)}};var n=function(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}},{}],327:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){e.prototype.bindWindowEvents=function(e){window.removeEventListener(o.default.GLOBAL.HIDE,this.globalHide),window.addEventListener(o.default.GLOBAL.HIDE,this.globalHide,!1),window.removeEventListener(o.default.GLOBAL.REBUILD,this.globalRebuild),window.addEventListener(o.default.GLOBAL.REBUILD,this.globalRebuild,!1),window.removeEventListener(o.default.GLOBAL.SHOW,this.globalShow),window.addEventListener(o.default.GLOBAL.SHOW,this.globalShow,!1),e&&(window.removeEventListener("resize",this.onWindowResize),window.addEventListener("resize",this.onWindowResize,!1))},e.prototype.unbindWindowEvents=function(){window.removeEventListener(o.default.GLOBAL.HIDE,this.globalHide),window.removeEventListener(o.default.GLOBAL.REBUILD,this.globalRebuild),window.removeEventListener(o.default.GLOBAL.SHOW,this.globalShow),window.removeEventListener("resize",this.onWindowResize)},e.prototype.onWindowResize=function(){this.mount&&this.hideTooltip()}};var n,r=e("../constant"),o=(n=r)&&n.__esModule?n:{default:n}},{"../constant":321}],328:[function(e,t,i){"use strict";var n,r,o,s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=C(e("react")),c=C(e("prop-types")),u=C(e("react-dom")),d=C(e("classnames")),p=C(e("sanitize-html-react")),h=C(e("./decorators/staticMethods")),f=C(e("./decorators/windowListener")),m=C(e("./decorators/customEvent")),g=C(e("./decorators/isCapture")),b=C(e("./decorators/getEffect")),v=C(e("./decorators/trackRemoval")),y=C(e("./utils/getPosition")),k=C(e("./utils/getTipContent")),w=e("./utils/aria"),x=C(e("./utils/nodeListToArray")),E=C(e("./style"));function C(e){return e&&e.__esModule?e:{default:e}}var S=(0,h.default)(n=(0,f.default)(n=(0,m.default)(n=(0,g.default)(n=(0,b.default)(n=(0,v.default)((o=r=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.state={place:e.place||"top",desiredPlace:e.place||"top",type:"dark",effect:"float",show:!1,border:!1,offset:{},extraClass:"",html:!1,delayHide:0,delayShow:0,event:e.event||null,eventOff:e.eventOff||null,currentEvent:null,currentTarget:null,ariaProps:(0,w.parseAria)(e),isEmptyTip:!1,disable:!1,originTooltip:null,isMultiline:!1},i.bind(["showTooltip","updateTooltip","hideTooltip","getTooltipContent","globalRebuild","globalShow","globalHide","onWindowResize","mouseOnToolTip"]),i.mount=!0,i.delayShowLoop=null,i.delayHideLoop=null,i.delayReshow=null,i.intervalUpdateContent=null,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.default.Component),a(t,[{key:"bind",value:function(e){var t=this;e.forEach((function(e){t[e]=t[e].bind(t)}))}},{key:"componentDidMount",value:function(){var e=this.props,t=e.insecure,i=e.resizeHide;t&&this.setStyleHeader(),this.bindListener(),this.bindWindowEvents(i)}},{key:"componentWillReceiveProps",value:function(e){var t=this.state.ariaProps,i=(0,w.parseAria)(e);Object.keys(i).some((function(e){return i[e]!==t[e]}))&&this.setState({ariaProps:i})}},{key:"componentWillUnmount",value:function(){this.mount=!1,this.clearTimer(),this.unbindListener(),this.removeScrollListener(),this.unbindWindowEvents()}},{key:"mouseOnToolTip",value:function(){return!(!this.state.show||!this.tooltipRef)&&(this.tooltipRef.matches||(this.tooltipRef.matches=this.tooltipRef.msMatchesSelector),this.tooltipRef.matches(":hover"))}},{key:"getTargetArray",value:function(e){var t=void 0;if(e){var i=e.replace(/\\/g,"\\\\").replace(/"/g,'\\"');t=document.querySelectorAll('[data-tip][data-for="'+i+'"]')}else t=document.querySelectorAll("[data-tip]:not([data-for])");return(0,x.default)(t)}},{key:"bindListener",value:function(){var e=this,t=this.props,i=t.id,n=t.globalEventOff,r=t.isCapture;this.getTargetArray(i).forEach((function(t){var i=e.isCapture(t),n=e.getEffect(t);null===t.getAttribute("currentItem")&&t.setAttribute("currentItem","false"),e.unbindBasicListener(t),e.isCustomEvent(t)?e.customBindListener(t):(t.addEventListener("mouseenter",e.showTooltip,i),"float"===n&&t.addEventListener("mousemove",e.updateTooltip,i),t.addEventListener("mouseleave",e.hideTooltip,i))})),n&&(window.removeEventListener(n,this.hideTooltip),window.addEventListener(n,this.hideTooltip,r)),this.bindRemovalTracker()}},{key:"unbindListener",value:function(){var e=this,t=this.props,i=t.id,n=t.globalEventOff;this.getTargetArray(i).forEach((function(t){e.unbindBasicListener(t),e.isCustomEvent(t)&&e.customUnbindListener(t)})),n&&window.removeEventListener(n,this.hideTooltip),this.unbindRemovalTracker()}},{key:"unbindBasicListener",value:function(e){var t=this.isCapture(e);e.removeEventListener("mouseenter",this.showTooltip,t),e.removeEventListener("mousemove",this.updateTooltip,t),e.removeEventListener("mouseleave",this.hideTooltip,t)}},{key:"getTooltipContent",value:function(){var e=this.props,t=e.getContent,i=e.children,n=void 0;return t&&(n=Array.isArray(t)?t[0]&&t[0](this.state.originTooltip):t(this.state.originTooltip)),(0,k.default)(this.state.originTooltip,i,n,this.state.isMultiline)}},{key:"isEmptyTip",value:function(e){return"string"==typeof e&&""===e||null===e}},{key:"showTooltip",value:function(e,t){if(!t||this.getTargetArray(this.props.id).some((function(t){return t===e.currentTarget}))){var i=this.props,n=i.multiline,r=i.getContent,o=e.currentTarget.getAttribute("data-tip"),s=e.currentTarget.getAttribute("data-multiline")||n||!1,a=e instanceof window.FocusEvent||t,l=!0;e.currentTarget.getAttribute("data-scroll-hide")?l="true"===e.currentTarget.getAttribute("data-scroll-hide"):null!=this.props.scrollHide&&(l=this.props.scrollHide);var c=e.currentTarget.getAttribute("data-place")||this.props.place||"top",d=a?"solid":this.getEffect(e.currentTarget),p=e.currentTarget.getAttribute("data-offset")||this.props.offset||{},h=(0,y.default)(e,e.currentTarget,u.default.findDOMNode(this),c,c,d,p),f=h.isNewState?h.newState.place:c;this.clearTimer();var m=e.currentTarget,g=this.state.show?m.getAttribute("data-delay-update")||this.props.delayUpdate:0,b=this,v=function(){b.setState({originTooltip:o,isMultiline:s,desiredPlace:c,place:f,type:m.getAttribute("data-type")||b.props.type||"dark",effect:d,offset:p,html:m.getAttribute("data-html")?"true"===m.getAttribute("data-html"):b.props.html||!1,delayShow:m.getAttribute("data-delay-show")||b.props.delayShow||0,delayHide:m.getAttribute("data-delay-hide")||b.props.delayHide||0,delayUpdate:m.getAttribute("data-delay-update")||b.props.delayUpdate||0,border:m.getAttribute("data-border")?"true"===m.getAttribute("data-border"):b.props.border||!1,extraClass:m.getAttribute("data-class")||b.props.class||b.props.className||"",disable:m.getAttribute("data-tip-disable")?"true"===m.getAttribute("data-tip-disable"):b.props.disable||!1,currentTarget:m},(function(){l&&b.addScrollListener(b.state.currentTarget),b.updateTooltip(e),r&&Array.isArray(r)&&(b.intervalUpdateContent=setInterval((function(){if(b.mount){var e=b.props.getContent,t=(0,k.default)(o,"",e[0](),s),i=b.isEmptyTip(t);b.setState({isEmptyTip:i}),b.updatePosition()}}),r[1]))}))};g?this.delayReshow=setTimeout(v,g):v()}}},{key:"updateTooltip",value:function(e){var t=this,i=this.state,n=i.delayShow,r=i.disable,o=this.props.afterShow,s=this.getTooltipContent(),a=parseInt(n,10),l=e.currentTarget||e.target;if(!this.mouseOnToolTip()&&!this.isEmptyTip(s)&&!r){var c=function(){if(Array.isArray(s)&&s.length>0||s){var i=!t.state.show;t.setState({currentEvent:e,currentTarget:l,show:!0},(function(){t.updatePosition(),i&&o&&o()}))}};clearTimeout(this.delayShowLoop),n?this.delayShowLoop=setTimeout(c,a):c()}}},{key:"listenForTooltipExit",value:function(){this.state.show&&this.tooltipRef&&this.tooltipRef.addEventListener("mouseleave",this.hideTooltip)}},{key:"removeListenerForTooltipExit",value:function(){this.state.show&&this.tooltipRef&&this.tooltipRef.removeEventListener("mouseleave",this.hideTooltip)}},{key:"hideTooltip",value:function(e,t){var i=this,n=this.state,r=n.delayHide,o=n.disable,s=this.props.afterHide,a=this.getTooltipContent();if(this.mount&&!this.isEmptyTip(a)&&!o){if(t&&(!this.getTargetArray(this.props.id).some((function(t){return t===e.currentTarget}))||!this.state.show))return;var l=function(){var e=i.state.show;i.mouseOnToolTip()?i.listenForTooltipExit():(i.removeListenerForTooltipExit(),i.setState({show:!1},(function(){i.removeScrollListener(),e&&s&&s()})))};this.clearTimer(),r?this.delayHideLoop=setTimeout(l,parseInt(r,10)):l()}}},{key:"addScrollListener",value:function(e){var t=this.isCapture(e);window.addEventListener("scroll",this.hideTooltip,t)}},{key:"removeScrollListener",value:function(){window.removeEventListener("scroll",this.hideTooltip)}},{key:"updatePosition",value:function(){var e=this,t=this.state,i=t.currentEvent,n=t.currentTarget,r=t.place,o=t.desiredPlace,s=t.effect,a=t.offset,l=u.default.findDOMNode(this),c=(0,y.default)(i,n,l,r,o,s,a);if(c.isNewState)return this.setState(c.newState,(function(){e.updatePosition()}));l.style.left=c.position.left+"px",l.style.top=c.position.top+"px"}},{key:"setStyleHeader",value:function(){var e=document.getElementsByTagName("head")[0];if(!e.querySelector('style[id="react-tooltip"]')){var t=document.createElement("style");t.id="react-tooltip",t.innerHTML=E.default,"undefined"!=typeof __webpack_nonce__&&__webpack_nonce__&&t.setAttribute("nonce",__webpack_nonce__),e.insertBefore(t,e.firstChild)}}},{key:"clearTimer",value:function(){clearTimeout(this.delayShowLoop),clearTimeout(this.delayHideLoop),clearTimeout(this.delayReshow),clearInterval(this.intervalUpdateContent)}},{key:"render",value:function(){var e=this,i=this.state,n=i.extraClass,r=i.html,o=i.ariaProps,a=i.disable,c=this.getTooltipContent(),u=this.isEmptyTip(c),h=(0,d.default)("__react_component_tooltip",{show:this.state.show&&!a&&!u},{border:this.state.border},{"place-top":"top"===this.state.place},{"place-bottom":"bottom"===this.state.place},{"place-left":"left"===this.state.place},{"place-right":"right"===this.state.place},{"type-dark":"dark"===this.state.type},{"type-success":"success"===this.state.type},{"type-warning":"warning"===this.state.type},{"type-error":"error"===this.state.type},{"type-info":"info"===this.state.type},{"type-light":"light"===this.state.type},{allow_hover:this.props.delayUpdate}),f=this.props.wrapper;return t.supportedWrappers.indexOf(f)<0&&(f=t.defaultProps.wrapper),r?l.default.createElement(f,s({className:h+" "+n,id:this.props.id,ref:function(t){return e.tooltipRef=t}},o,{"data-id":"tooltip",dangerouslySetInnerHTML:{__html:(0,p.default)(c,this.props.sanitizeHtmlOptions)}})):l.default.createElement(f,s({className:h+" "+n,id:this.props.id},o,{ref:function(t){return e.tooltipRef=t},"data-id":"tooltip"}),c)}}]),t}(),r.propTypes={children:c.default.any,place:c.default.string,type:c.default.string,effect:c.default.string,offset:c.default.object,multiline:c.default.bool,border:c.default.bool,insecure:c.default.bool,class:c.default.string,className:c.default.string,id:c.default.string,html:c.default.bool,delayHide:c.default.number,delayUpdate:c.default.number,delayShow:c.default.number,event:c.default.string,eventOff:c.default.string,watchWindow:c.default.bool,isCapture:c.default.bool,globalEventOff:c.default.string,getContent:c.default.any,afterShow:c.default.func,afterHide:c.default.func,disable:c.default.bool,scrollHide:c.default.bool,resizeHide:c.default.bool,wrapper:c.default.string,sanitizeHtmlOptions:c.default.any},r.defaultProps={insecure:!0,resizeHide:!0,wrapper:"div"},r.supportedWrappers=["div","span"],r.displayName="ReactTooltip",n=o))||n)||n)||n)||n)||n)||n;t.exports=S},{"./decorators/customEvent":322,"./decorators/getEffect":323,"./decorators/isCapture":324,"./decorators/staticMethods":325,"./decorators/trackRemoval":326,"./decorators/windowListener":327,"./style":329,"./utils/aria":330,"./utils/getPosition":331,"./utils/getTipContent":332,"./utils/nodeListToArray":333,classnames:169,"prop-types":287,react:335,"react-dom":291,"sanitize-html-react":360}],329:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default='.__react_component_tooltip{border-radius:3px;display:inline-block;font-size:13px;left:-999em;opacity:0;padding:8px 21px;position:fixed;pointer-events:none;transition:opacity 0.3s ease-out;top:-999em;visibility:hidden;z-index:999}.__react_component_tooltip.allow_hover{pointer-events:auto}.__react_component_tooltip:before,.__react_component_tooltip:after{content:"";width:0;height:0;position:absolute}.__react_component_tooltip.show{opacity:0.9;margin-top:0px;margin-left:0px;visibility:visible}.__react_component_tooltip.type-dark{color:#fff;background-color:#222}.__react_component_tooltip.type-dark.place-top:after{border-top-color:#222;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-dark.place-bottom:after{border-bottom-color:#222;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-dark.place-left:after{border-left-color:#222;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-dark.place-right:after{border-right-color:#222;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-dark.border{border:1px solid #fff}.__react_component_tooltip.type-dark.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-dark.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-dark.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-dark.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-success{color:#fff;background-color:#8DC572}.__react_component_tooltip.type-success.place-top:after{border-top-color:#8DC572;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-success.place-bottom:after{border-bottom-color:#8DC572;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-success.place-left:after{border-left-color:#8DC572;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-success.place-right:after{border-right-color:#8DC572;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-success.border{border:1px solid #fff}.__react_component_tooltip.type-success.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-success.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-success.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-success.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-warning{color:#fff;background-color:#F0AD4E}.__react_component_tooltip.type-warning.place-top:after{border-top-color:#F0AD4E;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-warning.place-bottom:after{border-bottom-color:#F0AD4E;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-warning.place-left:after{border-left-color:#F0AD4E;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-warning.place-right:after{border-right-color:#F0AD4E;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-warning.border{border:1px solid #fff}.__react_component_tooltip.type-warning.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-warning.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-warning.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-warning.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-error{color:#fff;background-color:#BE6464}.__react_component_tooltip.type-error.place-top:after{border-top-color:#BE6464;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-error.place-bottom:after{border-bottom-color:#BE6464;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-error.place-left:after{border-left-color:#BE6464;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-error.place-right:after{border-right-color:#BE6464;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-error.border{border:1px solid #fff}.__react_component_tooltip.type-error.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-error.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-error.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-error.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-info{color:#fff;background-color:#337AB7}.__react_component_tooltip.type-info.place-top:after{border-top-color:#337AB7;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-info.place-bottom:after{border-bottom-color:#337AB7;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-info.place-left:after{border-left-color:#337AB7;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-info.place-right:after{border-right-color:#337AB7;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-info.border{border:1px solid #fff}.__react_component_tooltip.type-info.border.place-top:before{border-top:8px solid #fff}.__react_component_tooltip.type-info.border.place-bottom:before{border-bottom:8px solid #fff}.__react_component_tooltip.type-info.border.place-left:before{border-left:8px solid #fff}.__react_component_tooltip.type-info.border.place-right:before{border-right:8px solid #fff}.__react_component_tooltip.type-light{color:#222;background-color:#fff}.__react_component_tooltip.type-light.place-top:after{border-top-color:#fff;border-top-style:solid;border-top-width:6px}.__react_component_tooltip.type-light.place-bottom:after{border-bottom-color:#fff;border-bottom-style:solid;border-bottom-width:6px}.__react_component_tooltip.type-light.place-left:after{border-left-color:#fff;border-left-style:solid;border-left-width:6px}.__react_component_tooltip.type-light.place-right:after{border-right-color:#fff;border-right-style:solid;border-right-width:6px}.__react_component_tooltip.type-light.border{border:1px solid #222}.__react_component_tooltip.type-light.border.place-top:before{border-top:8px solid #222}.__react_component_tooltip.type-light.border.place-bottom:before{border-bottom:8px solid #222}.__react_component_tooltip.type-light.border.place-left:before{border-left:8px solid #222}.__react_component_tooltip.type-light.border.place-right:before{border-right:8px solid #222}.__react_component_tooltip.place-top{margin-top:-10px}.__react_component_tooltip.place-top:before{border-left:10px solid transparent;border-right:10px solid transparent;bottom:-8px;left:50%;margin-left:-10px}.__react_component_tooltip.place-top:after{border-left:8px solid transparent;border-right:8px solid transparent;bottom:-6px;left:50%;margin-left:-8px}.__react_component_tooltip.place-bottom{margin-top:10px}.__react_component_tooltip.place-bottom:before{border-left:10px solid transparent;border-right:10px solid transparent;top:-8px;left:50%;margin-left:-10px}.__react_component_tooltip.place-bottom:after{border-left:8px solid transparent;border-right:8px solid transparent;top:-6px;left:50%;margin-left:-8px}.__react_component_tooltip.place-left{margin-left:-10px}.__react_component_tooltip.place-left:before{border-top:6px solid transparent;border-bottom:6px solid transparent;right:-8px;top:50%;margin-top:-5px}.__react_component_tooltip.place-left:after{border-top:5px solid transparent;border-bottom:5px solid transparent;right:-6px;top:50%;margin-top:-4px}.__react_component_tooltip.place-right{margin-left:10px}.__react_component_tooltip.place-right:before{border-top:6px solid transparent;border-bottom:6px solid transparent;left:-8px;top:50%;margin-top:-5px}.__react_component_tooltip.place-right:after{border-top:5px solid transparent;border-bottom:5px solid transparent;left:-6px;top:50%;margin-top:-4px}.__react_component_tooltip .multi-line{display:block;padding:2px 0px;text-align:center}'},{}],330:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.parseAria=function(e){var t={};return Object.keys(e).filter((function(e){return/(^aria-\w+$|^role$)/.test(e)})).forEach((function(i){t[i]=e[i]})),t}},{}],331:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e,t,i,l,c,u,d){for(var p=n(i),h=p.width,f=p.height,m=n(t),g=m.width,b=m.height,v=r(e,t,u),y=v.mouseX,k=v.mouseY,w=o(u,g,b,h,f),x=s(d),E=x.extraOffset_X,C=x.extraOffset_Y,S=window.innerWidth,_=window.innerHeight,T=a(i),A=T.parentTop,N=T.parentLeft,I=function(e){var t=w[e].l;return y+t+E},O=function(e){var t=w[e].t;return k+t+C},P=function(e){return function(e){return I(e)<0}(e)||function(e){return t=w[e].r,y+t+E>S;var t}(e)||function(e){return O(e)<0}(e)||function(e){return t=w[e].b,k+t+C>_;var t}(e)},D=function(e){return!P(e)},L=["top","bottom","left","right"],R=[],M=0;M<4;M++){var B=L[M];D(B)&&R.push(B)}var j=!1,U=void 0;return D(c)&&c!==l?(j=!0,U=c):R.length>0&&P(c)&&P(l)&&(j=!0,U=R[0]),j?{isNewState:!0,newState:{place:U}}:{isNewState:!1,position:{left:parseInt(I(l)-N,10),top:parseInt(O(l)-A,10)}}};var n=function(e){var t=e.getBoundingClientRect(),i=t.height,n=t.width;return{height:parseInt(i,10),width:parseInt(n,10)}},r=function(e,t,i){var r=t.getBoundingClientRect(),o=r.top,s=r.left,a=n(t),l=a.width,c=a.height;return"float"===i?{mouseX:e.clientX,mouseY:e.clientY}:{mouseX:s+l/2,mouseY:o+c/2}},o=function(e,t,i,n,r){var o=void 0,s=void 0,a=void 0,l=void 0;return"float"===e?(o={l:-n/2,r:n/2,t:-(r+3+2),b:-3},a={l:-n/2,r:n/2,t:15,b:r+3+2+12},l={l:-(n+3+2),r:-3,t:-r/2,b:r/2},s={l:3,r:n+3+2,t:-r/2,b:r/2}):"solid"===e&&(o={l:-n/2,r:n/2,t:-(i/2+r+2),b:-i/2},a={l:-n/2,r:n/2,t:i/2,b:i/2+r+2},l={l:-(n+t/2+2),r:-t/2,t:-r/2,b:r/2},s={l:t/2,r:n+t/2+2,t:-r/2,b:r/2}),{top:o,bottom:a,left:l,right:s}},s=function(e){var t=0,i=0;for(var n in"[object String]"===Object.prototype.toString.apply(e)&&(e=JSON.parse(e.toString().replace(/\'/g,'"'))),e)"top"===n?i-=parseInt(e[n],10):"bottom"===n?i+=parseInt(e[n],10):"left"===n?t-=parseInt(e[n],10):"right"===n&&(t+=parseInt(e[n],10));return{extraOffset_X:t,extraOffset_Y:i}},a=function(e){for(var t=e;t&&"none"===window.getComputedStyle(t).getPropertyValue("transform");)t=t.parentElement;return{parentTop:t&&t.getBoundingClientRect().top||0,parentLeft:t&&t.getBoundingClientRect().left||0}}},{}],332:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e,t,i,n){if(t)return t;if(null!=i)return i;if(null===i)return null;var r=/<br\s*\/?>/;return n&&"false"!==n&&r.test(e)?e.split(r).map((function(e,t){return o.default.createElement("span",{key:t,className:"multi-line"},e)})):e};var n,r=e("react"),o=(n=r)&&n.__esModule?n:{default:n}},{react:335}],333:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){var t=e.length;return e.hasOwnProperty?Array.prototype.slice.call(e):new Array(t).fill().map((function(t){return e[t]}))}},{}],334:[function(e,t,i){"use strict";var n=e("object-assign"),r="function"==typeof Symbol&&Symbol.for,o=r?Symbol.for("react.element"):60103,s=r?Symbol.for("react.portal"):60106,a=r?Symbol.for("react.fragment"):60107,l=r?Symbol.for("react.strict_mode"):60108,c=r?Symbol.for("react.profiler"):60114,u=r?Symbol.for("react.provider"):60109,d=r?Symbol.for("react.context"):60110,p=r?Symbol.for("react.concurrent_mode"):60111,h=r?Symbol.for("react.forward_ref"):60112,f=r?Symbol.for("react.suspense"):60113,m=r?Symbol.for("react.memo"):60115,g=r?Symbol.for("react.lazy"):60116,b="function"==typeof Symbol&&Symbol.iterator;function v(e,t,i,n,r,o,s,a){if(!e){if(e=void 0,void 0===t)e=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[i,n,r,o,s,a],c=0;(e=Error(t.replace(/%s/g,(function(){return l[c++]})))).name="Invariant Violation"}throw e.framesToPop=1,e}}function y(e){for(var t=arguments.length-1,i="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=0;n<t;n++)i+="&args[]="+encodeURIComponent(arguments[n+1]);v(!1,"Minified React error #"+e+"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",i)}var k={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w={};function x(e,t,i){this.props=e,this.context=t,this.refs=w,this.updater=i||k}function E(){}function C(e,t,i){this.props=e,this.context=t,this.refs=w,this.updater=i||k}x.prototype.isReactComponent={},x.prototype.setState=function(e,t){"object"!=typeof e&&"function"!=typeof e&&null!=e&&y("85"),this.updater.enqueueSetState(this,e,t,"setState")},x.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},E.prototype=x.prototype;var S=C.prototype=new E;S.constructor=C,n(S,x.prototype),S.isPureReactComponent=!0;var _={current:null},T={current:null},A=Object.prototype.hasOwnProperty,N={key:!0,ref:!0,__self:!0,__source:!0};function I(e,t,i){var n=void 0,r={},s=null,a=null;if(null!=t)for(n in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)A.call(t,n)&&!N.hasOwnProperty(n)&&(r[n]=t[n]);var l=arguments.length-2;if(1===l)r.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];r.children=c}if(e&&e.defaultProps)for(n in l=e.defaultProps)void 0===r[n]&&(r[n]=l[n]);return{$$typeof:o,type:e,key:s,ref:a,props:r,_owner:T.current}}function O(e){return"object"==typeof e&&null!==e&&e.$$typeof===o}var P=/\/+/g,D=[];function L(e,t,i,n){if(D.length){var r=D.pop();return r.result=e,r.keyPrefix=t,r.func=i,r.context=n,r.count=0,r}return{result:e,keyPrefix:t,func:i,context:n,count:0}}function R(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>D.length&&D.push(e)}function M(e,t,i,n){var r=typeof e;"undefined"!==r&&"boolean"!==r||(e=null);var a=!1;if(null===e)a=!0;else switch(r){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case o:case s:a=!0}}if(a)return i(n,e,""===t?"."+j(e,0):t),1;if(a=0,t=""===t?".":t+":",Array.isArray(e))for(var l=0;l<e.length;l++){var c=t+j(r=e[l],l);a+=M(r,c,i,n)}else if("function"==typeof(c=null===e||"object"!=typeof e?null:"function"==typeof(c=b&&e[b]||e["@@iterator"])?c:null))for(e=c.call(e),l=0;!(r=e.next()).done;)a+=M(r=r.value,c=t+j(r,l++),i,n);else"object"===r&&y("31","[object Object]"==(i=""+e)?"object with keys {"+Object.keys(e).join(", ")+"}":i,"");return a}function B(e,t,i){return null==e?0:M(e,"",t,i)}function j(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function U(e,t){e.func.call(e.context,t,e.count++)}function F(e,t,i){var n=e.result,r=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?H(e,n,i,(function(e){return e})):null!=e&&(O(e)&&(e=function(e,t){return{$$typeof:o,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,r+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(P,"$&/")+"/")+i)),n.push(e))}function H(e,t,i,n,r){var o="";null!=i&&(o=(""+i).replace(P,"$&/")+"/"),B(e,F,t=L(t,o,n,r)),R(t)}function q(){var e=_.current;return null===e&&y("307"),e}var z={Children:{map:function(e,t,i){if(null==e)return e;var n=[];return H(e,n,null,t,i),n},forEach:function(e,t,i){if(null==e)return e;B(e,U,t=L(null,null,t,i)),R(t)},count:function(e){return B(e,(function(){return null}),null)},toArray:function(e){var t=[];return H(e,t,null,(function(e){return e})),t},only:function(e){return O(e)||y("143"),e}},createRef:function(){return{current:null}},Component:x,PureComponent:C,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:d,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:u,_context:e},e.Consumer=e},forwardRef:function(e){return{$$typeof:h,render:e}},lazy:function(e){return{$$typeof:g,_ctor:e,_status:-1,_result:null}},memo:function(e,t){return{$$typeof:m,type:e,compare:void 0===t?null:t}},useCallback:function(e,t){return q().useCallback(e,t)},useContext:function(e,t){return q().useContext(e,t)},useEffect:function(e,t){return q().useEffect(e,t)},useImperativeHandle:function(e,t,i){return q().useImperativeHandle(e,t,i)},useDebugValue:function(){},useLayoutEffect:function(e,t){return q().useLayoutEffect(e,t)},useMemo:function(e,t){return q().useMemo(e,t)},useReducer:function(e,t,i){return q().useReducer(e,t,i)},useRef:function(e){return q().useRef(e)},useState:function(e){return q().useState(e)},Fragment:a,StrictMode:l,Suspense:f,createElement:I,cloneElement:function(e,t,i){null==e&&y("267",e);var r=void 0,s=n({},e.props),a=e.key,l=e.ref,c=e._owner;if(null!=t){void 0!==t.ref&&(l=t.ref,c=T.current),void 0!==t.key&&(a=""+t.key);var u=void 0;for(r in e.type&&e.type.defaultProps&&(u=e.type.defaultProps),t)A.call(t,r)&&!N.hasOwnProperty(r)&&(s[r]=void 0===t[r]&&void 0!==u?u[r]:t[r])}if(1==(r=arguments.length-2))s.children=i;else if(1<r){u=Array(r);for(var d=0;d<r;d++)u[d]=arguments[d+2];s.children=u}return{$$typeof:o,type:e.type,key:a,ref:l,props:s,_owner:c}},createFactory:function(e){var t=I.bind(null,e);return t.type=e,t},isValidElement:O,version:"16.8.3",unstable_ConcurrentMode:p,unstable_Profiler:c,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:_,ReactCurrentOwner:T,assign:n}},G={default:z},$=G&&z||G;t.exports=$.default||$},{"object-assign":260}],335:[function(e,t,i){"use strict";t.exports=e("./cjs/react.production.min.js")},{"./cjs/react.production.min.js":334}],336:[function(e,t,i){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":337}],337:[function(e,t,i){"use strict";var n=e("process-nextick-args"),r=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t};t.exports=d;var o=Object.create(e("core-util-is"));o.inherits=e("inherits");var s=e("./_stream_readable"),a=e("./_stream_writable");o.inherits(d,s);for(var l=r(a.prototype),c=0;c<l.length;c++){var u=l[c];d.prototype[u]||(d.prototype[u]=a.prototype[u])}function d(e){if(!(this instanceof d))return new d(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",p)}function p(){this.allowHalfOpen||this._writableState.ended||n.nextTick(h,this)}function h(e){e.end()}Object.defineProperty(d.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),d.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},{"./_stream_readable":339,"./_stream_writable":341,"core-util-is":170,inherits:201,"process-nextick-args":284}],338:[function(e,t,i){"use strict";t.exports=o;var n=e("./_stream_transform"),r=Object.create(e("core-util-is"));function o(e){if(!(this instanceof o))return new o(e);n.call(this,e)}r.inherits=e("inherits"),r.inherits(o,n),o.prototype._transform=function(e,t,i){i(null,e)}},{"./_stream_transform":340,"core-util-is":170,inherits:201}],339:[function(e,t,i){(function(i,n){(function(){"use strict";var r=e("process-nextick-args");t.exports=y;var o,s=e("isarray");y.ReadableState=v;e("events").EventEmitter;var a=function(e,t){return e.listeners(t).length},l=e("./internal/streams/stream"),c=e("safe-buffer").Buffer,u=n.Uint8Array||function(){};var d=Object.create(e("core-util-is"));d.inherits=e("inherits");var p=e("util"),h=void 0;h=p&&p.debuglog?p.debuglog("stream"):function(){};var f,m=e("./internal/streams/BufferList"),g=e("./internal/streams/destroy");d.inherits(y,l);var b=["error","close","destroy","pause","resume"];function v(t,i){t=t||{};var n=i instanceof(o=o||e("./_stream_duplex"));this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var r=t.highWaterMark,s=t.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(f||(f=e("string_decoder/").StringDecoder),this.decoder=new f(t.encoding),this.encoding=t.encoding)}function y(t){if(o=o||e("./_stream_duplex"),!(this instanceof y))return new y(t);this._readableState=new v(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),l.call(this)}function k(e,t,i,n,r){var o,s=e._readableState;return null===t?(s.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var i=t.decoder.end();i&&i.length&&(t.buffer.push(i),t.length+=t.objectMode?1:i.length)}t.ended=!0,C(e)}}(e,s)):(r||(o=function(e,t){var i;return function(e){return c.isBuffer(e)||e instanceof u}(t)||"string"==typeof t||void 0===t||e.objectMode||(i=new TypeError("Invalid non-string/buffer chunk")),i}(s,t)),o?e.emit("error",o):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===c.prototype||(t=function(e){return c.from(e)}(t)),n?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!i?(t=s.decoder.write(t),s.objectMode||0!==t.length?w(e,s,t,!1):_(e,s)):w(e,s,t,!1))):n||(s.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function w(e,t,i,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",i),e.read(0)):(t.length+=t.objectMode?1:i.length,n?t.buffer.unshift(i):t.buffer.push(i),t.needReadable&&C(e)),_(e,t)}Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),y.prototype.destroy=g.destroy,y.prototype._undestroy=g.undestroy,y.prototype._destroy=function(e,t){this.push(null),t(e)},y.prototype.push=function(e,t){var i,n=this._readableState;return n.objectMode?i=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=c.from(e,t),t=""),i=!0),k(this,e,t,!1,i)},y.prototype.unshift=function(e){return k(this,e,null,!0,!1)},y.prototype.isPaused=function(){return!1===this._readableState.flowing},y.prototype.setEncoding=function(t){return f||(f=e("string_decoder/").StringDecoder),this._readableState.decoder=new f(t),this._readableState.encoding=t,this};var x=8388608;function E(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=x?e=x:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function C(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(h("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?r.nextTick(S,e):S(e))}function S(e){h("emit readable"),e.emit("readable"),I(e)}function _(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(T,e,t))}function T(e,t){for(var i=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(h("maybeReadMore read 0"),e.read(0),i!==t.length);)i=t.length;t.readingMore=!1}function A(e){h("readable nexttick read 0"),e.read(0)}function N(e,t){t.reading||(h("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),I(e),t.flowing&&!t.reading&&e.read(0)}function I(e){var t=e._readableState;for(h("flow",t.flowing);t.flowing&&null!==e.read(););}function O(e,t){return 0===t.length?null:(t.objectMode?i=t.buffer.shift():!e||e>=t.length?(i=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):i=function(e,t,i){var n;return e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():i?function(e,t){var i=t.head,n=1,r=i.data;for(e-=r.length;i=i.next;){var o=i.data,s=e>o.length?o.length:e;if(s===o.length?r+=o:r+=o.slice(0,e),0==(e-=s)){s===o.length?(++n,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=o.slice(s));break}++n}return t.length-=n,r}(e,t):function(e,t){var i=c.allocUnsafe(e),n=t.head,r=1;for(n.data.copy(i),e-=n.data.length;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(o.copy(i,i.length-e,0,s),0==(e-=s)){s===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++r}return t.length-=r,i}(e,t),n}(e,t.buffer,t.decoder),i);var i}function P(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,r.nextTick(D,t,e))}function D(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function L(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1}y.prototype.read=function(e){h("read",e),e=parseInt(e,10);var t=this._readableState,i=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return h("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?P(this):C(this),null;if(0===(e=E(e,t))&&t.ended)return 0===t.length&&P(this),null;var n,r=t.needReadable;return h("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&h("length less than watermark",r=!0),t.ended||t.reading?h("reading or ended",r=!1):r&&(h("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=E(i,t))),null===(n=e>0?O(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),i!==e&&t.ended&&P(this)),null!==n&&this.emit("data",n),n},y.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},y.prototype.pipe=function(e,t){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,h("pipe count=%d opts=%j",o.pipesCount,t);var l=t&&!1===t.end||e===i.stdout||e===i.stderr?v:c;function c(){h("onend"),e.end()}o.endEmitted?r.nextTick(l):n.once("end",l),e.on("unpipe",(function t(i,r){h("onunpipe"),i===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,h("cleanup"),e.removeListener("close",g),e.removeListener("finish",b),e.removeListener("drain",u),e.removeListener("error",m),e.removeListener("unpipe",t),n.removeListener("end",c),n.removeListener("end",v),n.removeListener("data",f),d=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}));var u=function(e){return function(){var t=e._readableState;h("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,I(e))}}(n);e.on("drain",u);var d=!1,p=!1;function f(t){h("ondata"),p=!1,!1!==e.write(t)||p||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==L(o.pipes,e))&&!d&&(h("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,p=!0),n.pause())}function m(t){h("onerror",t),v(),e.removeListener("error",m),0===a(e,"error")&&e.emit("error",t)}function g(){e.removeListener("finish",b),v()}function b(){h("onfinish"),e.removeListener("close",g),v()}function v(){h("unpipe"),n.unpipe(e)}return n.on("data",f),function(e,t,i){if("function"==typeof e.prependListener)return e.prependListener(t,i);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(i):e._events[t]=[i,e._events[t]]:e.on(t,i)}(e,"error",m),e.once("close",g),e.once("finish",b),e.emit("pipe",n),o.flowing||(h("pipe resume"),n.resume()),e},y.prototype.unpipe=function(e){var t=this._readableState,i={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,i)),this;if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<r;o++)n[o].emit("unpipe",this,i);return this}var s=L(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,i)),this},y.prototype.on=function(e,t){var i=l.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&C(this):r.nextTick(A,this))}return i},y.prototype.addListener=y.prototype.on,y.prototype.resume=function(){var e=this._readableState;return e.flowing||(h("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(N,e,t))}(this,e)),this},y.prototype.pause=function(){return h("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(h("pause"),this._readableState.flowing=!1,this.emit("pause")),this},y.prototype.wrap=function(e){var t=this,i=this._readableState,n=!1;for(var r in e.on("end",(function(){if(h("wrapped end"),i.decoder&&!i.ended){var e=i.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(r){h("wrapped data"),i.decoder&&(r=i.decoder.write(r)),i.objectMode&&null==r||(i.objectMode||r&&r.length)&&(t.push(r)||(n=!0,e.pause()))})),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var o=0;o<b.length;o++)e.on(b[o],this.emit.bind(this,b[o]));return this._read=function(t){h("wrapped _read",t),n&&(n=!1,e.resume())},this},Object.defineProperty(y.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),y._fromList=O}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":337,"./internal/streams/BufferList":342,"./internal/streams/destroy":343,"./internal/streams/stream":344,_process:285,"core-util-is":170,events:195,inherits:201,isarray:204,"process-nextick-args":284,"safe-buffer":345,"string_decoder/":346,util:167}],340:[function(e,t,i){"use strict";t.exports=s;var n=e("./_stream_duplex"),r=Object.create(e("core-util-is"));function o(e,t){var i=this._transformState;i.transforming=!1;var n=i.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));i.writechunk=null,i.writecb=null,null!=t&&this.push(t),n(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function s(e){if(!(this instanceof s))return new s(e);n.call(this,e),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var e=this;"function"==typeof this._flush?this._flush((function(t,i){l(e,t,i)})):l(this,null,null)}function l(e,t,i){if(t)return e.emit("error",t);if(null!=i&&e.push(i),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}r.inherits=e("inherits"),r.inherits(s,n),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,i){throw new Error("_transform() is not implemented")},s.prototype._write=function(e,t,i){var n=this._transformState;if(n.writecb=i,n.writechunk=e,n.writeencoding=t,!n.transforming){var r=this._readableState;(n.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},s.prototype._destroy=function(e,t){var i=this;n.prototype._destroy.call(this,e,(function(e){t(e),i.emit("close")}))}},{"./_stream_duplex":337,"core-util-is":170,inherits:201}],341:[function(e,t,i){(function(i,n,r){(function(){"use strict";var o=e("process-nextick-args");function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,i){var n=e.entry;for(e.entry=null;n;){var r=n.callback;t.pendingcb--,r(i),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}t.exports=v;var a,l=!i.browser&&["v0.10","v0.9."].indexOf(i.version.slice(0,5))>-1?r:o.nextTick;v.WritableState=b;var c=Object.create(e("core-util-is"));c.inherits=e("inherits");var u={deprecate:e("util-deprecate")},d=e("./internal/streams/stream"),p=e("safe-buffer").Buffer,h=n.Uint8Array||function(){};var f,m=e("./internal/streams/destroy");function g(){}function b(t,i){a=a||e("./_stream_duplex"),t=t||{};var n=i instanceof a;this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var r=t.highWaterMark,c=t.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n&&(c||0===c)?c:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var d=!1===t.decodeStrings;this.decodeStrings=!d,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var i=e._writableState,n=i.sync,r=i.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(i),t)!function(e,t,i,n,r){--t.pendingcb,i?(o.nextTick(r,n),o.nextTick(S,e,t),e._writableState.errorEmitted=!0,e.emit("error",n)):(r(n),e._writableState.errorEmitted=!0,e.emit("error",n),S(e,t))}(e,i,n,t,r);else{var s=E(i);s||i.corked||i.bufferProcessing||!i.bufferedRequest||x(e,i),n?l(w,e,i,s,r):w(e,i,s,r)}}(i,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function v(t){if(a=a||e("./_stream_duplex"),!(f.call(v,this)||this instanceof a))return new v(t);this._writableState=new b(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),d.call(this)}function y(e,t,i,n,r,o){if(!i){var s=function(e,t,i){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=p.from(t,i)),t}(t,n,r);n!==s&&(i=!0,r="buffer",n=s)}var a=t.objectMode?1:n.length;t.length+=a;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:r,isBuf:i,callback:o,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else k(e,t,!1,a,n,r,o);return l}function k(e,t,i,n,r,o,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,i?e._writev(r,t.onwrite):e._write(r,o,t.onwrite),t.sync=!1}function w(e,t,i,n){i||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),S(e,t)}function x(e,t){t.bufferProcessing=!0;var i=t.bufferedRequest;if(e._writev&&i&&i.next){var n=t.bufferedRequestCount,r=new Array(n),o=t.corkedRequestsFree;o.entry=i;for(var a=0,l=!0;i;)r[a]=i,i.isBuf||(l=!1),i=i.next,a+=1;r.allBuffers=l,k(e,t,!0,t.length,r,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;i;){var c=i.chunk,u=i.encoding,d=i.callback;if(k(e,t,!1,t.objectMode?1:c.length,c,u,d),i=i.next,t.bufferedRequestCount--,t.writing)break}null===i&&(t.lastBufferedRequest=null)}t.bufferedRequest=i,t.bufferProcessing=!1}function E(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function C(e,t){e._final((function(i){t.pendingcb--,i&&e.emit("error",i),t.prefinished=!0,e.emit("prefinish"),S(e,t)}))}function S(e,t){var i=E(t);return i&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,o.nextTick(C,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),i}c.inherits(v,d),b.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(b.prototype,"buffer",{get:u.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(v,Symbol.hasInstance,{value:function(e){return!!f.call(this,e)||this===v&&e&&e._writableState instanceof b}})):f=function(e){return e instanceof this},v.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},v.prototype.write=function(e,t,i){var n=this._writableState,r=!1,s=!n.objectMode&&function(e){return p.isBuffer(e)||e instanceof h}(e);return s&&!p.isBuffer(e)&&(e=function(e){return p.from(e)}(e)),"function"==typeof t&&(i=t,t=null),s?t="buffer":t||(t=n.defaultEncoding),"function"!=typeof i&&(i=g),n.ended?function(e,t){var i=new Error("write after end");e.emit("error",i),o.nextTick(t,i)}(this,i):(s||function(e,t,i,n){var r=!0,s=!1;return null===i?s=new TypeError("May not write null values to stream"):"string"==typeof i||void 0===i||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),o.nextTick(n,s),r=!1),r}(this,n,e,i))&&(n.pendingcb++,r=y(this,n,s,e,t,i)),r},v.prototype.cork=function(){this._writableState.corked++},v.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||x(this,e))},v.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(v.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),v.prototype._write=function(e,t,i){i(new Error("_write() is not implemented"))},v.prototype._writev=null,v.prototype.end=function(e,t,i){var n=this._writableState;"function"==typeof e?(i=e,e=null,t=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,i){t.ending=!0,S(e,t),i&&(t.finished?o.nextTick(i):e.once("finish",i)),t.ended=!0,e.writable=!1}(this,n,i)},Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),v.prototype.destroy=m.destroy,v.prototype._undestroy=m.undestroy,v.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("timers").setImmediate)},{"./_stream_duplex":337,"./internal/streams/destroy":343,"./internal/streams/stream":344,_process:285,"core-util-is":170,inherits:201,"process-nextick-args":284,"safe-buffer":345,timers:392,"util-deprecate":393}],342:[function(e,t,i){"use strict";var n=e("safe-buffer").Buffer,r=e("util");function o(e,t,i){e.copy(t,i)}t.exports=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,i=""+t.data;t=t.next;)i+=e+t.data;return i},e.prototype.concat=function(e){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var t=n.allocUnsafe(e>>>0),i=this.head,r=0;i;)o(i.data,t,r),r+=i.data.length,i=i.next;return t},e}(),r&&r.inspect&&r.inspect.custom&&(t.exports.prototype[r.inspect.custom]=function(){var e=r.inspect({length:this.length});return this.constructor.name+" "+e})},{"safe-buffer":345,util:167}],343:[function(e,t,i){"use strict";var n=e("process-nextick-args");function r(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var i=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||n.nextTick(r,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(n.nextTick(r,i,e),i._writableState&&(i._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":284}],344:[function(e,t,i){t.exports=e("events").EventEmitter},{events:195}],345:[function(e,t,i){var n=e("buffer"),r=n.Buffer;function o(e,t){for(var i in e)t[i]=e[i]}function s(e,t,i){return r(e,t,i)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(o(n,i),i.Buffer=s),o(r,s),s.from=function(e,t,i){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,i)},s.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=r(e);return void 0!==t?"string"==typeof i?n.fill(t,i):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},{buffer:168}],346:[function(e,t,i){"use strict";var n=e("safe-buffer").Buffer,r=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===r||!r(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=u,this.end=d,t=3;break;default:return this.write=p,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,i=function(e,t,i){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==i?i:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var i=e.toString("utf16le",t);if(i){var n=i.charCodeAt(i.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,i)}return t}function u(e,t){var i=(e.length-t)%3;return 0===i?e.toString("base64",t):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-i))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function p(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}i.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,i;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<e.length?t?t+this.text(e,i):this.text(e,i):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var i=function(e,t,i){var n=t.length-1;if(n<i)return 0;var r=s(t[n]);return r>=0?(r>0&&(e.lastNeed=r-1),r):--n<i||-2===r?0:(r=s(t[n]))>=0?(r>0&&(e.lastNeed=r-2),r):--n<i||-2===r?0:(r=s(t[n]))>=0?(r>0&&(2===r?r=0:e.lastNeed=r-3),r):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=i;var n=e.length-(i-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":345}],347:[function(e,t,i){t.exports=e("./readable").PassThrough},{"./readable":348}],348:[function(e,t,i){(i=t.exports=e("./lib/_stream_readable.js")).Stream=i,i.Readable=i,i.Writable=e("./lib/_stream_writable.js"),i.Duplex=e("./lib/_stream_duplex.js"),i.Transform=e("./lib/_stream_transform.js"),i.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":337,"./lib/_stream_passthrough.js":338,"./lib/_stream_readable.js":339,"./lib/_stream_transform.js":340,"./lib/_stream_writable.js":341}],349:[function(e,t,i){t.exports=e("./readable").Transform},{"./readable":348}],350:[function(e,t,i){t.exports=e("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":341}],351:[function(e,t,i){"use strict";i.__esModule=!0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e};i.default=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e){return function(i,r,o){var a,l=e(i,r,o),c=l.dispatch,u={getState:l.getState,dispatch:function(e){return c(e)}};return a=t.map((function(e){return e(u)})),c=s.default.apply(void 0,a)(l.dispatch),n({},l,{dispatch:c})}}};var r,o=e("./compose"),s=(r=o)&&r.__esModule?r:{default:r}},{"./compose":354}],352:[function(e,t,i){"use strict";function n(e,t){return function(){return t(e.apply(void 0,arguments))}}i.__esModule=!0,i.default=function(e,t){if("function"==typeof e)return n(e,t);if("object"!=typeof e||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var i=Object.keys(e),r={},o=0;o<i.length;o++){var s=i[o],a=e[s];"function"==typeof a&&(r[s]=n(a,t))}return r}},{}],353:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e){for(var t=Object.keys(e),i={},r=0;r<t.length;r++){var s=t[r];"function"==typeof e[s]&&(i[s]=e[s])}var a=Object.keys(i),l=void 0;try{!function(e){Object.keys(e).forEach((function(t){var i=e[t];if(void 0===i(void 0,{type:n.ActionTypes.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===i(void 0,{type:"@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".")}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+n.ActionTypes.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(i)}catch(e){l=e}return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];if(l)throw l;for(var n=!1,r={},s=0;s<a.length;s++){var c=a[s],u=i[c],d=e[c],p=u(d,t);if(void 0===p){var h=o(c,t);throw new Error(h)}r[c]=p,n=n||p!==d}return n?r:e}};var n=e("./createStore");r(e("lodash/isPlainObject")),r(e("./utils/warning"));function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var i=t&&t.type;return"Given action "+(i&&'"'+i.toString()+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}},{"./createStore":355,"./utils/warning":357,"lodash/isPlainObject":243}],354:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}},{}],355:[function(e,t,i){"use strict";i.__esModule=!0,i.ActionTypes=void 0,i.default=function e(t,i,o){var a;if("function"==typeof i&&void 0===o&&(o=i,i=void 0),void 0!==o){if("function"!=typeof o)throw new Error("Expected the enhancer to be a function.");return o(e)(t,i)}if("function"!=typeof t)throw new Error("Expected the reducer to be a function.");var l=t,c=i,u=[],d=u,p=!1;function h(){d===u&&(d=u.slice())}function f(){return c}function m(e){if("function"!=typeof e)throw new Error("Expected listener to be a function.");var t=!0;return h(),d.push(e),function(){if(t){t=!1,h();var i=d.indexOf(e);d.splice(i,1)}}}function g(e){if(!(0,n.default)(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(p)throw new Error("Reducers may not dispatch actions.");try{p=!0,c=l(c,e)}finally{p=!1}for(var t=u=d,i=0;i<t.length;i++)(0,t[i])();return e}return g({type:s.INIT}),(a={dispatch:g,subscribe:m,getState:f,replaceReducer:function(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");l=e,g({type:s.INIT})}})[r.default]=function(){var e,t=m;return(e={subscribe:function(e){if("object"!=typeof e)throw new TypeError("Expected the observer to be an object.");function i(){e.next&&e.next(f())}return i(),{unsubscribe:t(i)}}})[r.default]=function(){return this},e},a};var n=o(e("lodash/isPlainObject")),r=o(e("symbol-observable"));function o(e){return e&&e.__esModule?e:{default:e}}var s=i.ActionTypes={INIT:"@@redux/INIT"}},{"lodash/isPlainObject":243,"symbol-observable":390}],356:[function(e,t,i){"use strict";i.__esModule=!0,i.compose=i.applyMiddleware=i.bindActionCreators=i.combineReducers=i.createStore=void 0;var n=l(e("./createStore")),r=l(e("./combineReducers")),o=l(e("./bindActionCreators")),s=l(e("./applyMiddleware")),a=l(e("./compose"));l(e("./utils/warning"));function l(e){return e&&e.__esModule?e:{default:e}}i.createStore=n.default,i.combineReducers=r.default,i.bindActionCreators=o.default,i.applyMiddleware=s.default,i.compose=a.default},{"./applyMiddleware":351,"./bindActionCreators":352,"./combineReducers":353,"./compose":354,"./createStore":355,"./utils/warning":357}],357:[function(e,t,i){"use strict";i.__esModule=!0,i.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}},{}],358:[function(e,t,i){t.exports=function(e){return e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")}},{}],359:[function(e,t,i){var n=e("buffer"),r=n.Buffer;function o(e,t){for(var i in e)t[i]=e[i]}function s(e,t,i){return r(e,t,i)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=n:(o(n,i),i.Buffer=s),s.prototype=Object.create(r.prototype),o(r,s),s.from=function(e,t,i){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,i)},s.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=r(e);return void 0!==t?"string"==typeof i?n.fill(t,i):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},{buffer:168}],360:[function(e,t,i){var n=e("htmlparser2"),r=e("xtend"),o=e("regexp-quote");function s(e,t){e&&Object.keys(e).forEach((function(i){t(e[i],i)}))}function a(e,t){return{}.hasOwnProperty.call(e,t)}function l(e,t,i){var u="";function d(e,t){var i=this;this.tag=e,this.attribs=t||{},this.tagPosition=u.length,this.text="",this.updateParentNodeText=function(){y.length&&(y[y.length-1].text+=i.text)}}t?(t=r(l.defaults,t)).parser?t.parser=r(c,t.parser):t.parser=c:(t=l.defaults).parser=c;var p,h,f=t.nonTextTags||["script","style","textarea"];t.allowedAttributes&&(p={},h={},s(t.allowedAttributes,(function(e,t){p[t]=[];var i=[];e.forEach((function(e){e.indexOf("*")>=0?i.push(o(e).replace(/\\\*/g,".*")):p[t].push(e)})),h[t]=new RegExp("^("+i.join("|")+")$")})));var m={};s(t.allowedClasses,(function(e,t){p&&(a(p,t)||(p[t]=[]),p[t].push("class")),m[t]=e}));var g,b={};s(t.transformTags,(function(e,t){var i;"function"==typeof e?i=e:"string"==typeof e&&(i=l.simpleTransform(e)),"*"===t?g=i:b[t]=i}));var v=0,y=[],k={},w={},x=!1,E=0,C=new n.Parser({onopentag:function(e,i){if(x)E++;else{var n=new d(e,i);y.push(n);var r,o=!1,l=!!n.text;a(b,e)&&(r=b[e](e,i),n.attribs=i=r.attribs,void 0!==r.text&&(n.innerText=r.text),e!==r.tagName&&(n.name=e=r.tagName,w[v]=r.tagName)),g&&(r=g(e,i),n.attribs=i=r.attribs,e!==r.tagName&&(n.name=e=r.tagName,w[v]=r.tagName)),t.allowedTags&&-1===t.allowedTags.indexOf(e)&&(o=!0,-1!==f.indexOf(e)&&(x=!0,E=1),k[v]=!0),v++,o||(u+="<"+e,(!p||a(p,e)||p["*"])&&s(i,(function(i,r){if(!p||a(p,e)&&-1!==p[e].indexOf(r)||p["*"]&&-1!==p["*"].indexOf(r)||a(h,e)&&h[e].test(r)||h["*"]&&h["*"].test(r)){if(("href"===r||"src"===r)&&function(e,i){var n=(i=(i=i.replace(/[\x00-\x20]+/g,"")).replace(/<\!\-\-.*?\-\-\>/g,"")).match(/^([a-zA-Z]+)\:/);if(!n)return!1;var r=n[1].toLowerCase();return a(t.allowedSchemesByTag,e)?-1===t.allowedSchemesByTag[e].indexOf(r):!t.allowedSchemes||-1===t.allowedSchemes.indexOf(r)}(e,i))return void delete n.attribs[r];if("class"===r&&!(i=function(e,t){return t?(e=e.split(/\s+/)).filter((function(e){return-1!==t.indexOf(e)})).join(" "):e}(i,m[e])).length)return void delete n.attribs[r];u+=" "+r,i.length&&(u+='="'+i+'"')}else delete n.attribs[r]})),-1!==t.selfClosing.indexOf(e)?u+=" />":(u+=">",!n.innerText||l||t.textFilter||(u+=n.innerText)))}},ontext:function(e){if(!x){var i,n=y[y.length-1];n&&(i=n.tag,e=void 0!==n.innerText?n.innerText:e),"script"===i||"style"===i?u+=e:t.textFilter?u+=t.textFilter(e):u+=e,y.length&&(y[y.length-1].text+=e)}},onclosetag:function(e){if(x){if(--E)return;x=!1}var i=y.pop();if(i){if(x=!1,k[--v])return delete k[v],void i.updateParentNodeText();w[v]&&(e=w[v],delete w[v]),t.exclusiveFilter&&t.exclusiveFilter(i)?u=u.substr(0,i.tagPosition):(i.updateParentNodeText(),-1===t.selfClosing.indexOf(e)&&(u+="</"+e+">"))}}},t.parser);return C.write(e),C.end(),u}t.exports=l;var c={decodeEntities:!0};l.defaults={allowedTags:["h3","h4","h5","h6","blockquote","p","a","ul","ol","nl","li","b","i","strong","em","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre"],allowedAttributes:{a:["href","name","target"],img:["src"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto"],allowedSchemesByTag:{}},l.simpleTransform=function(e,t,i){return i=void 0===i||i,t=t||{},function(n,r){var o;if(i)for(o in t)r[o]=t[o];else r=t;return{tagName:e,attribs:r}}}},{htmlparser2:376,"regexp-quote":358,xtend:399}],361:[function(e,t,i){var n=e("domelementtype"),r=/\s+/g,o=e("./lib/node"),s=e("./lib/element");function a(e,t,i){"object"==typeof e?(i=t,t=e,e=null):"function"==typeof t&&(i=t,t=l),this._callback=e,this._options=t||l,this._elementCB=i,this.dom=[],this._done=!1,this._tagStack=[],this._parser=this._parser||null}var l={normalizeWhitespace:!1,withStartIndices:!1,withEndIndices:!1};a.prototype.onparserinit=function(e){this._parser=e},a.prototype.onreset=function(){a.call(this,this._callback,this._options,this._elementCB)},a.prototype.onend=function(){this._done||(this._done=!0,this._parser=null,this._handleCallback(null))},a.prototype._handleCallback=a.prototype.onerror=function(e){if("function"==typeof this._callback)this._callback(e,this.dom);else if(e)throw e},a.prototype.onclosetag=function(){var e=this._tagStack.pop();this._options.withEndIndices&&e&&(e.endIndex=this._parser.endIndex),this._elementCB&&this._elementCB(e)},a.prototype._createDomElement=function(e){if(!this._options.withDomLvl1)return e;var t;for(var i in t="tag"===e.type?Object.create(s):Object.create(o),e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},a.prototype._addDomElement=function(e){var t=this._tagStack[this._tagStack.length-1],i=t?t.children:this.dom,n=i[i.length-1];e.next=null,this._options.withStartIndices&&(e.startIndex=this._parser.startIndex),this._options.withEndIndices&&(e.endIndex=this._parser.endIndex),n?(e.prev=n,n.next=e):e.prev=null,i.push(e),e.parent=t||null},a.prototype.onopentag=function(e,t){var i={type:"script"===e?n.Script:"style"===e?n.Style:n.Tag,name:e,attribs:t,children:[]},r=this._createDomElement(i);this._addDomElement(r),this._tagStack.push(r)},a.prototype.ontext=function(e){var t,i=this._options.normalizeWhitespace||this._options.ignoreWhitespace;if(!this._tagStack.length&&this.dom.length&&(t=this.dom[this.dom.length-1]).type===n.Text)i?t.data=(t.data+e).replace(r," "):t.data+=e;else if(this._tagStack.length&&(t=this._tagStack[this._tagStack.length-1])&&(t=t.children[t.children.length-1])&&t.type===n.Text)i?t.data=(t.data+e).replace(r," "):t.data+=e;else{i&&(e=e.replace(r," "));var o=this._createDomElement({data:e,type:n.Text});this._addDomElement(o)}},a.prototype.oncomment=function(e){var t=this._tagStack[this._tagStack.length-1];if(t&&t.type===n.Comment)t.data+=e;else{var i={data:e,type:n.Comment},r=this._createDomElement(i);this._addDomElement(r),this._tagStack.push(r)}},a.prototype.oncdatastart=function(){var e={children:[{data:"",type:n.Text}],type:n.CDATA},t=this._createDomElement(e);this._addDomElement(t),this._tagStack.push(t)},a.prototype.oncommentend=a.prototype.oncdataend=function(){this._tagStack.pop()},a.prototype.onprocessinginstruction=function(e,t){var i=this._createDomElement({name:e,data:t,type:n.Directive});this._addDomElement(i)},t.exports=a},{"./lib/element":362,"./lib/node":363,domelementtype:176}],362:[function(e,t,i){var n=e("./node"),r=t.exports=Object.create(n),o={tagName:"name"};Object.keys(o).forEach((function(e){var t=o[e];Object.defineProperty(r,e,{get:function(){return this[t]||null},set:function(e){return this[t]=e,e}})}))},{"./node":363}],363:[function(e,t,i){var n=t.exports={get firstChild(){var e=this.children;return e&&e[0]||null},get lastChild(){var e=this.children;return e&&e[e.length-1]||null},get nodeType(){return o[this.type]||o.element}},r={tagName:"name",childNodes:"children",parentNode:"parent",previousSibling:"prev",nextSibling:"next",nodeValue:"data"},o={element:1,text:3,cdata:4,comment:8};Object.keys(r).forEach((function(e){var t=r[e];Object.defineProperty(n,e,{get:function(){return this[t]||null},set:function(e){return this[t]=e,e}})}))},{}],364:[function(e,t,i){var n=e("../maps/decode.json");t.exports=function(e){if(e>=55296&&e<=57343||e>1114111)return"";e in n&&(e=n[e]);var t="";return e>65535&&(e-=65536,t+=String.fromCharCode(e>>>10&1023|55296),e=56320|1023&e),t+String.fromCharCode(e)}},{"../maps/decode.json":365}],365:[function(e,t,i){t.exports={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376}},{}],366:[function(e,t,i){t.exports={Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",amp:"&",AMP:"&",andand:"",And:"",and:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angmsd:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",apacir:"",ap:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",barwed:"",Barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",because:"",Because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxdl:"",boxdL:"",boxDl:"",boxDL:"",boxdr:"",boxdR:"",boxDr:"",boxDR:"",boxh:"",boxH:"",boxhd:"",boxHd:"",boxhD:"",boxHD:"",boxhu:"",boxHu:"",boxhU:"",boxHU:"",boxminus:"",boxplus:"",boxtimes:"",boxul:"",boxuL:"",boxUl:"",boxUL:"",boxur:"",boxuR:"",boxUr:"",boxUR:"",boxv:"",boxV:"",boxvh:"",boxvH:"",boxVh:"",boxVH:"",boxvl:"",boxvL:"",boxVl:"",boxVL:"",boxvr:"",boxvR:"",boxVr:"",boxVR:"",bprime:"",breve:"",Breve:"",brvbar:"",bscr:"",Bscr:"",bsemi:"",bsim:"",bsime:"",bsolb:"",bsol:"\\",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",capand:"",capbrcup:"",capcap:"",cap:"",Cap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",centerdot:"",CenterDot:"",cfr:"",Cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cir:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",colon:":",Colon:"",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",conint:"",Conint:"",ContourIntegral:"",copf:"",Copf:"",coprod:"",Coproduct:"",copy:"",COPY:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",cross:"",Cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",cupbrcap:"",cupcap:"",CupCap:"",cup:"",Cup:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",dagger:"",Dagger:"",daleth:"",darr:"",Darr:"",dArr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",ddagger:"",ddarr:"",DD:"",dd:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",diamond:"",Diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrowBar:"",downarrow:"",DownArrow:"",Downarrow:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVectorBar:"",DownLeftVector:"",DownRightTeeVector:"",DownRightVectorBar:"",DownRightVector:"",DownTeeArrow:"",DownTee:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",Ecirc:"",ecirc:"",ecir:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",edot:"",eDot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp13:"",emsp14:"",emsp:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",escr:"",Escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",exponentiale:"",ExponentialE:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",forall:"",ForAll:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",fscr:"",Fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",ge:"",gE:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",gescc:"",ges:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",gg:"",Gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gla:"",gl:"",glE:"",glj:"",gnap:"",gnapprox:"",gne:"",gnE:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",gtcc:"",gtcir:"",gt:">",GT:">",Gt:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",harrcir:"",harr:"",hArr:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",hfr:"",Hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",hopf:"",Hopf:"",horbar:"",HorizontalLine:"",hscr:"",Hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",ifr:"",Ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",Im:"",imof:"",imped:"",Implies:"",incare:"",in:"",infin:"",infintie:"",inodot:"",intcal:"",int:"",Int:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",iscr:"",Iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",lang:"",Lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",larrb:"",larrbfs:"",larr:"",Larr:"",lArr:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",latail:"",lAtail:"",lat:"",late:"",lates:"",lbarr:"",lBarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",le:"",lE:"",LeftAngleBracket:"",LeftArrowBar:"",leftarrow:"",LeftArrow:"",Leftarrow:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVectorBar:"",LeftDownVector:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",leftrightarrow:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTeeArrow:"",LeftTee:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangleBar:"",LeftTriangle:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVectorBar:"",LeftUpVector:"",LeftVectorBar:"",LeftVector:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",lescc:"",les:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",llarr:"",ll:"",Ll:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoustache:"",lmoust:"",lnap:"",lnapprox:"",lne:"",lnE:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",longleftarrow:"",LongLeftArrow:"",Longleftarrow:"",longleftrightarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longmapsto:"",longrightarrow:"",LongRightArrow:"",Longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",lscr:"",Lscr:"",lsh:"",Lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",ltcc:"",ltcir:"",lt:"<",LT:"<",Lt:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",midast:"*",midcir:"",mid:"",middot:"",minusb:"",minus:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",mscr:"",Mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natural:"",naturals:"",natur:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",nearhk:"",nearr:"",neArr:"",nearrow:"",ne:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:"\n",nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nharr:"",nhArr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlarr:"",nlArr:"",nldr:"",nlE:"",nle:"",nleftarrow:"",nLeftarrow:"",nleftrightarrow:"",nLeftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",nopf:"",Nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangleBar:"",NotLeftTriangle:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangleBar:"",NotRightTriangle:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",nparallel:"",npar:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",nprec:"",npreceq:"",npre:"",nrarrc:"",nrarr:"",nrArr:"",nrarrw:"",nrightarrow:"",nRightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nvdash:"",nvDash:"",nVdash:"",nVDash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwarr:"",nwArr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",Ocirc:"",ocirc:"",ocir:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",orarr:"",Or:"",or:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",otimesas:"",Otimes:"",otimes:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",para:"",parallel:"",par:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plusacir:"",plusb:"",pluscir:"",plus:"+",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",popf:"",Popf:"",pound:"",prap:"",Pr:"",pr:"",prcue:"",precapprox:"",prec:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",pre:"",prE:"",precsim:"",prime:"",Prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportional:"",Proportion:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",qopf:"",Qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",quot:'"',QUOT:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",rang:"",Rang:"",rangd:"",range:"",rangle:"",raquo:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarr:"",Rarr:"",rArr:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",ratail:"",rAtail:"",ratio:"",rationals:"",rbarr:"",rBarr:"",RBarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",real:"",realine:"",realpart:"",reals:"",Re:"",rect:"",reg:"",REG:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",rfr:"",Rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrowBar:"",rightarrow:"",RightArrow:"",Rightarrow:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVectorBar:"",RightDownVector:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTeeArrow:"",RightTee:"",RightTeeVector:"",rightthreetimes:"",RightTriangleBar:"",RightTriangle:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVectorBar:"",RightUpVector:"",RightVectorBar:"",RightVector:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoustache:"",rmoust:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",ropf:"",Ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",rscr:"",Rscr:"",rsh:"",Rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",scap:"",Scaron:"",scaron:"",Sc:"",sc:"",sccue:"",sce:"",scE:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdotb:"",sdot:"",sdote:"",searhk:"",searr:"",seArr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",solbar:"",solb:"",sol:"/",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",square:"",Square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squ:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",sub:"",Sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",subset:"",Subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succapprox:"",succ:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",sum:"",Sum:"",sung:"",sup1:"",sup2:"",sup3:"",sup:"",Sup:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",supset:"",Supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swarr:"",swArr:"",swarrow:"",swnwar:"",szlig:"",Tab:"\t",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",therefore:"",Therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",ThinSpace:"",thinsp:"",thkap:"",thksim:"",THORN:"",thorn:"",tilde:"",Tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",timesbar:"",timesb:"",times:"",timesd:"",tint:"",toea:"",topbot:"",topcir:"",top:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",trade:"",TRADE:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",uarr:"",Uarr:"",uArr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrowBar:"",uparrow:"",UpArrow:"",Uparrow:"",UpArrowDownArrow:"",updownarrow:"",UpDownArrow:"",Updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",upsi:"",Upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTeeArrow:"",UpTee:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",varr:"",vArr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",vBar:"",Vbar:"",vBarv:"",Vcy:"",vcy:"",vdash:"",vDash:"",Vdash:"",VDash:"",Vdashl:"",veebar:"",vee:"",Vee:"",veeeq:"",vellip:"",verbar:"|",Verbar:"",vert:"|",Vert:"",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",wedge:"",Wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xharr:"",xhArr:"",Xi:"",xi:"",xlarr:"",xlArr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrarr:"",xrArr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",yuml:"",Yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",zfr:"",Zfr:"",ZHcy:"",zhcy:"",zigrarr:"",zopf:"",Zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""}},{}],367:[function(e,t,i){t.exports={Aacute:"",aacute:"",Acirc:"",acirc:"",acute:"",AElig:"",aelig:"",Agrave:"",agrave:"",amp:"&",AMP:"&",Aring:"",aring:"",Atilde:"",atilde:"",Auml:"",auml:"",brvbar:"",Ccedil:"",ccedil:"",cedil:"",cent:"",copy:"",COPY:"",curren:"",deg:"",divide:"",Eacute:"",eacute:"",Ecirc:"",ecirc:"",Egrave:"",egrave:"",ETH:"",eth:"",Euml:"",euml:"",frac12:"",frac14:"",frac34:"",gt:">",GT:">",Iacute:"",iacute:"",Icirc:"",icirc:"",iexcl:"",Igrave:"",igrave:"",iquest:"",Iuml:"",iuml:"",laquo:"",lt:"<",LT:"<",macr:"",micro:"",middot:"",nbsp:"",not:"",Ntilde:"",ntilde:"",Oacute:"",oacute:"",Ocirc:"",ocirc:"",Ograve:"",ograve:"",ordf:"",ordm:"",Oslash:"",oslash:"",Otilde:"",otilde:"",Ouml:"",ouml:"",para:"",plusmn:"",pound:"",quot:'"',QUOT:'"',raquo:"",reg:"",REG:"",sect:"",shy:"",sup1:"",sup2:"",sup3:"",szlig:"",THORN:"",thorn:"",times:"",Uacute:"",uacute:"",Ucirc:"",ucirc:"",Ugrave:"",ugrave:"",uml:"",Uuml:"",uuml:"",Yacute:"",yacute:"",yen:"",yuml:""}},{}],368:[function(e,t,i){arguments[4][192][0].apply(i,arguments)},{dup:192}],369:[function(e,t,i){function n(e){this._cbs=e||{},this.events=[]}t.exports=n;var r=e("./").EVENTS;Object.keys(r).forEach((function(e){if(0===r[e])e="on"+e,n.prototype[e]=function(){this.events.push([e]),this._cbs[e]&&this._cbs[e]()};else if(1===r[e])e="on"+e,n.prototype[e]=function(t){this.events.push([e,t]),this._cbs[e]&&this._cbs[e](t)};else{if(2!==r[e])throw Error("wrong number of arguments");e="on"+e,n.prototype[e]=function(t,i){this.events.push([e,t,i]),this._cbs[e]&&this._cbs[e](t,i)}}})),n.prototype.onreset=function(){this.events=[],this._cbs.onreset&&this._cbs.onreset()},n.prototype.restart=function(){this._cbs.onreset&&this._cbs.onreset();for(var e=0,t=this.events.length;e<t;e++)if(this._cbs[this.events[e][0]]){var i=this.events[e].length;1===i?this._cbs[this.events[e][0]]():2===i?this._cbs[this.events[e][0]](this.events[e][1]):this._cbs[this.events[e][0]](this.events[e][1],this.events[e][2])}}},{"./":376}],370:[function(e,t,i){var n=e("domhandler"),r=e("domutils");function o(e,t){this.init(e,t)}function s(e,t){return r.getElementsByTagName(e,t,!0)}function a(e,t){return r.getElementsByTagName(e,t,!0,1)[0]}function l(e,t,i){return r.getText(r.getElementsByTagName(e,t,i,1)).trim()}function c(e,t,i,n,r){var o=l(i,n,r);o&&(e[t]=o)}e("inherits")(o,n),o.prototype.init=n;var u=function(e){return"rss"===e||"feed"===e||"rdf:RDF"===e};o.prototype.onend=function(){var e,t,i={},r=a(u,this.dom);r&&("feed"===r.name?(t=r.children,i.type="atom",c(i,"id","id",t),c(i,"title","title",t),(e=a("link",t))&&(e=e.attribs)&&(e=e.href)&&(i.link=e),c(i,"description","subtitle",t),(e=l("updated",t))&&(i.updated=new Date(e)),c(i,"author","email",t,!0),i.items=s("entry",t).map((function(e){var t,i={};return c(i,"id","id",e=e.children),c(i,"title","title",e),(t=a("link",e))&&(t=t.attribs)&&(t=t.href)&&(i.link=t),(t=l("summary",e)||l("content",e))&&(i.description=t),(t=l("updated",e))&&(i.pubDate=new Date(t)),i}))):(t=a("channel",r.children).children,i.type=r.name.substr(0,3),i.id="",c(i,"title","title",t),c(i,"link","link",t),c(i,"description","description",t),(e=l("lastBuildDate",t))&&(i.updated=new Date(e)),c(i,"author","managingEditor",t,!0),i.items=s("item",r.children).map((function(e){var t,i={};return c(i,"id","guid",e=e.children),c(i,"title","title",e),c(i,"link","link",e),c(i,"description","description",e),(t=l("pubDate",e))&&(i.pubDate=new Date(t)),i})))),this.dom=i,n.prototype._handleCallback.call(this,r?null:Error("couldn't find root of feed"))},t.exports=o},{domhandler:361,domutils:177,inherits:201}],371:[function(e,t,i){var n=e("./Tokenizer.js"),r={input:!0,option:!0,optgroup:!0,select:!0,button:!0,datalist:!0,textarea:!0},o={tr:{tr:!0,th:!0,td:!0},th:{th:!0},td:{thead:!0,th:!0,td:!0},body:{head:!0,link:!0,script:!0},li:{li:!0},p:{p:!0},h1:{p:!0},h2:{p:!0},h3:{p:!0},h4:{p:!0},h5:{p:!0},h6:{p:!0},select:r,input:r,output:r,button:r,datalist:r,textarea:r,option:{option:!0},optgroup:{optgroup:!0}},s={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},a={__proto__:null,math:!0,svg:!0},l={__proto__:null,mi:!0,mo:!0,mn:!0,ms:!0,mtext:!0,"annotation-xml":!0,foreignObject:!0,desc:!0,title:!0},c=/\s|\//;function u(e,t){this._options=t||{},this._cbs=e||{},this._tagname="",this._attribname="",this._attribvalue="",this._attribs=null,this._stack=[],this._foreignContext=[],this.startIndex=0,this.endIndex=null,this._lowerCaseTagNames="lowerCaseTags"in this._options?!!this._options.lowerCaseTags:!this._options.xmlMode,this._lowerCaseAttributeNames="lowerCaseAttributeNames"in this._options?!!this._options.lowerCaseAttributeNames:!this._options.xmlMode,this._options.Tokenizer&&(n=this._options.Tokenizer),this._tokenizer=new n(this._options,this),this._cbs.onparserinit&&this._cbs.onparserinit(this)}e("inherits")(u,e("events").EventEmitter),u.prototype._updatePosition=function(e){null===this.endIndex?this._tokenizer._sectionStart<=e?this.startIndex=0:this.startIndex=this._tokenizer._sectionStart-e:this.startIndex=this.endIndex+1,this.endIndex=this._tokenizer.getAbsoluteIndex()},u.prototype.ontext=function(e){this._updatePosition(1),this.endIndex--,this._cbs.ontext&&this._cbs.ontext(e)},u.prototype.onopentagname=function(e){if(this._lowerCaseTagNames&&(e=e.toLowerCase()),this._tagname=e,!this._options.xmlMode&&e in o)for(var t;(t=this._stack[this._stack.length-1])in o[e];this.onclosetag(t));!this._options.xmlMode&&e in s||(this._stack.push(e),e in a?this._foreignContext.push(!0):e in l&&this._foreignContext.push(!1)),this._cbs.onopentagname&&this._cbs.onopentagname(e),this._cbs.onopentag&&(this._attribs={})},u.prototype.onopentagend=function(){this._updatePosition(1),this._attribs&&(this._cbs.onopentag&&this._cbs.onopentag(this._tagname,this._attribs),this._attribs=null),!this._options.xmlMode&&this._cbs.onclosetag&&this._tagname in s&&this._cbs.onclosetag(this._tagname),this._tagname=""},u.prototype.onclosetag=function(e){if(this._updatePosition(1),this._lowerCaseTagNames&&(e=e.toLowerCase()),(e in a||e in l)&&this._foreignContext.pop(),!this._stack.length||e in s&&!this._options.xmlMode)this._options.xmlMode||"br"!==e&&"p"!==e||(this.onopentagname(e),this._closeCurrentTag());else{var t=this._stack.lastIndexOf(e);if(-1!==t)if(this._cbs.onclosetag)for(t=this._stack.length-t;t--;)this._cbs.onclosetag(this._stack.pop());else this._stack.length=t;else"p"!==e||this._options.xmlMode||(this.onopentagname(e),this._closeCurrentTag())}},u.prototype.onselfclosingtag=function(){this._options.xmlMode||this._options.recognizeSelfClosing||this._foreignContext[this._foreignContext.length-1]?this._closeCurrentTag():this.onopentagend()},u.prototype._closeCurrentTag=function(){var e=this._tagname;this.onopentagend(),this._stack[this._stack.length-1]===e&&(this._cbs.onclosetag&&this._cbs.onclosetag(e),this._stack.pop())},u.prototype.onattribname=function(e){this._lowerCaseAttributeNames&&(e=e.toLowerCase()),this._attribname=e},u.prototype.onattribdata=function(e){this._attribvalue+=e},u.prototype.onattribend=function(){this._cbs.onattribute&&this._cbs.onattribute(this._attribname,this._attribvalue),this._attribs&&!Object.prototype.hasOwnProperty.call(this._attribs,this._attribname)&&(this._attribs[this._attribname]=this._attribvalue),this._attribname="",this._attribvalue=""},u.prototype._getInstructionName=function(e){var t=e.search(c),i=t<0?e:e.substr(0,t);return this._lowerCaseTagNames&&(i=i.toLowerCase()),i},u.prototype.ondeclaration=function(e){if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("!"+t,"!"+e)}},u.prototype.onprocessinginstruction=function(e){if(this._cbs.onprocessinginstruction){var t=this._getInstructionName(e);this._cbs.onprocessinginstruction("?"+t,"?"+e)}},u.prototype.oncomment=function(e){this._updatePosition(4),this._cbs.oncomment&&this._cbs.oncomment(e),this._cbs.oncommentend&&this._cbs.oncommentend()},u.prototype.oncdata=function(e){this._updatePosition(1),this._options.xmlMode||this._options.recognizeCDATA?(this._cbs.oncdatastart&&this._cbs.oncdatastart(),this._cbs.ontext&&this._cbs.ontext(e),this._cbs.oncdataend&&this._cbs.oncdataend()):this.oncomment("[CDATA["+e+"]]")},u.prototype.onerror=function(e){this._cbs.onerror&&this._cbs.onerror(e)},u.prototype.onend=function(){if(this._cbs.onclosetag)for(var e=this._stack.length;e>0;this._cbs.onclosetag(this._stack[--e]));this._cbs.onend&&this._cbs.onend()},u.prototype.reset=function(){this._cbs.onreset&&this._cbs.onreset(),this._tokenizer.reset(),this._tagname="",this._attribname="",this._attribs=null,this._stack=[],this._cbs.onparserinit&&this._cbs.onparserinit(this)},u.prototype.parseComplete=function(e){this.reset(),this.end(e)},u.prototype.write=function(e){this._tokenizer.write(e)},u.prototype.end=function(e){this._tokenizer.end(e)},u.prototype.pause=function(){this._tokenizer.pause()},u.prototype.resume=function(){this._tokenizer.resume()},u.prototype.parseChunk=u.prototype.write,u.prototype.done=u.prototype.end,t.exports=u},{"./Tokenizer.js":374,events:195,inherits:201}],372:[function(e,t,i){function n(e){this._cbs=e||{}}t.exports=n;var r=e("./").EVENTS;Object.keys(r).forEach((function(e){if(0===r[e])e="on"+e,n.prototype[e]=function(){this._cbs[e]&&this._cbs[e]()};else if(1===r[e])e="on"+e,n.prototype[e]=function(t){this._cbs[e]&&this._cbs[e](t)};else{if(2!==r[e])throw Error("wrong number of arguments");e="on"+e,n.prototype[e]=function(t,i){this._cbs[e]&&this._cbs[e](t,i)}}}))},{"./":376}],373:[function(e,t,i){t.exports=r;var n=e("./WritableStream.js");function r(e){n.call(this,new o(this),e)}function o(e){this.scope=e}e("inherits")(r,n),r.prototype.readable=!0;var s=e("../").EVENTS;Object.keys(s).forEach((function(e){if(0===s[e])o.prototype["on"+e]=function(){this.scope.emit(e)};else if(1===s[e])o.prototype["on"+e]=function(t){this.scope.emit(e,t)};else{if(2!==s[e])throw Error("wrong number of arguments!");o.prototype["on"+e]=function(t,i){this.scope.emit(e,t,i)}}}))},{"../":376,"./WritableStream.js":375,inherits:201}],374:[function(e,t,i){t.exports=ge;var n=e("entities/lib/decode_codepoint.js"),r=e("entities/maps/entities.json"),o=e("entities/maps/legacy.json"),s=e("entities/maps/xml.json"),a=0,l=a++,c=a++,u=a++,d=a++,p=a++,h=a++,f=a++,m=a++,g=a++,b=a++,v=a++,y=a++,k=a++,w=a++,x=a++,E=a++,C=a++,S=a++,_=a++,T=a++,A=a++,N=a++,I=a++,O=a++,P=a++,D=a++,L=a++,R=a++,M=a++,B=a++,j=a++,U=a++,F=a++,H=a++,q=a++,z=a++,G=a++,$=a++,V=a++,W=a++,K=a++,J=a++,Y=a++,X=a++,Q=a++,Z=a++,ee=a++,te=a++,ie=a++,ne=a++,re=a++,oe=a++,se=a++,ae=a++,le=a++,ce=0,ue=ce++,de=ce++,pe=ce++;function he(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function fe(e,t,i){var n=e.toLowerCase();return e===n?function(e){e===n?this._state=t:(this._state=i,this._index--)}:function(r){r===n||r===e?this._state=t:(this._state=i,this._index--)}}function me(e,t){var i=e.toLowerCase();return function(n){n===i||n===e?this._state=t:(this._state=u,this._index--)}}function ge(e,t){this._state=l,this._buffer="",this._sectionStart=0,this._index=0,this._bufferOffset=0,this._baseState=l,this._special=ue,this._cbs=t,this._running=!0,this._ended=!1,this._xmlMode=!(!e||!e.xmlMode),this._decodeEntities=!(!e||!e.decodeEntities)}ge.prototype._stateText=function(e){"<"===e?(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._state=c,this._sectionStart=this._index):this._decodeEntities&&this._special===ue&&"&"===e&&(this._index>this._sectionStart&&this._cbs.ontext(this._getSection()),this._baseState=l,this._state=re,this._sectionStart=this._index)},ge.prototype._stateBeforeTagName=function(e){"/"===e?this._state=p:"<"===e?(this._cbs.ontext(this._getSection()),this._sectionStart=this._index):">"===e||this._special!==ue||he(e)?this._state=l:"!"===e?(this._state=x,this._sectionStart=this._index+1):"?"===e?(this._state=C,this._sectionStart=this._index+1):(this._state=this._xmlMode||"s"!==e&&"S"!==e?u:j,this._sectionStart=this._index)},ge.prototype._stateInTagName=function(e){("/"===e||">"===e||he(e))&&(this._emitToken("onopentagname"),this._state=m,this._index--)},ge.prototype._stateBeforeCloseingTagName=function(e){he(e)||(">"===e?this._state=l:this._special!==ue?"s"===e||"S"===e?this._state=U:(this._state=l,this._index--):(this._state=h,this._sectionStart=this._index))},ge.prototype._stateInCloseingTagName=function(e){(">"===e||he(e))&&(this._emitToken("onclosetag"),this._state=f,this._index--)},ge.prototype._stateAfterCloseingTagName=function(e){">"===e&&(this._state=l,this._sectionStart=this._index+1)},ge.prototype._stateBeforeAttributeName=function(e){">"===e?(this._cbs.onopentagend(),this._state=l,this._sectionStart=this._index+1):"/"===e?this._state=d:he(e)||(this._state=g,this._sectionStart=this._index)},ge.prototype._stateInSelfClosingTag=function(e){">"===e?(this._cbs.onselfclosingtag(),this._state=l,this._sectionStart=this._index+1):he(e)||(this._state=m,this._index--)},ge.prototype._stateInAttributeName=function(e){("="===e||"/"===e||">"===e||he(e))&&(this._cbs.onattribname(this._getSection()),this._sectionStart=-1,this._state=b,this._index--)},ge.prototype._stateAfterAttributeName=function(e){"="===e?this._state=v:"/"===e||">"===e?(this._cbs.onattribend(),this._state=m,this._index--):he(e)||(this._cbs.onattribend(),this._state=g,this._sectionStart=this._index)},ge.prototype._stateBeforeAttributeValue=function(e){'"'===e?(this._state=y,this._sectionStart=this._index+1):"'"===e?(this._state=k,this._sectionStart=this._index+1):he(e)||(this._state=w,this._sectionStart=this._index,this._index--)},ge.prototype._stateInAttributeValueDoubleQuotes=function(e){'"'===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=m):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=re,this._sectionStart=this._index)},ge.prototype._stateInAttributeValueSingleQuotes=function(e){"'"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=m):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=re,this._sectionStart=this._index)},ge.prototype._stateInAttributeValueNoQuotes=function(e){he(e)||">"===e?(this._emitToken("onattribdata"),this._cbs.onattribend(),this._state=m,this._index--):this._decodeEntities&&"&"===e&&(this._emitToken("onattribdata"),this._baseState=this._state,this._state=re,this._sectionStart=this._index)},ge.prototype._stateBeforeDeclaration=function(e){this._state="["===e?N:"-"===e?S:E},ge.prototype._stateInDeclaration=function(e){">"===e&&(this._cbs.ondeclaration(this._getSection()),this._state=l,this._sectionStart=this._index+1)},ge.prototype._stateInProcessingInstruction=function(e){">"===e&&(this._cbs.onprocessinginstruction(this._getSection()),this._state=l,this._sectionStart=this._index+1)},ge.prototype._stateBeforeComment=function(e){"-"===e?(this._state=_,this._sectionStart=this._index+1):this._state=E},ge.prototype._stateInComment=function(e){"-"===e&&(this._state=T)},ge.prototype._stateAfterComment1=function(e){this._state="-"===e?A:_},ge.prototype._stateAfterComment2=function(e){">"===e?(this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2)),this._state=l,this._sectionStart=this._index+1):"-"!==e&&(this._state=_)},ge.prototype._stateBeforeCdata1=fe("C",I,E),ge.prototype._stateBeforeCdata2=fe("D",O,E),ge.prototype._stateBeforeCdata3=fe("A",P,E),ge.prototype._stateBeforeCdata4=fe("T",D,E),ge.prototype._stateBeforeCdata5=fe("A",L,E),ge.prototype._stateBeforeCdata6=function(e){"["===e?(this._state=R,this._sectionStart=this._index+1):(this._state=E,this._index--)},ge.prototype._stateInCdata=function(e){"]"===e&&(this._state=M)},ge.prototype._stateAfterCdata1=function(e){this._state="]"===e?B:R},ge.prototype._stateAfterCdata2=function(e){">"===e?(this._cbs.oncdata(this._buffer.substring(this._sectionStart,this._index-2)),this._state=l,this._sectionStart=this._index+1):"]"!==e&&(this._state=R)},ge.prototype._stateBeforeSpecial=function(e){"c"===e||"C"===e?this._state=F:"t"===e||"T"===e?this._state=Y:(this._state=u,this._index--)},ge.prototype._stateBeforeSpecialEnd=function(e){this._special!==de||"c"!==e&&"C"!==e?this._special!==pe||"t"!==e&&"T"!==e?this._state=l:this._state=ee:this._state=$},ge.prototype._stateBeforeScript1=me("R",H),ge.prototype._stateBeforeScript2=me("I",q),ge.prototype._stateBeforeScript3=me("P",z),ge.prototype._stateBeforeScript4=me("T",G),ge.prototype._stateBeforeScript5=function(e){("/"===e||">"===e||he(e))&&(this._special=de),this._state=u,this._index--},ge.prototype._stateAfterScript1=fe("R",V,l),ge.prototype._stateAfterScript2=fe("I",W,l),ge.prototype._stateAfterScript3=fe("P",K,l),ge.prototype._stateAfterScript4=fe("T",J,l),ge.prototype._stateAfterScript5=function(e){">"===e||he(e)?(this._special=ue,this._state=h,this._sectionStart=this._index-6,this._index--):this._state=l},ge.prototype._stateBeforeStyle1=me("Y",X),ge.prototype._stateBeforeStyle2=me("L",Q),ge.prototype._stateBeforeStyle3=me("E",Z),ge.prototype._stateBeforeStyle4=function(e){("/"===e||">"===e||he(e))&&(this._special=pe),this._state=u,this._index--},ge.prototype._stateAfterStyle1=fe("Y",te,l),ge.prototype._stateAfterStyle2=fe("L",ie,l),ge.prototype._stateAfterStyle3=fe("E",ne,l),ge.prototype._stateAfterStyle4=function(e){">"===e||he(e)?(this._special=ue,this._state=h,this._sectionStart=this._index-5,this._index--):this._state=l},ge.prototype._stateBeforeEntity=fe("#",oe,se),ge.prototype._stateBeforeNumericEntity=fe("X",le,ae),ge.prototype._parseNamedEntityStrict=function(){if(this._sectionStart+1<this._index){var e=this._buffer.substring(this._sectionStart+1,this._index),t=this._xmlMode?s:r;t.hasOwnProperty(e)&&(this._emitPartial(t[e]),this._sectionStart=this._index+1)}},ge.prototype._parseLegacyEntity=function(){var e=this._sectionStart+1,t=this._index-e;for(t>6&&(t=6);t>=2;){var i=this._buffer.substr(e,t);if(o.hasOwnProperty(i))return this._emitPartial(o[i]),void(this._sectionStart+=t+1);t--}},ge.prototype._stateInNamedEntity=function(e){";"===e?(this._parseNamedEntityStrict(),this._sectionStart+1<this._index&&!this._xmlMode&&this._parseLegacyEntity(),this._state=this._baseState):(e<"a"||e>"z")&&(e<"A"||e>"Z")&&(e<"0"||e>"9")&&(this._xmlMode||this._sectionStart+1===this._index||(this._baseState!==l?"="!==e&&this._parseNamedEntityStrict():this._parseLegacyEntity()),this._state=this._baseState,this._index--)},ge.prototype._decodeNumericEntity=function(e,t){var i=this._sectionStart+e;if(i!==this._index){var r=this._buffer.substring(i,this._index),o=parseInt(r,t);this._emitPartial(n(o)),this._sectionStart=this._index}else this._sectionStart--;this._state=this._baseState},ge.prototype._stateInNumericEntity=function(e){";"===e?(this._decodeNumericEntity(2,10),this._sectionStart++):(e<"0"||e>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(2,10),this._index--)},ge.prototype._stateInHexEntity=function(e){";"===e?(this._decodeNumericEntity(3,16),this._sectionStart++):(e<"a"||e>"f")&&(e<"A"||e>"F")&&(e<"0"||e>"9")&&(this._xmlMode?this._state=this._baseState:this._decodeNumericEntity(3,16),this._index--)},ge.prototype._cleanup=function(){this._sectionStart<0?(this._buffer="",this._bufferOffset+=this._index,this._index=0):this._running&&(this._state===l?(this._sectionStart!==this._index&&this._cbs.ontext(this._buffer.substr(this._sectionStart)),this._buffer="",this._bufferOffset+=this._index,this._index=0):this._sectionStart===this._index?(this._buffer="",this._bufferOffset+=this._index,this._index=0):(this._buffer=this._buffer.substr(this._sectionStart),this._index-=this._sectionStart,this._bufferOffset+=this._sectionStart),this._sectionStart=0)},ge.prototype.write=function(e){this._ended&&this._cbs.onerror(Error(".write() after done!")),this._buffer+=e,this._parse()},ge.prototype._parse=function(){for(;this._index<this._buffer.length&&this._running;){var e=this._buffer.charAt(this._index);this._state===l?this._stateText(e):this._state===c?this._stateBeforeTagName(e):this._state===u?this._stateInTagName(e):this._state===p?this._stateBeforeCloseingTagName(e):this._state===h?this._stateInCloseingTagName(e):this._state===f?this._stateAfterCloseingTagName(e):this._state===d?this._stateInSelfClosingTag(e):this._state===m?this._stateBeforeAttributeName(e):this._state===g?this._stateInAttributeName(e):this._state===b?this._stateAfterAttributeName(e):this._state===v?this._stateBeforeAttributeValue(e):this._state===y?this._stateInAttributeValueDoubleQuotes(e):this._state===k?this._stateInAttributeValueSingleQuotes(e):this._state===w?this._stateInAttributeValueNoQuotes(e):this._state===x?this._stateBeforeDeclaration(e):this._state===E?this._stateInDeclaration(e):this._state===C?this._stateInProcessingInstruction(e):this._state===S?this._stateBeforeComment(e):this._state===_?this._stateInComment(e):this._state===T?this._stateAfterComment1(e):this._state===A?this._stateAfterComment2(e):this._state===N?this._stateBeforeCdata1(e):this._state===I?this._stateBeforeCdata2(e):this._state===O?this._stateBeforeCdata3(e):this._state===P?this._stateBeforeCdata4(e):this._state===D?this._stateBeforeCdata5(e):this._state===L?this._stateBeforeCdata6(e):this._state===R?this._stateInCdata(e):this._state===M?this._stateAfterCdata1(e):this._state===B?this._stateAfterCdata2(e):this._state===j?this._stateBeforeSpecial(e):this._state===U?this._stateBeforeSpecialEnd(e):this._state===F?this._stateBeforeScript1(e):this._state===H?this._stateBeforeScript2(e):this._state===q?this._stateBeforeScript3(e):this._state===z?this._stateBeforeScript4(e):this._state===G?this._stateBeforeScript5(e):this._state===$?this._stateAfterScript1(e):this._state===V?this._stateAfterScript2(e):this._state===W?this._stateAfterScript3(e):this._state===K?this._stateAfterScript4(e):this._state===J?this._stateAfterScript5(e):this._state===Y?this._stateBeforeStyle1(e):this._state===X?this._stateBeforeStyle2(e):this._state===Q?this._stateBeforeStyle3(e):this._state===Z?this._stateBeforeStyle4(e):this._state===ee?this._stateAfterStyle1(e):this._state===te?this._stateAfterStyle2(e):this._state===ie?this._stateAfterStyle3(e):this._state===ne?this._stateAfterStyle4(e):this._state===re?this._stateBeforeEntity(e):this._state===oe?this._stateBeforeNumericEntity(e):this._state===se?this._stateInNamedEntity(e):this._state===ae?this._stateInNumericEntity(e):this._state===le?this._stateInHexEntity(e):this._cbs.onerror(Error("unknown _state"),this._state),this._index++}this._cleanup()},ge.prototype.pause=function(){this._running=!1},ge.prototype.resume=function(){this._running=!0,this._index<this._buffer.length&&this._parse(),this._ended&&this._finish()},ge.prototype.end=function(e){this._ended&&this._cbs.onerror(Error(".end() after done!")),e&&this.write(e),this._ended=!0,this._running&&this._finish()},ge.prototype._finish=function(){this._sectionStart<this._index&&this._handleTrailingData(),this._cbs.onend()},ge.prototype._handleTrailingData=function(){var e=this._buffer.substr(this._sectionStart);this._state===R||this._state===M||this._state===B?this._cbs.oncdata(e):this._state===_||this._state===T||this._state===A?this._cbs.oncomment(e):this._state!==se||this._xmlMode?this._state!==ae||this._xmlMode?this._state!==le||this._xmlMode?this._state!==u&&this._state!==m&&this._state!==v&&this._state!==b&&this._state!==g&&this._state!==k&&this._state!==y&&this._state!==w&&this._state!==h&&this._cbs.ontext(e):(this._decodeNumericEntity(3,16),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._decodeNumericEntity(2,10),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData())):(this._parseLegacyEntity(),this._sectionStart<this._index&&(this._state=this._baseState,this._handleTrailingData()))},ge.prototype.reset=function(){ge.call(this,{xmlMode:this._xmlMode,decodeEntities:this._decodeEntities},this._cbs)},ge.prototype.getAbsoluteIndex=function(){return this._bufferOffset+this._index},ge.prototype._getSection=function(){return this._buffer.substring(this._sectionStart,this._index)},ge.prototype._emitToken=function(e){this._cbs[e](this._getSection()),this._sectionStart=-1},ge.prototype._emitPartial=function(e){this._baseState!==l?this._cbs.onattribdata(e):this._cbs.ontext(e)}},{"entities/lib/decode_codepoint.js":364,"entities/maps/entities.json":366,"entities/maps/legacy.json":367,"entities/maps/xml.json":368}],375:[function(e,t,i){t.exports=a;var n=e("./Parser.js"),r=e("readable-stream").Writable,o=e("string_decoder").StringDecoder,s=e("buffer").Buffer;function a(e,t){var i=this._parser=new n(e,t),s=this._decoder=new o;r.call(this,{decodeStrings:!1}),this.once("finish",(function(){i.end(s.end())}))}e("inherits")(a,r),a.prototype._write=function(e,t,i){e instanceof s&&(e=this._decoder.write(e)),this._parser.write(e),i()}},{"./Parser.js":371,buffer:168,inherits:201,"readable-stream":167,string_decoder:380}],376:[function(e,t,i){var n=e("./Parser.js"),r=e("domhandler");function o(e,i){return delete t.exports[e],t.exports[e]=i,i}t.exports={Parser:n,Tokenizer:e("./Tokenizer.js"),ElementType:e("domelementtype"),DomHandler:r,get FeedHandler(){return o("FeedHandler",e("./FeedHandler.js"))},get Stream(){return o("Stream",e("./Stream.js"))},get WritableStream(){return o("WritableStream",e("./WritableStream.js"))},get ProxyHandler(){return o("ProxyHandler",e("./ProxyHandler.js"))},get DomUtils(){return o("DomUtils",e("domutils"))},get CollectingHandler(){return o("CollectingHandler",e("./CollectingHandler.js"))},DefaultHandler:r,get RssHandler(){return o("RssHandler",this.FeedHandler)},parseDOM:function(e,t){var i=new r(t);return new n(i,t).end(e),i.dom},parseFeed:function(e,i){var r=new t.exports.FeedHandler(i);return new n(r,i).end(e),r.dom},createDomStream:function(e,t,i){var o=new r(e,t,i);return new n(o,t)},EVENTS:{attribute:2,cdatastart:0,cdataend:0,text:1,processinginstruction:2,comment:1,commentend:0,closetag:1,opentag:2,opentagname:1,error:1,end:0}}},{"./CollectingHandler.js":369,"./FeedHandler.js":370,"./Parser.js":371,"./ProxyHandler.js":372,"./Stream.js":373,"./Tokenizer.js":374,"./WritableStream.js":375,domelementtype:176,domhandler:361,domutils:177}],377:[function(e,t,i){!function(e){Date.now=Date.now||function(){return(new Date).getTime()};var t={extend:function(){arguments[0]=arguments[0]||{};for(var e=1;e<arguments.length;e++)for(var i in arguments[e])arguments[e].hasOwnProperty(i)&&("object"==typeof arguments[e][i]?arguments[e][i]instanceof Array?arguments[0][i]=arguments[e][i]:arguments[0][i]=t.extend(arguments[0][i],arguments[e][i]):arguments[0][i]=arguments[e][i]);return arguments[0]},binarySearch:function(e,t){for(var i=0,n=e.length;i<n;){var r=i+n>>1;t<e[r][0]?n=r:i=r+1}return i}};function i(e){this.options=t.extend({},i.defaultOptions,e),this.disabled=!1,this.clear()}function n(e){this.options=t.extend({},n.defaultChartOptions,e),this.seriesSet=[],this.currentValueRange=1,this.currentVisMinValue=0,this.lastRenderTimeMillis=0,this.lastChartTimestamp=0,this.mousemove=this.mousemove.bind(this),this.mouseout=this.mouseout.bind(this)}i.defaultOptions={resetBoundsInterval:3e3,resetBounds:!0},i.prototype.clear=function(){this.data=[],this.maxValue=Number.NaN,this.minValue=Number.NaN},i.prototype.resetBounds=function(){if(this.data.length){this.maxValue=this.data[0][1],this.minValue=this.data[0][1];for(var e=1;e<this.data.length;e++){var t=this.data[e][1];t>this.maxValue&&(this.maxValue=t),t<this.minValue&&(this.minValue=t)}}else this.maxValue=Number.NaN,this.minValue=Number.NaN},i.prototype.append=function(e,t,i){for(var n=this.data.length-1;n>=0&&this.data[n][0]>e;)n--;-1===n?this.data.splice(0,0,[e,t]):this.data.length>0&&this.data[n][0]===e?i?(this.data[n][1]+=t,t=this.data[n][1]):this.data[n][1]=t:n<this.data.length-1?this.data.splice(n+1,0,[e,t]):this.data.push([e,t]),this.maxValue=isNaN(this.maxValue)?t:Math.max(this.maxValue,t),this.minValue=isNaN(this.minValue)?t:Math.min(this.minValue,t)},i.prototype.dropOldData=function(e,t){for(var i=0;this.data.length-i>=t&&this.data[i+1][0]<e;)i++;0!==i&&this.data.splice(0,i)},n.tooltipFormatter=function(e,t){for(var i=[(this.options.timestampFormatter||n.timeFormatter)(new Date(e))],r=0;r<t.length;++r)i.push('<span style="color:'+t[r].series.options.strokeStyle+'">'+this.options.yMaxFormatter(t[r].value,this.options.labels.precision)+"</span>");return i.join("<br>")},n.defaultChartOptions={millisPerPixel:20,enableDpiScaling:!0,yMinFormatter:function(e,t){return parseFloat(e).toFixed(t)},yMaxFormatter:function(e,t){return parseFloat(e).toFixed(t)},yIntermediateFormatter:function(e,t){return parseFloat(e).toFixed(t)},maxValueScale:1,minValueScale:1,interpolation:"bezier",scaleSmoothing:.125,maxDataSetLength:2,scrollBackwards:!1,displayDataFromPercentile:1,grid:{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,sharpLines:!1,millisPerLine:1e3,verticalSections:2,borderVisible:!0},labels:{fillStyle:"#ffffff",disabled:!1,fontSize:10,fontFamily:"monospace",precision:2,showIntermediateLabels:!1,intermediateLabelSameAxis:!0},horizontalLines:[],tooltip:!1,tooltipLine:{lineWidth:1,strokeStyle:"#BBBBBB"},tooltipFormatter:n.tooltipFormatter,nonRealtimeData:!1,responsive:!1,limitFPS:0},n.AnimateCompatibility={requestAnimationFrame:function(e,t){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout((function(){e(Date.now())}),16)}).call(window,e,t)},cancelAnimationFrame:function(e){return(window.cancelAnimationFrame||function(e){clearTimeout(e)}).call(window,e)}},n.defaultSeriesPresentationOptions={lineWidth:1,strokeStyle:"#ffffff"},n.prototype.addTimeSeries=function(e,i){this.seriesSet.push({timeSeries:e,options:t.extend({},n.defaultSeriesPresentationOptions,i)}),e.options.resetBounds&&e.options.resetBoundsInterval>0&&(e.resetBoundsTimerId=setInterval((function(){e.resetBounds()}),e.options.resetBoundsInterval))},n.prototype.removeTimeSeries=function(e){for(var t=this.seriesSet.length,i=0;i<t;i++)if(this.seriesSet[i].timeSeries===e){this.seriesSet.splice(i,1);break}e.resetBoundsTimerId&&clearInterval(e.resetBoundsTimerId)},n.prototype.getTimeSeriesOptions=function(e){for(var t=this.seriesSet.length,i=0;i<t;i++)if(this.seriesSet[i].timeSeries===e)return this.seriesSet[i].options},n.prototype.bringToFront=function(e){for(var t=this.seriesSet.length,i=0;i<t;i++)if(this.seriesSet[i].timeSeries===e){var n=this.seriesSet.splice(i,1);this.seriesSet.push(n[0]);break}},n.prototype.streamTo=function(e,t){this.canvas=e,this.delay=t,this.start()},n.prototype.getTooltipEl=function(){return this.tooltipEl||(this.tooltipEl=document.createElement("div"),this.tooltipEl.className="smoothie-chart-tooltip",this.tooltipEl.style.position="absolute",this.tooltipEl.style.display="none",document.body.appendChild(this.tooltipEl)),this.tooltipEl},n.prototype.updateTooltip=function(){var e=this.getTooltipEl();if(this.mouseover&&this.options.tooltip){for(var i=this.lastChartTimestamp,n=this.options.scrollBackwards?i-this.mouseX*this.options.millisPerPixel:i-(this.canvas.offsetWidth-this.mouseX)*this.options.millisPerPixel,r=[],o=0;o<this.seriesSet.length;o++){var s=this.seriesSet[o].timeSeries;if(!s.disabled){var a=t.binarySearch(s.data,n);a>0&&a<s.data.length&&r.push({series:this.seriesSet[o],index:a,value:s.data[a][1]})}}r.length?(e.innerHTML=this.options.tooltipFormatter.call(this,n,r),e.style.display="block"):e.style.display="none"}else e.style.display="none"},n.prototype.mousemove=function(e){this.mouseover=!0,this.mouseX=e.offsetX,this.mouseY=e.offsetY,this.mousePageX=e.pageX,this.mousePageY=e.pageY;var t=this.getTooltipEl();t.style.top=Math.round(this.mousePageY)+"px",t.style.left=Math.round(this.mousePageX)+"px",this.updateTooltip()},n.prototype.mouseout=function(){this.mouseover=!1,this.mouseX=this.mouseY=-1,this.tooltipEl&&(this.tooltipEl.style.display="none")},n.prototype.resize=function(){var e,t,i=this.options.enableDpiScaling&&window?window.devicePixelRatio:1;this.options.responsive?(e=this.canvas.offsetWidth,t=this.canvas.offsetHeight,e!==this.lastWidth&&(this.lastWidth=e,this.canvas.setAttribute("width",Math.floor(e*i).toString()),this.canvas.getContext("2d").scale(i,i)),t!==this.lastHeight&&(this.lastHeight=t,this.canvas.setAttribute("height",Math.floor(t*i).toString()),this.canvas.getContext("2d").scale(i,i))):1!==i&&(e=parseInt(this.canvas.getAttribute("width")),t=parseInt(this.canvas.getAttribute("height")),this.originalWidth&&Math.floor(this.originalWidth*i)===e||(this.originalWidth=e,this.canvas.setAttribute("width",Math.floor(e*i).toString()),this.canvas.style.width=e+"px",this.canvas.getContext("2d").scale(i,i)),this.originalHeight&&Math.floor(this.originalHeight*i)===t||(this.originalHeight=t,this.canvas.setAttribute("height",Math.floor(t*i).toString()),this.canvas.style.height=t+"px",this.canvas.getContext("2d").scale(i,i)))},n.prototype.start=function(){if(!this.frame){this.canvas.addEventListener("mousemove",this.mousemove),this.canvas.addEventListener("mouseout",this.mouseout);var e=function(){this.frame=n.AnimateCompatibility.requestAnimationFrame(function(){if(this.options.nonRealtimeData){var t=new Date(0),i=this.seriesSet.reduce(function(e,t){var i=t.timeSeries.data,n=Math.round(this.options.displayDataFromPercentile*i.length)-1;if(n=(n=n>=0?n:0)<=i.length-1?n:i.length-1,i&&i.length>0){var r=i[n][0];e=e>r?e:r}return e}.bind(this),t);this.render(this.canvas,i>t?i:null)}else this.render();e()}.bind(this))}.bind(this);e()}},n.prototype.stop=function(){this.frame&&(n.AnimateCompatibility.cancelAnimationFrame(this.frame),delete this.frame,this.canvas.removeEventListener("mousemove",this.mousemove),this.canvas.removeEventListener("mouseout",this.mouseout))},n.prototype.updateValueRange=function(){for(var e=this.options,t=Number.NaN,i=Number.NaN,n=0;n<this.seriesSet.length;n++){var r=this.seriesSet[n].timeSeries;r.disabled||(isNaN(r.maxValue)||(t=isNaN(t)?r.maxValue:Math.max(t,r.maxValue)),isNaN(r.minValue)||(i=isNaN(i)?r.minValue:Math.min(i,r.minValue)))}if(null!=e.maxValue?t=e.maxValue:t*=e.maxValueScale,null!=e.minValue?i=e.minValue:i-=Math.abs(i*e.minValueScale-i),this.options.yRangeFunction){var o=this.options.yRangeFunction({min:i,max:t});i=o.min,t=o.max}if(!isNaN(t)&&!isNaN(i)){var s=t-i-this.currentValueRange,a=i-this.currentVisMinValue;this.isAnimatingScale=Math.abs(s)>.1||Math.abs(a)>.1,this.currentValueRange+=e.scaleSmoothing*s,this.currentVisMinValue+=e.scaleSmoothing*a}this.valueRange={min:i,max:t}},n.prototype.render=function(e,t){var i=Date.now();if(!(this.options.limitFPS>0&&i-this.lastRenderTimeMillis<1e3/this.options.limitFPS)){if(!this.isAnimatingScale){var n=Math.min(1e3/6,this.options.millisPerPixel);if(i-this.lastRenderTimeMillis<n)return}this.resize(),this.updateTooltip(),this.lastRenderTimeMillis=i,e=e||this.canvas,t=t||i-(this.delay||0),t-=t%this.options.millisPerPixel,this.lastChartTimestamp=t;var r=e.getContext("2d"),o=this.options,s={top:0,left:0,width:e.clientWidth,height:e.clientHeight},a=t-s.width*o.millisPerPixel,l=function(e){var t=e-this.currentVisMinValue;return 0===this.currentValueRange?s.height:s.height-Math.round(t/this.currentValueRange*s.height)}.bind(this),c=function(e){return o.scrollBackwards?Math.round((t-e)/o.millisPerPixel):Math.round(s.width-(t-e)/o.millisPerPixel)};if(this.updateValueRange(),r.font=o.labels.fontSize+"px "+o.labels.fontFamily,r.save(),r.translate(s.left,s.top),r.beginPath(),r.rect(0,0,s.width,s.height),r.clip(),r.save(),r.fillStyle=o.grid.fillStyle,r.clearRect(0,0,s.width,s.height),r.fillRect(0,0,s.width,s.height),r.restore(),r.save(),r.lineWidth=o.grid.lineWidth,r.strokeStyle=o.grid.strokeStyle,o.grid.millisPerLine>0){r.beginPath();for(var u=t-t%o.grid.millisPerLine;u>=a;u-=o.grid.millisPerLine){var d=c(u);o.grid.sharpLines&&(d-=.5),r.moveTo(d,0),r.lineTo(d,s.height)}r.stroke(),r.closePath()}for(var p=1;p<o.grid.verticalSections;p++){var h=Math.round(p*s.height/o.grid.verticalSections);o.grid.sharpLines&&(h-=.5),r.beginPath(),r.moveTo(0,h),r.lineTo(s.width,h),r.stroke(),r.closePath()}if(o.grid.borderVisible&&(r.beginPath(),r.strokeRect(0,0,s.width,s.height),r.closePath()),r.restore(),o.horizontalLines&&o.horizontalLines.length)for(var f=0;f<o.horizontalLines.length;f++){var m=o.horizontalLines[f],g=Math.round(l(m.value))-.5;r.strokeStyle=m.color||"#ffffff",r.lineWidth=m.lineWidth||1,r.beginPath(),r.moveTo(0,g),r.lineTo(s.width,g),r.stroke(),r.closePath()}for(var b=0;b<this.seriesSet.length;b++){r.save();var v=this.seriesSet[b].timeSeries;if(!v.disabled){var y=v.data,k=this.seriesSet[b].options;v.dropOldData(a,o.maxDataSetLength),r.lineWidth=k.lineWidth,r.strokeStyle=k.strokeStyle,r.beginPath();for(var w=0,x=0,E=0,C=0;C<y.length&&1!==y.length;C++){var S=c(y[C][0]),_=l(y[C][1]);if(0===C)w=S,r.moveTo(S,_);else switch(o.interpolation){case"linear":case"line":r.lineTo(S,_);break;case"bezier":default:r.bezierCurveTo(Math.round((x+S)/2),E,Math.round(x+S)/2,_,S,_);break;case"step":r.lineTo(S,E),r.lineTo(S,_)}x=S,E=_}y.length>1&&(k.fillStyle&&(r.lineTo(s.width+k.lineWidth+1,E),r.lineTo(s.width+k.lineWidth+1,s.height+k.lineWidth+1),r.lineTo(w,s.height+k.lineWidth),r.fillStyle=k.fillStyle,r.fill()),k.strokeStyle&&"none"!==k.strokeStyle&&r.stroke(),r.closePath()),r.restore()}}if(o.tooltip&&this.mouseX>=0&&(r.lineWidth=o.tooltipLine.lineWidth,r.strokeStyle=o.tooltipLine.strokeStyle,r.beginPath(),r.moveTo(this.mouseX,0),r.lineTo(this.mouseX,s.height),r.closePath(),r.stroke(),this.updateTooltip()),!o.labels.disabled&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)){var T=o.yMaxFormatter(this.valueRange.max,o.labels.precision),A=o.yMinFormatter(this.valueRange.min,o.labels.precision),N=o.scrollBackwards?0:s.width-r.measureText(T).width-2,I=o.scrollBackwards?0:s.width-r.measureText(A).width-2;r.fillStyle=o.labels.fillStyle,r.fillText(T,N,o.labels.fontSize),r.fillText(A,I,s.height-2)}if(o.labels.showIntermediateLabels&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)&&o.grid.verticalSections>0){var O=(this.valueRange.max-this.valueRange.min)/o.grid.verticalSections,P=s.height/o.grid.verticalSections;for(p=1;p<o.grid.verticalSections;p++){h=s.height-Math.round(p*P),o.grid.sharpLines&&(h-=.5);var D=o.yIntermediateFormatter(this.valueRange.min+p*O,o.labels.precision);intermediateLabelPos=o.labels.intermediateLabelSameAxis?o.scrollBackwards?0:s.width-r.measureText(D).width-2:o.scrollBackwards?s.width-r.measureText(D).width-2:0,r.fillText(D,intermediateLabelPos,h-o.grid.lineWidth)}}if(o.timestampFormatter&&o.grid.millisPerLine>0){var L=o.scrollBackwards?r.measureText(A).width:s.width-r.measureText(A).width+4;for(u=t-t%o.grid.millisPerLine;u>=a;u-=o.grid.millisPerLine)if(d=c(u),!o.scrollBackwards&&d<L||o.scrollBackwards&&d>L){var R=new Date(u),M=o.timestampFormatter(R),B=r.measureText(M).width;L=o.scrollBackwards?d+B+2:d-B-2,r.fillStyle=o.labels.fillStyle,o.scrollBackwards?r.fillText(M,d,s.height-2):r.fillText(M,d-B,s.height-2)}}r.restore()}},n.timeFormatter=function(e){function t(e){return(e<10?"0":"")+e}return t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())},e.TimeSeries=i,e.SmoothieChart=n}(void 0===i?this:i)},{}],378:[function(e,t,i){!function(e){if("object"==typeof i)t.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var n;try{n=window}catch(e){n=self}n.SparkMD5=e()}}((function(e){"use strict";var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(e,t){var i=e[0],n=e[1],r=e[2],o=e[3];n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&r|~n&o)+t[0]-680876936|0)<<7|i>>>25)+n|0)&n|~i&r)+t[1]-389564586|0)<<12|o>>>20)+i|0)&i|~o&n)+t[2]+606105819|0)<<17|r>>>15)+o|0)&o|~r&i)+t[3]-1044525330|0)<<22|n>>>10)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&r|~n&o)+t[4]-176418897|0)<<7|i>>>25)+n|0)&n|~i&r)+t[5]+1200080426|0)<<12|o>>>20)+i|0)&i|~o&n)+t[6]-1473231341|0)<<17|r>>>15)+o|0)&o|~r&i)+t[7]-45705983|0)<<22|n>>>10)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&r|~n&o)+t[8]+1770035416|0)<<7|i>>>25)+n|0)&n|~i&r)+t[9]-1958414417|0)<<12|o>>>20)+i|0)&i|~o&n)+t[10]-42063|0)<<17|r>>>15)+o|0)&o|~r&i)+t[11]-1990404162|0)<<22|n>>>10)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&r|~n&o)+t[12]+1804603682|0)<<7|i>>>25)+n|0)&n|~i&r)+t[13]-40341101|0)<<12|o>>>20)+i|0)&i|~o&n)+t[14]-1502002290|0)<<17|r>>>15)+o|0)&o|~r&i)+t[15]+1236535329|0)<<22|n>>>10)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&o|r&~o)+t[1]-165796510|0)<<5|i>>>27)+n|0)&r|n&~r)+t[6]-1069501632|0)<<9|o>>>23)+i|0)&n|i&~n)+t[11]+643717713|0)<<14|r>>>18)+o|0)&i|o&~i)+t[0]-373897302|0)<<20|n>>>12)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&o|r&~o)+t[5]-701558691|0)<<5|i>>>27)+n|0)&r|n&~r)+t[10]+38016083|0)<<9|o>>>23)+i|0)&n|i&~n)+t[15]-660478335|0)<<14|r>>>18)+o|0)&i|o&~i)+t[4]-405537848|0)<<20|n>>>12)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&o|r&~o)+t[9]+568446438|0)<<5|i>>>27)+n|0)&r|n&~r)+t[14]-1019803690|0)<<9|o>>>23)+i|0)&n|i&~n)+t[3]-187363961|0)<<14|r>>>18)+o|0)&i|o&~i)+t[8]+1163531501|0)<<20|n>>>12)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n&o|r&~o)+t[13]-1444681467|0)<<5|i>>>27)+n|0)&r|n&~r)+t[2]-51403784|0)<<9|o>>>23)+i|0)&n|i&~n)+t[7]+1735328473|0)<<14|r>>>18)+o|0)&i|o&~i)+t[12]-1926607734|0)<<20|n>>>12)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n^r^o)+t[5]-378558|0)<<4|i>>>28)+n|0)^n^r)+t[8]-2022574463|0)<<11|o>>>21)+i|0)^i^n)+t[11]+1839030562|0)<<16|r>>>16)+o|0)^o^i)+t[14]-35309556|0)<<23|n>>>9)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n^r^o)+t[1]-1530992060|0)<<4|i>>>28)+n|0)^n^r)+t[4]+1272893353|0)<<11|o>>>21)+i|0)^i^n)+t[7]-155497632|0)<<16|r>>>16)+o|0)^o^i)+t[10]-1094730640|0)<<23|n>>>9)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n^r^o)+t[13]+681279174|0)<<4|i>>>28)+n|0)^n^r)+t[0]-358537222|0)<<11|o>>>21)+i|0)^i^n)+t[3]-722521979|0)<<16|r>>>16)+o|0)^o^i)+t[6]+76029189|0)<<23|n>>>9)+r|0,n=((n+=((r=((r+=((o=((o+=((i=((i+=(n^r^o)+t[9]-640364487|0)<<4|i>>>28)+n|0)^n^r)+t[12]-421815835|0)<<11|o>>>21)+i|0)^i^n)+t[15]+530742520|0)<<16|r>>>16)+o|0)^o^i)+t[2]-995338651|0)<<23|n>>>9)+r|0,n=((n+=((o=((o+=(n^((i=((i+=(r^(n|~o))+t[0]-198630844|0)<<6|i>>>26)+n|0)|~r))+t[7]+1126891415|0)<<10|o>>>22)+i|0)^((r=((r+=(i^(o|~n))+t[14]-1416354905|0)<<15|r>>>17)+o|0)|~i))+t[5]-57434055|0)<<21|n>>>11)+r|0,n=((n+=((o=((o+=(n^((i=((i+=(r^(n|~o))+t[12]+1700485571|0)<<6|i>>>26)+n|0)|~r))+t[3]-1894986606|0)<<10|o>>>22)+i|0)^((r=((r+=(i^(o|~n))+t[10]-1051523|0)<<15|r>>>17)+o|0)|~i))+t[1]-2054922799|0)<<21|n>>>11)+r|0,n=((n+=((o=((o+=(n^((i=((i+=(r^(n|~o))+t[8]+1873313359|0)<<6|i>>>26)+n|0)|~r))+t[15]-30611744|0)<<10|o>>>22)+i|0)^((r=((r+=(i^(o|~n))+t[6]-1560198380|0)<<15|r>>>17)+o|0)|~i))+t[13]+1309151649|0)<<21|n>>>11)+r|0,n=((n+=((o=((o+=(n^((i=((i+=(r^(n|~o))+t[4]-145523070|0)<<6|i>>>26)+n|0)|~r))+t[11]-1120210379|0)<<10|o>>>22)+i|0)^((r=((r+=(i^(o|~n))+t[2]+718787259|0)<<15|r>>>17)+o|0)|~i))+t[9]-343485551|0)<<21|n>>>11)+r|0,e[0]=i+e[0]|0,e[1]=n+e[1]|0,e[2]=r+e[2]|0,e[3]=o+e[3]|0}function n(e){var t,i=[];for(t=0;t<64;t+=4)i[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return i}function r(e){var t,i=[];for(t=0;t<64;t+=4)i[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return i}function o(e){var t,r,o,s,a,l,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)i(u,n(e.substring(t-64,t)));for(r=(e=e.substring(t-64)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<r;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(i(u,o),t=0;t<16;t+=1)o[t]=0;return s=(s=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),l=parseInt(s[1],16)||0,o[14]=a,o[15]=l,i(u,o),u}function s(e){var i,n="";for(i=0;i<4;i+=1)n+=t[e>>8*i+4&15]+t[e>>8*i&15];return n}function a(e){var t;for(t=0;t<e.length;t+=1)e[t]=s(e[t]);return e.join("")}function l(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e){var t,i=[],n=e.length;for(t=0;t<n-1;t+=2)i.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,i)}function u(){this.reset()}return a(o("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(e,t){return(e=0|e||0)<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(i,n){var r,o,s,a,l=this.byteLength,c=t(i,l),u=l;return n!==e&&(u=t(n,l)),c>u?new ArrayBuffer(0):(r=u-c,o=new ArrayBuffer(r),s=new Uint8Array(o),a=new Uint8Array(this,c,r),s.set(a),o)}}(),u.prototype.append=function(e){return this.appendBinary(l(e)),this},u.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,r=this._buff.length;for(t=64;t<=r;t+=64)i(this._hash,n(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},u.prototype.end=function(e){var t,i,n=this._buff,r=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r;t+=1)o[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(o,r),i=a(this._hash),e&&(i=c(i)),this.reset(),i},u.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},u.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},u.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},u.prototype._finish=function(e,t){var n,r,o,s=t;if(e[s>>2]|=128<<(s%4<<3),s>55)for(i(this._hash,e),s=0;s<16;s+=1)e[s]=0;n=(n=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),r=parseInt(n[2],16),o=parseInt(n[1],16)||0,e[14]=r,e[15]=o,i(this._hash,e)},u.hash=function(e,t){return u.hashBinary(l(e),t)},u.hashBinary=function(e,t){var i=a(o(e));return t?c(i):i},u.ArrayBuffer=function(){this.reset()},u.ArrayBuffer.prototype.append=function(e){var t,n,o,s,a=(n=this._buff.buffer,o=e,!0,(s=new Uint8Array(n.byteLength+o.byteLength)).set(new Uint8Array(n)),s.set(new Uint8Array(o),n.byteLength),s),l=a.length;for(this._length+=e.byteLength,t=64;t<=l;t+=64)i(this._hash,r(a.subarray(t-64,t)));return this._buff=t-64<l?new Uint8Array(a.buffer.slice(t-64)):new Uint8Array(0),this},u.ArrayBuffer.prototype.end=function(e){var t,i,n=this._buff,r=n.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r;t+=1)o[t>>2]|=n[t]<<(t%4<<3);return this._finish(o,r),i=a(this._hash),e&&(i=c(i)),this.reset(),i},u.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},u.ArrayBuffer.prototype.getState=function(){var e,t=u.prototype.getState.call(this);return t.buff=(e=t.buff,String.fromCharCode.apply(null,new Uint8Array(e))),t},u.ArrayBuffer.prototype.setState=function(e){return e.buff=function(e,t){var i,n=e.length,r=new ArrayBuffer(n),o=new Uint8Array(r);for(i=0;i<n;i+=1)o[i]=e.charCodeAt(i);return o}(e.buff),u.prototype.setState.call(this,e)},u.ArrayBuffer.prototype.destroy=u.prototype.destroy,u.ArrayBuffer.prototype._finish=u.prototype._finish,u.ArrayBuffer.hash=function(e,t){var n=a(function(e){var t,n,o,s,a,l,c=e.length,u=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=c;t+=64)i(u,r(e.subarray(t-64,t)));for(n=(e=t-64<c?e.subarray(t-64):new Uint8Array(0)).length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<n;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(i(u,o),t=0;t<16;t+=1)o[t]=0;return s=(s=8*c).toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(s[2],16),l=parseInt(s[1],16)||0,o[14]=a,o[15]=l,i(u,o),u}(new Uint8Array(e)));return t?c(n):n},u}))},{}],379:[function(e,t,i){t.exports=r;var n=e("events").EventEmitter;function r(){n.call(this)}e("inherits")(r,n),r.Readable=e("readable-stream/readable.js"),r.Writable=e("readable-stream/writable.js"),r.Duplex=e("readable-stream/duplex.js"),r.Transform=e("readable-stream/transform.js"),r.PassThrough=e("readable-stream/passthrough.js"),r.Stream=r,r.prototype.pipe=function(e,t){var i=this;function r(t){e.writable&&!1===e.write(t)&&i.pause&&i.pause()}function o(){i.readable&&i.resume&&i.resume()}i.on("data",r),e.on("drain",o),e._isStdio||t&&!1===t.end||(i.on("end",a),i.on("close",l));var s=!1;function a(){s||(s=!0,e.end())}function l(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===n.listenerCount(this,"error"))throw e}function u(){i.removeListener("data",r),e.removeListener("drain",o),i.removeListener("end",a),i.removeListener("close",l),i.removeListener("error",c),e.removeListener("error",c),i.removeListener("end",u),i.removeListener("close",u),e.removeListener("close",u)}return i.on("error",c),e.on("error",c),i.on("end",u),i.on("close",u),e.on("close",u),e.emit("pipe",i),e}},{events:195,inherits:201,"readable-stream/duplex.js":336,"readable-stream/passthrough.js":347,"readable-stream/readable.js":348,"readable-stream/transform.js":349,"readable-stream/writable.js":350}],380:[function(e,t,i){"use strict";var n=e("safe-buffer").Buffer,r=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===r||!r(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=c,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=u,this.end=d,t=3;break;default:return this.write=p,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,i=function(e,t,i){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==i?i:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var i=e.toString("utf16le",t);if(i){var n=i.charCodeAt(i.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function c(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,i)}return t}function u(e,t){var i=(e.length-t)%3;return 0===i?e.toString("base64",t):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-i))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function p(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}i.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,i;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<e.length?t?t+this.text(e,i):this.text(e,i):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var i=function(e,t,i){var n=t.length-1;if(n<i)return 0;var r=s(t[n]);return r>=0?(r>0&&(e.lastNeed=r-1),r):--n<i||-2===r?0:(r=s(t[n]))>=0?(r>0&&(e.lastNeed=r-2),r):--n<i||-2===r?0:(r=s(t[n]))>=0?(r>0&&(2===r?r=0:e.lastNeed=r-3),r):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=i;var n=e.length-(i-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":359}],381:[function(e,t,i){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=n(e("ltgt")),o=n(e("events")),s=n(e("level-codec")),a=n(e("readable-stream")),l=n(e("inherits"));function c(e){return function(e){return"function"==typeof e}(e.prefix)?e.prefix():e}function u(){Error.call(this)}l(u,Error),u.prototype.name="NotFoundError";var d=o.EventEmitter,p=new u,h=function(e,t,i,n){var r=new d;function o(e){var t,i={};if(n)for(t in n)void 0!==n[t]&&(i[t]=n[t]);if(e)for(t in e)void 0!==e[t]&&(i[t]=e[t]);return i}return r.sublevels={},r.options=n,r.version="6.5.4",r.methods={},t=t||[],r.put=function(i,n,s,a){"function"==typeof s&&(a=s,s={}),e.apply([{key:i,value:n,prefix:t.slice(),type:"put"}],o(s),(function(e){if(e)return a(e);r.emit("put",i,n),a(null)}))},r.prefix=function(){return t.slice()},r.batch=function(i,n,s){"function"==typeof n&&(s=n,n={}),i=i.map((function(e){return{key:e.key,value:e.value,prefix:e.prefix||t,keyEncoding:e.keyEncoding,valueEncoding:e.valueEncoding,type:e.type}})),e.apply(i,o(n),(function(e){if(e)return s(e);r.emit("batch",i),s(null)}))},r.get=function(i,n,r){"function"==typeof n&&(r=n,n={}),e.get(i,t,o(n),(function(e,t){e?r(p):r(null,t)}))},r.sublevel=function(n,s){return r.sublevels[n]=r.sublevels[n]||h(e,t.concat(n),i,o(s))},r.readStream=r.createReadStream=function(n){var r;(n=o(n)).prefix=t;var s=e.iterator(n);return(r=i(n,e.createDecoder(n))).setIterator(s),r},r.close=function(t){e.close(t)},r.isOpen=e.isOpen,r.isClosed=e.isClosed,r},f=a.Readable;function m(e,t){if(!(this instanceof m))return new m(e,t);f.call(this,{objectMode:!0,highWaterMark:e.highWaterMark}),this._waiting=!1,this._options=e,this._makeData=t}l(m,f),m.prototype.setIterator=function(e){return this._iterator=e,this._destroyed?e.end((function(){})):this._waiting?(this._waiting=!1,this._read()):this},m.prototype._read=function(){var e=this;if(!e._destroyed)return e._iterator?void e._iterator.next((function(t,i,n){if(t||void 0===i&&void 0===n)return t||e._destroyed||e.push(null),e._cleanup(t);n=e._makeData(i,n),e._destroyed||e.push(n)})):this._waiting=!0},m.prototype._cleanup=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;e&&"iterator has ended"!==e.message&&t.emit("error",e),t._iterator?t._iterator.end((function(){t._iterator=null,t.emit("close")})):t.emit("close")}},m.prototype.destroy=function(){this._cleanup()};var g={encode:function(e){return""+e[0]+""+e[1]},decode:function(e){var t=e.toString(),i=t.indexOf("",1);return[t.substring(1,i),t.substring(i+1)]},lowerBound:"\0",upperBound:""},b=new s;t.exports=function(e){return h(function(e,t,i){function n(e,n,r,o){return t.encode([e,i.encodeKey(n,r,o)])}function o(e,t){return t&&t.options&&(e.keyEncoding=e.keyEncoding||t.options.keyEncoding,e.valueEncoding=e.valueEncoding||t.options.valueEncoding),e}return e.open((function(){})),{apply:function(t,r,s){r=r||{};for(var a=[],l=-1,u=t.length;++l<u;){var d=t[l];o(d,d.prefix),d.prefix=c(d.prefix),a.push({key:n(d.prefix,d.key,r,d),value:"del"!==d.type&&i.encodeValue(d.value,r,d),type:d.type})}e.db.batch(a,r,s)},get:function(t,r,o,s){return o.asBuffer=i.valueAsBuffer(o),e.db.get(n(r,t,o),o,(function(e,t){e?s(e):s(null,i.decodeValue(t,o))}))},createDecoder:function(e){return function(n,r){return{key:i.decodeKey(t.decode(n)[1],e),value:i.decodeValue(r,e)}}},isClosed:function(){return e.isClosed()},close:function(t){return e.close(t)},iterator:function(o){var s,a=function(e){var t={};for(var i in e)t[i]=e[i];return t}(o||{}),l=o.prefix||[];return r.toLtgt(o,a,(function(e){return n(l,e,a,{})}),t.lowerBound,t.upperBound),a.prefix=null,a.keyAsBuffer=a.valueAsBuffer=!1,"number"!=typeof a.limit&&(a.limit=-1),a.keyAsBuffer=t.buffer,a.valueAsBuffer=i.valueAsBuffer(a),s=e.db.iterator(a),{next:function(e){return s.next(e)},end:function(e){s.end(e)}}}}}(e,g,b),[],m,e.options)}},{events:195,inherits:201,"level-codec":205,ltgt:244,"readable-stream":388}],382:[function(e,t,i){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],383:[function(e,t,i){(function(i){(function(){t.exports=a;var n=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t},r=e("core-util-is");r.inherits=e("inherits");var o=e("./_stream_readable"),s=e("./_stream_writable");function a(e){if(!(this instanceof a))return new a(e);o.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",l)}function l(){this.allowHalfOpen||this._writableState.ended||i.nextTick(this.end.bind(this))}r.inherits(a,o),function(e,t){for(var i=0,n=e.length;i<n;i++)t(e[i],i)}(n(s.prototype),(function(e){a.prototype[e]||(a.prototype[e]=s.prototype[e])}))}).call(this)}).call(this,e("_process"))},{"./_stream_readable":385,"./_stream_writable":387,_process:285,"core-util-is":170,inherits:201}],384:[function(e,t,i){t.exports=o;var n=e("./_stream_transform"),r=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);n.call(this,e)}r.inherits=e("inherits"),r.inherits(o,n),o.prototype._transform=function(e,t,i){i(null,e)}},{"./_stream_transform":386,"core-util-is":170,inherits:201}],385:[function(e,t,i){(function(i){(function(){t.exports=u;var n=e("isarray"),r=e("buffer").Buffer;u.ReadableState=c;var o=e("events").EventEmitter;o.listenerCount||(o.listenerCount=function(e,t){return e.listeners(t).length});var s,a=e("stream"),l=e("core-util-is");function c(t,i){var n=(t=t||{}).highWaterMark;this.highWaterMark=n||0===n?n:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!t.objectMode,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(s||(s=e("string_decoder/").StringDecoder),this.decoder=new s(t.encoding),this.encoding=t.encoding)}function u(e){if(!(this instanceof u))return new u(e);this._readableState=new c(e,this),this.readable=!0,a.call(this)}function d(e,t,n,o,s){var a=function(e,t){var i=null;return r.isBuffer(t)||"string"==typeof t||null==t||e.objectMode||(i=new TypeError("Invalid non-string/buffer chunk")),i}(t,n);if(a)e.emit("error",a);else if(null==n)t.reading=!1,t.ended||function(e,t){if(t.decoder&&!t.ended){var i=t.decoder.end();i&&i.length&&(t.buffer.push(i),t.length+=t.objectMode?1:i.length)}t.ended=!0,t.length>0?f(e):k(e)}(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!s){var l=new Error("stream.push() after EOF");e.emit("error",l)}else t.endEmitted&&s?(l=new Error("stream.unshift() after end event"),e.emit("error",l)):(!t.decoder||s||o||(n=t.decoder.write(n)),t.length+=t.objectMode?1:n.length,s?t.buffer.unshift(n):(t.reading=!1,t.buffer.push(n)),t.needReadable&&f(e),function(e,t){t.readingMore||(t.readingMore=!0,i.nextTick((function(){!function(e,t){for(var i=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(e.read(0),i!==t.length);)i=t.length;t.readingMore=!1}(e,t)})))}(e,t));else s||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}l.inherits=e("inherits"),l.inherits(u,a),u.prototype.push=function(e,t){var i=this._readableState;return"string"!=typeof e||i.objectMode||(t=t||i.defaultEncoding)!==i.encoding&&(e=new r(e,t),t=""),d(this,i,e,t,!1)},u.prototype.unshift=function(e){return d(this,this._readableState,e,"",!0)},u.prototype.setEncoding=function(t){s||(s=e("string_decoder/").StringDecoder),this._readableState.decoder=new s(t),this._readableState.encoding=t};var p=8388608;function h(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:null===e||isNaN(e)?t.flowing&&t.buffer.length?t.buffer[0].length:t.length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=function(e){if(e>=p)e=p;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function f(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,t.sync?i.nextTick((function(){m(e)})):m(e))}function m(e){e.emit("readable")}function g(e){var t,i=e._readableState;function n(e,n,r){!1===e.write(t)&&i.awaitDrain++}for(i.awaitDrain=0;i.pipesCount&&null!==(t=e.read());)if(1===i.pipesCount?n(i.pipes):w(i.pipes,n),e.emit("data",t),i.awaitDrain>0)return;if(0===i.pipesCount)return i.flowing=!1,void(o.listenerCount(e,"data")>0&&v(e));i.ranOut=!0}function b(){this._readableState.ranOut&&(this._readableState.ranOut=!1,g(this))}function v(e,t){if(e._readableState.flowing)throw new Error("Cannot switch to old mode now.");var n=t||!1,r=!1;e.readable=!0,e.pipe=a.prototype.pipe,e.on=e.addListener=a.prototype.on,e.on("readable",(function(){var t;for(r=!0;!n&&null!==(t=e.read());)e.emit("data",t);null===t&&(r=!1,e._readableState.needReadable=!0)})),e.pause=function(){n=!0,this.emit("pause")},e.resume=function(){n=!1,r?i.nextTick((function(){e.emit("readable")})):this.read(0),this.emit("resume")},e.emit("readable")}function y(e,t){var i,n=t.buffer,o=t.length,s=!!t.decoder,a=!!t.objectMode;if(0===n.length)return null;if(0===o)i=null;else if(a)i=n.shift();else if(!e||e>=o)i=s?n.join(""):r.concat(n,o),n.length=0;else if(e<n[0].length)i=(d=n[0]).slice(0,e),n[0]=d.slice(e);else if(e===n[0].length)i=n.shift();else{i=s?"":new r(e);for(var l=0,c=0,u=n.length;c<u&&l<e;c++){var d=n[0],p=Math.min(e-l,d.length);s?i+=d.slice(0,p):d.copy(i,l,0,p),p<d.length?n[0]=d.slice(p):n.shift(),l+=p}}return i}function k(e){var t=e._readableState;if(t.length>0)throw new Error("endReadable called on non-empty stream");!t.endEmitted&&t.calledRead&&(t.ended=!0,i.nextTick((function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))})))}function w(e,t){for(var i=0,n=e.length;i<n;i++)t(e[i],i)}u.prototype.read=function(e){var t=this._readableState;t.calledRead=!0;var i,n=e;if(("number"!=typeof e||e>0)&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f(this),null;if(0===(e=h(e,t))&&t.ended)return i=null,t.length>0&&t.decoder&&(i=y(e,t),t.length-=i.length),0===t.length&&k(this),i;var r=t.needReadable;return t.length-e<=t.highWaterMark&&(r=!0),(t.ended||t.reading)&&(r=!1),r&&(t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1),r&&!t.reading&&(e=h(n,t)),null===(i=e>0?y(e,t):null)&&(t.needReadable=!0,e=0),t.length-=e,0!==t.length||t.ended||(t.needReadable=!0),t.ended&&!t.endEmitted&&0===t.length&&k(this),i},u.prototype._read=function(e){this.emit("error",new Error("not implemented"))},u.prototype.pipe=function(e,t){var r=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=e;break;case 1:s.pipes=[s.pipes,e];break;default:s.pipes.push(e)}s.pipesCount+=1;var a=t&&!1===t.end||e===i.stdout||e===i.stderr?d:c;function l(e){e===r&&d()}function c(){e.end()}s.endEmitted?i.nextTick(a):r.once("end",a),e.on("unpipe",l);var u=function(e){return function(){var t=e._readableState;t.awaitDrain--,0===t.awaitDrain&&g(e)}}(r);function d(){e.removeListener("close",h),e.removeListener("finish",f),e.removeListener("drain",u),e.removeListener("error",p),e.removeListener("unpipe",l),r.removeListener("end",c),r.removeListener("end",d),e._writableState&&!e._writableState.needDrain||u()}function p(t){m(),e.removeListener("error",p),0===o.listenerCount(e,"error")&&e.emit("error",t)}function h(){e.removeListener("finish",f),m()}function f(){e.removeListener("close",h),m()}function m(){r.unpipe(e)}return e.on("drain",u),e._events&&e._events.error?n(e._events.error)?e._events.error.unshift(p):e._events.error=[p,e._events.error]:e.on("error",p),e.once("close",h),e.once("finish",f),e.emit("pipe",r),s.flowing||(this.on("readable",b),s.flowing=!0,i.nextTick((function(){g(r)}))),e},u.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,this.removeListener("readable",b),t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var i=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,this.removeListener("readable",b),t.flowing=!1;for(var r=0;r<n;r++)i[r].emit("unpipe",this);return this}return-1===(r=function(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1}(t.pipes,e))||(t.pipes.splice(r,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},u.prototype.on=function(e,t){var i=a.prototype.on.call(this,e,t);if("data"!==e||this._readableState.flowing||v(this),"readable"===e&&this.readable){var n=this._readableState;n.readableListening||(n.readableListening=!0,n.emittedReadable=!1,n.needReadable=!0,n.reading?n.length&&f(this):this.read(0))}return i},u.prototype.addListener=u.prototype.on,u.prototype.resume=function(){v(this),this.read(0),this.emit("resume")},u.prototype.pause=function(){v(this,!0),this.emit("pause")},u.prototype.wrap=function(e){var t=this._readableState,i=!1,n=this;for(var r in e.on("end",(function(){if(t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&n.push(e)}n.push(null)})),e.on("data",(function(r){t.decoder&&(r=t.decoder.write(r)),t.objectMode&&null==r||(t.objectMode||r&&r.length)&&(n.push(r)||(i=!0,e.pause()))})),e)"function"==typeof e[r]&&void 0===this[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));return w(["error","close","destroy","pause","resume"],(function(t){e.on(t,n.emit.bind(n,t))})),n._read=function(t){i&&(i=!1,e.resume())},n},u._fromList=y}).call(this)}).call(this,e("_process"))},{_process:285,buffer:168,"core-util-is":170,events:195,inherits:201,isarray:382,stream:379,"string_decoder/":389}],386:[function(e,t,i){t.exports=s;var n=e("./_stream_duplex"),r=e("core-util-is");function o(e,t){this.afterTransform=function(e,i){return function(e,t,i){var n=e._transformState;n.transforming=!1;var r=n.writecb;if(!r)return e.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,null!=i&&e.push(i),r&&r(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(t,e,i)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function s(e){if(!(this instanceof s))return new s(e);n.call(this,e),this._transformState=new o(e,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",(function(){"function"==typeof this._flush?this._flush((function(e){a(t,e)})):a(t)}))}function a(e,t){if(t)return e.emit("error",t);var i=e._writableState,n=(e._readableState,e._transformState);if(i.length)throw new Error("calling transform done when ws.length != 0");if(n.transforming)throw new Error("calling transform done when still transforming");return e.push(null)}r.inherits=e("inherits"),r.inherits(s,n),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,i){throw new Error("not implemented")},s.prototype._write=function(e,t,i){var n=this._transformState;if(n.writecb=i,n.writechunk=e,n.writeencoding=t,!n.transforming){var r=this._readableState;(n.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":383,"core-util-is":170,inherits:201}],387:[function(e,t,i){(function(i){(function(){t.exports=l;var n=e("buffer").Buffer;l.WritableState=a;var r=e("core-util-is");r.inherits=e("inherits");var o=e("stream");function s(e,t,i){this.chunk=e,this.encoding=t,this.callback=i}function a(e,t){var n=(e=e||{}).highWaterMark;this.highWaterMark=n||0===n?n:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var r=!1===e.decodeStrings;this.decodeStrings=!r,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,o=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,o){n?i.nextTick((function(){o(r)})):o(r),e._writableState.errorEmitted=!0,e.emit("error",r)}(e,0,r,t,o);else{var s=p(e,n);s||n.bufferProcessing||!n.buffer.length||function(e,t){t.bufferProcessing=!0;for(var i=0;i<t.buffer.length;i++){var n=t.buffer[i],r=n.chunk,o=n.encoding,s=n.callback;if(u(e,t,t.objectMode?1:r.length,r,o,s),t.writing){i++;break}}t.bufferProcessing=!1,i<t.buffer.length?t.buffer=t.buffer.slice(i):t.buffer.length=0}(e,n),r?i.nextTick((function(){d(e,n,s,o)})):d(e,n,s,o)}}(t,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function l(t){var i=e("./_stream_duplex");if(!(this instanceof l||this instanceof i))return new l(t);this._writableState=new a(t,this),this.writable=!0,o.call(this)}function c(e,t,i,r,o){i=function(e,t,i){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=new n(t,i)),t}(t,i,r),n.isBuffer(i)&&(r="buffer");var a=t.objectMode?1:i.length;t.length+=a;var l=t.length<t.highWaterMark;return l||(t.needDrain=!0),t.writing?t.buffer.push(new s(i,r,o)):u(e,t,a,i,r,o),l}function u(e,t,i,n,r,o){t.writelen=i,t.writecb=o,t.writing=!0,t.sync=!0,e._write(n,r,t.onwrite),t.sync=!1}function d(e,t,i,n){i||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),n(),i&&h(e,t)}function p(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function h(e,t){var i=p(0,t);return i&&(t.finished=!0,e.emit("finish")),i}r.inherits(l,o),l.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},l.prototype.write=function(e,t,r){var o=this._writableState,s=!1;return"function"==typeof t&&(r=t,t=null),n.isBuffer(e)?t="buffer":t||(t=o.defaultEncoding),"function"!=typeof r&&(r=function(){}),o.ended?function(e,t,n){var r=new Error("write after end");e.emit("error",r),i.nextTick((function(){n(r)}))}(this,0,r):function(e,t,r,o){var s=!0;if(!n.isBuffer(r)&&"string"!=typeof r&&null!=r&&!t.objectMode){var a=new TypeError("Invalid non-string/buffer chunk");e.emit("error",a),i.nextTick((function(){o(a)})),s=!1}return s}(this,o,e,r)&&(s=c(this,o,e,t,r)),s},l.prototype._write=function(e,t,i){i(new Error("not implemented"))},l.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.ending||r.finished||function(e,t,n){t.ending=!0,h(e,t),n&&(t.finished?i.nextTick(n):e.once("finish",n)),t.ended=!0}(this,r,n)}}).call(this)}).call(this,e("_process"))},{"./_stream_duplex":383,_process:285,buffer:168,"core-util-is":170,inherits:201,stream:379}],388:[function(e,t,i){var n=e("stream");(i=t.exports=e("./lib/_stream_readable.js")).Stream=n,i.Readable=i,i.Writable=e("./lib/_stream_writable.js"),i.Duplex=e("./lib/_stream_duplex.js"),i.Transform=e("./lib/_stream_transform.js"),i.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":383,"./lib/_stream_passthrough.js":384,"./lib/_stream_readable.js":385,"./lib/_stream_transform.js":386,"./lib/_stream_writable.js":387,stream:379}],389:[function(e,t,i){var n=e("buffer").Buffer,r=n.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};var o=i.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!r(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=a;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=l;break;default:return void(this.write=s)}this.charBuffer=new n(6),this.charReceived=0,this.charLength=0};function s(e){return e.toString(this.encoding)}function a(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function l(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}o.prototype.write=function(e){for(var t="";this.charLength;){var i=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,i),this.charReceived+=i,this.charReceived<this.charLength)return"";if(e=e.slice(i,e.length),!((n=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&n<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var n,r=e.length;if(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,r),r-=this.charReceived),r=(t+=e.toString(this.encoding,0,r)).length-1,(n=t.charCodeAt(r))>=55296&&n<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,r)}return t},o.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var i=e[e.length-t];if(1==t&&i>>5==6){this.charLength=2;break}if(t<=2&&i>>4==14){this.charLength=3;break}if(t<=3&&i>>3==30){this.charLength=4;break}}this.charReceived=t},o.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var i=this.charReceived,n=this.charBuffer,r=this.encoding;t+=n.slice(0,i).toString(r)}return t}},{buffer:168}],390:[function(e,t,i){(function(n){(function(){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r,o,s=e("./ponyfill.js"),a=(o=s)&&o.__esModule?o:{default:o};r="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:void 0!==t?t:Function("return this")();var l=(0,a.default)(r);i.default=l}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ponyfill.js":391}],391:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(e){var t,i=e.Symbol;return"function"==typeof i?i.observable?t=i.observable:(t=i("observable"),i.observable=t):t="@@observable",t}},{}],392:[function(e,t,i){(function(t,n){(function(){var r=e("process/browser.js").nextTick,o=Function.prototype.apply,s=Array.prototype.slice,a={},l=0;function c(e,t){this._id=e,this._clearFn=t}i.setTimeout=function(){return new c(o.call(setTimeout,window,arguments),clearTimeout)},i.setInterval=function(){return new c(o.call(setInterval,window,arguments),clearInterval)},i.clearTimeout=i.clearInterval=function(e){e.close()},c.prototype.unref=c.prototype.ref=function(){},c.prototype.close=function(){this._clearFn.call(window,this._id)},i.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},i.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},i._unrefActive=i.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},i.setImmediate="function"==typeof t?t:function(e){var t=l++,n=!(arguments.length<2)&&s.call(arguments,1);return a[t]=!0,r((function(){a[t]&&(n?e.apply(null,n):e.call(null),i.clearImmediate(t))})),t},i.clearImmediate="function"==typeof n?n:function(e){delete a[e]}}).call(this)}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":285,timers:392}],393:[function(e,t,i){(function(e){(function(){function i(t){try{if(!e.localStorage)return!1}catch(t){return!1}var i=e.localStorage[t];return null!=i&&"true"===String(i).toLowerCase()}t.exports=function(e,t){if(i("noDeprecation"))return e;var n=!1;return function(){if(!n){if(i("throwDeprecation"))throw new Error(t);i("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],394:[function(e,t,i){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},{}],395:[function(e,t,i){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],396:[function(e,t,i){(function(t,n){(function(){var r=/%[sdj%]/g;i.format=function(e){if(!b(e)){for(var t=[],i=0;i<arguments.length;i++)t.push(a(arguments[i]));return t.join(" ")}i=1;for(var n=arguments,o=n.length,s=String(e).replace(r,(function(e){if("%%"===e)return"%";if(i>=o)return e;switch(e){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(e){return"[Circular]"}default:return e}})),l=n[i];i<o;l=n[++i])m(l)||!k(l)?s+=" "+l:s+=" "+a(l);return s},i.deprecate=function(e,r){if(v(n.process))return function(){return i.deprecate(e,r).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(r);t.traceDeprecation?console.trace(r):console.error(r),o=!0}return e.apply(this,arguments)}};var o,s={};function a(e,t){var n={seen:[],stylize:c};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),f(t)?n.showHidden=t:t&&i._extend(n,t),v(n.showHidden)&&(n.showHidden=!1),v(n.depth)&&(n.depth=2),v(n.colors)&&(n.colors=!1),v(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=l),u(n,e,n.depth)}function l(e,t){var i=a.styles[t];return i?"["+a.colors[i][0]+"m"+e+"["+a.colors[i][1]+"m":e}function c(e,t){return e}function u(e,t,n){if(e.customInspect&&t&&E(t.inspect)&&t.inspect!==i.inspect&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(n,e);return b(r)||(r=u(e,r,n)),r}var o=function(e,t){if(v(t))return e.stylize("undefined","undefined");if(b(t)){var i="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(i,"string")}return g(t)?e.stylize(""+t,"number"):f(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}(e,t);if(o)return o;var s=Object.keys(t),a=function(e){var t={};return e.forEach((function(e,i){t[e]=!0})),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),x(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return d(t);if(0===s.length){if(E(t)){var l=t.name?": "+t.name:"";return e.stylize("[Function"+l+"]","special")}if(y(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(w(t))return e.stylize(Date.prototype.toString.call(t),"date");if(x(t))return d(t)}var c,k="",C=!1,S=["{","}"];return h(t)&&(C=!0,S=["[","]"]),E(t)&&(k=" [Function"+(t.name?": "+t.name:"")+"]"),y(t)&&(k=" "+RegExp.prototype.toString.call(t)),w(t)&&(k=" "+Date.prototype.toUTCString.call(t)),x(t)&&(k=" "+d(t)),0!==s.length||C&&0!=t.length?n<0?y(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=C?function(e,t,i,n,r){for(var o=[],s=0,a=t.length;s<a;++s)A(t,String(s))?o.push(p(e,t,i,n,String(s),!0)):o.push("");return r.forEach((function(r){r.match(/^\d+$/)||o.push(p(e,t,i,n,r,!0))})),o}(e,t,n,a,s):s.map((function(i){return p(e,t,n,a,i,C)})),e.seen.pop(),function(e,t,i){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?i[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+i[1]:i[0]+t+" "+e.join(", ")+" "+i[1]}(c,k,S)):S[0]+k+S[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,i,n,r,o){var s,a,l;if((l=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?a=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(a=e.stylize("[Setter]","special")),A(n,r)||(s="["+r+"]"),a||(e.seen.indexOf(l.value)<0?(a=m(i)?u(e,l.value,null):u(e,l.value,i-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),v(s)){if(o&&r.match(/^\d+$/))return a;(s=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function h(e){return Array.isArray(e)}function f(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function b(e){return"string"==typeof e}function v(e){return void 0===e}function y(e){return k(e)&&"[object RegExp]"===C(e)}function k(e){return"object"==typeof e&&null!==e}function w(e){return k(e)&&"[object Date]"===C(e)}function x(e){return k(e)&&("[object Error]"===C(e)||e instanceof Error)}function E(e){return"function"==typeof e}function C(e){return Object.prototype.toString.call(e)}function S(e){return e<10?"0"+e.toString(10):e.toString(10)}i.debuglog=function(e){if(v(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!s[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var n=t.pid;s[e]=function(){var t=i.format.apply(i,arguments);console.error("%s %d: %s",e,n,t)}}else s[e]=function(){};return s[e]},i.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},i.isArray=h,i.isBoolean=f,i.isNull=m,i.isNullOrUndefined=function(e){return null==e},i.isNumber=g,i.isString=b,i.isSymbol=function(e){return"symbol"==typeof e},i.isUndefined=v,i.isRegExp=y,i.isObject=k,i.isDate=w,i.isError=x,i.isFunction=E,i.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},i.isBuffer=e("./support/isBuffer");var _=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function T(){var e=new Date,t=[S(e.getHours()),S(e.getMinutes()),S(e.getSeconds())].join(":");return[e.getDate(),_[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}i.log=function(){console.log("%s - %s",T(),i.format.apply(i,arguments))},i.inherits=e("inherits"),i._extend=function(e,t){if(!t||!k(t))return e;for(var i=Object.keys(t),n=i.length;n--;)e[i[n]]=t[i[n]];return e}}).call(this)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":395,_process:285,inherits:394}],397:[function(e,t,i){"use strict";function n(e,t,i){var n=i[i.length-1];e===n.element&&(i.pop(),n=i[i.length-1]);var r=n.element,o=n.index;Array.isArray(r)?r.push(e):o===t.length-2?r[t.pop()]=e:t.push(e)}i.stringify=function(e){var t=[];t.push({obj:e});for(var i,n,r,o,s,a,l,c,u,d,p="";i=t.pop();)if(n=i.obj,p+=i.prefix||"",r=i.val||"")p+=r;else if("object"!=typeof n)p+=void 0===n?null:JSON.stringify(n);else if(null===n)p+="null";else if(Array.isArray(n)){for(t.push({val:"]"}),o=n.length-1;o>=0;o--)s=0===o?"":",",t.push({obj:n[o],prefix:s});t.push({val:"["})}else{for(l in a=[],n)n.hasOwnProperty(l)&&a.push(l);for(t.push({val:"}"}),o=a.length-1;o>=0;o--)u=n[c=a[o]],d=o>0?",":"",d+=JSON.stringify(c)+":",t.push({obj:u,prefix:d});t.push({val:"{"})}return p},i.parse=function(e){for(var t,i,r,o,s,a,l,c,u,d=[],p=[],h=0;;)if("}"!==(t=e[h++])&&"]"!==t&&void 0!==t)switch(t){case" ":case"\t":case"\n":case":":case",":break;case"n":h+=3,n(null,d,p);break;case"t":h+=3,n(!0,d,p);break;case"f":h+=4,n(!1,d,p);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(i="",h--;;){if(r=e[h++],!/[\d\.\-e\+]/.test(r)){h--;break}i+=r}n(parseFloat(i),d,p);break;case'"':for(o="",s=void 0,a=0;'"'!==(l=e[h++])||"\\"===s&&a%2==1;)o+=l,"\\"===(s=l)?a++:a=0;n(JSON.parse('"'+o+'"'),d,p);break;case"[":c={element:[],index:d.length},d.push(c.element),p.push(c);break;case"{":u={element:{},index:d.length},d.push(u.element),p.push(u);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===d.length)return d.pop();n(d.pop(),d,p)}}},{}],398:[function(e,t,i){"use strict";t.exports=function(){}},{}],399:[function(e,t,i){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var i=arguments[t];for(var r in i)n.call(i,r)&&(e[r]=i[r])}return e};var n=Object.prototype.hasOwnProperty},{}]},{},[16]);